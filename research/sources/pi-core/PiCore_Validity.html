<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Theory PiCore_Validity (Isabelle2016: February 2016)</title>
<link media="all" rel="stylesheet" type="text/css" href="isabelle.css"/>
</head>

<body>
<div class="head"><h1>Theory PiCore_Validity</h1>

<span class="command">theory</span> <span class="name">PiCore_Validity</span><br/>
<span class="keyword">imports</span> <a href="PiCore_Computation.html"><span class="name">PiCore_Computation</span></a><br/>

</div>
<div class="source">
<pre class="source"><span class="comment">(*
Created by Yongwang Zhao (ywzhao@ntu.edu.sg, zhaoyw@buaa.edu.cn)
School of Computer Engineering, Nanyang Technological University, Singapore
and School of Computer Science &amp; Engineering, Beihang University, China
*)</span><span class="">
</span><span class="">
</span><span class="keyword1">section</span><span class=""> </span><span class="cartouche">&#8249;Validity of Correctness Formulas&#8250;</span><span class="">
</span><span class="">
</span><span class="keyword1">theory</span><span class=""> </span><span class="">PiCore_Validity</span><span class="">
</span><span class="keyword2">imports</span><span class=""> </span><span class="">PiCore_Computation</span><span class="">
</span><span class="keyword2">begin</span><span class="">
</span><span class="">
</span><span class="keyword1">subsection</span><span class=""> </span><span class="cartouche">&#8249;Definitions Correctness Formulas&#8250;</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">assume_p</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;s set &#215; (&#39;s &#215; &#39;s) set) &#8658; (&#39;s pconfs) set&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;assume_p &#8801; &#955;(pre, rely). {c. gets_p (c!0) &#8712; pre &#8743; (&#8704;i. Suc i&lt;length c &#10230; 
               c!i -pe&#8594; c!(Suc i) &#10230; (gets_p (c!i), gets_p (c!Suc i)) &#8712; rely)}&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">commit_p</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;((&#39;s &#215; &#39;s) set &#215; &#39;s set) &#8658; (&#39;s pconfs) set&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;commit_p &#8801; &#955;(guar, post). {c. (&#8704;i. Suc i&lt;length c &#10230; 
               c!i -c&#8594; c!(Suc i) &#10230; (gets_p (c!i), gets_p (c!Suc i)) &#8712; guar) &#8743; 
               (getspc_p (last c) = None &#10230; gets_p (last c) &#8712; post)}&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">prog_validity</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;&#39;s prog &#8658; &#39;s set &#8658; (&#39;s &#215; &#39;s) set &#8658; (&#39;s &#215; &#39;s) set &#8658; &#39;s set &#8658; bool&quot;</span><span class=""> 
</span><span class="">                 </span><span class="delimiter">(</span><span class="string">&quot;&#8872; _ sat<span class="hidden">&#8681;</span><sub>p</sub> [_, _, _, _]&quot;</span><span class=""> </span><span class="delimiter">[</span><span class="">60</span><span class="delimiter">,</span><span class="">0</span><span class="delimiter">,</span><span class="">0</span><span class="delimiter">,</span><span class="">0</span><span class="delimiter">,</span><span class="">0</span><span class="delimiter">]</span><span class=""> </span><span class="">45</span><span class="delimiter">)</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#8872; P sat<span class="hidden">&#8681;</span><sub>p</sub> [pre, rely, guar, post] &#8801; 
   &#8704;s. cpts_of_p (Some P) s &#8745; assume_p(pre, rely) &#8838; commit_p(guar, post)&quot;</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">assume_e</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;s set &#215; (&#39;s &#215; &#39;s) set) &#8658; ((&#39;l,&#39;k,&#39;s) econfs) set&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;assume_e &#8801; &#955;(pre, rely). {c. gets_e (c!0) &#8712; pre &#8743; (&#8704;i. Suc i&lt;length c &#10230; 
               c!i -ee&#8594; c!(Suc i) &#10230; (gets_e (c!i), gets_e (c!Suc i)) &#8712; rely)}&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">commit_e</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;((&#39;s &#215; &#39;s) set &#215; &#39;s set) &#8658; ((&#39;l,&#39;k,&#39;s) econfs) set&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;commit_e &#8801; &#955;(guar, post). {c. (&#8704;i. Suc i&lt;length c &#10230; 
               (&#8707;t. c!i -et-t&#8594; c!(Suc i)) &#10230; (gets_e (c!i), gets_e (c!Suc i)) &#8712; guar) &#8743; 
               (getspc_e (last c) = AnonyEvent (None) &#10230; gets_e (last c) &#8712; post)}&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">evt_validity</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) event &#8658; &#39;s set &#8658; (&#39;s &#215; &#39;s) set &#8658; (&#39;s &#215; &#39;s) set &#8658; &#39;s set &#8658; bool&quot;</span><span class=""> 
</span><span class="">                 </span><span class="delimiter">(</span><span class="string">&quot;&#8872; _ sat<span class="hidden">&#8681;</span><sub>e</sub> [_, _, _, _]&quot;</span><span class=""> </span><span class="delimiter">[</span><span class="">60</span><span class="delimiter">,</span><span class="">0</span><span class="delimiter">,</span><span class="">0</span><span class="delimiter">,</span><span class="">0</span><span class="delimiter">,</span><span class="">0</span><span class="delimiter">]</span><span class=""> </span><span class="">45</span><span class="delimiter">)</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#8872; Evt sat<span class="hidden">&#8681;</span><sub>e</sub> [pre, rely, guar, post] &#8801; 
   &#8704;s x. (cpts_of_ev Evt s x) &#8745; assume_e(pre, rely) &#8838; commit_e(guar, post)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">assume_es</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;s set &#215; (&#39;s &#215; &#39;s) set) &#8658; ((&#39;l,&#39;k,&#39;s) esconfs) set&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;assume_es &#8801; &#955;(pre, rely). {c. gets_es (c!0) &#8712; pre &#8743; (&#8704;i. Suc i&lt;length c &#10230; 
               c!i -ese&#8594; c!(Suc i) &#10230; (gets_es (c!i), gets_es (c!Suc i)) &#8712; rely)}&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">commit_es</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;((&#39;s &#215; &#39;s) set &#215; &#39;s set) &#8658; ((&#39;l,&#39;k,&#39;s) esconfs) set&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;commit_es &#8801; &#955;(guar, post). {c. (&#8704;i. Suc i&lt;length c &#10230; 
               (&#8707;t. c!i -es-t&#8594; c!(Suc i)) &#10230; (gets_es (c!i), gets_es (c!Suc i)) &#8712; guar) }&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">es_validity</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) esys &#8658; &#39;s set &#8658; (&#39;s &#215; &#39;s) set &#8658; (&#39;s &#215; &#39;s) set &#8658; &#39;s set &#8658; bool&quot;</span><span class=""> 
</span><span class="">                 </span><span class="delimiter">(</span><span class="string">&quot;&#8872; _ sat<span class="hidden">&#8681;</span><sub>s</sub> [_, _, _, _]&quot;</span><span class=""> </span><span class="delimiter">[</span><span class="">60</span><span class="delimiter">,</span><span class="">0</span><span class="delimiter">,</span><span class="">0</span><span class="delimiter">,</span><span class="">0</span><span class="delimiter">,</span><span class="">0</span><span class="delimiter">]</span><span class=""> </span><span class="">45</span><span class="delimiter">)</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#8872; es sat<span class="hidden">&#8681;</span><sub>s</sub> [pre, rely, guar, post] &#8801; 
   &#8704;s x. (cpts_of_es es s x) &#8745; assume_es(pre, rely) &#8838; commit_es(guar, post)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">assume_pes</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;s set &#215; (&#39;s &#215; &#39;s) set) &#8658; ((&#39;l,&#39;k,&#39;s) pesconfs) set&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;assume_pes &#8801; &#955;(pre, rely). {c. gets (c!0) &#8712; pre &#8743; (&#8704;i. Suc i&lt;length c &#10230; 
               c!i -pese&#8594; c!(Suc i) &#10230; (gets (c!i), gets (c!Suc i)) &#8712; rely)}&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">commit_pes</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;((&#39;s &#215; &#39;s) set &#215; &#39;s set) &#8658; ((&#39;l,&#39;k,&#39;s) pesconfs) set&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;commit_pes &#8801; &#955;(guar, post). {c. (&#8704;i. Suc i&lt;length c &#10230; 
               (&#8707;t. c!i -pes-t&#8594; c!(Suc i)) &#10230; (gets (c!i), gets (c!Suc i)) &#8712; guar)}&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">pes_validity</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) paresys &#8658; &#39;s set &#8658; (&#39;s &#215; &#39;s) set &#8658; (&#39;s &#215; &#39;s) set &#8658; &#39;s set &#8658; bool&quot;</span><span class=""> 
</span><span class="">                 </span><span class="delimiter">(</span><span class="string">&quot;&#8872; _ SAT [_, _, _, _]&quot;</span><span class=""> </span><span class="delimiter">[</span><span class="">60</span><span class="delimiter">,</span><span class="">0</span><span class="delimiter">,</span><span class="">0</span><span class="delimiter">,</span><span class="">0</span><span class="delimiter">,</span><span class="">0</span><span class="delimiter">]</span><span class=""> </span><span class="">45</span><span class="delimiter">)</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#8872; pes SAT [pre, rely, guar, post] &#8801; 
   &#8704;s x. (cpts_of_pes pes s x) &#8745; assume_pes(pre, rely) &#8838; commit_pes(guar, post)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">subsection</span><span class=""> </span><span class="cartouche">&#8249;Lemmas of Correctness Formulas&#8250;</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">assume_es_one_more</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;&#10214;esl&#8712;cpts_es; m &gt; 0; m &lt; length esl; take m esl&#8712;assume_es(pre, rely); &#172;(esl!(m-1) -ese&#8594;esl!m)&#10215;
        &#10233; take (Suc m) esl &#8712; assume_es(pre, rely)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;cpts_es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m &gt; 0&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m &lt; length esl&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;take m esl&#8712;assume_es(pre, rely)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(esl!(m-1) -ese&#8594;esl!m)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">let</span><span class=""> </span><span class="var">?esl1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;take (Suc m) esl&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">let</span><span class=""> </span><span class="var">?esl</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;take m esl&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;gets_es (?esl1!0) &#8712; pre &#8743; (&#8704;i. Suc i&lt;length ?esl1 &#10230; 
               ?esl1!i -ese&#8594; ?esl1!(Suc i) &#10230; (gets_es (?esl1!i), gets_es (?esl1!Suc i)) &#8712; rely)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="">
</span><span class="">        </span><span class="keyword1">from</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;gets_es (?esl1!0) &#8712; pre&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length ?esl1 &#10230; 
               ?esl1!i -ese&#8594; ?esl1!(Suc i) &#10230; (gets_es (?esl1!i), gets_es (?esl1!Suc i)) &#8712; rely&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">          </span><span class="keyword1">{</span><span class="">
</span><span class="">            </span><span class="keyword3">fix</span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">            </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i&lt;length ?esl1&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2">and</span><span class="">  </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl1!i -ese&#8594; ?esl1!(Suc i)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(gets_es (?esl1!i), gets_es (?esl1!Suc i)) &#8712; rely&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;i &lt; m - 1&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i &lt; m - 1&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">with</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;gets_es (?esl1!i) = gets_es (?esl!i)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1">from</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;gets_es (?esl1!Suc i) = gets_es (?esl!Suc i)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1">from</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length ?esl &#10230; 
                                  ?esl!i -ese&#8594; ?esl!(Suc i) &#10230; 
                                  (gets_es (?esl!i), gets_es (?esl!Suc i)) &#8712; rely&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1">with</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(gets_es (?esl!i), gets_es (?esl!Suc i)) &#8712; rely&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_mono</span><span class=""> </span><span class="">Suc_pred</span><span class=""> </span><span class="">a1</span><span class=""> 
</span><span class="">                    </span><span class="">length_take</span><span class=""> </span><span class="">less_SucI</span><span class=""> </span><span class="">less_imp_le_nat</span><span class=""> </span><span class="">min.absorb2</span><span class=""> </span><span class="">nth_take</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1">with</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">              </span><span class="keyword1">next</span><span class="">
</span><span class="">                </span><span class="keyword3">assume</span><span class="">  </span><span class="string">&quot;&#172;(i &lt; m - 1)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">with</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i = m - 1&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">less_antisym</span><span class=""> </span><span class="">p1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1">with</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">              </span><span class="keyword1">qed</span><span class="">
</span><span class="">          </span><span class="keyword1">}</span><span class=""> </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">assume_es_take_n</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;&#10214;m &gt; 0; m &#8804; length esl; esl&#8712;assume_es(pre, rely)&#10215;
        &#10233; take m esl &#8712; assume_es(pre, rely)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m &gt; 0&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m &#8804; length esl&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;assume_es(pre, rely)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">let</span><span class=""> </span><span class="var">?esl1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;take m esl&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">from</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;gets_es (esl!0)&#8712;pre&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">with</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;gets_es (?esl1!0) &#8712; pre&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1">moreover</span><span class="">
</span><span class="">    </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length ?esl1 &#10230; 
           ?esl1!i -ese&#8594; ?esl1!(Suc i) &#10230; (gets_es (?esl1!i), gets_es (?esl1!Suc i)) &#8712; rely&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1">{</span><span class="">
</span><span class="">        </span><span class="keyword3">fix</span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i&lt;length ?esl1&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2">and</span><span class="">  </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl1!i -ese&#8594; ?esl1!(Suc i)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">with</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(gets_es (esl!i), gets_es (esl!Suc i)) &#8712; rely&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1">with</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(gets_es (?esl1!i), gets_es (?esl1!Suc i)) &#8712; rely&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">using</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">length_take</span><span class=""> </span><span class="">min.absorb2</span><span class=""> </span><span class="">nth_take</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">}</span><span class="">
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">ultimately</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">assume_es_drop_n</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;&#10214;m &lt; length esl; esl&#8712;assume_es(pre, rely); gets_es (esl!m) &#8712; pre1&#10215;
        &#10233; drop m esl &#8712; assume_es(pre1, rely)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m &lt; length esl&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;assume_es(pre, rely)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;gets_es (esl!m) &#8712; pre1&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">let</span><span class=""> </span><span class="var">?esl1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;drop m esl&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">from</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;gets_es (?esl1!0) &#8712; pre1&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">hd_conv_nth</span><span class=""> </span><span class="">hd_drop_conv_nth</span><span class=""> </span><span class="">not_less</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword1">moreover</span><span class="">
</span><span class="">    </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length ?esl1 &#10230; 
           ?esl1!i -ese&#8594; ?esl1!(Suc i) &#10230; (gets_es (?esl1!i), gets_es (?esl1!Suc i)) &#8712; rely&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1">{</span><span class="">
</span><span class="">        </span><span class="keyword3">fix</span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i&lt;length ?esl1&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2">and</span><span class="">  </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl1!i -ese&#8594; ?esl1!(Suc i)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">with</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(gets_es (esl!(m+i)), gets_es (esl!Suc (m+i))) &#8712; rely&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">assume_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1">with</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(gets_es (?esl1!i), gets_es (?esl1!Suc i)) &#8712; rely&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">using</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">length_take</span><span class=""> </span><span class="">min.absorb2</span><span class=""> </span><span class="">nth_take</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">}</span><span class="">
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">ultimately</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">commit_es_take_n</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;&#10214;m &gt; 0; m &#8804; length esl; esl&#8712;commit_es(guar, post)&#10215;
        &#10233; take m esl &#8712; commit_es(guar, post)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m &gt; 0&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m &#8804; length esl&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;commit_es(guar, post)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">let</span><span class=""> </span><span class="var">?esl1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;take m esl&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length ?esl1 &#10230; 
           (&#8707;t. ?esl1!i -es-t&#8594; ?esl1!(Suc i)) &#10230; (gets_es (?esl1!i), gets_es (?esl1!Suc i)) &#8712; guar&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1">{</span><span class="">
</span><span class="">        </span><span class="keyword3">fix</span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i&lt;length ?esl1&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2">and</span><span class="">  </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8707;t. ?esl1!i -es-t&#8594; ?esl1!(Suc i))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">with</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(gets_es (esl!i), gets_es (esl!Suc i)) &#8712; guar&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1">with</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(gets_es (?esl1!i), gets_es (?esl1!Suc i)) &#8712; guar&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">using</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">length_take</span><span class=""> </span><span class="">min.absorb2</span><span class=""> </span><span class="">nth_take</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">}</span><span class="">
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">commit_es_drop_n</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;&#10214;m &lt; length esl; esl&#8712;commit_es(guar, post)&#10215;
        &#10233; drop m esl &#8712; commit_es(guar, post)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m &lt; length esl&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;commit_es(guar, post)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">let</span><span class=""> </span><span class="var">?esl1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;drop m esl&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length ?esl1 &#10230; 
           (&#8707;t. ?esl1!i -es-t&#8594; ?esl1!(Suc i)) &#10230; (gets_es (?esl1!i), gets_es (?esl1!Suc i)) &#8712; guar&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1">{</span><span class="">
</span><span class="">        </span><span class="keyword3">fix</span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i&lt;length ?esl1&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2">and</span><span class="">  </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8707;t. ?esl1!i -es-t&#8594; ?esl1!(Suc i))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">with</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(gets_es (esl!(m+i)), gets_es (esl!Suc (m+i))) &#8712; guar&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1">with</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(gets_es (?esl1!i), gets_es (?esl1!Suc i)) &#8712; guar&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">using</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">length_take</span><span class=""> </span><span class="">min.absorb2</span><span class=""> </span><span class="">nth_take</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">}</span><span class="">
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">assume_es_imp</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;pre1&#8838;pre; rely1&#8838;rely; c&#8712;assume_es(pre1,rely1)&#10215; &#10233; c&#8712;assume_es(pre,rely)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;pre1&#8838;pre&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rely1&#8838;rely&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c&#8712;assume_es(pre1,rely1)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;gets_es (c!0) &#8712; pre1 &#8743; (&#8704;i. Suc i&lt;length c &#10230; 
               c!i -ese&#8594; c!(Suc i) &#10230; (gets_es (c!i), gets_es (c!Suc i)) &#8712; rely1)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_es_def</span><span class="delimiter">,</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1">from</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;gets_es (c ! 0) &#8712; pre&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword1">from</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &lt; length c &#10230; c ! i -ese&#8594; c ! Suc i 
                            &#10230; (gets_es (c ! i), gets_es (c ! Suc i)) &#8712; rely&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">commit_es_imp</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;guar1&#8838;guar; post1&#8838;post; c&#8712;commit_es(guar1,post1)&#10215; &#10233; c&#8712;commit_es(guar,post)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;guar1&#8838;guar&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;post1&#8838;post&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c&#8712;commit_es(guar1,post1)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length c &#10230; 
               (&#8707;t. c!i -es-t&#8594; c!(Suc i)) &#10230; (gets_es (c!i), gets_es (c!Suc i)) &#8712; guar1&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1">from</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &lt; length c &#10230; (&#8707;t. c ! i -es-t&#8594; c ! Suc i) 
                            &#10230; (gets_es (c ! i), gets_es (c ! Suc i)) &#8712; guar&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">assume_pes_imp</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;pre1&#8838;pre; rely1&#8838;rely; c&#8712;assume_pes(pre1,rely1)&#10215; &#10233; c&#8712;assume_pes(pre,rely)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;pre1&#8838;pre&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rely1&#8838;rely&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c&#8712;assume_pes(pre1,rely1)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;gets (c!0) &#8712; pre1 &#8743; (&#8704;i. Suc i&lt;length c &#10230; 
               c!i -pese&#8594; c!(Suc i) &#10230; (gets (c!i), gets (c!Suc i)) &#8712; rely1)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_pes_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_pes_def</span><span class="delimiter">,</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1">from</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;gets (c ! 0) &#8712; pre&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword1">from</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &lt; length c &#10230; c ! i -pese&#8594; c ! Suc i 
                            &#10230; (gets (c ! i), gets (c ! Suc i)) &#8712; rely&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">commit_pes_imp</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;guar1&#8838;guar; post1&#8838;post; c&#8712;commit_pes(guar1,post1)&#10215; &#10233; c&#8712;commit_pes(guar,post)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;guar1&#8838;guar&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;post1&#8838;post&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c&#8712;commit_pes(guar1,post1)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length c &#10230; 
               (&#8707;t. c!i -pes-t&#8594; c!(Suc i)) &#10230; (gets (c!i), gets (c!Suc i)) &#8712; guar1&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_pes_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_pes_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1">from</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &lt; length c &#10230; (&#8707;t. c ! i -pes-t&#8594; c ! Suc i) 
                            &#10230; (gets (c ! i), gets (c ! Suc i)) &#8712; guar&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">assume_pes_take_n</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;&#10214;m &gt; 0; m &#8804; length esl; esl&#8712;assume_pes(pre, rely)&#10215;
        &#10233; take m esl &#8712; assume_pes(pre, rely)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m &gt; 0&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m &#8804; length esl&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;assume_pes(pre, rely)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">let</span><span class=""> </span><span class="var">?esl1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;take m esl&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">from</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;gets (esl!0)&#8712;pre&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_pes_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">with</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;gets (?esl1!0) &#8712; pre&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1">moreover</span><span class="">
</span><span class="">    </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length ?esl1 &#10230; 
           ?esl1!i -pese&#8594; ?esl1!(Suc i) &#10230; (gets (?esl1!i), gets (?esl1!Suc i)) &#8712; rely&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1">{</span><span class="">
</span><span class="">        </span><span class="keyword3">fix</span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i&lt;length ?esl1&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2">and</span><span class="">  </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl1!i -pese&#8594; ?esl1!(Suc i)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">with</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(gets (esl!i), gets (esl!Suc i)) &#8712; rely&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_pes_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1">with</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(gets (?esl1!i), gets (?esl1!Suc i)) &#8712; rely&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">using</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">length_take</span><span class=""> </span><span class="">min.absorb2</span><span class=""> </span><span class="">nth_take</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">}</span><span class="">
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">ultimately</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_pes_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">assume_pes_drop_n</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;&#10214;m &lt; length esl; esl&#8712;assume_pes(pre, rely); gets (esl!m) &#8712; pre1&#10215;
        &#10233; drop m esl &#8712; assume_pes(pre1, rely)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m &lt; length esl&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;assume_pes(pre, rely)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;gets (esl!m) &#8712; pre1&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">let</span><span class=""> </span><span class="var">?esl1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;drop m esl&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">from</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;gets (?esl1!0) &#8712; pre1&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">hd_conv_nth</span><span class=""> </span><span class="">hd_drop_conv_nth</span><span class=""> </span><span class="">not_less</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword1">moreover</span><span class="">
</span><span class="">    </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length ?esl1 &#10230; 
           ?esl1!i -pese&#8594; ?esl1!(Suc i) &#10230; (gets (?esl1!i), gets (?esl1!Suc i)) &#8712; rely&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1">{</span><span class="">
</span><span class="">        </span><span class="keyword3">fix</span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i&lt;length ?esl1&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2">and</span><span class="">  </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl1!i -pese&#8594; ?esl1!(Suc i)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">with</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(gets (esl!(m+i)), gets (esl!Suc (m+i))) &#8712; rely&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">assume_pes_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1">with</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(gets (?esl1!i), gets (?esl1!Suc i)) &#8712; rely&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">using</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">length_take</span><span class=""> </span><span class="">min.absorb2</span><span class=""> </span><span class="">nth_take</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">}</span><span class="">
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">ultimately</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_pes_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword2">end</span><span class=""> </span><span class="delimiter">--</span><span class="cartouche">&#8249;theory Validity&#8250;</span></pre>

</div>
</body>
</html>
