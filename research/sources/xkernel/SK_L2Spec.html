<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Theory SK_L2Spec (Isabelle2016: February 2016)</title>
<link media="all" rel="stylesheet" type="text/css" href="isabelle.css"/>
</head>

<body>
<div class="head"><h1>Theory SK_L2Spec</h1>

<span class="command">theory</span> <span class="name">SK_L2Spec</span><br/>
<span class="keyword">imports</span> <a href="SK_TopSpec.html"><span class="name">SK_TopSpec</span></a><br/>

</div>
<div class="source">
<pre class="source"><span class="comment">(*
A refinement based formal specification and information flow security proofs 
for ARINC 653 compliant separation kernels
created by Yongwang ZHAO
School of Computer Science and Engineering, Nanyang Technological University, Singapore
School of Computer Science and Engineering, Beihang University, China
zhaoyongwang@gmail.com, ywzhao@ntu.edu.sg, zhaoyw@buaa.edu.cn
*)</span><span class="">
</span><span class="">
</span><span class="keyword1">section</span><span class=""> </span><span class="verbatim">{* Second-level specification and security proofs *}</span><span class="">
</span><span class="">
</span><span class="keyword1">theory</span><span class=""> </span><span class="">SK_L2Spec</span><span class="">
</span><span class="keyword2">imports</span><span class=""> </span><span class="">SK_SecurityModel</span><span class=""> </span><span class="">SK_TopSpec</span><span class="">
</span><span class="">
</span><span class="keyword2">begin</span><span class="">
</span><span class="">
</span><span class="keyword1">declare</span><span class=""> </span><span class="delimiter">[</span><span class="delimiter">[</span><span class=""> </span><span class="">smt_timeout</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="">90</span><span class=""> </span><span class="delimiter">]</span><span class="delimiter">]</span><span class="">
</span><span class="">
</span><span class="keyword1">subsection</span><span class=""> </span><span class="verbatim">{* Definitions *}</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class=""> </span><span class="verbatim">{* Data type, basic components, and state *}</span><span class="">
</span><span class="">
</span><span class="keyword1">type_synonym</span><span class=""> </span><span class="">process_id</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="">nat</span><span class="">
</span><span class="keyword1">datatype</span><span class=""> </span><span class="">process_state</span><span class=""> </span><span class="delimiter">=</span><span class="">  </span><span class="">DORMANT</span><span class=""> </span><span class="delimiter">|</span><span class=""> </span><span class="">READY</span><span class=""> </span><span class="delimiter">|</span><span class=""> </span><span class="">WAITING</span><span class=""> </span><span class="delimiter">|</span><span class=""> </span><span class="">SUSPEND</span><span class=""> </span><span class="delimiter">|</span><span class=""> </span><span class="">RUNNING</span><span class="">
</span><span class="">
</span><span class="keyword1">type_synonym</span><span class=""> </span><span class="">proc_priority_type</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="">nat</span><span class="">
</span><span class="">
</span><span class="keyword1">record</span><span class=""> </span><span class="">Proc_State</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="">state</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="">process_state</span><span class="">
</span><span class="">                    </span><span class="">priority</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="">proc_priority_type</span><span class="">
</span><span class="">
</span><span class="keyword1">record</span><span class=""> </span><span class="">StateR</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="">State</span><span class=""> </span><span class="delimiter">+</span><span class=""> 
</span><span class="">                </span><span class="">procs</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;partition_id &#8640; (process_id set)&quot;</span><span class="">
</span><span class="">                </span><span class="">cur_proc_part</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;partition_id &#8640; process_id&quot;</span><span class="">
</span><span class="">                </span><span class="">proc_state</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;partition_id &#215; process_id &#8640; Proc_State&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">abstract_state</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;StateR &#8658; State&quot;</span><span class=""> </span><span class="delimiter">(</span><span class="string">&quot;&#8657;_&quot;</span><span class=""> </span><span class="delimiter">[</span><span class="">50</span><span class="delimiter">]</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;abstract_state r = &#10631;current = current r,
                            partitions = partitions r,
                            comm = comm r,
                            part_ports = part_ports r
                           &#10632;&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">abstract_state_rev</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;StateR &#8658; State &#8658; StateR&quot;</span><span class=""> </span><span class="delimiter">(</span><span class="string">&quot;_&#8659;_&quot;</span><span class=""> </span><span class="delimiter">[</span><span class="">50</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;abstract_state_rev r&#39; r = r&#39;&#10631;current := current r,
                            partitions := partitions r,
                            comm := comm r,
                            part_ports := part_ports r&#10632;&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class=""> </span><span class="verbatim">{* Events *}</span><span class="">
</span><span class="">
</span><span class="keyword1">datatype</span><span class=""> </span><span class="">Hypercall&#39;</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="">Create_Sampling_Port</span><span class=""> </span><span class="">port_name</span><span class="">
</span><span class="">                     </span><span class="delimiter">|</span><span class=""> </span><span class="">Write_Sampling_Message</span><span class=""> </span><span class="">port_id</span><span class=""> </span><span class="">Message</span><span class="">
</span><span class="">                     </span><span class="delimiter">|</span><span class=""> </span><span class="">Read_Sampling_Message</span><span class=""> </span><span class="">port_id</span><span class="">
</span><span class="">                     </span><span class="delimiter">|</span><span class=""> </span><span class="">Get_Sampling_Portid</span><span class=""> </span><span class="">port_name</span><span class="">
</span><span class="">                     </span><span class="delimiter">|</span><span class=""> </span><span class="">Get_Sampling_Portstatus</span><span class=""> </span><span class="">port_id</span><span class="">
</span><span class="">                     </span><span class="delimiter">|</span><span class=""> </span><span class="">Create_Queuing_Port</span><span class=""> </span><span class="">port_name</span><span class="">
</span><span class="">                     </span><span class="delimiter">|</span><span class=""> </span><span class="">Send_Queuing_Message</span><span class=""> </span><span class="">port_id</span><span class=""> </span><span class="">Message</span><span class="">
</span><span class="">                     </span><span class="delimiter">|</span><span class=""> </span><span class="">Receive_Queuing_Message</span><span class=""> </span><span class="">port_id</span><span class="">
</span><span class="">                     </span><span class="delimiter">|</span><span class=""> </span><span class="">Get_Queuing_Portid</span><span class=""> </span><span class="">port_name</span><span class="">
</span><span class="">                     </span><span class="delimiter">|</span><span class=""> </span><span class="">Get_Queuing_Portstatus</span><span class=""> </span><span class="">port_id</span><span class="">
</span><span class="">                     </span><span class="delimiter">|</span><span class=""> </span><span class="">Clear_Queuing_Port</span><span class=""> </span><span class="">port_id</span><span class="">
</span><span class="">                     </span><span class="delimiter">|</span><span class=""> </span><span class="">Set_Partition_Mode</span><span class=""> </span><span class="">partition_mode_type</span><span class="">
</span><span class="">                     </span><span class="delimiter">|</span><span class=""> </span><span class="">Get_Partition_Status</span><span class="">
</span><span class="">                     </span><span class="delimiter">|</span><span class=""> </span><span class="">Create_Process</span><span class=""> </span><span class="">proc_priority_type</span><span class="">
</span><span class="">                     </span><span class="delimiter">|</span><span class=""> </span><span class="">Start_Process</span><span class=""> </span><span class="">process_id</span><span class="">
</span><span class="">                     </span><span class="delimiter">|</span><span class=""> </span><span class="">Stop_Process</span><span class=""> </span><span class="">process_id</span><span class="">
</span><span class="">                     </span><span class="delimiter">|</span><span class=""> </span><span class="">Resume_Process</span><span class=""> </span><span class="">process_id</span><span class="">
</span><span class="">                     </span><span class="delimiter">|</span><span class=""> </span><span class="">Suspend_Process</span><span class=""> </span><span class="">process_id</span><span class="">
</span><span class="">                     </span><span class="delimiter">|</span><span class=""> </span><span class="">Set_Priority</span><span class=""> </span><span class="">process_id</span><span class=""> </span><span class="">proc_priority_type</span><span class="">
</span><span class="">                     </span><span class="delimiter">|</span><span class=""> </span><span class="">Get_Process_Status</span><span class=""> </span><span class="">process_id</span><span class="">
</span><span class="">
</span><span class="keyword1">datatype</span><span class=""> </span><span class="">System_EventR</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="">Schedule</span><span class="">
</span><span class="">                        </span><span class="delimiter">|</span><span class=""> </span><span class="">Transfer_Sampling_Message</span><span class=""> </span><span class="">Channel_Type</span><span class="">
</span><span class="">                        </span><span class="delimiter">|</span><span class=""> </span><span class="">Transfer_Queuing_Message</span><span class=""> </span><span class="">Channel_Type</span><span class="">
</span><span class="">                        </span><span class="delimiter">|</span><span class=""> </span><span class="">Schedule_Process</span><span class="">
</span><span class="">
</span><span class="keyword1">datatype</span><span class=""> </span><span class="">EventR</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="">hyperc&#39;</span><span class=""> </span><span class="">Hypercall&#39;</span><span class=""> </span><span class="delimiter">|</span><span class=""> </span><span class="">sys&#39;</span><span class=""> </span><span class="">System_EventR</span><span class=""> 
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{* Event specification *}</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">create_sampling_portR</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Sys_Config &#8658; StateR &#8658; port_name &#8658; (StateR &#215; port_id option)&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;create_sampling_portR sc s p &#8801; let s&#39;= (create_sampling_port sc (&#8657;s) p) in (s&#8659;(fst s&#39;),snd s&#39;)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">write_sampling_messageR</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;StateR &#8658; port_id &#8658; Message &#8658; (StateR &#215; bool)&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;write_sampling_messageR s p m &#8801; let s&#39;= (write_sampling_message (&#8657;s) p m) in (s&#8659;(fst s&#39;),snd s&#39;)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">read_sampling_messageR</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;StateR &#8658; port_id &#8658; (StateR &#215; Message option)&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;read_sampling_messageR s pid &#8801; let s&#39;= (read_sampling_message (&#8657;s) pid) in (s&#8659;(fst s&#39;),snd s&#39;)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">get_sampling_port_idR</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Sys_Config &#8658; StateR &#8658; port_name &#8658; (StateR &#215; port_id option)&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;get_sampling_port_idR sc s pname &#8801; let s&#39;= (get_sampling_port_id sc (&#8657;s) pname) in (s&#8659;(fst s&#39;),snd s&#39;)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">get_sampling_port_statusR</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Sys_Config &#8658; StateR &#8658; port_id &#8658; (StateR &#215; Port_Type option)&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;get_sampling_port_statusR sc s pid &#8801; let s&#39;= (get_sampling_port_status sc (&#8657;s) pid) in (s&#8659;(fst s&#39;),snd s&#39;)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">create_queuing_portR</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Sys_Config &#8658; StateR &#8658; port_name &#8658; (StateR &#215; port_id option)&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;create_queuing_portR sc s p &#8801; let s&#39;= (create_queuing_port sc (&#8657;s) p) in (s&#8659;(fst s&#39;),snd s&#39;)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">send_queuing_message_maylostR</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Sys_Config &#8658; StateR &#8658; port_id &#8658; Message &#8658; (StateR &#215; bool)&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;send_queuing_message_maylostR sc s p m &#8801; 
        let s&#39;= (send_queuing_message_maylost sc (&#8657;s) p m) in (s&#8659;(fst s&#39;),snd s&#39;)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">receive_queuing_messageR</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;StateR &#8658; port_id &#8658; (StateR &#215; Message option)&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;receive_queuing_messageR s pid &#8801; let s&#39;= (receive_queuing_message (&#8657;s) pid) in (s&#8659;(fst s&#39;),snd s&#39;)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">get_queuing_port_idR</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Sys_Config &#8658; StateR &#8658; port_name &#8658; (StateR &#215; port_id option)&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;get_queuing_port_idR sc s pname &#8801; let s&#39;= (get_queuing_port_id sc (&#8657;s) pname) in (s&#8659;(fst s&#39;),snd s&#39;)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">get_queuing_port_statusR</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Sys_Config &#8658; StateR &#8658; port_id &#8658; (StateR &#215; Port_Type option)&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;get_queuing_port_statusR sc s pid &#8801; let s&#39;= (get_queuing_port_status sc (&#8657;s) pid) in (s&#8659;(fst s&#39;),snd s&#39;)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">clear_queuing_portR</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;StateR &#8658; port_id &#8658; StateR&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;clear_queuing_portR s pid &#8801; let s&#39;= (clear_queuing_port (&#8657;s) pid) in (s&#8659;s&#39;)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">setRun2Ready</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;StateR &#8658; StateR&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;setRun2Ready s &#8801; if is_a_partition sysconf (current s) &#8743; cur_proc_part s (current s) &#8800; None then
                      let prs = proc_state s;
                          cur = the ((cur_proc_part s) (current s));
                          stt = the (prs (current s, cur)) in
                       s&#10631;cur_proc_part := ((cur_proc_part s)) (current s := None),
                          proc_state := prs((current s, cur) := Some (stt&#10631;state:=READY&#10632;))&#10632;
                     else s&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">schedule_process</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;StateR &#8658; StateR set&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;schedule_process s &#8801; if is_a_partition sysconf (current s) 
                            &#8743; part_mode (the ((partitions s) (current s))) = NORMAL then
                          (let s&#39; = setRun2Ready s;
                              readyprs = {p. p&#8712;the (procs s&#39; (current s&#39;)) &#8743; 
                                 state (the (proc_state s&#39; (current s&#39;,p))) = READY};
                              selp = SOME p. p&#8712;{x. state (the (proc_state s&#39; (current s&#39;,x))) = READY &#8743;
                                                   (&#8704;y&#8712;readyprs. priority (the (proc_state s&#39; (current s&#39;,x))) &#8805;
                                                                priority (the (proc_state s&#39; (current s&#39;,y))))};
                              st = the ((proc_state s&#39;) (current s&#39;, selp));
                              proc_st = proc_state s&#39;;
                              cur_pr = cur_proc_part s&#39; in
                                  {s&#39;&#10631;proc_state := proc_st ((current s&#39;, selp) := Some (st&#10631;state := RUNNING&#10632;)),
                                     cur_proc_part := cur_pr(current s&#39; := Some selp)&#10632;})
                         else
                          {s}&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">scheduleR</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Sys_Config &#8658; StateR &#8658; StateR set&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;scheduleR sc s &#8801; &#8899;s&#39;&#8712;schedule sc (&#8657;s). {s&#8659;s&#39;}&quot;</span><span class=""> 
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">get_partition_statusR</span><span class=""> </span><span class="delimiter">::</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;Sys_Config &#8658; StateR &#8658; (StateR &#215; (Partition_Conf option) &#215; (Partition_State_Type option))&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">      </span><span class="string">&quot;get_partition_statusR sc s &#8801; let s&#39;= (get_partition_status sc (&#8657;s)) in (s&#8659;(fst s&#39;),snd s&#39;)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">remove_partition_resources</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;StateR &#8658; partition_id &#8658; StateR&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;remove_partition_resources s part &#8801; 
          let proc_state&#39; = (&#955;(pt, p). if pt = part then None else (proc_state s) (pt,p));
              procs&#39; = (procs s)(part := None) in
                s&#10631;procs := procs&#39;, proc_state:=proc_state&#39;&#10632;&quot;</span><span class=""> 
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">set_procs_to_normal</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;StateR &#8658; partition_id &#8658; StateR&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;set_procs_to_normal s part &#8801; if is_a_partition sysconf part then
                                    let prs = proc_state s;
                                        proc_state&#39; = (&#955;(pt, p). 
                                              (let pst = prs (pt,p) in
                                                if pt = part &#8743; state (the pst) = WAITING 
                                                then Some ((the pst)&#10631;state:=READY&#10632;)
                                                else prs (pt,p))) in
                                     s&#10631;proc_state := proc_state&#39;&#10632;
                                   else s&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">set_partition_modeR</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Sys_Config &#8658; StateR &#8658; partition_mode_type &#8658; StateR&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;set_partition_modeR sc s m &#8801; 
      (if (partconf sc) (current s) &#8800; None &#8743; (partitions s) (current s) &#8800; None &#8743;
          &#172; (part_mode (the ((partitions s) (current s))) = COLD_START &#8743; m = WARM_START) then
        let pts = partitions s;
            pstate = the (pts (current s));
            s&#39; = (if m = NORMAL then 
                    set_procs_to_normal s (current s) 
                  else if part_mode (the ((partitions s) (current s))) = NORMAL then
                    remove_partition_resources s (current s) 
                  else s )
        in s&#39;&#10631;partitions := pts(current s&#39; := Some (pstate&#10631;part_mode := m&#10632;))&#10632;
      else
        s)&quot;</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">transf_sampling_msgR</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;StateR &#8658; Channel_Type &#8658; StateR&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;transf_sampling_msgR s c &#8801; 
          let s&#39;= (transf_sampling_msg (&#8657;s) c) in (s&#8659;s&#39;)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">transf_queuing_msg_maylostR</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Sys_Config &#8658; StateR &#8658; Channel_Type &#8658; StateR&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;transf_queuing_msg_maylostR sc s c &#8801;
          let s&#39;= (transf_queuing_msg_maylost sc (&#8657;s) c) in (s&#8659;s&#39;)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">create_process</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;StateR &#8658; proc_priority_type &#8658; (StateR &#215; process_id option)&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;create_process s pri &#8801; if part_mode (the ((partitions s) (current s))) = WARM_START 
                            &#8744; part_mode (the ((partitions s) (current s))) = COLD_START
                           then 
                            let pid = (SOME p. p &#8713; the ((procs s) (current s)));
                                procs&#39; = (procs s) ((current s) := Some ((the ((procs s) (current s))) &#8746; {pid}));
                                proc_state&#39; = (proc_state s) ((current s,pid) := Some &#10631;state = DORMANT, priority = pri&#10632;) in
                            (s&#10631;procs:=procs&#39;, proc_state:=proc_state&#39;&#10632;, Some pid)
                           else (s, None)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">set_process_priority</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;StateR &#8658; process_id &#8658; proc_priority_type &#8658; StateR&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;set_process_priority s p pri &#8801; 
        if (proc_state s) (current s, p) &#8800; None &#8743; (state (the ((proc_state s) (current s, p)))) &#8800; DORMANT then
            let st = state (the ((proc_state s) (current s, p)));
                proc_state&#39; = (proc_state s) ((current s,p) := Some &#10631;state = st, priority = pri&#10632;) in
                s&#10631;proc_state:=proc_state&#39;&#10632;
         else s&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">start_process</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;StateR &#8658; process_id &#8658; StateR&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;start_process s p &#8801; if p &#8712; the ((procs s) (current s)) &#8743; (proc_state s) (current s, p) &#8800; None 
                        &#8743; (state (the ((proc_state s) (current s, p)))) = DORMANT then
                          let st = (if part_mode (the ((partitions s) (current s))) = NORMAL
                                    then READY 
                                    else WAITING);
                              pst = (the ((proc_state s) (current s, p)));
                              proc_state&#39; = (proc_state s) ((current s, p) := Some (pst &#10631;state := st&#10632;)) in
                                s&#10631;proc_state:=proc_state&#39;&#10632;
                        else s&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">stop_process</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;StateR &#8658; process_id &#8658; StateR&quot;</span><span class=""> </span><span class="keyword2">where</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;stop_process s p &#8801; if p &#8712; the ((procs s) (current s)) &#8743; (proc_state s) (current s, p) &#8800; None 
                        &#8743; (state (the ((proc_state s) (current s, p)))) &#8800; DORMANT then
                         let pri = priority (the ((proc_state s) (current s, p)));
                             proc_state&#39; = (proc_state s) ((current s, p) := Some &#10631;state = DORMANT,priority = pri&#10632;) in
                                s&#10631;proc_state:=proc_state&#39;&#10632;
                       else s&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">suspend_process</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;StateR &#8658; process_id &#8658; StateR&quot;</span><span class=""> </span><span class="keyword2">where</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;suspend_process s p &#8801; if p &#8712; the ((procs s) (current s)) &#8743; (proc_state s) (current s, p) &#8800; None 
                           &#8743; (state (the ((proc_state s) (current s, p)))) &#8800; DORMANT
                           &#8743; (state (the ((proc_state s) (current s, p)))) &#8800; SUSPEND then
                           let pri = priority (the ((proc_state s) (current s, p)));
                             proc_state&#39; = (proc_state s) ((current s, p) := Some &#10631;state = SUSPEND,priority = pri&#10632;) in
                                s&#10631;proc_state:=proc_state&#39;&#10632;
                          else s&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">resume_process</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;StateR &#8658; process_id &#8658; StateR&quot;</span><span class=""> </span><span class="keyword2">where</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;resume_process s p &#8801; if p &#8712; the ((procs s) (current s)) &#8743; (proc_state s) (current s, p) &#8800; None 
                           &#8743; (state (the ((proc_state s) (current s, p)))) = SUSPEND then
                           let pri = priority (the ((proc_state s) (current s, p)));
                               proc_state&#39; = (proc_state s) ((current s, p) := Some &#10631;state = READY,priority = pri&#10632;) in
                                  s&#10631;proc_state:=proc_state&#39;&#10632;
                          else s&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">get_process_status</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;StateR &#8658; process_id &#8658; (StateR &#215; (Proc_State option))&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;get_process_status s p &#8801; (s,(proc_state s) (current s, p))&quot;</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">system_initR</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Sys_Config &#8658; StateR&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;system_initR sc &#8801; let s0 = system_init sc in 
                              &#10631;current = current s0,
                                partitions = partitions s0,
                                comm = comm s0,
                                part_ports = part_ports s0,
                                procs = (&#955; x. None),
                                cur_proc_part = (&#955; x. None),
                                proc_state = (&#955; x. None)
                               &#10632;&quot;</span><span class="">
</span><span class="keyword1">declare</span><span class=""> </span><span class="">abstract_state_def</span><span class="delimiter">[</span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">abstract_state_rev_def</span><span class="delimiter">[</span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> 
</span><span class="">        </span><span class="">create_sampling_portR_def</span><span class=""> </span><span class="delimiter">[</span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">write_sampling_messageR_def</span><span class="delimiter">[</span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class="">
</span><span class="">        </span><span class="">read_sampling_messageR_def</span><span class="delimiter">[</span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">get_sampling_port_idR_def</span><span class="delimiter">[</span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class="">
</span><span class="">        </span><span class="">get_sampling_port_statusR_def</span><span class="delimiter">[</span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">create_queuing_portR_def</span><span class="delimiter">[</span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class="">
</span><span class="">        </span><span class="">send_queuing_message_maylostR_def</span><span class="delimiter">[</span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">receive_queuing_messageR_def</span><span class="delimiter">[</span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class="">
</span><span class="">        </span><span class="">get_queuing_port_idR_def</span><span class="delimiter">[</span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">get_queuing_port_statusR_def</span><span class="delimiter">[</span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class="">
</span><span class="">        </span><span class="">clear_queuing_portR_def</span><span class="delimiter">[</span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">setRun2Ready_def</span><span class="delimiter">[</span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">schedule_process_def</span><span class="delimiter">[</span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class="">
</span><span class="">        </span><span class="">scheduleR_def</span><span class="delimiter">[</span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">get_partition_statusR_def</span><span class="delimiter">[</span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">remove_partition_resources_def</span><span class="delimiter">[</span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class="">
</span><span class="">        </span><span class="">set_procs_to_normal_def</span><span class="delimiter">[</span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">set_partition_modeR_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">transf_sampling_msgR_def</span><span class="delimiter">[</span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class="">
</span><span class="">        </span><span class="">transf_queuing_msg_maylostR_def</span><span class="delimiter">[</span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">create_process_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">set_process_priority_def</span><span class="delimiter">[</span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class="">
</span><span class="">        </span><span class="">start_process_def</span><span class="delimiter">[</span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">stop_process_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">suspend_process_def</span><span class="delimiter">[</span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> 
</span><span class="">        </span><span class="">resume_process_def</span><span class="delimiter">[</span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class="">  </span><span class="keyword2">and</span><span class=""> </span><span class="">get_process_status_def</span><span class="delimiter">[</span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">set_partition_mode_def</span><span class="delimiter">[</span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class="">
</span><span class="">
</span><span class="keyword1">declare</span><span class=""> </span><span class="">abstract_state_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">abstract_state_rev_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> 
</span><span class="">        </span><span class="">create_sampling_portR_def</span><span class=""> </span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">write_sampling_messageR_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class="">
</span><span class="">        </span><span class="">read_sampling_messageR_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">get_sampling_port_idR_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class="">
</span><span class="">        </span><span class="">get_sampling_port_statusR_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">create_queuing_portR_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class="">
</span><span class="">        </span><span class="">send_queuing_message_maylostR_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">receive_queuing_messageR_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class="">
</span><span class="">        </span><span class="">get_queuing_port_idR_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">get_queuing_port_statusR_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class="">
</span><span class="">        </span><span class="">clear_queuing_portR_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">setRun2Ready_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">schedule_process_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class="">
</span><span class="">        </span><span class="">scheduleR_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">get_partition_statusR_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">remove_partition_resources_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class="">
</span><span class="">        </span><span class="">set_procs_to_normal_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">set_partition_modeR_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">transf_sampling_msgR_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class="">
</span><span class="">        </span><span class="">transf_queuing_msg_maylostR_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">create_process_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">set_process_priority_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class="">
</span><span class="">        </span><span class="">start_process_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">stop_process_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">suspend_process_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> 
</span><span class="">        </span><span class="">resume_process_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">get_process_status_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">set_partition_mode_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">schedule_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class="">
</span><span class="">
</span><span class="keyword1">subsection</span><span class="verbatim">{* Instantiation and Its Proofs of Security Model  *}</span><span class="">
</span><span class="">
</span><span class="keyword1">consts</span><span class=""> </span><span class="">s0r</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="">StateR</span><span class="">
</span><span class="">
</span><span class="keyword1">specification</span><span class=""> </span><span class="delimiter">(</span><span class="">s0r</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="">s0r_init</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;s0r = system_initR sysconf&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="keyword1">primrec</span><span class=""> </span><span class="">event_enabledR</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;StateR &#8658; EventR &#8658; bool&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">where</span><span class=""> </span><span class="">event_enabledR_hc</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;event_enabledR s (hyperc&#39; h) = (is_a_partition sysconf (current s) 
                                        &#8743; part_mode (the (partitions s (current s))) &#8800; IDLE)&quot;</span><span class=""> </span><span class="delimiter">|</span><span class="">
</span><span class="">          </span><span class="">event_enabledR_sys</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;event_enabledR s (sys&#39; h) =  (case h of Schedule &#8658; True |
                                                 Transfer_Sampling_Message c &#8658; (current s = transmitter sysconf) |
                                                 Transfer_Queuing_Message c &#8658; (current s = transmitter sysconf) |
                                                 Schedule_Process &#8658; (is_a_partition sysconf (current s) 
                                                              &#8743; part_mode (the (partitions s (current s))) = NORMAL))&quot;</span><span class=""> 
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">exec_eventR</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;EventR &#8658; (StateR &#215; StateR) set&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;exec_eventR e = {(s,s&#39;). s&#39;&#8712; (if event_enabledR s e then (
      case e of hyperc&#39; (Create_Sampling_Port pname) &#8658; {fst (create_sampling_portR sysconf s pname)} |
                hyperc&#39; (Write_Sampling_Message p m) &#8658; {fst (write_sampling_messageR s p m)} |
                hyperc&#39; (Read_Sampling_Message p) &#8658; {fst (read_sampling_messageR s p)} |
                hyperc&#39; (Get_Sampling_Portid pname) &#8658; {fst (get_sampling_port_idR sysconf s pname)} |
                hyperc&#39; (Get_Sampling_Portstatus p) &#8658; {fst (get_sampling_port_statusR sysconf s p)} |
                hyperc&#39; (Create_Queuing_Port pname) &#8658; {fst (create_queuing_portR sysconf s pname)} |
                hyperc&#39; (Send_Queuing_Message p m) &#8658; {fst (send_queuing_message_maylostR sysconf s p m)} |
                hyperc&#39; (Receive_Queuing_Message p) &#8658; {fst (receive_queuing_messageR s p)} |
                hyperc&#39; (Get_Queuing_Portid pname) &#8658; {fst (get_queuing_port_idR sysconf s pname)} |
                hyperc&#39; (Get_Queuing_Portstatus p) &#8658; {fst (get_queuing_port_statusR sysconf s p)} |
                hyperc&#39; (Clear_Queuing_Port p) &#8658; {clear_queuing_portR s p} |
                hyperc&#39; (Set_Partition_Mode m) &#8658; {set_partition_modeR sysconf s m} |
                hyperc&#39; (Get_Partition_Status) &#8658; {fst (get_partition_statusR sysconf s)} |
                hyperc&#39; (Create_Process pri) &#8658; {fst (create_process s pri)} |
                hyperc&#39; (Start_Process p) &#8658; {start_process s p} |
                hyperc&#39; (Stop_Process p) &#8658; {stop_process s p} |
                hyperc&#39; (Resume_Process p) &#8658; {resume_process s p} |
                hyperc&#39; (Suspend_Process p) &#8658; {suspend_process s p} |
                hyperc&#39; (Set_Priority p pri) &#8658; {set_process_priority s p pri} |
                hyperc&#39; (Get_Process_Status p) &#8658; {fst (get_process_status s p)} |
                sys&#39; Schedule &#8658; scheduleR sysconf s |
                sys&#39; (Transfer_Sampling_Message c) &#8658; {transf_sampling_msgR s c} |
                sys&#39; (Transfer_Queuing_Message c) &#8658; {transf_queuing_msg_maylostR sysconf s c} |
                sys&#39; (Schedule_Process) &#8658; schedule_process s )
                    else {s})}&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">eR</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;EventR &#8658; Event option&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;eR e &#8801; 
      case e of hyperc&#39; (Create_Sampling_Port pname) &#8658; Some (hyperc (Hypercall.Create_Sampling_Port pname)) |
                hyperc&#39; (Write_Sampling_Message p m) &#8658; Some (hyperc (Hypercall.Write_Sampling_Message p m)) |
                hyperc&#39; (Read_Sampling_Message p) &#8658; Some (hyperc (Hypercall.Read_Sampling_Message p)) |
                hyperc&#39; (Get_Sampling_Portid pname) &#8658; Some (hyperc (Hypercall.Get_Sampling_Portid pname)) |
                hyperc&#39; (Get_Sampling_Portstatus p) &#8658; Some (hyperc (Hypercall.Get_Sampling_Portstatus p)) |
                hyperc&#39; (Create_Queuing_Port pname) &#8658; Some (hyperc (Hypercall.Create_Queuing_Port pname)) |
                hyperc&#39; (Send_Queuing_Message p m) &#8658; Some (hyperc (Hypercall.Send_Queuing_Message p m)) |
                hyperc&#39; (Receive_Queuing_Message p) &#8658; Some (hyperc (Hypercall.Receive_Queuing_Message p)) |
                hyperc&#39; (Get_Queuing_Portid pname) &#8658; Some (hyperc (Hypercall.Get_Queuing_Portid pname)) |
                hyperc&#39; (Get_Queuing_Portstatus p) &#8658; Some (hyperc (Hypercall.Get_Queuing_Portstatus p)) |
                hyperc&#39; (Clear_Queuing_Port p) &#8658; Some (hyperc (Hypercall.Clear_Queuing_Port p)) |
                hyperc&#39; (Set_Partition_Mode m) &#8658; Some (hyperc (Hypercall.Set_Partition_Mode m)) |
                hyperc&#39; (Get_Partition_Status) &#8658; Some (hyperc (Hypercall.Get_Partition_Status)) |
                hyperc&#39; (Create_Process pri) &#8658; None |
                hyperc&#39; (Start_Process p) &#8658; None |
                hyperc&#39; (Stop_Process p) &#8658; None |
                hyperc&#39; (Resume_Process p) &#8658; None |
                hyperc&#39; (Suspend_Process p) &#8658; None |
                hyperc&#39; (Set_Priority p pri) &#8658; None |
                hyperc&#39; (Get_Process_Status p) &#8658; None |
                sys&#39; Schedule &#8658;  Some (sys (System_Event.Schedule)) |
                sys&#39; (Transfer_Sampling_Message c) &#8658; Some (sys (System_Event.Transfer_Sampling_Message c)) |
                sys&#39; (Transfer_Queuing_Message c) &#8658; Some (sys (System_Event.Transfer_Queuing_Message c)) |
                sys&#39; (Schedule_Process) &#8658; None &quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">primrec</span><span class=""> </span><span class="">domain_of_eventR</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;StateR &#8658; EventR &#8658; domain_id option&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="">domain_of_eventR_hc</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;domain_of_eventR s (hyperc&#39; h) = Some (current s)&quot;</span><span class=""> </span><span class="delimiter">|</span><span class="">
</span><span class="">        </span><span class="">domain_of_eventR_sys</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;domain_of_eventR s (sys&#39; h) =  (case h of Schedule &#8658; Some (scheduler sysconf) |
                                                 Transfer_Sampling_Message c &#8658; Some (transmitter sysconf) |
                                                 Transfer_Queuing_Message c &#8658; Some (transmitter sysconf) |
                                                 Schedule_Process &#8658; Some (current s) )&quot;</span><span class=""> 
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">domain_domainR</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;eR e &#8800; None &#10233; domain_of_eventR s e = domain_of_event (&#8657;s) (the (eR e))&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">e</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">hyperc&#39;</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">qed</span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">eR_def</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">          
</span><span class="">  </span><span class="keyword1">next</span><span class="">
</span><span class="">    </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">sys&#39;</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> 
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">qed</span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">eR_def</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">    
</span><span class="keyword1">definition</span><span class=""> </span><span class="">vpeq_part_procs</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;StateR &#8658; domain_id &#8658; StateR &#8658; bool&quot;</span><span class=""> </span><span class="delimiter">(</span><span class="string">&quot;(_ &#8764;. _ .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> _)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;vpeq_part_procs s d t &#8801; if is_a_partition sysconf d then 
                                      ((procs s) d = (procs t) d) &#8743;
                                      (&#8704;p. (proc_state s) (d,p) = (proc_state t) (d,p)) &#8743;
                                      (cur_proc_part s) d = (cur_proc_part t) d 
                                  else True&quot;</span><span class=""> 
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">vpeq_part_procs_transitive_lemma</span><span class=""> </span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;&#8704; s t r d. (vpeq_part_procs s d t) &#8743; (vpeq_part_procs t d r) &#10230; (vpeq_part_procs s d r)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">vpeq_part_procs_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">vpeq_part_procs_symmetric_lemma</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704; s t d. (vpeq_part_procs s d t) &#10230; (vpeq_part_procs t d s)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">vpeq_part_procs_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">vpeq_part_procs_reflexive_lemma</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704; s d. (vpeq_part_procs s d s)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">vpeq_part_procs_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">vpeqR</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;StateR &#8658; domain_id &#8658; StateR &#8658; bool&quot;</span><span class=""> </span><span class="delimiter">(</span><span class="string">&quot;(_ &#8764;. _ .&#8764; _)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;vpeqR s d t &#8801;  ((&#8657;s) &#8764;d&#8764; (&#8657;t)) &#8743; (s&#8764;.d.&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub>t)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">declare</span><span class=""> </span><span class="">vpeqR_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">vpeq_part_procs_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">vpeqR_transitive_lemma</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704; s t r d. (vpeqR s d t) &#8743; (vpeqR t d r) &#10230; (vpeqR s d r)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">vpeq1_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">vpeq1_transitive_lemma</span><span class=""> </span><span class="">vpeq_part_procs_transitive_lemma</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">vpeqR_symmetric_lemma</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704; s t d. (vpeqR s d t) &#10230; (vpeqR t d s)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">vpeq1_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">vpeq1_symmetric_lemma</span><span class=""> </span><span class="">vpeq_part_procs_symmetric_lemma</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">vpeqR_reflexive_lemma</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704; s d. (vpeqR s d s)&quot;</span><span class="">  
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">vpeq1_reflexive_lemma</span><span class=""> </span><span class="">vpeq_part_procs_reflexive_lemma</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">vpeqR_vpeq1</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;vpeqR s d t &#10233; vpeq1 (&#8657;s) d (&#8657;t)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">sched_currentR_lemma</span><span class=""> </span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;&#8704;s t a. vpeqR s (scheduler sysconf) t &#10230; (domain_of_eventR s a) = (domain_of_eventR t a)&quot;</span><span class="">  
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">vpeqR_def</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="">abstract_state_def</span><span class=""> </span><span class="">vpeq_sched_def</span><span class=""> 
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">EventR.exhaust</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">domain_of_eventR.simps</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">scheproc_hasnexts</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;schedule_process s &#8800; {}&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;is_a_partition sysconf (current s) &#8743; part_mode (the ((partitions s) (current s))) = NORMAL&quot;</span><span class="delimiter">)</span><span class="">    
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">reachable_l2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;s a. (SM.reachable0 s0r exec_eventR) s &#10230; (&#8707;s&#39;. (s, s&#39;) &#8712; exec_eventR a)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1">{</span><span class="">
</span><span class="">    </span><span class="keyword3">fix</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">a</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(SM.reachable0 s0r exec_eventR) s&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8707;s&#39;. (s, s&#39;) &#8712; exec_eventR a&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">a</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">hyperc&#39;</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> 
</span><span class="">          </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">qed</span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">exec_eventR_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">sys&#39;</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Schedule</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">exec_eventR_def</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">            </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Transfer_Sampling_Message</span><span class=""> </span><span class="">c</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">exec_eventR_def</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">            </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Transfer_Queuing_Message</span><span class=""> </span><span class="">c</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">exec_eventR_def</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">            </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Schedule_Process</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">scheproc_hasnexts</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">          </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">        
</span><span class="">  </span><span class="keyword1">}</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">interpretation</span><span class=""> </span><span class="">SM_enabled</span><span class=""> 
</span><span class="">    </span><span class="">s0r</span><span class=""> </span><span class="">exec_eventR</span><span class=""> </span><span class="">domain_of_eventR</span><span class=""> </span><span class="string">&quot;scheduler sysconf&quot;</span><span class=""> </span><span class="">vpeqR</span><span class=""> </span><span class="">interference1</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">vpeqR_transitive_lemma</span><span class=""> </span><span class="">vpeqR_symmetric_lemma</span><span class=""> </span><span class="">vpeqR_reflexive_lemma</span><span class=""> </span><span class="">sched_currentR_lemma</span><span class="">
</span><span class="">        </span><span class="">schedeler_intf_all_help</span><span class=""> </span><span class="">no_intf_sched_help</span><span class=""> </span><span class="">reachable_l2</span><span class=""> </span><span class="">nintf_reflx</span><span class="">
</span><span class="">        </span><span class="">SM.intro</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">vpeqR</span><span class=""> </span><span class="string">&quot;scheduler sysconf&quot;</span><span class=""> </span><span class="">domain_of_eventR</span><span class=""> </span><span class="">interference1</span><span class="delimiter">]</span><span class="">
</span><span class="">        </span><span class="">SM_enabled_axioms.intro</span><span class=""> </span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">s0r</span><span class=""> </span><span class="">exec_eventR</span><span class="delimiter">]</span><span class="">
</span><span class="">        </span><span class="">SM_enabled.intro</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">domain_of_eventR</span><span class=""> </span><span class="string">&quot;scheduler sysconf&quot;</span><span class=""> </span><span class="">vpeqR</span><span class=""> </span><span class="">interference1</span><span class=""> </span><span class="">s0r</span><span class=""> </span><span class="">exec_eventR</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">
</span><span class="keyword1">subsection</span><span class="verbatim">{* Unwinding conditions on new state variables *}</span><span class="">
</span><span class="">  </span><span class="keyword1">definition</span><span class=""> </span><span class="">weak_step_consistent_new</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;bool&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">    </span><span class="string">&quot;weak_step_consistent_new &#8801; &#8704;a d s t. reachable0 s &#8743; reachable0 t &#8743; (s &#8764;. d .&#8764; t) &#8743; (s &#8764;. (scheduler sysconf) .&#8764; t) &#8743; 
                            ((the (domain_of_eventR s a)) &#8605; d) &#8743; (s &#8764;. (the (domain_of_eventR s a)) .&#8764; t) &#10230;
                            (&#8704; s&#39; t&#39;. (s,s&#39;) &#8712; exec_eventR a &#8743; (t,t&#39;) &#8712; exec_eventR a &#10230; (s&#39; &#8764;.d.&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> t&#39;))&quot;</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">definition</span><span class=""> </span><span class="">step_consistent_new</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;bool&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">    </span><span class="string">&quot;step_consistent_new &#8801; &#8704;a d s t. reachable0 s &#8743; reachable0 t &#8743; (s &#8764;. d .&#8764; t) &#8743; (s &#8764;. (scheduler sysconf) .&#8764; t) &#8743; 
                            ((the (domain_of_eventR s a)) &#8605; d) &#10230; (s &#8764;. (the (domain_of_eventR s a)) .&#8764; t) &#10230;
                            (&#8704; s&#39; t&#39;. (s,s&#39;) &#8712; exec_eventR a &#8743; (t,t&#39;) &#8712; exec_eventR a &#10230; (s&#39; &#8764;.d.&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> t&#39;))&quot;</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">definition</span><span class=""> </span><span class="">local_respect_new</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;bool&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">    </span><span class="string">&quot;local_respect_new &#8801; &#8704; a d s s&#39;. reachable0 s &#8743; ((the (domain_of_eventR s a)) &#8726;&#8605; d) &#8743; (s,s&#39;)&#8712;exec_eventR a 
                                    &#10230; (s &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> s&#39;)&quot;</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">definition</span><span class=""> </span><span class="">weak_step_consistent_new_e</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;EventR &#8658; bool&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">    </span><span class="string">&quot;weak_step_consistent_new_e a &#8801; &#8704;d s t. reachable0 s &#8743; reachable0 t &#8743; (s &#8764;. d .&#8764; t) &#8743; (s &#8764;. (scheduler sysconf) .&#8764; t) &#8743; 
                            ((the (domain_of_eventR s a)) &#8605; d) &#8743; (s &#8764;. (the (domain_of_eventR s a)) .&#8764; t) &#10230;
                            (&#8704; s&#39; t&#39;. (s,s&#39;) &#8712; exec_eventR a &#8743; (t,t&#39;) &#8712; exec_eventR a &#10230; (s&#39; &#8764;.d.&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> t&#39;))&quot;</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">definition</span><span class=""> </span><span class="">step_consistent_new_e</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;EventR &#8658; bool&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">    </span><span class="string">&quot;step_consistent_new_e a &#8801; &#8704;d s t. reachable0 s &#8743; reachable0 t &#8743; (s &#8764;. d .&#8764; t) &#8743; (s &#8764;. (scheduler sysconf) .&#8764; t) &#8743; 
                            ((the (domain_of_eventR s a)) &#8605; d) &#10230; (s &#8764;. (the (domain_of_eventR s a)) .&#8764; t) &#10230;
                            (&#8704; s&#39; t&#39;. (s,s&#39;) &#8712; exec_eventR a &#8743; (t,t&#39;) &#8712; exec_eventR a &#10230; (s&#39; &#8764;.d.&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> t&#39;))&quot;</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">definition</span><span class=""> </span><span class="">local_respect_new_e</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;EventR &#8658; bool&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">    </span><span class="string">&quot;local_respect_new_e a &#8801; &#8704;d s s&#39;. reachable0 s &#8743; ((the (domain_of_eventR s a)) &#8726;&#8605; d) &#8743; (s,s&#39;)&#8712;exec_eventR a 
                                    &#10230; (s &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> s&#39;)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">declare</span><span class=""> </span><span class="">weak_step_consistent_new_def</span><span class="delimiter">[</span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">step_consistent_new_def</span><span class="delimiter">[</span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">local_respect_new_def</span><span class="delimiter">[</span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class="">
</span><span class="">        </span><span class="">weak_step_consistent_new_e_def</span><span class="delimiter">[</span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">step_consistent_new_e_def</span><span class="delimiter">[</span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">local_respect_new_e_def</span><span class="delimiter">[</span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class=""> 
</span><span class="">
</span><span class="keyword1">declare</span><span class=""> </span><span class="">weak_step_consistent_new_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">step_consistent_new_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">local_respect_new_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class="">
</span><span class="">        </span><span class="">weak_step_consistent_new_e_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">step_consistent_new_e_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">local_respect_new_e_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> 
</span><span class="">
</span><span class="keyword1">declare</span><span class=""> </span><span class="">weak_step_consistent_new_def</span><span class="delimiter">[</span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">step_consistent_new_def</span><span class="delimiter">[</span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">local_respect_new_def</span><span class="delimiter">[</span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class="">
</span><span class="">        </span><span class="">weak_step_consistent_new_e_def</span><span class="delimiter">[</span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">step_consistent_new_e_def</span><span class="delimiter">[</span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">local_respect_new_e_def</span><span class="delimiter">[</span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">weak_step_consistent_new_all_evt</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;weak_step_consistent_new = (&#8704;a. weak_step_consistent_new_e a)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">weak_step_consistent_new_def</span><span class=""> </span><span class="">weak_step_consistent_new_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">step_consistent_new_all_evt</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;step_consistent_new = (&#8704;a. step_consistent_new_e a)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">step_consistent_new_def</span><span class=""> </span><span class="">step_consistent_new_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">local_respect_new_all_evt</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;local_respect_new = (&#8704;a. local_respect_new_e a)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">local_respect_new_def</span><span class=""> </span><span class="">local_respect_new_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">subsection</span><span class="verbatim">{* Proofs of refinement *}</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{* Refinement of existing events at upper level *}</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">create_sampling_port_ref_lemma</span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;&#8704;s. fst (create_sampling_port sc (&#8657;s) p) = &#8657;(fst (create_sampling_portR sc s p))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">write_sampling_message_ref_lemma</span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;&#8704;s. fst (write_sampling_message (&#8657;s) p m) = &#8657;(fst (write_sampling_messageR s p m))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">read_sampling_message_ref_lemma</span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;&#8704;s. fst (read_sampling_message (&#8657;s) p) = &#8657;(fst (read_sampling_messageR s p))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_sampling_port_id_ref_lemma</span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;&#8704;s. fst (get_sampling_port_id sc (&#8657;s) p) = &#8657;(fst (get_sampling_port_idR sc s p))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_sampling_port_status_ref_lemma</span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;&#8704;s. fst (get_sampling_port_status sc (&#8657;s) p) = &#8657;(fst (get_sampling_port_statusR sc s p))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">create_queuing_port_ref_lemma</span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;&#8704;s. fst (create_queuing_port sc (&#8657;s) p) = &#8657;(fst (create_queuing_portR sc s p))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">send_queuing_message_maylost_ref_lemma</span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;&#8704;s. fst (send_queuing_message_maylost sc (&#8657;s) p m) = &#8657;(fst (send_queuing_message_maylostR sc s p m))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class=""> 
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">receive_queuing_message_ref_lemma</span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;&#8704;s. fst (receive_queuing_message (&#8657;s) p) = &#8657;(fst (receive_queuing_messageR s p))&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_queuing_port_id_ref_lemma</span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;&#8704;s. fst (get_queuing_port_id sc (&#8657;s) p) = &#8657;(fst (get_queuing_port_idR sc s p))&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_queuing_port_status_ref_lemma</span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;&#8704;s. fst (get_queuing_port_status sc (&#8657;s) p) = &#8657;(fst (get_queuing_port_statusR sc s p))&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">clear_queuing_port_ref_lemma</span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;&#8704;s. clear_queuing_port (&#8657;s) p = &#8657;(clear_queuing_portR s p)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">schedule_ref_lemma</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;s s&#39;. (s&#39; &#8712; scheduleR sc s) &#10230; (&#8657;s&#39;) &#8712; (schedule sc (&#8657;s))&quot;</span><span class="">
</span><span class="">     </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_partition_status_ref_lemma</span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;&#8704;s. fst (get_partition_status sc (&#8657;s)) = &#8657;(fst (get_partition_statusR sc s))&quot;</span><span class="">
</span><span class="">     </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">set_partition_mode_ref_lemma</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;s. set_partition_mode sc (&#8657;s) m = &#8657;(set_partition_modeR sc s m)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword1">{</span><span class="">
</span><span class="">      </span><span class="keyword3">fix</span><span class=""> </span><span class="">s</span><span class="">
</span><span class="">      </span><span class="keyword1">let</span><span class=""> </span><span class="var">?s&#39;</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;set_partition_modeR sc s m&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">let</span><span class=""> </span><span class="var">?us&#39;</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;&#8657;(?s&#39;)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">let</span><span class=""> </span><span class="var">?t</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;&#8657;s&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">let</span><span class=""> </span><span class="var">?t&#39;</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;set_partition_mode sc ?t m&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;current ?t&#39; = current ?us&#39;&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1">using</span><span class=""> </span><span class="">set_partition_mode_def</span><span class=""> 
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">moreover</span><span class="">
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;partitions ?t&#39; = partitions ?us&#39;&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;partitions s = partitions ?t &#8743; current s = current ?t&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">          </span><span class="keyword1">{</span><span class="">
</span><span class="">            </span><span class="keyword3">fix</span><span class=""> </span><span class="">p</span><span class="">
</span><span class="">            </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;partitions ?t&#39; p = partitions ?us&#39; p&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;(partconf sc) (current s) &#8800; None &#8743; (partitions s) (current s) &#8800; None &#8743;
                    &#172; (part_mode (the ((partitions s) (current s))) = COLD_START &#8743; m = WARM_START)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(partconf sc) (current s) &#8800; None &#8743; (partitions s) (current s) &#8800; None &#8743;
                    &#172; (part_mode (the ((partitions s) (current s))) = COLD_START &#8743; m = WARM_START)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">with</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(partconf sc) (current ?t) &#8800; None &#8743; (partitions ?t) (current ?t) &#8800; None &#8743;
                    &#172; (part_mode (the ((partitions ?t) (current ?t))) = COLD_START &#8743; m = WARM_START)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;current ?t = p&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword3">assume</span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;current ?t = p&quot;</span><span class="">                      
</span><span class="">                    </span><span class="keyword1">with</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;partitions ?t&#39; p = Some ((the (partitions ?t p)) &#10631;part_mode := m&#10632;)&quot;</span><span class=""> 
</span><span class="">                      </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                    </span><span class="keyword1">moreover</span><span class="">
</span><span class="">                    </span><span class="keyword1">from</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;partitions ?s&#39; p = Some ((the (partitions s p)) &#10631;part_mode := m&#10632;)&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1">ultimately</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">set_partition_mode_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1">next</span><span class="">
</span><span class="">                    </span><span class="keyword3">assume</span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;current ?t &#8800; p&quot;</span><span class="">                    
</span><span class="">                    </span><span class="keyword1">with</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;partitions ?t&#39; p = partitions ?t p&quot;</span><span class=""> 
</span><span class="">                      </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                    </span><span class="keyword1">moreover</span><span class="">
</span><span class="">                    </span><span class="keyword1">from</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;partitions ?s&#39; p = partitions s p&quot;</span><span class="">
</span><span class="">                       </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                    </span><span class="keyword1">ultimately</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1">qed</span><span class="">
</span><span class="">              </span><span class="keyword1">next</span><span class="">
</span><span class="">                </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172; ((partconf sc) (current s) &#8800; None &#8743; (partitions s) (current s) &#8800; None &#8743;
                    &#172; (part_mode (the ((partitions s) (current s))) = COLD_START &#8743; m = WARM_START))&quot;</span><span class="">
</span><span class="">                </span><span class="keyword3">thus</span><span class=""> </span><span class="var">?thesis</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1">qed</span><span class="">                  
</span><span class="">          </span><span class="keyword1">}</span><span class="">
</span><span class="">          </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword3">thus</span><span class=""> </span><span class="var">?thesis</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1">}</span><span class=""> </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">transf_sampling_msg_ref_lemma</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;s. transf_sampling_msg (&#8657;s) c = &#8657;(transf_sampling_msgR s c)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">transf_queuing_msg_maylost_ref_lemma</span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;&#8704;s. transf_queuing_msg_maylost sc (&#8657;s) c = &#8657;(transf_queuing_msg_maylostR sc s c)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{* new events introduced at this level dont change abstract state *}</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">setrun2ready_nchastate_lemma</span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;s&#39; = setRun2Ready s &#10233; (&#8657;s) = (&#8657;s&#39;)&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">schedule_process_nchastate_lemma</span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;&#8704;s&#39;&#8712;(schedule_process s). (&#8657;s) = (&#8657;s&#39;)&quot;</span><span class=""> 
</span><span class="">     </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">     </span><span class="keyword1">{</span><span class="">
</span><span class="">       </span><span class="keyword3">fix</span><span class=""> </span><span class="">s&#39;</span><span class="">
</span><span class="">       </span><span class="keyword3">assume</span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;s&#39;&#8712;(schedule_process s)&quot;</span><span class="">
</span><span class="">       
</span><span class="">       </span><span class="keyword1">let</span><span class=""> </span><span class="var">?s&#39;</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;setRun2Ready s&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">let</span><span class=""> </span><span class="var">?readyprs</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;{p. p&#8712;the (procs ?s&#39; (current ?s&#39;)) &#8743; 
                                state (the (proc_state ?s&#39; (current ?s&#39;,p))) = READY}&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(&#8657;s) = (&#8657;s&#39;)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_partition sysconf (current s)  &#8743; part_mode (the ((partitions s) (current s))) = NORMAL&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;is_a_partition sysconf (current s)  &#8743; part_mode (the ((partitions s) (current s))) = NORMAL&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">let</span><span class=""> </span><span class="var">?s&#39;</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;setRun2Ready s&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">have</span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8657;s) = (&#8657;?s&#39;)&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">setrun2ready_nchastate_lemma</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">            </span><span class="keyword1">have</span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8657;?s&#39;) = (&#8657;s&#39;)&quot;</span><span class=""> </span><span class="keyword1">using</span><span class="">  </span><span class="">a0</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">               
</span><span class="">            </span><span class="keyword1">with</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">abstract_state_def</span><span class=""> </span><span class="">setRun2Ready_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1">next</span><span class="">
</span><span class="">          </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172; (is_a_partition sysconf (current s)  &#8743; part_mode (the ((partitions s) (current s))) = NORMAL)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">}</span><span class="">
</span><span class="">    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">abstract_state_def</span><span class=""> </span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">create_process_nchastate_lemma</span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;&#8704;s. (&#8657;s) = &#8657;(fst (create_process s pri))&quot;</span><span class=""> 
</span><span class="">     </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">set_process_priority_nchastate_lemma</span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;&#8704;s. (&#8657;s) = &#8657;(set_process_priority s p pri)&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">start_process_nchastate_lemma</span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;&#8704;s. (&#8657;s) = &#8657;(start_process s p)&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">stop_process_nchastate_lemma</span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;&#8704;s. (&#8657;s) = &#8657;(stop_process s p)&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">suspend_process_nchastate_lemma</span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;&#8704;s. (&#8657;s) = &#8657;(suspend_process s p)&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">resume_process_nchastate_lemma</span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;&#8704;s. (&#8657;s) = &#8657;(resume_process s p)&quot;</span><span class=""> 
</span><span class="">     </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_process_status_nchastate_lemma</span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;&#8704;s. (&#8657;s) = &#8657;(fst (get_process_status s p))&quot;</span><span class=""> 
</span><span class="">     </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{* proof of refinement *}</span><span class="">
</span><span class="">  
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">s0_ref_lemma</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8657;s0r) = s0t&quot;</span><span class=""> 
</span><span class="">     </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">  </span><span class="">s0t_init</span><span class=""> </span><span class="">s0r_init</span><span class=""> </span><span class="">system_initR_def</span><span class=""> </span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">refine_exec_event</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(s,t)&#8712;exec_eventR e &#10233; (eR e = None &#10230; (&#8657;s) = (&#8657;t)) 
    &#8743; (eR e &#8800; None &#10230; (&#8657;s,&#8657;t)&#8712;exec_event (the (eR e)))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(s,t)&#8712;exec_eventR e&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;(eR e = None &#10230; (&#8657;s) = (&#8657;t)) &#8743; (eR e &#8800; None &#10230; (&#8657;s,&#8657;t)&#8712;exec_event (the (eR e)))&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">e</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">hyperc&#39;</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Create_Sampling_Port</span><span class=""> </span><span class="">y</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?e</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;Hypercall.Create_Sampling_Port y&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?er</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;Create_Sampling_Port y&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;event_enabledR s (hyperc&#39; ?er) = event_enabled (&#8657;s) (hyperc ?e)&quot;</span><span class="">
</span><span class="">                 </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;((&#8657;s),(&#8657;t)) &#8712; exec_event (hyperc ?e)&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">using</span><span class=""> </span><span class="">create_sampling_port_ref_lemma</span><span class=""> </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">exec_event_def</span><span class=""> 
</span><span class="">                  </span><span class="">Create_Sampling_Port.prems</span><span class="">  
</span><span class="">                  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">abstract_state_def</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">eR_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Write_Sampling_Message</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">y</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?e</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;Hypercall.Write_Sampling_Message x1 y&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?er</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;Write_Sampling_Message x1 y&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;event_enabledR s (hyperc&#39; ?er) = event_enabled (&#8657;s) (hyperc ?e)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">using</span><span class=""> </span><span class="">event_enabled_def</span><span class=""> </span><span class="">abstract_state_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;((&#8657;s),(&#8657;t)) &#8712; exec_event (hyperc ?e)&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">using</span><span class=""> </span><span class="">write_sampling_message_ref_lemma</span><span class=""> </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">exec_event_def</span><span class=""> 
</span><span class="">                     </span><span class="">Write_Sampling_Message.prems</span><span class="">
</span><span class="">                   </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">abstract_state_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">eR_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Read_Sampling_Message</span><span class=""> </span><span class="">y</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?e</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;Hypercall.Read_Sampling_Message y&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?er</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;Read_Sampling_Message y&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;event_enabledR s (hyperc&#39; ?er) = event_enabled (&#8657;s) (hyperc ?e)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">using</span><span class=""> </span><span class="">event_enabled_def</span><span class=""> </span><span class="">abstract_state_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;((&#8657;s),(&#8657;t)) &#8712; exec_event (hyperc ?e)&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">using</span><span class=""> </span><span class="">read_sampling_message_ref_lemma</span><span class=""> </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">exec_event_def</span><span class=""> 
</span><span class="">                     </span><span class="">Read_Sampling_Message.prems</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">abstract_state_def</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">eR_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Get_Sampling_Portid</span><span class=""> </span><span class="">y</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?e</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;Hypercall.Get_Sampling_Portid y&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?er</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;Get_Sampling_Portid y&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;event_enabledR s (hyperc&#39; ?er) = event_enabled (&#8657;s) (hyperc ?e)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">using</span><span class=""> </span><span class="">event_enabled_def</span><span class=""> </span><span class="">abstract_state_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;((&#8657;s),(&#8657;t)) &#8712; exec_event (hyperc ?e)&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">using</span><span class=""> </span><span class="">get_sampling_port_id_ref_lemma</span><span class=""> </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">exec_event_def</span><span class=""> 
</span><span class="">                     </span><span class="">Get_Sampling_Portid</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">abstract_state_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">eR_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Get_Sampling_Portstatus</span><span class=""> </span><span class="">y</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?e</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;Hypercall.Get_Sampling_Portstatus y&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?er</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;Get_Sampling_Portstatus y&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;event_enabledR s (hyperc&#39; ?er) = event_enabled (&#8657;s) (hyperc ?e)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">using</span><span class=""> </span><span class="">event_enabled_def</span><span class=""> </span><span class="">abstract_state_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;((&#8657;s),(&#8657;t)) &#8712; exec_event (hyperc ?e)&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">using</span><span class=""> </span><span class="">get_sampling_port_status_ref_lemma</span><span class=""> </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">exec_event_def</span><span class=""> 
</span><span class="">                     </span><span class="">Get_Sampling_Portstatus.prems</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">abstract_state_def</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">eR_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Create_Queuing_Port</span><span class=""> </span><span class="">y</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?e</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;Hypercall.Create_Queuing_Port y&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?er</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;Create_Queuing_Port y&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;event_enabledR s (hyperc&#39; ?er) = event_enabled (&#8657;s) (hyperc ?e)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">using</span><span class=""> </span><span class="">event_enabled_def</span><span class=""> </span><span class="">abstract_state_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;((&#8657;s),(&#8657;t)) &#8712; exec_event (hyperc ?e)&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">using</span><span class=""> </span><span class="">create_queuing_port_ref_lemma</span><span class=""> </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">exec_event_def</span><span class=""> 
</span><span class="">                     </span><span class="">Create_Queuing_Port.prems</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">abstract_state_def</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">eR_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Send_Queuing_Message</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">y1</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?e</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;Hypercall.Send_Queuing_Message x1 y1&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?er</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;Send_Queuing_Message x1 y1&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;event_enabledR s (hyperc&#39; ?er) = event_enabled (&#8657;s) (hyperc ?e)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">using</span><span class=""> </span><span class="">event_enabled_def</span><span class=""> </span><span class="">abstract_state_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;((&#8657;s),(&#8657;t)) &#8712; exec_event (hyperc ?e)&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">using</span><span class=""> </span><span class="">send_queuing_message_maylost_ref_lemma</span><span class=""> </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">exec_event_def</span><span class=""> 
</span><span class="">                     </span><span class="">Send_Queuing_Message.prems</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">abstract_state_def</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">eR_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">             </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Receive_Queuing_Message</span><span class=""> </span><span class="">x1</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?e</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;Hypercall.Receive_Queuing_Message x1&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?er</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;Receive_Queuing_Message x1&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;event_enabledR s (hyperc&#39; ?er) = event_enabled (&#8657;s) (hyperc ?e)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">using</span><span class=""> </span><span class="">event_enabled_def</span><span class=""> </span><span class="">abstract_state_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;((&#8657;s),(&#8657;t)) &#8712; exec_event (hyperc ?e)&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">using</span><span class=""> </span><span class="">receive_queuing_message_ref_lemma</span><span class=""> </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">exec_event_def</span><span class=""> 
</span><span class="">                     </span><span class="">Receive_Queuing_Message.prems</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">abstract_state_def</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">eR_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Get_Queuing_Portid</span><span class=""> </span><span class="">x1</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?e</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;Hypercall.Get_Queuing_Portid x1&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?er</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;Get_Queuing_Portid x1&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;event_enabledR s (hyperc&#39; ?er) = event_enabled (&#8657;s) (hyperc ?e)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">using</span><span class=""> </span><span class="">event_enabled_def</span><span class=""> </span><span class="">abstract_state_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;((&#8657;s),(&#8657;t)) &#8712; exec_event (hyperc ?e)&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">using</span><span class=""> </span><span class="">get_queuing_port_id_ref_lemma</span><span class=""> </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">exec_event_def</span><span class=""> 
</span><span class="">                     </span><span class="">Get_Queuing_Portid.prems</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">abstract_state_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">eR_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Get_Queuing_Portstatus</span><span class=""> </span><span class="">x1</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?e</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;Hypercall.Get_Queuing_Portstatus x1&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?er</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;Get_Queuing_Portstatus x1&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;event_enabledR s (hyperc&#39; ?er) = event_enabled (&#8657;s) (hyperc ?e)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">using</span><span class=""> </span><span class="">event_enabled_def</span><span class=""> </span><span class="">abstract_state_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;((&#8657;s),(&#8657;t)) &#8712; exec_event (hyperc ?e)&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">using</span><span class=""> </span><span class="">get_queuing_port_status_ref_lemma</span><span class=""> </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">exec_event_def</span><span class=""> 
</span><span class="">                     </span><span class="">Get_Queuing_Portstatus.prems</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">abstract_state_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">eR_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Clear_Queuing_Port</span><span class=""> </span><span class="">x1</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?e</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;Hypercall.Clear_Queuing_Port x1&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?er</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;Clear_Queuing_Port x1&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;event_enabledR s (hyperc&#39; ?er) = event_enabled (&#8657;s) (hyperc ?e)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">using</span><span class=""> </span><span class="">event_enabled_def</span><span class=""> </span><span class="">abstract_state_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;((&#8657;s),(&#8657;t)) &#8712; exec_event (hyperc ?e)&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">using</span><span class=""> </span><span class="">clear_queuing_port_ref_lemma</span><span class=""> </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">exec_event_def</span><span class=""> 
</span><span class="">                     </span><span class="">Clear_Queuing_Port.prems</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">abstract_state_def</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">eR_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Set_Partition_Mode</span><span class=""> </span><span class="">x1</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?e</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;Hypercall.Set_Partition_Mode x1&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?er</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;Set_Partition_Mode x1&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;event_enabledR s (hyperc&#39; ?er) = event_enabled (&#8657;s) (hyperc ?e)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">using</span><span class=""> </span><span class="">event_enabled_def</span><span class=""> </span><span class="">abstract_state_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;((&#8657;s),(&#8657;t)) &#8712; exec_event (hyperc ?e)&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">using</span><span class=""> </span><span class="">set_partition_mode_ref_lemma</span><span class=""> </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">exec_event_def</span><span class=""> 
</span><span class="">                     </span><span class="">Set_Partition_Mode.prems</span><span class=""> 
</span><span class="">                     </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">set_partition_modeR_def</span><span class=""> 
</span><span class="">                              </span><span class="">abstract_state_def</span><span class=""> </span><span class="">event_enabledR_def</span><span class=""> 
</span><span class="">                               </span><span class="">event_enabled_def</span><span class=""> </span><span class="">set_partition_mode_def</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">eR_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Get_Partition_Status</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?e</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;Hypercall.Get_Partition_Status&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?er</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;Get_Partition_Status&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;event_enabledR s (hyperc&#39; ?er) = event_enabled (&#8657;s) (hyperc ?e)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">using</span><span class=""> </span><span class="">event_enabled_def</span><span class=""> </span><span class="">abstract_state_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;((&#8657;s),(&#8657;t)) &#8712; exec_event (hyperc ?e)&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">using</span><span class=""> </span><span class="">get_partition_status_ref_lemma</span><span class=""> </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">exec_event_def</span><span class=""> 
</span><span class="">                     </span><span class="">Get_Partition_Status.prems</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">abstract_state_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">eR_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Create_Process</span><span class=""> </span><span class="">x1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?er</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;Create_Process x1&quot;</span><span class="">
</span><span class="">              </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">eR_def</span><span class=""> </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">Create_Process.prems</span><span class=""> </span><span class="">create_process_nchastate_lemma</span><span class="">                  
</span><span class="">                </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">EventR.simps</span><span class="delimiter">(</span><span class="">5</span><span class="delimiter">)</span><span class=""> </span><span class="">Hypercall&#39;.simps</span><span class="delimiter">(</span><span class="">413</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="">mem_Collect_eq</span><span class=""> </span><span class="">old.prod.case</span><span class=""> </span><span class="">singletonD</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Start_Process</span><span class=""> </span><span class="">x1</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?er</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;Start_Process x1&quot;</span><span class="">
</span><span class="">              </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">eR_def</span><span class=""> </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">Start_Process.prems</span><span class=""> </span><span class="">start_process_nchastate_lemma</span><span class="">
</span><span class="">                </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">EventR.simps</span><span class="delimiter">(</span><span class="">5</span><span class="delimiter">)</span><span class=""> </span><span class="">Hypercall&#39;.simps</span><span class="delimiter">(</span><span class="">414</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="">mem_Collect_eq</span><span class=""> </span><span class="">old.prod.case</span><span class=""> </span><span class="">singletonD</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Stop_Process</span><span class=""> </span><span class="">x1</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?er</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;Stop_Process x1&quot;</span><span class="">
</span><span class="">              </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">eR_def</span><span class=""> </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">Stop_Process.prems</span><span class=""> </span><span class="">stop_process_nchastate_lemma</span><span class="">
</span><span class="">                </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">EventR.simps</span><span class="delimiter">(</span><span class="">5</span><span class="delimiter">)</span><span class=""> </span><span class="">Hypercall&#39;.simps</span><span class="delimiter">(</span><span class="">415</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="">mem_Collect_eq</span><span class=""> </span><span class="">old.prod.case</span><span class=""> </span><span class="">singletonD</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Resume_Process</span><span class=""> </span><span class="">x1</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?er</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;Resume_Process x1&quot;</span><span class="">
</span><span class="">              </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">eR_def</span><span class=""> </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">Resume_Process.prems</span><span class=""> </span><span class="">resume_process_nchastate_lemma</span><span class="">
</span><span class="">                </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">EventR.simps</span><span class="delimiter">(</span><span class="">5</span><span class="delimiter">)</span><span class=""> </span><span class="">Hypercall&#39;.simps</span><span class="delimiter">(</span><span class="">416</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="">mem_Collect_eq</span><span class=""> </span><span class="">old.prod.case</span><span class=""> </span><span class="">singletonD</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Suspend_Process</span><span class=""> </span><span class="">x1</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?er</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;Suspend_Process x1&quot;</span><span class="">
</span><span class="">              </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">eR_def</span><span class=""> </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">Suspend_Process.prems</span><span class=""> </span><span class="">suspend_process_nchastate_lemma</span><span class="">
</span><span class="">                </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">EventR.simps</span><span class="delimiter">(</span><span class="">5</span><span class="delimiter">)</span><span class=""> </span><span class="">Hypercall&#39;.simps</span><span class="delimiter">(</span><span class="">417</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="">mem_Collect_eq</span><span class=""> </span><span class="">old.prod.case</span><span class=""> </span><span class="">singletonD</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Set_Priority</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">y1</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?er</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;Set_Priority x1 y1&quot;</span><span class="">
</span><span class="">              </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">eR_def</span><span class=""> </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">Set_Priority.prems</span><span class=""> </span><span class="">set_process_priority_nchastate_lemma</span><span class="">
</span><span class="">                </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">EventR.simps</span><span class="delimiter">(</span><span class="">5</span><span class="delimiter">)</span><span class=""> </span><span class="">Hypercall&#39;.simps</span><span class="delimiter">(</span><span class="">418</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="">mem_Collect_eq</span><span class=""> </span><span class="">old.prod.case</span><span class=""> </span><span class="">singletonD</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Get_Process_Status</span><span class=""> </span><span class="">x1</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?er</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;Get_Process_Status x1&quot;</span><span class="">
</span><span class="">              </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">eR_def</span><span class=""> </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">Get_Process_Status.prems</span><span class=""> </span><span class="">get_process_status_nchastate_lemma</span><span class="">
</span><span class="">                </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">EventR.simps</span><span class="delimiter">(</span><span class="">5</span><span class="delimiter">)</span><span class=""> </span><span class="">Hypercall&#39;.simps</span><span class="delimiter">(</span><span class="">419</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="">mem_Collect_eq</span><span class=""> </span><span class="">old.prod.case</span><span class=""> </span><span class="">singletonD</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">sys&#39;</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> 
</span><span class="">          </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Schedule</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?e</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;System_Event.Schedule&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?er</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;Schedule&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;event_enabledR s (sys&#39; ?er) = event_enabled (&#8657;s) (sys ?e)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;((&#8657;s),(&#8657;t)) &#8712; exec_event (sys ?e)&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">using</span><span class=""> </span><span class="">schedule_ref_lemma</span><span class=""> </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">exec_event_def</span><span class=""> 
</span><span class="">                     </span><span class="">Schedule.prems</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class="">  </span><span class="">scheduleR_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">eR_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Transfer_Sampling_Message</span><span class=""> </span><span class="">x1</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?e</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;System_Event.Transfer_Sampling_Message x1&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?er</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;Transfer_Sampling_Message x1&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;event_enabledR s (sys&#39; ?er) = event_enabled (&#8657;s) (sys ?e)&quot;</span><span class="">
</span><span class="">                 </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;((&#8657;s),(&#8657;t)) &#8712; exec_event (sys ?e)&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">using</span><span class=""> </span><span class="">transf_sampling_msg_ref_lemma</span><span class=""> </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">exec_event_def</span><span class=""> 
</span><span class="">                     </span><span class="">Transfer_Sampling_Message.prems</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">eR_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Transfer_Queuing_Message</span><span class=""> </span><span class="">x1</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?e</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;System_Event.Transfer_Queuing_Message x1&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?er</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;Transfer_Queuing_Message x1&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;event_enabledR s (sys&#39; ?er) = event_enabled (&#8657;s) (sys ?e)&quot;</span><span class="">
</span><span class="">                 </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;((&#8657;s),(&#8657;t)) &#8712; exec_event (sys ?e)&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">using</span><span class=""> </span><span class="">transf_queuing_msg_maylost_ref_lemma</span><span class=""> </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">exec_event_def</span><span class=""> 
</span><span class="">                     </span><span class="">Transfer_Queuing_Message.prems</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">eR_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Schedule_Process</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?er</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;Schedule_Process&quot;</span><span class="">
</span><span class="">              </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">eR_def</span><span class=""> </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">Schedule_Process.prems</span><span class=""> </span><span class="">schedule_process_nchastate_lemma</span><span class="">
</span><span class="">                </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">EventR.simps</span><span class="delimiter">(</span><span class="">6</span><span class="delimiter">)</span><span class=""> </span><span class="">System_EventR.simps</span><span class="delimiter">(</span><span class="">18</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                   </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> </span><span class="">singletonD</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">reachR_reach1</span><span class="delimiter">:</span><span class=""> 
</span><span class="">     </span><span class="string">&quot;&#8704;s as s&#39;. SK_TopSpec.reachable0 (&#8657;s) &#8743; 
                 reachable0 s &#8743; s&#39;&#8712;execute as s  &#10230; 
                SK_TopSpec.reachable0 (&#8657;s&#39;)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1">{</span><span class="">
</span><span class="">    </span><span class="keyword3">fix</span><span class=""> </span><span class="">as</span><span class="">
</span><span class="">    </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8704;s s&#39;. SK_TopSpec.reachable0 (&#8657;s) &#8743; reachable0 s &#8743; s&#39;&#8712;execute as s
                        &#10230; SK_TopSpec.reachable0 (&#8657;s&#39;)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">as</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3">case</span><span class=""> </span><span class="">Nil</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">execute_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">    </span><span class="keyword1">next</span><span class="">
</span><span class="">      </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Cons</span><span class=""> </span><span class="">b</span><span class=""> </span><span class="">bs</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;s s&#39;. SK_TopSpec.reachable0 (&#8657;s) &#8743; reachable0 s &#8743; s&#39;&#8712;execute bs s
                      &#10230; SK_TopSpec.reachable0 (&#8657;s&#39;)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> 
</span><span class="">      </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1">{</span><span class="">
</span><span class="">        </span><span class="keyword3">fix</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">s&#39;</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;SK_TopSpec.reachable0 (&#8657;s) &#8743; reachable0 s &#8743; s&#39;&#8712;execute (b # bs) s&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;current s = current (&#8657;s) &#8743; partitions s = partitions (&#8657;s)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">abstract_state_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;s1. (s,s1)&#8712;exec_eventR b &#10230; SK_TopSpec.reachable0 (&#8657;s1)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">        </span><span class="keyword1">{</span><span class="">
</span><span class="">          </span><span class="keyword3">fix</span><span class=""> </span><span class="">s1</span><span class="">
</span><span class="">          </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(s,s1)&#8712;exec_eventR b&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;SK_TopSpec.reachable0 (&#8657;s1)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">using</span><span class=""> </span><span class="">SK_TopSpec.reachableStep</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">refine_exec_event</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">metis</span><span class=""> 
</span><span class="">        </span><span class="keyword1">}</span><span class="">
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">        </span><span class="keyword1">from</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8707;s1. (s,s1)&#8712;exec_eventR b &#8743; (s1,s&#39;)&#8712;run bs&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">execute_def</span><span class=""> 
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">relcomp.simps</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">obtain</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="keyword2">where</span><span class=""> </span><span class="">b4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(s,s1)&#8712;exec_eventR b &#8743; (s1,s&#39;)&#8712;run bs&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1">with</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;SK_TopSpec.reachable0 (&#8657;s1)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="">b6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;SK_L2Spec.reachable0 s1&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">SK_L2Spec.reachableStep</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">        </span><span class="keyword1">with</span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="">b5</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;SK_TopSpec.reachable0 (&#8657;s&#39;)&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">execute_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">}</span><span class=""> </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">  </span><span class="keyword1">}</span><span class=""> </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">reachR_reach</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;reachable0 s &#10233; SK_TopSpec.reachable0 (&#8657;s)&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">reachR_reach1</span><span class=""> </span><span class="">SK_L2Spec.reachable0_def</span><span class=""> </span><span class="">reachable_s0</span><span class=""> </span><span class="">SK_TopSpec.reachable_s0</span><span class=""> </span><span class="">s0_ref_lemma</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Image_singleton_iff</span><span class=""> </span><span class="">execute_def</span><span class=""> </span><span class="">reachable_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">primrec</span><span class=""> </span><span class="">rmtau</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;&#39;a option list =&gt; &#39;a list&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;rmtau [] = []&quot;</span><span class=""> </span><span class="delimiter">|</span><span class="">
</span><span class="">        </span><span class="string">&quot;rmtau (a#as) = (if a &#8800; None then
                          the a # rmtau as
                         else rmtau as)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">refine_sound_helper</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;es st sr. st = &#8657;sr &#10230; 
          (image abstract_state (execute es sr)) &#8838; (SK_TopSpec.execute (rmtau (map eR es)) st)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1">{</span><span class="">
</span><span class="">    </span><span class="keyword3">fix</span><span class=""> </span><span class="">es</span><span class="">
</span><span class="">    </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8704;st sr. st = &#8657;sr &#10230; 
          (image abstract_state (execute es sr)) &#8838; (SK_TopSpec.execute (rmtau (map eR es)) st)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">es</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3">case</span><span class=""> </span><span class="">Nil</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1">{</span><span class="">
</span><span class="">        </span><span class="keyword3">fix</span><span class=""> </span><span class="">st</span><span class=""> </span><span class="">sr</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;st = &#8657;sr&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;abstract_state ` SK_L2Spec.execute [] sr = {st}&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1">using</span><span class=""> </span><span class="">SK_L2Spec.execute_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">            
</span><span class="">        </span><span class="keyword1">moreover</span><span class="">
</span><span class="">        </span><span class="keyword1">from</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;SK_TopSpec.execute (rmtau (map eR [])) st = {st}&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1">using</span><span class=""> </span><span class="">SK_TopSpec.execute_def</span><span class=""> </span><span class="">SK_L2Spec.run.run_Nil</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1">ultimately</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;abstract_state ` SK_L2Spec.execute [] sr &#8838; SK_TopSpec.execute (rmtau (map eR [])) st&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">      </span><span class="keyword1">}</span><span class=""> </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Cons</span><span class=""> </span><span class="">a</span><span class=""> </span><span class="">as</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;st sr. st = &#8657;sr &#10230; 
              abstract_state ` SK_L2Spec.execute as sr &#8838; SK_TopSpec.execute (rmtau (map eR as)) st&quot;</span><span class="">
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">        </span><span class="keyword1">{</span><span class="">
</span><span class="">          </span><span class="keyword3">fix</span><span class=""> </span><span class="">st</span><span class=""> </span><span class="">sr</span><span class="">
</span><span class="">          </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;st = &#8657;sr&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;SK_L2Spec.execute (a # as) sr = Image (exec_eventR a O run as) {sr}&quot;</span><span class=""> 
</span><span class="">            </span><span class="keyword1">using</span><span class=""> </span><span class="">SK_L2Spec.execute_def</span><span class=""> </span><span class="">SK_L2Spec.run.run_Cons</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">          
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;abstract_state ` SK_L2Spec.execute (a # as) sr &#8838; SK_TopSpec.execute (rmtau (map eR (a # as))) st&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;eR a = None&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;eR a = None&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;rmtau (map eR (a # as)) = rmtau (map eR as)&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">rmtau_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1">let</span><span class=""> </span><span class="var">?nextsr</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;SK_L2Spec.next_states sr a&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">have</span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class="string">&quot;Image (exec_eventR a O run as) {sr} = Image (run as) ?nextsr&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">SK_L2Spec.next_states_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1">{</span><span class="">
</span><span class="">              </span><span class="keyword3">fix</span><span class=""> </span><span class="">s</span><span class="">
</span><span class="">              </span><span class="keyword3">assume</span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;s&#8712;abstract_state ` SK_L2Spec.execute (a # as) sr&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">with</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8707;s&#39;&#8712;?nextsr. s&#8712;abstract_state ` Image (run as) {s&#39;}&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">  
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">obtain</span><span class=""> </span><span class="">s&#39;</span><span class=""> </span><span class="keyword2">where</span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class="string">&quot;s&#39;&#8712;?nextsr &#8743; s&#8712;abstract_state ` Image (run as) {s&#39;}&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1">from</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;st = &#8657;s&#39;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">refine_exec_event</span><span class=""> </span><span class="">SK_L2Spec.next_states_def</span><span class=""> 
</span><span class="">                </span><span class="">b0</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">              </span><span class="keyword1">with</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;abstract_state ` SK_L2Spec.execute as s&#39; &#8838; SK_TopSpec.execute (rmtau (map eR as)) st&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">              </span><span class="keyword1">with</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;s&#8712;SK_TopSpec.execute (rmtau (map eR (a # as))) st&quot;</span><span class=""> 
</span><span class="">                </span><span class="keyword1">using</span><span class=""> </span><span class="">SK_L2Spec.execute_def</span><span class=""> </span><span class="">subsetCE</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">            </span><span class="keyword1">}</span><span class="">
</span><span class="">            </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;eR a &#8800; None&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;rmtau (map eR (a # as)) = (the (eR a)) # (rmtau (map eR as))&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">rmtau_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1">let</span><span class=""> </span><span class="var">?nextsr</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;SK_L2Spec.next_states sr a&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">let</span><span class=""> </span><span class="var">?nextst</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;SK_TopSpec.next_states st (the (eR a))&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">have</span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class="string">&quot;Image (exec_eventR a O run as) {sr} = Image (run as) ?nextsr&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">SK_L2Spec.next_states_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1">have</span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class="string">&quot;Image (exec_event (the (eR a)) O SK_TopSpec.run (rmtau (map eR as))) {st} 
                  = Image (SK_TopSpec.run (rmtau (map eR as))) ?nextst&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">SK_TopSpec.next_states_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1">{</span><span class="">
</span><span class="">              </span><span class="keyword3">fix</span><span class=""> </span><span class="">s</span><span class="">
</span><span class="">              </span><span class="keyword3">assume</span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;s&#8712;abstract_state ` SK_L2Spec.execute (a # as) sr&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">with</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8707;s&#39;&#8712;?nextsr. s&#8712;abstract_state ` Image (run as) {s&#39;}&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">using</span><span class=""> </span><span class="">Image_singleton_iff</span><span class=""> </span><span class="">SK_L2Spec.next_states_def</span><span class=""> </span><span class="">imageE</span><span class=""> 
</span><span class="">                  </span><span class="">image_eqI</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> </span><span class="">relcomp.cases</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">obtain</span><span class=""> </span><span class="">s&#39;</span><span class=""> </span><span class="keyword2">where</span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class="string">&quot;s&#39;&#8712;?nextsr &#8743; s&#8712;abstract_state ` Image (run as) {s&#39;}&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1">from</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8707;st&#39;&#8712;?nextst. st&#39; = &#8657;s&#39;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">refine_exec_event</span><span class=""> </span><span class="">SK_L2Spec.next_states_def</span><span class=""> 
</span><span class="">                </span><span class="">b0</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">SK_TopSpec.next_states_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">obtain</span><span class=""> </span><span class="">st&#39;</span><span class=""> </span><span class="keyword2">where</span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;st&#39;&#8712;?nextst &#8743; st&#39; = &#8657;s&#39;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1">from</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;abstract_state ` SK_L2Spec.execute as s&#39; &#8838; SK_TopSpec.execute (rmtau (map eR as)) st&#39;&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">              </span><span class="keyword1">with</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;s&#8712;SK_TopSpec.execute (rmtau (map eR (a # as))) st&quot;</span><span class=""> 
</span><span class="">                </span><span class="keyword1">using</span><span class=""> </span><span class="">SK_L2Spec.execute_def</span><span class=""> </span><span class="">ImageI</span><span class=""> </span><span class="">Image_singleton_iff</span><span class=""> </span><span class="">SK_TopSpec.execute_def</span><span class=""> 
</span><span class="">                  </span><span class="">SK_TopSpec.run.run_Cons</span><span class=""> </span><span class="">subsetCE</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">  
</span><span class="">            </span><span class="keyword1">}</span><span class="">
</span><span class="">            </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">          </span><span class="keyword1">qed</span><span class="">
</span><span class="">        </span><span class="keyword1">}</span><span class="">
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">}</span><span class="">
</span><span class="">    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">theorem</span><span class=""> </span><span class="">refine_sound</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(image abstract_state (execute es s0r)) &#8838; (SK_TopSpec.execute (rmtau (map eR es)) s0t)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">refine_sound_helper</span><span class=""> </span><span class="">s0_ref_lemma</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{* unwinding conditions of refinement*}</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">weak_step_consistent_new_evt_ref</span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;&#8704;e. eR e = None &#8743; weak_step_consistent_new_e e &#10230; SK_L2Spec.weak_step_consistent_e e&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">SK_L2Spec.weak_step_consistent_e_def</span><span class=""> </span><span class="">refine_exec_event</span><span class=""> </span><span class="">vpeqR_def</span><span class=""> 
</span><span class="">          </span><span class="">weak_step_consistent_new_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">local_respect_new_evt_ref</span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;&#8704;e. eR e = None &#8743; local_respect_new_e e &#10230; SK_L2Spec.local_respect_e e&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">using</span><span class=""> </span><span class="">SK_L2Spec.local_respect_e_def</span><span class=""> </span><span class="">SK_TopSpec.non_interference_def</span><span class=""> 
</span><span class="">        </span><span class="">local_respect_new_e_def</span><span class=""> </span><span class="">non_interference1_def</span><span class=""> </span><span class="">refine_exec_event</span><span class=""> 
</span><span class="">        </span><span class="">vpeqR_def</span><span class=""> </span><span class="">vpeqR_reflexive_lemma</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">   
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">weak_step_consistent_evt_ref</span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;&#8704;e. eR e &#8800; None &#8743; SK_TopSpec.weak_step_consistent_e (the (eR e)) 
          &#8743; weak_step_consistent_new_e e &#10230; SK_L2Spec.weak_step_consistent_e e&quot;</span><span class="">    
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">SK_L2Spec.weak_step_consistent_e_def</span><span class=""> </span><span class="">SK_TopSpec.step_consistent_def</span><span class=""> 
</span><span class="">        </span><span class="">SK_TopSpec.weak_with_step_cons</span><span class=""> </span><span class="">domain_domainR</span><span class=""> </span><span class="">local_respect</span><span class=""> </span><span class="">reachR_reach</span><span class=""> 
</span><span class="">        </span><span class="">refine_exec_event</span><span class=""> </span><span class="">vpeqR_def</span><span class=""> </span><span class="">vpeqR_vpeq1</span><span class=""> </span><span class="">weak_step_consistent</span><span class=""> </span><span class="">weak_step_consistent_new_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">local_respect_evt_ref</span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;&#8704;e. eR e &#8800; None &#8743; SK_TopSpec.local_respect_e (the (eR e)) 
          &#8743; local_respect_new_e e &#10230; SK_L2Spec.local_respect_e e&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">SK_L2Spec.local_respect_e_def</span><span class=""> </span><span class="">SK_TopSpec.local_respect_e_def</span><span class=""> 
</span><span class="">          </span><span class="">SK_TopSpec.non_interference_def</span><span class=""> </span><span class="">domain_domainR</span><span class=""> </span><span class="">local_respect_new_e_def</span><span class=""> 
</span><span class="">          </span><span class="">non_interference1_def</span><span class=""> </span><span class="">reachR_reach</span><span class=""> </span><span class="">refine_exec_event</span><span class=""> </span><span class="">vpeqR_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">abs_sc_new_imp</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;SK_TopSpec.weak_step_consistent; weak_step_consistent_new&#10215; 
        &#10233; SK_L2Spec.weak_step_consistent&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">SK_L2Spec.weak_step_consistent_all_evt</span><span class=""> </span><span class="">SK_TopSpec.weak_step_consistent_all_evt</span><span class=""> 
</span><span class="">            </span><span class="">weak_step_consistent_evt_ref</span><span class=""> </span><span class="">weak_step_consistent_new_all_evt</span><span class=""> 
</span><span class="">              </span><span class="">weak_step_consistent_new_evt_ref</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">abs_lr_new_imp</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;SK_TopSpec.local_respect; local_respect_new&#10215; &#10233; SK_L2Spec.local_respect&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">SK_L2Spec.local_respect_all_evt</span><span class=""> </span><span class="">SK_TopSpec.local_respect_all_evt</span><span class=""> 
</span><span class="">      </span><span class="">local_respect_evt_ref</span><span class=""> </span><span class="">local_respect_new_all_evt</span><span class=""> </span><span class="">local_respect_new_evt_ref</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    
</span><span class="">  </span><span class="keyword1">theorem</span><span class=""> </span><span class="">noninfl_refinement</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;SK_TopSpec.local_respect; SK_TopSpec.weak_step_consistent; 
              weak_step_consistent_new; local_respect_new&#10215; &#10233; noninfluence&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">SK_L2Spec.UnwindingTheorem1</span><span class=""> </span><span class="">SK_L2Spec.noninf_eq_noninf_gen</span><span class=""> 
</span><span class="">            </span><span class="">abs_lr_new_imp</span><span class=""> </span><span class="">abs_sc_new_imp</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">metis</span><span class=""> 
</span><span class="">    
</span><span class="keyword1">subsection</span><span class="verbatim">{* Existing events preserve &quot;local respect&quot; on new state variables *}</span><span class=""> 
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;create sampling port&quot;*}</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">crt_smpl_portR_presrv_lcrsp_new</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (create_sampling_portR sysconf s pname)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> s&#39;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">    
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">crt_smpl_portR_presrv_lcrsp_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;local_respect_new_e (hyperc&#39; (Create_Sampling_Port pn))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">crt_smpl_portR_presrv_lcrsp_new</span><span class=""> </span><span class="">local_respect_new_e_def</span><span class=""> </span><span class="">exec_eventR_def</span><span class=""> 
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;write sampling message&quot;*}</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">write_smpl_msgR_presrv_lcrsp_new</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (write_sampling_messageR s pid m)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> s&#39;&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">p3</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">  
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">write_smpl_msgR_presrv_lcrsp_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;local_respect_new_e (hyperc&#39; (Write_Sampling_Message p m))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">write_smpl_msgR_presrv_lcrsp_new</span><span class=""> </span><span class="">local_respect_new_e_def</span><span class=""> </span><span class="">exec_eventR_def</span><span class=""> 
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;read sampling message&quot;*}</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">read_smpl_msgR_presrv_lcrsp_new</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (read_sampling_messageR s pid)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> s&#39;&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">p3</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">read_smpl_msgR_presrv_lcrsp_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;local_respect_new_e (hyperc&#39; (Read_Sampling_Message p))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">read_smpl_msgR_presrv_lcrsp_new</span><span class=""> </span><span class="">local_respect_new_e_def</span><span class=""> </span><span class="">exec_eventR_def</span><span class=""> 
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;get sampling portid&quot;*}</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_smpl_pidR_presrv_lcrsp_new</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (get_sampling_port_idR sysconf s pname)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> s&#39;&quot;</span><span class="">
</span><span class="">     </span><span class="keyword1">using</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_smpl_pidR_presrv_lcrsp_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;local_respect_new_e (hyperc&#39; (Get_Sampling_Portid p))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">get_smpl_pidR_presrv_lcrsp_new</span><span class=""> </span><span class="">local_respect_new_e_def</span><span class=""> </span><span class="">exec_eventR_def</span><span class=""> 
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;get sampling port status&quot;*}</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_smpl_pstsR_presrv_lcrsp_new</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (get_sampling_port_statusR sysconf s pid)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> s&#39;&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">using</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_smpl_pstsR_presrv_lcrsp_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;local_respect_new_e (hyperc&#39; (Get_Sampling_Portstatus p))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">get_smpl_pstsR_presrv_lcrsp_new</span><span class=""> </span><span class="">local_respect_new_e_def</span><span class=""> </span><span class="">exec_eventR_def</span><span class=""> 
</span><span class="">      </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;create queuing port&quot;*}</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">crt_que_portR_presrv_lcrsp_new</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (create_queuing_portR sysconf s pname)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> s&#39;&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">   
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">crt_que_portR_presrv_lcrsp_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;local_respect_new_e (hyperc&#39; (Create_Queuing_Port p))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">crt_que_portR_presrv_lcrsp_new</span><span class=""> </span><span class="">local_respect_new_e_def</span><span class=""> </span><span class="">exec_eventR_def</span><span class=""> 
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;send queuing message(may lost)&quot;*}</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">snd_que_msg_lstR_presrv_lcrsp_new</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (send_queuing_message_maylostR sysconf s pid m)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> s&#39;&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">  
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">snd_que_msg_lstR_presrv_lcrsp_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;local_respect_new_e (hyperc&#39; (Send_Queuing_Message p m))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">snd_que_msg_lstR_presrv_lcrsp_new</span><span class=""> </span><span class="">local_respect_new_e_def</span><span class=""> </span><span class="">exec_eventR_def</span><span class=""> 
</span><span class="">     </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;receive queuing message&quot;*}</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">rec_que_msgR_presrv_lcrsp_new</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (receive_queuing_messageR s pid)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> s&#39;&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">using</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">rec_que_msgR_presrv_lcrsp_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;local_respect_new_e (hyperc&#39; (Receive_Queuing_Message p))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">rec_que_msgR_presrv_lcrsp_new</span><span class=""> </span><span class="">local_respect_new_e_def</span><span class=""> </span><span class="">exec_eventR_def</span><span class=""> 
</span><span class="">     </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;get queuing portid&quot;*}</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_que_pidR_presrv_lcrsp_new</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (get_queuing_port_idR sysconf s pname)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> s&#39;&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">using</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_que_pidR_presrv_lcrsp_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;local_respect_new_e (hyperc&#39; (Get_Queuing_Portid p))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">get_que_pidR_presrv_lcrsp_new</span><span class=""> </span><span class="">local_respect_new_e_def</span><span class=""> </span><span class="">exec_eventR_def</span><span class=""> 
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;get queuing port status&quot;*}</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_que_pstsR_presrv_lcrsp_new</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (get_queuing_port_statusR sysconf s pid)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> s&#39;&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_que_pstsR_presrv_lcrsp_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;local_respect_new_e (hyperc&#39; (Get_Queuing_Portstatus p))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">get_que_pstsR_presrv_lcrsp_new</span><span class=""> </span><span class="">local_respect_new_e_def</span><span class=""> </span><span class="">exec_eventR_def</span><span class=""> 
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;clear queuing port&quot;*}</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">clr_que_portR_presrv_lcrsp_new</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = clear_queuing_portR s pid&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> s&#39;&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">using</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">clr_que_portR_presrv_lcrsp_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;local_respect_new_e (hyperc&#39; (Clear_Queuing_Port p))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">clr_que_portR_presrv_lcrsp_new</span><span class=""> </span><span class="">local_respect_new_e_def</span><span class=""> </span><span class="">exec_eventR_def</span><span class=""> 
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;get partition statue&quot;*}</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_part_statusR_presrv_lcrsp_new</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (get_partition_statusR sysconf s)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> s&#39;&quot;</span><span class="">
</span><span class="">   </span><span class="keyword1">using</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">   
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_part_statusR_presrv_lcrsp_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;local_respect_new_e (hyperc&#39; Get_Partition_Status)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">get_part_statusR_presrv_lcrsp_new</span><span class=""> </span><span class="">local_respect_new_e_def</span><span class=""> </span><span class="">exec_eventR_def</span><span class="">
</span><span class="">      </span><span class="">vpeq_part_procs_reflexive_lemma</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">fastforce</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">vpeq_part_procs_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;set partition mode&quot;*}</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">set_procs_to_normal_presrv_lcrsp_new</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;current s &#8800; d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;s&#39; = set_procs_to_normal s (current s)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> s&#39;&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">using</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class="">   </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">remove_partition_resources_presrv_lcrsp_new</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;current s &#8800; d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;s&#39; = remove_partition_resources s (current s)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> s&#39;&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1">using</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">set_part_modeR_presrv_lcrsp_new</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="keyword2">assumes</span><span class=""> 
</span><span class="">         </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;current s &#8800; d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;s&#39; = set_partition_modeR sysconf s m&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> s&#39;&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">set_part_modeR_presrv_lcrsp_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;local_respect_new_e (hyperc&#39; (Set_Partition_Mode p))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">set_part_modeR_presrv_lcrsp_new</span><span class=""> </span><span class="">local_respect_new_e_def</span><span class=""> 
</span><span class="">      </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">nintf_neq</span><span class=""> </span><span class="">domain_of_eventR_hc</span><span class=""> </span><span class="">event_enabledR_hc</span><span class="">   
</span><span class="">   </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">fastforce</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">set_partition_modeR_def</span><span class=""> </span><span class="">non_interference1_def</span><span class=""> </span><span class="delimiter">)</span><span class="">
</span><span class="">    
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;schedule&quot; *}</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">scheduleR_presrv_lcrsp_new</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;(scheduler sysconf) &#8726;&#8605; d&quot;</span><span class="">       
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> s&#39;&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">schedeler_intf_all_help</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">scheduleR_presrv_lcrsp_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;local_respect_new_e (sys&#39; Schedule)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">scheduleR_presrv_lcrsp_new</span><span class=""> </span><span class="">local_respect_new_e_def</span><span class=""> 
</span><span class="">      </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">nintf_neq</span><span class=""> </span><span class="">domain_of_eventR_hc</span><span class=""> </span><span class="">event_enabledR_hc</span><span class="">  
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">non_interference1_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;Transfer Sampling Message&quot;*}</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">trans_smpl_msgR_presrv_lcrsp_new</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = transf_sampling_msgR s c&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> s&#39;&quot;</span><span class="">
</span><span class="">   </span><span class="keyword1">using</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">trans_smpl_msgR_presrv_lcrsp_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;local_respect_new_e (sys&#39; (Transfer_Sampling_Message c))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">trans_smpl_msgR_presrv_lcrsp_new</span><span class=""> </span><span class="">local_respect_new_e_def</span><span class=""> 
</span><span class="">      </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">nintf_neq</span><span class=""> 
</span><span class="">      </span><span class="">domain_of_eventR_hc</span><span class=""> </span><span class="">event_enabledR_hc</span><span class="">  
</span><span class="">   </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">fastforce</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">non_interference1_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;Transfer Queuing Message&quot;*}</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">trans_que_msg_mlostR_presrv_lcrsp_new</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = transf_queuing_msg_maylostR sysconf s c&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> s&#39;&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">trans_que_msg_mlostR_presrv_lcrsp_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;local_respect_new_e (sys&#39; (Transfer_Queuing_Message c))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">trans_que_msg_mlostR_presrv_lcrsp_new</span><span class=""> </span><span class="">local_respect_new_e_def</span><span class=""> 
</span><span class="">      </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">nintf_neq</span><span class=""> </span><span class="">domain_of_eventR_hc</span><span class=""> </span><span class="">event_enabledR_hc</span><span class=""> 
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">fastforce</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">non_interference1_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="keyword1">subsection</span><span class="verbatim">{* New events preserve &quot;local respect&quot; on new state variables *}</span><span class=""> 
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">create_process_vpeq_part_procs</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="keyword2">assumes</span><span class=""> 
</span><span class="">           </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;current s &#8800; d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;s&#39; = fst (create_process s pri)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;s &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> s&#39;&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword1">using</span><span class="">  </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">   
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">create_process_presrv_lcrsp_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;local_respect_new_e (hyperc&#39; (Create_Process p))&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">create_process_vpeq_part_procs</span><span class=""> </span><span class="">local_respect_new_e_def</span><span class=""> 
</span><span class="">    </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">nintf_neq</span><span class=""> 
</span><span class="">    </span><span class="">domain_of_eventR_hc</span><span class=""> </span><span class="">event_enabledR_hc</span><span class="">  
</span><span class="">   </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">create_process_def</span><span class=""> </span><span class="">non_interference1_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">set_process_priority_vpeq_part_procs</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="keyword2">assumes</span><span class=""> 
</span><span class="">           </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;current s &#8800; d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;s&#39; = set_process_priority s p pri&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;s &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> s&#39;&quot;</span><span class=""> 
</span><span class="">   </span><span class="keyword1">using</span><span class="">  </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">set_process_priority_presrv_lcrsp_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;local_respect_new_e (hyperc&#39; (Set_Priority p pri))&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">set_process_priority_vpeq_part_procs</span><span class=""> </span><span class="">local_respect_new_e_def</span><span class=""> 
</span><span class="">    </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">nintf_neq</span><span class=""> </span><span class="">vpeq_part_procs_def</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class="">  </span><span class="">non_interference1_def</span><span class=""> </span><span class="">set_process_priority_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">start_process_vpeq_part_procs</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;current s &#8800; d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;s&#39; = start_process s p&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;s &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> s&#39;&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword1">using</span><span class="">  </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">start_process_presrv_lcrsp_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;local_respect_new_e (hyperc&#39; (Start_Process p))&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">start_process_vpeq_part_procs</span><span class=""> </span><span class="">local_respect_new_e_def</span><span class=""> 
</span><span class="">    </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">nintf_neq</span><span class="">  
</span><span class="">   </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">non_interference1_def</span><span class=""> </span><span class="">start_process_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">stop_process_vpeq_part_procs</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="keyword2">assumes</span><span class=""> 
</span><span class="">           </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;current s &#8800; d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;s&#39; = stop_process s p&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;s &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> s&#39;&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">stop_process_presrv_lcrsp_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;local_respect_new_e (hyperc&#39; (Stop_Process p))&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">stop_process_vpeq_part_procs</span><span class=""> </span><span class="">local_respect_new_e_def</span><span class=""> 
</span><span class="">    </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">nintf_neq</span><span class="">  
</span><span class="">   </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">stop_process_def</span><span class=""> </span><span class="">non_interference1_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">suspend_process_vpeq_part_procs</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="keyword2">assumes</span><span class=""> 
</span><span class="">           </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;current s &#8800; d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;s&#39; = suspend_process s p&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;s &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> s&#39;&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword1">using</span><span class="">  </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">suspend_process_presrv_lcrsp_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;local_respect_new_e (hyperc&#39; (Suspend_Process p))&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">suspend_process_vpeq_part_procs</span><span class=""> </span><span class="">local_respect_new_e_def</span><span class=""> 
</span><span class="">    </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">nintf_neq</span><span class="">  
</span><span class="">   </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">suspend_process_def</span><span class=""> </span><span class="">non_interference1_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">resume_process_vpeq_part_procs</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;current s &#8800; d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;s&#39; = resume_process s p&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;s &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> s&#39;&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">resume_process_presrv_lcrsp_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;local_respect_new_e (hyperc&#39; (Resume_Process p))&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">resume_process_vpeq_part_procs</span><span class=""> </span><span class="">local_respect_new_e_def</span><span class=""> 
</span><span class="">    </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">nintf_neq</span><span class=""> </span><span class="">vpeq_part_procs_def</span><span class=""> 
</span><span class="">   </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">resume_process_def</span><span class=""> </span><span class="">non_interference1_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_process_status_vpeq_part_procs</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="keyword2">assumes</span><span class=""> 
</span><span class="">            </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;current s &#8800; d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;s&#39; = fst (get_process_status s p)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;s &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> s&#39;&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_process_status_presrv_lcrsp_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;local_respect_new_e (hyperc&#39; (Get_Process_Status p))&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">get_process_status_vpeq_part_procs</span><span class=""> </span><span class="">local_respect_new_e_def</span><span class=""> 
</span><span class="">    </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">nintf_neq</span><span class="">  
</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">get_process_status_def</span><span class=""> </span><span class="">non_interference1_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">schedule_process_vpeq_part_procs</span><span class="delimiter">:</span><span class="">
</span><span class="">     </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;current s &#8800; d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;s&#39; &#8712; schedule_process s&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;s &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> s&#39;&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1">let</span><span class=""> </span><span class="var">?s&#39;</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;setRun2Ready s&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">let</span><span class=""> </span><span class="var">?readyprs</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;{p. p&#8712;the (procs ?s&#39; (current ?s&#39;)) &#8743; 
                              state (the (proc_state ?s&#39; (current ?s&#39;,p))) = READY}&quot;</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> 
</span><span class="">        </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_partition sysconf (current s) &#8743; part_mode (the ((partitions s) (current s))) = NORMAL&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;is_a_partition sysconf (current s) &#8743; part_mode (the ((partitions s) (current s))) = NORMAL&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">let</span><span class=""> </span><span class="var">?s&#39;</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;setRun2Ready s&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">let</span><span class=""> </span><span class="var">?readyprs</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;{p. p&#8712;the (procs ?s&#39; (current ?s&#39;)) &#8743; 
                                  state (the (proc_state ?s&#39; (current ?s&#39;,p))) = READY}&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">let</span><span class=""> </span><span class="var">?selp</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;SOME p. p&#8712;{x. state (the (proc_state ?s&#39; (current ?s&#39;,x))) = READY &#8743;
                                                         (&#8704;y&#8712;?readyprs. priority (the (proc_state ?s&#39; (current ?s&#39;,x))) &#8805;
                                                                      priority (the (proc_state ?s&#39; (current ?s&#39;,y))))}&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">let</span><span class=""> </span><span class="var">?st</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;the ((proc_state ?s&#39;) (current ?s&#39;, ?selp))&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">let</span><span class=""> </span><span class="var">?proc_st</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;proc_state ?s&#39;&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">let</span><span class=""> </span><span class="var">?cur_pr</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;cur_proc_part ?s&#39;&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">from</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;schedule_process s = {?s&#39;&#10631;proc_state := ?proc_st ((current ?s&#39;, ?selp) := Some (?st&#10631;state := RUNNING&#10632;)),
                                           cur_proc_part := ?cur_pr(current ?s&#39; := Some ?selp)&#10632;}&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;vpeq_part_procs s d ?s&#39;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">p3</span><span class="">   </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="">b4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;current s = current ?s&#39;&quot;</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;vpeq_part_procs ?s&#39; d s&#39;&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">using</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1">by</span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">schedule_process_def</span><span class=""> </span><span class="">setRun2Ready_def</span><span class="delimiter">)</span><span class="">                                    
</span><span class="">          </span><span class="keyword1">with</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class="">  </span><span class="">vpeq_part_procs_transitive_lemma</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172; (is_a_partition sysconf (current s) &#8743; part_mode (the ((partitions s) (current s))) = NORMAL)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class="">  </span><span class="">p4</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">schedule_process_presrv_lcrsp_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;local_respect_new_e (sys&#39; Schedule_Process)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">schedule_process_vpeq_part_procs</span><span class=""> </span><span class="">local_respect_new_e_def</span><span class=""> 
</span><span class="">    </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">nintf_neq</span><span class=""> </span><span class="">domain_of_eventR_hc</span><span class="">   
</span><span class="">   </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">non_interference1_def</span><span class=""> </span><span class="">schedule_process_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">subsection</span><span class="verbatim">{* Proving the &quot;local respect&quot; property on new variables *}</span><span class="">
</span><span class="">  </span><span class="keyword1">theorem</span><span class=""> </span><span class="">local_respect_new</span><span class="delimiter">:</span><span class="">local_respect_new</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1">{</span><span class="">
</span><span class="">        </span><span class="keyword3">fix</span><span class=""> </span><span class="">e</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;local_respect_new_e e&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">e</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1">using</span><span class=""> </span><span class="">crt_smpl_portR_presrv_lcrsp_new_e</span><span class=""> </span><span class="">write_smpl_msgR_presrv_lcrsp_new_e</span><span class=""> 
</span><span class="">                  </span><span class="">read_smpl_msgR_presrv_lcrsp_new_e</span><span class=""> </span><span class="">get_smpl_pidR_presrv_lcrsp_new_e</span><span class="">
</span><span class="">                  </span><span class="">get_smpl_pstsR_presrv_lcrsp_new_e</span><span class=""> </span><span class="">crt_que_portR_presrv_lcrsp_new_e</span><span class="">
</span><span class="">                  </span><span class="">snd_que_msg_lstR_presrv_lcrsp_new_e</span><span class=""> </span><span class="">rec_que_msgR_presrv_lcrsp_new_e</span><span class="">
</span><span class="">                  </span><span class="">get_que_pidR_presrv_lcrsp_new_e</span><span class=""> </span><span class="">get_que_pstsR_presrv_lcrsp_new_e</span><span class="">
</span><span class="">                  </span><span class="">clr_que_portR_presrv_lcrsp_new_e</span><span class=""> </span><span class="">set_part_modeR_presrv_lcrsp_new_e</span><span class="">
</span><span class="">                  </span><span class="">get_part_statusR_presrv_lcrsp_new_e</span><span class=""> </span><span class="">create_process_presrv_lcrsp_new_e</span><span class="">     
</span><span class="">                  </span><span class="">start_process_presrv_lcrsp_new_e</span><span class=""> </span><span class="">stop_process_presrv_lcrsp_new_e</span><span class=""> 
</span><span class="">                  </span><span class="">resume_process_presrv_lcrsp_new_e</span><span class=""> </span><span class="">suspend_process_presrv_lcrsp_new_e</span><span class="">
</span><span class="">                  </span><span class="">set_process_priority_presrv_lcrsp_new_e</span><span class=""> </span><span class="">get_process_status_presrv_lcrsp_new_e</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">Hypercall&#39;.induct</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1">using</span><span class=""> </span><span class="">scheduleR_presrv_lcrsp_new_e</span><span class=""> </span><span class="">trans_smpl_msgR_presrv_lcrsp_new_e</span><span class="">
</span><span class="">                  </span><span class="">trans_que_msg_mlostR_presrv_lcrsp_new_e</span><span class=""> </span><span class="">schedule_process_presrv_lcrsp_new_e</span><span class=""> 
</span><span class="">          </span><span class="keyword1">by</span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">System_EventR.induct</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1">}</span><span class="">
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">local_respect_new_all_evt</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">subsection</span><span class="verbatim">{* Existing events preserve &quot;step consistent&quot; on new state variables *}</span><span class=""> 
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">crt_smpl_portR_presrv_wk_stp_cons_new</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> 
</span><span class="">              </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. d .&#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (create_sampling_portR sysconf s pname)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = fst (create_sampling_portR sysconf t pname)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s&#39; &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> t&#39;&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">crt_smpl_portR_presrv_wk_stp_cons_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;weak_step_consistent_new_e (hyperc&#39; (Create_Sampling_Port pn))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">crt_smpl_portR_presrv_wk_stp_cons_new</span><span class=""> </span><span class="">weak_step_consistent_new_e_def</span><span class=""> 
</span><span class="">      </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">domain_of_eventR_def</span><span class=""> </span><span class="">event_enabledR_def</span><span class=""> </span><span class="">same_part_mode</span><span class=""> </span><span class="">sched_vpeq</span><span class="">
</span><span class="">        </span><span class="">non_interference1_def</span><span class=""> </span><span class="">non_interference_def</span><span class=""> </span><span class="">singletonD</span><span class=""> 
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">EventR.case</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Hypercall&#39;.case</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="">abstract_state_def</span><span class=""> </span><span class="">domain_of_eventR_hc</span><span class=""> </span><span class="">event_enabledR_hc</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> 
</span><span class="">                </span><span class="">singletonD</span><span class=""> </span><span class="">vpeqR_def</span><span class=""> </span><span class="">option.sel</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">wrt_smpl_msgR_presrv_wk_stp_cons_new</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. d .&#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (write_sampling_messageR s pid m)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = fst (write_sampling_messageR t pid m)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s&#39; &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> t&#39;&quot;</span><span class="">
</span><span class="">   </span><span class="keyword1">using</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">wrt_smpl_msgR_presrv_wk_stp_cons_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;weak_step_consistent_new_e (hyperc&#39; (Write_Sampling_Message p m))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">wrt_smpl_msgR_presrv_wk_stp_cons_new</span><span class=""> </span><span class="">weak_step_consistent_new_e_def</span><span class=""> 
</span><span class="">      </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">domain_of_eventR_def</span><span class=""> </span><span class="">event_enabledR_def</span><span class=""> </span><span class="">same_part_mode</span><span class=""> </span><span class="">sched_vpeq</span><span class=""> 
</span><span class="">      </span><span class="">non_interference1_def</span><span class=""> </span><span class="">non_interference_def</span><span class=""> </span><span class="">singletonD</span><span class=""> </span><span class="">event_enabledR_hc</span><span class=""> </span><span class="">domain_of_eventR_hc</span><span class="">
</span><span class="">      </span><span class="">abstract_state_def</span><span class=""> </span><span class="">vpeqR_def</span><span class="">
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">EventR.case</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Hypercall&#39;.case</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="">abstract_state_def</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> </span><span class="">singletonD</span><span class="">  </span><span class="">option.sel</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">read_smpl_msgR_presrv_wk_stp_cons_new</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. d .&#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (read_sampling_messageR s pid)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = fst (read_sampling_messageR t pid)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s&#39; &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> t&#39;&quot;</span><span class="">  
</span><span class="">   </span><span class="keyword1">using</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">read_smpl_msgR_presrv_wk_stp_cons_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;weak_step_consistent_new_e (hyperc&#39; (Read_Sampling_Message p))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">read_smpl_msgR_presrv_wk_stp_cons_new</span><span class=""> </span><span class="">weak_step_consistent_new_e_def</span><span class=""> 
</span><span class="">      </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">domain_of_eventR_def</span><span class=""> </span><span class="">event_enabledR_def</span><span class=""> </span><span class="">same_part_mode</span><span class=""> </span><span class="">sched_vpeq</span><span class=""> 
</span><span class="">      </span><span class="">non_interference1_def</span><span class=""> </span><span class="">non_interference_def</span><span class=""> </span><span class="">singletonD</span><span class=""> 
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">EventR.case</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Hypercall&#39;.case</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="">abstract_state_def</span><span class=""> </span><span class="">domain_of_eventR_hc</span><span class=""> </span><span class="">event_enabledR_hc</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> 
</span><span class="">                </span><span class="">singletonD</span><span class=""> </span><span class="">vpeqR_def</span><span class=""> </span><span class="">option.sel</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_smpl_pidR_presrv_wk_stp_cons_new</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. d .&#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (get_sampling_port_idR sysconf s pname)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = fst (get_sampling_port_idR sysconf t pname)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s&#39; &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> t&#39;&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_smpl_pidR_presrv_wk_stp_cons_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;weak_step_consistent_new_e (hyperc&#39; (Get_Sampling_Portid p))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">get_smpl_pidR_presrv_wk_stp_cons_new</span><span class=""> </span><span class="">weak_step_consistent_new_e_def</span><span class=""> 
</span><span class="">      </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">domain_of_eventR_def</span><span class=""> </span><span class="">event_enabledR_def</span><span class=""> </span><span class="">same_part_mode</span><span class=""> </span><span class="">sched_vpeq</span><span class=""> 
</span><span class="">      </span><span class="">non_interference1_def</span><span class=""> </span><span class="">non_interference_def</span><span class=""> </span><span class="">singletonD</span><span class=""> 
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">EventR.case</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Hypercall&#39;.case</span><span class="delimiter">(</span><span class="">4</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="">abstract_state_def</span><span class=""> </span><span class="">domain_of_eventR_hc</span><span class=""> </span><span class="">event_enabledR_hc</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> 
</span><span class="">                </span><span class="">singletonD</span><span class=""> </span><span class="">vpeqR_def</span><span class=""> </span><span class="">option.sel</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_smpl_pstsR_presrv_wk_stp_cons_new</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. d .&#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (get_sampling_port_statusR sysconf s pid)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = fst (get_sampling_port_statusR sysconf t pid)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s&#39; &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> t&#39;&quot;</span><span class=""> 
</span><span class="">     </span><span class="keyword1">using</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_smpl_pstsR_presrv_wk_stp_cons_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;weak_step_consistent_new_e (hyperc&#39; (Get_Sampling_Portstatus p))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">get_smpl_pstsR_presrv_wk_stp_cons_new</span><span class=""> </span><span class="">weak_step_consistent_new_e_def</span><span class=""> 
</span><span class="">      </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">domain_of_eventR_def</span><span class=""> </span><span class="">event_enabledR_def</span><span class=""> </span><span class="">same_part_mode</span><span class=""> </span><span class="">sched_vpeq</span><span class=""> 
</span><span class="">      </span><span class="">non_interference1_def</span><span class=""> </span><span class="">non_interference_def</span><span class=""> </span><span class="">singletonD</span><span class=""> 
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">EventR.case</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Hypercall&#39;.case</span><span class="delimiter">(</span><span class="">5</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="">abstract_state_def</span><span class=""> </span><span class="">domain_of_eventR_hc</span><span class=""> </span><span class="">event_enabledR_hc</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> 
</span><span class="">                </span><span class="">singletonD</span><span class=""> </span><span class="">vpeqR_def</span><span class=""> </span><span class="">option.sel</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">crt_que_portR_presrv_wk_stp_cons_new</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. d .&#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (create_queuing_portR sysconf s pname)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = fst (create_queuing_portR sysconf t pname)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s&#39; &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> t&#39;&quot;</span><span class="">
</span><span class="">     </span><span class="keyword1">using</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">crt_que_portR_presrv_wk_stp_cons_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;weak_step_consistent_new_e (hyperc&#39; (Create_Queuing_Port p))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">crt_que_portR_presrv_wk_stp_cons_new</span><span class=""> </span><span class="">weak_step_consistent_new_e_def</span><span class=""> 
</span><span class="">      </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">domain_of_eventR_def</span><span class=""> </span><span class="">event_enabledR_def</span><span class=""> </span><span class="">same_part_mode</span><span class=""> </span><span class="">sched_vpeq</span><span class=""> 
</span><span class="">      </span><span class="">non_interference1_def</span><span class=""> </span><span class="">non_interference_def</span><span class=""> </span><span class="">singletonD</span><span class=""> 
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">EventR.case</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Hypercall&#39;.case</span><span class="delimiter">(</span><span class="">6</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="">abstract_state_def</span><span class=""> </span><span class="">domain_of_eventR_hc</span><span class=""> </span><span class="">event_enabledR_hc</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> 
</span><span class="">                </span><span class="">singletonD</span><span class=""> </span><span class="">vpeqR_def</span><span class=""> </span><span class="">option.sel</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">snd_que_msg_lstR_presrv_wk_stp_cons_new</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> 
</span><span class="">              </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. d .&#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (send_queuing_message_maylostR sysconf s pid m)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = fst (send_queuing_message_maylostR sysconf t pid m)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s&#39; &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> t&#39;&quot;</span><span class="">
</span><span class="">     </span><span class="keyword1">using</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">snd_que_msg_lstR_presrv_wk_stp_cons_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;weak_step_consistent_new_e (hyperc&#39; (Send_Queuing_Message p m))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">snd_que_msg_lstR_presrv_wk_stp_cons_new</span><span class=""> </span><span class="">weak_step_consistent_new_e_def</span><span class=""> 
</span><span class="">      </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">domain_of_eventR_def</span><span class=""> </span><span class="">event_enabledR_def</span><span class=""> </span><span class="">same_part_mode</span><span class=""> </span><span class="">sched_vpeq</span><span class=""> 
</span><span class="">      </span><span class="">non_interference1_def</span><span class=""> </span><span class="">non_interference_def</span><span class=""> </span><span class="">singletonD</span><span class=""> 
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">EventR.case</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Hypercall&#39;.case</span><span class="delimiter">(</span><span class="">7</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="">abstract_state_def</span><span class=""> </span><span class="">domain_of_eventR_hc</span><span class=""> </span><span class="">event_enabledR_hc</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> 
</span><span class="">                </span><span class="">singletonD</span><span class=""> </span><span class="">vpeqR_def</span><span class=""> </span><span class="">option.sel</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">rec_que_msgR_presrv_wk_stp_cons_new</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. d .&#8764; t&quot;</span><span class="">                
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (receive_queuing_messageR s pid)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = fst (receive_queuing_messageR t pid)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s&#39; &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> t&#39;&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">rec_que_msgR_presrv_wk_stp_cons_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;weak_step_consistent_new_e (hyperc&#39; (Receive_Queuing_Message p))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">rec_que_msgR_presrv_wk_stp_cons_new</span><span class=""> </span><span class="">weak_step_consistent_new_e_def</span><span class=""> 
</span><span class="">      </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">domain_of_eventR_def</span><span class=""> </span><span class="">event_enabledR_def</span><span class=""> </span><span class="">same_part_mode</span><span class=""> </span><span class="">sched_vpeq</span><span class=""> 
</span><span class="">      </span><span class="">non_interference1_def</span><span class=""> </span><span class="">non_interference_def</span><span class=""> </span><span class="">singletonD</span><span class=""> 
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">EventR.case</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Hypercall&#39;.case</span><span class="delimiter">(</span><span class="">8</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="">abstract_state_def</span><span class=""> </span><span class="">domain_of_eventR_hc</span><span class=""> </span><span class="">event_enabledR_hc</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> 
</span><span class="">                </span><span class="">singletonD</span><span class=""> </span><span class="">vpeqR_def</span><span class=""> </span><span class="">option.sel</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_que_pidR_presrv_wk_stp_cons_new</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. d .&#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (get_queuing_port_idR sysconf s pname)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = fst (get_queuing_port_idR sysconf t pname)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s&#39; &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> t&#39;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_que_pidR_presrv_wk_stp_cons_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;weak_step_consistent_new_e (hyperc&#39; (Get_Queuing_Portid p))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">get_que_pidR_presrv_wk_stp_cons_new</span><span class=""> </span><span class="">weak_step_consistent_new_e_def</span><span class=""> 
</span><span class="">      </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">domain_of_eventR_def</span><span class=""> </span><span class="">event_enabledR_def</span><span class=""> </span><span class="">same_part_mode</span><span class=""> </span><span class="">sched_vpeq</span><span class=""> 
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">EventR.case</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Hypercall&#39;.case</span><span class="delimiter">(</span><span class="">9</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="">abstract_state_def</span><span class=""> </span><span class="">domain_of_eventR_hc</span><span class=""> </span><span class="">event_enabledR_hc</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> 
</span><span class="">                </span><span class="">singletonD</span><span class=""> </span><span class="">vpeqR_def</span><span class=""> </span><span class="">option.sel</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_que_pstsR_presrv_wk_stp_cons_new</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. d .&#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (get_queuing_port_statusR sysconf s pid)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = fst (get_queuing_port_statusR sysconf t pid)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s&#39; &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> t&#39;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_que_pstsR_presrv_wk_stp_cons_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;weak_step_consistent_new_e (hyperc&#39; (Get_Queuing_Portstatus p))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">get_que_pstsR_presrv_wk_stp_cons_new</span><span class=""> </span><span class="">weak_step_consistent_new_e_def</span><span class=""> 
</span><span class="">      </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">domain_of_eventR_def</span><span class=""> </span><span class="">event_enabledR_def</span><span class=""> </span><span class="">same_part_mode</span><span class=""> </span><span class="">sched_vpeq</span><span class=""> 
</span><span class="">      </span><span class="">non_interference1_def</span><span class=""> </span><span class="">non_interference_def</span><span class=""> </span><span class="">singletonD</span><span class=""> 
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">EventR.case</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Hypercall&#39;.case</span><span class="delimiter">(</span><span class="">10</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="">abstract_state_def</span><span class=""> </span><span class="">domain_of_eventR_hc</span><span class=""> </span><span class="">event_enabledR_hc</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> 
</span><span class="">                </span><span class="">singletonD</span><span class=""> </span><span class="">vpeqR_def</span><span class=""> </span><span class="">option.sel</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">clr_que_portR_presrv_wk_stp_cons_new</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. d .&#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = clear_queuing_portR s pid&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = clear_queuing_portR t pid&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s&#39; &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> t&#39;&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">using</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">clr_que_portR_presrv_wk_stp_cons_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;weak_step_consistent_new_e (hyperc&#39; (Clear_Queuing_Port p))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">clr_que_portR_presrv_wk_stp_cons_new</span><span class=""> </span><span class="">weak_step_consistent_new_e_def</span><span class=""> 
</span><span class="">      </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">domain_of_eventR_def</span><span class=""> </span><span class="">event_enabledR_def</span><span class=""> </span><span class="">same_part_mode</span><span class=""> </span><span class="">sched_vpeq</span><span class=""> 
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">EventR.case</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Hypercall&#39;.case</span><span class="delimiter">(</span><span class="">11</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="">abstract_state_def</span><span class=""> </span><span class="">domain_of_eventR_hc</span><span class=""> </span><span class="">event_enabledR_hc</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> 
</span><span class="">                </span><span class="">singletonD</span><span class=""> </span><span class="">vpeqR_def</span><span class=""> </span><span class="">option.sel</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_part_statusR_presrv_wk_stp_cons_new</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. d .&#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (get_partition_statusR sysconf s)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = fst (get_partition_statusR sysconf t)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s&#39; &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> t&#39;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_part_statusR_presrv_wk_stp_cons_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;weak_step_consistent_new_e (hyperc&#39; Get_Partition_Status)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">get_part_statusR_presrv_wk_stp_cons_new</span><span class=""> </span><span class="">weak_step_consistent_new_e_def</span><span class=""> 
</span><span class="">      </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">domain_of_eventR_def</span><span class=""> </span><span class="">event_enabledR_def</span><span class=""> </span><span class="">same_part_mode</span><span class=""> </span><span class="">sched_vpeq</span><span class=""> 
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">EventR.case</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Hypercall&#39;.case</span><span class="delimiter">(</span><span class="">13</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="">abstract_state_def</span><span class=""> </span><span class="">domain_of_eventR_hc</span><span class=""> </span><span class="">event_enabledR_hc</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> 
</span><span class="">                </span><span class="">singletonD</span><span class=""> </span><span class="">vpeqR_def</span><span class=""> </span><span class="">option.sel</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">scheduleR_presrv_wk_stp_cons_new</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. d .&#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;s&#39; &#8712; scheduleR sysconf s&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;t&#39; &#8712; scheduleR sysconf t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s&#39; &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> t&#39;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">scheduleR_presrv_wk_stp_cons_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;weak_step_consistent_new_e (sys&#39; Schedule)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">scheduleR_presrv_wk_stp_cons_new</span><span class=""> </span><span class="">weak_step_consistent_new_e_def</span><span class=""> 
</span><span class="">      </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">same_part_mode</span><span class=""> </span><span class="">sched_vpeq</span><span class=""> 
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">EventR.case</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">System_EventR.case</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="">abstract_state_def</span><span class=""> </span><span class="">domain_of_eventR_sys</span><span class=""> </span><span class="">event_enabledR_sys</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> 
</span><span class="">                </span><span class="">singletonD</span><span class=""> </span><span class="">vpeqR_def</span><span class=""> </span><span class="">option.sel</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">trans_smpl_msgR_presrv_wk_stp_cons_new</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> 
</span><span class="">              </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. d .&#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = transf_sampling_msgR s c&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = transf_sampling_msgR t c&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s&#39; &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> t&#39;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">trans_smpl_msgR_presrv_wk_stp_cons_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;weak_step_consistent_new_e (sys&#39; (Transfer_Sampling_Message c))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">trans_smpl_msgR_presrv_wk_stp_cons_new</span><span class=""> </span><span class="">weak_step_consistent_new_e_def</span><span class=""> 
</span><span class="">      </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">same_part_mode</span><span class=""> </span><span class="">is_a_transmitter_def</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="">vpeq_sched_def</span><span class="">
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">EventR.case</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">System_EventR.case</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="">abstract_state_def</span><span class=""> </span><span class="">domain_of_eventR_sys</span><span class=""> </span><span class="">event_enabledR_sys</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> 
</span><span class="">                </span><span class="">singletonD</span><span class=""> </span><span class="">vpeqR_def</span><span class=""> </span><span class="">option.sel</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">trans_que_msg_mlostR_presrv_wk_stp_cons_new</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. d .&#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = transf_queuing_msg_maylostR sysconf s c&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = transf_queuing_msg_maylostR sysconf t c&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s&#39; &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> t&#39;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">trans_que_msg_mlostR_presrv_wk_stp_cons_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;weak_step_consistent_new_e (sys&#39; (Transfer_Queuing_Message c))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">trans_que_msg_mlostR_presrv_wk_stp_cons_new</span><span class=""> </span><span class="">weak_step_consistent_new_e_def</span><span class=""> 
</span><span class="">      </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">same_part_mode</span><span class=""> </span><span class="">is_a_transmitter_def</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="">vpeq_sched_def</span><span class=""> 
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">EventR.case</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">System_EventR.case</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="">abstract_state_def</span><span class=""> </span><span class="">domain_of_eventR_sys</span><span class=""> </span><span class="">event_enabledR_sys</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> 
</span><span class="">                </span><span class="">singletonD</span><span class=""> </span><span class="">vpeqR_def</span><span class=""> </span><span class="">option.sel</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">set_procs_to_normal_presrv_wk_stp_cons_new</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="">      
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. d .&#8764; t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. (scheduler sysconf) .&#8764; t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = set_procs_to_normal s (current s)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p5</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = set_procs_to_normal t (current t)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s&#39; &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> t&#39;&quot;</span><span class="">  
</span><span class="">    </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1">from</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(partitions s) d = (partitions t) d&quot;</span><span class="">         
</span><span class="">        </span><span class="keyword1">using</span><span class=""> </span><span class="">part_imp_not_sch</span><span class=""> </span><span class="">part_imp_not_tras</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">force</span><span class="">            
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p5</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">remove_partition_resources_presrv_wk_stp_cons_new</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. d .&#8764; t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. (scheduler sysconf) .&#8764; t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = remove_partition_resources s (current s)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p5</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = remove_partition_resources t (current t)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s&#39; &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> t&#39;&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1">from</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(partitions s) d = (partitions t) d&quot;</span><span class=""> 
</span><span class="">         </span><span class="keyword1">using</span><span class=""> </span><span class="">part_imp_not_sch</span><span class=""> </span><span class="">part_imp_not_tras</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">force</span><span class="">            
</span><span class="">       </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class="">  </span><span class="">p4</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">      
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">set_part_modeR_presrv_wk_stp_cons_new</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s &#8743; reachable0 t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. d .&#8764; t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. (scheduler sysconf) .&#8764; t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p5</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8605; d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p6</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. (current s) .&#8764; t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p7</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = set_partition_modeR sysconf s m&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p8</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = set_partition_modeR sysconf t m&quot;</span><span class="">
</span><span class="">   </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s&#39; &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> t&#39;&quot;</span><span class="">
</span><span class="">   </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;current s = d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;current s = d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">with</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(partitions s) d = (partitions t) d&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1">using</span><span class=""> </span><span class="">part_imp_not_sch</span><span class=""> </span><span class="">part_imp_not_tras</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">force</span><span class="">
</span><span class="">          </span><span class="keyword3">thus</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">        
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;current s &#8800; d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">with</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;vpeq_part_procs s d s&#39;&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">        </span><span class="keyword1">from</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;vpeq_part_procs t d t&#39;&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">        </span><span class="keyword1">from</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">  </span><span class="keyword1">next</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">            
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">set_part_modeR_presrv_wk_stp_cons_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;weak_step_consistent_new_e (hyperc&#39; (Set_Partition_Mode p))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">set_part_modeR_presrv_wk_stp_cons_new</span><span class=""> </span><span class="">weak_step_consistent_new_e_def</span><span class=""> 
</span><span class="">      </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">same_part_mode</span><span class=""> </span><span class="">sched_vpeq</span><span class=""> </span><span class="">singletonD</span><span class=""> </span><span class="">EventR.case</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Hypercall&#39;.case</span><span class="delimiter">(</span><span class="">12</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="">abstract_state_def</span><span class=""> </span><span class="">domain_of_eventR_hc</span><span class=""> </span><span class="">event_enabledR_hc</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> 
</span><span class="">                </span><span class="">singletonD</span><span class=""> </span><span class="">vpeqR_def</span><span class=""> </span><span class="">option.sel</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">subsection</span><span class="verbatim">{* New events preserve &quot;step consistent&quot; on new state variables *}</span><span class=""> 
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;Create process&quot;*}</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">create_process_presrv_wk_stp_cons_new</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">        
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. d .&#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. (scheduler sysconf) .&#8764; t&quot;</span><span class="">        
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. (current s) .&#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p5</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (create_process s pri)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p6</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = fst (create_process t pri)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s&#39; &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> t&#39;&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">from</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;current s = current t&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> 
</span><span class="">          </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;current s = d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;current s = d&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">with</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(partitions s) d = (partitions t) d&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">part_imp_not_sch</span><span class=""> </span><span class="">part_imp_not_tras</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">force</span><span class="">              
</span><span class="">              </span><span class="keyword3">thus</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">p1</span><span class="">  </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class="">  </span><span class="">p6</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">             
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;current s &#8800; d&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">with</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;vpeq_part_procs s d s&#39;&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">create_process_vpeq_part_procs</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">p5</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1">moreover</span><span class=""> </span><span class="keyword1">from</span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;vpeq_part_procs t d t&#39;&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">create_process_vpeq_part_procs</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">b0</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1">ultimately</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">p2</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">          </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">create_process_presrv_wk_stp_cons_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;weak_step_consistent_new_e (hyperc&#39; (Create_Process p))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">create_process_presrv_wk_stp_cons_new</span><span class=""> </span><span class="">weak_step_consistent_new_e_def</span><span class=""> </span><span class="">exec_eventR_def</span><span class=""> 
</span><span class="">       </span><span class="">same_part_mode</span><span class=""> </span><span class="">sched_vpeq</span><span class="">
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">EventR.case</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Hypercall&#39;.case</span><span class="delimiter">(</span><span class="">14</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="">abstract_state_def</span><span class=""> </span><span class="">domain_of_eventR_hc</span><span class=""> </span><span class="">event_enabledR_hc</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> 
</span><span class="">                </span><span class="">singletonD</span><span class=""> </span><span class="">vpeqR_def</span><span class=""> </span><span class="">option.sel</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;set process priority&quot;*}</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">set_process_priority_presrv_wk_stp_cons_new</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s &#8743; reachable0 t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. d .&#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. (scheduler sysconf) .&#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p5</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. (current s) .&#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p6</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = set_process_priority s pr pri&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p7</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = set_process_priority t pr pri&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s&#39; &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> t&#39;&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">from</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;current s = current t&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;current s = d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;current s = d&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">with</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(partitions s) d = (partitions t) d&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">part_imp_not_sch</span><span class=""> </span><span class="">part_imp_not_tras</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">force</span><span class="">       
</span><span class="">            </span><span class="keyword3">thus</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class="">  </span><span class="">p1</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">p5</span><span class="">  </span><span class="">p4</span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;current s &#8800; d&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">with</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;vpeq_part_procs s d s&#39;&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1">from</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;vpeq_part_procs t d t&#39;&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1">from</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">set_process_priority_presrv_wk_stp_cons_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;weak_step_consistent_new_e (hyperc&#39; (Set_Priority p pri))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">set_process_priority_presrv_wk_stp_cons_new</span><span class=""> </span><span class="">weak_step_consistent_new_e_def</span><span class=""> 
</span><span class="">      </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">same_part_mode</span><span class=""> </span><span class="">sched_vpeq</span><span class=""> </span><span class="">domain_of_eventR_hc</span><span class=""> </span><span class="">event_enabledR_hc</span><span class=""> 
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">EventR.case</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Hypercall&#39;.case</span><span class="delimiter">(</span><span class="">19</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="">abstract_state_def</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> </span><span class="">old.prod.case</span><span class=""> </span><span class="">singletonD</span><span class=""> </span><span class="">vpeqR_def</span><span class=""> </span><span class="">option.sel</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;start process&quot;*}</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">start_process_presrv_wk_stp_cons_new</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s &#8743; reachable0 t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. d .&#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. (scheduler sysconf) .&#8764; t&quot;</span><span class="">       
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p5</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. (current s) .&#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p6</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = start_process s pr&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p7</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = start_process t pr&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s&#39; &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> t&#39;&quot;</span><span class=""> 
</span><span class=""> </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">from</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;current s = current t&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;current s = d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;current s = d&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">with</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(partitions s) d = (partitions t) d&quot;</span><span class=""> 
</span><span class="">            </span><span class="keyword1">using</span><span class=""> </span><span class="">part_imp_not_sch</span><span class=""> </span><span class="">part_imp_not_tras</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">force</span><span class="">       
</span><span class="">          </span><span class="keyword3">thus</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class="">  </span><span class="">p1</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">p5</span><span class="">  </span><span class="">p4</span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1">next</span><span class="">
</span><span class="">          </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;current s &#8800; d&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">with</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;vpeq_part_procs s d s&#39;&quot;</span><span class=""> 
</span><span class="">            </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">from</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;vpeq_part_procs t d t&#39;&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">from</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">next</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">     
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">start_process_presrv_wk_stp_cons_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;weak_step_consistent_new_e (hyperc&#39; (Start_Process p))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">start_process_presrv_wk_stp_cons_new</span><span class=""> </span><span class="">weak_step_consistent_new_e_def</span><span class=""> 
</span><span class="">      </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">same_part_mode</span><span class=""> </span><span class="">sched_vpeq</span><span class="">
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">EventR.case</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Hypercall&#39;.case</span><span class="delimiter">(</span><span class="">15</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="">abstract_state_def</span><span class=""> </span><span class="">domain_of_eventR_hc</span><span class=""> </span><span class="">event_enabledR_hc</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> 
</span><span class="">                </span><span class="">singletonD</span><span class=""> </span><span class="">vpeqR_def</span><span class=""> </span><span class="">option.sel</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;stop process&quot;*}</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">stop_process_presrv_wk_stp_cons_new</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s &#8743; reachable0 t&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. d .&#8764; t&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. (scheduler sysconf) .&#8764; t&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p5</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. (current s) .&#8764; t&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p6</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = stop_process s pr&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p7</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = stop_process t pr&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s&#39; &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> t&#39;&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">stop_process_presrv_wk_stp_cons_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;weak_step_consistent_new_e (hyperc&#39; (Stop_Process p))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">stop_process_presrv_wk_stp_cons_new</span><span class=""> </span><span class="">weak_step_consistent_new_e_def</span><span class=""> 
</span><span class="">      </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">same_part_mode</span><span class=""> </span><span class="">sched_vpeq</span><span class="">
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">EventR.case</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Hypercall&#39;.case</span><span class="delimiter">(</span><span class="">16</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="">abstract_state_def</span><span class=""> </span><span class="">domain_of_eventR_hc</span><span class=""> </span><span class="">event_enabledR_hc</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> 
</span><span class="">                </span><span class="">singletonD</span><span class=""> </span><span class="">vpeqR_def</span><span class=""> </span><span class="">option.sel</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;suspend process&quot;*}</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">suspend_process_presrv_wk_stp_cons_new</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s &#8743; reachable0 t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. d .&#8764; t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. (scheduler sysconf) .&#8764; t&quot;</span><span class="">     
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p5</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. (current s) .&#8764; t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p6</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = suspend_process s pr&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p7</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = suspend_process t pr&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s&#39; &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> t&#39;&quot;</span><span class="">
</span><span class="keyword1">using</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">suspend_process_presrv_wk_stp_cons_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;weak_step_consistent_new_e (hyperc&#39; (Suspend_Process p))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">suspend_process_presrv_wk_stp_cons_new</span><span class=""> </span><span class="">weak_step_consistent_new_e_def</span><span class=""> 
</span><span class="">      </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">same_part_mode</span><span class=""> </span><span class="">sched_vpeq</span><span class="">
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">EventR.case</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Hypercall&#39;.case</span><span class="delimiter">(</span><span class="">18</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="">abstract_state_def</span><span class=""> </span><span class="">domain_of_eventR_hc</span><span class=""> </span><span class="">event_enabledR_hc</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> 
</span><span class="">                </span><span class="">singletonD</span><span class=""> </span><span class="">vpeqR_def</span><span class=""> </span><span class="">option.sel</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;resume process&quot;*}</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">resume_process_presrv_wk_stp_cons_new</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s &#8743; reachable0 t&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. d .&#8764; t&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. (scheduler sysconf) .&#8764; t&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p5</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. (current s) .&#8764; t&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p6</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = resume_process s pr&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p7</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = resume_process t pr&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s&#39; &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> t&#39;&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">resume_process_presrv_wk_stp_cons_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;weak_step_consistent_new_e (hyperc&#39; (Resume_Process p))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">resume_process_presrv_wk_stp_cons_new</span><span class=""> </span><span class="">weak_step_consistent_new_e_def</span><span class=""> 
</span><span class="">      </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">same_part_mode</span><span class=""> </span><span class="">sched_vpeq</span><span class="">
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">EventR.case</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Hypercall&#39;.case</span><span class="delimiter">(</span><span class="">17</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="">abstract_state_def</span><span class=""> </span><span class="">domain_of_eventR_hc</span><span class=""> </span><span class="">event_enabledR_hc</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> 
</span><span class="">                </span><span class="">singletonD</span><span class=""> </span><span class="">vpeqR_def</span><span class=""> </span><span class="">option.sel</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;get process status&quot;*}</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_process_status_presrv_wk_stp_cons_new</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. d .&#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (get_process_status s pr)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = fst (get_process_status t pr)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s&#39; &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> t&#39;&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = s&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = t&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_process_status_presrv_wk_stp_cons_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;weak_step_consistent_new_e (hyperc&#39; (Get_Process_Status p))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">get_process_status_presrv_wk_stp_cons_new</span><span class=""> </span><span class="">weak_step_consistent_new_e_def</span><span class=""> 
</span><span class="">      </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">domain_of_eventR_def</span><span class=""> </span><span class="">event_enabledR_def</span><span class=""> </span><span class="">same_part_mode</span><span class=""> </span><span class="">sched_vpeq</span><span class=""> 
</span><span class="">      </span><span class="">non_interference1_def</span><span class=""> </span><span class="">non_interference_def</span><span class=""> </span><span class="">singletonD</span><span class=""> 
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">EventR.case</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Hypercall&#39;.case</span><span class="delimiter">(</span><span class="">20</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="">abstract_state_def</span><span class=""> </span><span class="">domain_of_eventR_hc</span><span class=""> </span><span class="">event_enabledR_hc</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> 
</span><span class="">                </span><span class="">singletonD</span><span class=""> </span><span class="">vpeqR_def</span><span class=""> </span><span class="">option.sel</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;schedule process&quot;*}</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">setrun2ready_presrv_wk_stp_cons_new</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> 
</span><span class="">              </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. d .&#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. (scheduler sysconf) .&#8764; t&quot;</span><span class="">        
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = setRun2Ready s&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = setRun2Ready t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s&#39; &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> t&#39;&quot;</span><span class="">
</span><span class="">     </span><span class="keyword1">using</span><span class="">  </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">schedule_process_presrv_wk_stp_cons_new</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s &#8743; reachable0 t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. d .&#8764; t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. (scheduler sysconf) .&#8764; t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p5</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8605; d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p6</span><span class="delimiter">:</span><span class="string">&quot;s &#8764;. (current s) .&#8764; t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p7</span><span class="delimiter">:</span><span class="string">&quot;s&#39; &#8712; schedule_process s&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p8</span><span class="delimiter">:</span><span class="string">&quot;t&#39; &#8712; schedule_process t&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s&#39; &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> t&#39;&quot;</span><span class="">
</span><span class="">   
</span><span class="">    </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">from</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;current s = current t&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1">using</span><span class=""> </span><span class="">sched_currentR_lemma</span><span class=""> </span><span class="">domain_of_eventR_hc</span><span class="">
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;current s = d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;current s = d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">with</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(partitions s) d = (partitions t) d&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1">using</span><span class=""> </span><span class="">part_imp_not_sch</span><span class=""> </span><span class="">part_imp_not_tras</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">force</span><span class=""> 
</span><span class="">        </span><span class="keyword1">from</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;vpeq_part_procs s d t&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">vpeqR_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1">with</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(procs s) d = (procs t) d &#8743;
                       (&#8704;p. (proc_state s) (d,p) = (proc_state t) (d,p))&#8743;
                       (cur_proc_part s) d = (cur_proc_part t) d&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1">with</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">r1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;procs s&#39; d = procs t&#39; d&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1">using</span><span class=""> </span><span class="">schedule_process_def</span><span class=""> </span><span class="">setRun2Ready_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">StateR.select_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">StateR.surjective</span><span class=""> 
</span><span class="">            </span><span class="">StateR.update_convs</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">StateR.update_convs</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class="">  </span><span class="">singletonD</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1">moreover</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="">r2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(cur_proc_part s&#39;) d = (cur_proc_part t&#39;) d &#8743; (&#8704;p. (proc_state s&#39;) (d,p) = (proc_state t&#39;) (d,p))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">          </span><span class="keyword1">let</span><span class=""> </span><span class="var">?cons</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;is_a_partition sysconf (current s) 
                    &#8743; part_mode (the ((partitions s) (current s))) = NORMAL&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">let</span><span class=""> </span><span class="var">?cont</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;is_a_partition sysconf (current t) 
                    &#8743; part_mode (the ((partitions t) (current t))) = NORMAL&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="">b9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?cons = ?cont&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">          </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> 
</span><span class="">          </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;?cons&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?cons&quot;</span><span class="">            
</span><span class="">            </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?cont&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">b9</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1">let</span><span class=""> </span><span class="var">?s&#39;</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;setRun2Ready s&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">let</span><span class=""> </span><span class="var">?readyprs</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;{p. p&#8712;the (procs ?s&#39; (current ?s&#39;)) &#8743; 
                                    state (the (proc_state ?s&#39; (current ?s&#39;,p))) = READY}&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">let</span><span class=""> </span><span class="var">?selp</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;SOME p. p&#8712;{x. state (the (proc_state ?s&#39; (current ?s&#39;,x))) = READY &#8743;
                                                   (&#8704;y&#8712;?readyprs. priority (the (proc_state ?s&#39; (current ?s&#39;,x))) &#8805;
                                                                priority (the (proc_state ?s&#39; (current ?s&#39;,y))))}&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">let</span><span class=""> </span><span class="var">?st</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;the ((proc_state ?s&#39;) (current ?s&#39;, ?selp))&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">let</span><span class=""> </span><span class="var">?proc_st</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;proc_state ?s&#39;&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">let</span><span class=""> </span><span class="var">?cur_pr</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;cur_proc_part ?s&#39;&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">from</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;schedule_process s = {?s&#39;&#10631;proc_state := ?proc_st ((current ?s&#39;, ?selp) := Some (?st&#10631;state := RUNNING&#10632;)),
                                             cur_proc_part := ?cur_pr(current ?s&#39; := Some ?selp)&#10632;}&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">schedule_process_def</span><span class=""> </span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">s</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            
</span><span class="">            </span><span class="keyword1">let</span><span class=""> </span><span class="var">?t&#39;</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;setRun2Ready t&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">let</span><span class=""> </span><span class="var">?readyprst</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;{p. p&#8712;the (procs ?t&#39; (current ?t&#39;)) &#8743; 
                                    state (the (proc_state ?t&#39; (current ?t&#39;,p))) = READY}&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">let</span><span class=""> </span><span class="var">?selpt</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;SOME p. p&#8712;{x. state (the (proc_state ?t&#39; (current ?t&#39;,x))) = READY &#8743;
                                                     (&#8704;y&#8712;?readyprst. priority (the (proc_state ?t&#39; (current ?t&#39;,x))) &#8805;
                                                                  priority (the (proc_state ?t&#39; (current ?t&#39;,y))))}&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">let</span><span class=""> </span><span class="var">?stt</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;the ((proc_state ?t&#39;) (current ?t&#39;, ?selpt))&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">let</span><span class=""> </span><span class="var">?proc_stt</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;proc_state ?t&#39;&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">let</span><span class=""> </span><span class="var">?cur_prt</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;cur_proc_part ?t&#39;&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">from</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;schedule_process t = {?t&#39;&#10631;proc_state := ?proc_stt ((current ?t&#39;, ?selpt) := Some (?stt&#10631;state := RUNNING&#10632;)),
                                             cur_proc_part := ?cur_prt(current ?t&#39; := Some ?selpt)&#10632;}&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">schedule_process_def</span><span class=""> </span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">t</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1">have</span><span class=""> </span><span class="">c4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?s&#39; &#8764;. d .&#8764;<span class="hidden">&#8681;</span><sub>&#916;</sub> ?t&#39;&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="">setrun2ready_presrv_wk_stp_cons_new</span><span class=""> 
</span><span class="">              </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">fastforce</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class="">setRun2Ready_def</span><span class=""> </span><span class="">vpeq_part_procs_def</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;((procs ?s&#39;) d = (procs ?t&#39;) d) &#8743;
                        (&#8704;p. (proc_state ?s&#39;) (d,p) = (proc_state ?t&#39;) (d,p)) &#8743;
                        (cur_proc_part ?s&#39;) d = (cur_proc_part ?t&#39;) d&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">                         
</span><span class="">            </span><span class="keyword1">have</span><span class=""> </span><span class="">c7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;current ?s&#39; = current ?t&#39;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> 
</span><span class="">              </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">            </span><span class="keyword1">have</span><span class=""> </span><span class="">c8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;current s = current ?s&#39;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">setrun2ready_nchastate_lemma</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">                                                             
</span><span class="">            </span><span class="keyword1">then</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class="">  </span><span class="">p7</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">c7</span><span class=""> </span><span class="">c8</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">a1</span><span class=""> 
</span><span class="">             </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">fastforce</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">setRun2Ready_def</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172; ?cons&quot;</span><span class="">
</span><span class="">            </span><span class="keyword3">thus</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="">b9</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">          </span><span class="keyword1">qed</span><span class="">        
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">        </span><span class="keyword1">ultimately</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;current s &#8800; d&quot;</span><span class="">                        
</span><span class="">        </span><span class="keyword1">from</span><span class="">  </span><span class="">p8</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">p3</span><span class="">   
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">schedule_process_vpeq_part_procs</span><span class="">
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">setRun2Ready_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">next</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">schedule_process_presrv_wk_stp_cons_new_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;weak_step_consistent_new_e (sys&#39; Schedule_Process)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">schedule_process_presrv_wk_stp_cons_new</span><span class=""> </span><span class="">weak_step_consistent_new_e_def</span><span class=""> 
</span><span class="">      </span><span class="">exec_eventR_def</span><span class=""> </span><span class="">same_part_mode</span><span class=""> </span><span class="">sched_vpeq</span><span class=""> 
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">EventR.case</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">System_EventR.case</span><span class="delimiter">(</span><span class="">4</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="">abstract_state_def</span><span class=""> </span><span class="">domain_of_eventR_sys</span><span class=""> </span><span class="">event_enabledR_sys</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> 
</span><span class="">                </span><span class="">singletonD</span><span class=""> </span><span class="">vpeqR_def</span><span class=""> </span><span class="">option.sel</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">subsection</span><span class="verbatim">{* Proving the &quot;step consistent&quot; property on new state variables *}</span><span class="">
</span><span class="">  </span><span class="keyword1">theorem</span><span class=""> </span><span class="">weak_step_consistent_new</span><span class="delimiter">:</span><span class="">weak_step_consistent_new</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1">{</span><span class="">
</span><span class="">        </span><span class="keyword3">fix</span><span class=""> </span><span class="">e</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;weak_step_consistent_new_e e&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">e</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1">using</span><span class=""> </span><span class="">crt_smpl_portR_presrv_wk_stp_cons_new_e</span><span class=""> </span><span class="">wrt_smpl_msgR_presrv_wk_stp_cons_new_e</span><span class=""> 
</span><span class="">                 </span><span class="">read_smpl_msgR_presrv_wk_stp_cons_new_e</span><span class=""> </span><span class="">get_smpl_pidR_presrv_wk_stp_cons_new_e</span><span class="">
</span><span class="">                 </span><span class="">get_smpl_pstsR_presrv_wk_stp_cons_new_e</span><span class=""> </span><span class="">crt_que_portR_presrv_wk_stp_cons_new_e</span><span class=""> 
</span><span class="">                 </span><span class="">snd_que_msg_lstR_presrv_wk_stp_cons_new_e</span><span class=""> </span><span class="">rec_que_msgR_presrv_wk_stp_cons_new_e</span><span class=""> 
</span><span class="">                 </span><span class="">get_que_pidR_presrv_wk_stp_cons_new_e</span><span class=""> </span><span class="">get_que_pstsR_presrv_wk_stp_cons_new_e</span><span class="">
</span><span class="">                 </span><span class="">clr_que_portR_presrv_wk_stp_cons_new_e</span><span class=""> </span><span class="">set_part_modeR_presrv_wk_stp_cons_new_e</span><span class=""> 
</span><span class="">                 </span><span class="">get_part_statusR_presrv_wk_stp_cons_new_e</span><span class=""> </span><span class="">create_process_presrv_wk_stp_cons_new_e</span><span class=""> 
</span><span class="">                 </span><span class="">start_process_presrv_wk_stp_cons_new_e</span><span class=""> </span><span class="">stop_process_presrv_wk_stp_cons_new_e</span><span class="">
</span><span class="">                 </span><span class="">resume_process_presrv_wk_stp_cons_new_e</span><span class=""> </span><span class="">suspend_process_presrv_wk_stp_cons_new_e</span><span class=""> 
</span><span class="">                 </span><span class="">set_process_priority_presrv_wk_stp_cons_new_e</span><span class=""> </span><span class="">get_process_status_presrv_wk_stp_cons_new_e</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">Hypercall&#39;.induct</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1">using</span><span class=""> </span><span class="">scheduleR_presrv_wk_stp_cons_new_e</span><span class=""> </span><span class="">trans_smpl_msgR_presrv_wk_stp_cons_new_e</span><span class="">
</span><span class="">              </span><span class="">trans_que_msg_mlostR_presrv_wk_stp_cons_new_e</span><span class=""> </span><span class="">schedule_process_presrv_wk_stp_cons_new_e</span><span class="">
</span><span class="">              </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">System_EventR.induct</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1">}</span><span class="">
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">weak_step_consistent_new_all_evt</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">subsection</span><span class="verbatim">{* Information flow security of second-level specification *}</span><span class="">
</span><span class="">  </span><span class="keyword1">theorem</span><span class=""> </span><span class="">noninfluence_sat</span><span class="delimiter">:</span><span class=""> </span><span class="">noninfluence</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">noninfl_refinement</span><span class=""> </span><span class="">local_respect_new</span><span class=""> </span><span class="">weak_step_consistent_new</span><span class="">
</span><span class="">      </span><span class="">local_respect</span><span class=""> </span><span class="">weak_step_consistent</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">theorem</span><span class=""> </span><span class="">noninfluence_gen_sat</span><span class="delimiter">:</span><span class=""> </span><span class="">noninfluence_gen</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">noninf_eq_noninf_gen</span><span class=""> </span><span class="">noninfluence_sat</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">
</span><span class="">  </span><span class="keyword1">theorem</span><span class=""> </span><span class="">weak_noninfluence_sat</span><span class="delimiter">:</span><span class=""> </span><span class="">weak_noninfluence</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">noninf_impl_weak</span><span class=""> </span><span class="">noninfluence_sat</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    
</span><span class="">  </span><span class="keyword1">theorem</span><span class=""> </span><span class="">nonleakage_sat</span><span class="delimiter">:</span><span class=""> </span><span class="">nonleakage</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">noninf_impl_nonlk</span><span class=""> </span><span class="">noninfluence_sat</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  
</span><span class="">  </span><span class="keyword1">theorem</span><span class=""> </span><span class="">noninterference_r_sat</span><span class="delimiter">:</span><span class=""> </span><span class="">noninterference_r</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">noninf_impl_nonintf_r</span><span class=""> </span><span class="">noninfluence_sat</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    
</span><span class="">  </span><span class="keyword1">theorem</span><span class=""> </span><span class="">noninterference_sat</span><span class="delimiter">:</span><span class=""> </span><span class="">noninterference</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">noninterference_r_sat</span><span class=""> </span><span class="">nonintf_r_impl_noninterf</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    
</span><span class="">  </span><span class="keyword1">theorem</span><span class=""> </span><span class="">weak_noninterference_r_sat</span><span class="delimiter">:</span><span class=""> </span><span class="">weak_noninterference_r</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">noninterference_r_sat</span><span class=""> </span><span class="">nonintf_r_impl_wk_nonintf_r</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    
</span><span class="">  </span><span class="keyword1">theorem</span><span class=""> </span><span class="">weak_noninterference_sat</span><span class="delimiter">:</span><span class=""> </span><span class="">weak_noninterference</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">noninterference_sat</span><span class=""> </span><span class="">nonintf_impl_weak</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">
</span><span class="keyword2">end</span><span class="">
</span></pre>

</div>
</body>
</html>
