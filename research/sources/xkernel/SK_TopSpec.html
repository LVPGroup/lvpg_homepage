<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Theory SK_TopSpec (Isabelle2016: February 2016)</title>
<link media="all" rel="stylesheet" type="text/css" href="isabelle.css"/>
</head>

<body>
<div class="head"><h1>Theory SK_TopSpec</h1>

<span class="command">theory</span> <span class="name">SK_TopSpec</span><br/>
<span class="keyword">imports</span> <a href="SK_SecurityModel.html"><span class="name">SK_SecurityModel</span></a><br/>

</div>
<div class="source">
<pre class="source"><span class="comment">(*
A refinement based formal specification and information flow security proofs 
for ARINC 653 compliant separation kernels
created by Yongwang ZHAO
School of Computer Science and Engineering, Nanyang Technological University, Singapore
School of Computer Science and Engineering, Beihang University, China
zhaoyongwang@gmail.com, ywzhao@ntu.edu.sg, zhaoyw@buaa.edu.cn
*)</span><span class="">
</span><span class="">
</span><span class="keyword1">section</span><span class=""> </span><span class="verbatim">{* Top-level Specification and security proofs *}</span><span class="">
</span><span class="">
</span><span class="keyword1">theory</span><span class=""> </span><span class="">SK_TopSpec</span><span class="">
</span><span class="keyword2">imports</span><span class=""> </span><span class="">SK_SecurityModel</span><span class="">
</span><span class="keyword2">begin</span><span class="">
</span><span class="">
</span><span class="keyword1">declare</span><span class=""> </span><span class="delimiter">[</span><span class="delimiter">[</span><span class=""> </span><span class="">smt_timeout</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="">90</span><span class=""> </span><span class="delimiter">]</span><span class="delimiter">]</span><span class="">
</span><span class="">
</span><span class="keyword1">subsection</span><span class=""> </span><span class="verbatim">{* Definitions *}</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class=""> </span><span class="verbatim">{* Data type, basic components, and system configuration *}</span><span class="">
</span><span class="">
</span><span class="keyword1">type_synonym</span><span class=""> </span><span class="">max_buffer_size</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="">nat</span><span class="">
</span><span class="keyword1">type_synonym</span><span class=""> </span><span class="">buffer_size</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="">nat</span><span class="">
</span><span class="keyword1">typedecl</span><span class=""> </span><span class="">Message</span><span class="">
</span><span class="">
</span><span class="keyword1">type_synonym</span><span class=""> </span><span class="">partition_id</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="">nat</span><span class="">
</span><span class="keyword1">type_synonym</span><span class=""> </span><span class="">partition_name</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="">string</span><span class="">
</span><span class="keyword1">type_synonym</span><span class=""> </span><span class="">domain_id</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="">nat</span><span class="">
</span><span class="keyword1">type_synonym</span><span class=""> </span><span class="">channel_id</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="">nat</span><span class="">
</span><span class="keyword1">type_synonym</span><span class=""> </span><span class="">channel_name</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="">string</span><span class="">
</span><span class="keyword1">datatype</span><span class=""> </span><span class="">port_direction</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="">SOURCE</span><span class=""> </span><span class="delimiter">|</span><span class=""> </span><span class="">DESTINATION</span><span class="">
</span><span class="keyword1">type_synonym</span><span class=""> </span><span class="">port_name</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="">string</span><span class="">
</span><span class="keyword1">type_synonym</span><span class=""> </span><span class="">port_id</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="">nat</span><span class="">
</span><span class="keyword1">datatype</span><span class=""> </span><span class="">Port_Type</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="">Queuing</span><span class=""> </span><span class="">port_id</span><span class=""> </span><span class="">port_name</span><span class=""> </span><span class="">max_buffer_size</span><span class=""> </span><span class="">port_direction</span><span class=""> </span><span class="string">&quot;Message set&quot;</span><span class="">
</span><span class="">                    </span><span class="delimiter">|</span><span class=""> </span><span class="">Sampling</span><span class=""> </span><span class="">port_id</span><span class=""> </span><span class="">port_name</span><span class=""> </span><span class="">port_direction</span><span class=""> </span><span class="string">&quot;Message option&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">datatype</span><span class=""> </span><span class="">Channel_Type</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="">Channel_Sampling</span><span class=""> </span><span class="">channel_name</span><span class=""> </span><span class="">port_name</span><span class=""> </span><span class="string">&quot;port_name set&quot;</span><span class=""> 
</span><span class="">                      </span><span class="delimiter">|</span><span class=""> </span><span class="">Channel_Queuing</span><span class=""> </span><span class="">channel_name</span><span class=""> </span><span class="">port_name</span><span class=""> </span><span class="">port_name</span><span class="">
</span><span class="">
</span><span class="keyword1">record</span><span class=""> </span><span class="">Communication_Config</span><span class=""> </span><span class="delimiter">=</span><span class=""> 
</span><span class="">          </span><span class="">ports_conf</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Port_Type set&quot;</span><span class="">
</span><span class="">          </span><span class="">channels_conf</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Channel_Type set&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">datatype</span><span class=""> </span><span class="">partition_type</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="">USER_PARTITION</span><span class=""> </span><span class="delimiter">|</span><span class=""> </span><span class="">SYSTEM_PARTITION</span><span class="">
</span><span class="keyword1">datatype</span><span class=""> </span><span class="">partition_mode_type</span><span class=""> </span><span class="delimiter">=</span><span class="">  </span><span class="">IDLE</span><span class=""> </span><span class="delimiter">|</span><span class=""> </span><span class="">WARM_START</span><span class=""> </span><span class="delimiter">|</span><span class=""> </span><span class="">COLD_START</span><span class=""> </span><span class="delimiter">|</span><span class=""> </span><span class="">NORMAL</span><span class="">
</span><span class="">
</span><span class="keyword1">datatype</span><span class=""> </span><span class="">Partition_Conf</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="">PartConf</span><span class=""> </span><span class="">partition_id</span><span class=""> </span><span class="">partition_name</span><span class=""> </span><span class="">partition_type</span><span class=""> </span><span class="string">&quot;port_name set&quot;</span><span class=""> 
</span><span class="">
</span><span class="keyword1">type_synonym</span><span class=""> </span><span class="">Partitions</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;partition_id &#8640; Partition_Conf&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">record</span><span class=""> </span><span class="">Sys_Config</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="">partconf</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="">Partitions</span><span class="">
</span><span class="">                    </span><span class="">commconf</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="">Communication_Config</span><span class="">
</span><span class="">                    </span><span class="">scheduler</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="">domain_id</span><span class=""> 
</span><span class="">                    </span><span class="">transmitter</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="">domain_id</span><span class=""> 
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class=""> </span><span class="verbatim">{* System state *}</span><span class="">
</span><span class="">
</span><span class="keyword1">type_synonym</span><span class=""> </span><span class="">Ports</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;port_id &#8640; Port_Type&quot;</span><span class=""> 
</span><span class="">
</span><span class="keyword1">type_synonym</span><span class=""> </span><span class="">Channels</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;channel_id &#8640; Channel_Type&quot;</span><span class="">
</span><span class="">          
</span><span class="keyword1">record</span><span class=""> </span><span class="">Communication_State</span><span class=""> </span><span class="delimiter">=</span><span class=""> 
</span><span class="">          </span><span class="">ports</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="">Ports</span><span class="">         
</span><span class="">
</span><span class="keyword1">record</span><span class=""> </span><span class="">Partition_State_Type</span><span class=""> </span><span class="delimiter">=</span><span class=""> 
</span><span class="">                  </span><span class="">part_mode</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="">partition_mode_type</span><span class="">
</span><span class="">
</span><span class="keyword1">type_synonym</span><span class=""> </span><span class="">Partitions_State</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;partition_id &#8640; Partition_State_Type&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">record</span><span class=""> </span><span class="">State</span><span class=""> </span><span class="delimiter">=</span><span class=""> 
</span><span class="">          </span><span class="">current</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="">domain_id</span><span class=""> 
</span><span class="">          </span><span class="">partitions</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="">Partitions_State</span><span class="">
</span><span class="">          </span><span class="">comm</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="">Communication_State</span><span class="">
</span><span class="">          </span><span class="">part_ports</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;port_id &#8640; partition_id&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class=""> </span><span class="verbatim">{* Events *}</span><span class="">
</span><span class="">
</span><span class="keyword1">datatype</span><span class=""> </span><span class="">Hypercall</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="">Create_Sampling_Port</span><span class=""> </span><span class="">port_name</span><span class="">
</span><span class="">                     </span><span class="delimiter">|</span><span class=""> </span><span class="">Write_Sampling_Message</span><span class=""> </span><span class="">port_id</span><span class=""> </span><span class="">Message</span><span class="">
</span><span class="">                     </span><span class="delimiter">|</span><span class=""> </span><span class="">Read_Sampling_Message</span><span class=""> </span><span class="">port_id</span><span class="">
</span><span class="">                     </span><span class="delimiter">|</span><span class=""> </span><span class="">Get_Sampling_Portid</span><span class=""> </span><span class="">port_name</span><span class="">
</span><span class="">                     </span><span class="delimiter">|</span><span class=""> </span><span class="">Get_Sampling_Portstatus</span><span class=""> </span><span class="">port_id</span><span class="">
</span><span class="">                     </span><span class="delimiter">|</span><span class=""> </span><span class="">Create_Queuing_Port</span><span class=""> </span><span class="">port_name</span><span class="">
</span><span class="">                     </span><span class="delimiter">|</span><span class=""> </span><span class="">Send_Queuing_Message</span><span class=""> </span><span class="">port_id</span><span class=""> </span><span class="">Message</span><span class="">
</span><span class="">                     </span><span class="delimiter">|</span><span class=""> </span><span class="">Receive_Queuing_Message</span><span class=""> </span><span class="">port_id</span><span class="">
</span><span class="">                     </span><span class="delimiter">|</span><span class=""> </span><span class="">Get_Queuing_Portid</span><span class=""> </span><span class="">port_name</span><span class="">
</span><span class="">                     </span><span class="delimiter">|</span><span class=""> </span><span class="">Get_Queuing_Portstatus</span><span class=""> </span><span class="">port_id</span><span class="">
</span><span class="">                     </span><span class="delimiter">|</span><span class=""> </span><span class="">Clear_Queuing_Port</span><span class=""> </span><span class="">port_id</span><span class="">
</span><span class="">                     </span><span class="delimiter">|</span><span class=""> </span><span class="">Set_Partition_Mode</span><span class=""> </span><span class="">partition_mode_type</span><span class="">
</span><span class="">                     </span><span class="delimiter">|</span><span class=""> </span><span class="">Get_Partition_Status</span><span class="">
</span><span class="">
</span><span class="keyword1">typedecl</span><span class=""> </span><span class="">Exception</span><span class="">
</span><span class="keyword1">typedecl</span><span class=""> </span><span class="">PartitionAction</span><span class="">
</span><span class="keyword1">datatype</span><span class=""> </span><span class="">System_Event</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="">Schedule</span><span class="">
</span><span class="">                        </span><span class="delimiter">|</span><span class=""> </span><span class="">Transfer_Sampling_Message</span><span class=""> </span><span class="">Channel_Type</span><span class="">
</span><span class="">                        </span><span class="delimiter">|</span><span class=""> </span><span class="">Transfer_Queuing_Message</span><span class=""> </span><span class="">Channel_Type</span><span class="">
</span><span class="">
</span><span class="keyword1">datatype</span><span class=""> </span><span class="">Event</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="">hyperc</span><span class=""> </span><span class="">Hypercall</span><span class=""> </span><span class="delimiter">|</span><span class=""> </span><span class="">sys</span><span class=""> </span><span class="">System_Event</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class=""> </span><span class="verbatim">{* Utility Functions used for Event Specification *}</span><span class="">
</span><span class="">
</span><span class="keyword1">primrec</span><span class=""> </span><span class="">get_partname_by_type</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Partition_Conf &#8658; partition_name&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;get_partname_by_type (PartConf _ pn _ _) = pn&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">primrec</span><span class=""> </span><span class="">get_partid_by_type</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Partition_Conf &#8658; partition_id&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;get_partid_by_type (PartConf pid _ _ _) = pid&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">is_a_samplingport</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;State &#8658; port_id &#8658; bool&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;is_a_samplingport s pid &#8801; case ((ports (comm s)) pid) of 
                                        Some (Sampling _ _ _ _) &#8658; True | 
                                        _ &#8658; False&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">is_a_queuingport</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;State &#8658; port_id &#8658; bool&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;is_a_queuingport s pid &#8801; case ((ports (comm s)) pid) of 
                                        Some (Queuing _ _ _ _ _) &#8658; True | 
                                        _ &#8658; False&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">is_source_port</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;State &#8658; port_id &#8658; bool&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;is_source_port s pid &#8801; 
          case ((ports (comm s)) pid) of 
              Some (Queuing _ _ _ SOURCE _) &#8658; True |
              Some (Sampling _ _ SOURCE _) &#8658; True |
              _ &#8658; False&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">is_dest_port</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;State &#8658; port_id &#8658; bool&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;is_dest_port s pid &#8801; 
            case ((ports (comm s)) pid) of 
                Some (Queuing _ _ _ DESTINATION _) &#8658; True |
                Some (Sampling _ _ DESTINATION _) &#8658; True |
                _ &#8658; False&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">is_a_port_of_partition</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;State &#8658; port_id &#8658; partition_id &#8658; bool&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;is_a_port_of_partition s port part &#8801; (part_ports s) port = Some part&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">is_samplingport_name</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Port_Type &#8658; port_name &#8658; bool&quot;</span><span class=""> 
</span><span class="keyword2">where</span><span class="">
</span><span class="string">&quot;is_samplingport_name p n 
   &#8801; case p of 
       (Queuing _ name _ _ _)        &#8658; False
     | (Sampling _ name _ _) &#8658; name=n
&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">is_queuingport_name</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Port_Type &#8658; port_name &#8658; bool&quot;</span><span class=""> 
</span><span class="keyword2">where</span><span class="">
</span><span class="string">&quot;is_queuingport_name p n 
   &#8801; case p of 
       (Queuing _ name _ _ _) &#8658; name = n
     | (Sampling _ name _ _) &#8658; False
&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">is_port_name</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Port_Type &#8658; port_name &#8658; bool&quot;</span><span class=""> 
</span><span class="keyword2">where</span><span class="">
</span><span class="string">&quot;is_port_name p n 
   &#8801; case p of 
       (Queuing _ name _ _ _) &#8658; name = n
     | (Sampling _ name _ _) &#8658; name = n
&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">get_samplingport_conf</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Sys_Config &#8658; port_name &#8658; Port_Type option&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;get_samplingport_conf sc pname &#8801; 
                  (if (&#8707;p. p &#8712; ports_conf (commconf sc) &#8743; is_samplingport_name p pname) 
                    then Some (SOME p . p &#8712; ports_conf (commconf sc) &#8743; is_samplingport_name p pname)
                    else None)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">get_queuingport_conf</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Sys_Config &#8658; port_name &#8658; Port_Type option&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;get_queuingport_conf sc pname &#8801; 
              (if (&#8707;p. p &#8712; ports_conf (commconf sc) &#8743; is_queuingport_name p pname) 
                then Some (SOME p . p &#8712; ports_conf (commconf sc) &#8743; is_queuingport_name p pname)
                else None)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">get_portid_by_name</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;State &#8658; port_name &#8658; port_id option&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;get_portid_by_name s pn &#8801; 
                  (if (&#8707;pid. is_port_name (the (ports (comm s) pid)) pn) 
                    then Some (SOME pid . is_port_name (the (ports (comm s) pid)) pn)
                    else None)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">get_portids_by_names</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;State &#8658; port_name set &#8658; (port_id option) set&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;get_portids_by_names s ps &#8801;  {x. (&#8707;y. y &#8712; ps &#8743; x = get_portid_by_name s y)}&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">get_portname_by_id</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;State &#8658; port_id &#8658; port_name option&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;get_portname_by_id s pid &#8801; 
          let p = ports (comm s) pid in
            case p of Some (Queuing _ name _ _ _) &#8658; Some name
                    | Some (Sampling _ name _ _) &#8658; Some name
                    | None &#8658; None&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">get_portname_by_type</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Port_Type &#8658; port_name&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;get_portname_by_type pt &#8801; case pt of (Queuing _ name _ _ _) &#8658; name
                                            | (Sampling _ name _ _) &#8658; name&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">get_portid_in_type</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Port_Type &#8658; port_id&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;get_portid_in_type pt &#8801; case pt of (Queuing pid _ _ _ _) &#8658; pid
                                            | (Sampling pid _ _ _) &#8658; pid&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">primrec</span><span class=""> </span><span class="">get_partition_cfg_ports</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Partition_Conf &#8658; port_name set&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;get_partition_cfg_ports (PartConf _ _ _ pset) = pset &quot;</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">get_partition_cfg_ports_byid</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Sys_Config &#8658; partition_id &#8658; port_name set&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;get_partition_cfg_ports_byid sc p &#8801; 
              if (partconf sc) p = None 
              then {} 
              else get_partition_cfg_ports (the ((partconf sc) p) )&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">get_ports_of_partition</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;State &#8658; partition_id &#8658; port_id set&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;get_ports_of_partition s p = {x. (part_ports s) x = Some p}&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">primrec</span><span class=""> </span><span class="">get_msg_from_samplingport</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Port_Type &#8658; Message option&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;get_msg_from_samplingport (Sampling _ _ _ msg) = msg&quot;</span><span class=""> </span><span class="delimiter">|</span><span class="">
</span><span class="">        </span><span class="string">&quot;get_msg_from_samplingport (Queuing _ _ _ _ _) = None&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">primrec</span><span class=""> </span><span class="">get_msgs_from_queuingport</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Port_Type &#8658; (Message set) option&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;get_msgs_from_queuingport (Sampling _ _ _ _) = None&quot;</span><span class=""> </span><span class="delimiter">|</span><span class="">
</span><span class="">        </span><span class="string">&quot;get_msgs_from_queuingport (Queuing _ _ _ _ msgs) = Some msgs&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">get_port_byid</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;State &#8658; port_id &#8658; Port_Type option&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;get_port_byid s pid &#8801;  ports (comm s) pid&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">get_the_msg_of_samplingport</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;State &#8658; port_id &#8658; Message option&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;get_the_msg_of_samplingport s pid &#8801; 
            let ps = get_port_byid s pid in
                 if ps = None then None else get_msg_from_samplingport (the ps)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">get_the_msgs_of_queuingport</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;State &#8658; port_id &#8658; (Message set) option&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;get_the_msgs_of_queuingport s pid &#8801;
            let ps = get_port_byid s pid in
                 if ps = None then None else get_msgs_from_queuingport (the ps)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">get_port_conf_byid</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Sys_Config &#8658; State &#8658; port_id &#8658; Port_Type option&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;get_port_conf_byid sc s pid &#8801; ports (comm s) pid&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">primrec</span><span class=""> </span><span class="">is_channel_srcname</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Channel_Type &#8658; port_name &#8658; bool&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;is_channel_srcname (Channel_Sampling _ n _) name = (name = n)&quot;</span><span class=""> </span><span class="delimiter">|</span><span class=""> 
</span><span class="">        </span><span class="string">&quot;is_channel_srcname (Channel_Queuing _ n _) name = (name = n)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">primrec</span><span class=""> </span><span class="">is_channel_destname</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Channel_Type &#8658; port_name &#8658; bool&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;is_channel_destname (Channel_Sampling _ _ ns) name = (name &#8712; ns)&quot;</span><span class=""> </span><span class="delimiter">|</span><span class=""> 
</span><span class="">        </span><span class="string">&quot;is_channel_destname (Channel_Queuing _ _ n) name = (name = n)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">get_channel_bysrcport_id</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Sys_Config &#8658; State &#8658; port_id &#8658; Channel_Type option&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;get_channel_bysrcport_id sc s pid &#8801; 
          let nm = get_portname_by_id s pid in
              if &#8707;x. x&#8712; channels_conf (commconf sc) &#8743; is_channel_srcname x (the nm) then
                let c&#39; = SOME c. c&#8712;channels_conf (commconf sc) &#8743; is_channel_srcname c (the nm) in
                  Some c&#39;
              else None&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">get_destports_bysrcport</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Sys_Config &#8658; State &#8658; port_id &#8658; (port_id option) set&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;get_destports_bysrcport sc s pid &#8801; 
          let c = get_channel_bysrcport_id sc s pid in
            case c of Some (Channel_Sampling _ _ ps) &#8658; get_portids_by_names s ps| 
                      Some (Channel_Queuing _ _ p) &#8658; insert (get_portid_by_name s p) {}| 
                      None &#8658; {}&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">update_sampling_port_msg</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;State &#8658; port_id &#8658; Message &#8658; State&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;update_sampling_port_msg s pid m &#8801;  
            case ((ports (comm s)) pid) of 
              Some (Sampling spid name d msg) &#8658; 
                (let cs = comm s;
                     pts = ports cs
                 in s&#10631;comm := 
                      cs&#10631; ports := pts(pid := Some (Sampling spid name d (Some m))) &#10632; 
                     &#10632; 
                ) 
              |
              _ &#8658; s&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">st_msg_destspl_ports</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(port_id &#8658; Port_Type option) &#8658; 
                        (port_id option) set &#8658; Message &#8658; 
                        (port_id &#8658; Port_Type option)&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;st_msg_destspl_ports f a b &#8801; 
        % x. (case f x of Some (Sampling spid name d msg) &#8658; Some (Sampling spid name d (Some b)) |
                      _ &#8658; f x)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">update_sampling_ports_msg</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;State &#8658; (port_id option) set &#8658; Message &#8658; State&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;update_sampling_ports_msg s st m = 
            (let cs = comm s;
                 pts = ports cs
             in s&#10631;comm := 
                  cs&#10631; ports := st_msg_destspl_ports pts st m &#10632; 
                 &#10632; 
            )  &quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">insert_msg2queuing_port</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;State &#8658; port_id
        &#8658; Message &#8658; State&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;insert_msg2queuing_port s pid m &#8801;
            case ((ports (comm s)) pid) of 
                Some (Queuing spid name maxs d msgs)
                  &#8658; (let cs = comm s;
                        pts = ports cs
                        in s&#10631;comm := 
                              cs&#10631; ports := pts( pid := Some (Queuing spid name maxs d (insert m msgs))) &#10632;
                            &#10632;
                     )
                | _ &#8658; s&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">replace_msg2queuing_port</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;State &#8658; port_id &#8658; Message &#8658; State&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;replace_msg2queuing_port s pid m &#8801; s&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">remove_msg_from_queuingport</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;State &#8658; port_id &#8658; (State &#215; Message option)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;remove_msg_from_queuingport s pid &#8801;
            case ((ports (comm s)) pid) of 
                Some (Queuing spid name maxs d msgs)
                  &#8658; (let cs = comm s;
                          pts = ports cs;
                          m = SOME x. x&#8712;msgs
                        in (s&#10631;comm := 
                              cs&#10631; ports := pts( pid := Some (Queuing spid name maxs d (msgs - {m}))) &#10632;
                            &#10632;,Some m)
                     )
                | _ &#8658; (s,None)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">clear_msg_queuingport</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Port_Type &#8658; Port_Type&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;clear_msg_queuingport pt &#8801; (case pt of (Queuing spid name maxs d _) &#8658; (Queuing spid name maxs d {}) |
                                                 _ &#8658; pt)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">is_a_partition</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Sys_Config &#8658; domain_id &#8658; bool&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;is_a_partition sc nid &#8801; (partconf sc) nid &#8800; None&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">is_a_transmitter</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Sys_Config &#8658; domain_id &#8658; bool&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;is_a_transmitter sc nid &#8801; (transmitter sc) = nid&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">is_a_scheduler</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Sys_Config &#8658; domain_id &#8658; bool&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;is_a_scheduler sc nid &#8801; (scheduler sc) = nid&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">is_a_syspart</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Sys_Config &#8658; partition_id &#8658; bool&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;is_a_syspart sc pid &#8801; let p = (partconf sc) pid in
                                    case p of Some (PartConf _ _ SYSTEM_PARTITION _) &#8658; True | 
                                              _ &#8658; False&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">is_a_normpart</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Sys_Config &#8658; partition_id &#8658; bool&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;is_a_normpart sc pid &#8801; let p = (partconf sc) pid in
                                    case p of Some (PartConf _ _ USER_PARTITION _) &#8658; True | 
                                              _ &#8658; False&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">is_there_a_channel_2parts</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Sys_Config &#8658; partition_id &#8658; partition_id &#8658; bool&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;is_there_a_channel_2parts sc p1 p2 &#8801; 
              let ps1 = get_partition_cfg_ports_byid sc p1;
                  ps2 = get_partition_cfg_ports_byid sc p2 in
                    (&#8707;c. c&#8712; channels_conf (commconf sc) &#8743; 
                          (case c of (Channel_Sampling _ sp dps) &#8658; sp&#8712;ps1 &#8743; ps2&#8745;dps&#8800;{} | 
                                      (Channel_Queuing _ sp dp) &#8658; sp&#8712;ps1 &#8743; dp&#8712;ps2
                          )
                    )&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">part_intf_transmitter</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Sys_Config &#8658; partition_id &#8658; bool&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;part_intf_transmitter sc p &#8801; (let pns = get_partition_cfg_ports (the ((partconf sc) p)) in
                                      (&#8707;ch pn. ch&#8712;channels_conf (commconf sc) &#8743; pn&#8712;pns &#10230; 
                                            is_channel_srcname ch pn &#8744; is_channel_destname ch pn))&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">transmitter_intf_part</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Sys_Config &#8658; partition_id &#8658; bool&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;transmitter_intf_part sc p &#8801; (let pns = get_partition_cfg_ports (the ((partconf sc) p)) in
                                      (&#8707;ch pn. ch&#8712;channels_conf (commconf sc) &#8743; 
                                                pn&#8712;pns &#10230; is_channel_destname ch pn ))&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">primrec</span><span class=""> </span><span class="">get_max_bufsize_of_port</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Port_Type &#8658; max_buffer_size&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;get_max_bufsize_of_port (Queuing _ _ n _ _) = n&quot;</span><span class=""> </span><span class="delimiter">|</span><span class="">
</span><span class="">        </span><span class="string">&quot;get_max_bufsize_of_port (Sampling _ _ _ _) = 1&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">primrec</span><span class=""> </span><span class="">get_current_bufsize_port</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Port_Type &#8658; buffer_size&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;get_current_bufsize_port (Queuing _ _ _ _ ms) = card ms&quot;</span><span class=""> </span><span class="delimiter">|</span><span class="">
</span><span class="">        </span><span class="string">&quot;get_current_bufsize_port (Sampling _ _ _ m) = (if m = None then 0 else 1)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">is_full_portqueuing</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Sys_Config &#8658; State &#8658; port_id &#8658; bool&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;is_full_portqueuing sc s p &#8801; 
        let conf = get_port_conf_byid sc s p; 
              st = get_port_byid s p in
                get_max_bufsize_of_port (the conf) = get_current_bufsize_port (the st)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">is_empty_port</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;State &#8658; port_id &#8658; bool&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;is_empty_port s p &#8801; 
        let st = get_port_byid s p in
              get_current_bufsize_port (the st) = 0&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">get_port_buf_size</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;State &#8658; port_id &#8658; buffer_size&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;get_port_buf_size s p &#8801; 
        let st = get_port_byid s p in
              get_current_bufsize_port (the st)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">is_empty_portqueuing</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;State &#8658; port_id &#8658; bool&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;is_empty_portqueuing s p &#8801; 
      let st = get_port_byid s p in
            get_current_bufsize_port (the st) = 0&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">is_empty_portsampling</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;State &#8658; port_id &#8658; bool&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;is_empty_portsampling s p &#8801; 
            let st = get_port_byid s p in
                get_current_bufsize_port (the st) = 0&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">has_msg_inportqueuing</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;State &#8658; port_id &#8658; bool&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;has_msg_inportqueuing s pid &#8801; 
            case ((ports (comm s)) pid) of 
                Some (Queuing _ _ _ _ msgs)
                  &#8658; card msgs &#8800; 0
                | _ &#8658; False&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">get_partconf_byid</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Sys_Config &#8658; partition_id &#8658; Partition_Conf option&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;get_partconf_byid sc pid &#8801; (partconf sc) pid&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">get_partstate_byid</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;State &#8658; partition_id &#8658; Partition_State_Type option&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;get_partstate_byid s pid &#8801; (partitions s) pid&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{* Event specification *}</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">create_sampling_port</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Sys_Config &#8658; State &#8658; port_name &#8658; (State &#215; port_id option)&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;create_sampling_port sc s p &#8801; 
            if (get_samplingport_conf sc p = None
                 &#8744; get_portid_by_name s p &#8800; None
                &#8744; p &#8713; get_partition_cfg_ports_byid sc (current s))
            then (s,None)
            else
              let cs = comm s; 
                  pts = ports cs; 
                  partpts = part_ports s;
                  part = current s;
                  newid = get_portid_in_type (the (get_samplingport_conf sc p)) in                  
              (s&#10631;comm := cs&#10631; ports := pts(newid := get_samplingport_conf sc p)&#10632;,
                part_ports := partpts(newid := Some part)
               &#10632;, Some newid)
        &quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">write_sampling_message</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;State &#8658; port_id &#8658; Message &#8658; (State &#215; bool)&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;write_sampling_message s p m &#8801; 
              (if(&#172; is_a_samplingport s p
                &#8744; &#172; is_source_port s p
                &#8744; &#172; is_a_port_of_partition s p (current s))
              then (s, False)
              else (update_sampling_port_msg s p m, True))&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">read_sampling_message</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;State &#8658; port_id &#8658; (State &#215; Message option)&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;read_sampling_message s pid &#8801; 
              (if (&#172; is_a_samplingport s pid
                &#8744; &#172; is_a_port_of_partition s pid (current s)
                &#8744; &#172; is_dest_port s pid)
              then (s, None)
              else if is_empty_portsampling s pid then
                (s, None)
              else
                (s, get_the_msg_of_samplingport s pid)
              )&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">get_sampling_port_id</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Sys_Config &#8658; State &#8658; port_name &#8658; (State &#215; port_id option)&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;get_sampling_port_id sc s pname &#8801; 
          (if (pname &#8713; get_partition_cfg_ports_byid sc (current s))
          then (s, None) 
          else (s, get_portid_by_name s pname))&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">get_sampling_port_status</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Sys_Config &#8658; State &#8658; port_id &#8658; (State &#215; Port_Type option)&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;get_sampling_port_status sc s pid &#8801; (s, get_port_conf_byid sc s pid)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">create_queuing_port</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Sys_Config &#8658; State &#8658; port_name &#8658; (State &#215; port_id option)&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;create_queuing_port sc s p &#8801;          
            if (get_queuingport_conf sc p = None
                 &#8744; get_portid_by_name s p &#8800; None
                &#8744; p &#8713; get_partition_cfg_ports_byid sc (current s))
            then (s,None)
            else
              let cs = comm s; 
                  pts = ports cs; 
                  part = current s;
                  partpts = part_ports s;
                  newid = get_portid_in_type (the (get_queuingport_conf sc p)) in
              (s&#10631;comm :=
                cs&#10631; ports := pts(newid := get_queuingport_conf sc p)&#10632;,
                 part_ports := partpts(newid := Some part)
               &#10632;, Some newid)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">send_queuing_message_maylost</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Sys_Config &#8658; State &#8658; port_id &#8658; Message &#8658; (State &#215; bool)&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;send_queuing_message_maylost sc s p m &#8801; 
              (if(&#172; is_a_queuingport s p
                &#8744; &#172; is_source_port s p
                &#8744; &#172; is_a_port_of_partition s p (current s))
              then (s, False)
              else if is_full_portqueuing sc s p then
                (replace_msg2queuing_port s p m, True)
              else
                (insert_msg2queuing_port s p m, True))&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">receive_queuing_message</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;State &#8658; port_id &#8658; (State &#215; Message option)&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;receive_queuing_message s pid &#8801; 
              (if (&#172; is_a_queuingport s pid 
                &#8744; &#172; is_a_port_of_partition s pid (current s)
                &#8744; &#172; is_dest_port s pid 
                &#8744; is_empty_portqueuing s pid)
              then (s, None)
              else remove_msg_from_queuingport s pid
              )&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">get_queuing_port_id</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Sys_Config &#8658; State &#8658; port_name &#8658; (State &#215; port_id option)&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;get_queuing_port_id sc s pname &#8801; 
          (if (pname &#8713; get_partition_cfg_ports_byid sc (current s))
          then (s, None) 
          else (s, get_portid_by_name s pname))&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">get_queuing_port_status</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Sys_Config &#8658; State &#8658; port_id &#8658; (State &#215; Port_Type option)&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;get_queuing_port_status sc s pid &#8801; (s, get_port_conf_byid sc s pid)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">clear_queuing_port</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;State &#8658; port_id &#8658; State&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;clear_queuing_port s pid &#8801; 
          (if (&#172; is_a_queuingport s pid
                &#8744; &#172; is_a_port_of_partition s pid (current s)
                &#8744; &#172; is_dest_port s pid)
          then s
          else 
            let cs = comm s;
                pts = ports cs;
                pt = (ports cs) pid
              in s&#10631;comm := 
                    cs&#10631; ports := pts( pid := Some (clear_msg_queuingport (the pt))) &#10632;
                  &#10632;
           
          )&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">schedule</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Sys_Config &#8658; State &#8658; State set&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;schedule sc s &#8801; {s&#10631;current:= SOME p. p&#8712;{x. (partconf sc) x &#8800; None &#8744; x = transmitter sc}&#10632;}&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">get_partition_status</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Sys_Config &#8658; State &#8658; (State &#215; (Partition_Conf option) &#215; (Partition_State_Type option))&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;get_partition_status sc s &#8801; (s, (get_partconf_byid sc (current s), get_partstate_byid s (current s)))&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">set_partition_mode</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Sys_Config &#8658; State &#8658; partition_mode_type &#8658; State&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;set_partition_mode sc s m &#8801; 
      (if (partconf sc) (current s) &#8800; None &#8743; (partitions s) (current s) &#8800; None &#8743;
          &#172; (part_mode (the ((partitions s) (current s))) = COLD_START &#8743; m = WARM_START) then
        let pts = partitions s;
            pstate = the (pts (current s))
        in s&#10631;partitions := pts(current s := Some (pstate&#10631;part_mode := m&#10632;))&#10632;
      else
        s)
  &quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">primrec</span><span class=""> </span><span class="">transf_sampling_msg</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;State &#8658; Channel_Type &#8658; State&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;transf_sampling_msg s (Channel_Sampling _ sn dns) = 
          (let sp = get_portid_by_name s sn;
              dps = get_portids_by_names s dns in
                if sp&#8800;None &#8743; card dps = card dns then 
                  let m = the (get_the_msg_of_samplingport s (the sp)) in
                    update_sampling_ports_msg s dps m
                else
                  s
            )&quot;</span><span class=""> </span><span class="delimiter">|</span><span class="">
</span><span class="">  </span><span class="string">&quot;transf_sampling_msg s (Channel_Queuing _ _ _) = s&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">primrec</span><span class=""> </span><span class="">transf_queuing_msg_maylost</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Sys_Config &#8658; State &#8658; Channel_Type &#8658; State&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;transf_queuing_msg_maylost sc s (Channel_Queuing _ sn dn) = 
          (let sp = get_portid_by_name s sn;
                dp = get_portid_by_name s dn in
                  if sp &#8800; None &#8743; dp &#8800; None &#8743; has_msg_inportqueuing s (the sp) then
                    let sm = remove_msg_from_queuingport s (the sp) in
                      if is_full_portqueuing sc (fst sm) (the dp) then
                        replace_msg2queuing_port (fst sm) (the dp) (the (snd sm))
                      else
                        insert_msg2queuing_port (fst sm) (the dp) (the (snd sm)) 
                  else s
                )&quot;</span><span class=""> </span><span class="delimiter">|</span><span class="">
</span><span class="">  </span><span class="string">&quot;transf_queuing_msg_maylost sc s (Channel_Sampling _ _ _) = s&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">system_init</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Sys_Config &#8658; State&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;system_init sc &#8801; &#10631;current=(SOME x. (partconf sc) x&#8800;None),
                            partitions=(&#955; p. (
                                            case ((partconf sc) p) of 
                                                None &#8658; None |
                                                (Some (PartConf _ _ _ _)) &#8658; Some (&#10631;part_mode=IDLE&#10632;) 
                                              )
                                        ),
                            comm = &#10631;ports=(&#955; x. None)&#10632;,
                            part_ports = (&#955; x. None)
                           &#10632;&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">subsection</span><span class="verbatim">{* Instantiation and Its Proofs of Security Model  *}</span><span class="">
</span><span class="">
</span><span class="keyword1">consts</span><span class=""> </span><span class="">sysconf</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Sys_Config&quot;</span><span class=""> 
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">sys_config_witness</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="">Sys_Config</span><span class=""> 
</span><span class="keyword2">where</span><span class=""> 
</span><span class="string">&quot;sys_config_witness &#8801; &#10631; partconf = Map.empty, 
                        commconf = &#10631; ports_conf = {}, channels_conf = {}&#10632;, 
                        scheduler = 0, 
                        transmitter = 1 &#10632;&quot;</span><span class=""> 
</span><span class="">
</span><span class="keyword1">specification</span><span class=""> </span><span class="delimiter">(</span><span class="">sysconf</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="">part_id_conf</span><span class="delimiter">:</span><span class="string">&quot;&#8704;p. (partconf sysconf) p &#8800; None &#10230; get_partid_by_type (the ((partconf sysconf) p)) = p&quot;</span><span class="">
</span><span class="">  </span><span class="">part_not_sch</span><span class="delimiter">:</span><span class="string">&quot;(partconf sysconf) x &#8800; None &#10233; x&#8800;scheduler sysconf&quot;</span><span class=""> 
</span><span class="">  </span><span class="">part_not_trans</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(partconf sysconf) x &#8800; None &#10233; x&#8800;transmitter sysconf&quot;</span><span class=""> 
</span><span class="">  </span><span class="">sch_not_part</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;scheduler sysconf = x &#10233; (partconf sysconf) x = None&quot;</span><span class="">
</span><span class="">  </span><span class="">trans_not_part</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;transmitter sysconf = x &#10233; (partconf sysconf) x = None&quot;</span><span class="">
</span><span class="">  </span><span class="">sch_not_trans</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;scheduler sysconf &#8800; transmitter sysconf&quot;</span><span class="">
</span><span class="">  </span><span class="">port_name_diff</span><span class="delimiter">:</span><span class="string">&quot;&#8704;p1 p2. p1 &#8712; ports_conf (commconf sysconf) &#8743; p2 &#8712; ports_conf (commconf sysconf) 
                           &#10230; get_portname_by_type p1 &#8800; get_portname_by_type p2&quot;</span><span class="">
</span><span class="">  </span><span class="">port_partition</span><span class="delimiter">:</span><span class="string">&quot;&#8704;p1 p2. get_partition_cfg_ports_byid sysconf p1 &#8745; get_partition_cfg_ports_byid sysconf p2 = {}&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">intro</span><span class=""> </span><span class="">exI</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">_</span><span class=""> </span><span class="string">&quot;sys_config_witness&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="">allI</span><span class=""> </span><span class="">impI</span><span class="delimiter">,</span><span class=""> </span><span class="">simp</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">,</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">sys_config_witness_def</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">get_partition_cfg_ports_byid_def</span><span class=""> </span><span class="">sys_config_witness_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">consts</span><span class=""> </span><span class="">s0t</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="">State</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">s0t_witness</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="">State</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;s0t_witness &#8801; system_init sysconf&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">specification</span><span class=""> </span><span class="delimiter">(</span><span class="">s0t</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="">s0t_init</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;s0t = system_init sysconf&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="keyword1">primrec</span><span class=""> </span><span class="">event_enabled</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;State &#8658; Event &#8658; bool&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;event_enabled s (hyperc h) = (is_a_partition sysconf (current s) 
                                      &#8743; part_mode (the (partitions s (current s))) &#8800; IDLE)&quot;</span><span class=""> </span><span class="delimiter">|</span><span class="">
</span><span class="">        </span><span class="string">&quot;event_enabled s (sys h) =  (case h of Schedule &#8658; True |
                                               Transfer_Sampling_Message c &#8658; (current s = transmitter sysconf) |
                                               Transfer_Queuing_Message c &#8658; (current s = transmitter sysconf))&quot;</span><span class=""> 
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">exec_event</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Event &#8658; (State &#215; State) set&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">  </span><span class="string">&quot;exec_event e = {(s,s&#39;). s&#39;&#8712; (if event_enabled s e then (
      case e of hyperc (Create_Sampling_Port pname) &#8658; {fst (create_sampling_port sysconf s pname)} |
                hyperc (Write_Sampling_Message p m) &#8658; {fst (write_sampling_message s p m)} |
                hyperc (Read_Sampling_Message p) &#8658; {fst (read_sampling_message s p)} |
                hyperc (Get_Sampling_Portid pname) &#8658; {fst (get_sampling_port_id sysconf s pname)} |
                hyperc (Get_Sampling_Portstatus p) &#8658; {fst (get_sampling_port_status sysconf s p)} |
                hyperc (Create_Queuing_Port pname) &#8658; {fst (create_queuing_port sysconf s pname)} |
                hyperc (Send_Queuing_Message p m) &#8658; {fst (send_queuing_message_maylost sysconf s p m)} |
                hyperc (Receive_Queuing_Message p) &#8658; {fst (receive_queuing_message s p)} |
                hyperc (Get_Queuing_Portid pname) &#8658; {fst (get_queuing_port_id sysconf s pname)} |
                hyperc (Get_Queuing_Portstatus p) &#8658; {fst (get_queuing_port_status sysconf s p)} |
                hyperc (Clear_Queuing_Port p) &#8658; {clear_queuing_port s p} |
                hyperc (Set_Partition_Mode m) &#8658; {set_partition_mode sysconf s m} |
                hyperc (Get_Partition_Status) &#8658; {fst (get_partition_status sysconf s)} |
                sys Schedule &#8658;  schedule sysconf s |
                sys (Transfer_Sampling_Message c) &#8658; {transf_sampling_msg s c} |
                sys (Transfer_Queuing_Message c) &#8658; {transf_queuing_msg_maylost sysconf s c} )
                    else {s})}&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">primrec</span><span class=""> </span><span class="">domain_of_event</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;State &#8658; Event &#8658; domain_id option&quot;</span><span class="">
</span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;domain_of_event s (hyperc h) = Some (current s)&quot;</span><span class=""> </span><span class="delimiter">|</span><span class="">
</span><span class="">      </span><span class="string">&quot;domain_of_event s (sys h) =  (case h of Schedule &#8658; Some (scheduler sysconf) |
                                               Transfer_Sampling_Message c &#8658; Some (transmitter sysconf) |
                                               Transfer_Queuing_Message c &#8658; Some (transmitter sysconf) )&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">interference1</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;domain_id &#8658; domain_id &#8658; bool&quot;</span><span class=""> </span><span class="delimiter">(</span><span class="string">&quot;(_ &#8605; _)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword2">where</span><span class="">
</span><span class="">      </span><span class="string">&quot;interference1 d1 d2 &#8801; 
          if d1 = d2 then True
          else if is_a_scheduler sysconf d1 then True 
          else if &#172;(is_a_scheduler sysconf d1) &#8743; (is_a_scheduler sysconf d2) then False
          else if is_a_partition sysconf d1 &#8743; is_a_transmitter sysconf d2 then part_intf_transmitter sysconf d1
          else if is_a_transmitter sysconf d1 &#8743; is_a_partition sysconf d2 then transmitter_intf_part sysconf d2
          else False&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">non_interference1</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;domain_id &#8658; domain_id &#8658; bool&quot;</span><span class=""> </span><span class="delimiter">(</span><span class="string">&quot;(_ &#8726;&#8605; _)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;(u &#8726;&#8605;  v) &#8801; &#172; (u &#8605; v)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">declare</span><span class=""> </span><span class="">non_interference1_def</span><span class=""> </span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">interference1_def</span><span class=""> </span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">domain_of_event_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class="">
</span><span class="">       </span><span class="">event_enabled_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">is_a_partition_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">is_a_transmitter_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class="">
</span><span class="">       </span><span class="">is_a_scheduler_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">is_a_syspart_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">is_a_normpart_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class="">
</span><span class="">      </span><span class="">transmitter_intf_part_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">part_intf_transmitter_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">nintf_neq</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;u &#8726;&#8605;  v &#10233; u &#8800; v&quot;</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">nintf_reflx</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;interference1 u u&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class=""> 
</span><span class="keyword1">definition</span><span class=""> </span><span class="">vpeq_part_comm</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;State &#8658; partition_id &#8658; State &#8658; bool&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;vpeq_part_comm s d t &#8801;  
          (let ps1 = get_ports_of_partition s d;
                ps2 = get_ports_of_partition t d in
                  (ps1 = ps2) &#8743; 
                  (&#8704;p. p&#8712;ps1 &#10230; 
                   (is_a_queuingport s p = is_a_queuingport t p) &#8743;
                   (is_dest_port s p = is_dest_port t p) &#8743;
                   (if is_dest_port s p then
                      get_port_buf_size s p = get_port_buf_size t p
                    else True)
                  )
          )&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">vpeq_part</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;State &#8658; partition_id &#8658; State &#8658; bool&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;vpeq_part s d t &#8801; (partitions s) d = (partitions t) d &#8743; vpeq_part_comm s d t&quot;</span><span class=""> 
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">vpeq_transmitter</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;State &#8658; domain_id &#8658; State &#8658; bool&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;vpeq_transmitter s d t &#8801;  comm s = comm t &#8743; part_ports s = part_ports t&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">vpeq_sched</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;State &#8658; domain_id &#8658; State &#8658; bool&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;vpeq_sched s d t &#8801; current s = current t&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">definition</span><span class=""> </span><span class="">vpeq1</span><span class="">  </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;State &#8658; domain_id &#8658; State &#8658; bool&quot;</span><span class=""> </span><span class="delimiter">(</span><span class="string">&quot;(_ &#8764; _ &#8764; _)&quot;</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;vpeq1 s d t &#8801;  
         (if d = scheduler sysconf then 
            (vpeq_sched s d t)
          else if d = transmitter sysconf then
            (vpeq_transmitter s d t)
          else if is_a_partition sysconf d then 
            (vpeq_part s d t)
          else True)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1">declare</span><span class=""> </span><span class="">vpeq_part_comm_def</span><span class=""> </span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> 
</span><span class="">        </span><span class="">vpeq_part_def</span><span class=""> </span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">Let_def</span><span class=""> </span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">vpeq_transmitter_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class="">
</span><span class="">        </span><span class="">vpeq_sched_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> </span><span class="keyword2">and</span><span class=""> </span><span class="">vpeq1_def</span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> 
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">vpeq_part_comm_transitive_lemma</span><span class=""> </span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;&#8704; s t r d. vpeq_part_comm s d t &#8743; vpeq_part_comm t d r &#10230; vpeq_part_comm s d r&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">vpeq_part_comm_symmetric_lemma</span><span class="delimiter">:</span><span class="string">&quot;&#8704; s t d. vpeq_part_comm s d t &#10230; vpeq_part_comm t d s&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">vpeq_part_comm_reflexive_lemma</span><span class="delimiter">:</span><span class="string">&quot;&#8704; s d. vpeq_part_comm s d s&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">vpeq_part_transitive_lemma</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704; s t r d. vpeq_part s d t &#8743; vpeq_part t d r &#10230; vpeq_part s d r&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">vpeq_part_symmetric_lemma</span><span class="delimiter">:</span><span class="string">&quot;&#8704; s t d. vpeq_part s d t &#10230; vpeq_part t d s&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">vpeq_part_reflexive_lemma</span><span class="delimiter">:</span><span class="string">&quot;&#8704; s d. vpeq_part s d s&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">vpeq_transmitter_transitive_lemma</span><span class=""> </span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;&#8704; s t r d. vpeq_transmitter s d t &#8743; vpeq_transmitter t d r 
                                          &#10230; vpeq_transmitter s d r&quot;</span><span class="">
</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">vpeq_transmitter_symmetric_lemma</span><span class="delimiter">:</span><span class="string">&quot;&#8704; s t d. vpeq_transmitter s d t &#10230; vpeq_transmitter t d s&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                                                        
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">vpeq_transmitter_reflexive_lemma</span><span class="delimiter">:</span><span class="string">&quot;&#8704; s d. vpeq_transmitter s d s&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">vpeq_scheduler_transitive_lemma</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704; s t r d. vpeq_sched s d t &#8743; vpeq_sched t d r &#10230; vpeq_sched s d r&quot;</span><span class="">
</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">vpeq_scheduler_symmetric_lemma</span><span class="delimiter">:</span><span class="string">&quot;&#8704; s t d. vpeq_sched s d t &#10230; vpeq_sched t d s&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">vpeq_scheduler_reflexive_lemma</span><span class="delimiter">:</span><span class="string">&quot;&#8704; s d. vpeq_sched s d s&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">vpeq1_transitive_lemma</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704; s t r d. (vpeq1 s d t) &#8743; (vpeq1 t d r) &#10230; (vpeq1 s d r)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">vpeq1_symmetric_lemma</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704; s t d. (vpeq1 s d t) &#10230; (vpeq1 t d s)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">vpeq1_reflexive_lemma</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704; s d. (vpeq1 s d s)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">sched_current_lemma</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;s t a. vpeq1 s (scheduler sysconf) t &#10230; (domain_of_event s a) = (domain_of_event t a)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">full_types</span><span class="delimiter">)</span><span class=""> </span><span class="">Event.exhaust</span><span class=""> </span><span class="">domain_of_event.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">domain_of_event.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="">vpeq_sched_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">schedeler_intf_all_help</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;d. interference1 (scheduler sysconf) d&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">no_intf_sched_help</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;d. interference1 d (scheduler sysconf) &#10230; d = (scheduler sysconf)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">reachable_top</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;s a. (SM.reachable0 s0t exec_event) s &#10230; (&#8707;s&#39;. (s, s&#39;) &#8712; exec_event a)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1">{</span><span class="">
</span><span class="">    </span><span class="keyword3">fix</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">a</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(SM.reachable0 s0t exec_event) s&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8707;s&#39;. (s, s&#39;) &#8712; exec_event a&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">a</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">hyperc</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">exec_event_def</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="">        </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">sys</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">exec_event_def</span><span class=""> </span><span class="">schedule_def</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">        
</span><span class="">  </span><span class="keyword1">}</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">interpretation</span><span class=""> </span><span class="">SM_enabled</span><span class=""> 
</span><span class="">    </span><span class="">s0t</span><span class=""> </span><span class="">exec_event</span><span class=""> </span><span class="">domain_of_event</span><span class=""> </span><span class="string">&quot;scheduler sysconf&quot;</span><span class=""> </span><span class="">vpeq1</span><span class=""> </span><span class="">interference1</span><span class=""> 
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">vpeq1_transitive_lemma</span><span class=""> </span><span class="">vpeq1_symmetric_lemma</span><span class=""> </span><span class="">vpeq1_reflexive_lemma</span><span class=""> </span><span class="">sched_current_lemma</span><span class="">
</span><span class="">        </span><span class="">schedeler_intf_all_help</span><span class=""> </span><span class="">no_intf_sched_help</span><span class=""> </span><span class="">reachable_top</span><span class=""> </span><span class="">nintf_reflx</span><span class="">
</span><span class="">        </span><span class="">SM.intro</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">vpeq1</span><span class=""> </span><span class="string">&quot;scheduler sysconf&quot;</span><span class=""> </span><span class="">domain_of_event</span><span class=""> </span><span class="">interference1</span><span class="delimiter">]</span><span class="">
</span><span class="">        </span><span class="">SM_enabled_axioms.intro</span><span class=""> </span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">s0t</span><span class=""> </span><span class="">exec_event</span><span class="delimiter">]</span><span class=""> 
</span><span class="">        </span><span class="">SM_enabled.intro</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">domain_of_event</span><span class=""> </span><span class="string">&quot;scheduler sysconf&quot;</span><span class=""> </span><span class="">vpeq1</span><span class=""> </span><span class="">interference1</span><span class=""> </span><span class="">s0t</span><span class=""> </span><span class="">exec_event</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">
</span><span class="keyword1">subsection</span><span class="verbatim">{* Correctness for top-level specification *}</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{* Correctness lemmas *}</span><span class="">
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">create_sampling_port_cor</span><span class="delimiter">:</span><span class="string">&quot;&#10214;r = create_sampling_port sysconf s p; (snd r) &#8800; None&#10215; 
      &#10233; (ports (comm (fst r))) (the (snd r)) &#8800; None&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">create_sampling_port_def</span><span class=""> </span><span class="">get_samplingport_conf_def</span><span class=""> </span><span class="">port_name_diff</span><span class=""> </span><span class="">snd_conv</span><span class="delimiter">)</span><span class="">
</span><span class="">    
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">create_sampling_port_prepost</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;get_samplingport_conf sysconf p &#8800; None&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;get_portid_by_name s p = None&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;p &#8712; get_partition_cfg_ports_byid sysconf (current s)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;r = create_sampling_port sysconf s p&quot;</span><span class="">
</span><span class="">       </span><span class="keyword2">shows</span><span class="">  </span><span class="string">&quot;(ports (comm (fst r))) (the (snd r)) &#8800; None&quot;</span><span class="">
</span><span class="">       </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">create_sampling_port_cor</span><span class=""> </span><span class="">create_sampling_port_def</span><span class=""> </span><span class="">option.distinct</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">sndI</span><span class="delimiter">)</span><span class="">
</span><span class="">      
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">write_sampling_message_cor</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;r = write_sampling_message s pid m&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;(snd r) &#8800; False&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;the (get_the_msg_of_samplingport (fst r) pid) = m&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">        </span><span class="keyword1">let</span><span class=""> </span><span class="var">?sp</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;(ports (comm (fst r))) pid&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">let</span><span class=""> </span><span class="var">?s&#39;</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;fst r&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;r = (update_sampling_port_msg s pid m, True)&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">eq_snd_iff</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">write_sampling_message_def</span><span class="delimiter">)</span><span class="">         
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class="string">&quot;is_a_samplingport s pid&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">write_sampling_message_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class="string">&quot;get_port_byid s pid &#8800; None&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">is_a_samplingport_def</span><span class=""> </span><span class="">get_port_byid_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">option.case_eq_if</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;(ports (comm s)) pid&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3">case</span><span class=""> </span><span class="">None</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">None.hyps</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">get_port_byid_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Some</span><span class=""> </span><span class="">pt</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1">have</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;(ports (comm s)) pid = Some pt&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Some.hyps</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">            </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;the ((ports (comm s)) pid)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Queuing</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class=""> </span><span class="">x5</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;the ((ports (comm s)) pid) = Queuing x1 x2 x3 x4 x5&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Queuing.hyps</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">with</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">is_a_samplingport_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1">next</span><span class="">
</span><span class="">              </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Sampling</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1">have</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;the (ports (comm ?s&#39;) pid) = Sampling x1 x2 x3 (Some m)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Communication_State.select_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Communication_State.surjective</span><span class=""> 
</span><span class="">                    </span><span class="">Communication_State.update_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Port_Type.simps</span><span class="delimiter">(</span><span class="">6</span><span class="delimiter">)</span><span class=""> </span><span class="">Sampling.hyps</span><span class=""> 
</span><span class="">                    </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">State.surjective</span><span class=""> </span><span class="">State.update_convs</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> 
</span><span class="">                    </span><span class="">fstI</span><span class=""> </span><span class="">fun_upd_same</span><span class=""> </span><span class="">option.case_eq_if</span><span class=""> </span><span class="">option.distinct</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">option.sel</span><span class=""> </span><span class="">update_sampling_port_msg_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;get_the_msg_of_samplingport ?s&#39; pid = get_msg_from_samplingport (the (get_port_byid ?s&#39; pid))&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">get_the_msg_of_samplingport_def</span><span class=""> </span><span class="">get_port_byid_def</span><span class="">
</span><span class="">                    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Communication_State.select_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Communication_State.surjective</span><span class=""> 
</span><span class="">                      </span><span class="">Communication_State.update_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Port_Type.simps</span><span class="delimiter">(</span><span class="">6</span><span class="delimiter">)</span><span class=""> </span><span class="">Sampling.hyps</span><span class=""> 
</span><span class="">                      </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">State.surjective</span><span class=""> </span><span class="">State.update_convs</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> 
</span><span class="">                      </span><span class="">fstI</span><span class=""> </span><span class="">fun_upd_same</span><span class=""> </span><span class="">option.case_eq_if</span><span class=""> </span><span class="">option.distinct</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">update_sampling_port_msg_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">get_port_byid_def</span><span class="delimiter">)</span><span class="">  
</span><span class="">            </span><span class="keyword1">qed</span><span class="">
</span><span class="">          </span><span class="keyword1">qed</span><span class="">
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">write_sampling_message_prepost</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;r = write_sampling_message s pid m&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;is_a_samplingport s pid&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;is_source_port s pid&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;is_a_port_of_partition s pid (current s)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;the (get_the_msg_of_samplingport (fst r) pid) = m&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">sndI</span><span class=""> </span><span class="">write_sampling_message_cor</span><span class=""> </span><span class="">write_sampling_message_def</span><span class="delimiter">)</span><span class="">
</span><span class="">       
</span><span class="">
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">read_sampling_message_cor</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;r = read_sampling_message s pid&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;fst r = s &#8743; (((snd r) &#8800; None) &#10230; (snd r) = get_the_msg_of_samplingport s pid)&quot;</span><span class="">     
</span><span class="">      </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">read_sampling_message_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">read_sampling_message_prepost</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;r = read_sampling_message s pid&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2">and</span><span class=""> </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;is_a_samplingport s pid&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2">and</span><span class=""> </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;is_dest_port s pid&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2">and</span><span class=""> </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;is_a_port_of_partition s pid (current s)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2">and</span><span class=""> </span><span class="">p5</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_empty_portsampling s pid&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;(snd r) = get_the_msg_of_samplingport s pid&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">read_sampling_message_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_sampling_port_id_cor</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;r = get_sampling_port_id sysconf s pname&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;fst r = s &#8743; (((snd r) &#8800; None) &#10230; (snd r) = get_portid_by_name s pname)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;fst r = s&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">get_sampling_port_id_def</span><span class=""> </span><span class="">p1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;((snd r) &#8800; None) &#10230; (snd r) = get_portid_by_name s pname&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">get_sampling_port_id_def</span><span class=""> </span><span class="">p1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_sampling_port_id_prepost</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;r = get_sampling_port_id sysconf s pname&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;pname &#8712; get_partition_cfg_ports_byid sysconf (current s)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;(snd r) = get_portid_by_name s pname&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">get_sampling_port_id_def</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_sampling_port_status_prepost</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;r = get_sampling_port_status sysconf s pid&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;fst r = s &#8743; ((snd r) = get_port_conf_byid sc s pid)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">using</span><span class=""> </span><span class="">get_port_conf_byid_def</span><span class=""> </span><span class="">get_sampling_port_status_def</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">create_queuing_ports_cor</span><span class="delimiter">:</span><span class="string">&quot;&#10214;r = create_queuing_port sysconf s p; (snd r) &#8800; None&#10215; 
      &#10233; (ports (comm (fst r))) (the (snd r)) &#8800; None&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">create_queuing_port_def</span><span class=""> </span><span class="">get_queuingport_conf_def</span><span class=""> </span><span class="">port_name_diff</span><span class=""> </span><span class="">snd_conv</span><span class="delimiter">)</span><span class="">  
</span><span class="">
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">create_queuing_ports_prepost</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;r = create_queuing_port sysconf s p&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2">and</span><span class=""> </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;get_queuingport_conf sysconf p &#8800; None&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2">and</span><span class=""> </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;get_portid_by_name s p = None&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2">and</span><span class=""> </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;p &#8712; get_partition_cfg_ports_byid sysconf (current s)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;(ports (comm (fst r))) (the (snd r)) &#8800; None&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">create_queuing_port_def</span><span class=""> </span><span class="">create_queuing_ports_cor</span><span class=""> </span><span class="">option.distinct</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">sndI</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">send_queuing_message_maylost_cor</span><span class="delimiter">:</span><span class="">
</span><span class="">     </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;r = send_queuing_message_maylost sysconf s pid m&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;(snd r) &#8800; False&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;(is_full_portqueuing sysconf s pid &#10230; ((fst r) = s)) 
            &#8743; (&#172; is_full_portqueuing sysconf s pid &#10230; m &#8712; (the (get_the_msgs_of_queuingport (fst r) pid)) )&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;is_full_portqueuing sysconf s pid &#10230; ((fst r) = s)&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1">using</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">send_queuing_message_maylost_def</span><span class="">
</span><span class="">        </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">replace_msg2queuing_port_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;&#172; is_full_portqueuing sysconf s pid &#10230; m &#8712; (the (get_the_msgs_of_queuingport (fst r) pid)) &quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1">{</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_full_portqueuing sysconf s pid&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;is_a_queuingport s pid&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">send_queuing_message_maylost_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">        </span><span class="keyword1">let</span><span class=""> </span><span class="var">?s&#39;</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;fst r&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;m &#8712; (the (get_the_msgs_of_queuingport (fst r) pid))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;?s&#39; = insert_msg2queuing_port s pid m&quot;</span><span class=""> 
</span><span class="">            </span><span class="keyword1">using</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">send_queuing_message_maylost_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;(ports (comm s)) pid&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3">case</span><span class=""> </span><span class="">None</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">None.hyps</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">is_a_queuingport_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Some</span><span class=""> </span><span class="">pt</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1">have</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;(ports (comm s)) pid = Some pt&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Some.hyps</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">            </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;the ((ports (comm s)) pid)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Sampling</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;the ((ports (comm s)) pid) = Sampling x1 x2 x3 x4&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Sampling.hyps</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1">with</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">is_a_queuingport_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1">next</span><span class="">
</span><span class="">              </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Queuing</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class=""> </span><span class="">x5</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;the ((ports (comm s)) pid) = Queuing x1 x2 x3 x4 x5&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Queuing.hyps</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1">with</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class="string">&quot;(ports (comm ?s&#39;)) pid = Some (Queuing x1 x2 x3 x4 (insert m x5))&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">insert_msg2queuing_port_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Communication_State.select_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                  </span><span class="">Communication_State.surjective</span><span class=""> </span><span class="">Communication_State.update_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Port_Type.simps</span><span class="delimiter">(</span><span class="">5</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                  </span><span class="">State.ext_inject</span><span class=""> </span><span class="">State.surjective</span><span class=""> </span><span class="">State.update_convs</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">fun_upd_same</span><span class=""> </span><span class="">option.sel</span><span class=""> </span><span class="">option.simps</span><span class="delimiter">(</span><span class="">5</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">get_the_msgs_of_queuingport_def</span><span class=""> </span><span class="">Let_def</span><span class=""> </span><span class="">get_port_byid_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1">qed</span><span class="">
</span><span class="">          </span><span class="keyword1">qed</span><span class="">
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">}</span><span class="">
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">           
</span><span class="">   </span><span class="keyword1">lemma</span><span class=""> </span><span class="">send_queuing_message_maylost_prepost</span><span class="delimiter">:</span><span class="">
</span><span class="">     </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;r = send_queuing_message_maylost sysconf s pid m&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;is_a_queuingport s pid&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;is_source_port s pid&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;is_a_port_of_partition s pid (current s)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p5</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_full_portqueuing sysconf s pid&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;m &#8712; (the (get_the_msgs_of_queuingport (fst r) pid))&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">send_queuing_message_maylost_cor</span><span class=""> </span><span class="">send_queuing_message_maylost_def</span><span class=""> </span><span class="">sndI</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">   </span><span class="keyword1">lemma</span><span class=""> </span><span class="">receive_queuing_message_cor</span><span class="delimiter">:</span><span class="">
</span><span class="">     </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;r = receive_queuing_message s pid&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;(snd r) &#8800; None&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;the (snd r) &#8713; (the (get_the_msgs_of_queuingport (fst r) pid))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1">from</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;is_a_queuingport s pid&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">receive_queuing_message_def</span><span class=""> </span><span class="">snd_conv</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1">from</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class="string">&quot;r = remove_msg_from_queuingport s pid&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">receive_queuing_message_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;(ports (comm s)) pid&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">case</span><span class=""> </span><span class="">None</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">None.hyps</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">is_a_queuingport_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Some</span><span class=""> </span><span class="">pt</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;(ports (comm s)) pid = Some pt&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Some.hyps</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;the ((ports (comm s)) pid)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Sampling</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;pt = Sampling x1 x2 x3 x4&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Sampling.hyps</span><span class=""> </span><span class="">b1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">is_a_queuingport_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">        </span><span class="keyword1">next</span><span class="">
</span><span class="">          </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Queuing</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class=""> </span><span class="">x5</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;pt = Queuing x1 x2 x3 x4 x5&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Queuing.hyps</span><span class=""> </span><span class="">b1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(ports (comm (fst r))) pid = Some (Queuing x1 x2 x3 x4 (x5 - {the (snd r)}))&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Communication_State.select_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Communication_State.surjective</span><span class=""> 
</span><span class="">              </span><span class="">Communication_State.update_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Port_Type.case</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Queuing.hyps</span><span class=""> </span><span class="">State.ext_inject</span><span class=""> 
</span><span class="">              </span><span class="">State.surjective</span><span class=""> </span><span class="">State.update_convs</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">fstI</span><span class=""> </span><span class="">fun_upd_same</span><span class=""> </span><span class="">is_a_queuingport_def</span><span class=""> 
</span><span class="">              </span><span class="">option.case_eq_if</span><span class=""> </span><span class="">option.sel</span><span class=""> </span><span class="">remove_msg_from_queuingport_def</span><span class=""> </span><span class="">sndI</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">get_port_byid_def</span><span class=""> </span><span class="">get_the_msgs_of_queuingport_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">receive_queuing_message_prepost</span><span class="delimiter">:</span><span class="">
</span><span class="">       </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;r = receive_queuing_message s pid&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;is_a_queuingport s pid&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;is_dest_port s pid&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;is_a_port_of_partition s pid (current s)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p5</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_empty_portqueuing s pid&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;the (snd r) &#8713; (the (get_the_msgs_of_queuingport (fst r) pid))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1">from</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;r = remove_msg_from_queuingport s pid&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">receive_queuing_message_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;(ports (comm s)) pid&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">case</span><span class=""> </span><span class="">None</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">None.hyps</span><span class=""> </span><span class="">is_dest_port_def</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Some</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;x = the ((ports (comm s)) pid)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Some.hyps</span><span class=""> </span><span class="">option.sel</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;the ((ports (comm s)) pid)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Queuing</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class=""> </span><span class="">x5</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;x = Queuing x1 x2 x3 x4 x5&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Queuing.hyps</span><span class=""> </span><span class="">a1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(ports (comm (fst r))) pid = Some (Queuing x1 x2 x3 x4 (x5 - {the (snd r)}))&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">            </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;Some (Queuing x1 x2 x3 x4 x5) = ports (comm s) pid&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">Some.hyps</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">            </span><span class="keyword1">hence</span><span class=""> </span><span class="string">&quot;remove_msg_from_queuingport s pid = (case Some (Queuing x1 x2 x3 x4 x5) of None 
                      &#8658; (s, None) | Some (Queuing n cs na p M) &#8658; 
                          (s&#10631;comm := comm s &#10631;ports := ports (comm s)(pid &#8614; Queuing n cs na p (M - {SOME m. m &#8712; M}))&#10632;&#10632;, 
                          Some (SOME m. m &#8712; M)) | Some (Sampling n cs p z) &#8658; (s, None))&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">remove_msg_from_queuingport_def</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3">thus</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">              </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Some</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">           </span><span class="keyword1">qed</span><span class=""> 
</span><span class="">           </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">get_port_byid_def</span><span class=""> </span><span class="">get_the_msgs_of_queuingport_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1">next</span><span class="">
</span><span class="">          </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Sampling</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;x = Sampling x1 x2 x3 x4&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Sampling.hyps</span><span class=""> </span><span class="">a1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">            </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;case Some x of None &#8658; False | Some (Queuing n cs na p M) &#8658; True 
                | Some (Sampling n cs p z) &#8658; False&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">Some.hyps</span><span class=""> </span><span class="">is_a_queuingport_def</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">presburger</span><span class="">
</span><span class="">            </span><span class="keyword3">thus</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">force</span><span class="">
</span><span class="">          </span><span class="keyword1">qed</span><span class="">                 
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_queuing_port_id_cor</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;r = get_queuing_port_id sysconf s pname&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;fst r = s &#8743; (((snd r) &#8800; None) &#10230; (snd r) = get_portid_by_name s pname)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;fst r = s&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">get_queuing_port_id_def</span><span class=""> </span><span class="">p1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;((snd r) &#8800; None) &#10230; (snd r) = get_portid_by_name s pname&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">get_queuing_port_id_def</span><span class=""> </span><span class="">p1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">    
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_queuing_port_id_prepost</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;r = get_queuing_port_id sysconf s pname&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2">and</span><span class=""> </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;pname &#8712; get_partition_cfg_ports_byid sysconf (current s)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;(snd r) = get_portid_by_name s pname&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">get_queuing_port_id_def</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_queuing_port_status_prepost</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;r = get_queuing_port_status sysconf s pid&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;fst r = s &#8743; ((snd r) = get_port_conf_byid sc s pid)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">using</span><span class=""> </span><span class="">get_port_conf_byid_def</span><span class=""> </span><span class="">get_queuing_port_status_def</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">clear_queuing_port_cor</span><span class="delimiter">:</span><span class="">
</span><span class="">     </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;r = clear_queuing_port s pid&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;r &#8800; s&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;the (get_the_msgs_of_queuingport r pid) = {}&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword1">from</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;is_a_queuingport s pid&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">clear_queuing_port_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;(ports (comm s)) pid&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3">case</span><span class=""> </span><span class="">None</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">None.hyps</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">is_a_queuingport_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">     </span><span class="keyword1">next</span><span class="">
</span><span class="">      </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Some</span><span class=""> </span><span class="">pt</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;(ports (comm s)) pid = Some pt&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Some.hyps</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;the ((ports (comm s)) pid)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Sampling</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;pt = Sampling x1 x2 x3 x4&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Sampling.hyps</span><span class=""> </span><span class="">b1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">is_a_queuingport_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Queuing</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class=""> </span><span class="">x5</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;pt = Queuing x1 x2 x3 x4 x5&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Queuing.hyps</span><span class=""> </span><span class="">b1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1">with</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(ports (comm r)) pid = Some (Queuing x1 x2 x3 x4 {})&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">clear_queuing_port_def</span><span class=""> </span><span class="">clear_msg_queuingport_def</span><span class=""> 
</span><span class="">            </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Communication_State.select_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="">Communication_State.surjective</span><span class=""> </span><span class="">Communication_State.update_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="">Port_Type.simps</span><span class="delimiter">(</span><span class="">5</span><span class="delimiter">)</span><span class=""> </span><span class="">Queuing.hyps</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">State.surjective</span><span class=""> 
</span><span class="">            </span><span class="">State.update_convs</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">fun_upd_same</span><span class=""> </span><span class="">p2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">get_port_byid_def</span><span class=""> </span><span class="">get_the_msgs_of_queuingport_def</span><span class="delimiter">)</span><span class="">  
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">clear_queuing_port_prepost</span><span class="delimiter">:</span><span class="">
</span><span class="">     </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;r = clear_queuing_port s pid&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;is_a_queuingport s pid&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;is_dest_port s pid&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;is_a_port_of_partition s pid (current s)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;the (get_the_msgs_of_queuingport r pid) = {}&quot;</span><span class="">
</span><span class="">     </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;(ports (comm s)) pid&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">       </span><span class="keyword3">case</span><span class=""> </span><span class="">None</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">None.hyps</span><span class=""> </span><span class="">is_a_queuingport_def</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">  
</span><span class="">     </span><span class="keyword1">next</span><span class="">
</span><span class="">      </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Some</span><span class=""> </span><span class="">pt</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;(ports (comm s)) pid = Some pt&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Some.hyps</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;the ((ports (comm s)) pid)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Sampling</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;pt = Sampling x1 x2 x3 x4&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Sampling.hyps</span><span class=""> </span><span class="">b1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">is_a_queuingport_def</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">  
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Queuing</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class=""> </span><span class="">x5</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;pt = Queuing x1 x2 x3 x4 x5&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Queuing.hyps</span><span class=""> </span><span class="">b1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1">with</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(ports (comm r)) pid = Some (Queuing x1 x2 x3 x4 {})&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">clear_queuing_port_def</span><span class=""> </span><span class="">clear_msg_queuingport_def</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">            </span><span class="keyword3">assume</span><span class=""> </span><span class="string">&quot;r = (if &#172; is_a_queuingport s pid &#8744; &#172; is_a_port_of_partition s pid (current s) 
                          &#8744; &#172; is_dest_port s pid then s 
                         else let cs = comm s; pts = ports cs; pt = ports cs pid 
                            in s&#10631;comm := cs &#10631;ports := pts(pid &#8614; case the pt of 
                                  Queuing spid name maxs d x &#8658; Queuing spid name maxs d {} | 
                                  Sampling spid list port_direction option &#8658; the pt)&#10632;&#10632;)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">hence</span><span class=""> </span><span class="string">&quot;r = s &#10631;comm := comm s &#10631;ports := ports (comm s)(pid &#8614; case the (ports (comm s) pid) of 
                          Queuing n cs na p M &#8658; Queuing n cs na p {} | 
                          Sampling n cs p z &#8658; the (ports (comm s) pid))&#10632;&#10632;&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">full_types</span><span class="delimiter">)</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1">hence</span><span class=""> </span><span class="string">&quot;ports (comm r) pid = Some (case the (ports (comm s) pid) of 
                  Queuing n cs na p M &#8658; Queuing n cs na p {} | 
                  Sampling n cs p z &#8658; the (ports (comm s) pid))&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword3">thus</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">              </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">)</span><span class=""> </span><span class="">Port_Type.simps</span><span class="delimiter">(</span><span class="">5</span><span class="delimiter">)</span><span class=""> </span><span class="">Queuing.hyps</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1">qed</span><span class="">            
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">get_port_byid_def</span><span class=""> </span><span class="">get_the_msgs_of_queuingport_def</span><span class="delimiter">)</span><span class="">  
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{* Invariants: port consistent *}</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1">definition</span><span class=""> </span><span class="">get_ports_util</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(port_id &#8640; &#39;a) &#8658; port_id set&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;get_ports_util f &#8801; {x. f x &#8800; None}&quot;</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1">definition</span><span class=""> </span><span class="">port_consistent</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;State &#8658; bool&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">where</span><span class=""> </span><span class="string">&quot;port_consistent s &#8801; &#8704;p. ((part_ports s) p &#8800; None) = ((ports (comm s)) p &#8800; None) &#8743;
                                      ((ports (comm s)) p &#8800; None &#10230; p = get_portid_in_type (the ((ports (comm s)) p))) &#8743;
                                      ((ports (comm s)) p &#8800; None &#10230; get_portname_by_type (the ((ports (comm s)) p)) 
                                        &#8712; get_partition_cfg_ports_byid sysconf (the ((part_ports s) p)) )&quot;</span><span class="">
</span><span class="">                                     
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">pt_cons_s0</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;port_consistent s0t&quot;</span><span class="">       
</span><span class="">      </span><span class="keyword1">by</span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">port_consistent_def</span><span class=""> </span><span class="">s0t_init</span><span class=""> </span><span class="">system_init_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">crt_smpl_port_presrv_pt_cons</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;port_consistent s&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (create_sampling_port sysconf s pname)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;port_consistent s&#39;&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword1">{</span><span class="">
</span><span class="">      </span><span class="keyword3">fix</span><span class=""> </span><span class="">p</span><span class="">
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(part_ports s&#39; p &#8800; None) = (ports (comm s&#39;) p &#8800; None) 
            &#8743; ((ports (comm s&#39;)) p &#8800; None &#10230; p = get_portid_in_type (the ((ports (comm s&#39;)) p)))
            &#8743; ((ports (comm s&#39;)) p &#8800; None &#10230; get_portname_by_type (the ((ports (comm s&#39;)) p)) 
                                      &#8712; get_partition_cfg_ports_byid sysconf (the ((part_ports s&#39;) p)) )&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;get_samplingport_conf sysconf pname = None 
                    &#8744; get_portid_by_name s pname &#8800; None 
                    &#8744; pname &#8713; get_partition_cfg_ports_byid sysconf (current s)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;get_samplingport_conf sysconf pname = None 
                    &#8744; get_portid_by_name s pname &#8800; None 
                    &#8744; pname &#8713; get_partition_cfg_ports_byid sysconf (current s)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;s&#39; = s&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">create_sampling_port_def</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">port_consistent_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">  
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;&#172; (get_samplingport_conf sysconf pname = None 
                    &#8744; get_portid_by_name s pname &#8800; None 
                    &#8744; pname &#8713; get_partition_cfg_ports_byid sysconf (current s))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> 
</span><span class="">          </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;p=get_portid_in_type (the (get_samplingport_conf sysconf pname))&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;p=get_portid_in_type (the (get_samplingport_conf sysconf pname))&quot;</span><span class="">
</span><span class="">            </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">assume</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;p &#8800; get_portid_in_type (the (get_samplingport_conf sysconf pname))&quot;</span><span class="">
</span><span class="">            </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">            </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;part_ports s p &#8800; None&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword3">assume</span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class="string">&quot;part_ports s p &#8800; None&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class="string">&quot;(ports (comm s)) p &#8800; None&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">port_consistent_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="">d7</span><span class="delimiter">:</span><span class="string">&quot;p = get_portid_in_type (the ((ports (comm s)) p))&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">port_consistent_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="">d3</span><span class="delimiter">:</span><span class="string">&quot;part_ports s&#39; p &#8800; None&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="">d4</span><span class="delimiter">:</span><span class="string">&quot;(ports (comm s&#39;)) p &#8800; None&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="">d6</span><span class="delimiter">:</span><span class="string">&quot;p = get_portid_in_type (the ((ports (comm s&#39;)) p))&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                </span><span class="keyword3">obtain</span><span class=""> </span><span class="">pp</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;Sys_Config &#8658; char list &#8658; Port_Type&quot;</span><span class=""> </span><span class="keyword2">where</span><span class="">
</span><span class="">                  </span><span class="string">&quot;pp sysconf pname &#8712; ports_conf (commconf sysconf)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">get_samplingport_conf_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">port_name_diff</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1">qed</span><span class="">
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="">d8</span><span class="delimiter">:</span><span class="string">&quot;(ports (comm s&#39;)) p = (ports (comm s)) p&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">using</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="">d9</span><span class="delimiter">:</span><span class="string">&quot;(part_ports s&#39;) p = (part_ports s) p&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">using</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="">d10</span><span class="delimiter">:</span><span class="string">&quot;get_portname_by_type (the ((ports (comm s&#39;)) p)) 
                              &#8712; get_partition_cfg_ports_byid sysconf (the ((part_ports s&#39;) p))&quot;</span><span class="">
</span><span class="">                       </span><span class="keyword1">using</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">d8</span><span class=""> </span><span class="">d9</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">port_consistent_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">d3</span><span class=""> </span><span class="">d4</span><span class=""> </span><span class="">d6</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">port_consistent_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">            </span><span class="keyword1">next</span><span class="">
</span><span class="">              </span><span class="keyword3">assume</span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class="string">&quot;&#172; (part_ports s p &#8800; None)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class="string">&quot;(ports (comm s)) p = None&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">port_consistent_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">  
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="">e3</span><span class="delimiter">:</span><span class="string">&quot;part_ports s&#39; p = None&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">using</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="">e4</span><span class="delimiter">:</span><span class="string">&quot;(ports (comm s&#39;)) p = None&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">e3</span><span class=""> </span><span class="">e4</span><span class="delimiter">)</span><span class="">  
</span><span class="">            </span><span class="keyword1">qed</span><span class="">            
</span><span class="">          </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">}</span><span class="">
</span><span class="">    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">port_consistent_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">write_smpl_msg_presrv_pt_cons</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="string">&quot;&#10214;port_consistent s; s&#39; = fst (write_sampling_message s pid msg)&#10215; &#10233; port_consistent s&#39;&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">exec_event_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">write_sampling_message_def</span><span class=""> 
</span><span class="">                        </span><span class="">update_sampling_port_msg_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;ports (comm s) pid&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;a&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class=""> 
</span><span class="">      </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Int_absorb</span><span class=""> </span><span class="">empty_iff</span><span class=""> </span><span class="">option.distinct</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">port_consistent_def</span><span class=""> </span><span class="">port_partition</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">crt_que_port_presrv_pt_cons</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;port_consistent s&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (create_queuing_port sysconf s pname)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;port_consistent s&#39;&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1">{</span><span class="">
</span><span class="">        </span><span class="keyword3">fix</span><span class=""> </span><span class="">p</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(part_ports s&#39; p &#8800; None) = (ports (comm s&#39;) p &#8800; None) 
              &#8743; ((ports (comm s&#39;)) p &#8800; None &#10230; p = get_portid_in_type (the ((ports (comm s&#39;)) p)))
              &#8743; ((ports (comm s&#39;)) p &#8800; None &#10230; get_portname_by_type (the ((ports (comm s&#39;)) p)) 
                                        &#8712; get_partition_cfg_ports_byid sysconf (the ((part_ports s&#39;) p)) )&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;get_queuingport_conf sysconf pname = None 
                      &#8744; get_portid_by_name s pname &#8800; None
                      &#8744; pname &#8713; get_partition_cfg_ports_byid sysconf (current s)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;get_queuingport_conf sysconf pname = None 
                      &#8744; get_portid_by_name s pname &#8800; None
                      &#8744; pname &#8713; get_partition_cfg_ports_byid sysconf (current s)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">create_queuing_port_def</span><span class=""> </span><span class="">eq_fst_iff</span><span class=""> 
</span><span class="">              </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">port_consistent_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1">next</span><span class="">
</span><span class="">          </span><span class="keyword3">assume</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;&#172; (get_queuingport_conf sysconf pname = None 
                      &#8744; get_portid_by_name s pname &#8800; None
                      &#8744; pname &#8713; get_partition_cfg_ports_byid sysconf (current s))&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;p=get_portid_in_type (the (get_queuingport_conf sysconf pname))&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;p=get_portid_in_type (the (get_queuingport_conf sysconf pname))&quot;</span><span class="">
</span><span class="">            </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">assume</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;p &#8800; get_portid_in_type (the (get_queuingport_conf sysconf pname))&quot;</span><span class="">
</span><span class="">            </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">            </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;part_ports s p &#8800; None&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword3">assume</span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class="string">&quot;part_ports s p &#8800; None&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class="string">&quot;(ports (comm s)) p &#8800; None&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">port_consistent_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="">d3</span><span class="delimiter">:</span><span class="string">&quot;part_ports s&#39; p &#8800; None&quot;</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="">d7</span><span class="delimiter">:</span><span class="string">&quot;p = get_portid_in_type (the ((ports (comm s)) p))&quot;</span><span class=""> 
</span><span class="">                </span><span class="keyword1">using</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">port_consistent_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="">d4</span><span class="delimiter">:</span><span class="string">&quot;(ports (comm s&#39;)) p &#8800; None&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="">d6</span><span class="delimiter">:</span><span class="string">&quot;p = get_portid_in_type (the ((ports (comm s&#39;)) p))&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">using</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="">d8</span><span class="delimiter">:</span><span class="string">&quot;(ports (comm s&#39;)) p = (ports (comm s)) p&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">using</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="">d9</span><span class="delimiter">:</span><span class="string">&quot;(part_ports s&#39;) p = (part_ports s) p&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">using</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="">d10</span><span class="delimiter">:</span><span class="string">&quot;get_portname_by_type (the ((ports (comm s&#39;)) p)) 
                              &#8712; get_partition_cfg_ports_byid sysconf (the ((part_ports s&#39;) p))&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">using</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">d8</span><span class=""> </span><span class="">d9</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">port_consistent_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">d3</span><span class=""> </span><span class="">d4</span><span class=""> </span><span class="">d6</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">port_consistent_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">            </span><span class="keyword1">next</span><span class="">
</span><span class="">              </span><span class="keyword3">assume</span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class="string">&quot;&#172; (part_ports s p &#8800; None)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class="string">&quot;(ports (comm s)) p = None&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">port_consistent_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">  
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="">e3</span><span class="delimiter">:</span><span class="string">&quot;part_ports s&#39; p = None&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="">e4</span><span class="delimiter">:</span><span class="string">&quot;(ports (comm s&#39;)) p = None&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">e3</span><span class=""> </span><span class="">e4</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1">qed</span><span class="">
</span><span class="">          </span><span class="keyword1">qed</span><span class="">
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">}</span><span class="">
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">port_consistent_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">      </span><span class="keyword1">lemma</span><span class=""> </span><span class="">st_msg_destspl_ports_nchg_ports</span><span class=""> </span><span class="delimiter">:</span><span class=""> 
</span><span class="">      </span><span class="keyword2">assumes</span><span class="">   </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;nports = st_msg_destspl_ports oports pids m&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;&#8704;x. (oports x &#8800; None) = (nports x &#8800; None)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class=""> 
</span><span class="">      </span><span class="keyword1">{</span><span class="">
</span><span class="">        </span><span class="keyword3">fix</span><span class=""> </span><span class="">x</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(oports x &#8800; None) = (nports x &#8800; None)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;oports x = None&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;oports x = None&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">with</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;nports x = None&quot;</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">st_msg_destspl_ports_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">          </span><span class="keyword1">with</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1">next</span><span class="">
</span><span class="">          </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;oports x &#8800; None&quot;</span><span class="">
</span><span class="">          </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">            </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;the (oports x)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Queuing</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class=""> </span><span class="">x5</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;oports x = Some (Queuing x1 x2 x3 x4 x5)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Queuing.hyps</span><span class=""> </span><span class="">b0</span><span class="delimiter">)</span><span class="">  
</span><span class="">              </span><span class="keyword1">with</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;nports x = Some (Queuing x1 x2 x3 x4 x5)&quot;</span><span class=""> 
</span><span class="">                </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">st_msg_destspl_ports_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">              </span><span class="keyword1">with</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1">next</span><span class="">
</span><span class="">              </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Sampling</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;oports x = Some (Sampling x1 x2 x3 x4)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Sampling.hyps</span><span class=""> </span><span class="">b0</span><span class="delimiter">)</span><span class="">  
</span><span class="">              </span><span class="keyword1">with</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;nports x = Some (Sampling x1 x2 x3 (Some m))&quot;</span><span class=""> 
</span><span class="">                </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">st_msg_destspl_ports_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">              </span><span class="keyword1">with</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1">qed</span><span class="">
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">}</span><span class="">
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">     </span><span class="keyword1">lemma</span><span class=""> </span><span class="">update_sampling_ports_msg_nchg_ports</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class="">   </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = update_sampling_ports_msg s pts m&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;&#8704;x. ((ports (comm s)) x &#8800; None) = ((ports (comm s&#39;)) x &#8800; None) &#8743;
                    ((part_ports s) x &#8800; None) = ((part_ports s&#39;) x &#8800; None)&quot;</span><span class="">
</span><span class="">     </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class=""> 
</span><span class="">       </span><span class="keyword1">{</span><span class="keyword3">fix</span><span class=""> </span><span class="">x</span><span class="">
</span><span class="">       </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot; ((part_ports s) x &#8800; None) = ((part_ports s&#39;) x &#8800; None)&quot;</span><span class="">
</span><span class="">         </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">State.ext_inject</span><span class=""> </span><span class="">State.surjective</span><span class=""> </span><span class="">State.update_convs</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">update_sampling_ports_msg_def</span><span class="delimiter">)</span><span class="">
</span><span class="">       </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;((ports (comm s)) x &#8800; None) = ((ports (comm s&#39;)) x &#8800; None)&quot;</span><span class="">
</span><span class="">       </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">         </span><span class="keyword3">fix</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="">nat</span><span class="">
</span><span class="">         </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#10631;ports = ports (comm s&#39;), &#8230; = Communication_State.more (comm s&#39;)&#10632; 
          = comm (update_sampling_ports_msg s pts m)&quot;</span><span class="">
</span><span class="">           </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Communication_State.surjective</span><span class=""> </span><span class="">p1</span><span class="delimiter">)</span><span class="">
</span><span class="">         </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#10631;ports = st_msg_destspl_ports (ports (comm 
           &#10631;current = current s, partitions = partitions s, comm = comm s, part_ports = part_ports s, &#8230; = State.more s&#10632;)) 
           pts m, &#8230; = Communication_State.more (comm s)&#10632; = &#10631;ports = ports (comm s&#39;), &#8230; = Communication_State.more (comm s&#39;)&#10632;&quot;</span><span class="">
</span><span class="">           </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">)</span><span class=""> </span><span class="">Communication_State.surjective</span><span class=""> </span><span class="">Communication_State.update_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">             </span><span class="">State.ext_inject</span><span class=""> </span><span class="">State.surjective</span><span class=""> </span><span class="">State.update_convs</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">update_sampling_ports_msg_def</span><span class="delimiter">)</span><span class="">
</span><span class="">         </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(ports (comm s) x &#8800; None) &#8800; (ports (comm s&#39;) x = None)&quot;</span><span class="">
</span><span class="">           </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">)</span><span class=""> </span><span class="">Communication_State.ext_inject</span><span class=""> </span><span class="">State.surjective</span><span class=""> </span><span class="">st_msg_destspl_ports_nchg_ports</span><span class="delimiter">)</span><span class="">
</span><span class="">         </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;(ports (comm s) x &#8800; None) = (ports (comm s&#39;) x &#8800; None)&quot;</span><span class="">
</span><span class="">           </span><span class="keyword1">by</span><span class=""> </span><span class="">satx</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class=""> 
</span><span class="">      </span><span class="keyword1">ultimately</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;((ports (comm s)) x &#8800; None) = ((ports (comm s&#39;)) x &#8800; None) &#8743;
                    ((part_ports s) x &#8800; None) = ((part_ports s&#39;) x &#8800; None)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">}</span><span class=""> </span><span class="keyword3">thus</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">      
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">trans_spl_msg_presrv_pt_cons</span><span class="delimiter">:</span><span class="string">&quot;port_consistent s &#10233; port_consistent (transf_sampling_msg s ch)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword1">{</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;port_consistent s&quot;</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">ch</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Channel_Sampling</span><span class=""> </span><span class="">cn</span><span class=""> </span><span class="">sn</span><span class=""> </span><span class="">dns</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">transf_sampling_msg_def</span><span class=""> </span><span class="">Let_def</span><span class="delimiter">,</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">,</span><span class="">rule</span><span class=""> </span><span class="">impI</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;(&#8707;y. get_portid_by_name s sn = Some y) &#8743; card (get_portids_by_names s dns) = card dns &#10233;
                  port_consistent (update_sampling_ports_msg s (get_portids_by_names s dns)
                     (the (get_the_msg_of_samplingport s (the (get_portid_by_name s sn)))))&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">          </span><span class="keyword1">{</span><span class="">
</span><span class="">            </span><span class="keyword1">let</span><span class=""> </span><span class="var">?s&#39;</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;update_sampling_ports_msg s (get_portids_by_names s dns)
                      (the (get_the_msg_of_samplingport s (the (get_portid_by_name s sn))))&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">from</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;&#8704;p. ((part_ports s p &#8800; None) = (ports (comm s) p &#8800; None)) 
                      &#8743; ((ports (comm s)) p &#8800; None &#10230; p = get_portid_in_type (the ((ports (comm s)) p)))
                      &#8743; ((ports (comm s)) p &#8800; None &#10230; get_portname_by_type (the ((ports (comm s)) p)) 
                              &#8712; get_partition_cfg_ports_byid sysconf (the ((part_ports s) p)) )&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1">using</span><span class=""> </span><span class="">port_consistent_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">            </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;&#8704;x. ((ports (comm s)) x &#8800; None) = ((ports (comm ?s&#39;)) x &#8800; None) &#8743;
              ((part_ports s) x &#8800; None) = ((part_ports ?s&#39;) x &#8800; None)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">update_sampling_ports_msg_nchg_ports</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">presburger</span><span class=""> 
</span><span class="">            </span><span class="keyword1">have</span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class="string">&quot;&#8704;x. ((ports (comm ?s&#39;)) x &#8800; None &#10230; x = get_portid_in_type (the ((ports (comm ?s&#39;)) x)))&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">            </span><span class="keyword1">have</span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class="string">&quot;&#8704;x. ((ports (comm ?s&#39;)) x &#8800; None &#10230; get_portname_by_type (the ((ports (comm ?s&#39;)) x)) 
                              &#8712; get_partition_cfg_ports_byid sysconf (the ((part_ports ?s&#39;) x)) )&quot;</span><span class="">
</span><span class="">                     </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Int_absorb</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">emptyE</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="">update_sampling_ports_msg_nchg_ports</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1">with</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;port_consistent ?s&#39;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">port_consistent_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">          </span><span class="keyword1">}</span><span class="">
</span><span class="">          </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">qed</span><span class="">
</span><span class="">          </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;(get_portid_by_name s sn = None &#10230; port_consistent s) &#8743;
                (card (get_portids_by_names s dns) &#8800; card dns &#10230; port_consistent s)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">a0</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">        </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Channel_Queuing</span><span class=""> </span><span class="">cn</span><span class=""> </span><span class="">sn</span><span class=""> </span><span class="">dn</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">a0</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">}</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">remove_msg_from_queuingport_presv_port_cons</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="keyword2">assumes</span><span class="">   </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (remove_msg_from_queuingport s pt)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">     </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;port_consistent s&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;port_consistent s&#39;&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;(ports (comm s)) pt&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3">case</span><span class=""> </span><span class="">None</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">None.hyps</span><span class=""> </span><span class="">option.case_eq_if</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">remove_msg_from_queuingport_def</span><span class="delimiter">)</span><span class="">   
</span><span class="">    </span><span class="keyword1">next</span><span class="">
</span><span class="">      </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Some</span><span class=""> </span><span class="">t</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;(ports (comm s)) pt = Some t&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Some.hyps</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">  
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;the ((ports (comm s)) pt)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Queuing</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class=""> </span><span class="">x5</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1">from</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8704;p. ((part_ports s) p &#8800; None) = ((ports (comm s)) p &#8800; None) &#8743;
                            ((ports (comm s)) p &#8800; None &#10230; p = get_portid_in_type (the ((ports (comm s)) p))) &#8743; 
                                  ((ports (comm s)) p &#8800; None &#10230; get_portname_by_type (the ((ports (comm s)) p)) 
                                    &#8712; get_partition_cfg_ports_byid sysconf (the ((part_ports s) p)) )&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">using</span><span class=""> </span><span class="">port_consistent_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">disjoint_iff_not_equal</span><span class=""> </span><span class="">option.distinct</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">port_partition</span><span class="delimiter">)</span><span class="">        
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Sampling</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;Some (Sampling x1 x2 x3 x4) = ports (comm s) pt&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Sampling.hyps</span><span class=""> </span><span class="">a0</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;s&#39; = s&quot;</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">remove_msg_from_queuingport_def</span><span class="">
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Port_Type.simps</span><span class="delimiter">(</span><span class="">6</span><span class="delimiter">)</span><span class=""> </span><span class="">eq_fst_iff</span><span class=""> </span><span class="">option.simps</span><span class="delimiter">(</span><span class="">5</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="">p1</span><span class=""> </span><span class="">remove_msg_from_queuingport_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1">with</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">recv_que_msg_presv_port_cons</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="string">&quot;&#10214;s&#39; = fst (receive_queuing_message s pt); port_consistent s&#10215; &#10233; port_consistent s&#39;&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">exec_event_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">receive_queuing_message_def</span><span class=""> </span><span class="">remove_msg_from_queuingport_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;ports (comm s) pt&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;a&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">full_types</span><span class="delimiter">)</span><span class=""> </span><span class="">remove_msg_from_queuingport_def</span><span class=""> 
</span><span class="">          </span><span class="">remove_msg_from_queuingport_presv_port_cons</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">insert_msg2queuing_port_presv_port_cons</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="keyword2">assumes</span><span class="">   </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = insert_msg2queuing_port s pt m&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">     </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;port_consistent s&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;port_consistent s&#39;&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;(ports (comm s)) pt&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3">case</span><span class=""> </span><span class="">None</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">None.hyps</span><span class=""> </span><span class="">insert_msg2queuing_port_def</span><span class=""> </span><span class="">option.case_eq_if</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class="delimiter">)</span><span class="">    
</span><span class="">    </span><span class="keyword1">next</span><span class="">
</span><span class="">      </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Some</span><span class=""> </span><span class="">t</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;(ports (comm s)) pt = Some t&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Some.hyps</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">  
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;the ((ports (comm s)) pt)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Queuing</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class=""> </span><span class="">x5</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1">from</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;&#8704;p. ((part_ports s) p &#8800; None) = ((ports (comm s)) p &#8800; None) &#8743;
                            ((ports (comm s)) p &#8800; None &#10230; p = get_portid_in_type (the ((ports (comm s)) p))) &#8743; 
                                  ((ports (comm s)) p &#8800; None &#10230; get_portname_by_type (the ((ports (comm s)) p)) 
                                    &#8712; get_partition_cfg_ports_byid sysconf (the ((part_ports s) p)) )&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">using</span><span class=""> </span><span class="">port_consistent_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">disjoint_iff_not_equal</span><span class=""> </span><span class="">option.distinct</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">port_partition</span><span class="delimiter">)</span><span class="">          
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Sampling</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;Some (Sampling x1 x2 x3 x4) = ports (comm s) pt&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Sampling.hyps</span><span class=""> </span><span class="">a0</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;s&#39; = s&quot;</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">insert_msg2queuing_port_def</span><span class="">
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Port_Type.simps</span><span class="delimiter">(</span><span class="">6</span><span class="delimiter">)</span><span class=""> </span><span class="">insert_msg2queuing_port_def</span><span class=""> </span><span class="">option.simps</span><span class="delimiter">(</span><span class="">5</span><span class="delimiter">)</span><span class=""> </span><span class="">p1</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1">with</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">send_que_msg_presv_port_cons</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="string">&quot;&#10214;s&#39; = fst (send_queuing_message_maylost sysconf s pt m); port_consistent s&#10215; &#10233; port_consistent s&#39;&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">exec_event_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">send_queuing_message_maylost_def</span><span class=""> 
</span><span class="">            </span><span class="">replace_msg2queuing_port_def</span><span class=""> </span><span class="">insert_msg2queuing_port_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;ports (comm s) pt&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;a&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">full_types</span><span class="delimiter">)</span><span class=""> </span><span class="">insert_msg2queuing_port_def</span><span class=""> 
</span><span class="">            </span><span class="">insert_msg2queuing_port_presv_port_cons</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">trans_que_msg_presrv_pt_cons</span><span class="delimiter">:</span><span class="string">&quot;port_consistent s &#10233; port_consistent (transf_queuing_msg_maylost sysconf s ch)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword1">{</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;port_consistent s&quot;</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">ch</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Channel_Queuing</span><span class=""> </span><span class="">cn</span><span class=""> </span><span class="">sn</span><span class=""> </span><span class="">dn</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">        </span><span class="keyword1">{</span><span class="">
</span><span class="">          </span><span class="keyword1">let</span><span class=""> </span><span class="var">?sm</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;remove_msg_from_queuingport s (the (get_portid_by_name s sn))&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">let</span><span class=""> </span><span class="var">?s0</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;fst ?sm&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">let</span><span class=""> </span><span class="var">?s1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;replace_msg2queuing_port ?s0 (the (get_portid_by_name s dn)) (the (snd ?sm))&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">let</span><span class=""> </span><span class="var">?s2</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;insert_msg2queuing_port ?s0 (the (get_portid_by_name s dn)) (the (snd ?sm))&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">let</span><span class=""> </span><span class="var">?s3</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;transf_queuing_msg_maylost sysconf s ch&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;port_consistent ?s0&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">remove_msg_from_queuingport_presv_port_cons</span><span class="delimiter">)</span><span class="">  
</span><span class="">          </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class="string">&quot;port_consistent ?s1&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">replace_msg2queuing_port_def</span><span class="delimiter">)</span><span class="">  
</span><span class="">          </span><span class="keyword1">with</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b5</span><span class="delimiter">:</span><span class="string">&quot;port_consistent ?s2&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">insert_msg2queuing_port_presv_port_cons</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> 
</span><span class="">            </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">transf_queuing_msg_maylost_def</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">b2</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1">}</span><span class="">
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">        </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Channel_Sampling</span><span class=""> </span><span class="">cn</span><span class=""> </span><span class="">sn</span><span class=""> </span><span class="">dns</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">a0</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">}</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">clr_que_port_presrv_pt_cons</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="keyword2">assumes</span><span class="">   </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = clear_queuing_port s pid&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">     </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;port_consistent s&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;port_consistent s&#39;&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword1">{</span><span class="">
</span><span class="">      </span><span class="keyword3">fix</span><span class=""> </span><span class="">p</span><span class="">
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;((part_ports s&#39;) p &#8800; None) = ((ports (comm s&#39;)) p &#8800; None) &#8743;
              ((ports (comm s&#39;)) p &#8800; None &#10230; p = get_portid_in_type (the ((ports (comm s&#39;)) p))) &#8743;
              ((ports (comm s&#39;)) p &#8800; None &#10230; get_portname_by_type (the ((ports (comm s&#39;)) p)) 
                &#8712; get_partition_cfg_ports_byid sysconf (the ((part_ports s&#39;) p)) )&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;&#172; is_a_queuingport s pid 
                    &#8744; &#172; is_a_port_of_partition s pid (current s)
                    &#8744; &#172; is_dest_port s pid&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_queuingport s pid 
                    &#8744; &#172; is_a_port_of_partition s pid (current s)
                    &#8744; &#172; is_dest_port s pid&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">with</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;s&#39; = s&quot;</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">clear_queuing_port_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1">with</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">port_consistent_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;&#172;(&#172; is_a_queuingport s pid
                    &#8744; &#172; is_a_port_of_partition s pid (current s)
                    &#8744; &#172; is_dest_port s pid)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">emptyE</span><span class=""> </span><span class="">inf.idem</span><span class=""> </span><span class="">is_a_port_of_partition_def</span><span class=""> 
</span><span class="">              </span><span class="">option.distinct</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">port_consistent_def</span><span class=""> </span><span class="">port_partition</span><span class="delimiter">)</span><span class="">              
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">}</span><span class="">
</span><span class="">    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">port_consistent_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">set_part_mode_presrv_pt_cons</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="keyword2">assumes</span><span class="">   </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = set_partition_mode sysconf s m&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">     </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;port_consistent s&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;port_consistent s&#39;&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword1">{</span><span class="">
</span><span class="">      </span><span class="keyword3">fix</span><span class=""> </span><span class="">p</span><span class="">
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;((part_ports s&#39;) p &#8800; None) = ((ports (comm s&#39;)) p &#8800; None) &#8743;
              ((ports (comm s&#39;)) p &#8800; None &#10230; p = get_portid_in_type (the ((ports (comm s&#39;)) p))) &#8743;
              ((ports (comm s&#39;)) p &#8800; None &#10230; get_portname_by_type (the ((ports (comm s&#39;)) p)) 
                &#8712; get_partition_cfg_ports_byid sysconf (the ((part_ports s&#39;) p)) )&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;(partconf sysconf) (current s) &#8800; None &#8743; (partitions s) (current s) &#8800; None &#8743;
                  &#172; (part_mode (the ((partitions s) (current s))) = COLD_START &#8743; m = WARM_START)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;(partconf sysconf) (current s) &#8800; None &#8743; (partitions s) (current s) &#8800; None &#8743;
                  &#172; (part_mode (the ((partitions s) (current s))) = COLD_START &#8743; m = WARM_START)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">port_consistent_def</span><span class="">
</span><span class="">          </span><span class="keyword1">using</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">set_partition_mode_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">force</span><span class=""> 
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;&#172;((partconf sysconf) (current s) &#8800; None &#8743; (partitions s) (current s) &#8800; None &#8743;
                  &#172; (part_mode (the ((partitions s) (current s))) = COLD_START &#8743; m = WARM_START))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;s&#39; = s&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">set_partition_mode_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">port_consistent_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">       </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">}</span><span class="">
</span><span class="">    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">port_consistent_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">          
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">pt_cons_execevt</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;port_consistent s &#10233; &#8704;s&#39;. (s,s&#39;)&#8712;exec_event a &#10230; port_consistent s&#39;&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword1">{</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;port_consistent s&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">{</span><span class="">
</span><span class="">        </span><span class="keyword3">fix</span><span class=""> </span><span class="">s&#39;</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(s,s&#39;)&#8712;exec_event a&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;port_consistent s&#39;&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;event_enabled s a = True&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;event_enabled s a &#8800; True&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">with</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">exec_event_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1">next</span><span class="">
</span><span class="">          </span><span class="keyword3">assume</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;event_enabled s a = True&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">with</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">a</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">hyperc</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">  
</span><span class="">              </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">crt_smpl_port_presrv_pt_cons</span><span class=""> </span><span class="">exec_event_def</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">write_smpl_msg_presrv_pt_cons</span><span class=""> </span><span class="">exec_event_def</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">read_sampling_message_def</span><span class=""> </span><span class="">exec_event_def</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">get_sampling_port_id_def</span><span class=""> </span><span class="">exec_event_def</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">get_sampling_port_status_def</span><span class=""> </span><span class="">exec_event_def</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">crt_que_port_presrv_pt_cons</span><span class=""> </span><span class="">exec_event_def</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">send_que_msg_presv_port_cons</span><span class=""> </span><span class="">exec_event_def</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">recv_que_msg_presv_port_cons</span><span class=""> </span><span class="">exec_event_def</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">get_queuing_port_id_def</span><span class=""> </span><span class="">exec_event_def</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">get_queuing_port_status_def</span><span class=""> </span><span class="">exec_event_def</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">clr_que_port_presrv_pt_cons</span><span class=""> </span><span class="">exec_event_def</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">set_part_mode_presrv_pt_cons</span><span class=""> </span><span class="">exec_event_def</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">get_partition_status_def</span><span class=""> </span><span class="">exec_event_def</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">            </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">sys</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">port_consistent_def</span><span class=""> </span><span class="">exec_event_def</span><span class=""> </span><span class="">schedule_def</span><span class=""> 
</span><span class="">                    </span><span class="">trans_spl_msg_presrv_pt_cons</span><span class=""> </span><span class="">trans_que_msg_presrv_pt_cons</span><span class="">
</span><span class="">                    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">x</span><span class="delimiter">,</span><span class=""> </span><span class="">auto</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1">qed</span><span class="">
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">}</span><span class="">
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1">}</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">pt_cons_exec</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;s s&#39; as. port_consistent s &#8743; s&#39; &#8712; execute as s &#10230; port_consistent s&#39;&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1">{</span><span class="">
</span><span class="">        </span><span class="keyword3">fix</span><span class=""> </span><span class="">as</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8704;s s&#39;. port_consistent s &#8743; s&#39; &#8712; execute as s &#10230; port_consistent s&#39;&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">as</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3">case</span><span class=""> </span><span class="">Nil</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">execute_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Cons</span><span class=""> </span><span class="">b</span><span class=""> </span><span class="">bs</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;&#8704;s s&#39;. port_consistent s &#8743; s&#39; &#8712; execute bs s &#10230; port_consistent s&#39;&quot;</span><span class="">
</span><span class="">            </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">              </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">              </span><span class="keyword1">{</span><span class="">
</span><span class="">                </span><span class="keyword3">fix</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">s&#39;</span><span class="">
</span><span class="">                </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;port_consistent s&quot;</span><span class="">
</span><span class="">                </span><span class="keyword3">assume</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;s&#39; &#8712; execute (b # bs) s&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;port_consistent s&#39;&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                  </span><span class="keyword1">{</span><span class="">
</span><span class="">                    </span><span class="keyword1">from</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8707;s1. (s,s1)&#8712;exec_event b &#8743; (s1,s&#39;)&#8712;run bs&quot;</span><span class=""> 
</span><span class="">                      </span><span class="keyword1">using</span><span class=""> </span><span class="">execute_def</span><span class=""> </span><span class="">run_Cons</span><span class=""> </span><span class="">Image_singleton</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> </span><span class="">relcompEpair</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">obtain</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="keyword2">where</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(s,s1)&#8712;exec_event b &#8743; (s1,s&#39;)&#8712;run bs&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1">with</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;port_consistent s1&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">exec_event_def</span><span class=""> </span><span class="">pt_cons_execevt</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">execute_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                  </span><span class="keyword1">}</span><span class="">
</span><span class="">                  </span><span class="keyword1">qed</span><span class="">
</span><span class="">              </span><span class="keyword1">}</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1">qed</span><span class="">
</span><span class="">         </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">}</span><span class="">
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">port_cons_reach_state</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;reachable0 s &#10233; port_consistent s&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">using</span><span class=""> </span><span class="">pt_cons_exec</span><span class=""> </span><span class="">pt_cons_s0</span><span class=""> </span><span class="">reachable_def</span><span class=""> </span><span class="">reachable0_def</span><span class="">
</span><span class="">        </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Image_singleton</span><span class=""> </span><span class="">execute_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{* Deadlock free *}</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">deadlock_free</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;reachable0 s &#10233; (&#8707;e. event_enabled s e)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">System_Event.case</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">event_enabled.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="">
</span><span class="keyword1">subsection</span><span class="verbatim">{* Some lemmas of security proofs *}</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">que_port_not_samp</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;is_a_queuingport s p &#10233; &#172; is_a_samplingport s p&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">is_a_queuingport_def</span><span class=""> </span><span class="">is_a_samplingport_def</span><span class="delimiter">)</span><span class="">      
</span><span class="">      </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Port_Type.case</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Port_Type.case</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">Port_Type.exhaust</span><span class=""> </span><span class="">option.case_eq_if</span><span class="delimiter">)</span><span class="">
</span><span class="">      
</span><span class="">
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">samp_port_not_que</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;is_a_samplingport s p &#10233; &#172; is_a_queuingport s p&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">using</span><span class=""> </span><span class="">que_port_not_samp</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">src_port_not_dest</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;is_source_port s p &#10233; &#172; is_dest_port s p&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">is_source_port_def</span><span class=""> </span><span class="">is_dest_port_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Port_Type.exhaust</span><span class=""> </span><span class="">Port_Type.simps</span><span class="delimiter">(</span><span class="">5</span><span class="delimiter">)</span><span class=""> </span><span class="">Port_Type.simps</span><span class="delimiter">(</span><span class="">6</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="">option.case_eq_if</span><span class=""> </span><span class="">port_direction.exhaust</span><span class=""> </span><span class="">port_direction.simps</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">port_direction.simps</span><span class="delimiter">(</span><span class="">4</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">      
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">dest_port_not_src</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;is_dest_port s p &#10233; &#172; is_source_port s p&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">using</span><span class=""> </span><span class="">src_port_not_dest</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">sche_imp_not_part</span><span class="delimiter">:</span><span class="string">&quot;is_a_scheduler sysconf d &#10233; &#172; (is_a_partition sysconf d)&quot;</span><span class="">      
</span><span class="">      </span><span class="keyword1">using</span><span class=""> </span><span class="">sch_not_part</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">part_imp_not_sch</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;is_a_partition sysconf d &#10233; &#172; (is_a_scheduler sysconf d)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">sch_not_part</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">part_imp_not_tras</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;is_a_partition sysconf d &#10233; &#172; (is_a_transmitter sysconf d)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">trans_not_part</span><span class="delimiter">)</span><span class="">
</span><span class="">                                            
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">trans_imp_not_part</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;is_a_transmitter sysconf d &#10233; &#172; (is_a_partition sysconf d)&quot;</span><span class="">      
</span><span class="">      </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">trans_not_part</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">sche_imp_not_trans</span><span class="delimiter">:</span><span class="string">&quot;is_a_scheduler sysconf d &#10233; &#172; (is_a_transmitter sysconf d)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">using</span><span class=""> </span><span class="">sch_not_trans</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">trans_imp_not_sche</span><span class="delimiter">:</span><span class="string">&quot;is_a_transmitter sysconf d &#10233; &#172; (is_a_scheduler sysconf d)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">using</span><span class=""> </span><span class="">sch_not_trans</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">crt_imp_sche</span><span class="delimiter">:</span><span class="string">&quot;&#10214;&#8704;v .v&#8712; the ((domv sysconf) (scheduler sysconf)) &#10230; (val (vars s)) v = (val (vars t)) v;
                        current s = current t&#10215; &#10233; (s &#8764; (scheduler sysconf)&#8764; t)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">trans_hasnoports</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;get_partition_cfg_ports_byid sysconf (transmitter sysconf) = {}&quot;</span><span class="">
</span><span class="">       </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">get_partition_cfg_ports_byid_def</span><span class=""> </span><span class="">is_a_partition_def</span><span class=""> </span><span class="">is_a_transmitter_def</span><span class=""> </span><span class="">part_imp_not_tras</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">sched_hasnoports</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;get_partition_cfg_ports_byid sysconf (scheduler sysconf) = {}&quot;</span><span class="">
</span><span class="">       </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">get_partition_cfg_ports_byid_def</span><span class=""> </span><span class="">is_a_partition_def</span><span class=""> </span><span class="">is_a_scheduler_def</span><span class=""> </span><span class="">part_imp_not_sch</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">part_ports_imp_portofpart</span><span class="delimiter">:</span><span class="string">&quot;part_ports s = part_ports s&#39; &#10230; 
                                  get_ports_of_partition s d = get_ports_of_partition s&#39; d&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class=""> 
</span><span class="">  </span><span class="keyword1">{</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;part_ports s = part_ports s&#39;&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;get_ports_of_partition s d = get_ports_of_partition s&#39; d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8704;p. p&#8712;get_ports_of_partition s d &#10230; p&#8712; get_ports_of_partition s&#39; d&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1">{</span><span class="">
</span><span class="">        </span><span class="keyword3">fix</span><span class=""> </span><span class="">p</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="string">&quot;p&#8712;get_ports_of_partition s d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(part_ports s) p = Some d&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">get_ports_of_partition_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1">with</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(part_ports s&#39;) p = Some d&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;p&#8712;get_ports_of_partition s&#39; d&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">get_ports_of_partition_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1">}</span><span class="">
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">moreover</span><span class="">
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8704;p. p&#8712;get_ports_of_partition s&#39; d &#10230; p&#8712; get_ports_of_partition s d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1">{</span><span class="">
</span><span class="">        </span><span class="keyword3">fix</span><span class=""> </span><span class="">p</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="string">&quot;p&#8712;get_ports_of_partition s&#39; d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(part_ports s&#39;) p = Some d&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">get_ports_of_partition_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1">with</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(part_ports s) p = Some d&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;p&#8712;get_ports_of_partition s d&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">get_ports_of_partition_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1">}</span><span class="">
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">calculation</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">  </span><span class="keyword1">}</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">no_cfgport_impl_noports</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;reachable0 s; get_partition_cfg_ports_byid sysconf d = {}&#10215; 
                                &#10233; get_ports_of_partition s d = {}&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;get_partition_cfg_ports_byid sysconf d = {}&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;get_ports_of_partition s d = {}&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1">from</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;port_consistent s&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">port_cons_reach_state</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class="string">&quot;&#8704;x. (part_ports s) x &#8800; Some d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1">{</span><span class="">
</span><span class="">        </span><span class="keyword3">fix</span><span class=""> </span><span class="">x</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(part_ports s) x = Some d &#10230; False&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">          </span><span class="keyword1">{</span><span class="">
</span><span class="">            </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;(part_ports s) x = Some d&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">have</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;(ports (comm s)) x &#8800; None&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">port_consistent_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">            </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;get_portname_by_type (the ((ports (comm s)) x)) 
                                &#8712; get_partition_cfg_ports_byid sysconf (the ((part_ports s) x))&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">port_consistent_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">            </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;False&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">p1</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1">}</span><span class="">
</span><span class="">          </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">}</span><span class="">
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#172;(&#8707;x. (part_ports s) x = Some d)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">get_ports_of_partition_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">rm_msg_queport_dec_size1</span><span class="delimiter">:</span><span class="string">&quot;is_a_queuingport s p &#8743; &#172; is_empty_port s p
  &#10230; get_port_buf_size s p = get_port_buf_size (fst (remove_msg_from_queuingport s p)) p + 1&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1">{</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;is_a_queuingport s p&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_empty_port s p&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;get_port_buf_size s p = get_port_buf_size (fst (remove_msg_from_queuingport s p)) p + 1&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;(ports (comm s)) p&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3">case</span><span class=""> </span><span class="">None</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">None.hyps</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">is_a_queuingport_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">    </span><span class="keyword1">next</span><span class="">
</span><span class="">      </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Some</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;x = the ((ports (comm s)) p)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Some.hyps</span><span class=""> </span><span class="">option.sel</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;the ((ports (comm s)) p)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Queuing</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class=""> </span><span class="">x5</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;(ports (comm s)) p = Some (Queuing x1 x2 x3 x4 x5)&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">Queuing.hyps</span><span class=""> </span><span class="">Some.hyps</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">          </span><span class="keyword1">let</span><span class=""> </span><span class="var">?s&#39;</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;fst (remove_msg_from_queuingport s p)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">let</span><span class=""> </span><span class="var">?msgs</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;the (get_msgs_from_queuingport (the ((ports (comm s)) p)))&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">let</span><span class=""> </span><span class="var">?msgs&#39;</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;the (get_msgs_from_queuingport (the ((ports (comm ?s&#39;)) p)))&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">let</span><span class=""> </span><span class="var">?m</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;SOME x. x&#8712;?msgs&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">let</span><span class=""> </span><span class="var">?m1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;SOME x. x&#8712;x5&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">from</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;(ports (comm ?s&#39;)) p = Some (Queuing x1 x2 x3 x4 (x5-{?m1}))&quot;</span><span class=""> 
</span><span class="">            </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">remove_msg_from_queuingport_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">          </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class="string">&quot;?msgs&#39; = x5-{?m1}&quot;</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">get_msgs_from_queuingport_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class="string">&quot;x5 = ?msgs&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Queuing.hyps</span><span class=""> </span><span class="">get_msgs_from_queuingport.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">option.sel</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c4</span><span class="delimiter">:</span><span class="string">&quot;?m1 = ?m&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">          </span><span class="keyword1">from</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c5</span><span class="delimiter">:</span><span class="string">&quot;card x5 &#8800; 0&quot;</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">is_empty_port_def</span><span class=""> </span><span class="">get_current_bufsize_port_def</span><span class="">
</span><span class="">            </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Queuing.hyps</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">get_current_bufsize_port.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">get_port_byid_def</span><span class=""> </span><span class="">is_empty_port_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c6</span><span class="delimiter">:</span><span class="string">&quot;card x5 &gt; 0&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">          </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c7</span><span class="delimiter">:</span><span class="string">&quot;?m &#8712; x5&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">some_in_eq</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">          </span><span class="keyword1">with</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="">c6</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;card ?msgs = card ?msgs&#39; + 1&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_pred</span><span class=""> </span><span class="">add.right_neutral</span><span class=""> </span><span class="">add_Suc_right</span><span class=""> </span><span class="">card_Diff_singleton</span><span class=""> </span><span class="">card_infinite</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  
</span><span class="">          </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">get_port_buf_size_def</span><span class=""> </span><span class="">get_current_bufsize_port_def</span><span class="">
</span><span class="">            </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Port_Type.simps</span><span class="delimiter">(</span><span class="">7</span><span class="delimiter">)</span><span class=""> </span><span class="">Queuing.hyps</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">get_port_byid_def</span><span class=""> </span><span class="">option.sel</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Sampling</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Port_Type.simps</span><span class="delimiter">(</span><span class="">6</span><span class="delimiter">)</span><span class=""> </span><span class="">Sampling.hyps</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">case_optionE</span><span class=""> </span><span class="">is_a_queuingport_def</span><span class=""> </span><span class="">option.sel</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">  </span><span class="keyword1">}</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">rm_msg_queport_dec_size0</span><span class="delimiter">:</span><span class="string">&quot;is_a_queuingport s p &#8743; is_empty_port s p
      &#10230; get_port_buf_size s p = get_port_buf_size (fst (remove_msg_from_queuingport s p)) p&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1">{</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;is_a_queuingport s p&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;is_empty_port s p&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;get_port_buf_size s p = get_port_buf_size (fst (remove_msg_from_queuingport s p)) p&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;(ports (comm s)) p&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3">case</span><span class=""> </span><span class="">None</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">None.hyps</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">is_a_queuingport_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">    </span><span class="keyword1">next</span><span class="">
</span><span class="">      </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Some</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;x = the ((ports (comm s)) p)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Some.hyps</span><span class=""> </span><span class="">option.sel</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;the ((ports (comm s)) p)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Queuing</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class=""> </span><span class="">x5</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;(ports (comm s)) p = Some (Queuing x1 x2 x3 x4 x5)&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">Queuing.hyps</span><span class=""> </span><span class="">Some.hyps</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">        </span><span class="keyword1">let</span><span class=""> </span><span class="var">?s&#39;</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;fst (remove_msg_from_queuingport s p)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">let</span><span class=""> </span><span class="var">?msgs</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;the (get_msgs_from_queuingport (the ((ports (comm s)) p)))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">let</span><span class=""> </span><span class="var">?msgs&#39;</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;the (get_msgs_from_queuingport (the ((ports (comm ?s&#39;)) p)))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">let</span><span class=""> </span><span class="var">?m</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;SOME x. x&#8712;?msgs&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">let</span><span class=""> </span><span class="var">?m1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;SOME x. x&#8712;x5&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">from</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;(ports (comm ?s&#39;)) p = Some (Queuing x1 x2 x3 x4 (x5-{?m1}))&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">remove_msg_from_queuingport_def</span><span class=""> </span><span class="">Let_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class="string">&quot;?msgs&#39; = x5-{?m1}&quot;</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">get_msgs_from_queuingport_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class="string">&quot;x5 = ?msgs&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Queuing.hyps</span><span class=""> </span><span class="">get_msgs_from_queuingport.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">option.sel</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c4</span><span class="delimiter">:</span><span class="string">&quot;?m1 = ?m&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1">from</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c5</span><span class="delimiter">:</span><span class="string">&quot;card x5 = 0&quot;</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">is_empty_port_def</span><span class=""> </span><span class="">get_current_bufsize_port_def</span><span class="">
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Queuing.hyps</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">get_current_bufsize_port.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">get_port_byid_def</span><span class=""> </span><span class="">is_empty_port_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1">with</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c7</span><span class="delimiter">:</span><span class="string">&quot;card ?msgs&#39; = 0&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">card_eq_0_iff</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">         
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">get_port_buf_size_def</span><span class=""> </span><span class="">get_current_bufsize_port_def</span><span class="">
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Port_Type.simps</span><span class="delimiter">(</span><span class="">7</span><span class="delimiter">)</span><span class=""> </span><span class="">Queuing.hyps</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="">get_port_byid_def</span><span class=""> </span><span class="">option.sel</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Sampling</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Port_Type.simps</span><span class="delimiter">(</span><span class="">6</span><span class="delimiter">)</span><span class=""> </span><span class="">Sampling.hyps</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">case_optionE</span><span class=""> </span><span class="">is_a_queuingport_def</span><span class=""> </span><span class="">option.sel</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">  </span><span class="keyword1">}</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">clr_queport_size0</span><span class="delimiter">:</span><span class="string">&quot;is_a_queuingport s p &#8743; is_a_port_of_partition s p (current s) &#8743; is_dest_port s p
                  &#10230; get_port_buf_size (clear_queuing_port s p) p = 0&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1">{</span><span class="">
</span><span class="">    </span><span class="keyword1">let</span><span class=""> </span><span class="var">?s&#39;</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;clear_queuing_port s p&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;is_a_queuingport s p&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;is_a_port_of_partition s p (current s)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class="string">&quot;is_dest_port s p&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;get_port_buf_size ?s&#39; p = 0&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;&#172; is_a_queuingport s p 
                &#8744; &#172; is_a_port_of_partition s p (current s) 
                &#8744; &#172; is_dest_port s p&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_queuingport s p 
                &#8744; &#172; is_a_port_of_partition s p (current s)
                &#8744; &#172; is_dest_port s p&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">with</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1">next</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;&#172;(&#172; is_a_queuingport s p
                &#8744; &#172; is_a_port_of_partition s p (current s)
                &#8744; &#172; is_dest_port s p)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;(ports (comm ?s&#39;)) p = Some (clear_msg_queuingport (the ((ports (comm s)) p)))&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">clear_queuing_port_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Communication_State.select_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="">Communication_State.surjective</span><span class=""> </span><span class="">Communication_State.update_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">State.surjective</span><span class=""> </span><span class="">State.update_convs</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">fun_upd_same</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;the ((ports (comm s)) p)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Queuing</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class=""> </span><span class="">x5</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;the ((ports (comm ?s&#39;)) p) = Queuing x1 x2 x3 x4 {}&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Port_Type.simps</span><span class="delimiter">(</span><span class="">5</span><span class="delimiter">)</span><span class=""> </span><span class="">Queuing.hyps</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">clear_msg_queuingport_def</span><span class=""> </span><span class="">option.sel</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">get_current_bufsize_port_def</span><span class=""> </span><span class="">get_port_buf_size_def</span><span class="">
</span><span class="">          </span><span class="">Let_def</span><span class=""> </span><span class="">get_port_byid_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Sampling</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1">with</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Port_Type.simps</span><span class="delimiter">(</span><span class="">6</span><span class="delimiter">)</span><span class=""> </span><span class="">is_a_queuingport_def</span><span class=""> </span><span class="">option.case_eq_if</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">  </span><span class="keyword1">}</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">same_part_mode</span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;s &#8764; scheduler sysconf &#8764; t&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;s &#8764; current s &#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;part_mode (the (partitions s (current s))) = part_mode (the (partitions t (current t)))&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword1">from</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;vpeq_part s (current s) t&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1">using</span><span class="">  </span><span class="">part_imp_not_sch</span><span class=""> </span><span class="">part_imp_not_tras</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">    </span><span class="keyword1">moreover</span><span class="">
</span><span class="">    </span><span class="keyword1">from</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;current s = current t&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1">ultimately</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">subsection</span><span class="verbatim">{* Concrete unwinding condition of &quot;local respect&quot; *}</span><span class="">    
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;create sampling port&quot; satisfying the &quot;local respect&quot; property*}</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">crt_smpl_port_notchg_current</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="string">&quot;&#10214;is_a_partition sysconf (current s); s&#39; = fst (create_sampling_port sysconf s pname)&#10215; 
      &#10233; current s = current s&#39;&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">create_sampling_port_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">        
</span><span class="">  </span><span class="keyword1">text</span><span class="verbatim">{*the state before and after executing the action &quot;create sampling port&quot; is observ equal to scheduler*}</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">crt_smpl_port_sm_sche</span><span class="delimiter">:</span><span class="string">&quot;&#10214;is_a_partition sysconf (current s); 
                                s&#39; = fst (create_sampling_port sysconf s pname)&#10215;
                                      &#10233; (s&#8764;(scheduler sysconf)&#8764;s&#39;)&quot;</span><span class="">
</span><span class="">   </span><span class="keyword1">using</span><span class=""> </span><span class="">crt_smpl_port_notchg_current</span><span class=""> 
</span><span class="">         </span><span class="">vpeq1_def</span><span class=""> </span><span class="">vpeq_sched_def</span><span class="">  </span><span class="">is_a_scheduler_def</span><span class=""> </span><span class="">part_imp_not_sch</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">crt_sampl_port_notchg_partstate</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#10214;is_a_partition sysconf (current s); is_a_partition sysconf d; 
   s&#39; = fst (create_sampling_port sysconf s pname)&#10215;
                           &#10233; (partitions s) d = (partitions s&#39;) d&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">create_sampling_port_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">crt_sampl_port_notchg_partportsinotherdom</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8800; d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (create_sampling_port sysconf s pname)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;get_ports_of_partition s d = get_ports_of_partition s&#39; d&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1">{</span><span class="">
</span><span class="">    </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8704;p. p&#8712;get_ports_of_partition s d &#10230; p&#8712;get_ports_of_partition s&#39; d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword1">{</span><span class="">
</span><span class="">      </span><span class="keyword3">fix</span><span class=""> </span><span class="">p</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;p&#8712;get_ports_of_partition s d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;p&#8712;get_ports_of_partition s&#39; d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;pname &#8712; get_partition_cfg_ports_byid sysconf (current s)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;pname &#8712; get_partition_cfg_ports_byid sysconf (current s)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;p &#8800; get_portid_in_type (the (get_samplingport_conf sysconf pname))&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;&#172;(pname &#8712; get_partition_cfg_ports_byid sysconf (current s))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = s&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">create_sampling_port_def</span><span class=""> </span><span class="">p4</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">a0</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">}</span><span class="">
</span><span class="">    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">moreover</span><span class="">
</span><span class="">    </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8704;p. p&#8712;get_ports_of_partition s&#39; d &#10230; p&#8712;get_ports_of_partition s d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword1">{</span><span class="">
</span><span class="">      </span><span class="keyword3">fix</span><span class=""> </span><span class="">p</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;p&#8712;get_ports_of_partition s&#39; d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;p&#8712;get_ports_of_partition s d&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;pname &#8712; get_partition_cfg_ports_byid sysconf (current s)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;pname &#8712; get_partition_cfg_ports_byid sysconf (current s)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;p &#8800; get_portid_in_type (the (get_samplingport_conf sysconf pname))&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;&#172;(pname &#8712; get_partition_cfg_ports_byid sysconf (current s))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = s&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">create_sampling_port_def</span><span class=""> </span><span class="">p4</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">  
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">}</span><span class="">
</span><span class="">    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">calculation</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1">}</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">crt_sampl_port_notchg_portsinotherdom</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8800; d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (create_sampling_port sysconf s pname)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot; &#8704;p. p&#8712; get_ports_of_partition s d &#10230; ports (comm s) p = ports (comm s&#39;) p&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1">{</span><span class="">
</span><span class="">    </span><span class="keyword3">fix</span><span class=""> </span><span class="">p</span><span class="">
</span><span class="">    </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;p &#8712; get_ports_of_partition s d &#10230; ports (comm s) p = ports (comm s&#39;) p &quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword1">{</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;p &#8712; get_ports_of_partition s d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;ports (comm s) p = ports (comm (fst (create_sampling_port sysconf s pname))) p&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;pname &#8712; get_partition_cfg_ports_byid sysconf (current s)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;pname &#8712; get_partition_cfg_ports_byid sysconf (current s)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;p &#8800; get_portid_in_type (the (get_samplingport_conf sysconf pname))&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;&#172;(pname &#8712; get_partition_cfg_ports_byid sysconf (current s))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = s&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">create_sampling_port_def</span><span class=""> </span><span class="">p4</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">  
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">}</span><span class="">
</span><span class="">    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">p4</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">  </span><span class="keyword1">}</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">    
</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">crt_sampl_port_notchg_comminotherdom</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class="">   </span><span class="">p0</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8800; d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (create_sampling_port sysconf s pname)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;vpeq_part_comm s d s&#39;&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;get_ports_of_partition s d = get_ports_of_partition s&#39; d&quot;</span><span class="">
</span><span class="">       </span><span class="keyword1">using</span><span class=""> </span><span class="">crt_sampl_port_notchg_partportsinotherdom</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">            
</span><span class="">    </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8704;p. p &#8712; get_ports_of_partition s d &#10230;
              is_a_queuingport s p = is_a_queuingport s&#39; p &#8743;
              is_dest_port s p = is_dest_port s&#39; p &#8743; 
              (if is_dest_port s p then get_port_buf_size s p = get_port_buf_size s&#39; p else True)&quot;</span><span class="">         
</span><span class="">    </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">is_a_queuingport_def</span><span class=""> </span><span class="">is_dest_port_def</span><span class=""> 
</span><span class="">    </span><span class="keyword1">using</span><span class="">  </span><span class="">crt_sampl_port_notchg_portsinotherdom</span><span class=""> 
</span><span class="">          </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">get_port_byid_def</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">get_port_buf_size_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        
</span><span class="">     </span><span class="keyword1">ultimately</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">  
</span><span class="keyword1">declare</span><span class=""> </span><span class="">is_a_partition_def</span><span class=""> </span><span class="delimiter">[</span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class=""> 
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">crt_smpl_port_sm_nitfpart</span><span class="delimiter">:</span><span class="string">&quot;&#10214;reachable0 s; is_a_partition sysconf (current s); is_a_partition sysconf d;
                                  ((current s) &#8726;&#8605; d); s&#39; = fst (create_sampling_port sysconf s pname)&#10215;
                                        &#10233; (s &#8764; d &#8764; s&#39;)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class="delimiter">)</span><span class="">        
</span><span class="">  </span><span class="keyword1">using</span><span class="">  </span><span class="">trans_imp_not_part</span><span class=""> </span><span class="">sche_imp_not_part</span><span class="">                 
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">crt_sampl_port_notchg_partstate</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">create_sampling_port_def</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">get_samplingport_conf_def</span><span class=""> </span><span class="">port_name_diff</span><span class="delimiter">)</span><span class="">
</span><span class="">    
</span><span class="keyword1">declare</span><span class=""> </span><span class="">is_a_partition_def</span><span class=""> </span><span class="delimiter">[</span><span class="">cong</span><span class="delimiter">]</span><span class=""> 
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">crt_smpl_port_presrv_lcrsp</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8726;&#8605; d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (create_sampling_port sysconf s pname)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s &#8764; d &#8764; s&#39;&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_scheduler sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;is_a_scheduler sysconf d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">crt_smpl_port_sm_sche</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class="delimiter">]</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">next</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_scheduler sysconf d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">crt_smpl_port_sm_nitfpart</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1">next</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_transmitter sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;is_a_transmitter sysconf d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">        </span><span class="keyword1">{</span><span class="">
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;vpeq_transmitter s d s&#39;&quot;</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">vpeq_transmitter_def</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class="">-</span><span class="">
</span><span class="">            </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;comm s = comm s&#39; &#8743;  part_ports s = part_ports s&#39;&quot;</span><span class=""> 
</span><span class="">            </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1">{</span><span class="">
</span><span class="">              </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;comm s = comm s&#39;&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">              </span><span class="keyword1">{</span><span class="">
</span><span class="">                </span><span class="keyword1">from</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#172; part_intf_transmitter sysconf (current s)&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">using</span><span class=""> </span><span class="">interference1_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">non_interference1_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;get_partition_cfg_ports (the ((partconf sysconf) (current s))) = {}&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">using</span><span class=""> </span><span class="">get_partition_cfg_ports_byid_def</span><span class="">  </span><span class="">p1</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">                </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;pname &#8713; get_partition_cfg_ports_byid sysconf (current s)&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">get_partition_cfg_ports_byid_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;s = s&#39;&quot;</span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">create_sampling_port_def</span><span class=""> </span><span class="">p3</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1">}</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1">qed</span><span class="">
</span><span class="">              </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;part_ports s = part_ports s&#39;&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class=""> 
</span><span class="">              </span><span class="keyword1">{</span><span class="">
</span><span class="">                </span><span class="keyword1">from</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class="string">&quot;&#172; part_intf_transmitter sysconf (current s)&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">using</span><span class=""> </span><span class="">interference1_def</span><span class=""> </span><span class="">non_interference1_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">a1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class="string">&quot;get_partition_cfg_ports_byid sysconf (current s) = {}&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">                </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class="string">&quot;s=s&#39;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">create_sampling_port_def</span><span class=""> </span><span class="">empty_iff</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">p3</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1">}</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1">qed</span><span class="">
</span><span class="">            </span><span class="keyword1">}</span><span class="">
</span><span class="">            </span><span class="keyword1">qed</span><span class="">
</span><span class="">          </span><span class="keyword1">qed</span><span class="">
</span><span class="">        </span><span class="keyword1">}</span><span class="">
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">is_a_scheduler_def</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_transmitter sysconf d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">is_a_scheduler_def</span><span class=""> </span><span class="">is_a_transmitter_def</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">crt_smpl_port_presrv_lcrsp_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;local_respect_e (hyperc (Create_Sampling_Port pn))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">crt_smpl_port_presrv_lcrsp</span><span class="">  </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">exec_event_def</span><span class=""> 
</span><span class="">      </span><span class="">mem_Collect_eq</span><span class="">  </span><span class="">singletonD</span><span class=""> </span><span class="">vpeq_reflexive_lemma</span><span class=""> 
</span><span class="">   </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">vpeq1_def</span><span class="delimiter">)</span><span class="">
</span><span class="">   
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;write sampling message&quot; satisfying the &quot;local respect&quot; property*}</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">wrt_smpl_msg_notchg_current</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#10214;is_a_partition sysconf (current s); s&#39; = fst (write_sampling_message s pid m)&#10215; 
    &#10233; current s = current s&#39;&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">write_sampling_message_def</span><span class=""> </span><span class="">update_sampling_port_msg_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;ports (comm s) pid&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;a&quot;</span><span class="delimiter">)</span><span class="">    
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">text</span><span class="verbatim">{*the state before and after executing the action &quot;write sampling message&quot; is observ equal to scheduler*}</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">wrt_smpl_msg_sm_sche</span><span class="delimiter">:</span><span class="string">&quot;&#10214;is_a_partition sysconf (current s); 
                                s&#39; = fst (write_sampling_message s pid m)&#10215;
                                      &#10233; (s&#8764;(scheduler sysconf)&#8764;s&#39;)&quot;</span><span class="">
</span><span class="">   </span><span class="keyword1">using</span><span class=""> </span><span class="">wrt_smpl_msg_notchg_current</span><span class=""> </span><span class="">part_imp_not_sch</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="">vpeq_sched_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">wrt_smpl_msg_notchg_partstate</span><span class="delimiter">:</span><span class="">
</span><span class="">                </span><span class="string">&quot;&#10214;is_a_partition sysconf (current s); is_a_partition sysconf d; 
                s&#39; = fst (write_sampling_message s pid m)&#10215;
                      &#10233; (partitions s) d = (partitions s&#39;) d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">write_sampling_message_def</span><span class=""> </span><span class="">update_sampling_port_msg_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;ports (comm s) pid&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;a&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">        
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">wrt_smpl_msg_notchg_partports</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="string">&quot;&#10214;is_a_partition sysconf (current s); s&#39; = fst (write_sampling_message s pid m)&#10215;&#10233;
          part_ports s = part_ports s&#39;&quot;</span><span class="">
</span><span class="">     </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">write_sampling_message_def</span><span class=""> </span><span class="">update_sampling_port_msg_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;ports (comm s) pid&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;a&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1">by</span><span class="">  </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">wrt_smpl_msg_notchg_portinotherdom</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8800; d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (write_sampling_message s pid m)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot; &#8704;p. p&#8712; get_ports_of_partition s d &#10230; ports (comm s) p = ports (comm s&#39;) p&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1">{</span><span class="">
</span><span class="">    
</span><span class="">    </span><span class="keyword3">fix</span><span class=""> </span><span class="">p</span><span class="">
</span><span class="">    </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;p &#8712; get_ports_of_partition s d &#10230; ports (comm s) p = ports (comm s&#39;) p &quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword1">{</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;p &#8712; get_ports_of_partition s d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;(part_ports s) p = Some d&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">get_ports_of_partition_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;ports (comm s) p = ports (comm s&#39;) p&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;p = pid&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;p = pid&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;(part_ports s) pid = Some d&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_port_of_partition s pid (current s)&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">is_a_port_of_partition_def</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = s&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">write_sampling_message_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;p &#8800; pid&quot;</span><span class="">
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> 
</span><span class="">          </span><span class="keyword1">using</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">write_sampling_message_def</span><span class=""> </span><span class="">update_sampling_port_msg_def</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;ports (comm s) pid&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;a&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1">using</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">}</span><span class="">
</span><span class="">    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">p4</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">  </span><span class="keyword1">}</span><span class=""> </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class=""> 
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">wrt_smpl_msg_notchg_comminotherdom</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class="">   </span><span class="">p0</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8800; d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (write_sampling_message s pid m)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;vpeq_part_comm s d s&#39;&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword1">from</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">r0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;part_ports s = part_ports s&#39;&quot;</span><span class="">
</span><span class="">     </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">write_sampling_message_def</span><span class=""> </span><span class="">update_sampling_port_msg_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;ports (comm s) pid&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;a&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;get_ports_of_partition s d = get_ports_of_partition s&#39; d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">using</span><span class=""> </span><span class="">part_ports_imp_portofpart</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1">moreover</span><span class=""> </span><span class="keyword1">have</span><span class="">  </span><span class="string">&quot;&#8704;p. p &#8712; get_ports_of_partition s d &#10230;
              is_a_queuingport s p = is_a_queuingport s&#39; p &#8743;
              is_dest_port s p = is_dest_port s&#39; p &#8743; 
              (if is_dest_port s p then get_port_buf_size s p = get_port_buf_size s&#39; p else True)&quot;</span><span class="">
</span><span class="">     </span><span class="keyword1">using</span><span class=""> </span><span class="">is_a_queuingport_def</span><span class=""> </span><span class="">get_port_buf_size_def</span><span class=""> 
</span><span class="">             </span><span class="">is_dest_port_def</span><span class=""> </span><span class="">get_port_byid_def</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">wrt_smpl_msg_notchg_portinotherdom</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">     </span><span class="keyword1">ultimately</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">wrt_smpl_msg_sm_nitfpart</span><span class="delimiter">:</span><span class="string">&quot;&#10214;reachable0 s; is_a_partition sysconf (current s); is_a_partition sysconf d;
                                  ((current s) &#8726;&#8605; d); s&#39; = fst (write_sampling_message s pid m)&#10215;
                                        &#10233; (s &#8764; d &#8764; s&#39;)&quot;</span><span class="">            
</span><span class="">  </span><span class="keyword1">using</span><span class="">  </span><span class="">trans_imp_not_part</span><span class=""> </span><span class="">sche_imp_not_part</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">is_a_partition_def</span><span class=""> </span><span class="">interference1_def</span><span class=""> </span><span class="">non_interference1_def</span><span class=""> </span><span class="">vpeq_part_comm_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">nintf_neq</span><span class="">  </span><span class="">wrt_smpl_msg_notchg_comminotherdom</span><span class=""> </span><span class="">wrt_smpl_msg_notchg_partstate</span><span class="delimiter">)</span><span class="">
</span><span class="">        
</span><span class="">        
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">write_smpl_msg_presrv_lcrsp</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8726;&#8605; d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (write_sampling_message s pid m)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s &#8764; d &#8764; s&#39;&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_scheduler sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;is_a_scheduler sysconf d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">is_a_scheduler_def</span><span class=""> </span><span class="">wrt_smpl_msg_sm_sche</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">next</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_scheduler sysconf d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">wrt_smpl_msg_sm_nitfpart</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1">next</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_transmitter sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;is_a_transmitter sysconf d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;comm s = comm s&#39; &#8743;  part_ports s = part_ports s&#39;&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1">{</span><span class="">
</span><span class="">          </span><span class="keyword1">from</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#172; part_intf_transmitter sysconf (current s)&quot;</span><span class=""> 
</span><span class="">            </span><span class="keyword1">using</span><span class=""> </span><span class="">interference1_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">non_interference1_def</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class="string">&quot;get_partition_cfg_ports (the ((partconf sysconf) (current s))) = {}&quot;</span><span class=""> 
</span><span class="">            </span><span class="keyword1">using</span><span class=""> </span><span class="">get_partition_cfg_ports_byid_def</span><span class="">  </span><span class="">p1</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">          </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class="string">&quot;get_partition_cfg_ports_byid sysconf (current s) = {}&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">get_partition_cfg_ports_byid_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#172; is_a_port_of_partition s pid (current s)&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;(ports (comm s)) pid = None&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3">assume</span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class="string">&quot;(ports (comm s)) pid = None&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">from</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class="string">&quot;port_consistent s&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">port_cons_reach_state</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1">with</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class="string">&quot;(part_ports s) pid = None&quot;</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">port_consistent_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">is_a_port_of_partition_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">assume</span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class="string">&quot;&#172;((ports (comm s)) pid = None)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">from</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class="string">&quot;port_consistent s&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">port_cons_reach_state</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;get_portname_by_type (the ((ports (comm s)) pid)) &#8712;
                get_partition_cfg_ports_byid sysconf (the ((part_ports s) pid)) &quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">using</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">port_consistent_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">            </span><span class="keyword1">with</span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;current s &#8800; the ((part_ports s) pid)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">is_a_port_of_partition_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">qed</span><span class="">
</span><span class="">          </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class="string">&quot;s = s&#39;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">write_sampling_message_def</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">p3</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;comm s = comm s&#39;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">          </span><span class="keyword1">with</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;part_ports s = part_ports s&#39;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1">}</span><span class="">
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b1</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">        
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_transmitter sysconf d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c1</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">write_smpl_msg_presrv_lcrsp_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;local_respect_e (hyperc (Write_Sampling_Message pid m))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">write_smpl_msg_presrv_lcrsp</span><span class="">  </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="">  </span><span class="">exec_event_def</span><span class=""> 
</span><span class="">      </span><span class="">mem_Collect_eq</span><span class=""> </span><span class="">singletonD</span><span class=""> </span><span class="">vpeq_reflexive_lemma</span><span class=""> 
</span><span class="">     </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">vpeq1_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;read sampling message&quot; satisfying the &quot;local respect&quot; property*}</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">read_smpl_msg_presrv_lcrsp</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8726;&#8605; d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (read_sampling_message s pid)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s &#8764; d &#8764; s&#39;&quot;</span><span class="">
</span><span class="">   </span><span class="keyword1">using</span><span class=""> </span><span class="">vpeq_reflexive_lemma</span><span class="">  </span><span class="">p3</span><span class=""> </span><span class="">read_sampling_message_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">  
</span><span class="">    
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">read_smpl_msg_presrv_lcrsp_e</span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;local_respect_e (hyperc (Read_Sampling_Message pid))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">read_smpl_msg_presrv_lcrsp</span><span class="">  </span><span class="">exec_event_def</span><span class=""> 
</span><span class="">       </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">vpeq_reflexive_lemma</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class="">  </span><span class="">vpeq1_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;get sampling portid&quot; satisfying the &quot;local respect&quot; property*}</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_smpl_pid_presrv_lcrsp</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8726;&#8605; d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (get_sampling_port_id sysconf s pname)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s &#8764; d &#8764; s&#39;&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">get_sampling_port_id_def</span><span class="">  </span><span class="">vpeq_reflexive_lemma</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_smpl_pid_presrv_lcrsp_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;local_respect_e (hyperc (Get_Sampling_Portid pid))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">get_smpl_pid_presrv_lcrsp</span><span class="">  </span><span class="">exec_event_def</span><span class="">  
</span><span class="">       </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="">  </span><span class="">vpeq_reflexive_lemma</span><span class="">
</span><span class="">     </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">vpeq1_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;get sampling port status&quot; satisfying the &quot;local respect&quot; property*}</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_smpl_psts_presrv_lcrsp</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8726;&#8605; d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (get_sampling_port_status sysconf s pid)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s &#8764; d &#8764; s&#39;&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">get_sampling_port_status_def</span><span class=""> </span><span class="">vpeq_reflexive_lemma</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_smpl_psts_presrv_lcrsp_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;local_respect_e (hyperc (Get_Sampling_Portstatus pid))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">get_smpl_psts_presrv_lcrsp</span><span class="">  </span><span class="">exec_event_def</span><span class="">  
</span><span class="">        </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="">  </span><span class="">vpeq_reflexive_lemma</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">vpeq1_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;create queuing port&quot; satisfying the &quot;local respect&quot; property*}</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">crt_que_port_notchg_current</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="string">&quot;&#10214;is_a_partition sysconf (current s); s&#39; = fst (create_queuing_port sysconf s pname)&#10215; 
      &#10233; current s = current s&#39;&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">create_queuing_port_def</span><span class=""> </span><span class="delimiter">)</span><span class="">    
</span><span class="">
</span><span class="">  </span><span class="keyword1">text</span><span class="verbatim">{*the state before and after executing the action &quot;create queuing port&quot; is observ equal to scheduler*}</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">crt_que_port_sm_sche</span><span class="delimiter">:</span><span class="string">&quot;&#10214;is_a_partition sysconf (current s); 
                                s&#39; = fst (create_queuing_port sysconf s pname)&#10215;
                                      &#10233; (s&#8764;(scheduler sysconf)&#8764;s&#39;)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">crt_que_port_notchg_current</span><span class=""> </span><span class="">part_imp_not_sch</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">   
</span><span class="">      
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">crt_que_port_notchg_partstate</span><span class="delimiter">:</span><span class="">
</span><span class="">                </span><span class="string">&quot;&#10214;is_a_partition sysconf (current s); is_a_partition sysconf d; 
                s&#39; = fst (create_queuing_port sysconf s pname)&#10215;
                                         &#10233; (partitions s) d = (partitions s&#39;) d&quot;</span><span class="">
</span><span class="">   </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">create_queuing_port_def</span><span class=""> </span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">crt_que_port_notchg_partportsinotherdom</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8800; d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (create_queuing_port sysconf s pname)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;get_ports_of_partition s d = get_ports_of_partition s&#39; d&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1">{</span><span class="">
</span><span class="">    </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8704;p. p&#8712;get_ports_of_partition s d &#10230; p&#8712;get_ports_of_partition s&#39; d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword1">{</span><span class="">
</span><span class="">      </span><span class="keyword3">fix</span><span class=""> </span><span class="">p</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;p&#8712;get_ports_of_partition s d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;p&#8712;get_ports_of_partition s&#39; d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;pname &#8712; get_partition_cfg_ports_byid sysconf (current s)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;pname &#8712; get_partition_cfg_ports_byid sysconf (current s)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;p &#8800; get_portid_in_type (the (get_queuingport_conf sysconf pname))&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;&#172;(pname &#8712; get_partition_cfg_ports_byid sysconf (current s))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = s&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">create_queuing_port_def</span><span class=""> </span><span class="">p4</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">a0</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">}</span><span class="">
</span><span class="">    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">moreover</span><span class="">
</span><span class="">    </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8704;p. p&#8712;get_ports_of_partition s&#39; d &#10230; p&#8712;get_ports_of_partition s d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword1">{</span><span class="">
</span><span class="">      </span><span class="keyword3">fix</span><span class=""> </span><span class="">p</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;p&#8712;get_ports_of_partition s&#39; d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;p&#8712;get_ports_of_partition s d&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;pname &#8712; get_partition_cfg_ports_byid sysconf (current s)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;pname &#8712; get_partition_cfg_ports_byid sysconf (current s)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;p &#8800; get_portid_in_type (the (get_queuingport_conf sysconf pname))&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;&#172;(pname &#8712; get_partition_cfg_ports_byid sysconf (current s))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = s&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">create_queuing_port_def</span><span class=""> </span><span class="">p4</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">  
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">}</span><span class="">
</span><span class="">    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">calculation</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1">}</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">       
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">crt_que_port_notchg_portsinotherdom</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8800; d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (create_queuing_port sysconf s pname)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot; &#8704;p. p&#8712; get_ports_of_partition s d &#10230; ports (comm s) p = ports (comm s&#39;) p&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1">{</span><span class="">    
</span><span class="">    </span><span class="keyword3">fix</span><span class=""> </span><span class="">p</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;p &#8712; get_ports_of_partition s d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;ports (comm s) p = ports (comm s&#39;) p &quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword1">{</span><span class="">      
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;ports (comm s) p = ports (comm (fst (create_queuing_port sysconf s pname))) p&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;pname &#8712; get_partition_cfg_ports_byid sysconf (current s)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;pname &#8712; get_partition_cfg_ports_byid sysconf (current s)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;p &#8800; get_portid_in_type (the (get_queuingport_conf sysconf pname))&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;&#172;(pname &#8712; get_partition_cfg_ports_byid sysconf (current s))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = s&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">create_queuing_port_def</span><span class=""> </span><span class="">p4</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">  
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">}</span><span class="">
</span><span class="">    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">p4</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">  </span><span class="keyword1">}</span><span class=""> </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class=""> 
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">crt_que_port_notchg_comminotherdom</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class="">   </span><span class="">p0</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8800; d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (create_queuing_port sysconf s pname)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;vpeq_part_comm s d s&#39;&quot;</span><span class="">       
</span><span class="">  </span><span class="keyword1">proof</span><span class="">-</span><span class="">
</span><span class="">   </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;get_ports_of_partition s d = get_ports_of_partition s&#39; d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">using</span><span class=""> </span><span class="">crt_que_port_notchg_partportsinotherdom</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">        
</span><span class="">   </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8704;p. p &#8712; get_ports_of_partition s d &#10230;
            is_a_queuingport s p = is_a_queuingport s&#39; p &#8743;
            is_dest_port s p = is_dest_port s&#39; p &#8743; 
            (if is_dest_port s p then get_port_buf_size s p = get_port_buf_size s&#39; p else True)&quot;</span><span class="">
</span><span class="">   </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">   </span><span class="keyword1">{</span><span class="">
</span><span class="">     </span><span class="keyword3">fix</span><span class=""> </span><span class="">p</span><span class="">
</span><span class="">     </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;p &#8712; get_ports_of_partition s d &#10230;
          is_a_queuingport s p = is_a_queuingport s&#39; p &#8743;
          is_dest_port s p = is_dest_port s&#39; p &#8743; 
          (if is_dest_port s p then get_port_buf_size s p = get_port_buf_size s&#39; p else True)&quot;</span><span class="">
</span><span class="">     </span><span class="keyword1">using</span><span class="">  </span><span class="">get_port_buf_size_def</span><span class=""> </span><span class="">is_a_queuingport_def</span><span class=""> 
</span><span class="">             </span><span class="">is_dest_port_def</span><span class=""> 
</span><span class="">             </span><span class="">crt_que_port_notchg_portsinotherdom</span><span class=""> </span><span class="">get_port_byid_def</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">   </span><span class="keyword1">}</span><span class="">
</span><span class="">   </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">   </span><span class="keyword1">qed</span><span class="">
</span><span class="">   </span><span class="keyword1">ultimately</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class=""> </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">crt_que_port_sm_nitfpart</span><span class="delimiter">:</span><span class="string">&quot;&#10214;reachable0 s; is_a_partition sysconf (current s); is_a_partition sysconf d;
                                  ((current s) &#8726;&#8605; d); s&#39; = fst (create_queuing_port sysconf s pname)&#10215;
                                        &#10233; (s &#8764; d &#8764; s&#39;)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">vpeq1_def</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">is_a_partition_def</span><span class=""> </span><span class="">vpeq_part_comm_def</span><span class="delimiter">)</span><span class="">      
</span><span class="">      </span><span class="keyword1">using</span><span class=""> </span><span class="">trans_imp_not_part</span><span class=""> </span><span class="">sche_imp_not_part</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">crt_que_port_notchg_partstate</span><span class="delimiter">)</span><span class="">        
</span><span class="">      </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">create_queuing_port_def</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">get_queuingport_conf_def</span><span class=""> </span><span class="">port_name_diff</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">        
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">crt_que_port_presrv_lcrsp</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8726;&#8605; d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (create_queuing_port sysconf s pname)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s &#8764; d &#8764; s&#39;&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_scheduler sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;is_a_scheduler sysconf d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">crt_que_port_sm_sche</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class="delimiter">]</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">    </span><span class="keyword1">next</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_scheduler sysconf d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">crt_que_port_sm_nitfpart</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_transmitter sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;is_a_transmitter sysconf d&quot;</span><span class="">          
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;vpeq_transmitter s d s&#39;&quot;</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">vpeq_transmitter_def</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class="">-</span><span class="">
</span><span class="">            </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;comm s = comm s&#39; &#8743;  part_ports s = part_ports s&#39;&quot;</span><span class=""> 
</span><span class="">            </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1">{</span><span class="">
</span><span class="">              </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;comm s = comm s&#39;&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">              </span><span class="keyword1">{</span><span class="">
</span><span class="">              </span><span class="keyword1">from</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#172; part_intf_transmitter sysconf (current s)&quot;</span><span class=""> 
</span><span class="">                </span><span class="keyword1">using</span><span class=""> </span><span class="">interference1_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">non_interference1_def</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;get_partition_cfg_ports (the ((partconf sysconf) (current s))) = {}&quot;</span><span class=""> 
</span><span class="">                </span><span class="keyword1">using</span><span class=""> </span><span class="">get_partition_cfg_ports_byid_def</span><span class=""> </span><span class="">is_a_partition_def</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;pname &#8713; get_partition_cfg_ports_byid sysconf (current s)&quot;</span><span class=""> 
</span><span class="">                </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">get_partition_cfg_ports_byid_def</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;s = s&#39;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">create_queuing_port_def</span><span class=""> </span><span class="">p3</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1">}</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1">qed</span><span class="">
</span><span class="">              </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;part_ports s = part_ports s&#39;&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class=""> 
</span><span class="">              </span><span class="keyword1">{</span><span class="">
</span><span class="">                </span><span class="keyword1">from</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class="string">&quot;&#172; part_intf_transmitter sysconf (current s)&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">using</span><span class=""> </span><span class="">interference1_def</span><span class=""> </span><span class="">non_interference1_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">a1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class="string">&quot;get_partition_cfg_ports_byid sysconf (current s) = {}&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">                </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class="string">&quot;s=s&#39;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">create_queuing_port_def</span><span class=""> </span><span class="">empty_iff</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">p3</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1">}</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1">qed</span><span class="">
</span><span class="">            </span><span class="keyword1">}</span><span class="">
</span><span class="">            </span><span class="keyword1">qed</span><span class="">
</span><span class="">          </span><span class="keyword1">qed</span><span class="">
</span><span class="">        
</span><span class="">          </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">is_a_scheduler_def</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">          
</span><span class="">        </span><span class="keyword1">next</span><span class="">
</span><span class="">          </span><span class="keyword3">assume</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_transmitter sysconf d&quot;</span><span class="">
</span><span class="">          </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">is_a_scheduler_def</span><span class=""> </span><span class="">is_a_transmitter_def</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">crt_que_port_presrv_lcrsp_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;local_respect_e (hyperc (Create_Queuing_Port p))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">crt_que_port_presrv_lcrsp</span><span class="">  </span><span class="">exec_event_def</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> 
</span><span class="">       </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">singletonD</span><span class=""> </span><span class="">vpeq_reflexive_lemma</span><span class=""> 
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">is_a_partition_def</span><span class="">   </span><span class="">vpeq1_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;send queuing message(may lost)&quot; satisfying the &quot;local respect&quot; property*}</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">snd_que_msg_lst_notchg_current</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="string">&quot;&#10214;is_a_partition sysconf (current s); s&#39; = fst (send_queuing_message_maylost sysconf s pid m)&#10215; 
        &#10233; current s = current s&#39;&quot;</span><span class="">        
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">insert_msg2queuing_port_def</span><span class=""> 
</span><span class="">                  </span><span class="">send_queuing_message_maylost_def</span><span class=""> </span><span class="">replace_msg2queuing_port_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;ports (comm s) pid&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;a&quot;</span><span class="delimiter">)</span><span class="">        
</span><span class="">        </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        
</span><span class="">             
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">snd_que_msg_lst_sm_sche</span><span class="delimiter">:</span><span class="string">&quot;&#10214;is_a_partition sysconf (current s); 
                                  s&#39; = fst (send_queuing_message_maylost sysconf s pid m)&#10215;
                                        &#10233; (s&#8764;(scheduler sysconf)&#8764;s&#39;)&quot;</span><span class="">        
</span><span class="">      </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">insert_msg2queuing_port_def</span><span class=""> </span><span class="">vpeq_reflexive_lemma</span><span class=""> 
</span><span class="">                  </span><span class="">replace_msg2queuing_port_def</span><span class=""> </span><span class="">send_queuing_message_maylost_def</span><span class="delimiter">)</span><span class="">                                   
</span><span class="">      </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;ports (comm s) pid&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">vpeq_reflexive_lemma</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;a&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">vpeq_reflexive_lemma</span><span class="delimiter">)</span><span class="">
</span><span class="">        
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">snd_que_msg_lst_notchg_partstate</span><span class="delimiter">:</span><span class="">
</span><span class="">                  </span><span class="string">&quot;&#10214;is_a_partition sysconf (current s); is_a_partition sysconf d; 
                  s&#39; = fst (send_queuing_message_maylost sysconf s pid m)&#10215;
                                           &#10233; (partitions s) d = (partitions s&#39;) d&quot;</span><span class="">
</span><span class="">        
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">insert_msg2queuing_port_def</span><span class=""> 
</span><span class="">           </span><span class="">replace_msg2queuing_port_def</span><span class=""> </span><span class="">send_queuing_message_maylost_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;ports (comm s) pid&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;a&quot;</span><span class="delimiter">)</span><span class="">        
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">snd_que_msg_lst_notchg_partports</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (send_queuing_message_maylost sysconf s pid m)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;part_ports s = part_ports s&#39;&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;&#172; is_a_queuingport s pid 
                        &#8744; &#172; is_source_port s pid 
                        &#8744; &#172; is_a_port_of_partition s pid (current s)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_queuingport s pid 
                &#8744; &#172; is_source_port s pid 
                &#8744; &#172; is_a_port_of_partition s pid (current s)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">with</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">send_queuing_message_maylost_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">  </span><span class="keyword1">next</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;&#172;(&#172; is_a_queuingport s pid 
                &#8744; &#172; is_source_port s pid
                &#8744; &#172; is_a_port_of_partition s pid (current s))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_full_portqueuing sysconf s pid&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;is_full_portqueuing sysconf s pid&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">with</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = s&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">replace_msg2queuing_port_def</span><span class=""> 
</span><span class="">                                  </span><span class="">send_queuing_message_maylost_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">    </span><span class="keyword1">next</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_full_portqueuing sysconf s pid&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = insert_msg2queuing_port s pid m&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1">using</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">send_queuing_message_maylost_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">      </span><span class="keyword1">with</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;(ports (comm s)) pid&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3">case</span><span class=""> </span><span class="">None</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">None.hyps</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">insert_msg2queuing_port_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">  
</span><span class="">        </span><span class="keyword1">next</span><span class="">
</span><span class="">          </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Some</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class="string">&quot;(ports (comm s)) pid = Some x&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Some.hyps</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;the ((ports (comm s)) pid)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Queuing</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class=""> </span><span class="">x5</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Communication_State.select_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Communication_State.surjective</span><span class=""> 
</span><span class="">              </span><span class="">Communication_State.update_convs</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">Port_Type.simps</span><span class="delimiter">(</span><span class="">5</span><span class="delimiter">)</span><span class=""> </span><span class="">Queuing.hyps</span><span class=""> 
</span><span class="">              </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">4</span><span class="delimiter">)</span><span class=""> </span><span class="">State.surjective</span><span class=""> </span><span class="">State.update_convs</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="">d1</span><span class=""> </span><span class="">insert_msg2queuing_port_def</span><span class=""> </span><span class="">option.case_eq_if</span><span class="delimiter">)</span><span class="">  
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Sampling</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">Sampling.hyps</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">insert_msg2queuing_port_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">          </span><span class="keyword1">qed</span><span class="">
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">     </span><span class="keyword1">qed</span><span class="">
</span><span class="">   </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">snd_que_msg_lst_notchg_portsinotherdom</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8800; d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (send_queuing_message_maylost sysconf s pid m)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot; &#8704;p. p&#8712; get_ports_of_partition s d &#10230; ports (comm s) p = ports (comm s&#39;) p&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1">{</span><span class="">
</span><span class="">    </span><span class="keyword3">fix</span><span class=""> </span><span class="">p</span><span class="">
</span><span class="">    </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;p &#8712; get_ports_of_partition s d &#10230; ports (comm s) p = ports (comm s&#39;) p &quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword1">{</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;p &#8712; get_ports_of_partition s d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;(part_ports s) p = Some d&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">get_ports_of_partition_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;ports (comm s) p = ports (comm s&#39;) p&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;p = pid&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;p = pid&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;(part_ports s) pid = Some d&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_port_of_partition s pid (current s)&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">is_a_port_of_partition_def</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = s&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">send_queuing_message_maylost_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;p &#8800; pid&quot;</span><span class="">
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;&#172; is_a_queuingport s pid 
                    &#8744; &#172; is_source_port s pid 
                    &#8744; &#172; is_a_port_of_partition s pid (current s)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_queuingport s pid
                      &#8744; &#172; is_source_port s pid
                      &#8744; &#172; is_a_port_of_partition s pid (current s)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">send_queuing_message_maylost_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">        </span><span class="keyword1">next</span><span class="">
</span><span class="">          </span><span class="keyword3">assume</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;&#172;(&#172; is_a_queuingport s pid
                      &#8744; &#172; is_source_port s pid
                      &#8744; &#172; is_a_port_of_partition s pid (current s))&quot;</span><span class="">
</span><span class="">          </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_full_portqueuing sysconf s pid&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;is_full_portqueuing sysconf s pid&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">with</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = s&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">replace_msg2queuing_port_def</span><span class=""> 
</span><span class="">                                        </span><span class="">send_queuing_message_maylost_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">assume</span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_full_portqueuing sysconf s pid&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">have</span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = insert_msg2queuing_port s pid m&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">send_queuing_message_maylost_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">            </span><span class="keyword1">with</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">              </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;(ports (comm s)) pid&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3">case</span><span class=""> </span><span class="">None</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">                  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">None.hyps</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">insert_msg2queuing_port_def</span><span class=""> </span><span class="">option.case_eq_if</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1">next</span><span class="">
</span><span class="">                </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Some</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1">have</span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class="string">&quot;(ports (comm s)) pid = Some x&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Some.hyps</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">                </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;the ((ports (comm s)) pid)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Queuing</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class=""> </span><span class="">x5</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1">have</span><span class=""> </span><span class="">f0</span><span class="delimiter">:</span><span class="string">&quot;the ((ports (comm s)) pid) = Queuing x1 x2 x3 x4 x5&quot;</span><span class=""> 
</span><span class="">                    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Queuing.hyps</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Communication_State.ext_inject</span><span class=""> </span><span class="">Communication_State.surjective</span><span class=""> 
</span><span class="">                    </span><span class="">Communication_State.update_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Port_Type.simps</span><span class="delimiter">(</span><span class="">5</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="">State.surjective</span><span class=""> </span><span class="">State.update_convs</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">f0</span><span class=""> </span><span class="">fun_upd_other</span><span class=""> 
</span><span class="">                    </span><span class="">insert_msg2queuing_port_def</span><span class=""> </span><span class="">option.case_eq_if</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1">next</span><span class="">
</span><span class="">                  </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Sampling</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class="delimiter">)</span><span class="">
</span><span class="">                   </span><span class="keyword1">have</span><span class=""> </span><span class="">f0</span><span class="delimiter">:</span><span class="string">&quot;the ((ports (comm s)) pid) = Sampling x1 x2 x3 x4&quot;</span><span class=""> 
</span><span class="">                    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Sampling</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">f0</span><span class=""> </span><span class="">insert_msg2queuing_port_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                </span><span class="keyword1">qed</span><span class="">
</span><span class="">              </span><span class="keyword1">qed</span><span class="">
</span><span class="">           </span><span class="keyword1">qed</span><span class="">
</span><span class="">         </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">}</span><span class="">
</span><span class="">    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">p4</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">  </span><span class="keyword1">}</span><span class="">
</span><span class="">  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">  
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_port_size_eq</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;p &#8800; pid&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot;get_port_buf_size s p = get_port_buf_size (fst (send_queuing_message_maylost sysconf s pid m)) p&quot;</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">insert_msg2queuing_port_def</span><span class=""> </span><span class="">replace_msg2queuing_port_def</span><span class=""> </span><span class="">send_queuing_message_maylost_def</span><span class="delimiter">)</span><span class="">                                  
</span><span class="">   </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;ports (comm s) pid&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;a&quot;</span><span class="delimiter">)</span><span class="">                                  
</span><span class="">   </span><span class="keyword1">using</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">get_port_byid_def</span><span class=""> </span><span class="">get_port_buf_size_def</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">   
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">snd_que_msg_lst_notchg_comminotherdom</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class="">   </span><span class="">p0</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8800; d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (send_queuing_message_maylost sysconf s pid m)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;vpeq_part_comm s d s&#39;&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword1">from</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">r0</span><span class="delimiter">:</span><span class="string">&quot;part_ports s = part_ports s&#39;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">snd_que_msg_lst_notchg_partports</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;get_ports_of_partition s d = get_ports_of_partition s&#39; d&quot;</span><span class=""> 
</span><span class="">     </span><span class="keyword1">using</span><span class=""> </span><span class="">part_ports_imp_portofpart</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">         
</span><span class="">    </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8704;p. p &#8712; get_ports_of_partition s d &#10230;
              is_a_queuingport s p = is_a_queuingport s&#39; p &#8743;
              is_dest_port s p = is_dest_port s&#39; p &#8743; 
              (if is_dest_port s p then get_port_buf_size s p = get_port_buf_size s&#39; p else True)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword1">{</span><span class="">
</span><span class="">     </span><span class="keyword3">fix</span><span class=""> </span><span class="">p</span><span class="">
</span><span class="">     </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;p &#8712; get_ports_of_partition s d &#10230;
          is_a_queuingport s p = is_a_queuingport s&#39; p &#8743;
          is_dest_port s p = is_dest_port s&#39; p &#8743; 
          (if is_dest_port s p then get_port_buf_size s p = get_port_buf_size s&#39; p else True)&quot;</span><span class="">
</span><span class="">     </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">impI</span><span class="delimiter">)</span><span class="">
</span><span class="">     </span><span class="keyword1">{</span><span class="">
</span><span class="">       </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;p &#8712; get_ports_of_partition s d&quot;</span><span class="">       
</span><span class="">       </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;is_a_queuingport s p = is_a_queuingport s&#39; p&quot;</span><span class="">
</span><span class="">         </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">is_a_queuingport_def</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">snd_que_msg_lst_notchg_portsinotherdom</span><span class="">
</span><span class="">              </span><span class="">a0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">interference1_def</span><span class=""> </span><span class="">non_interference1_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">              
</span><span class="">       </span><span class="keyword1">moreover</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;is_dest_port s p = is_dest_port s&#39; p &#8743; 
              (if is_dest_port s p then get_port_buf_size s p = get_port_buf_size s&#39; p else True) &quot;</span><span class="">
</span><span class="">       </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">       </span><span class="keyword1">{</span><span class="">
</span><span class="">         </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;is_dest_port s p = is_dest_port s&#39; p&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">is_dest_port_def</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">snd_que_msg_lst_notchg_portsinotherdom</span><span class="">
</span><span class="">            </span><span class="">a0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">interference1_def</span><span class=""> </span><span class="">non_interference1_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">smt</span><span class="">
</span><span class="">         </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;if is_dest_port s p then get_port_buf_size s p = get_port_buf_size s&#39; p else True&quot;</span><span class="">              
</span><span class="">         </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">         </span><span class="keyword1">{</span><span class="">
</span><span class="">          </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;is_dest_port s p&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;get_port_buf_size s p = get_port_buf_size s&#39; p&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;p = pid&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3">assume</span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class="string">&quot;p = pid&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">with</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;is_dest_port s pid&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_source_port s pid&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">dest_port_not_src</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1">with</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;s&#39; = s&quot;</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">send_queuing_message_maylost_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">assume</span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;p &#8800; pid&quot;</span><span class="">                      
</span><span class="">            </span><span class="keyword1">with</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">get_port_size_eq</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">          </span><span class="keyword1">qed</span><span class="">
</span><span class="">        </span><span class="keyword1">}</span><span class=""> </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">qed</span><span class="">    
</span><span class="">        </span><span class="keyword1">}</span><span class="">
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">       
</span><span class="">        </span><span class="keyword1">ultimately</span><span class="">  </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;is_a_queuingport s p = is_a_queuingport s&#39; p &#8743;
              is_dest_port s p = is_dest_port s&#39; p &#8743; 
              (if is_dest_port s p then get_port_buf_size s p = get_port_buf_size s&#39; p else True)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">    
</span><span class="">    </span><span class="keyword1">}</span><span class=""> </span><span class="keyword1">qed</span><span class="">
</span><span class="">   </span><span class="keyword1">}</span><span class="">
</span><span class="">   </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> </span><span class="keyword1">qed</span><span class="">
</span><span class="">   </span><span class="keyword1">ultimately</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class=""> </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">snd_que_msg_lst_sm_nitfpart</span><span class="delimiter">:</span><span class="string">&quot;&#10214;reachable0 s; is_a_partition sysconf (current s); is_a_partition sysconf d;
                                  ((current s) &#8726;&#8605; d); s&#39; = fst (send_queuing_message_maylost sysconf s pid m)&#10215;
                                        &#10233; (s &#8764; d &#8764; s&#39;)&quot;</span><span class="">             
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">is_a_partition_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">trans_imp_not_part</span><span class="">  </span><span class="">trans_imp_not_part</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">impI</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class="">  </span><span class="">sche_imp_not_part</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">impI</span><span class="delimiter">)</span><span class="">        
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">snd_que_msg_lst_notchg_partstate</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">snd_que_msg_lst_notchg_comminotherdom</span><span class=""> </span><span class="">vpeq_part_comm_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">      
</span><span class="">        
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">snd_que_msg_lst_presrv_lcrsp</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8726;&#8605; d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (send_queuing_message_maylost sysconf s pid m)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s &#8764; d &#8764; s&#39;&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_scheduler sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;is_a_scheduler sysconf d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">is_a_scheduler_def</span><span class=""> </span><span class="">snd_que_msg_lst_sm_sche</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">  </span><span class="keyword1">next</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_scheduler sysconf d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">snd_que_msg_lst_sm_nitfpart</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1">next</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_transmitter sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;is_a_transmitter sysconf d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">        </span><span class="keyword1">{</span><span class="">
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;comm s = comm s&#39; &#8743;  part_ports s = part_ports s&#39;&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1">{</span><span class="">
</span><span class="">            </span><span class="keyword1">from</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#172; part_intf_transmitter sysconf (current s)&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">interference1_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">non_interference1_def</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class="string">&quot;get_partition_cfg_ports (the ((partconf sysconf) (current s))) = {}&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">get_partition_cfg_ports_byid_def</span><span class=""> </span><span class="">is_a_partition_def</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">            </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class="string">&quot;get_partition_cfg_ports_byid sysconf (current s) = {}&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">get_partition_cfg_ports_byid_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#172; is_a_port_of_partition s pid (current s)&quot;</span><span class=""> 
</span><span class="">            </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;(ports (comm s)) pid = None&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword3">assume</span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class="string">&quot;(ports (comm s)) pid = None&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">port_cons_reach_state</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">p0</span><span class="delimiter">]</span><span class=""> 
</span><span class="">                </span><span class="">port_consistent_def</span><span class=""> </span><span class="">is_a_port_of_partition_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">              
</span><span class="">            </span><span class="keyword1">next</span><span class="">
</span><span class="">              </span><span class="keyword3">assume</span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class="string">&quot;&#172;((ports (comm s)) pid = None)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">port_cons_reach_state</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">p0</span><span class="delimiter">]</span><span class=""> 
</span><span class="">                </span><span class="">port_consistent_def</span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="">is_a_port_of_partition_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1">qed</span><span class="">
</span><span class="">            </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class="string">&quot;s = s&#39;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">send_queuing_message_maylost_def</span><span class=""> </span><span class="">p3</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;comm s = comm s&#39;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1">with</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;part_ports s = part_ports s&#39;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">          </span><span class="keyword1">}</span><span class="">
</span><span class="">          </span><span class="keyword1">qed</span><span class="">        
</span><span class="">        </span><span class="keyword1">}</span><span class="">
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_transmitter sysconf d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">snd_que_msg_lst_presrv_lcrsp_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;local_respect_e (hyperc (Send_Queuing_Message p m))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">snd_que_msg_lst_presrv_lcrsp</span><span class="">  </span><span class="">exec_event_def</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> 
</span><span class="">        </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">singletonD</span><span class=""> </span><span class="">vpeq_reflexive_lemma</span><span class=""> 
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">is_a_partition_def</span><span class="">   </span><span class="">vpeq1_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;receive queuing message&quot; satisfying the &quot;local respect&quot; property*}</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">rec_que_msg_notchg_current</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="string">&quot;&#10214;is_a_partition sysconf (current s); s&#39; = fst (receive_queuing_message s pid)&#10215; 
        &#10233; current s = current s&#39;&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">receive_queuing_message_def</span><span class=""> </span><span class="">remove_msg_from_queuingport_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;ports (comm s) pid&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;a&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        
</span><span class="">             
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">rec_que_msg_sm_sche</span><span class="delimiter">:</span><span class="string">&quot;&#10214;is_a_partition sysconf (current s); 
                                  s&#39; = fst (receive_queuing_message s pid)&#10215;
                                        &#10233; (s&#8764;(scheduler sysconf)&#8764;s&#39;)&quot;</span><span class="">
</span><span class="">       </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">receive_queuing_message_def</span><span class=""> </span><span class="">remove_msg_from_queuingport_def</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class="">  </span><span class="">vpeq1_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;ports (comm s) pid&quot;</span><span class="delimiter">)</span><span class="">                
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">vpeq_reflexive_lemma</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">vpeq1_def</span><span class="delimiter">)</span><span class="">                
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;a&quot;</span><span class="delimiter">)</span><span class="">        
</span><span class="">        </span><span class="keyword1">using</span><span class=""> </span><span class="">vpeq_reflexive_lemma</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">rec_que_msg_notchg_partstate</span><span class="delimiter">:</span><span class="">
</span><span class="">                  </span><span class="string">&quot;&#10214;is_a_partition sysconf (current s); is_a_partition sysconf d; 
                  s&#39; = fst (receive_queuing_message s pid)&#10215;
                                           &#10233; (partitions s) d = (partitions s&#39;) d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">receive_queuing_message_def</span><span class=""> </span><span class="">remove_msg_from_queuingport_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;ports (comm s) pid&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;a&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">vpeq_reflexive_lemma</span><span class="delimiter">)</span><span class="">
</span><span class="">        
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">rec_que_msg_notchg_partports</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (receive_queuing_message s pid)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;part_ports s = part_ports s&#39;&quot;</span><span class="">
</span><span class="">    
</span><span class="">    </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;(&#172; is_a_queuingport s pid
                    &#8744; &#172; is_a_port_of_partition s pid (current s)
                    &#8744; &#172; is_dest_port s pid
                    &#8744; is_empty_portqueuing s pid)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;(&#172; is_a_queuingport s pid
                &#8744; &#172; is_a_port_of_partition s pid (current s)
                &#8744; &#172; is_dest_port s pid 
                &#8744; is_empty_portqueuing s pid)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">receive_queuing_message_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">    </span><span class="keyword1">next</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;&#172;(&#172; is_a_queuingport s pid
                &#8744; &#172; is_a_port_of_partition s pid (current s)
                &#8744; &#172; is_dest_port s pid 
                &#8744; is_empty_portqueuing s pid)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (remove_msg_from_queuingport s pid)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">using</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">receive_queuing_message_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;(ports (comm s)) pid&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">case</span><span class=""> </span><span class="">None</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">None.hyps</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">remove_msg_from_queuingport_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">  
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Some</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class="string">&quot;(ports (comm s)) pid = Some x&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Some.hyps</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;the ((ports (comm s)) pid)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Queuing</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class=""> </span><span class="">x5</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Port_Type.simps</span><span class="delimiter">(</span><span class="">5</span><span class="delimiter">)</span><span class=""> </span><span class="">Queuing.hyps</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">4</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="">State.surjective</span><span class=""> </span><span class="">State.update_convs</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">eq_fst_iff</span><span class=""> </span><span class="">option.case_eq_if</span><span class=""> 
</span><span class="">              </span><span class="">remove_msg_from_queuingport_def</span><span class="delimiter">)</span><span class="">  
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Sampling</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">Sampling.hyps</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">remove_msg_from_queuingport_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">          </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">            
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">rec_que_msg_notchg_portsinotherdom</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8800; d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (receive_queuing_message s pid)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot; &#8704;p. p&#8712; get_ports_of_partition s d &#10230; ports (comm s) p = ports (comm s&#39;) p&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword1">{</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1">{</span><span class="">
</span><span class="">        </span><span class="keyword3">fix</span><span class=""> </span><span class="">p</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;p &#8712; get_ports_of_partition s d &#10230; ports (comm s) p = ports (comm s&#39;) p &quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">        </span><span class="keyword1">{</span><span class="">
</span><span class="">          </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;p &#8712; get_ports_of_partition s d&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;(part_ports s) p = Some d&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">get_ports_of_partition_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;ports (comm s) p = ports (comm s&#39;) p&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;p = pid&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;p = pid&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;(part_ports s) pid = Some d&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">            </span><span class="keyword1">have</span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_port_of_partition s pid (current s)&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">is_a_port_of_partition_def</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">            </span><span class="keyword1">have</span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = s&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">receive_queuing_message_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;p &#8800; pid&quot;</span><span class="">
</span><span class="">            </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">            </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;(ports (comm s)) pid&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword3">case</span><span class=""> </span><span class="">None</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">                </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">None.hyps</span><span class=""> </span><span class="">is_dest_port_def</span><span class=""> </span><span class="">option.case_eq_if</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">receive_queuing_message_def</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1">next</span><span class="">
</span><span class="">              </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Some</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class="string">&quot;(ports (comm s)) pid = Some x&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Some.hyps</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">              </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;the ((ports (comm s)) pid)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Queuing</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class=""> </span><span class="">x5</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1">have</span><span class=""> </span><span class="">f0</span><span class="delimiter">:</span><span class="string">&quot;the ((ports (comm s)) pid) = Queuing x1 x2 x3 x4 x5&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Queuing.hyps</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Communication_State.ext_inject</span><span class=""> </span><span class="">Communication_State.surjective</span><span class=""> 
</span><span class="">                  </span><span class="">Communication_State.update_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Port_Type.simps</span><span class="delimiter">(</span><span class="">5</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                  </span><span class="">State.surjective</span><span class=""> </span><span class="">State.update_convs</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">f0</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">fun_upd_other</span><span class=""> 
</span><span class="">                  </span><span class="">option.case_eq_if</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">receive_queuing_message_def</span><span class=""> </span><span class="">remove_msg_from_queuingport_def</span><span class="delimiter">)</span><span class="">  
</span><span class="">               </span><span class="keyword1">next</span><span class="">
</span><span class="">                </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Sampling</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class="delimiter">)</span><span class="">
</span><span class="">                 </span><span class="keyword1">have</span><span class=""> </span><span class="">f0</span><span class="delimiter">:</span><span class="string">&quot;the ((ports (comm s)) pid) = Sampling x1 x2 x3 x4&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Sampling</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">f0</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">receive_queuing_message_def</span><span class=""> 
</span><span class="">                  </span><span class="">remove_msg_from_queuingport_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">               </span><span class="keyword1">qed</span><span class="">
</span><span class="">            </span><span class="keyword1">qed</span><span class="">
</span><span class="">          </span><span class="keyword1">qed</span><span class="">
</span><span class="">        </span><span class="keyword1">}</span><span class="">
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">p4</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">}</span><span class="">
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">}</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">rec_que_msg_notchg_comminotherdom</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="keyword2">assumes</span><span class="">   </span><span class="">p0</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8800; d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (receive_queuing_message s pid)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;vpeq_part_comm s d s&#39;&quot;</span><span class="">       
</span><span class="">     </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">       </span><span class="keyword1">from</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">r0</span><span class="delimiter">:</span><span class="string">&quot;part_ports s = part_ports s&#39;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">rec_que_msg_notchg_partports</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class=""> 
</span><span class="">       </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;get_ports_of_partition s d = get_ports_of_partition s&#39; d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">using</span><span class=""> </span><span class="">part_ports_imp_portofpart</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">            
</span><span class="">       </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8704;p. p &#8712; get_ports_of_partition s d &#10230;
                is_a_queuingport s p = is_a_queuingport s&#39; p &#8743;
                is_dest_port s p = is_dest_port s&#39; p &#8743; 
                (if is_dest_port s p then get_port_buf_size s p = get_port_buf_size s&#39; p else True)&quot;</span><span class="">
</span><span class="">         </span><span class="keyword1">using</span><span class="">  </span><span class="">is_a_queuingport_def</span><span class=""> </span><span class="">is_dest_port_def</span><span class=""> </span><span class="">get_port_buf_size_def</span><span class=""> 
</span><span class="">                </span><span class="">rec_que_msg_notchg_portsinotherdom</span><span class=""> </span><span class="">get_port_byid_def</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">                  
</span><span class="">     </span><span class="keyword1">ultimately</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">     </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">rec_que_msg_sm_nitfpart</span><span class="delimiter">:</span><span class="string">&quot;&#10214;reachable0 s; is_a_partition sysconf (current s); is_a_partition sysconf d;
                                    ((current s) &#8726;&#8605; d); s&#39; = fst (receive_queuing_message s pid)&#10215;
                                          &#10233; (s &#8764; d &#8764; s&#39;)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">is_a_partition_def</span><span class=""> </span><span class="">vpeq_part_comm_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1">using</span><span class="">  </span><span class="">trans_imp_not_part</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">impI</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1">using</span><span class=""> </span><span class="">sche_imp_not_part</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">vpeq_part_def</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">is_a_partition_def</span><span class=""> </span><span class="">vpeq_part_comm_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">rec_que_msg_notchg_partstate</span><span class="">  </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">is_a_partition_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1">using</span><span class=""> </span><span class="">rec_que_msg_notchg_comminotherdom</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">rec_que_msg_presrv_lcrsp</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8726;&#8605; d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (receive_queuing_message s pid)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s &#8764; d &#8764; s&#39;&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_scheduler sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;is_a_scheduler sysconf d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">is_a_scheduler_def</span><span class=""> </span><span class="">rec_que_msg_sm_sche</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">  </span><span class="keyword1">next</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_scheduler sysconf d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class="">  </span><span class="">b0</span><span class=""> </span><span class="">rec_que_msg_sm_nitfpart</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1">next</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_transmitter sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;is_a_transmitter sysconf d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">        </span><span class="keyword1">{</span><span class="">
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;comm s = comm s&#39; &#8743;  part_ports s = part_ports s&#39;&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1">proof</span><span class="">-</span><span class="">
</span><span class="">          </span><span class="keyword1">{</span><span class="">
</span><span class="">            </span><span class="keyword1">from</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#172; part_intf_transmitter sysconf (current s)&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">interference1_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">non_interference1_def</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class="string">&quot;get_partition_cfg_ports (the ((partconf sysconf) (current s))) = {}&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">get_partition_cfg_ports_byid_def</span><span class=""> </span><span class="">is_a_partition_def</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">            </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class="string">&quot;get_partition_cfg_ports_byid sysconf (current s) = {}&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">get_partition_cfg_ports_byid_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#172; is_a_port_of_partition s pid (current s)&quot;</span><span class=""> 
</span><span class="">            </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;(ports (comm s)) pid = None&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword3">assume</span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class="string">&quot;(ports (comm s)) pid = None&quot;</span><span class="">
</span><span class="">              </span><span class="keyword3">thus</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">port_cons_reach_state</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">p0</span><span class="delimiter">]</span><span class=""> 
</span><span class="">                </span><span class="">port_consistent_def</span><span class=""> </span><span class="">is_a_port_of_partition_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">            </span><span class="keyword1">next</span><span class="">
</span><span class="">              </span><span class="keyword3">assume</span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class="string">&quot;&#172;((ports (comm s)) pid = None)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword3">thus</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">port_cons_reach_state</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">p0</span><span class="delimiter">]</span><span class=""> 
</span><span class="">                </span><span class="">d2</span><span class=""> </span><span class="">port_consistent_def</span><span class=""> </span><span class="">is_a_port_of_partition_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">            </span><span class="keyword1">qed</span><span class="">
</span><span class="">            </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">receive_queuing_message_def</span><span class=""> </span><span class="">p3</span><span class="delimiter">)</span><span class="">  
</span><span class="">          </span><span class="keyword1">}</span><span class="">
</span><span class="">          </span><span class="keyword1">qed</span><span class="">          
</span><span class="">        </span><span class="keyword1">}</span><span class="">
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">is_a_scheduler_def</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_transmitter sysconf d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">is_a_scheduler_def</span><span class=""> </span><span class="">is_a_transmitter_def</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">rec_que_msg_presrv_lcrsp_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;local_respect_e (hyperc (Receive_Queuing_Message p))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">rec_que_msg_presrv_lcrsp</span><span class="">  </span><span class="">exec_event_def</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="">  </span><span class="">vpeq_reflexive_lemma</span><span class=""> 
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">is_a_partition_def</span><span class="">  </span><span class="">vpeq1_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;get queuing portid&quot; satisfying the &quot;local respect&quot; property*}</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_que_pid_presrv_lcrsp</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8726;&#8605; d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (get_queuing_port_id sysconf s pname)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s &#8764; d &#8764; s&#39;&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = s&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">get_queuing_port_id_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">vpeq_reflexive_lemma</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_que_pid_presrv_lcrsp_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;local_respect_e (hyperc (Get_Queuing_Portid p))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">get_que_pid_presrv_lcrsp</span><span class="">  </span><span class="">exec_event_def</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="">  </span><span class="">vpeq_reflexive_lemma</span><span class=""> 
</span><span class="">   </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class="">  </span><span class="">vpeq1_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;get queuing port status&quot; satisfying the &quot;local respect&quot; property*}</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_que_psts_presrv_lcrsp</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8726;&#8605; d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (get_queuing_port_status sysconf s pid)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s &#8764; d &#8764; s&#39;&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = s&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">get_queuing_port_status_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">vpeq_reflexive_lemma</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_que_psts_presrv_lcrsp_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;local_respect_e (hyperc (Get_Queuing_Portstatus p))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">get_que_psts_presrv_lcrsp</span><span class=""> </span><span class="">exec_event_def</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">vpeq_reflexive_lemma</span><span class="">
</span><span class="">   </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class="">  </span><span class="">vpeq1_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;clear queuing port&quot; satisfying the &quot;local respect&quot; property*}</span><span class="">
</span><span class="">  
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">clr_que_port_notchg_current</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="string">&quot;&#10214;is_a_partition sysconf (current s); s&#39; = clear_queuing_port s pid&#10215; 
        &#10233; current s = current s&#39;&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">clear_queuing_port_def</span><span class=""> </span><span class="">Let_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">clr_que_port_sm_sche</span><span class="delimiter">:</span><span class="string">&quot;&#10214;is_a_partition sysconf (current s); 
                                  s&#39; = clear_queuing_port s pid&#10215;
                                        &#10233; (s&#8764;(scheduler sysconf)&#8764;s&#39;)&quot;</span><span class="">
</span><span class="">       </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">clear_queuing_port_def</span><span class=""> </span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">       
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">clr_que_port_notchg_partstate</span><span class="delimiter">:</span><span class="">
</span><span class="">                  </span><span class="string">&quot;&#10214;is_a_partition sysconf (current s); is_a_partition sysconf d; 
                   s&#39; = clear_queuing_port s pid&#10215; &#10233; (partitions s) d = (partitions s&#39;) d&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">clear_queuing_port_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">clr_que_port_notchg_partports</span><span class="delimiter">:</span><span class="">
</span><span class="">        </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = clear_queuing_port s pid&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;part_ports s = part_ports s&#39;&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;&#172; is_a_queuingport s pid
                &#8744; &#172; is_a_port_of_partition s pid (current s)
                &#8744; &#172; is_dest_port s pid&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_queuingport s pid
                &#8744; &#172; is_a_port_of_partition s pid (current s)
                &#8744; &#172; is_dest_port s pid&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">clear_queuing_port_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">        </span><span class="keyword1">next</span><span class="">
</span><span class="">          </span><span class="keyword3">assume</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;&#172;(&#172; is_a_queuingport s pid
                &#8744; &#172; is_a_port_of_partition s pid (current s)
                &#8744; &#172; is_dest_port s pid)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">with</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">clear_queuing_port_def</span><span class=""> </span><span class="">Let_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">       
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">clr_que_port_notchg_portsinotherdom</span><span class="delimiter">:</span><span class="">
</span><span class="">        </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8800; d&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = clear_queuing_port s pid&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot; &#8704;p. p&#8712; get_ports_of_partition s d &#10230; ports (comm s) p = ports (comm s&#39;) p&quot;</span><span class="">
</span><span class="">   </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword1">{</span><span class="">
</span><span class="">      </span><span class="keyword3">fix</span><span class=""> </span><span class="">p</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;p &#8712; get_ports_of_partition s d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;p &#8712; get_ports_of_partition s d &#10230; ports (comm s) p = ports (comm s&#39;) p &quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1">{</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;(part_ports s) p = Some d&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">get_ports_of_partition_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;ports (comm s) p = ports (comm s&#39;) p&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;&#172; is_a_queuingport s pid
                &#8744; &#172; is_a_port_of_partition s pid (current s)
                &#8744; &#172; is_dest_port s pid&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_queuingport s pid
                    &#8744; &#172; is_a_port_of_partition s pid (current s)
                    &#8744; &#172; is_dest_port s pid&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">with</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = s&quot;</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">clear_queuing_port_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">        </span><span class="keyword1">next</span><span class="">
</span><span class="">          </span><span class="keyword3">assume</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;&#172;(&#172; is_a_queuingport s pid
                    &#8744; &#172; is_a_port_of_partition s pid (current s)
                    &#8744; &#172; is_dest_port s pid)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">with</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">clear_queuing_port_def</span><span class=""> </span><span class="">Let_def</span><span class="">
</span><span class="">            </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">is_a_port_of_partition_def</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">}</span><span class="">
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">p4</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">}</span><span class="">
</span><span class="">    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">    
</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">clr_que_port_notchg_comminotherdom</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="keyword2">assumes</span><span class="">   </span><span class="">p0</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8800; d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = clear_queuing_port s pid&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;vpeq_part_comm s d s&#39;&quot;</span><span class="">
</span><span class="">         
</span><span class="">   </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">     </span><span class="keyword1">from</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">r0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;part_ports s = part_ports s&#39;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">clr_que_port_notchg_partports</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">        
</span><span class="">     </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;get_ports_of_partition s d = get_ports_of_partition s&#39; d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">using</span><span class=""> </span><span class="">part_ports_imp_portofpart</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">     
</span><span class="">      </span><span class="keyword1">moreover</span><span class=""> </span><span class="keyword1">have</span><span class="string">&quot;&#8704;p. p &#8712; get_ports_of_partition s d &#10230;
              is_a_queuingport s p = is_a_queuingport s&#39; p &#8743;
              is_dest_port s p = is_dest_port s&#39; p &#8743; 
              (if is_dest_port s p then get_port_buf_size s p = get_port_buf_size s&#39; p else True)&quot;</span><span class="">
</span><span class="">     </span><span class="keyword1">using</span><span class="">  </span><span class="">is_dest_port_def</span><span class=""> </span><span class="">get_port_buf_size_def</span><span class=""> </span><span class="">is_a_queuingport_def</span><span class="">
</span><span class="">                </span><span class="">clr_que_port_notchg_portsinotherdom</span><span class=""> </span><span class="">get_port_byid_def</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">     </span><span class="keyword1">ultimately</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">   </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">clr_que_port_sm_nitfpart</span><span class="delimiter">:</span><span class="string">&quot;&#10214;reachable0 s; is_a_partition sysconf (current s); is_a_partition sysconf d;
                                    ((current s) &#8726;&#8605; d); s&#39; = clear_queuing_port s pid&#10215;
                                          &#10233; (s &#8764; d &#8764; s&#39;)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class="">  </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">is_a_partition_def</span><span class=""> </span><span class="">interference1_def</span><span class=""> </span><span class="">non_interference1_def</span><span class=""> </span><span class="">vpeq_part_comm_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1">using</span><span class=""> </span><span class="">trans_imp_not_part</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">impI</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1">using</span><span class=""> </span><span class="">sche_imp_not_part</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">is_a_partition_def</span><span class=""> </span><span class="">interference1_def</span><span class=""> </span><span class="">non_interference1_def</span><span class=""> </span><span class="">vpeq_part_comm_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">clr_que_port_notchg_partstate</span><span class=""> 
</span><span class="">                    </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">vpeq_part_comm_def</span><span class=""> </span><span class="">is_a_partition_def</span><span class=""> </span><span class="">interference1_def</span><span class=""> </span><span class="">non_interference1_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1">using</span><span class=""> </span><span class="">clr_que_port_notchg_comminotherdom</span><span class=""> </span><span class="">nintf_neq</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">        
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">clr_que_port_presrv_lcrsp</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8726;&#8605; d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = clear_queuing_port s pid&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s &#8764; d &#8764; s&#39;&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_scheduler sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;is_a_scheduler sysconf d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">is_a_scheduler_def</span><span class=""> </span><span class="">clr_que_port_sm_sche</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1">next</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_scheduler sysconf d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">          </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">  </span><span class="keyword1">using</span><span class="">  </span><span class="">clr_que_port_sm_nitfpart</span><span class=""> </span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class="delimiter">]</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">        </span><span class="keyword1">next</span><span class="">
</span><span class="">          </span><span class="keyword3">assume</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">          </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_transmitter sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;is_a_transmitter sysconf d&quot;</span><span class="">
</span><span class="">            </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">              </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">              </span><span class="keyword1">{</span><span class="">
</span><span class="">                </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;vpeq_transmitter s d s&#39;&quot;</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">vpeq_transmitter_def</span><span class="">
</span><span class="">                </span><span class="keyword1">proof</span><span class="">-</span><span class="">
</span><span class="">                  </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;comm s = comm s&#39; &#8743;  part_ports s = part_ports s&#39;&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1">{</span><span class="">
</span><span class="">                    </span><span class="keyword1">from</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#172; part_intf_transmitter sysconf (current s)&quot;</span><span class=""> 
</span><span class="">                      </span><span class="keyword1">using</span><span class=""> </span><span class="">interference1_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">non_interference1_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class="string">&quot;get_partition_cfg_ports (the ((partconf sysconf) (current s))) = {}&quot;</span><span class=""> 
</span><span class="">                      </span><span class="keyword1">using</span><span class=""> </span><span class="">get_partition_cfg_ports_byid_def</span><span class="">  </span><span class="">p1</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">                    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class="string">&quot;get_partition_cfg_ports_byid sysconf (current s) = {}&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">get_partition_cfg_ports_byid_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#172; is_a_port_of_partition s pid (current s)&quot;</span><span class=""> 
</span><span class="">                      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;(ports (comm s)) pid = None&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                        </span><span class="keyword3">assume</span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class="string">&quot;(ports (comm s)) pid = None&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1">from</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class="string">&quot;port_consistent s&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">port_cons_reach_state</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                        </span><span class="keyword1">with</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class="string">&quot;(part_ports s) pid = None&quot;</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">port_consistent_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">is_a_port_of_partition_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                      </span><span class="keyword1">next</span><span class="">
</span><span class="">                        </span><span class="keyword3">assume</span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class="string">&quot;&#172;((ports (comm s)) pid = None)&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1">from</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class="string">&quot;port_consistent s&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">port_cons_reach_state</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;get_portname_by_type (the ((ports (comm s)) pid)) &#8712;
                            get_partition_cfg_ports_byid sysconf (the ((part_ports s) pid)) &quot;</span><span class="">
</span><span class="">                            </span><span class="keyword1">using</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">port_consistent_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                        </span><span class="keyword1">with</span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;current s &#8800; the ((part_ports s) pid)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">is_a_port_of_partition_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                      </span><span class="keyword1">qed</span><span class="">
</span><span class="">                    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class="string">&quot;s = s&#39;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">clear_queuing_port_def</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">p3</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;comm s = comm s&#39;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1">with</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;part_ports s = part_ports s&#39;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1">}</span><span class="">
</span><span class="">                  </span><span class="keyword1">qed</span><span class="">
</span><span class="">                </span><span class="keyword1">qed</span><span class="">
</span><span class="">              </span><span class="keyword1">}</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">is_a_scheduler_def</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1">qed</span><span class="">
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">assume</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_transmitter sysconf d&quot;</span><span class="">
</span><span class="">            </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">is_a_scheduler_def</span><span class=""> </span><span class="">is_a_transmitter_def</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">qed</span><span class="">
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">clr_que_port_presrv_lcrsp_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;local_respect_e (hyperc (Clear_Queuing_Port p))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">clr_que_port_presrv_lcrsp</span><span class=""> </span><span class="">exec_event_def</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="">  </span><span class="">vpeq_reflexive_lemma</span><span class=""> 
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class="">   </span><span class="">vpeq1_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;get partition statue&quot; satisfying the &quot;local respect&quot; property*}</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_part_status_presrv_lcrsp</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8726;&#8605; d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (get_partition_status sysconf s)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s &#8764; d &#8764; s&#39;&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = s&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">get_partition_status_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">vpeq_reflexive_lemma</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_part_status_presrv_lcrsp_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;local_respect_e (hyperc (Get_Partition_Status))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">get_part_status_presrv_lcrsp</span><span class="">  </span><span class="">exec_event_def</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="">  </span><span class="">vpeq_reflexive_lemma</span><span class=""> 
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">is_a_partition_def</span><span class="">  </span><span class="">vpeq1_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;set partition mode&quot; satisfying the &quot;local respect&quot; property*}</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">set_part_mode_notchg_current</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="string">&quot;&#10214;is_a_partition sysconf (current s); s&#39; = set_partition_mode sysconf s m&#10215; 
        &#10233; current s = current s&#39;&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">set_partition_mode_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">set_part_mode_sm_sche</span><span class="delimiter">:</span><span class="string">&quot;&#10214;is_a_partition sysconf (current s); 
                                s&#39; = set_partition_mode sysconf s m&#10215;
                                      &#10233; (s&#8764;(scheduler sysconf)&#8764;s&#39;)&quot;</span><span class="">
</span><span class="">     </span><span class="keyword1">using</span><span class=""> </span><span class="">set_part_mode_notchg_current</span><span class="">  </span><span class="">part_imp_not_sch</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">set_part_mode_notchg_partstate_inotherdom</span><span class="delimiter">:</span><span class="">
</span><span class="">                </span><span class="string">&quot;&#10214;is_a_partition sysconf (current s); is_a_partition sysconf d; current s &#8800; d;
                s&#39; = set_partition_mode sysconf s m&#10215;
                      &#10233; (partitions s) d = (partitions s&#39;) d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">set_partition_mode_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">      
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">set_part_mode_notchg_port</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="string">&quot;&#10214;is_a_partition sysconf (current s); s&#39; = set_partition_mode sysconf s m&#10215;
      &#10233; &#8704;p. p&#8712; get_ports_of_partition s d &#10230; ports (comm s) p = ports (comm s&#39;) p&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">set_partition_mode_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">set_part_mode_notchg_partports</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="string">&quot;&#10214;is_a_partition sysconf (current s); s&#39; = set_partition_mode sysconf s m&#10215;&#10233;
          part_ports s = part_ports s&#39;&quot;</span><span class="">
</span><span class="">     </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">set_partition_mode_def</span><span class="delimiter">)</span><span class="">
</span><span class="">     </span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">set_part_mode_notchg_comm</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class="">   </span><span class="">p0</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2">and</span><span class="">   </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8800; d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = set_partition_mode sysconf s m&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;vpeq_part_comm s d s&#39;&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">using</span><span class=""> </span><span class="">get_ports_of_partition_def</span><span class=""> </span><span class="">no_cfgport_impl_noports</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p4</span><span class=""> 
</span><span class="">          </span><span class="">port_partition</span><span class=""> </span><span class="">set_part_mode_notchg_partports</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">set_part_mode_notchg_comm2</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="string">&quot;&#10214;reachable0 s; is_a_partition sysconf (current s); (current s) &#8800; d; s&#39; = set_partition_mode sysconf s m&#10215;
      &#10233; comm s = comm s&#39;&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">set_partition_mode_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">done</span></span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">set_part_mode_sm_nitfpart</span><span class="delimiter">:</span><span class="string">&quot;&#10214;reachable0 s; is_a_partition sysconf (current s); is_a_partition sysconf d;
                                    ((current s) &#8726;&#8605; d); s&#39; = set_partition_mode sysconf s m&#10215;
                                          &#10233; (s &#8764; d &#8764; s&#39;)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">is_a_partition_def</span><span class=""> </span><span class="">non_interference1_def</span><span class=""> </span><span class="">vpeq_part_comm_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1">using</span><span class=""> </span><span class="">is_a_transmitter_def</span><span class=""> </span><span class="">trans_imp_not_part</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">impI</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1">using</span><span class=""> </span><span class="">is_a_scheduler_def</span><span class=""> </span><span class="">sche_imp_not_part</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">vpeq_part_def</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">is_a_partition_def</span><span class=""> </span><span class="">non_interference1_def</span><span class=""> </span><span class="">vpeq_part_comm_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1">using</span><span class="">  </span><span class="">set_part_mode_notchg_partstate_inotherdom</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">        </span><span class="keyword1">using</span><span class=""> </span><span class="">set_part_mode_notchg_comm</span><span class=""> </span><span class="">nintf_neq</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">set_part_mode_presrv_lcrsp</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8726;&#8605; d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = set_partition_mode sysconf s m&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s &#8764; d &#8764; s&#39;&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_scheduler sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;is_a_scheduler sysconf d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">set_part_mode_sm_sche</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">p1</span><span class="delimiter">]</span><span class=""> </span><span class="">is_a_scheduler_def</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">    </span><span class="keyword1">next</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_scheduler sysconf d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">          </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">set_part_mode_sm_nitfpart</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">        </span><span class="keyword1">next</span><span class="">
</span><span class="">          </span><span class="keyword3">assume</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">          </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_transmitter sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;is_a_transmitter sysconf d&quot;</span><span class="">
</span><span class="">            </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">              </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">              </span><span class="keyword1">{</span><span class="">
</span><span class="">                </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;vpeq_transmitter s d s&#39;&quot;</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">vpeq_transmitter_def</span><span class="">
</span><span class="">                </span><span class="keyword1">proof</span><span class="">-</span><span class="">
</span><span class="">                  </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;comm s = comm s&#39; &#8743;  part_ports s = part_ports s&#39;&quot;</span><span class=""> 
</span><span class="">                    </span><span class="keyword1">using</span><span class=""> </span><span class="">set_part_mode_notchg_partports</span><span class=""> </span><span class="">set_part_mode_notchg_comm2</span><span class="">
</span><span class="">                      </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1">qed</span><span class="">
</span><span class="">              </span><span class="keyword1">}</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">is_a_scheduler_def</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1">qed</span><span class="">
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">assume</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_transmitter sysconf d&quot;</span><span class="">
</span><span class="">            </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">is_a_scheduler_def</span><span class=""> </span><span class="">is_a_transmitter_def</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">qed</span><span class="">
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">set_part_mode_presrv_lcrsp_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;local_respect_e (hyperc (Set_Partition_Mode p))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">set_part_mode_presrv_lcrsp</span><span class="">  </span><span class="">exec_event_def</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="">  </span><span class="">vpeq_reflexive_lemma</span><span class=""> 
</span><span class="">     </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class="">   </span><span class="">vpeq1_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;schedule&quot; satisfying the &quot;local respect&quot; property*}</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">schedule_presrv_lcrsp</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class="string">&quot;(scheduler sysconf) &#8726;&#8605; d&quot;</span><span class="">        
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s &#8764; d &#8764; s&#39;&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">using</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">schedule_presrv_lcrsp_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;local_respect_e (sys Schedule)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">schedule_presrv_lcrsp</span><span class=""> </span><span class="">exec_event_def</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">vpeq_reflexive_lemma</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;Transfer Sampling Message&quot; satisfying the &quot;local respect&quot; property*}</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">trans_smpl_msg_notchg_current</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="string">&quot;&#10214;is_a_transmitter sysconf (current s); s&#39; = transf_sampling_msg s c&#10215; 
        &#10233; current s = current s&#39;&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">c</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">update_sampling_ports_msg_def</span><span class=""> </span><span class="">Let_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">trans_smpl_msg_sm_sche</span><span class="delimiter">:</span><span class="string">&quot;&#10214;is_a_transmitter sysconf (current s); 
                                s&#39; = transf_sampling_msg s c&#10215;
                                      &#10233; (s&#8764;(scheduler sysconf)&#8764;s&#39;)&quot;</span><span class="">
</span><span class="">     </span><span class="keyword1">using</span><span class=""> </span><span class="">trans_smpl_msg_notchg_current</span><span class=""> </span><span class="">sch_not_trans</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="">vpeq_sched_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">presburger</span><span class=""> 
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">trans_smpl_msg_notchg_partstate</span><span class="delimiter">:</span><span class="">
</span><span class="">                </span><span class="string">&quot;&#10214;is_a_transmitter sysconf (current s); is_a_partition sysconf d; 
                 s&#39; = transf_sampling_msg s c&#10215; &#10233; (partitions s) d = (partitions s&#39;) d&quot;</span><span class="">
</span><span class="">     </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">c</span><span class="delimiter">)</span><span class="">
</span><span class="">     </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">transf_sampling_msg_def</span><span class=""> </span><span class="">Let_def</span><span class="delimiter">)</span><span class="">
</span><span class="">     </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">update_sampling_ports_msg_def</span><span class=""> </span><span class="">Let_def</span><span class="delimiter">)</span><span class="">
</span><span class="">     </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">vpeq_reflexive_lemma</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">trans_smpl_msg_notchg_partports</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="string">&quot;s&#39; = transf_sampling_msg s c &#10230; part_ports s = part_ports s&#39;&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">c</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Channel_Sampling</span><span class=""> </span><span class="">name</span><span class=""> </span><span class="">sn</span><span class=""> </span><span class="">dns</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;get_portid_by_name s sn&#8800;None &#8743; card (get_portids_by_names s dns) = card dns&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1">{</span><span class="">
</span><span class="">            </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;get_portid_by_name s sn&#8800;None &#8743; card (get_portids_by_names s dns) = card dns&quot;</span><span class="">
</span><span class="">            </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">transf_sampling_msg_def</span><span class=""> </span><span class="">update_sampling_ports_msg_def</span><span class=""> </span><span class="">Let_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">          </span><span class="keyword1">}</span><span class="">
</span><span class="">          </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">          </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Channel_Queuing</span><span class=""> </span><span class="">nm</span><span class=""> </span><span class="">sn</span><span class=""> </span><span class="">dn</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">            
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">trans_smpl_msg_notchg_portsinotherdom</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_transmitter sysconf (current s)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8726;&#8605; d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = transf_sampling_msg s c&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot; &#8704;p. p&#8712; get_ports_of_partition s d &#10230; ports (comm s) p = ports (comm s&#39;) p&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_scheduler sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;is_a_scheduler sysconf d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">with</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class="string">&quot;get_ports_of_partition s d = {}&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1">using</span><span class=""> </span><span class="">no_cfgport_impl_noports</span><span class=""> </span><span class="">is_a_scheduler_def</span><span class=""> </span><span class="">sched_hasnoports</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_scheduler sysconf d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">with</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;&#172; transmitter_intf_part sysconf d&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">interference1_def</span><span class=""> </span><span class="">non_interference1_def</span><span class=""> </span><span class="">trans_imp_not_part</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class="string">&quot;get_partition_cfg_ports (the ((partconf sysconf) d)) = {}&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">get_partition_cfg_ports_byid_def</span><span class=""> </span><span class="">is_a_partition_def</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">            </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class="string">&quot;get_partition_cfg_ports_byid sysconf d = {}&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">get_partition_cfg_ports_byid_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1">with</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b4</span><span class="delimiter">:</span><span class="string">&quot;get_ports_of_partition s d = {}&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">no_cfgport_impl_noports</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">assume</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;&#172;is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">            </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">              </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_transmitter sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;is_a_transmitter sysconf d&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">with</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;current s = d&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">is_a_transmitter_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1">with</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">interference1_def</span><span class=""> </span><span class="">non_interference1_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">  
</span><span class="">              </span><span class="keyword1">next</span><span class="">
</span><span class="">                </span><span class="keyword3">assume</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_transmitter sysconf d&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">with</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class="string">&quot;get_partition_cfg_ports_byid sysconf d = {}&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">get_partition_cfg_ports_byid_def</span><span class=""> </span><span class="">is_a_partition_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1">with</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class="string">&quot;get_ports_of_partition s d = {}&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">no_cfgport_impl_noports</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">              </span><span class="keyword1">qed</span><span class="">
</span><span class="">          </span><span class="keyword1">qed</span><span class="">
</span><span class="">       </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">trans_smpl_msg_notchg_comminotherdom</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="keyword2">assumes</span><span class="">   </span><span class="">p0</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_transmitter sysconf (current s)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8726;&#8605; d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = transf_sampling_msg s c&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;vpeq_part_comm s d s&#39;&quot;</span><span class="">
</span><span class="">     </span><span class="keyword1">proof</span><span class="">-</span><span class="">
</span><span class="">       </span><span class="keyword1">from</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">p5</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8800; d&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">non_interference1_def</span><span class=""> </span><span class="">interference1_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">       </span><span class="keyword1">from</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;part_ports s = part_ports s&#39;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">trans_smpl_msg_notchg_partports</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">       </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;get_ports_of_partition s d = get_ports_of_partition s&#39; d&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">using</span><span class=""> </span><span class="">part_ports_imp_portofpart</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">       
</span><span class="">       </span><span class="keyword1">moreover</span><span class=""> </span><span class="keyword1">have</span><span class="string">&quot;&#8704;p. p &#8712; get_ports_of_partition s d &#10230;
                is_a_queuingport s p = is_a_queuingport s&#39; p &#8743;
                is_dest_port s p = is_dest_port s&#39; p &#8743; 
                (if is_dest_port s p then get_port_buf_size s p = get_port_buf_size s&#39; p else True)&quot;</span><span class="">
</span><span class="">       </span><span class="keyword1">using</span><span class="">  </span><span class="">get_port_buf_size_def</span><span class=""> </span><span class="">is_dest_port_def</span><span class=""> </span><span class="">is_a_queuingport_def</span><span class=""> 
</span><span class="">        </span><span class="">trans_smpl_msg_notchg_portsinotherdom</span><span class=""> </span><span class="">get_port_byid_def</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">       </span><span class="keyword1">ultimately</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">     </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">trans_smpl_msg_sm_nitfpart</span><span class="delimiter">:</span><span class="string">&quot;&#10214;reachable0 s; is_a_transmitter sysconf (current s); is_a_partition sysconf d;
                                  ((current s) &#8726;&#8605; d); s&#39; = transf_sampling_msg s c&#10215;
                                        &#10233; (s &#8764; d &#8764; s&#39;)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">vpeq1_def</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">non_interference1_def</span><span class=""> </span><span class="">is_a_transmitter_def</span><span class=""> 
</span><span class="">          </span><span class="">is_a_partition_def</span><span class=""> </span><span class="">vpeq_part_comm_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1">using</span><span class=""> </span><span class="">trans_imp_not_part</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">impI</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1">using</span><span class="">  </span><span class="">sche_imp_not_part</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">vpeq_part_def</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">non_interference1_def</span><span class=""> 
</span><span class="">          </span><span class="">is_a_transmitter_def</span><span class=""> </span><span class="">is_a_partition_def</span><span class=""> </span><span class="">vpeq_part_comm_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">trans_smpl_msg_notchg_partstate</span><span class=""> </span><span class="">vpeq_part_comm_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1">using</span><span class="">  </span><span class="">trans_smpl_msg_notchg_comminotherdom</span><span class=""> </span><span class="">nintf_neq</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">trans_smpl_msg_presrv_lcrsp</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;current s = transmitter sysconf&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8726;&#8605; d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = transf_sampling_msg s c&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s &#8764; d &#8764; s&#39;&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_scheduler sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;is_a_scheduler sysconf d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a0</span><span class="">  </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">trans_smpl_msg_sm_sche</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">  
</span><span class="">  </span><span class="keyword1">next</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_scheduler sysconf d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">p1</span><span class="">  </span><span class="">trans_smpl_msg_sm_nitfpart</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">_</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_transmitter sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;is_a_transmitter sysconf d&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">with</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;current s = d&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">is_a_transmitter_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1">with</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">interference1_def</span><span class=""> </span><span class="">non_interference1_def</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">   
</span><span class="">        </span><span class="keyword1">next</span><span class="">
</span><span class="">          </span><span class="keyword3">assume</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_transmitter sysconf d&quot;</span><span class="">
</span><span class="">          </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">is_a_scheduler_def</span><span class=""> </span><span class="">is_a_transmitter_def</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">trans_smpl_msg_presrv_lcrsp_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;local_respect_e (sys (Transfer_Sampling_Message c))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">trans_smpl_msg_presrv_lcrsp</span><span class="">  </span><span class="">exec_event_def</span><span class="">  
</span><span class="">      </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">vpeq_reflexive_lemma</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">vpeq1_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;Transfer Queuing Message&quot; satisfying the &quot;local respect&quot; property*}</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">trans_que_msg_mlost_notchg_current</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="string">&quot;is_a_transmitter sysconf (current s) &#10233; current s = current (transf_queuing_msg_maylost sysconf s c)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">c</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Channel_Queuing</span><span class=""> </span><span class="">name</span><span class=""> </span><span class="">sn</span><span class=""> </span><span class="">dn</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">            </span><span class="keyword1">let</span><span class=""> </span><span class="var">?sp</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;get_portid_by_name s sn&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">let</span><span class=""> </span><span class="var">?dp</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;get_portid_by_name s dn&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">let</span><span class=""> </span><span class="var">?sm</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;remove_msg_from_queuingport s (the ?sp)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">let</span><span class=""> </span><span class="var">?s1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;fst ?sm&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">let</span><span class=""> </span><span class="var">?s2</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;replace_msg2queuing_port ?s1 (the ?dp) (the (snd ?sm))&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">let</span><span class=""> </span><span class="var">?s3</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;insert_msg2queuing_port ?s1 (the ?dp) (the (snd ?sm))&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">have</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;current ?s1 = current s&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;(ports (comm s)) (the ?sp)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3">case</span><span class=""> </span><span class="">None</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">None.hyps</span><span class=""> </span><span class="">remove_msg_from_queuingport_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">              </span><span class="keyword1">next</span><span class="">
</span><span class="">                </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Some</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                  </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;the ((ports (comm s)) (the ?sp))&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Queuing</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class=""> </span><span class="">x5</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                      </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Port_Type.simps</span><span class="delimiter">(</span><span class="">5</span><span class="delimiter">)</span><span class=""> </span><span class="">Queuing.hyps</span><span class=""> </span><span class="">State.ext_inject</span><span class=""> 
</span><span class="">                        </span><span class="">State.surjective</span><span class=""> </span><span class="">State.update_convs</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">fstI</span><span class=""> </span><span class="">option.case_eq_if</span><span class=""> 
</span><span class="">                        </span><span class="">remove_msg_from_queuingport_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">                  </span><span class="keyword1">next</span><span class="">
</span><span class="">                    </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Sampling</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                        </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Port_Type.simps</span><span class="delimiter">(</span><span class="">6</span><span class="delimiter">)</span><span class=""> </span><span class="">Sampling.hyps</span><span class="">
</span><span class="">                          </span><span class="">fst_conv</span><span class=""> </span><span class="">option.case_eq_if</span><span class=""> </span><span class="">remove_msg_from_queuingport_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">qed</span><span class="">
</span><span class="">               </span><span class="keyword1">qed</span><span class="">
</span><span class="">            </span><span class="keyword1">have</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;current ?s2 = current ?s1&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">replace_msg2queuing_port_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1">have</span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class="string">&quot;current ?s3 = current ?s1&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;(ports (comm ?s1)) (the ?dp)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3">case</span><span class=""> </span><span class="">None</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">None.hyps</span><span class=""> </span><span class="">insert_msg2queuing_port_def</span><span class=""> </span><span class="">option.case_eq_if</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1">next</span><span class="">
</span><span class="">                </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Some</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                  </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;the ((ports (comm ?s1)) (the ?dp))&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Queuing</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class=""> </span><span class="">x5</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                        </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Port_Type.simps</span><span class="delimiter">(</span><span class="">5</span><span class="delimiter">)</span><span class=""> </span><span class="">Queuing.hyps</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                            </span><span class="">State.surjective</span><span class=""> </span><span class="">State.update_convs</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">insert_msg2queuing_port_def</span><span class=""> </span><span class="">option.case_eq_if</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">next</span><span class="">
</span><span class="">                    </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Sampling</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                        </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Port_Type.simps</span><span class="delimiter">(</span><span class="">6</span><span class="delimiter">)</span><span class=""> </span><span class="">Sampling.hyps</span><span class=""> 
</span><span class="">                            </span><span class="">insert_msg2queuing_port_def</span><span class=""> </span><span class="">option.case_eq_if</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">qed</span><span class="">
</span><span class="">              </span><span class="keyword1">qed</span><span class="">
</span><span class="">            </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> 
</span><span class="">              </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;?sp &#8800; None &#8743; ?dp &#8800; None &#8743; has_msg_inportqueuing s (the ?sp)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;?sp &#8800; None &#8743; ?dp &#8800; None &#8743; has_msg_inportqueuing s (the ?sp)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                  </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_full_portqueuing sysconf (fst ?sm) (the ?dp)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;is_full_portqueuing sysconf (fst ?sm) (the ?dp)&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;transf_queuing_msg_maylost sysconf s (Channel_Queuing name sn dn) = ?s2&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">transf_queuing_msg_maylost.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="keyword1">with</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1">next</span><span class="">
</span><span class="">                    </span><span class="keyword3">assume</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_full_portqueuing sysconf (fst ?sm) (the ?dp)&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;transf_queuing_msg_maylost sysconf s (Channel_Queuing name sn dn) = ?s3&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">transf_queuing_msg_maylost.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1">with</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">  
</span><span class="">                  </span><span class="keyword1">qed</span><span class="">
</span><span class="">              </span><span class="keyword1">next</span><span class="">
</span><span class="">                </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;&#172;(?sp &#8800; None &#8743; ?dp &#8800; None &#8743; has_msg_inportqueuing s (the ?sp))&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;transf_queuing_msg_maylost sysconf s (Channel_Queuing name sn dn) = s&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">transf_queuing_msg_maylost.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1">qed</span><span class="">
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Channel_Sampling</span><span class=""> </span><span class="">name</span><span class=""> </span><span class="">sn</span><span class=""> </span><span class="">dns</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">   </span><span class="keyword1">lemma</span><span class=""> </span><span class="">trans_que_msg_mlost_sm_sche</span><span class="delimiter">:</span><span class="string">&quot;&#10214;is_a_transmitter sysconf (current s); 
                                  s&#39; = transf_queuing_msg_maylost sysconf s c&#10215;
                                        &#10233; (s&#8764;(scheduler sysconf)&#8764;s&#39;)&quot;</span><span class="">
</span><span class="">       </span><span class="keyword1">using</span><span class=""> </span><span class="">trans_que_msg_mlost_notchg_current</span><span class=""> </span><span class="">sch_not_trans</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">
</span><span class="">   </span><span class="keyword1">lemma</span><span class=""> </span><span class="">trans_que_msg_mlost_notchg_partstate</span><span class="delimiter">:</span><span class="">
</span><span class="">              </span><span class="string">&quot;&#10214;is_a_transmitter sysconf (current s); is_a_partition sysconf d; 
              s&#39; = transf_queuing_msg_maylost sysconf s c&#10215; &#10233; (partitions s) d = (partitions s&#39;) d&quot;</span><span class="">
</span><span class="">       </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">c</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Channel_Queuing</span><span class=""> </span><span class="">name</span><span class=""> </span><span class="">sn</span><span class=""> </span><span class="">dn</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">            </span><span class="keyword1">let</span><span class=""> </span><span class="var">?sp</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;get_portid_by_name s sn&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">let</span><span class=""> </span><span class="var">?dp</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;get_portid_by_name s dn&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">let</span><span class=""> </span><span class="var">?sm</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;remove_msg_from_queuingport s (the ?sp)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">let</span><span class=""> </span><span class="var">?s1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;fst ?sm&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">let</span><span class=""> </span><span class="var">?s2</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;replace_msg2queuing_port ?s1 (the ?dp) (the (snd ?sm))&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">let</span><span class=""> </span><span class="var">?s3</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;insert_msg2queuing_port ?s1 (the ?dp) (the (snd ?sm))&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">have</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;(partitions s) d = (partitions ?s1) d&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;(ports (comm s)) (the ?sp)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3">case</span><span class=""> </span><span class="">None</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">None.hyps</span><span class=""> </span><span class="">remove_msg_from_queuingport_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">              </span><span class="keyword1">next</span><span class="">
</span><span class="">                </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Some</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                  </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;the ((ports (comm s)) (the ?sp))&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Queuing</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class=""> </span><span class="">x5</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                      </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Port_Type.simps</span><span class="delimiter">(</span><span class="">5</span><span class="delimiter">)</span><span class=""> </span><span class="">Queuing.hyps</span><span class=""> </span><span class="">State.ext_inject</span><span class=""> 
</span><span class="">                        </span><span class="">State.surjective</span><span class=""> </span><span class="">State.update_convs</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">fstI</span><span class=""> </span><span class="">option.case_eq_if</span><span class=""> 
</span><span class="">                        </span><span class="">remove_msg_from_queuingport_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                      
</span><span class="">                  </span><span class="keyword1">next</span><span class="">
</span><span class="">                    </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Sampling</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                        </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Port_Type.simps</span><span class="delimiter">(</span><span class="">6</span><span class="delimiter">)</span><span class=""> </span><span class="">Sampling.hyps</span><span class="">
</span><span class="">                          </span><span class="">fst_conv</span><span class=""> </span><span class="">option.case_eq_if</span><span class=""> </span><span class="">remove_msg_from_queuingport_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">qed</span><span class="">
</span><span class="">               </span><span class="keyword1">qed</span><span class="">
</span><span class="">            </span><span class="keyword1">have</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;(partitions ?s2) d = (partitions ?s1) d&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">replace_msg2queuing_port_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1">have</span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class="string">&quot;(partitions ?s3) d = (partitions ?s1) d&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;(ports (comm ?s1)) (the ?dp)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3">case</span><span class=""> </span><span class="">None</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">None.hyps</span><span class=""> </span><span class="">insert_msg2queuing_port_def</span><span class=""> </span><span class="">option.case_eq_if</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1">next</span><span class="">
</span><span class="">                </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Some</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                  </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;the ((ports (comm ?s1)) (the ?dp))&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Queuing</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class=""> </span><span class="">x5</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                        </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Port_Type.simps</span><span class="delimiter">(</span><span class="">5</span><span class="delimiter">)</span><span class=""> </span><span class="">Queuing.hyps</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                          </span><span class="">State.surjective</span><span class=""> </span><span class="">State.update_convs</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">insert_msg2queuing_port_def</span><span class=""> </span><span class="">option.case_eq_if</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1">next</span><span class="">
</span><span class="">                    </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Sampling</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                        </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Port_Type.simps</span><span class="delimiter">(</span><span class="">6</span><span class="delimiter">)</span><span class=""> </span><span class="">Sampling.hyps</span><span class=""> 
</span><span class="">                            </span><span class="">insert_msg2queuing_port_def</span><span class=""> </span><span class="">option.case_eq_if</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">qed</span><span class="">
</span><span class="">              </span><span class="keyword1">qed</span><span class="">
</span><span class="">            </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> 
</span><span class="">              </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;?sp &#8800; None &#8743; ?dp &#8800; None &#8743; has_msg_inportqueuing s (the ?sp)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;?sp &#8800; None &#8743; ?dp &#8800; None &#8743; has_msg_inportqueuing s (the ?sp)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                  </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_full_portqueuing sysconf (fst ?sm) (the ?dp)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;is_full_portqueuing sysconf (fst ?sm) (the ?dp)&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;transf_queuing_msg_maylost sysconf s (Channel_Queuing name sn dn) = ?s2&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">transf_queuing_msg_maylost.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="keyword1">with</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Channel_Queuing.prems</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">next</span><span class="">
</span><span class="">                    </span><span class="keyword3">assume</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_full_portqueuing sysconf (fst ?sm) (the ?dp)&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;transf_queuing_msg_maylost sysconf s (Channel_Queuing name sn dn) = ?s3&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">transf_queuing_msg_maylost.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1">with</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Channel_Queuing.prems</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">  
</span><span class="">                  </span><span class="keyword1">qed</span><span class="">
</span><span class="">              </span><span class="keyword1">next</span><span class="">
</span><span class="">                </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;&#172;(?sp &#8800; None &#8743; ?dp &#8800; None &#8743; has_msg_inportqueuing s (the ?sp))&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;transf_queuing_msg_maylost sysconf s (Channel_Queuing name sn dn) = s&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">transf_queuing_msg_maylost.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Channel_Queuing.prems</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1">qed</span><span class="">
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Channel_Sampling</span><span class=""> </span><span class="">name</span><span class=""> </span><span class="">sn</span><span class=""> </span><span class="">dns</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Channel_Sampling.prems</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">trans_que_msg_mlost_notchg_partports</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="string">&quot;s&#39; = transf_queuing_msg_maylost sysconf s c &#10233; 
        part_ports s = part_ports s&#39;&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">c</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Channel_Queuing</span><span class=""> </span><span class="">name</span><span class=""> </span><span class="">sn</span><span class=""> </span><span class="">dn</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">            </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?sp</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;get_portid_by_name s sn&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?dp</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;get_portid_by_name s dn&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?sm</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;remove_msg_from_queuingport s (the ?sp)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?s1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;fst ?sm&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?s2</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;replace_msg2queuing_port ?s1 (the ?dp) (the (snd ?sm))&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">let</span><span class=""> </span><span class="var">?s3</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;insert_msg2queuing_port ?s1 (the ?dp) (the (snd ?sm))&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;part_ports s = part_ports ?s1&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;(ports (comm s)) (the ?sp)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword3">case</span><span class=""> </span><span class="">None</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">None.hyps</span><span class=""> </span><span class="">remove_msg_from_queuingport_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                </span><span class="keyword1">next</span><span class="">
</span><span class="">                  </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Some</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                    </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;the ((ports (comm s)) (the ?sp))&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                      </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Queuing</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class=""> </span><span class="">x5</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                        </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Port_Type.simps</span><span class="delimiter">(</span><span class="">5</span><span class="delimiter">)</span><span class=""> </span><span class="">Queuing.hyps</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">4</span><span class="delimiter">)</span><span class=""> </span><span class="">State.surjective</span><span class=""> 
</span><span class="">                          </span><span class="">State.update_convs</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">fstI</span><span class=""> </span><span class="">option.case_eq_if</span><span class=""> </span><span class="">remove_msg_from_queuingport_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1">next</span><span class="">
</span><span class="">                      </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Sampling</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                          </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Port_Type.simps</span><span class="delimiter">(</span><span class="">6</span><span class="delimiter">)</span><span class=""> </span><span class="">Sampling.hyps</span><span class="">
</span><span class="">                            </span><span class="">fst_conv</span><span class=""> </span><span class="">option.case_eq_if</span><span class=""> </span><span class="">remove_msg_from_queuingport_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="keyword1">qed</span><span class="">
</span><span class="">                 </span><span class="keyword1">qed</span><span class="">
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;part_ports ?s2 = part_ports ?s1&quot;</span><span class=""> 
</span><span class="">                </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">replace_msg2queuing_port_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class="string">&quot;part_ports ?s3 = part_ports ?s1&quot;</span><span class=""> 
</span><span class="">                </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;(ports (comm ?s1)) (the ?dp)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword3">case</span><span class=""> </span><span class="">None</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">None.hyps</span><span class=""> </span><span class="">insert_msg2queuing_port_def</span><span class=""> </span><span class="">option.case_eq_if</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1">next</span><span class="">
</span><span class="">                  </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Some</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                    </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;the ((ports (comm ?s1)) (the ?dp))&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                      </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Queuing</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class=""> </span><span class="">x5</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                        </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Communication_State.select_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Communication_State.surjective</span><span class=""> 
</span><span class="">                          </span><span class="">Communication_State.update_convs</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">Port_Type.simps</span><span class="delimiter">(</span><span class="">5</span><span class="delimiter">)</span><span class=""> </span><span class="">Queuing.hyps</span><span class=""> 
</span><span class="">                          </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">4</span><span class="delimiter">)</span><span class=""> </span><span class="">State.surjective</span><span class=""> </span><span class="">State.update_convs</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                          </span><span class="">insert_msg2queuing_port_def</span><span class=""> </span><span class="">option.case_eq_if</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1">next</span><span class="">
</span><span class="">                      </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Sampling</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                          </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Port_Type.simps</span><span class="delimiter">(</span><span class="">6</span><span class="delimiter">)</span><span class=""> </span><span class="">Sampling.hyps</span><span class=""> 
</span><span class="">                              </span><span class="">insert_msg2queuing_port_def</span><span class=""> </span><span class="">option.case_eq_if</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="keyword1">qed</span><span class="">
</span><span class="">                </span><span class="keyword1">qed</span><span class="">
</span><span class="">              </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;?sp &#8800; None &#8743; ?dp &#8800; None &#8743; has_msg_inportqueuing s (the ?sp)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;?sp &#8800; None &#8743; ?dp &#8800; None &#8743; has_msg_inportqueuing s (the ?sp)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                    </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_full_portqueuing sysconf (fst ?sm) (the ?dp)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                      </span><span class="keyword3">assume</span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class="string">&quot;is_full_portqueuing sysconf (fst ?sm) (the ?dp)&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;transf_queuing_msg_maylost sysconf s (Channel_Queuing name sn dn) = ?s2&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">transf_queuing_msg_maylost.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                      </span><span class="keyword1">with</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Channel_Queuing.prems</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="keyword1">next</span><span class="">
</span><span class="">                      </span><span class="keyword3">assume</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_full_portqueuing sysconf (fst ?sm) (the ?dp)&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;transf_queuing_msg_maylost sysconf s (Channel_Queuing name sn dn) = ?s3&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">transf_queuing_msg_maylost.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">                      </span><span class="keyword1">with</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Channel_Queuing.prems</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">  
</span><span class="">                    </span><span class="keyword1">qed</span><span class="">
</span><span class="">                </span><span class="keyword1">next</span><span class="">
</span><span class="">                  </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;&#172;(?sp &#8800; None &#8743; ?dp &#8800; None &#8743; has_msg_inportqueuing s (the ?sp))&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;transf_queuing_msg_maylost sysconf s (Channel_Queuing name sn dn) = s&quot;</span><span class=""> 
</span><span class="">                    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">transf_queuing_msg_maylost.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Channel_Queuing.prems</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1">qed</span><span class="">
</span><span class="">            </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Channel_Sampling</span><span class=""> </span><span class="">name</span><span class=""> </span><span class="">sn</span><span class=""> </span><span class="">dns</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Channel_Sampling.prems</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">trans_que_msg_mlost_notchg_portsinotherdom</span><span class="delimiter">:</span><span class="">
</span><span class="">        </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_transmitter sysconf (current s)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8726;&#8605; d&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = transf_queuing_msg_maylost sysconf s c&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">shows</span><span class=""> </span><span class="string">&quot; &#8704;p. p&#8712; get_ports_of_partition s d &#10230; ports (comm s) p = ports (comm s&#39;) p&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_scheduler sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;is_a_scheduler sysconf d&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">with</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class="string">&quot;get_ports_of_partition s d = {}&quot;</span><span class=""> 
</span><span class="">            </span><span class="keyword1">using</span><span class=""> </span><span class="">no_cfgport_impl_noports</span><span class="">  </span><span class="">sched_hasnoports</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1">next</span><span class="">
</span><span class="">          </span><span class="keyword3">assume</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_scheduler sysconf d&quot;</span><span class="">
</span><span class="">          </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">            </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">with</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;&#172; transmitter_intf_part sysconf d&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">interference1_def</span><span class=""> </span><span class="">non_interference1_def</span><span class=""> </span><span class="">trans_imp_not_part</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class="string">&quot;get_partition_cfg_ports (the ((partconf sysconf) d)) = {}&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">get_partition_cfg_ports_byid_def</span><span class=""> </span><span class="">is_a_partition_def</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class="string">&quot;get_partition_cfg_ports_byid sysconf d = {}&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">get_partition_cfg_ports_byid_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1">with</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b4</span><span class="delimiter">:</span><span class="string">&quot;get_ports_of_partition s d = {}&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">no_cfgport_impl_noports</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1">next</span><span class="">
</span><span class="">              </span><span class="keyword3">assume</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;&#172;is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">              </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_transmitter sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;is_a_transmitter sysconf d&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1">with</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;current s = d&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">is_a_transmitter_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">with</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">interference1_def</span><span class=""> </span><span class="">non_interference1_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">   
</span><span class="">                </span><span class="keyword1">next</span><span class="">
</span><span class="">                  </span><span class="keyword3">assume</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_transmitter sysconf d&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1">with</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class="string">&quot;get_partition_cfg_ports_byid sysconf d = {}&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">get_partition_cfg_ports_byid_def</span><span class=""> </span><span class="">is_a_partition_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">with</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class="string">&quot;get_ports_of_partition s d = {}&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">no_cfgport_impl_noports</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1">qed</span><span class="">
</span><span class="">            </span><span class="keyword1">qed</span><span class="">
</span><span class="">         </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">trans_que_msg_mlost_notchg_comminotherdom</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class="">   </span><span class="">p0</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2">and</span><span class="">   </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_transmitter sysconf (current s)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8726;&#8605; d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = transf_queuing_msg_maylost sysconf s c&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;vpeq_part_comm s d s&#39;&quot;</span><span class="">
</span><span class="">     </span><span class="keyword1">proof</span><span class="">-</span><span class="">
</span><span class="">       </span><span class="keyword1">from</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">p5</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8800; d&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">non_interference1_def</span><span class=""> </span><span class="">interference1_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">       </span><span class="keyword1">from</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;part_ports s = part_ports s&#39;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">trans_que_msg_mlost_notchg_partports</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">       </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;get_ports_of_partition s d = get_ports_of_partition s&#39; d&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">using</span><span class=""> </span><span class="">part_ports_imp_portofpart</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">               
</span><span class="">       </span><span class="keyword1">moreover</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8704;p. p &#8712; get_ports_of_partition s d &#10230;
                is_a_queuingport s p = is_a_queuingport s&#39; p &#8743;
                is_dest_port s p = is_dest_port s&#39; p &#8743; 
                (if is_dest_port s p then get_port_buf_size s p = get_port_buf_size s&#39; p else True)&quot;</span><span class="">
</span><span class="">       </span><span class="keyword1">using</span><span class="">  </span><span class="">is_dest_port_def</span><span class=""> </span><span class="">is_a_queuingport_def</span><span class=""> </span><span class="">trans_que_msg_mlost_notchg_portsinotherdom</span><span class=""> </span><span class="">get_port_byid_def</span><span class=""> 
</span><span class="">              </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">get_port_buf_size_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">  
</span><span class="">    
</span><span class="">       </span><span class="keyword1">ultimately</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">     </span><span class="keyword1">qed</span><span class="">
</span><span class="">       
</span><span class="">    
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">trans_que_msg_mlost_sm_nitfpart</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="string">&quot;&#10214;reachable0 s; is_a_transmitter sysconf (current s); is_a_partition sysconf d;
         ((current s) &#8726;&#8605; d); s&#39; = transf_queuing_msg_maylost sysconf s c&#10215; &#10233; (s &#8764; d &#8764; s&#39;)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">vpeq1_def</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">is_a_transmitter_def</span><span class=""> 
</span><span class="">            </span><span class="">is_a_partition_def</span><span class=""> </span><span class="">non_interference1_def</span><span class=""> </span><span class="">vpeq_part_comm_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1">using</span><span class="">  </span><span class="">trans_imp_not_part</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">impI</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1">using</span><span class="">  </span><span class="">sche_imp_not_part</span><span class=""> </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">is_a_transmitter_def</span><span class=""> </span><span class="">is_a_partition_def</span><span class=""> </span><span class="">non_interference1_def</span><span class=""> </span><span class="">vpeq_part_comm_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class=""> </span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">trans_que_msg_mlost_notchg_partstate</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1">using</span><span class=""> </span><span class="">trans_que_msg_mlost_notchg_comminotherdom</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1">lemma</span><span class=""> </span><span class="">trans_que_msg_mlost_presrv_lcrsp</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;current s = transmitter sysconf&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8726;&#8605; d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = transf_queuing_msg_maylost sysconf s c&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s &#8764; d &#8764; s&#39;&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_scheduler sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;is_a_scheduler sysconf d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">is_a_scheduler_def</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">trans_que_msg_mlost_sm_sche</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">is_a_transmitter_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">  
</span><span class="">    </span><span class="keyword1">next</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_scheduler sysconf d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">          </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">trans_que_msg_mlost_sm_nitfpart</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">_</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">  
</span><span class="">        </span><span class="keyword1">next</span><span class="">
</span><span class="">          </span><span class="keyword3">assume</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">          </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_transmitter sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;is_a_transmitter sysconf d&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">with</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;current s = d&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">is_a_transmitter_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1">with</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">   
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">assume</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_transmitter sysconf d&quot;</span><span class="">
</span><span class="">            </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c1</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">qed</span><span class="">
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">trans_que_msg_mlost_presrv_lcrsp_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;local_respect_e (sys (Transfer_Queuing_Message c))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">trans_que_msg_mlost_presrv_lcrsp</span><span class="">  </span><span class="">exec_event_def</span><span class="">  
</span><span class="">       </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="">vpeq_reflexive_lemma</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">cong</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class=""> </span><span class="">vpeq1_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving the &quot;local respect&quot; property*}</span><span class="">
</span><span class="">  </span><span class="keyword1">theorem</span><span class=""> </span><span class="">local_respect</span><span class="delimiter">:</span><span class="">local_respect</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1">{</span><span class="">
</span><span class="">        </span><span class="keyword3">fix</span><span class=""> </span><span class="">e</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;local_respect_e e&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">e</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1">using</span><span class=""> </span><span class="">crt_smpl_port_presrv_lcrsp_e</span><span class=""> </span><span class="">write_smpl_msg_presrv_lcrsp_e</span><span class="">
</span><span class="">                  </span><span class="">read_smpl_msg_presrv_lcrsp_e</span><span class="">  </span><span class="">get_smpl_pid_presrv_lcrsp_e</span><span class=""> 
</span><span class="">                  </span><span class="">get_smpl_psts_presrv_lcrsp_e</span><span class=""> </span><span class="">crt_que_port_presrv_lcrsp_e</span><span class=""> 
</span><span class="">                  </span><span class="">snd_que_msg_lst_presrv_lcrsp_e</span><span class=""> </span><span class="">rec_que_msg_presrv_lcrsp_e</span><span class=""> 
</span><span class="">                  </span><span class="">get_que_pid_presrv_lcrsp_e</span><span class="">  </span><span class="">get_que_psts_presrv_lcrsp_e</span><span class=""> 
</span><span class="">                  </span><span class="">clr_que_port_presrv_lcrsp_e</span><span class="">  </span><span class="">set_part_mode_presrv_lcrsp_e</span><span class=""> 
</span><span class="">                  </span><span class="">get_part_status_presrv_lcrsp_e</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">Hypercall.induct</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1">using</span><span class=""> </span><span class="">schedule_presrv_lcrsp_e</span><span class=""> </span><span class="">trans_smpl_msg_presrv_lcrsp_e</span><span class=""> 
</span><span class="">                </span><span class="">trans_que_msg_mlost_presrv_lcrsp_e</span><span class="">
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">System_Event.induct</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1">}</span><span class="">
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">local_respect_all_evt</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">subsection</span><span class="verbatim">{* Concrete unwinding condition of &quot;weakly step consistent&quot; *}</span><span class="">    
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;create sampling port&quot; satisfying the &quot;step consistent&quot; property*}</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">crt_smpl_port_presrv_comm_part_ports</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="keyword2">assumes</span><span class="">   </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s &#8743; reachable0 t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; (transmitter sysconf) &#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p5</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; (scheduler sysconf) &#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (create_sampling_port sysconf s pname)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = fst (create_sampling_port sysconf t pname)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;comm s&#39; = comm t&#39; &#8743; part_ports s&#39; = part_ports t&#39;&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1">{</span><span class="">
</span><span class="">        </span><span class="keyword1">from</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;vpeq_transmitter s (transmitter sysconf) t&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">sch_not_trans</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;comm s = comm t &#8743; part_ports s = part_ports t&quot;</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1">from</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class="string">&quot;port_consistent s &#8743; port_consistent t&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">port_cons_reach_state</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;get_samplingport_conf sysconf pname = None 
                         &#8744; get_portid_by_name s pname &#8800; None
                         &#8744; pname &#8713; get_partition_cfg_ports_byid sysconf (current s)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3">assume</span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class="string">&quot;get_samplingport_conf sysconf pname = None 
                         &#8744; get_portid_by_name s pname &#8800; None
                         &#8744; pname &#8713; get_partition_cfg_ports_byid sysconf (current s)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">with</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = s&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">create_sampling_port_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1">have</span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class="string">&quot;get_samplingport_conf sysconf pname = None 
                         &#8744; get_portid_by_name t pname &#8800; None
                         &#8744; pname &#8713; get_partition_cfg_ports_byid sysconf (current t)&quot;</span><span class="">
</span><span class="">                         </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">disjoint_iff_not_equal</span><span class=""> </span><span class="">port_partition</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1">with</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">d3</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = t&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">create_sampling_port_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">            </span><span class="keyword1">with</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword1">let</span><span class=""> </span><span class="var">?nid</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;get_portid_in_type (the (get_samplingport_conf sysconf pname))&quot;</span><span class="">
</span><span class="">            </span><span class="keyword3">assume</span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class="string">&quot;&#172;(get_samplingport_conf sysconf pname = None 
                         &#8744; get_portid_by_name s pname &#8800; None
                         &#8744; pname &#8713; get_partition_cfg_ports_byid sysconf (current s))&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">with</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class="string">&quot;part_ports s&#39; = (part_ports s)(?nid:= (Some (current s)))&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">            </span><span class="keyword1">with</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">e2</span><span class="delimiter">:</span><span class="string">&quot;part_ports t&#39; = (part_ports t)(?nid := (Some (current t)))&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">            </span><span class="keyword1">with</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">e3</span><span class="delimiter">:</span><span class="string">&quot;ports (comm s&#39;) = (ports (comm s))(?nid := get_samplingport_conf sysconf pname)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1">with</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">e4</span><span class="delimiter">:</span><span class="string">&quot;ports (comm t&#39;) = (ports (comm t))(?nid := get_samplingport_conf sysconf pname)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1">with</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">e2</span><span class=""> </span><span class="">e3</span><span class=""> </span><span class="">e4</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">sched_current_lemma</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">          </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">}</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">crt_smpl_port_presrv_comm_of_current_part</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="keyword2">assumes</span><span class="">   </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s &#8743; reachable0 t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; (scheduler sysconf) &#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (create_sampling_port sysconf s pname)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = fst (create_sampling_port sysconf t pname)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p5</span><span class="delimiter">:</span><span class="string">&quot;(current s) = d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p6</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part_comm s d t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p7</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;vpeq_part_comm s&#39; d t&#39;&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class="delimiter">,</span><span class=""> </span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1">{</span><span class="">
</span><span class="">        </span><span class="keyword1">from</span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;get_ports_of_partition s d = get_ports_of_partition t d&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1">from</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class="string">&quot;current s = current t&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">            
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="">g0</span><span class="delimiter">:</span><span class="string">&quot;get_ports_of_partition s&#39; d = get_ports_of_partition t&#39; d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">        </span><span class="keyword1">{</span><span class="">
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8704;p. p&#8712;get_ports_of_partition s&#39; d &#10230; p&#8712;get_ports_of_partition t&#39; d&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">proof</span><span class="">-</span><span class="">
</span><span class="">            </span><span class="keyword1">{</span><span class="">
</span><span class="">              </span><span class="keyword3">fix</span><span class=""> </span><span class="">p</span><span class="">
</span><span class="">              </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;p&#8712;get_ports_of_partition s&#39; d&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class="string">&quot;p&#8712;get_ports_of_partition t&#39; d&quot;</span><span class="">
</span><span class="">                 </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;pname &#8712; get_partition_cfg_ports_byid sysconf (current s)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;pname &#8712; get_partition_cfg_ports_byid sysconf (current s)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1">with</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;pname &#8712; get_partition_cfg_ports_byid sysconf (current t)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1">have</span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class="string">&quot;p &#8800; get_portid_in_type (the (get_samplingport_conf sysconf pname))&quot;</span><span class=""> 
</span><span class="">                    </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                </span><span class="keyword1">next</span><span class="">
</span><span class="">                  </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;&#172;(pname &#8712; get_partition_cfg_ports_byid sysconf (current s))&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1">with</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;&#172;(pname &#8712; get_partition_cfg_ports_byid sysconf (current t))&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1">have</span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = s&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">create_sampling_port_def</span><span class=""> </span><span class="">p3</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1">have</span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = t&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">create_sampling_port_def</span><span class=""> </span><span class="">p4</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">  
</span><span class="">                </span><span class="keyword1">qed</span><span class="">
</span><span class="">            </span><span class="keyword1">}</span><span class="">
</span><span class="">            </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1">qed</span><span class="">
</span><span class="">          </span><span class="keyword1">moreover</span><span class="">
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8704;p. p&#8712;get_ports_of_partition t&#39; d &#10230; p&#8712;get_ports_of_partition s&#39; d&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">proof</span><span class="">-</span><span class="">
</span><span class="">            </span><span class="keyword1">{</span><span class="">
</span><span class="">              </span><span class="keyword3">fix</span><span class=""> </span><span class="">p</span><span class="">
</span><span class="">              </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;p&#8712;get_ports_of_partition t&#39; d&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class="string">&quot;p&#8712;get_ports_of_partition s&#39; d&quot;</span><span class="">
</span><span class="">                 </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;pname &#8712; get_partition_cfg_ports_byid sysconf (current s)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;pname &#8712; get_partition_cfg_ports_byid sysconf (current s)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1">with</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;pname &#8712; get_partition_cfg_ports_byid sysconf (current t)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1">have</span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class="string">&quot;p &#8800; get_portid_in_type (the (get_samplingport_conf sysconf pname))&quot;</span><span class=""> 
</span><span class="">                    </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                </span><span class="keyword1">next</span><span class="">
</span><span class="">                  </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;&#172;(pname &#8712; get_partition_cfg_ports_byid sysconf (current s))&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1">with</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;&#172;(pname &#8712; get_partition_cfg_ports_byid sysconf (current t))&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1">have</span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = s&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">create_sampling_port_def</span><span class=""> </span><span class="">p3</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1">have</span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = t&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">create_sampling_port_def</span><span class=""> </span><span class="">p4</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">  
</span><span class="">                </span><span class="keyword1">qed</span><span class="">
</span><span class="">            </span><span class="keyword1">}</span><span class="">
</span><span class="">            </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1">qed</span><span class="">
</span><span class="">          </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">calculation</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">        </span><span class="keyword1">}</span><span class="">
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword1">from</span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;get_ports_of_partition s d = get_ports_of_partition t d&quot;</span><span class=""> 
</span><span class="">            </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">vpeq_part_comm_def</span><span class=""> </span><span class="">Let_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1">from</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class="string">&quot;current s = current t&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;&#8704;p. (is_dest_port s&#39; p &#10230; p &#8712; get_ports_of_partition s&#39; d &#10230;
         is_a_queuingport s&#39; p = is_a_queuingport t&#39; p &#8743; is_dest_port t&#39; p 
         &#8743; get_port_buf_size s&#39; p = get_port_buf_size t&#39; p) &#8743; (&#172; is_dest_port s&#39; p &#10230;
         p &#8712; get_ports_of_partition s&#39; d &#10230; is_a_queuingport s&#39; p = is_a_queuingport t&#39; p &#8743; &#172; is_dest_port t&#39; p) &quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">          </span><span class="keyword1">{</span><span class="">
</span><span class="">            </span><span class="keyword3">fix</span><span class=""> </span><span class="">p</span><span class="">
</span><span class="">            </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(is_dest_port s&#39; p &#10230;
               p &#8712; get_ports_of_partition s&#39; d &#10230;
               is_a_queuingport s&#39; p = is_a_queuingport t&#39; p &#8743; is_dest_port t&#39; p 
               &#8743; get_port_buf_size s&#39; p = get_port_buf_size t&#39; p) &#8743; (&#172; is_dest_port s&#39; p &#10230;
               p &#8712; get_ports_of_partition s&#39; d &#10230; is_a_queuingport s&#39; p = is_a_queuingport t&#39; p &#8743; &#172; is_dest_port t&#39; p)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;pname &#8712; get_partition_cfg_ports_byid sysconf (current s)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;pname &#8712; get_partition_cfg_ports_byid sysconf (current s)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">with</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;pname &#8712; get_partition_cfg_ports_byid sysconf (current t)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1">have</span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class="string">&quot;p &#8800; get_portid_in_type (the (get_samplingport_conf sysconf pname))&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">              </span><span class="keyword1">next</span><span class="">
</span><span class="">                </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;&#172;(pname &#8712; get_partition_cfg_ports_byid sysconf (current s))&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">with</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;&#172;(pname &#8712; get_partition_cfg_ports_byid sysconf (current t))&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1">have</span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = s&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">create_sampling_port_def</span><span class=""> </span><span class="">p3</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1">have</span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = t&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">create_sampling_port_def</span><span class=""> </span><span class="">p4</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">p6</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">   
</span><span class="">              </span><span class="keyword1">qed</span><span class="">
</span><span class="">          </span><span class="keyword1">}</span><span class="">
</span><span class="">          </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">}</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">crt_smpl_port_presrv_wk_stp_cons</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s &#8743; reachable0 t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; d &#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; (scheduler sysconf) &#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p5</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8605; d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p6</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; (current s) &#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p7</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (create_sampling_port sysconf s pname)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p8</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = fst (create_sampling_port sysconf t pname)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s&#39; &#8764; d &#8764; t&#39;&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_scheduler sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;is_a_scheduler sysconf d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a0</span><span class="">  </span><span class="">p1</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">sche_imp_not_part</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">is_a_scheduler_def</span><span class=""> </span><span class="">no_intf_sched_help</span><span class="delimiter">)</span><span class="">  
</span><span class="">    </span><span class="keyword1">next</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_scheduler sysconf d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">          </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> 
</span><span class="">            </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;current s = d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;current s = d&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part s&#39; d t&#39;&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                </span><span class="keyword1">{</span><span class="">
</span><span class="">                  
</span><span class="">                  </span><span class="keyword1">have</span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class="string">&quot;partitions s&#39; d = partitions t&#39; d&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class=""> 
</span><span class="">                    </span><span class="keyword1">{</span><span class="">
</span><span class="">                      </span><span class="keyword1">from</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">f1</span><span class="delimiter">:</span><span class="string">&quot;partitions s d = partitions t d&quot;</span><span class=""> 
</span><span class="">                        </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">part_imp_not_tras</span><span class="">   </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">                      </span><span class="keyword1">from</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">f2</span><span class="delimiter">:</span><span class="string">&quot;partitions s d = partitions s&#39; d&quot;</span><span class=""> 
</span><span class="">                        </span><span class="keyword1">using</span><span class="">  </span><span class="">b0</span><span class=""> </span><span class="">crt_sampl_port_notchg_partstate</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                      </span><span class="keyword1">from</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">f3</span><span class="delimiter">:</span><span class="string">&quot;partitions t d = partitions t&#39; d&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">crt_sampl_port_notchg_partstate</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">sched_current_lemma</span><span class="">
</span><span class="">                          </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                      </span><span class="keyword1">with</span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="">f2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;partitions s&#39; d = partitions t&#39; d&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1">}</span><span class="">
</span><span class="">                    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1">qed</span><span class="">
</span><span class="">                  </span><span class="keyword1">have</span><span class=""> </span><span class="">e2</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part_comm s&#39; d t&#39;&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                    </span><span class="keyword1">{</span><span class="">
</span><span class="">                      </span><span class="keyword1">from</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">f1</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part_comm s d t&quot;</span><span class=""> 
</span><span class="">                        </span><span class="keyword1">using</span><span class=""> </span><span class="">part_imp_not_tras</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">                      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;vpeq_part_comm s&#39; d t&#39;&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1">using</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">crt_smpl_port_presrv_comm_of_current_part</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">                        
</span><span class="">                    </span><span class="keyword1">}</span><span class="">
</span><span class="">                    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1">qed</span><span class="">
</span><span class="">                  </span><span class="keyword1">with</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;vpeq_part s&#39; d t&#39;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1">}</span><span class="">
</span><span class="">                </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1">qed</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c0</span><span class="">                                                                
</span><span class="">                </span><span class="keyword1">using</span><span class=""> </span><span class="">trans_imp_not_part</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">                                
</span><span class="">            </span><span class="keyword1">next</span><span class="">
</span><span class="">              </span><span class="keyword3">assume</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;current s &#8800; d&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part s&#39; d t&#39;&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">              </span><span class="keyword1">{</span><span class="">
</span><span class="">                </span><span class="keyword1">have</span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class="string">&quot;partitions s&#39; d = partitions t&#39; d&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class="">  </span><span class="">crt_sampl_port_notchg_partstate</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">p7</span><span class="delimiter">]</span><span class="">  
</span><span class="">                     </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">part_imp_not_tras</span><span class=""> </span><span class="">sched_current_lemma</span><span class="">
</span><span class="">                     </span><span class="">b0</span><span class=""> </span><span class="">c1</span><span class="">  </span><span class="">p1</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">part_imp_not_sch</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">                      
</span><span class="">                </span><span class="keyword1">have</span><span class=""> </span><span class="">e2</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part_comm s&#39; d t&#39;&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">create_sampling_port_def</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">get_samplingport_conf_def</span><span class=""> 
</span><span class="">                      </span><span class="">is_a_scheduler_def</span><span class=""> </span><span class="">is_a_transmitter_def</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">part_imp_not_tras</span><span class=""> 
</span><span class="">                      </span><span class="">port_name_diff</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="">vpeq_part_def</span><span class="delimiter">)</span><span class="">
</span><span class="">               </span><span class="keyword1">with</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;vpeq_part s&#39; d t&#39;&quot;</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1">}</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1">qed</span><span class="">
</span><span class="">              </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c1</span><span class="">                            
</span><span class="">              </span><span class="keyword1">using</span><span class="">  </span><span class="">trans_imp_not_part</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">                              
</span><span class="">            </span><span class="keyword1">qed</span><span class="">
</span><span class="">        </span><span class="keyword1">next</span><span class="">
</span><span class="">          </span><span class="keyword3">assume</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">          </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_transmitter sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;is_a_transmitter sysconf d&quot;</span><span class="">
</span><span class="">            </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> 
</span><span class="">               </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">crt_smpl_port_presrv_comm_part_ports</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">_</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">p8</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">                 
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">assume</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_transmitter sysconf d&quot;</span><span class="">
</span><span class="">            </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">qed</span><span class="">
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">crt_smpl_port_presrv_wk_stp_cons_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;weak_step_consistent_e (hyperc (Create_Sampling_Port p))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">crt_smpl_port_presrv_wk_stp_cons</span><span class=""> </span><span class="">weak_step_consistent_e_def</span><span class=""> </span><span class="">exec_event_def</span><span class=""> </span><span class="">mem_Collect_eq</span><span class="">
</span><span class="">      </span><span class="">non_interference1_def</span><span class=""> </span><span class="">non_interference_def</span><span class=""> </span><span class="">singletonD</span><span class=""> </span><span class="">sched_vpeq</span><span class=""> </span><span class="">same_part_mode</span><span class="">
</span><span class="">        </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Event.case</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Hypercall.case</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">domain_of_event.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="">event_enabled.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">option.sel</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;write sampling message&quot; satisfying the &quot;step consistent&quot; property*}</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">wrt_smpl_msg_presrv_comm_part_ports</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="keyword2">assumes</span><span class="">   </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s &#8743; reachable0 t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; (transmitter sysconf) &#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p5</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; (scheduler sysconf) &#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (write_sampling_message s pid m)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = fst (write_sampling_message t pid m)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;comm s&#39; = comm t&#39; &#8743; part_ports s&#39; = part_ports t&#39;&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1">{</span><span class="">
</span><span class="">        </span><span class="keyword1">from</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;vpeq_transmitter s (transmitter sysconf) t&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">sch_not_trans</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;comm s = comm t &#8743; part_ports s = part_ports t&quot;</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1">from</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class="string">&quot;port_consistent s &#8743; port_consistent t&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">port_cons_reach_state</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;&#172; is_a_samplingport s pid 
                        &#8744; &#172; is_source_port s pid
                        &#8744; &#172; is_a_port_of_partition s pid (current s)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3">assume</span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_samplingport s pid 
                        &#8744; &#172; is_source_port s pid
                        &#8744; &#172; is_a_port_of_partition s pid (current s)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">with</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = s&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">write_sampling_message_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1">have</span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_samplingport t pid
                        &#8744; &#172; is_source_port t pid
                        &#8744; &#172; is_a_port_of_partition t pid (current t)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">is_a_port_of_partition_def</span><span class=""> </span><span class="">is_a_samplingport_def</span><span class=""> 
</span><span class="">                </span><span class="">is_source_port_def</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">sched_current_lemma</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">                
</span><span class="">            </span><span class="keyword1">with</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">d3</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = t&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">write_sampling_message_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">            </span><span class="keyword1">with</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">assume</span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class="string">&quot;&#172;(&#172; is_a_samplingport s pid 
                        &#8744; &#172; is_source_port s pid
                        &#8744; &#172; is_a_port_of_partition s pid (current s))&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">with</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class="string">&quot;part_ports s&#39; = part_ports s&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Int_absorb</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">empty_iff</span><span class=""> </span><span class="">is_a_port_of_partition_def</span><span class=""> 
</span><span class="">                </span><span class="">option.distinct</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">port_consistent_def</span><span class=""> </span><span class="">port_partition</span><span class="delimiter">)</span><span class="">  
</span><span class="">            
</span><span class="">            </span><span class="keyword1">with</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">e2</span><span class="delimiter">:</span><span class="string">&quot;part_ports t&#39; = part_ports t&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Int_absorb</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">empty_iff</span><span class=""> </span><span class="">is_a_port_of_partition_def</span><span class=""> 
</span><span class="">                </span><span class="">option.distinct</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">port_consistent_def</span><span class=""> </span><span class="">port_partition</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1">have</span><span class=""> </span><span class="">f1</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = update_sampling_port_msg s pid m&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">write_sampling_message_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1">have</span><span class=""> </span><span class="">f2</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = update_sampling_port_msg t pid m&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">is_a_port_of_partition_def</span><span class=""> </span><span class="">is_a_samplingport_def</span><span class=""> 
</span><span class="">                </span><span class="">is_source_port_def</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">sched_current_lemma</span><span class=""> </span><span class="">write_sampling_message_def</span><span class="">
</span><span class="">                </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">               
</span><span class="">            </span><span class="keyword1">with</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">e5</span><span class="delimiter">:</span><span class="string">&quot;ports (comm s&#39;) = ports (comm t&#39;)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;(ports (comm s)) pid&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3">case</span><span class=""> </span><span class="">None</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">None.hyps</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="">f2</span><span class=""> </span><span class="">update_sampling_port_msg_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">              </span><span class="keyword1">next</span><span class="">
</span><span class="">                </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Some</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">                  </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;the (ports (comm s) pid)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Queuing</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class=""> </span><span class="">x5</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">                        </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Port_Type.simps</span><span class="delimiter">(</span><span class="">5</span><span class="delimiter">)</span><span class=""> </span><span class="">Queuing.hyps</span><span class=""> </span><span class="">Some.hyps</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="">f2</span><span class=""> 
</span><span class="">                            </span><span class="">option.sel</span><span class=""> </span><span class="">option.simps</span><span class="delimiter">(</span><span class="">5</span><span class="delimiter">)</span><span class=""> </span><span class="">update_sampling_port_msg_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">next</span><span class="">
</span><span class="">                    </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Sampling</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">                        </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Communication_State.surjective</span><span class=""> </span><span class="">Communication_State.update_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="">
</span><span class="">                          </span><span class="">Port_Type.simps</span><span class="delimiter">(</span><span class="">6</span><span class="delimiter">)</span><span class=""> </span><span class="">Sampling.hyps</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">State.surjective</span><span class=""> 
</span><span class="">                          </span><span class="">State.update_convs</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="">f2</span><span class=""> </span><span class="">option.case_eq_if</span><span class=""> </span><span class="">update_sampling_port_msg_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">qed</span><span class="">
</span><span class="">              </span><span class="keyword1">qed</span><span class="">
</span><span class="">            </span><span class="keyword1">with</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">e2</span><span class=""> </span><span class="">e5</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">sched_current_lemma</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">          </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">}</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">wrt_smpl_msg_presrv_comm_of_current_part</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class="">   </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s &#8743; reachable0 t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; (scheduler sysconf) &#8764; t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (write_sampling_message s pid m)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = fst (write_sampling_message t pid m)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p5</span><span class="delimiter">:</span><span class="string">&quot;(current s) = d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p6</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part_comm s d t&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p7</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;vpeq_part_comm s&#39; d t&#39;&quot;</span><span class="">    
</span><span class="">    </span><span class="keyword1">proof</span><span class="">-</span><span class="">      
</span><span class="">      </span><span class="keyword1">from</span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;get_ports_of_partition s d = get_ports_of_partition t d&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">from</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class="string">&quot;current s = current t&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">  
</span><span class="">      </span><span class="keyword1">from</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class="string">&quot;part_ports s = part_ports s&#39;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">wrt_smpl_msg_notchg_partports</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a4</span><span class="delimiter">:</span><span class="string">&quot;get_ports_of_partition s d = get_ports_of_partition s&#39; d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">using</span><span class=""> </span><span class="">part_ports_imp_portofpart</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">      </span><span class="keyword1">from</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a5</span><span class="delimiter">:</span><span class="string">&quot;part_ports t = part_ports t&#39;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">wrt_smpl_msg_notchg_partports</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a6</span><span class="delimiter">:</span><span class="string">&quot;get_ports_of_partition t d = get_ports_of_partition t&#39; d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">using</span><span class=""> </span><span class="">part_ports_imp_portofpart</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="">g0</span><span class="delimiter">:</span><span class="string">&quot;get_ports_of_partition s&#39; d = get_ports_of_partition t&#39; d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="">a6</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class=""> 
</span><span class="">      </span><span class="keyword1">moreover</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8704;p. p &#8712; get_ports_of_partition s&#39; d &#10230;
                is_a_queuingport s&#39; p = is_a_queuingport t&#39; p &#8743;
                is_dest_port s&#39; p = is_dest_port t&#39; p &#8743;
                (if is_dest_port s&#39; p then get_port_buf_size s&#39; p = get_port_buf_size t&#39; p else True)&quot;</span><span class=""> 
</span><span class="">       </span><span class="keyword1">using</span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class="">  </span><span class="">empty_iff</span><span class=""> </span><span class="">inf.idem</span><span class=""> </span><span class="">no_cfgport_impl_noports</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">port_partition</span><span class="delimiter">)</span><span class=""> 
</span><span class="">       </span><span class="keyword1">ultimately</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">   </span><span class="keyword1">qed</span><span class="">
</span><span class="">   
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">wrt_smpl_msg_presrv_wk_stp_cons</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s &#8743; reachable0 t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; d &#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; (scheduler sysconf) &#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p5</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8605; d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p6</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; (current s) &#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p7</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (write_sampling_message s pid m)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p8</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = fst (write_sampling_message t pid m)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s&#39; &#8764; d &#8764; t&#39;&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_scheduler sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;is_a_scheduler sysconf d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">interference1_def</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">sche_imp_not_part</span><span class="delimiter">)</span><span class="">  
</span><span class="">    </span><span class="keyword1">next</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_scheduler sysconf d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">          </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> 
</span><span class="">            </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;current s = d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;current s = d&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part s&#39; d t&#39;&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                </span><span class="keyword1">{</span><span class="">
</span><span class="">                  </span><span class="keyword1">have</span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class="string">&quot;partitions s&#39; d = partitions t&#39; d&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class=""> 
</span><span class="">                    </span><span class="keyword1">{</span><span class="">
</span><span class="">                      </span><span class="keyword1">from</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">f1</span><span class="delimiter">:</span><span class="string">&quot;partitions s d = partitions t d&quot;</span><span class=""> 
</span><span class="">                        </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">part_imp_not_tras</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">                      </span><span class="keyword1">from</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">f2</span><span class="delimiter">:</span><span class="string">&quot;partitions s d = partitions s&#39; d&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">wrt_smpl_msg_notchg_partstate</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                      </span><span class="keyword1">from</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">f3</span><span class="delimiter">:</span><span class="string">&quot;partitions t d = partitions t&#39; d&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">wrt_smpl_msg_notchg_partstate</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">sched_current_lemma</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                      </span><span class="keyword1">with</span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="">f2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;partitions s&#39; d = partitions t&#39; d&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1">}</span><span class="">
</span><span class="">                    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1">qed</span><span class="">
</span><span class="">                  </span><span class="keyword1">have</span><span class=""> </span><span class="">e2</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part_comm s&#39; d t&#39;&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                    </span><span class="keyword1">{</span><span class="">
</span><span class="">                      </span><span class="keyword1">from</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">f1</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part_comm s d t&quot;</span><span class=""> 
</span><span class="">                        </span><span class="keyword1">using</span><span class="">  </span><span class="">part_imp_not_tras</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">                      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;vpeq_part_comm s&#39; d t&#39;&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1">using</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">wrt_smpl_msg_presrv_comm_of_current_part</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">                        
</span><span class="">                    </span><span class="keyword1">}</span><span class="">
</span><span class="">                    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1">qed</span><span class="">
</span><span class="">                  </span><span class="keyword1">with</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;vpeq_part s&#39; d t&#39;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">vpeq_part_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1">}</span><span class="">
</span><span class="">                </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1">qed</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c0</span><span class="">                 
</span><span class="">                </span><span class="keyword1">using</span><span class=""> </span><span class="">trans_imp_not_part</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">                
</span><span class="">            </span><span class="keyword1">next</span><span class="">
</span><span class="">              </span><span class="keyword3">assume</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;current s &#8800; d&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part s&#39; d t&#39;&quot;</span><span class=""> 
</span><span class="">                </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                </span><span class="keyword1">{</span><span class="">
</span><span class="">                  </span><span class="keyword1">have</span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class="string">&quot;partitions s&#39; d = partitions t&#39; d&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class="">  </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">p8</span><span class=""> 
</span><span class="">                    </span><span class="">part_not_trans</span><span class="">  </span><span class="">wrt_smpl_msg_notchg_partstate</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">                    
</span><span class="">                  </span><span class="keyword1">have</span><span class=""> </span><span class="">e2</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part_comm s&#39; d t&#39;&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                      </span><span class="keyword1">from</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">f1</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part_comm s d t&quot;</span><span class=""> 
</span><span class="">                        </span><span class="keyword1">using</span><span class=""> </span><span class="">part_imp_not_tras</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">                      </span><span class="keyword1">have</span><span class=""> </span><span class="">f2</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part_comm s d s&#39;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">wrt_smpl_msg_notchg_comminotherdom</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                      </span><span class="keyword1">have</span><span class=""> </span><span class="">f3</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part_comm t d t&#39;&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1">using</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">sched_current_lemma</span><span class=""> </span><span class="">wrt_smpl_msg_notchg_comminotherdom</span><span class="">
</span><span class="">                          </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">                      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                        </span><span class="keyword1">using</span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="">f2</span><span class=""> </span><span class="">vpeq_part_comm_symmetric_lemma</span><span class=""> </span><span class="">vpeq_part_comm_transitive_lemma</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">                    </span><span class="keyword1">qed</span><span class="">                    
</span><span class="">                 </span><span class="keyword1">with</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;vpeq_part s&#39; d t&#39;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">vpeq_part_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1">}</span><span class="">
</span><span class="">                </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1">qed</span><span class="">
</span><span class="">              </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c1</span><span class="">                            
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">trans_imp_not_part</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">              
</span><span class="">            </span><span class="keyword1">qed</span><span class="">
</span><span class="">        </span><span class="keyword1">next</span><span class="">
</span><span class="">          </span><span class="keyword3">assume</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">          </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_transmitter sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;is_a_transmitter sysconf d&quot;</span><span class="">
</span><span class="">            </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">              </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">              </span><span class="keyword1">{</span><span class="">
</span><span class="">                </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;vpeq_transmitter s&#39; d t&#39;&quot;</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">vpeq_transmitter_def</span><span class="">
</span><span class="">                </span><span class="keyword1">proof</span><span class="">-</span><span class="">
</span><span class="">                  </span><span class="keyword1">from</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">p8</span><span class="">
</span><span class="">                  </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;comm s&#39; = comm t&#39; &#8743; part_ports s&#39; = part_ports t&#39; &quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1">using</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">wrt_smpl_msg_presrv_comm_part_ports</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">_</span><span class=""> </span><span class="">p4</span><span class="delimiter">]</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1">qed</span><span class="">
</span><span class="">              </span><span class="keyword1">}</span><span class="">
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1">qed</span><span class="">
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">assume</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_transmitter sysconf d&quot;</span><span class="">
</span><span class="">            </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">is_a_scheduler_def</span><span class=""> </span><span class="">is_a_transmitter_def</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">qed</span><span class="">
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">wrt_smpl_msg_presrv_wk_stp_cons_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;weak_step_consistent_e (hyperc (Write_Sampling_Message p m))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">wrt_smpl_msg_presrv_wk_stp_cons</span><span class=""> </span><span class="">weak_step_consistent_e_def</span><span class=""> </span><span class="">exec_event_def</span><span class=""> </span><span class="">mem_Collect_eq</span><span class="">
</span><span class="">       </span><span class="">non_interference_def</span><span class=""> </span><span class="">singletonD</span><span class=""> </span><span class="">sched_vpeq</span><span class=""> </span><span class="">same_part_mode</span><span class="">
</span><span class="">        </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Event.case</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Hypercall.case</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">domain_of_event.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">event_enabled.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">option.sel</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;read sampling message&quot; satisfying the &quot;step consistent&quot; property*}</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">read_smpl_msg_presrv_wk_stp_cons</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; d &#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (read_sampling_message s pid)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = fst (read_sampling_message t pid)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s&#39; &#8764; d &#8764; t&#39;&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = s&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">read_sampling_message_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = t&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">read_sampling_message_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">  
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">read_smpl_msg_presrv_wk_stp_cons_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;weak_step_consistent_e (hyperc (Read_Sampling_Message p))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">read_smpl_msg_presrv_wk_stp_cons</span><span class=""> </span><span class="">weak_step_consistent_e_def</span><span class=""> </span><span class="">exec_event_def</span><span class=""> </span><span class="">mem_Collect_eq</span><span class="">
</span><span class="">      </span><span class="">non_interference1_def</span><span class=""> </span><span class="">non_interference_def</span><span class=""> </span><span class="">singletonD</span><span class=""> </span><span class="">sched_vpeq</span><span class=""> </span><span class="">same_part_mode</span><span class="">
</span><span class="">        </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Event.case</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Hypercall.case</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">domain_of_event.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="">event_enabled.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">option.sel</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;get sampling portid&quot; satisfying the &quot;step consistent&quot; property*}</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_smpl_pid_presrv_wk_stp_cons</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; d &#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (get_sampling_port_id sysconf s pname)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = fst (get_sampling_port_id sysconf t pname)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s&#39; &#8764; d &#8764; t&#39;&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = s&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">get_sampling_port_id_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = t&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">get_sampling_port_id_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">  
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_smpl_pid_presrv_wk_stp_cons_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;weak_step_consistent_e (hyperc (Get_Sampling_Portid p))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">get_smpl_pid_presrv_wk_stp_cons</span><span class=""> </span><span class="">weak_step_consistent_e_def</span><span class=""> </span><span class="">exec_event_def</span><span class=""> </span><span class="">mem_Collect_eq</span><span class="">
</span><span class="">       </span><span class="">non_interference_def</span><span class=""> </span><span class="">singletonD</span><span class=""> </span><span class="">sched_vpeq</span><span class=""> </span><span class="">same_part_mode</span><span class="">
</span><span class="">        </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Event.case</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Hypercall.case</span><span class="delimiter">(</span><span class="">4</span><span class="delimiter">)</span><span class=""> </span><span class="">domain_of_event.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="">event_enabled.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">option.sel</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;get sampling port status&quot; satisfying the &quot;step consistent&quot; property*}</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_smpl_psts_presrv_wk_stp_cons</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; d &#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (get_sampling_port_status sysconf s pid)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = fst (get_sampling_port_status sysconf t pid)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s&#39; &#8764; d &#8764; t&#39;&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = s&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">get_sampling_port_status_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = t&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">get_sampling_port_status_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">  
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_smpl_psts_presrv_wk_stp_cons_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;weak_step_consistent_e (hyperc (Get_Sampling_Portstatus p))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">get_smpl_psts_presrv_wk_stp_cons</span><span class=""> </span><span class="">weak_step_consistent_e_def</span><span class=""> </span><span class="">exec_event_def</span><span class=""> </span><span class="">mem_Collect_eq</span><span class="">
</span><span class="">       </span><span class="">non_interference_def</span><span class=""> </span><span class="">singletonD</span><span class=""> </span><span class="">sched_vpeq</span><span class=""> </span><span class="">same_part_mode</span><span class="">
</span><span class="">        </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Event.case</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Hypercall.case</span><span class="delimiter">(</span><span class="">5</span><span class="delimiter">)</span><span class=""> </span><span class="">domain_of_event.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">event_enabled.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="">option.sel</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="">vpeq_sched_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;create queuing port&quot; satisfying the &quot;step consistent&quot; property*}</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">crt_que_port_presrv_comm_part_ports</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="keyword2">assumes</span><span class="">   </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s &#8743; reachable0 t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; (transmitter sysconf) &#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p5</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; (scheduler sysconf) &#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (create_queuing_port sysconf s pname)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = fst (create_queuing_port sysconf t pname)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;comm s&#39; = comm t&#39; &#8743; part_ports s&#39; = part_ports t&#39;&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1">{</span><span class="">
</span><span class="">        </span><span class="keyword1">from</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;vpeq_transmitter s (transmitter sysconf) t&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">sch_not_trans</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;comm s = comm t &#8743; part_ports s = part_ports t&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1">from</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class="string">&quot;port_consistent s &#8743; port_consistent t&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">port_cons_reach_state</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;get_queuingport_conf sysconf pname = None 
                         &#8744; get_portid_by_name s pname &#8800; None
                         &#8744; pname &#8713; get_partition_cfg_ports_byid sysconf (current s)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3">assume</span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class="string">&quot;get_queuingport_conf sysconf pname = None 
                         &#8744; get_portid_by_name s pname &#8800; None
                         &#8744; pname &#8713; get_partition_cfg_ports_byid sysconf (current s)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">with</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = s&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">create_queuing_port_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1">have</span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class="string">&quot;get_queuingport_conf sysconf pname = None 
                         &#8744; get_portid_by_name t pname &#8800; None
                         &#8744; pname &#8713; get_partition_cfg_ports_byid sysconf (current t)&quot;</span><span class="">
</span><span class="">                         </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">disjoint_iff_not_equal</span><span class=""> </span><span class="">port_partition</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1">with</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">d3</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = t&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">create_queuing_port_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">            </span><span class="keyword1">with</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword1">let</span><span class=""> </span><span class="var">?nid</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;get_portid_in_type (the (get_queuingport_conf sysconf pname))&quot;</span><span class="">
</span><span class="">            </span><span class="keyword3">assume</span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class="string">&quot;&#172;(get_queuingport_conf sysconf pname = None 
                         &#8744; get_portid_by_name s pname &#8800; None
                         &#8744; pname &#8713; get_partition_cfg_ports_byid sysconf (current s))&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">with</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class="string">&quot;part_ports s&#39; = (part_ports s)(?nid:= (Some (current s)))&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">            </span><span class="keyword1">with</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">e2</span><span class="delimiter">:</span><span class="string">&quot;part_ports t&#39; = (part_ports t)(?nid := (Some (current t)))&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">            </span><span class="keyword1">with</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">e3</span><span class="delimiter">:</span><span class="string">&quot;ports (comm s&#39;) = (ports (comm s))(?nid := get_queuingport_conf sysconf pname)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1">with</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">e4</span><span class="delimiter">:</span><span class="string">&quot;ports (comm t&#39;) = (ports (comm t))(?nid := get_queuingport_conf sysconf pname)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1">with</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">e2</span><span class=""> </span><span class="">e3</span><span class=""> </span><span class="">e4</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">sched_current_lemma</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">}</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">crt_que_port_presrv_comm_of_current_part</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="keyword2">assumes</span><span class="">   </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s &#8743; reachable0 t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; (scheduler sysconf) &#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (create_queuing_port sysconf s pname)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = fst (create_queuing_port sysconf t pname)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p5</span><span class="delimiter">:</span><span class="string">&quot;(current s) = d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p6</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part_comm s d t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p7</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;vpeq_part_comm s&#39; d t&#39;&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class="delimiter">,</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1">{</span><span class="">
</span><span class="">        </span><span class="keyword1">from</span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;get_ports_of_partition s d = get_ports_of_partition t d&quot;</span><span class=""> 
</span><span class="">           </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1">from</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class="string">&quot;current s = current t&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">sched_current_lemma</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">               
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="">g0</span><span class="delimiter">:</span><span class="string">&quot;get_ports_of_partition s&#39; d = get_ports_of_partition t&#39; d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">        </span><span class="keyword1">{</span><span class="">
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8704;p. p&#8712;get_ports_of_partition s&#39; d &#10230; p&#8712;get_ports_of_partition t&#39; d&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">proof</span><span class="">-</span><span class="">
</span><span class="">            </span><span class="keyword1">{</span><span class="">
</span><span class="">              </span><span class="keyword3">fix</span><span class=""> </span><span class="">p</span><span class="">
</span><span class="">              </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;p&#8712;get_ports_of_partition s&#39; d&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class="string">&quot;p&#8712;get_ports_of_partition t&#39; d&quot;</span><span class="">
</span><span class="">                 </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;pname &#8712; get_partition_cfg_ports_byid sysconf (current s)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;pname &#8712; get_partition_cfg_ports_byid sysconf (current s)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1">with</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;pname &#8712; get_partition_cfg_ports_byid sysconf (current t)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1">have</span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class="string">&quot;p &#8800; get_portid_in_type (the (get_queuingport_conf sysconf pname))&quot;</span><span class=""> 
</span><span class="">                    </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                </span><span class="keyword1">next</span><span class="">
</span><span class="">                  </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;&#172;(pname &#8712; get_partition_cfg_ports_byid sysconf (current s))&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1">with</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;&#172;(pname &#8712; get_partition_cfg_ports_byid sysconf (current t))&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1">have</span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = s&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">create_queuing_port_def</span><span class=""> </span><span class="">p3</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1">have</span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = t&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">create_queuing_port_def</span><span class=""> </span><span class="">p4</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">  
</span><span class="">                </span><span class="keyword1">qed</span><span class="">
</span><span class="">            </span><span class="keyword1">}</span><span class="">
</span><span class="">            </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1">qed</span><span class="">
</span><span class="">          </span><span class="keyword1">moreover</span><span class="">
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8704;p. p&#8712;get_ports_of_partition t&#39; d &#10230; p&#8712;get_ports_of_partition s&#39; d&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">proof</span><span class="">-</span><span class="">
</span><span class="">            </span><span class="keyword1">{</span><span class="">
</span><span class="">              </span><span class="keyword3">fix</span><span class=""> </span><span class="">p</span><span class="">
</span><span class="">              </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;p&#8712;get_ports_of_partition t&#39; d&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class="string">&quot;p&#8712;get_ports_of_partition s&#39; d&quot;</span><span class="">
</span><span class="">                 </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;pname &#8712; get_partition_cfg_ports_byid sysconf (current s)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;pname &#8712; get_partition_cfg_ports_byid sysconf (current s)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1">with</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;pname &#8712; get_partition_cfg_ports_byid sysconf (current t)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1">have</span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class="string">&quot;p &#8800; get_portid_in_type (the (get_queuingport_conf sysconf pname))&quot;</span><span class=""> 
</span><span class="">                    </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                </span><span class="keyword1">next</span><span class="">
</span><span class="">                  </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;&#172;(pname &#8712; get_partition_cfg_ports_byid sysconf (current s))&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1">with</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;&#172;(pname &#8712; get_partition_cfg_ports_byid sysconf (current t))&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1">have</span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = s&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">create_queuing_port_def</span><span class=""> </span><span class="">p3</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1">have</span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = t&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">create_queuing_port_def</span><span class=""> </span><span class="">p4</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">  
</span><span class="">                </span><span class="keyword1">qed</span><span class="">
</span><span class="">            </span><span class="keyword1">}</span><span class="">
</span><span class="">            </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1">qed</span><span class="">
</span><span class="">          </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">calculation</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">        </span><span class="keyword1">}</span><span class="">
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword1">from</span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;get_ports_of_partition s d = get_ports_of_partition t d&quot;</span><span class=""> 
</span><span class="">            </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1">from</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class="string">&quot;current s = current t&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">sched_current_lemma</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">     
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;&#8704;p. (is_dest_port s&#39; p &#10230;
         p &#8712; get_ports_of_partition s&#39; d &#10230;
         is_a_queuingport s&#39; p = is_a_queuingport t&#39; p &#8743; is_dest_port t&#39; p &#8743; get_port_buf_size s&#39; p = get_port_buf_size t&#39; p) &#8743;
        (&#172; is_dest_port s&#39; p &#10230;
         p &#8712; get_ports_of_partition s&#39; d &#10230; is_a_queuingport s&#39; p = is_a_queuingport t&#39; p &#8743; &#172; is_dest_port t&#39; p) &quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">          </span><span class="keyword1">{</span><span class="">
</span><span class="">            </span><span class="keyword3">fix</span><span class=""> </span><span class="">p</span><span class="">
</span><span class="">            </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;(is_dest_port s&#39; p &#10230;
               p &#8712; get_ports_of_partition s&#39; d &#10230;
               is_a_queuingport s&#39; p = is_a_queuingport t&#39; p &#8743; is_dest_port t&#39; p &#8743; get_port_buf_size s&#39; p = get_port_buf_size t&#39; p) &#8743;
              (&#172; is_dest_port s&#39; p &#10230;
               p &#8712; get_ports_of_partition s&#39; d &#10230; is_a_queuingport s&#39; p = is_a_queuingport t&#39; p &#8743; &#172; is_dest_port t&#39; p)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;pname &#8712; get_partition_cfg_ports_byid sysconf (current s)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;pname &#8712; get_partition_cfg_ports_byid sysconf (current s)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">with</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;pname &#8712; get_partition_cfg_ports_byid sysconf (current t)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1">have</span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class="string">&quot;p &#8800; get_portid_in_type (the (get_queuingport_conf sysconf pname))&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">port_partition</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">              </span><span class="keyword1">next</span><span class="">
</span><span class="">                </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;&#172;(pname &#8712; get_partition_cfg_ports_byid sysconf (current s))&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">with</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;&#172;(pname &#8712; get_partition_cfg_ports_byid sysconf (current t))&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1">have</span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = s&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">create_queuing_port_def</span><span class=""> </span><span class="">p3</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1">have</span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = t&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">create_queuing_port_def</span><span class=""> </span><span class="">p4</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">p6</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">   
</span><span class="">              </span><span class="keyword1">qed</span><span class="">
</span><span class="">          </span><span class="keyword1">}</span><span class="">
</span><span class="">          </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">}</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">crt_que_port_presrv_wk_stp_cons</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s &#8743; reachable0 t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; d &#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; (scheduler sysconf) &#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p5</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8605; d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p6</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; (current s) &#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p7</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (create_queuing_port sysconf s pname)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p8</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = fst (create_queuing_port sysconf t pname)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s&#39; &#8764; d &#8764; t&#39;&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_scheduler sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;is_a_scheduler sysconf d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">interference1_def</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">sche_imp_not_part</span><span class="delimiter">)</span><span class="">  
</span><span class="">  </span><span class="keyword1">next</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_scheduler sysconf d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> 
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;current s = d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;current s = d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part s&#39; d t&#39;&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">        </span><span class="keyword1">{</span><span class="">
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class="string">&quot;partitions s&#39; d = partitions t&#39; d&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class=""> 
</span><span class="">          </span><span class="keyword1">{</span><span class="">
</span><span class="">            </span><span class="keyword1">from</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">f1</span><span class="delimiter">:</span><span class="string">&quot;partitions s d = partitions t d&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">is_a_scheduler_def</span><span class=""> </span><span class="">is_a_transmitter_def</span><span class=""> 
</span><span class="">              </span><span class="">part_imp_not_tras</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="">vpeq_part_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">            </span><span class="keyword1">from</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">f2</span><span class="delimiter">:</span><span class="string">&quot;partitions s d = partitions s&#39; d&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">crt_que_port_notchg_partstate</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1">from</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">f3</span><span class="delimiter">:</span><span class="string">&quot;partitions t d = partitions t&#39; d&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">crt_que_port_notchg_partstate</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">sched_current_lemma</span><span class=""> 
</span><span class="">              </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1">with</span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="">f2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;partitions s&#39; d = partitions t&#39; d&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">}</span><span class=""> </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">qed</span><span class="">
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="">e2</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part_comm s&#39; d t&#39;&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">          </span><span class="keyword1">{</span><span class="">
</span><span class="">            </span><span class="keyword1">from</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">f1</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part_comm s d t&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">part_imp_not_tras</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">            </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;vpeq_part_comm s&#39; d t&#39;&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">crt_que_port_presrv_comm_of_current_part</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">                        
</span><span class="">          </span><span class="keyword1">}</span><span class=""> </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> </span><span class="keyword1">qed</span><span class="">
</span><span class="">          </span><span class="keyword1">with</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;vpeq_part s&#39; d t&#39;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1">}</span><span class=""> </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> </span><span class="keyword1">qed</span><span class="">
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class="">                              
</span><span class="">          </span><span class="keyword1">using</span><span class="">  </span><span class="">trans_imp_not_part</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">                
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;current s &#8800; d&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part s&#39; d t&#39;&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">        </span><span class="keyword1">{</span><span class="">
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class="string">&quot;partitions s&#39; d = partitions t&#39; d&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">crt_que_port_notchg_partstate</span><span class="">
</span><span class="">             </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">part_not_trans</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="">e2</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part_comm s&#39; d t&#39;&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">part_imp_not_sch</span><span class=""> </span><span class="">part_imp_not_tras</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">                   
</span><span class="">         </span><span class="keyword1">with</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;vpeq_part s&#39; d t&#39;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1">}</span><span class="">
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> </span><span class="keyword1">qed</span><span class="">
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">trans_imp_not_part</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">              
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">next</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_transmitter sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;is_a_transmitter sysconf d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;vpeq_transmitter s&#39; d t&#39;&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">crt_que_port_presrv_comm_part_ports</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">p2</span><span class="delimiter">]</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">                               
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">is_a_scheduler_def</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">              
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_transmitter sysconf d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c1</span><span class="">  </span><span class="">is_a_transmitter_def</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">crt_que_port_presrv_wk_stp_cons_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;weak_step_consistent_e (hyperc (Create_Queuing_Port p))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">crt_que_port_presrv_wk_stp_cons</span><span class=""> </span><span class="">weak_step_consistent_e_def</span><span class=""> </span><span class="">exec_event_def</span><span class=""> </span><span class="">mem_Collect_eq</span><span class="">
</span><span class="">      </span><span class="">non_interference1_def</span><span class=""> </span><span class="">non_interference_def</span><span class=""> </span><span class="">singletonD</span><span class=""> </span><span class="">sched_vpeq</span><span class=""> </span><span class="">same_part_mode</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Event.case</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Hypercall.case</span><span class="delimiter">(</span><span class="">6</span><span class="delimiter">)</span><span class=""> </span><span class="">domain_of_event.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">event_enabled.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">option.sel</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;send queuing message&quot; satisfying the &quot;step consistent&quot; property*}</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">snd_que_msg_lst_presrv_comm_part_ports</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="keyword2">assumes</span><span class="">   </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s &#8743; reachable0 t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; (transmitter sysconf) &#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p5</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; (scheduler sysconf) &#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (send_queuing_message_maylost sysconf s pid m)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = fst (send_queuing_message_maylost sysconf t pid m)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;comm s&#39; = comm t&#39; &#8743; part_ports s&#39; = part_ports t&#39;&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1">{</span><span class="">
</span><span class="">    </span><span class="keyword1">from</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;vpeq_transmitter s (transmitter sysconf) t&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">sch_not_trans</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;comm s = comm t &#8743; part_ports s = part_ports t&quot;</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">vpeq_transmitter_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1">from</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class="string">&quot;port_consistent s &#8743; port_consistent t&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">port_cons_reach_state</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;&#172; is_a_queuingport s pid
              &#8744; &#172; is_source_port s pid
              &#8744; &#172; is_a_port_of_partition s pid (current s)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_queuingport s pid
              &#8744; &#172; is_source_port s pid
              &#8744; &#172; is_a_port_of_partition s pid (current s)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">with</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = s&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">send_queuing_message_maylost_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_queuingport t pid
              &#8744; &#172; is_source_port t pid 
              &#8744; &#172; is_a_port_of_partition t pid (current t)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">is_a_port_of_partition_def</span><span class=""> </span><span class="">is_a_queuingport_def</span><span class=""> 
</span><span class="">              </span><span class="">is_source_port_def</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">sched_current_lemma</span><span class="">
</span><span class="">              </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="">vpeq_sched_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1">with</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = t&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">send_queuing_message_maylost_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">      </span><span class="keyword1">with</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1">next</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;&#172;(&#172; is_a_queuingport s pid 
                &#8744; &#172; is_source_port s pid
                &#8744; &#172; is_a_port_of_partition s pid (current s))&quot;</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_full_portqueuing sysconf s pid&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;is_full_portqueuing sysconf s pid&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">with</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = s&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">replace_msg2queuing_port_def</span><span class=""> 
</span><span class="">                                    </span><span class="">send_queuing_message_maylost_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1">with</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class="string">&quot;is_full_portqueuing sysconf t pid&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">get_port_conf_byid_def</span><span class=""> </span><span class="">get_port_byid_def</span><span class=""> </span><span class="">is_full_portqueuing_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = t&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">replace_msg2queuing_port_def</span><span class=""> 
</span><span class="">                                    </span><span class="">send_queuing_message_maylost_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1">with</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_full_portqueuing sysconf s pid&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = insert_msg2queuing_port s pid m&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1">using</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">send_queuing_message_maylost_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">        </span><span class="keyword1">with</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_full_portqueuing sysconf t pid&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">get_port_conf_byid_def</span><span class=""> </span><span class="">get_port_byid_def</span><span class=""> </span><span class="">is_full_portqueuing_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = insert_msg2queuing_port t pid m&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1">using</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">send_queuing_message_maylost_def</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">is_a_port_of_partition_def</span><span class=""> 
</span><span class="">            </span><span class="">is_a_queuingport_def</span><span class=""> </span><span class="">is_source_port_def</span><span class=""> </span><span class="">old.prod.inject</span><span class=""> </span><span class="">p5</span><span class=""> 
</span><span class="">            </span><span class="">prod.collapse</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="">vpeq_sched_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1">with</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;(ports (comm s)) pid&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3">case</span><span class=""> </span><span class="">None</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">None.hyps</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">insert_msg2queuing_port_def</span><span class=""> </span><span class="">option.case_eq_if</span><span class="delimiter">)</span><span class="">   
</span><span class="">        </span><span class="keyword1">next</span><span class="">
</span><span class="">          </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Some</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class="string">&quot;(ports (comm s)) pid = Some x&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Some.hyps</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;the ((ports (comm s)) pid)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Queuing</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class=""> </span><span class="">x5</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">              </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Communication_State.surjective</span><span class=""> </span><span class="">Communication_State.update_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="">Port_Type.simps</span><span class="delimiter">(</span><span class="">5</span><span class="delimiter">)</span><span class=""> </span><span class="">Queuing.hyps</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">4</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="">State.surjective</span><span class=""> </span><span class="">State.update_convs</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">insert_msg2queuing_port_def</span><span class=""> 
</span><span class="">                </span><span class="">option.case_eq_if</span><span class="delimiter">)</span><span class="">    
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Sampling</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">Sampling.hyps</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">insert_msg2queuing_port_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">  
</span><span class="">          </span><span class="keyword1">qed</span><span class="">
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">  </span><span class="keyword1">}</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">is_dest_queuing_send</span><span class="delimiter">:</span><span class="">
</span><span class="">   </span><span class="string">&quot;t&#39; = fst (send_queuing_message_maylost sysconf t pid m) &#10233;       
   (is_dest_port t p = is_dest_port t&#39; p) &#8743; (is_a_queuingport t p = is_a_queuingport t&#39; p)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">send_queuing_message_maylost_def</span><span class=""> </span><span class="">replace_msg2queuing_port_def</span><span class=""> </span><span class="">insert_msg2queuing_port_def</span><span class="delimiter">)</span><span class="">    
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;ports (comm t) pid&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;a&quot;</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">is_a_queuingport_def</span><span class=""> </span><span class="">is_dest_port_def</span><span class="">               
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">snd_que_msg_lst_presrv_comm_of_current_part</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class="">   </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s &#8743; reachable0 t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; (scheduler sysconf) &#8764; t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (send_queuing_message_maylost sysconf s pid m)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = fst (send_queuing_message_maylost sysconf t pid m)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p5</span><span class="delimiter">:</span><span class="string">&quot;(current s) = d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p6</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part_comm s d t&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p7</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;vpeq_part_comm s&#39; d t&#39;&quot;</span><span class="">  
</span><span class="">  </span><span class="keyword1">proof</span><span class="">-</span><span class="">  
</span><span class="">    </span><span class="keyword1">from</span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;get_ports_of_partition s d = get_ports_of_partition t d&quot;</span><span class=""> 
</span><span class="">       </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1">from</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class="string">&quot;current s = current t&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">sched_current_lemma</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">  
</span><span class="">    </span><span class="keyword1">from</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class="string">&quot;part_ports s = part_ports s&#39;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">snd_que_msg_lst_notchg_partports</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a4</span><span class="delimiter">:</span><span class="string">&quot;get_ports_of_partition s d = get_ports_of_partition s&#39; d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">using</span><span class=""> </span><span class="">part_ports_imp_portofpart</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">    </span><span class="keyword1">from</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a5</span><span class="delimiter">:</span><span class="string">&quot;part_ports t = part_ports t&#39;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">snd_que_msg_lst_notchg_partports</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a6</span><span class="delimiter">:</span><span class="string">&quot;get_ports_of_partition t d = get_ports_of_partition t&#39; d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">using</span><span class=""> </span><span class="">part_ports_imp_portofpart</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">    </span><span class="keyword1">have</span><span class=""> </span><span class="">g0</span><span class="delimiter">:</span><span class="string">&quot;get_ports_of_partition s&#39; d = get_ports_of_partition t&#39; d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="">a6</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class=""> 
</span><span class="">    </span><span class="keyword1">moreover</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8704;p. p &#8712; get_ports_of_partition s&#39; d &#10230;
              is_a_queuingport s&#39; p = is_a_queuingport t&#39; p &#8743;
              is_dest_port s&#39; p = is_dest_port t&#39; p &#8743;
              (if is_dest_port s&#39; p then get_port_buf_size s&#39; p = get_port_buf_size t&#39; p else True)&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class="">  </span><span class="">empty_iff</span><span class=""> </span><span class="">inf.idem</span><span class=""> </span><span class="">no_cfgport_impl_noports</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">port_partition</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword1">ultimately</span><span class=""> </span><span class="keyword3">show</span><span class="">  </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">  
</span><span class="">
</span><span class=""> </span><span class="keyword1">lemma</span><span class=""> </span><span class="">snd_que_msg_lst_presrv_wk_stp_cons</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s &#8743; reachable0 t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; d &#8764; t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; (scheduler sysconf) &#8764; t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p5</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8605; d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p6</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; (current s) &#8764; t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p7</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (send_queuing_message_maylost sysconf s pid m)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p8</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = fst (send_queuing_message_maylost sysconf t pid m)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s&#39; &#8764; d &#8764; t&#39;&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_scheduler sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;is_a_scheduler sysconf d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">interference1_def</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">sche_imp_not_part</span><span class="delimiter">)</span><span class="">  
</span><span class="">  </span><span class="keyword1">next</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_scheduler sysconf d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> 
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;current s = d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;current s = d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part s&#39; d t&#39;&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">        </span><span class="keyword1">{</span><span class="">
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class="string">&quot;partitions s&#39; d = partitions t&#39; d&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class=""> 
</span><span class="">          </span><span class="keyword1">{</span><span class="">
</span><span class="">            </span><span class="keyword1">from</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">f1</span><span class="delimiter">:</span><span class="string">&quot;partitions s d = partitions t d&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">part_imp_not_tras</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">            </span><span class="keyword1">from</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">f2</span><span class="delimiter">:</span><span class="string">&quot;partitions s d = partitions s&#39; d&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">snd_que_msg_lst_notchg_partstate</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1">from</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">f3</span><span class="delimiter">:</span><span class="string">&quot;partitions t d = partitions t&#39; d&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">sched_current_lemma</span><span class=""> </span><span class="">snd_que_msg_lst_notchg_partstate</span><span class=""> 
</span><span class="">              </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1">with</span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="">f2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;partitions s&#39; d = partitions t&#39; d&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">}</span><span class="">
</span><span class="">          </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">qed</span><span class="">
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="">e2</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part_comm s&#39; d t&#39;&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">              </span><span class="keyword1">from</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">f1</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part_comm s d t&quot;</span><span class=""> 
</span><span class="">                </span><span class="keyword1">using</span><span class=""> </span><span class="">part_imp_not_tras</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                </span><span class="keyword1">using</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">snd_que_msg_lst_presrv_comm_of_current_part</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1">qed</span><span class="">
</span><span class="">          </span><span class="keyword1">with</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;vpeq_part s&#39; d t&#39;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1">}</span><span class="">
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> </span><span class="keyword1">qed</span><span class="">
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">                                  
</span><span class="">          </span><span class="keyword1">using</span><span class="">  </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">trans_imp_not_part</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">                
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;current s &#8800; d&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part s&#39; d t&#39;&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">        </span><span class="keyword1">{</span><span class="">
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class="string">&quot;partitions s&#39; d = partitions t&#39; d&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">is_a_partition_def</span><span class="">  </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">p8</span><span class=""> 
</span><span class="">            </span><span class="">part_not_trans</span><span class=""> </span><span class="">snd_que_msg_lst_notchg_partstate</span><span class="">  
</span><span class="">            </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">               
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="">e2</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part_comm s&#39; d t&#39;&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">              </span><span class="keyword1">from</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">f1</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part_comm s d t&quot;</span><span class=""> 
</span><span class="">                </span><span class="keyword1">using</span><span class="">  </span><span class="">part_imp_not_tras</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="">f2</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part_comm s d s&#39;&quot;</span><span class=""> 
</span><span class="">                </span><span class="keyword1">using</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">snd_que_msg_lst_notchg_comminotherdom</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="">f3</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part_comm t d t&#39;&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">using</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">sched_current_lemma</span><span class=""> 
</span><span class="">                     </span><span class="">snd_que_msg_lst_notchg_comminotherdom</span><span class="">
</span><span class="">                </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">interference1_def</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">part_imp_not_sch</span><span class=""> </span><span class="">trans_imp_not_part</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                </span><span class="keyword1">using</span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="">f2</span><span class=""> </span><span class="">vpeq_part_comm_symmetric_lemma</span><span class=""> </span><span class="">vpeq_part_comm_transitive_lemma</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">            </span><span class="keyword1">qed</span><span class="">
</span><span class="">            
</span><span class="">          </span><span class="keyword1">with</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;vpeq_part s&#39; d t&#39;&quot;</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1">}</span><span class="">
</span><span class="">            </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c1</span><span class="">                    
</span><span class="">          </span><span class="keyword1">using</span><span class=""> </span><span class="">trans_imp_not_part</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">                    
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">next</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_transmitter sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;is_a_transmitter sysconf d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">          </span><span class="keyword1">{</span><span class="">
</span><span class="">            </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;vpeq_transmitter s&#39; d t&#39;&quot;</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">vpeq_transmitter_def</span><span class="">
</span><span class="">            </span><span class="keyword1">proof</span><span class="">-</span><span class="">
</span><span class="">              </span><span class="keyword1">from</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">p8</span><span class="">
</span><span class="">              </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;comm s&#39; = comm t&#39; &#8743; part_ports s&#39; = part_ports t&#39; &quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">using</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">snd_que_msg_lst_presrv_comm_part_ports</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">_</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">p8</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1">qed</span><span class="">
</span><span class="">          </span><span class="keyword1">}</span><span class="">
</span><span class="">          </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_transmitter sysconf d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">snd_que_msg_lst_presrv_wk_stp_cons_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;weak_step_consistent_e (hyperc (Send_Queuing_Message p m))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">snd_que_msg_lst_presrv_wk_stp_cons</span><span class=""> </span><span class="">weak_step_consistent_e_def</span><span class=""> </span><span class="">exec_event_def</span><span class=""> </span><span class="">mem_Collect_eq</span><span class="">
</span><span class="">      </span><span class="">non_interference1_def</span><span class=""> </span><span class="">non_interference_def</span><span class=""> </span><span class="">singletonD</span><span class=""> </span><span class="">sched_vpeq</span><span class=""> </span><span class="">same_part_mode</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="">vpeq_sched_def</span><span class="">
</span><span class="">        </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Event.case</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Hypercall.case</span><span class="delimiter">(</span><span class="">7</span><span class="delimiter">)</span><span class=""> </span><span class="">domain_of_event.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="">event_enabled.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">option.sel</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;receive queuing message&quot; satisfying the &quot;step consistent&quot; property*}</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">rec_que_msg_presrv_comm_part_ports</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="keyword2">assumes</span><span class="">   </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s &#8743; reachable0 t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; (transmitter sysconf) &#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p5</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; (scheduler sysconf) &#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (receive_queuing_message s pid)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = fst (receive_queuing_message t pid)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;comm s&#39; = comm t&#39; &#8743; part_ports s&#39; = part_ports t&#39;&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1">{</span><span class="">
</span><span class="">    </span><span class="keyword1">from</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;vpeq_transmitter s (transmitter sysconf) t&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">sch_not_trans</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;comm s = comm t &#8743; part_ports s = part_ports t&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1">from</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class="string">&quot;port_consistent s &#8743; port_consistent t&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">port_cons_reach_state</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;&#172; is_a_queuingport s pid
              &#8744; &#172; is_a_port_of_partition s pid (current s)
              &#8744; &#172; is_dest_port s pid
              &#8744; is_empty_portqueuing s pid&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_queuingport s pid
              &#8744; &#172; is_a_port_of_partition s pid (current s)
              &#8744; &#172; is_dest_port s pid 
              &#8744; is_empty_portqueuing s pid&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">with</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = s&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">receive_queuing_message_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_queuingport t pid 
              &#8744; &#172; is_a_port_of_partition t pid (current t) 
              &#8744; &#172; is_dest_port t pid
              &#8744; is_empty_portqueuing t pid&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">get_port_byid_def</span><span class=""> </span><span class="">is_a_port_of_partition_def</span><span class=""> </span><span class="">is_a_queuingport_def</span><span class=""> 
</span><span class="">        </span><span class="">is_dest_port_def</span><span class=""> </span><span class="">is_empty_portqueuing_def</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">sched_current_lemma</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">                    
</span><span class="">      </span><span class="keyword1">with</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = t&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">receive_queuing_message_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">      </span><span class="keyword1">with</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1">next</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;&#172;(&#172; is_a_queuingport s pid
              &#8744; &#172; is_a_port_of_partition s pid (current s) 
              &#8744; &#172; is_dest_port s pid 
              &#8744; is_empty_portqueuing s pid)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (remove_msg_from_queuingport s pid)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">receive_queuing_message_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1">with</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class="string">&quot;&#172;(&#172; is_a_queuingport t pid
                        &#8744; &#172; is_a_port_of_partition t pid (current t)
                        &#8744; &#172; is_dest_port t pid
                        &#8744; is_empty_portqueuing t pid)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">get_port_byid_def</span><span class=""> </span><span class="">is_a_port_of_partition_def</span><span class=""> </span><span class="">is_a_queuingport_def</span><span class=""> 
</span><span class="">            </span><span class="">is_dest_port_def</span><span class=""> </span><span class="">is_empty_portqueuing_def</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">sched_current_lemma</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b4</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = fst (remove_msg_from_queuingport t pid)&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">receive_queuing_message_def</span><span class="delimiter">)</span><span class="">             
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;(ports (comm s)) pid&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">case</span><span class=""> </span><span class="">None</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">None.hyps</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="">remove_msg_from_queuingport_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">    
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Some</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class="string">&quot;(ports (comm s)) pid = Some x&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Some.hyps</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;the ((ports (comm s)) pid)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Queuing</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class=""> </span><span class="">x5</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">              </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Communication_State.surjective</span><span class=""> </span><span class="">Communication_State.update_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="">Port_Type.simps</span><span class="delimiter">(</span><span class="">5</span><span class="delimiter">)</span><span class=""> </span><span class="">Queuing.hyps</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">4</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="">State.surjective</span><span class=""> </span><span class="">State.update_convs</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="">eq_fst_iff</span><span class=""> </span><span class="">option.case_eq_if</span><span class=""> 
</span><span class="">                </span><span class="">remove_msg_from_queuingport_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Sampling</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="">x4</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">Sampling.hyps</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">remove_msg_from_queuingport_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">  </span><span class="keyword1">}</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">is_dest_queuing_receive</span><span class="delimiter">:</span><span class="">
</span><span class="">   </span><span class="string">&quot;t&#39; = fst (receive_queuing_message  t pid) &#10233;       
   (is_dest_port t p = is_dest_port t&#39; p) &#8743; (is_a_queuingport t p = is_a_queuingport t&#39; p)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">receive_queuing_message_def</span><span class=""> </span><span class="">remove_msg_from_queuingport_def</span><span class="delimiter">)</span><span class="">    
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;ports (comm t) pid&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;a&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class="">  </span><span class="">is_a_queuingport_def</span><span class=""> </span><span class="">is_dest_port_def</span><span class="">     
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">rec_que_msg_presrv_comm_of_current_part</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s &#8743; reachable0 t&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; (scheduler sysconf) &#8764; t&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (receive_queuing_message s pid)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = fst (receive_queuing_message t pid)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p5</span><span class="delimiter">:</span><span class="string">&quot;(current s) = d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p6</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part_comm s d t&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p7</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;vpeq_part_comm s&#39; d t&#39;&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class="">-</span><span class="">  
</span><span class="">    </span><span class="keyword1">from</span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;get_ports_of_partition s d = get_ports_of_partition t d&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1">from</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class="string">&quot;current s = current t&quot;</span><span class=""> </span><span class="keyword1">using</span><span class="">  </span><span class="">sched_current_lemma</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">  
</span><span class="">    </span><span class="keyword1">from</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class="string">&quot;part_ports s = part_ports s&#39;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">rec_que_msg_notchg_partports</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a4</span><span class="delimiter">:</span><span class="string">&quot;get_ports_of_partition s d = get_ports_of_partition s&#39; d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">using</span><span class=""> </span><span class="">part_ports_imp_portofpart</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">    </span><span class="keyword1">from</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a5</span><span class="delimiter">:</span><span class="string">&quot;part_ports t = part_ports t&#39;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">rec_que_msg_notchg_partports</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a6</span><span class="delimiter">:</span><span class="string">&quot;get_ports_of_partition t d = get_ports_of_partition t&#39; d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">using</span><span class=""> </span><span class="">part_ports_imp_portofpart</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">    </span><span class="keyword1">have</span><span class=""> </span><span class="">g0</span><span class="delimiter">:</span><span class="string">&quot;get_ports_of_partition s&#39; d = get_ports_of_partition t&#39; d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="">a6</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class=""> 
</span><span class="">    </span><span class="keyword1">moreover</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8704;p. p &#8712; get_ports_of_partition s&#39; d &#10230;
              is_a_queuingport s&#39; p = is_a_queuingport t&#39; p &#8743;
              is_dest_port s&#39; p = is_dest_port t&#39; p &#8743;
              (if is_dest_port s&#39; p then get_port_buf_size s&#39; p = get_port_buf_size t&#39; p else True)&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">is_dest_queuing_receive</span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">a4</span><span class="">  
</span><span class="">      </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class="">  </span><span class="">empty_iff</span><span class=""> </span><span class="">inf.idem</span><span class=""> </span><span class="">no_cfgport_impl_noports</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">port_partition</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword1">ultimately</span><span class=""> </span><span class="keyword3">show</span><span class="">  </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">  
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">rec_que_msg_presrv_wk_stp_cons</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s &#8743; reachable0 t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; d &#8764; t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; (scheduler sysconf) &#8764; t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p5</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8605; d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p6</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; (current s) &#8764; t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p7</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (receive_queuing_message s pid)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p8</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = fst (receive_queuing_message t pid)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s&#39; &#8764; d &#8764; t&#39;&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_scheduler sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;is_a_scheduler sysconf d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">interference1_def</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">sche_imp_not_part</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1">next</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_scheduler sysconf d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> 
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;current s = d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;current s = d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part s&#39; d t&#39;&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">        </span><span class="keyword1">{</span><span class="">
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class="string">&quot;partitions s&#39; d = partitions t&#39; d&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class=""> 
</span><span class="">          </span><span class="keyword1">{</span><span class="">
</span><span class="">            </span><span class="keyword1">from</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">f1</span><span class="delimiter">:</span><span class="string">&quot;partitions s d = partitions t d&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">part_imp_not_tras</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">            </span><span class="keyword1">from</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">f2</span><span class="delimiter">:</span><span class="string">&quot;partitions s d = partitions s&#39; d&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">rec_que_msg_notchg_partstate</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1">from</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">f3</span><span class="delimiter">:</span><span class="string">&quot;partitions t d = partitions t&#39; d&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">sched_current_lemma</span><span class=""> </span><span class="">rec_que_msg_notchg_partstate</span><span class=""> 
</span><span class="">              </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1">with</span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="">f2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;partitions s&#39; d = partitions t&#39; d&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">}</span><span class="">
</span><span class="">          </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> </span><span class="keyword1">qed</span><span class="">
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="">e2</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part_comm s&#39; d t&#39;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">rec_que_msg_presrv_comm_of_current_part</span><span class="">
</span><span class="">            </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">is_a_scheduler_def</span><span class=""> </span><span class="">is_a_transmitter_def</span><span class=""> 
</span><span class="">              </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">trans_imp_not_part</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="">vpeq_part_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            
</span><span class="">          </span><span class="keyword1">with</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;vpeq_part s&#39; d t&#39;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1">}</span><span class=""> </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> </span><span class="keyword1">qed</span><span class="">
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class="">                            
</span><span class="">          </span><span class="keyword1">using</span><span class="">  </span><span class="">trans_imp_not_part</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">              
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;current s &#8800; d&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part s&#39; d t&#39;&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">        </span><span class="keyword1">{</span><span class="">
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class="string">&quot;partitions s&#39; d = partitions t&#39; d&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class="">  </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">p8</span><span class=""> 
</span><span class="">            </span><span class="">part_not_trans</span><span class=""> </span><span class="">rec_que_msg_notchg_partstate</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">            
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="">e2</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part_comm s&#39; d t&#39;&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">            </span><span class="keyword1">from</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">f1</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part_comm s d t&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">part_imp_not_tras</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">            </span><span class="keyword1">have</span><span class=""> </span><span class="">f2</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part_comm s d s&#39;&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">rec_que_msg_notchg_comminotherdom</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">            </span><span class="keyword1">have</span><span class=""> </span><span class="">f3</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part_comm t d t&#39;&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">rec_que_msg_notchg_comminotherdom</span><span class=""> </span><span class="">sched_current_lemma</span><span class="">
</span><span class="">              </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">interference1_def</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">part_imp_not_sch</span><span class=""> </span><span class="">trans_imp_not_part</span><span class="delimiter">)</span><span class="">                       
</span><span class="">            </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="">f2</span><span class=""> </span><span class="">vpeq_part_comm_symmetric_lemma</span><span class=""> </span><span class="">vpeq_part_comm_transitive_lemma</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">          </span><span class="keyword1">qed</span><span class="">                   
</span><span class="">          </span><span class="keyword1">with</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;vpeq_part s&#39; d t&#39;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1">}</span><span class=""> </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> </span><span class="keyword1">qed</span><span class="">
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">trans_imp_not_part</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">next</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_transmitter sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;is_a_transmitter sysconf d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">        </span><span class="keyword1">{</span><span class="">
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;vpeq_transmitter s&#39; d t&#39;&quot;</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">vpeq_transmitter_def</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class="">-</span><span class="">
</span><span class="">            </span><span class="keyword1">from</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">p8</span><span class="">
</span><span class="">            </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;comm s&#39; = comm t&#39; &#8743; part_ports s&#39; = part_ports t&#39; &quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">rec_que_msg_presrv_comm_part_ports</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">p2</span><span class="delimiter">]</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">qed</span><span class="">
</span><span class="">        </span><span class="keyword1">}</span><span class="">
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">is_a_scheduler_def</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_transmitter sysconf d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">is_a_scheduler_def</span><span class=""> </span><span class="">is_a_transmitter_def</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">rec_que_msg_presrv_wk_stp_cons_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;weak_step_consistent_e (hyperc (Receive_Queuing_Message p))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">rec_que_msg_presrv_wk_stp_cons</span><span class=""> </span><span class="">weak_step_consistent_e_def</span><span class=""> </span><span class="">exec_event_def</span><span class=""> </span><span class="">mem_Collect_eq</span><span class="">
</span><span class="">      </span><span class="">non_interference1_def</span><span class=""> </span><span class="">non_interference_def</span><span class=""> </span><span class="">singletonD</span><span class=""> </span><span class="">sched_vpeq</span><span class=""> </span><span class="">same_part_mode</span><span class="">
</span><span class="">        </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Event.case</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Hypercall.case</span><span class="delimiter">(</span><span class="">8</span><span class="delimiter">)</span><span class=""> </span><span class="">domain_of_event.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="">event_enabled.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">option.sel</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;get queuing portid&quot; satisfying the &quot;step consistent&quot; property*}</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_que_pid_presrv_wk_stp_cons</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; d &#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (get_queuing_port_id sysconf s pname)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = fst (get_queuing_port_id sysconf t pname)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s&#39; &#8764; d &#8764; t&#39;&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = s&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">get_queuing_port_id_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = t&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">get_queuing_port_id_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class="">  </span><span class="">a0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_que_pid_presrv_wk_stp_cons_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;weak_step_consistent_e (hyperc (Get_Queuing_Portid p))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">get_que_pid_presrv_wk_stp_cons</span><span class=""> </span><span class="">weak_step_consistent_e_def</span><span class=""> </span><span class="">exec_event_def</span><span class=""> </span><span class="">mem_Collect_eq</span><span class="">
</span><span class="">      </span><span class="">non_interference1_def</span><span class=""> </span><span class="">non_interference_def</span><span class=""> </span><span class="">singletonD</span><span class=""> </span><span class="">sched_vpeq</span><span class=""> </span><span class="">same_part_mode</span><span class="">
</span><span class="">        </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Event.case</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Hypercall.case</span><span class="delimiter">(</span><span class="">9</span><span class="delimiter">)</span><span class=""> </span><span class="">domain_of_event.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="">event_enabled.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">option.sel</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;get queuing port status&quot; satisfying the &quot;step consistent&quot; property*}</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_que_psts_presrv_wk_stp_cons</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; d &#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (get_queuing_port_status sysconf s pid)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = fst (get_queuing_port_status sysconf t pid)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s&#39; &#8764; d &#8764; t&#39;&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = s&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">get_queuing_port_status_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = t&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">get_queuing_port_status_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_que_psts_presrv_wk_stp_cons_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;weak_step_consistent_e (hyperc (Get_Queuing_Portstatus p))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">get_que_psts_presrv_wk_stp_cons</span><span class=""> </span><span class="">weak_step_consistent_e_def</span><span class=""> </span><span class="">exec_event_def</span><span class=""> </span><span class="">mem_Collect_eq</span><span class="">
</span><span class="">      </span><span class="">non_interference1_def</span><span class=""> </span><span class="">non_interference_def</span><span class=""> </span><span class="">singletonD</span><span class=""> </span><span class="">sched_vpeq</span><span class=""> </span><span class="">same_part_mode</span><span class="">
</span><span class="">        </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Event.case</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Hypercall.case</span><span class="delimiter">(</span><span class="">10</span><span class="delimiter">)</span><span class=""> </span><span class="">domain_of_event.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">event_enabled.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="">option.sel</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="">vpeq_sched_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;clear queuing port&quot; satisfying the &quot;step consistent&quot; property*}</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">clr_que_port_presrv_comm_part_ports</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class="">   </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s &#8743; reachable0 t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; (transmitter sysconf) &#8764; t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p5</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; (scheduler sysconf) &#8764; t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = clear_queuing_port s pid&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = clear_queuing_port t pid&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;comm s&#39; = comm t&#39; &#8743; part_ports s&#39; = part_ports t&#39;&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1">{</span><span class="">
</span><span class="">    </span><span class="keyword1">from</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;vpeq_transmitter s (transmitter sysconf) t&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">sch_not_trans</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;comm s = comm t &#8743; part_ports s = part_ports t&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1">from</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class="string">&quot;port_consistent s &#8743; port_consistent t&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">port_cons_reach_state</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;&#172; is_a_queuingport s pid 
                &#8744; &#172; is_a_port_of_partition s pid (current s)
                &#8744; &#172; is_dest_port s pid&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_queuingport s pid 
                &#8744; &#172; is_a_port_of_partition s pid (current s)
                &#8744; &#172; is_dest_port s pid&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">with</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = s&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">clear_queuing_port_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_queuingport t pid
                &#8744; &#172; is_a_port_of_partition t pid (current t) 
                &#8744; &#172; is_dest_port t pid&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">get_port_byid_def</span><span class=""> </span><span class="">is_a_port_of_partition_def</span><span class=""> </span><span class="">is_a_queuingport_def</span><span class=""> 
</span><span class="">      </span><span class="">is_dest_port_def</span><span class=""> </span><span class="">is_empty_portqueuing_def</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">sched_current_lemma</span><span class=""> 
</span><span class="">       </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              
</span><span class="">      </span><span class="keyword1">with</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = t&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">clear_queuing_port_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">      </span><span class="keyword1">with</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1">next</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;&#172;(&#172; is_a_queuingport s pid
                &#8744; &#172; is_a_port_of_partition s pid (current s) 
                &#8744; &#172; is_dest_port s pid)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b00</span><span class="delimiter">:</span><span class="string">&quot;&#172;(&#172; is_a_queuingport t pid
                &#8744; &#172; is_a_port_of_partition t pid (current t)
                &#8744; &#172; is_dest_port t pid)&quot;</span><span class="">
</span><span class="">         </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">is_a_port_of_partition_def</span><span class=""> </span><span class="">is_a_queuingport_def</span><span class=""> 
</span><span class="">              </span><span class="">is_dest_port_def</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">sched_current_lemma</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">      </span><span class="keyword1">with</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;part_ports s&#39; = part_ports s&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Int_absorb</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">empty_iff</span><span class=""> </span><span class="">is_a_port_of_partition_def</span><span class=""> 
</span><span class="">          </span><span class="">option.distinct</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">port_consistent_def</span><span class=""> </span><span class="">port_partition</span><span class="delimiter">)</span><span class="">  
</span><span class="">      
</span><span class="">      </span><span class="keyword1">with</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class="string">&quot;part_ports t&#39; = part_ports t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Int_absorb</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">empty_iff</span><span class=""> </span><span class="">is_a_port_of_partition_def</span><span class=""> 
</span><span class="">          </span><span class="">option.distinct</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">port_consistent_def</span><span class=""> </span><span class="">port_partition</span><span class="delimiter">)</span><span class="">
</span><span class="">      
</span><span class="">      </span><span class="keyword1">with</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class="string">&quot;ports (comm s&#39;) = (ports (comm s))
        (pid := Some (clear_msg_queuingport (the ((ports (comm s)) pid))))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Communication_State.select_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="">Communication_State.surjective</span><span class=""> </span><span class="">Communication_State.update_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">State.surjective</span><span class=""> </span><span class="">State.update_convs</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">clear_queuing_port_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  
</span><span class="">      </span><span class="keyword1">with</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">b00</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b4</span><span class="delimiter">:</span><span class="string">&quot;ports (comm t&#39;) = (ports (comm t))
        (pid := Some (clear_msg_queuingport (the ((ports (comm t)) pid))))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Communication_State.ext_inject</span><span class=""> </span><span class="">Communication_State.surjective</span><span class=""> 
</span><span class="">          </span><span class="">Communication_State.update_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">State.surjective</span><span class=""> </span><span class="">State.update_convs</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="">clear_queuing_port_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="">b4</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">  </span><span class="keyword1">}</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">lemma</span><span class=""> </span><span class="">is_dest_queuing_clear</span><span class="delimiter">:</span><span class="">
</span><span class="">   </span><span class="string">&quot;t&#39; = clear_queuing_port t pid &#10233;       
   (is_dest_port t p = is_dest_port t&#39; p) &#8743; (is_a_queuingport t p = is_a_queuingport t&#39; p)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">clear_queuing_port_def</span><span class=""> </span><span class="">Let_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">clear_msg_queuingport_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;ports (comm t) pid&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">is_a_queuingport_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;a&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">auto</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">is_a_queuingport_def</span><span class=""> </span><span class="">is_dest_port_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">clr_que_port_presrv_comm_of_current_part</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s &#8743; reachable0 t&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; (scheduler sysconf) &#8764; t&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = clear_queuing_port s pid&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = clear_queuing_port t pid&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p5</span><span class="delimiter">:</span><span class="string">&quot;(current s) = d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p6</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part_comm s d t&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword2">and</span><span class="">   </span><span class="">p7</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;vpeq_part_comm s&#39; d t&#39;&quot;</span><span class="">     
</span><span class="">  </span><span class="keyword1">proof</span><span class="">-</span><span class="">      
</span><span class="">    </span><span class="keyword1">from</span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;get_ports_of_partition s d = get_ports_of_partition t d&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1">from</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class="string">&quot;part_ports s = part_ports s&#39;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">clr_que_port_notchg_partports</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a4</span><span class="delimiter">:</span><span class="string">&quot;get_ports_of_partition s d = get_ports_of_partition s&#39; d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">using</span><span class=""> </span><span class="">part_ports_imp_portofpart</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">    </span><span class="keyword1">from</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a5</span><span class="delimiter">:</span><span class="string">&quot;part_ports t = part_ports t&#39;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">clr_que_port_notchg_partports</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a6</span><span class="delimiter">:</span><span class="string">&quot;get_ports_of_partition t d = get_ports_of_partition t&#39; d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">using</span><span class=""> </span><span class="">part_ports_imp_portofpart</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">    </span><span class="keyword1">have</span><span class=""> </span><span class="">g0</span><span class="delimiter">:</span><span class="string">&quot;get_ports_of_partition s&#39; d = get_ports_of_partition t&#39; d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="">a6</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class=""> 
</span><span class="">    </span><span class="keyword1">also</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;&#8704;p. p &#8712; get_ports_of_partition s&#39; d &#10230;
              is_a_queuingport s&#39; p = is_a_queuingport t&#39; p &#8743;
              is_dest_port s&#39; p = is_dest_port t&#39; p &#8743;
              (if is_dest_port s&#39; p then get_port_buf_size s&#39; p = get_port_buf_size t&#39; p else True)&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword1">using</span><span class="">  </span><span class="">a4</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class="">  </span><span class="">empty_iff</span><span class=""> </span><span class="">inf.idem</span><span class=""> </span><span class="">no_cfgport_impl_noports</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">port_partition</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword1">ultimately</span><span class=""> </span><span class="keyword3">show</span><span class="">  </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class=""> </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">clr_que_port_presrv_wk_stp_cons</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s &#8743; reachable0 t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; d &#8764; t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; (scheduler sysconf) &#8764; t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p5</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8605; d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p6</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; (current s) &#8764; t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p7</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = clear_queuing_port s pid&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p8</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = clear_queuing_port t pid&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s&#39; &#8764; d &#8764; t&#39;&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_scheduler sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;is_a_scheduler sysconf d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">interference1_def</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">sche_imp_not_part</span><span class="delimiter">)</span><span class="">  
</span><span class="">  </span><span class="keyword1">next</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_scheduler sysconf d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> 
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;current s = d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;current s = d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part s&#39; d t&#39;&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">        </span><span class="keyword1">{</span><span class="">
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class="string">&quot;partitions s&#39; d = partitions t&#39; d&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class=""> 
</span><span class="">            </span><span class="keyword1">{</span><span class="">
</span><span class="">              </span><span class="keyword1">from</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">f1</span><span class="delimiter">:</span><span class="string">&quot;partitions s d = partitions t d&quot;</span><span class=""> 
</span><span class="">                </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">part_imp_not_tras</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">              </span><span class="keyword1">from</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">f2</span><span class="delimiter">:</span><span class="string">&quot;partitions s d = partitions s&#39; d&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">clr_que_port_notchg_partstate</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1">from</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">f3</span><span class="delimiter">:</span><span class="string">&quot;partitions t d = partitions t&#39; d&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">using</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">sched_current_lemma</span><span class=""> </span><span class="">clr_que_port_notchg_partstate</span><span class=""> 
</span><span class="">                </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1">with</span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="">f2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;partitions s&#39; d = partitions t&#39; d&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1">}</span><span class="">
</span><span class="">            </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1">qed</span><span class="">
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="">e2</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part_comm s&#39; d t&#39;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">clr_que_port_presrv_comm_of_current_part</span><span class="">
</span><span class="">            </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">is_a_scheduler_def</span><span class=""> </span><span class="">is_a_transmitter_def</span><span class=""> 
</span><span class="">              </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">trans_imp_not_part</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="">vpeq_part_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            
</span><span class="">          </span><span class="keyword1">with</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;vpeq_part s&#39; d t&#39;&quot;</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1">}</span><span class="">
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> 
</span><span class="">          </span><span class="keyword1">using</span><span class=""> </span><span class="">trans_imp_not_part</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">                           
</span><span class="">        </span><span class="keyword1">next</span><span class="">
</span><span class="">          </span><span class="keyword3">assume</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;current s &#8800; d&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part s&#39; d t&#39;&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">          </span><span class="keyword1">{</span><span class="">
</span><span class="">            </span><span class="keyword1">have</span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class="string">&quot;partitions s&#39; d = partitions t&#39; d&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">clr_que_port_notchg_partstate</span><span class="">
</span><span class="">                </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">part_not_trans</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">              
</span><span class="">            </span><span class="keyword1">have</span><span class=""> </span><span class="">e2</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part_comm s&#39; d t&#39;&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">              </span><span class="keyword1">from</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">f1</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part_comm s d t&quot;</span><span class=""> 
</span><span class="">                </span><span class="keyword1">using</span><span class="">  </span><span class="">part_imp_not_tras</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="">f2</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part_comm s d s&#39;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">clr_que_port_notchg_comminotherdom</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">              </span><span class="keyword1">have</span><span class=""> </span><span class="">f3</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part_comm t d t&#39;&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">using</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">clr_que_port_notchg_comminotherdom</span><span class=""> </span><span class="">sched_current_lemma</span><span class="">
</span><span class="">                </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">interference1_def</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">part_imp_not_sch</span><span class=""> </span><span class="">trans_imp_not_part</span><span class="delimiter">)</span><span class="">                     
</span><span class="">              </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                </span><span class="keyword1">using</span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="">f2</span><span class=""> </span><span class="">vpeq_part_comm_symmetric_lemma</span><span class=""> </span><span class="">vpeq_part_comm_transitive_lemma</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">            </span><span class="keyword1">qed</span><span class="">                  
</span><span class="">            </span><span class="keyword1">with</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;vpeq_part s&#39; d t&#39;&quot;</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">}</span><span class="">
</span><span class="">          </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">qed</span><span class="">
</span><span class="">          </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class="">                        
</span><span class="">            </span><span class="keyword1">using</span><span class="">  </span><span class="">trans_imp_not_part</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">next</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_transmitter sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;is_a_transmitter sysconf d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">          </span><span class="keyword1">{</span><span class="">
</span><span class="">            </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;vpeq_transmitter s&#39; d t&#39;&quot;</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">vpeq_transmitter_def</span><span class="">
</span><span class="">            </span><span class="keyword1">proof</span><span class="">-</span><span class="">
</span><span class="">              </span><span class="keyword1">from</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">p8</span><span class="">
</span><span class="">              </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;comm s&#39; = comm t&#39; &#8743; part_ports s&#39; = part_ports t&#39; &quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">using</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">clr_que_port_presrv_comm_part_ports</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">_</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">p8</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">            </span><span class="keyword1">qed</span><span class="">
</span><span class="">          </span><span class="keyword1">}</span><span class="">
</span><span class="">          </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">is_a_scheduler_def</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_transmitter sysconf d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">clr_que_port_presrv_wk_stp_cons_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;weak_step_consistent_e (hyperc (Clear_Queuing_Port p))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">clr_que_port_presrv_wk_stp_cons</span><span class=""> </span><span class="">weak_step_consistent_e_def</span><span class=""> </span><span class="">exec_event_def</span><span class=""> </span><span class="">mem_Collect_eq</span><span class="">
</span><span class="">      </span><span class="">non_interference1_def</span><span class=""> </span><span class="">non_interference_def</span><span class=""> </span><span class="">singletonD</span><span class=""> </span><span class="">sched_vpeq</span><span class=""> </span><span class="">same_part_mode</span><span class="">
</span><span class="">        </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Event.case</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Hypercall.case</span><span class="delimiter">(</span><span class="">11</span><span class="delimiter">)</span><span class=""> </span><span class="">domain_of_event.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">event_enabled.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="">option.sel</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="">vpeq_sched_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;set partition mode&quot; satisfying the &quot;step consistent&quot; property*}</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">set_part_mode_presrv_wk_stp_cons</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf (current s)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s &#8743; reachable0 t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; d &#8764; t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; (scheduler sysconf) &#8764; t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p5</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8605; d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p6</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; (current s) &#8764; t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p7</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = set_partition_mode sysconf s m&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p8</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = set_partition_mode sysconf t m&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s&#39; &#8764; d &#8764; t&#39;&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_scheduler sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;is_a_scheduler sysconf d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">interference1_def</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">sche_imp_not_part</span><span class="delimiter">)</span><span class="">  
</span><span class="">  </span><span class="keyword1">next</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_scheduler sysconf d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> 
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;current s = d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;current s = d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part s&#39; d t&#39;&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">        </span><span class="keyword1">{</span><span class="">
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class="string">&quot;partitions s&#39; d = partitions t&#39; d&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class=""> 
</span><span class="">          </span><span class="keyword1">{</span><span class="">
</span><span class="">            </span><span class="keyword1">from</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">f1</span><span class="delimiter">:</span><span class="string">&quot;partitions s d = partitions t d&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">part_imp_not_tras</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">            </span><span class="keyword1">from</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">f2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;current t = d&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">sched_current_lemma</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">            </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;partitions s&#39; d = partitions t&#39; d&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">set_partition_mode_def</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="">f2</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">}</span><span class="">
</span><span class="">          </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">qed</span><span class="">
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="">e2</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part_comm s&#39; d t&#39;&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">          </span><span class="keyword1">{</span><span class="">
</span><span class="">            </span><span class="keyword1">from</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">f1</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part_comm s d t&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">part_imp_not_tras</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">            </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;vpeq_part_comm s&#39; d t&#39;&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">mono_tags</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">emptyE</span><span class=""> </span><span class="">inf.idem</span><span class=""> </span><span class="">no_cfgport_impl_noports</span><span class=""> 
</span><span class="">                  </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">part_ports_imp_portofpart</span><span class=""> </span><span class="">port_partition</span><span class=""> 
</span><span class="">                  </span><span class="">set_part_mode_notchg_partports</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="">vpeq_part_comm_def</span><span class=""> </span><span class="">vpeq_sched_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1">}</span><span class="">
</span><span class="">          </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> </span><span class="keyword1">qed</span><span class="">
</span><span class="">          </span><span class="keyword1">with</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;vpeq_part s&#39; d t&#39;&quot;</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1">}</span><span class=""> </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> </span><span class="keyword1">qed</span><span class="">
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">trans_imp_not_part</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">            
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;current s &#8800; d&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part s&#39; d t&#39;&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">        </span><span class="keyword1">{</span><span class="">
</span><span class="">          </span><span class="keyword1">from</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">f2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;current t &#8800; d&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">using</span><span class=""> </span><span class="">sched_current_lemma</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="">vpeq_sched_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class="string">&quot;partitions s&#39; d = partitions t&#39; d&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">f2</span><span class="">  </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">p8</span><span class=""> 
</span><span class="">              </span><span class="">part_not_trans</span><span class=""> </span><span class="">set_part_mode_notchg_partstate_inotherdom</span><span class="">  
</span><span class="">            </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="">e2</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part_comm s&#39; d t&#39;&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">mono_tags</span><span class="delimiter">,</span><span class=""> </span><span class="">hide_lams</span><span class="delimiter">)</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">is_a_partition_def</span><span class=""> </span><span class="">is_a_scheduler_def</span><span class=""> 
</span><span class="">              </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">part_not_trans</span><span class=""> </span><span class="">set_part_mode_notchg_comm</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> 
</span><span class="">              </span><span class="">vpeq_part_comm_symmetric_lemma</span><span class=""> </span><span class="">vpeq_part_comm_transitive_lemma</span><span class=""> </span><span class="">vpeq_part_def</span><span class=""> </span><span class="">vpeq_sched_def</span><span class="delimiter">)</span><span class="">
</span><span class="">         </span><span class="keyword1">with</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;vpeq_part s&#39; d t&#39;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">vpeq_part_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1">}</span><span class=""> </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> </span><span class="keyword1">qed</span><span class="">
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">trans_imp_not_part</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">          
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">next</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_transmitter sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;is_a_transmitter sysconf d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">with</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;vpeq_transmitter s d t&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="">is_a_transmitter_def</span><span class=""> </span><span class="">sch_not_trans</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">        </span><span class="keyword1">{</span><span class="">
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;vpeq_transmitter s&#39; d t&#39;&quot;</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">vpeq_transmitter_def</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;comm s&#39; = comm t&#39;&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">mono_tags</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">is_a_partition_def</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p4</span><span class=""> 
</span><span class="">                </span><span class="">p7</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">sch_not_part</span><span class=""> </span><span class="">set_part_mode_notchg_comm2</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> 
</span><span class="">                </span><span class="">vpeq_sched_def</span><span class=""> </span><span class="">vpeq_transmitter_def</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;part_ports s&#39; = part_ports t&#39;&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">sched_current_lemma</span><span class=""> 
</span><span class="">              </span><span class="">set_part_mode_notchg_partports</span><span class=""> </span><span class="">vpeq_transmitter_def</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="">vpeq_sched_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">   
</span><span class="">          </span><span class="keyword1">qed</span><span class="">
</span><span class="">          </span><span class="keyword1">}</span><span class=""> </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b1</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_transmitter sysconf d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">is_a_scheduler_def</span><span class=""> </span><span class="">is_a_transmitter_def</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">set_part_mode_presrv_wk_stp_cons_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;weak_step_consistent_e (hyperc (Set_Partition_Mode p))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">set_part_mode_presrv_wk_stp_cons</span><span class=""> </span><span class="">weak_step_consistent_e_def</span><span class=""> </span><span class="">exec_event_def</span><span class=""> </span><span class="">mem_Collect_eq</span><span class="">
</span><span class="">      </span><span class="">non_interference1_def</span><span class=""> </span><span class="">non_interference_def</span><span class=""> </span><span class="">singletonD</span><span class=""> </span><span class="">sched_vpeq</span><span class=""> </span><span class="">same_part_mode</span><span class="">
</span><span class="">        </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Event.case</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Hypercall.case</span><span class="delimiter">(</span><span class="">12</span><span class="delimiter">)</span><span class=""> </span><span class="">domain_of_event.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">event_enabled.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="">option.sel</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="">vpeq_sched_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;get partition status&quot; satisfying the &quot;step consistent&quot; property*}</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_part_status_presrv_wk_stp_cons</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; d &#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = fst (get_partition_status sysconf s)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = fst (get_partition_status sysconf t)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s&#39; &#8764; d &#8764; t&#39;&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = s&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">get_partition_status_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = t&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">get_partition_status_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class="">  </span><span class="">a0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">get_part_status_presrv_wk_stp_cons_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;weak_step_consistent_e (hyperc Get_Partition_Status)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">get_part_status_presrv_wk_stp_cons</span><span class=""> </span><span class="">weak_step_consistent_e_def</span><span class=""> </span><span class="">exec_event_def</span><span class=""> </span><span class="">mem_Collect_eq</span><span class="">
</span><span class="">      </span><span class="">non_interference1_def</span><span class=""> </span><span class="">non_interference_def</span><span class=""> </span><span class="">singletonD</span><span class=""> </span><span class="">sched_vpeq</span><span class=""> </span><span class="">same_part_mode</span><span class="">
</span><span class="">        </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Event.case</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Hypercall.case</span><span class="delimiter">(</span><span class="">13</span><span class="delimiter">)</span><span class=""> </span><span class="">domain_of_event.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">event_enabled.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="">option.sel</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="">vpeq_sched_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;schedule&quot; satisfying the &quot;step consistent&quot; property*}</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">schedule_presrv_wk_stp_cons</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s &#8743; reachable0 t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; d &#8764; t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p5</span><span class="delimiter">:</span><span class="string">&quot;(scheduler sysconf) &#8605; d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p6</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; (scheduler sysconf) &#8764; t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p7</span><span class="delimiter">:</span><span class="string">&quot;s&#39; &#8712; schedule sysconf s&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p8</span><span class="delimiter">:</span><span class="string">&quot;t&#39; &#8712; schedule sysconf t&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s&#39; &#8764; d &#8764; t&#39;&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_scheduler sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;is_a_scheduler sysconf d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">from</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;current s&#39; = current t&#39;&quot;</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">schedule_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1">with</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">schedule_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">  </span><span class="keyword1">next</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_scheduler sysconf d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">with</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b00</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part s d t&quot;</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">vpeq1_def</span><span class="">
</span><span class="">        </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">is_a_scheduler_def</span><span class=""> </span><span class="">is_a_transmitter_def</span><span class=""> </span><span class="">trans_imp_not_part</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part s&#39; d t&#39;&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1">{</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;partitions s&#39; d = partitions t&#39; d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class=""> 
</span><span class="">        </span><span class="keyword1">{</span><span class="">
</span><span class="">          </span><span class="keyword1">from</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">f1</span><span class="delimiter">:</span><span class="string">&quot;partitions s d = partitions t d&quot;</span><span class=""> 
</span><span class="">            </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">part_imp_not_tras</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">          </span><span class="keyword1">from</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">f2</span><span class="delimiter">:</span><span class="string">&quot;partitions s d = partitions s&#39; d&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">schedule_def</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1">from</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">f3</span><span class="delimiter">:</span><span class="string">&quot;partitions t d = partitions t&#39; d&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">schedule_def</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1">with</span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="">f2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;partitions s&#39; d = partitions t&#39; d&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1">}</span><span class="">
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part_comm s&#39; d t&#39;&quot;</span><span class="">  
</span><span class="">        </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">          </span><span class="keyword1">from</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class="string">&quot;part_ports s = part_ports s&#39;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">schedule_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1">from</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class="string">&quot;comm s = comm s&#39;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">schedule_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1">with</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">d3</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part_comm s d s&#39;&quot;</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">vpeq_part_comm_def</span><span class=""> </span><span class="">get_ports_of_partition_def</span><span class="">
</span><span class="">            </span><span class="">is_a_queuingport_def</span><span class=""> </span><span class="">is_dest_port_def</span><span class=""> </span><span class="">get_port_buf_size_def</span><span class=""> </span><span class="">get_port_byid_def</span><span class=""> 
</span><span class="">            </span><span class="">get_current_bufsize_port_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">          </span><span class="keyword1">from</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">d4</span><span class="delimiter">:</span><span class="string">&quot;part_ports t = part_ports t&#39;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">schedule_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1">from</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">d5</span><span class="delimiter">:</span><span class="string">&quot;comm t = comm t&#39;&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">schedule_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1">with</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">d4</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;vpeq_part_comm t d t&#39;&quot;</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">vpeq_part_comm_def</span><span class=""> </span><span class="">get_ports_of_partition_def</span><span class="">
</span><span class="">            </span><span class="">is_a_queuingport_def</span><span class=""> </span><span class="">is_dest_port_def</span><span class=""> </span><span class="">get_port_buf_size_def</span><span class=""> </span><span class="">get_port_byid_def</span><span class=""> 
</span><span class="">            </span><span class="">get_current_bufsize_port_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">          </span><span class="keyword1">with</span><span class=""> </span><span class="">b00</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="">d3</span><span class=""> </span><span class="">d4</span><span class=""> </span><span class="">d5</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">            </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">vpeq_part_comm_symmetric_lemma</span><span class=""> </span><span class="">vpeq_part_comm_transitive_lemma</span><span class=""> </span><span class="">vpeq_part_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">        </span><span class="keyword1">with</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;vpeq_part s&#39; d t&#39;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">vpeq_part_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class=""> 
</span><span class="">      </span><span class="keyword1">}</span><span class="">
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class="">  </span><span class="">trans_imp_not_part</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">    </span><span class="keyword1">next</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">p3</span><span class="">  </span><span class="">p7</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">sch_not_trans</span><span class=""> </span><span class="">schedule_def</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b1</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">         
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">schedule_presrv_wk_stp_cons_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;weak_step_consistent_e (sys Schedule)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">schedule_presrv_wk_stp_cons</span><span class=""> </span><span class="">weak_step_consistent_e_def</span><span class=""> </span><span class="">exec_event_def</span><span class=""> </span><span class="">mem_Collect_eq</span><span class="">
</span><span class="">      </span><span class="">non_interference1_def</span><span class=""> </span><span class="">non_interference_def</span><span class=""> </span><span class="">singletonD</span><span class=""> </span><span class="">sched_vpeq</span><span class=""> </span><span class="">same_part_mode</span><span class="">
</span><span class="">        </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Event.case</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">System_Event.case</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">domain_of_event.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">event_enabled.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="">option.sel</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="">vpeq_sched_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;Transfer Sampling Message&quot; satisfying the &quot;step consistent&quot; property*}</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">trans_smpl_msg_presrv_comm_part_ports</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2">assumes</span><span class="">   </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s &#8743; reachable0 t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; (transmitter sysconf) &#8764; t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p5</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; (scheduler sysconf) &#8764; t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = transf_sampling_msg s c&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = transf_sampling_msg t c&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;comm s&#39; = comm t&#39; &#8743; part_ports s&#39; = part_ports t&#39;&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1">{</span><span class="">
</span><span class="">    </span><span class="keyword1">from</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;vpeq_transmitter s (transmitter sysconf) t&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">sch_not_trans</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">    </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;comm s = comm t &#8743; part_ports s = part_ports t&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1">from</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class="string">&quot;port_consistent s &#8743; port_consistent t&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">port_cons_reach_state</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword1">from</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">c</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Channel_Sampling</span><span class=""> </span><span class="">name</span><span class=""> </span><span class="">sn</span><span class=""> </span><span class="">dns</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;get_portid_by_name s sn&#8800;None &#8743; card (get_portids_by_names s dns) = card dns&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1">let</span><span class=""> </span><span class="var">?pids</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;the (get_portid_by_name s sn)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">let</span><span class=""> </span><span class="var">?pidt</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;the (get_portid_by_name t sn)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">let</span><span class=""> </span><span class="var">?pidss</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;get_portids_by_names s dns&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">let</span><span class=""> </span><span class="var">?pidst</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;get_portids_by_names t dns&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">let</span><span class=""> </span><span class="var">?m</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;the (get_the_msg_of_samplingport s ?pids)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">let</span><span class=""> </span><span class="var">?m&#39;</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;the (get_the_msg_of_samplingport t ?pidt)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">let</span><span class=""> </span><span class="var">?s&#39;</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;update_sampling_ports_msg s ?pidss ?m&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">let</span><span class=""> </span><span class="var">?t&#39;</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;update_sampling_ports_msg t ?pidst ?m&#39;&quot;</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;get_portid_by_name s sn&#8800;None &#8743; card (get_portids_by_names s dns) = card dns&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">with</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;get_portid_by_name t sn&#8800;None &#8743; card (get_portids_by_names t dns) = card dns&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">get_portid_by_name_def</span><span class=""> </span><span class="">is_port_name_def</span><span class=""> </span><span class="">get_portids_by_names_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">presburger</span><span class=""> 
</span><span class="">        </span><span class="keyword1">from</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = ?s&#39;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">Channel_Sampling.prems</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">        </span><span class="keyword1">from</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = ?t&#39;&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">Channel_Sampling.prems</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">        </span><span class="keyword1">from</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b4</span><span class="delimiter">:</span><span class="string">&quot;?m = ?m&#39;&quot;</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">get_the_msg_of_samplingport_def</span><span class=""> </span><span class="">get_port_byid_def</span><span class=""> </span><span class="">get_portid_by_name_def</span><span class="">
</span><span class="">          </span><span class="">is_port_name_def</span><span class=""> </span><span class="">get_msg_from_samplingport_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1">from</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b5</span><span class="delimiter">:</span><span class="string">&quot;?pids = ?pidt&quot;</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">get_portid_by_name_def</span><span class=""> </span><span class="">is_port_name_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1">from</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b6</span><span class="delimiter">:</span><span class="string">&quot;?pidss = ?pidst&quot;</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">get_portids_by_names_def</span><span class=""> </span><span class="">get_portid_by_name_def</span><span class=""> 
</span><span class="">          </span><span class="">is_port_name_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1">with</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="">b5</span><span class="">  </span><span class="keyword1">have</span><span class=""> </span><span class="">a7</span><span class="delimiter">:</span><span class="string">&quot;comm ?s&#39; = comm ?t&#39; &#8743; part_ports ?s&#39; = part_ports ?t&#39;&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">update_sampling_ports_msg_def</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1">with</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;&#172;(get_portid_by_name s sn&#8800;None &#8743; card (get_portids_by_names s dns) = card dns)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">with</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;&#172;(get_portid_by_name t sn&#8800;None &#8743; card (get_portids_by_names t dns) = card dns)&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">get_portid_by_name_def</span><span class=""> </span><span class="">is_port_name_def</span><span class=""> </span><span class="">get_portids_by_names_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">presburger</span><span class="">         
</span><span class="">        </span><span class="keyword1">with</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">Channel_Sampling</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">next</span><span class="">
</span><span class="">      </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Channel_Queuing</span><span class=""> </span><span class="">nm</span><span class=""> </span><span class="">sn</span><span class=""> </span><span class="">dn</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Channel_Queuing.prems</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Channel_Queuing.prems</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">a1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">  </span><span class="keyword1">}</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">trans_smpl_msg_presrv_wk_stp_cons</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_transmitter sysconf (current s)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s &#8743; reachable0 t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; d &#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; (scheduler sysconf) &#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p5</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8605; d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p6</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; (current s) &#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p7</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = transf_sampling_msg s c&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p8</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = transf_sampling_msg t c&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s&#39; &#8764; d &#8764; t&#39;&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_scheduler sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;is_a_scheduler sysconf d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">no_intf_sched_help</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">sch_not_trans</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">next</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_scheduler sysconf d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">have</span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class="string">&quot;comm s&#39; = comm t&#39; &#8743; part_ports s&#39; = part_ports t&#39;&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">using</span><span class="">  </span><span class="">p1</span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="">is_a_transmitter_def</span><span class=""> </span><span class="">trans_smpl_msg_presrv_comm_part_ports</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">_</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">p8</span><span class="delimiter">]</span><span class=""> 
</span><span class="">      </span><span class="keyword1">by</span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> 
</span><span class="">      </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part s&#39; d t&#39;&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class="string">&quot;partitions s&#39; d = partitions t&#39; d&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class="">   </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">p8</span><span class=""> 
</span><span class="">            </span><span class="">part_imp_not_tras</span><span class=""> </span><span class="">sched_current_lemma</span><span class=""> </span><span class="">trans_smpl_msg_notchg_partstate</span><span class="">   
</span><span class="">            </span><span class="keyword1">by</span><span class=""> </span><span class="">force</span><span class="">                                       
</span><span class="">          </span><span class="keyword1">from</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">e2</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part_comm s&#39; d t&#39;&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">vpeq_part_comm_def</span><span class="">  </span><span class="">get_ports_of_partition_def</span><span class=""> </span><span class="">is_a_queuingport_def</span><span class=""> 
</span><span class="">            </span><span class="">is_dest_port_def</span><span class=""> </span><span class="">get_port_buf_size_def</span><span class=""> </span><span class="">get_current_bufsize_port_def</span><span class=""> </span><span class="">get_port_byid_def</span><span class=""> 
</span><span class="">             </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">                
</span><span class="">          </span><span class="keyword1">with</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class="">                                 
</span><span class="">          </span><span class="keyword1">using</span><span class=""> </span><span class="">trans_imp_not_part</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">next</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_transmitter sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;is_a_transmitter sysconf d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">        </span><span class="keyword1">{</span><span class="">
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;vpeq_transmitter s&#39; d t&#39;&quot;</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">vpeq_transmitter_def</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class="">-</span><span class="">
</span><span class="">            </span><span class="keyword1">from</span><span class=""> </span><span class="">p3</span><span class="">  </span><span class="">p7</span><span class=""> </span><span class="">p8</span><span class="">
</span><span class="">            </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;comm s&#39; = comm t&#39; &#8743; part_ports s&#39; = part_ports t&#39; &quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">trans_smpl_msg_presrv_comm_part_ports</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">_</span><span class=""> </span><span class="">p4</span><span class="delimiter">]</span><span class="">  </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">          </span><span class="keyword1">qed</span><span class="">
</span><span class="">        </span><span class="keyword1">}</span><span class="">
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">is_a_scheduler_def</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_transmitter sysconf d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">trans_smpl_msg_presrv_wk_stp_cons_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;weak_step_consistent_e (sys (Transfer_Sampling_Message c))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">trans_smpl_msg_presrv_wk_stp_cons</span><span class=""> </span><span class="">weak_step_consistent_e_def</span><span class=""> </span><span class="">exec_event_def</span><span class=""> </span><span class="">mem_Collect_eq</span><span class="">
</span><span class="">      </span><span class="">non_interference1_def</span><span class=""> </span><span class="">non_interference_def</span><span class=""> </span><span class="">singletonD</span><span class=""> </span><span class="">sched_vpeq</span><span class=""> </span><span class="">same_part_mode</span><span class="">
</span><span class="">        </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Event.case</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">System_Event.case</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">domain_of_event.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">event_enabled.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="">option.sel</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">is_a_transmitter_def</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="">vpeq_sched_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving &quot;Transfer Queuing Message&quot; satisfying the &quot;step consistent&quot; property*}</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">trans_que_msg_mlost_presrv_comm_part_ports</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="keyword2">assumes</span><span class="">   </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s &#8743; reachable0 t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; (transmitter sysconf) &#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p5</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; (scheduler sysconf) &#8764; t&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = transf_queuing_msg_maylost sysconf s c&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = transf_queuing_msg_maylost sysconf t c&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;comm s&#39; = comm t&#39; &#8743; part_ports s&#39; = part_ports t&#39;&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1">{</span><span class="">
</span><span class="">        </span><span class="keyword1">from</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;vpeq_transmitter s (transmitter sysconf) t&quot;</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">sch_not_trans</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;comm s = comm t &#8743; part_ports s = part_ports t&quot;</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">vpeq_transmitter_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1">from</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class="string">&quot;port_consistent s &#8743; port_consistent t&quot;</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">port_cons_reach_state</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1">from</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">c</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Channel_Queuing</span><span class=""> </span><span class="">nm</span><span class=""> </span><span class="">sn</span><span class=""> </span><span class="">dn</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">              </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;get_portid_by_name s sn &#8800; None &#8743; get_portid_by_name s dn &#8800; None 
                          &#8743; has_msg_inportqueuing s (the (get_portid_by_name s sn))&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1">let</span><span class=""> </span><span class="var">?sps</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;the (get_portid_by_name s sn)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">let</span><span class=""> </span><span class="var">?spt</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;the (get_portid_by_name t sn)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">let</span><span class=""> </span><span class="var">?dps</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;the (get_portid_by_name s dn)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">let</span><span class=""> </span><span class="var">?dpt</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;the (get_portid_by_name t dn)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">let</span><span class=""> </span><span class="var">?s1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;fst (remove_msg_from_queuingport s ?sps)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">let</span><span class=""> </span><span class="var">?t1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;fst (remove_msg_from_queuingport t ?spt)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">let</span><span class=""> </span><span class="var">?ms</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;snd (remove_msg_from_queuingport s ?sps)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">let</span><span class=""> </span><span class="var">?mt</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;snd (remove_msg_from_queuingport t ?spt)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">let</span><span class=""> </span><span class="var">?s2</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;replace_msg2queuing_port ?s1 ?dps (the ?ms)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">let</span><span class=""> </span><span class="var">?t2</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;replace_msg2queuing_port ?t1 ?dpt (the ?mt)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">let</span><span class=""> </span><span class="var">?s3</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;insert_msg2queuing_port ?s1 ?dps (the ?ms)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">let</span><span class=""> </span><span class="var">?t3</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;insert_msg2queuing_port ?t1 ?dpt (the ?mt)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;get_portid_by_name s sn &#8800; None &#8743; get_portid_by_name s dn &#8800; None 
                          &#8743; has_msg_inportqueuing s (the (get_portid_by_name s sn))&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">with</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;get_portid_by_name t sn &#8800; None &#8743; get_portid_by_name t dn &#8800; None 
                          &#8743; has_msg_inportqueuing t (the (get_portid_by_name t sn))&quot;</span><span class=""> 
</span><span class="">                          </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">get_portid_by_name_def</span><span class=""> </span><span class="">has_msg_inportqueuing_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">                </span><span class="keyword1">from</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class="string">&quot;?sps = ?spt&quot;</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">get_portid_by_name_def</span><span class=""> </span><span class="">is_port_name_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1">from</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class="string">&quot;?dps = ?dpt&quot;</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">get_portid_by_name_def</span><span class=""> </span><span class="">is_port_name_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1">with</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b4</span><span class="delimiter">:</span><span class="string">&quot;comm ?s1 = comm ?t1&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">remove_msg_from_queuingport_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;ports (comm t) ?spt&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;a&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Communication_State.surjective</span><span class=""> </span><span class="">Communication_State.update_convs</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="">Port_Type.simps</span><span class="delimiter">(</span><span class="">5</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">State.surjective</span><span class=""> </span><span class="">State.update_convs</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="">fstI</span><span class=""> </span><span class="">option.simps</span><span class="delimiter">(</span><span class="">5</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">                </span><span class="keyword1">with</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b5</span><span class="delimiter">:</span><span class="string">&quot;part_ports ?s1 = part_ports ?t1&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">remove_msg_from_queuingport_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;ports (comm t) ?spt&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;a&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Port_Type.simps</span><span class="delimiter">(</span><span class="">5</span><span class="delimiter">)</span><span class=""> </span><span class="">State.select_convs</span><span class="delimiter">(</span><span class="">4</span><span class="delimiter">)</span><span class=""> </span><span class="">State.surjective</span><span class=""> 
</span><span class="">                    </span><span class="">State.update_convs</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">fstI</span><span class=""> </span><span class="">option.simps</span><span class="delimiter">(</span><span class="">5</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">                </span><span class="keyword1">from</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b6</span><span class="delimiter">:</span><span class="string">&quot;?ms = ?mt&quot;</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">remove_msg_from_queuingport_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;ports (comm t) ?spt&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;a&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Port_Type.simps</span><span class="delimiter">(</span><span class="">5</span><span class="delimiter">)</span><span class=""> </span><span class="">option.simps</span><span class="delimiter">(</span><span class="">5</span><span class="delimiter">)</span><span class=""> </span><span class="">prod.collapse</span><span class=""> </span><span class="">prod.inject</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">                </span><span class="keyword1">from</span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="">b5</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b7</span><span class="delimiter">:</span><span class="string">&quot;comm ?s2 = comm ?t2 &#8743; part_ports ?s2 = part_ports ?t2&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">replace_msg2queuing_port_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class=""> 
</span><span class="">                </span><span class="keyword1">from</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="">b5</span><span class=""> </span><span class="">b6</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b8</span><span class="delimiter">:</span><span class="string">&quot;comm ?s3 = comm ?t3&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">insert_msg2queuing_port_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;ports (comm ?t1) ?dpt&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;a&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Int_absorb</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">empty_iff</span><span class=""> </span><span class="">option.distinct</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">port_consistent_def</span><span class=""> 
</span><span class="">                    </span><span class="">port_partition</span><span class=""> </span><span class="">remove_msg_from_queuingport_presv_port_cons</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">                </span><span class="keyword1">from</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="">b5</span><span class=""> </span><span class="">b6</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b9</span><span class="delimiter">:</span><span class="string">&quot;part_ports ?s3 = part_ports ?t3&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">insert_msg2queuing_port_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;ports (comm ?t1) ?dpt&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;a&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Int_absorb</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">empty_iff</span><span class=""> </span><span class="">option.distinct</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">port_consistent_def</span><span class=""> 
</span><span class="">                    </span><span class="">port_partition</span><span class=""> </span><span class="">remove_msg_from_queuingport_presv_port_cons</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">                </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> 
</span><span class="">                  </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_full_portqueuing sysconf ?s1 ?dps&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;is_full_portqueuing sysconf ?s1 ?dps&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1">with</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;is_full_portqueuing sysconf ?t1 ?dpt&quot;</span><span class=""> 
</span><span class="">                      </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">is_full_portqueuing_def</span><span class=""> </span><span class="">Let_def</span><span class=""> </span><span class="">get_port_conf_byid_def</span><span class="">  
</span><span class="">                      </span><span class="">get_max_bufsize_of_port_def</span><span class=""> </span><span class="">get_current_bufsize_port_def</span><span class=""> </span><span class="">get_port_byid_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                    </span><span class="keyword1">from</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = ?s2&quot;</span><span class=""> 
</span><span class="">                      </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Channel_Queuing.prems</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">transf_queuing_msg_maylost.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="keyword1">from</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = ?t2&quot;</span><span class=""> 
</span><span class="">                      </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Channel_Queuing.prems</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">transf_queuing_msg_maylost.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    
</span><span class="">                    </span><span class="keyword1">with</span><span class=""> </span><span class="">b7</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1">next</span><span class="">
</span><span class="">                    </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;&#172;is_full_portqueuing sysconf ?s1 ?dps&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1">with</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;&#172;is_full_portqueuing sysconf ?t1 ?dpt&quot;</span><span class=""> 
</span><span class="">                      </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">is_full_portqueuing_def</span><span class=""> </span><span class="">Let_def</span><span class=""> </span><span class="">get_port_conf_byid_def</span><span class="">  
</span><span class="">                      </span><span class="">get_max_bufsize_of_port_def</span><span class=""> </span><span class="">get_current_bufsize_port_def</span><span class=""> </span><span class="">get_port_byid_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                    </span><span class="keyword1">from</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = ?s3&quot;</span><span class=""> 
</span><span class="">                      </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Channel_Queuing.prems</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">transf_queuing_msg_maylost.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1">from</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = ?t3&quot;</span><span class=""> 
</span><span class="">                      </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Channel_Queuing.prems</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">transf_queuing_msg_maylost.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    
</span><span class="">                    </span><span class="keyword1">with</span><span class=""> </span><span class="">b8</span><span class=""> </span><span class="">b9</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1">qed</span><span class="">
</span><span class="">              </span><span class="keyword1">next</span><span class="">
</span><span class="">                </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;&#172;(get_portid_by_name s sn &#8800; None &#8743; get_portid_by_name s dn &#8800; None 
                          &#8743; has_msg_inportqueuing s (the (get_portid_by_name s sn)))&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1">with</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;&#172;(get_portid_by_name t sn &#8800; None &#8743; get_portid_by_name t dn &#8800; None 
                          &#8743; has_msg_inportqueuing t (the (get_portid_by_name t sn)))&quot;</span><span class=""> 
</span><span class="">                          </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">get_portid_by_name_def</span><span class=""> </span><span class="">has_msg_inportqueuing_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1">with</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = s&quot;</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">transf_queuing_msg_maylost_def</span><span class=""> 
</span><span class="">                  </span><span class="">Let_def</span><span class=""> </span><span class="">Channel_Queuing.prems</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                </span><span class="keyword1">with</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = t&quot;</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">transf_queuing_msg_maylost_def</span><span class=""> 
</span><span class="">                  </span><span class="">Let_def</span><span class=""> </span><span class="">Channel_Queuing.prems</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                </span><span class="keyword1">with</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">              </span><span class="keyword1">qed</span><span class="">
</span><span class="">          </span><span class="keyword1">next</span><span class="">
</span><span class="">            </span><span class="keyword3">case</span><span class=""> </span><span class="delimiter">(</span><span class="">Channel_Sampling</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="">x3</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3">show</span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Channel_Sampling.prems</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">Channel_Sampling.prems</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">a1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">}</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">trans_que_msg_mlost_presrv_wk_stp_cons</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="keyword2">assumes</span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;is_a_transmitter sysconf (current s)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p2</span><span class="delimiter">:</span><span class="string">&quot;reachable0 s &#8743; reachable0 t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; d &#8764; t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p4</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; (scheduler sysconf) &#8764; t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p5</span><span class="delimiter">:</span><span class="string">&quot;(current s) &#8605; d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p6</span><span class="delimiter">:</span><span class="string">&quot;s &#8764; (current s) &#8764; t&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p7</span><span class="delimiter">:</span><span class="string">&quot;s&#39; = transf_queuing_msg_maylost sysconf s c&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2">and</span><span class="">   </span><span class="">p8</span><span class="delimiter">:</span><span class="string">&quot;t&#39; = transf_queuing_msg_maylost sysconf t c&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2">shows</span><span class="">   </span><span class="string">&quot;s&#39; &#8764; d &#8764; t&#39;&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_scheduler sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class="string">&quot;is_a_scheduler sysconf d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">no_intf_sched_help</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">sch_not_trans</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1">next</span><span class="">
</span><span class="">    </span><span class="keyword3">assume</span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_scheduler sysconf d&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">have</span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class="string">&quot;comm s&#39; = comm t&#39; &#8743; part_ports s&#39; = part_ports t&#39;&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1">using</span><span class="">  </span><span class="">p1</span><span class=""> </span><span class="">p6</span><span class="">  </span><span class="">trans_que_msg_mlost_presrv_comm_part_ports</span><span class="delimiter">[</span><span class="">OF</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">_</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">p8</span><span class="delimiter">]</span><span class="">
</span><span class="">      </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">is_a_transmitter_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class="string">&quot;is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> 
</span><span class="">      </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part s&#39; d t&#39;&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class="string">&quot;partitions s&#39; d = partitions t&#39; d&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class="">  </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">p8</span><span class=""> 
</span><span class="">            </span><span class="">part_imp_not_tras</span><span class=""> </span><span class="">sched_current_lemma</span><span class=""> </span><span class="">trans_que_msg_mlost_notchg_partstate</span><span class="">
</span><span class="">            </span><span class="keyword1">by</span><span class=""> </span><span class="">force</span><span class="">                 
</span><span class="">          </span><span class="keyword1">from</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1">have</span><span class=""> </span><span class="">e2</span><span class="delimiter">:</span><span class="string">&quot;vpeq_part_comm s&#39; d t&#39;&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">vpeq_part_comm_def</span><span class=""> </span><span class="">Let_def</span><span class=""> </span><span class="">get_ports_of_partition_def</span><span class=""> </span><span class="">is_a_queuingport_def</span><span class=""> 
</span><span class="">            </span><span class="">is_dest_port_def</span><span class=""> </span><span class="">get_port_buf_size_def</span><span class=""> </span><span class="">get_current_bufsize_port_def</span><span class=""> </span><span class="">get_port_byid_def</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">simp</span><span class="">            
</span><span class="">          </span><span class="keyword1">with</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">  </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> 
</span><span class="">          </span><span class="keyword1">using</span><span class=""> </span><span class="">trans_imp_not_part</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">next</span><span class="">
</span><span class="">      </span><span class="keyword3">assume</span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_partition sysconf d&quot;</span><span class="">
</span><span class="">      </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1">proof</span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;is_a_transmitter sysconf d&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;is_a_transmitter sysconf d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">        </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">        </span><span class="keyword1">{</span><span class="">
</span><span class="">          </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;vpeq_transmitter s&#39; d t&#39;&quot;</span><span class=""> </span><span class="keyword1">unfolding</span><span class=""> </span><span class="">vpeq_transmitter_def</span><span class="">
</span><span class="">          </span><span class="keyword1">proof</span><span class="">-</span><span class="">
</span><span class="">            </span><span class="keyword1">from</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">p8</span><span class="">
</span><span class="">            </span><span class="keyword3">show</span><span class=""> </span><span class="string">&quot;comm s&#39; = comm t&#39; &#8743; part_ports s&#39; = part_ports t&#39; &quot;</span><span class="">
</span><span class="">              </span><span class="keyword1">using</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">trans_que_msg_mlost_presrv_comm_part_ports</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">force</span><span class=""> 
</span><span class="">          </span><span class="keyword1">qed</span><span class="">
</span><span class="">        </span><span class="keyword1">}</span><span class="">
</span><span class="">        </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1">qed</span><span class="">
</span><span class="">      </span><span class="keyword1">next</span><span class="">
</span><span class="">        </span><span class="keyword3">assume</span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;&#172; is_a_transmitter sysconf d&quot;</span><span class="">
</span><span class="">        </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1">qed</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">  </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">lemma</span><span class=""> </span><span class="">trans_que_msg_mlost_presrv_wk_stp_cons_e</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;weak_step_consistent_e (sys (Transfer_Queuing_Message c))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">trans_que_msg_mlost_presrv_wk_stp_cons</span><span class=""> </span><span class="">weak_step_consistent_e_def</span><span class=""> </span><span class="">exec_event_def</span><span class=""> </span><span class="">mem_Collect_eq</span><span class="">
</span><span class="">      </span><span class="">non_interference1_def</span><span class=""> </span><span class="">non_interference_def</span><span class=""> </span><span class="">singletonD</span><span class=""> </span><span class="">sched_vpeq</span><span class=""> </span><span class="">same_part_mode</span><span class="">
</span><span class="">        </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Event.case</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">System_Event.case</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">domain_of_event.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">event_enabled.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="">option.sel</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">is_a_transmitter_def</span><span class=""> </span><span class="">vpeq1_def</span><span class=""> </span><span class="">vpeq_sched_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1">subsubsection</span><span class="verbatim">{*proving the &quot;weakly step consistent&quot; property*}</span><span class="">
</span><span class="">  </span><span class="keyword1">theorem</span><span class=""> </span><span class="">weak_step_consistent</span><span class="delimiter">:</span><span class="">weak_step_consistent</span><span class="">
</span><span class="">    </span><span class="keyword1">proof</span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1">{</span><span class="">
</span><span class="">        </span><span class="keyword3">fix</span><span class=""> </span><span class="">e</span><span class="">
</span><span class="">        </span><span class="keyword1">have</span><span class=""> </span><span class="string">&quot;weak_step_consistent_e e&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="improper">apply</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">e</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1">using</span><span class=""> </span><span class="">crt_smpl_port_presrv_wk_stp_cons_e</span><span class=""> </span><span class="">wrt_smpl_msg_presrv_wk_stp_cons_e</span><span class=""> 
</span><span class="">                  </span><span class="">read_smpl_msg_presrv_wk_stp_cons_e</span><span class=""> </span><span class="">get_smpl_pid_presrv_wk_stp_cons_e</span><span class=""> 
</span><span class="">                  </span><span class="">get_smpl_psts_presrv_wk_stp_cons_e</span><span class=""> </span><span class="">crt_que_port_presrv_wk_stp_cons_e</span><span class=""> 
</span><span class="">                  </span><span class="">snd_que_msg_lst_presrv_wk_stp_cons_e</span><span class=""> </span><span class="">rec_que_msg_presrv_wk_stp_cons_e</span><span class=""> 
</span><span class="">                  </span><span class="">get_que_pid_presrv_wk_stp_cons_e</span><span class=""> </span><span class="">get_que_psts_presrv_wk_stp_cons_e</span><span class=""> 
</span><span class="">                  </span><span class="">clr_que_port_presrv_wk_stp_cons_e</span><span class=""> </span><span class="">set_part_mode_presrv_wk_stp_cons_e</span><span class=""> 
</span><span class="">                  </span><span class="">get_part_status_presrv_wk_stp_cons_e</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="improper">apply</span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">Hypercall.induct</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1">using</span><span class=""> </span><span class="">schedule_presrv_wk_stp_cons_e</span><span class=""> </span><span class="">trans_smpl_msg_presrv_wk_stp_cons_e</span><span class="">
</span><span class="">                </span><span class="">trans_que_msg_mlost_presrv_wk_stp_cons_e</span><span class=""> 
</span><span class="">          </span><span class="keyword1">by</span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">System_Event.induct</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1">}</span><span class="">
</span><span class="">      </span><span class="keyword1">then</span><span class=""> </span><span class="keyword3">show</span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">weak_step_consistent_all_evt</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1">qed</span><span class="">
</span><span class="">
</span><span class="keyword1">subsection</span><span class="verbatim">{* Information flow security of top-level specification *}</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">theorem</span><span class=""> </span><span class="">noninfluence_sat</span><span class="delimiter">:</span><span class=""> </span><span class="">noninfluence</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">local_respect</span><span class=""> </span><span class="">uc_eq_noninf</span><span class=""> </span><span class="">weak_step_consistent</span><span class=""> </span><span class="">weak_with_step_cons</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1">theorem</span><span class=""> </span><span class="">noninfluence_gen_sat</span><span class="delimiter">:</span><span class=""> </span><span class="">noninfluence_gen</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">noninf_eq_noninf_gen</span><span class=""> </span><span class="">noninfluence_sat</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">
</span><span class="">  </span><span class="keyword1">theorem</span><span class=""> </span><span class="">weak_noninfluence_sat</span><span class="delimiter">:</span><span class=""> </span><span class="">weak_noninfluence</span><span class=""> </span><span class="keyword1">using</span><span class=""> </span><span class="">noninf_impl_weak</span><span class=""> </span><span class="">noninfluence_sat</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    
</span><span class="">  </span><span class="keyword1">theorem</span><span class=""> </span><span class="">nonleakage_sat</span><span class="delimiter">:</span><span class=""> </span><span class="">nonleakage</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">noninf_impl_nonlk</span><span class=""> </span><span class="">noninfluence_sat</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  
</span><span class="">  </span><span class="keyword1">theorem</span><span class=""> </span><span class="">noninterference_r_sat</span><span class="delimiter">:</span><span class=""> </span><span class="">noninterference_r</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">noninf_impl_nonintf_r</span><span class=""> </span><span class="">noninfluence_sat</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    
</span><span class="">  </span><span class="keyword1">theorem</span><span class=""> </span><span class="">noninterference_sat</span><span class="delimiter">:</span><span class=""> </span><span class="">noninterference</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">noninterference_r_sat</span><span class=""> </span><span class="">nonintf_r_impl_noninterf</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    
</span><span class="">  </span><span class="keyword1">theorem</span><span class=""> </span><span class="">weak_noninterference_r_sat</span><span class="delimiter">:</span><span class=""> </span><span class="">weak_noninterference_r</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">noninterference_r_sat</span><span class=""> </span><span class="">nonintf_r_impl_wk_nonintf_r</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    
</span><span class="">  </span><span class="keyword1">theorem</span><span class=""> </span><span class="">weak_noninterference_sat</span><span class="delimiter">:</span><span class=""> </span><span class="">weak_noninterference</span><span class="">
</span><span class="">    </span><span class="keyword1">using</span><span class=""> </span><span class="">noninterference_sat</span><span class=""> </span><span class="">nonintf_impl_weak</span><span class=""> </span><span class="keyword1">by</span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">
</span><span class="keyword2">end</span><span class="">
</span></pre>

</div>
</body>
</html>
