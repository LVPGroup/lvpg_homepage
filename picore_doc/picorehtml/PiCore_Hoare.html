<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Theory PiCore_Hoare (Isabelle2017: October 2017)</title>
<link media="all" rel="stylesheet" type="text/css" href="isabelle.css"/>
</head>

<body>
<div class="head"><h1>Theory PiCore_Hoare</h1>

<span class="command">theory</span> <span class="name">PiCore_Hoare</span><br/>
<span class="keyword">imports</span> <a href="PiCore_Validity.html"><span class="name">PiCore_Validity</span></a><br/>

</div>
<div class="source">
<pre class="source"><span class="comment">(*
Created by Yongwang Zhao (ywzhao@ntu.edu.sg, zhaoyw@buaa.edu.cn)
School of Computer Engineering, Nanyang Technological University, Singapore
and School of Computer Science &amp; Engineering, Beihang University, China
*)</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">section</span></span><span class=""> </span><span class="cartouche">&#8249;The Proof System of PiCore&#8250;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">theory</span></span><span class=""> </span><span class="">PiCore_Hoare</span><span class="">
</span><span class="keyword2"><span class="keyword">imports</span></span><span class=""> </span><span class="">PiCore_Validity</span><span class="">
</span><span class="keyword2"><span class="keyword">begin</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">subsection</span></span><span class=""> </span><span class="cartouche">&#8249;Proof System for Programs&#8250;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">declare</span></span><span class=""> </span><span class="">Un_subset_iff</span><span class=""> </span><span class="delimiter">[</span><span class="">simp</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class=""> </span><span class="">sup.bounded_iff</span><span class=""> </span><span class="delimiter">[</span><span class="">simp</span><span class=""> </span><span class="">del</span><span class="delimiter">]</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">definition</span></span><span class=""> </span><span class="">stable</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;&#39;a set &#8658; (&#39;a &#215; &#39;a) set &#8658; bool&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class="">
</span><span class="">  </span><span class="string">&quot;stable &#8801; &#955;f g. (&#8704;x y. x &#8712; f &#10230; (x, y) &#8712; g &#10230; y &#8712; f)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">inductive</span></span><span class=""> </span><span class="">rghoare_p</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;[&#39;s prog, &#39;s set, (&#39;s &#215; &#39;s) set, (&#39;s &#215; &#39;s) set, &#39;s set] &#8658; bool&quot;</span><span class="">
</span><span class="">    </span><span class="delimiter">(</span><span class="string">&quot;&#8866; _ sat<span class="hidden">&#8681;</span><sub>p</sub> [_, _, _, _]&quot;</span><span class=""> </span><span class="delimiter">[</span><span class="">60</span><span class="delimiter">,</span><span class="">0</span><span class="delimiter">,</span><span class="">0</span><span class="delimiter">,</span><span class="">0</span><span class="delimiter">,</span><span class="">0</span><span class="delimiter">]</span><span class=""> </span><span class="">45</span><span class="delimiter">)</span><span class="">
</span><span class="keyword2"><span class="keyword">where</span></span><span class="">
</span><span class="">  </span><span class="">Basic</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; pre &#8838; {s. f s &#8712; post}; {(s,t). s &#8712; pre &#8743; (t=f s)} &#8838; guar;
            stable pre rely; stable post rely &#10215;
           &#10233; &#8866; Basic f sat<span class="hidden">&#8681;</span><sub>p</sub> [pre, rely, guar, post]&quot;</span><span class="">
</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">Seq</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; &#8866; P sat<span class="hidden">&#8681;</span><sub>p</sub> [pre, rely, guar, mid]; &#8866; Q sat<span class="hidden">&#8681;</span><sub>p</sub> [mid, rely, guar, post] &#10215;
           &#10233; &#8866; Seq P Q sat<span class="hidden">&#8681;</span><sub>p</sub> [pre, rely, guar, post]&quot;</span><span class="">
</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">Cond</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; stable pre rely; &#8866; P1 sat<span class="hidden">&#8681;</span><sub>p</sub> [pre &#8745; b, rely, guar, post];
           &#8866; P2 sat<span class="hidden">&#8681;</span><sub>p</sub> [pre &#8745; -b, rely, guar, post]; &#8704;s. (s,s)&#8712;guar &#10215;
          &#10233; &#8866; Cond b P1 P2 sat<span class="hidden">&#8681;</span><sub>p</sub> [pre, rely, guar, post]&quot;</span><span class="">
</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">While</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; stable pre rely; (pre &#8745; -b) &#8838; post; stable post rely;
            &#8866; P sat<span class="hidden">&#8681;</span><sub>p</sub> [pre &#8745; b, rely, guar, pre]; &#8704;s. (s,s)&#8712;guar &#10215;
          &#10233; &#8866; While b P sat<span class="hidden">&#8681;</span><sub>p</sub> [pre, rely, guar, post]&quot;</span><span class="">
</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">Await</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; stable pre rely; stable post rely;
            &#8704;V. &#8866; P sat<span class="hidden">&#8681;</span><sub>p</sub> [pre &#8745; b &#8745; {V}, {(s, t). s = t},
                UNIV, {s. (V, s) &#8712; guar} &#8745; post] &#10215;
           &#10233; &#8866; Await b P sat<span class="hidden">&#8681;</span><sub>p</sub> [pre, rely, guar, post]&quot;</span><span class="">
</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">Nondt</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; pre &#8838; {s. (&#8704;t. (s,t) &#8712; r &#10230; t &#8712; post) &#8743; (&#8707;t. (s,t) &#8712; r)}; {(s,t). s &#8712; pre &#8743; (s,t)&#8712;r} &#8838; guar;
            stable pre rely; stable post rely &#10215;
           &#10233; &#8866; Nondt r sat<span class="hidden">&#8681;</span><sub>p</sub> [pre, rely, guar, post]&quot;</span><span class="">
</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">Conseq</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; pre &#8838; pre&#39;; rely &#8838; rely&#39;; guar&#39; &#8838; guar; post&#39; &#8838; post;
             &#8866; P sat<span class="hidden">&#8681;</span><sub>p</sub> [pre&#39;, rely&#39;, guar&#39;, post&#39;] &#10215;
            &#10233; &#8866; P sat<span class="hidden">&#8681;</span><sub>p</sub> [pre, rely, guar, post]&quot;</span><span class="">
</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">Unprecond</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; &#8866; P sat<span class="hidden">&#8681;</span><sub>p</sub> [pre, rely, guar, post]; &#8866; P sat<span class="hidden">&#8681;</span><sub>p</sub> [pre&#39;, rely, guar, post] &#10215;
            &#10233; &#8866; P sat<span class="hidden">&#8681;</span><sub>p</sub> [pre &#8746; pre&#39;, rely, guar, post]&quot;</span><span class="">
</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">Intpostcond</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; &#8866; P sat<span class="hidden">&#8681;</span><sub>p</sub> [pre, rely, guar, post]; &#8866; P sat<span class="hidden">&#8681;</span><sub>p</sub> [pre, rely, guar, post&#39;] &#10215;
            &#10233; &#8866; P sat<span class="hidden">&#8681;</span><sub>p</sub> [pre, rely, guar, post &#8745; post&#39;]&quot;</span><span class="">
</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">Allprecond</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;v&#8712;U. &#8866; P sat<span class="hidden">&#8681;</span><sub>p</sub> [{v}, rely, guar, post]
            &#10233; &#8866; P sat<span class="hidden">&#8681;</span><sub>p</sub> [U, rely, guar, post]&quot;</span><span class="">
</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">Emptyprecond</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8866; P sat<span class="hidden">&#8681;</span><sub>p</sub> [{}, rely, guar, post]&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="string">&quot;Id = {(s, t). s = t}&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">Seq2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; &#8866; P sat<span class="hidden">&#8681;</span><sub>p</sub> [pre, rely, guar, mida]; mida &#8838; midb; &#8866; Q sat<span class="hidden">&#8681;</span><sub>p</sub> [midb, rely, guar, post] &#10215;
  &#10233; &#8866; Seq P Q sat<span class="hidden">&#8681;</span><sub>p</sub> [pre, rely, guar, post]&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Seq</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">P</span><span class=""> </span><span class="">pre</span><span class=""> </span><span class="">rely</span><span class=""> </span><span class="">guar</span><span class=""> </span><span class="">mida</span><span class=""> </span><span class="">Q</span><span class=""> </span><span class="">post</span><span class="delimiter">]</span><span class=""> 
</span><span class="">        </span><span class="">Conseq</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">mida</span><span class=""> </span><span class="">midb</span><span class=""> </span><span class="">rely</span><span class=""> </span><span class="">rely</span><span class=""> </span><span class="">guar</span><span class=""> </span><span class="">guar</span><span class=""> </span><span class="">post</span><span class=""> </span><span class="">post</span><span class=""> </span><span class="">Q</span><span class="delimiter">]</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">subsection</span></span><span class=""> </span><span class="cartouche">&#8249;Rely-guarantee Condition&#8250;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">record</span></span><span class=""> </span><span class="tfree">&#39;s</span><span class=""> </span><span class="">rgformula</span><span class=""> </span><span class="delimiter">=</span><span class="">
</span><span class="">    </span><span class="">pre_rgf</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;&#39;s set&quot;</span><span class="">
</span><span class="">    </span><span class="">rely_rgf</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;s &#215; &#39;s) set&quot;</span><span class="">
</span><span class="">    </span><span class="">guar_rgf</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;s &#215; &#39;s) set&quot;</span><span class="">
</span><span class="">    </span><span class="">post_rgf</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;&#39;s set&quot;</span><span class="">    
</span><span class="">
</span><span class="keyword1"><span class="command">definition</span></span><span class=""> </span><span class="">getrgformula</span><span class=""> </span><span class="delimiter">::</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;&#39;s set &#8658; (&#39;s &#215; &#39;s) set &#8658; (&#39;s &#215; &#39;s) set &#8658; &#39;s set &#8658; &#39;s rgformula&quot;</span><span class=""> </span><span class="delimiter">(</span><span class="string">&quot;RG[_,_,_,_]&quot;</span><span class=""> </span><span class="delimiter">[</span><span class="">91</span><span class="delimiter">,</span><span class="">91</span><span class="delimiter">,</span><span class="">91</span><span class="delimiter">,</span><span class="">91</span><span class="delimiter">]</span><span class=""> </span><span class="">90</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;getrgformula pre r g pst &#8801; &#10631;pre_rgf = pre, rely_rgf = r, guar_rgf = g, post_rgf = pst&#10632;&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">definition</span></span><span class=""> </span><span class="">Pre<span class="hidden">&#8681;</span><sub>f</sub></span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;&#39;s rgformula &#8658; &#39;s set&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;Pre<span class="hidden">&#8681;</span><sub>f</sub> rg = pre_rgf rg&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">definition</span></span><span class=""> </span><span class="">Rely<span class="hidden">&#8681;</span><sub>f</sub></span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;&#39;s rgformula &#8658; (&#39;s &#215; &#39;s) set&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;Rely<span class="hidden">&#8681;</span><sub>f</sub> rg = rely_rgf rg&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">definition</span></span><span class=""> </span><span class="">Guar<span class="hidden">&#8681;</span><sub>f</sub></span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;&#39;s rgformula &#8658; (&#39;s &#215; &#39;s) set&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;Guar<span class="hidden">&#8681;</span><sub>f</sub> rg = guar_rgf rg&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">definition</span></span><span class=""> </span><span class="">Post<span class="hidden">&#8681;</span><sub>f</sub></span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;&#39;s rgformula &#8658; &#39;s set&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;Post<span class="hidden">&#8681;</span><sub>f</sub> rg = post_rgf rg&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">type_synonym</span></span><span class=""> </span><span class="delimiter">(</span><span class="tfree">&#39;l</span><span class="delimiter">,</span><span class="tfree">&#39;k</span><span class="delimiter">,</span><span class="tfree">&#39;s</span><span class="delimiter">)</span><span class=""> </span><span class="">rgformula_e</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) event &#215; &#39;s rgformula&quot;</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">datatype</span></span><span class=""> </span><span class="delimiter">(</span><span class="tfree">&#39;l</span><span class="delimiter">,</span><span class="tfree">&#39;k</span><span class="delimiter">,</span><span class="tfree">&#39;s</span><span class="delimiter">)</span><span class=""> </span><span class="">rgformula_ess</span><span class=""> </span><span class="delimiter">=</span><span class=""> 
</span><span class="">      </span><span class="">rgf_EvtSeq</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) rgformula_e&quot;</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) rgformula_ess &#215; &#39;s rgformula&quot;</span><span class="">
</span><span class="">    </span><span class="delimiter">|</span><span class=""> </span><span class="">rgf_EvtSys</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) rgformula_e set&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">type_synonym</span></span><span class=""> </span><span class="delimiter">(</span><span class="tfree">&#39;l</span><span class="delimiter">,</span><span class="tfree">&#39;k</span><span class="delimiter">,</span><span class="tfree">&#39;s</span><span class="delimiter">)</span><span class=""> </span><span class="">rgformula_es</span><span class=""> </span><span class="delimiter">=</span><span class="">
</span><span class="">  </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) rgformula_ess &#215; &#39;s rgformula&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">type_synonym</span></span><span class=""> </span><span class="delimiter">(</span><span class="tfree">&#39;l</span><span class="delimiter">,</span><span class="tfree">&#39;k</span><span class="delimiter">,</span><span class="tfree">&#39;s</span><span class="delimiter">)</span><span class=""> </span><span class="">rgformula_par</span><span class=""> </span><span class="delimiter">=</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#39;k &#8658; (&#39;l,&#39;k,&#39;s) rgformula_es&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">definition</span></span><span class=""> </span><span class="">E<span class="hidden">&#8681;</span><sub>e</sub></span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) rgformula_e &#8658; (&#39;l,&#39;k,&#39;s) event&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;E<span class="hidden">&#8681;</span><sub>e</sub> rg = fst rg&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">definition</span></span><span class=""> </span><span class="">Pre<span class="hidden">&#8681;</span><sub>e</sub></span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) rgformula_e &#8658; &#39;s set&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;Pre<span class="hidden">&#8681;</span><sub>e</sub> rg = pre_rgf (snd rg)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">definition</span></span><span class=""> </span><span class="">Rely<span class="hidden">&#8681;</span><sub>e</sub></span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) rgformula_e &#8658; (&#39;s &#215; &#39;s) set&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;Rely<span class="hidden">&#8681;</span><sub>e</sub> rg = rely_rgf (snd rg)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">definition</span></span><span class=""> </span><span class="">Guar<span class="hidden">&#8681;</span><sub>e</sub></span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) rgformula_e &#8658; (&#39;s &#215; &#39;s) set&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;Guar<span class="hidden">&#8681;</span><sub>e</sub> rg = guar_rgf (snd rg)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">definition</span></span><span class=""> </span><span class="">Post<span class="hidden">&#8681;</span><sub>e</sub></span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) rgformula_e &#8658; &#39;s set&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;Post<span class="hidden">&#8681;</span><sub>e</sub>  rg = post_rgf (snd rg)&quot;</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">definition</span></span><span class=""> </span><span class="">Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub></span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) rgformula_es &#8658; &#39;s set&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> rg = pre_rgf (snd rg)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">definition</span></span><span class=""> </span><span class="">Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub></span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) rgformula_es &#8658; (&#39;s &#215; &#39;s) set&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> rg = rely_rgf (snd rg)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">definition</span></span><span class=""> </span><span class="">Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub></span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) rgformula_es &#8658; (&#39;s &#215; &#39;s) set&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> rg = guar_rgf (snd rg)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">definition</span></span><span class=""> </span><span class="">Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub></span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) rgformula_es &#8658; &#39;s set&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>  rg = post_rgf (snd rg)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">fun</span></span><span class=""> </span><span class="">evtsys_spec</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) rgformula_ess &#8658; (&#39;l,&#39;k,&#39;s) esys&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class="">
</span><span class="">  </span><span class="">evtsys_spec_evtseq</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;evtsys_spec (rgf_EvtSeq ef esf) = EvtSeq (E<span class="hidden">&#8681;</span><sub>e</sub> ef) (evtsys_spec (fst esf))&quot;</span><span class=""> </span><span class="delimiter">|</span><span class="">
</span><span class="">  </span><span class="">evtsys_spec_evtsys</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;evtsys_spec (rgf_EvtSys esf) = EvtSys (Domain esf)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">definition</span></span><span class=""> </span><span class="">paresys_spec</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) rgformula_par &#8658; (&#39;l,&#39;k,&#39;s) paresys&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;paresys_spec pesf &#8801; &#955;k. evtsys_spec (fst (pesf k))&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">subsection</span></span><span class=""> </span><span class="cartouche">&#8249;Proof System for Events&#8250;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">inductive</span></span><span class=""> </span><span class="">rghoare_e</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;[(&#39;l,&#39;k,&#39;s) event, &#39;s set, (&#39;s &#215; &#39;s) set, (&#39;s &#215; &#39;s) set, &#39;s set] &#8658; bool&quot;</span><span class="">
</span><span class="">    </span><span class="delimiter">(</span><span class="string">&quot;&#8866; _ sat<span class="hidden">&#8681;</span><sub>e</sub> [_, _, _, _]&quot;</span><span class=""> </span><span class="delimiter">[</span><span class="">60</span><span class="delimiter">,</span><span class="">0</span><span class="delimiter">,</span><span class="">0</span><span class="delimiter">,</span><span class="">0</span><span class="delimiter">,</span><span class="">0</span><span class="delimiter">]</span><span class=""> </span><span class="">45</span><span class="delimiter">)</span><span class="">
</span><span class="keyword2"><span class="keyword">where</span></span><span class="">
</span><span class="">  </span><span class="">AnonyEvt</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot; &#8866; P sat<span class="hidden">&#8681;</span><sub>p</sub> [pre, rely, guar, post] &#10233; &#8866; AnonyEvent (Some P) sat<span class="hidden">&#8681;</span><sub>e</sub> [pre, rely, guar, post]&quot;</span><span class="">
</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">BasicEvt</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; &#8866; body ev sat<span class="hidden">&#8681;</span><sub>p</sub> [pre&#8745;(guard ev), rely, guar, post]; 
          stable pre rely; &#8704;s. (s, s)&#8712;guar&#10215; &#10233; &#8866; BasicEvent ev sat<span class="hidden">&#8681;</span><sub>e</sub> [pre, rely, guar, post]&quot;</span><span class="">
</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">Evt_conseq</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; pre &#8838; pre&#39;; rely &#8838; rely&#39;; guar&#39; &#8838; guar; post&#39; &#8838; post;
                       &#8866; ev sat<span class="hidden">&#8681;</span><sub>e</sub> [pre&#39;, rely&#39;, guar&#39;, post&#39;] &#10215;
                      &#10233; &#8866; ev sat<span class="hidden">&#8681;</span><sub>e</sub> [pre, rely, guar, post]&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">definition</span></span><span class=""> </span><span class="">Evt_sat_RG</span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) event &#8658; &#39;s rgformula &#8658; bool&quot;</span><span class=""> </span><span class="delimiter">(</span><span class="string">&quot;(_&#8866;_)&quot;</span><span class=""> </span><span class="delimiter">[</span><span class="">60</span><span class="delimiter">,</span><span class="">60</span><span class="delimiter">]</span><span class=""> </span><span class="">61</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;Evt_sat_RG e rg &#8801; &#8866; e sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre<span class="hidden">&#8681;</span><sub>f</sub> rg, Rely<span class="hidden">&#8681;</span><sub>f</sub> rg, Guar<span class="hidden">&#8681;</span><sub>f</sub> rg, Post<span class="hidden">&#8681;</span><sub>f</sub> rg]&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">subsection</span></span><span class=""> </span><span class="cartouche">&#8249;Proof System for Event Systems&#8250;</span><span class="">
</span><span class="keyword1"><span class="command">inductive</span></span><span class=""> </span><span class="">rghoare_es</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;[(&#39;l,&#39;k,&#39;s) rgformula_ess, &#39;s set, (&#39;s &#215; &#39;s) set, (&#39;s &#215; &#39;s) set, &#39;s set] &#8658; bool&quot;</span><span class="">
</span><span class="">    </span><span class="delimiter">(</span><span class="string">&quot;&#8866; _ sat<span class="hidden">&#8681;</span><sub>s</sub> [_, _, _, _]&quot;</span><span class=""> </span><span class="delimiter">[</span><span class="">60</span><span class="delimiter">,</span><span class="">0</span><span class="delimiter">,</span><span class="">0</span><span class="delimiter">,</span><span class="">0</span><span class="delimiter">,</span><span class="">0</span><span class="delimiter">]</span><span class=""> </span><span class="">45</span><span class="delimiter">)</span><span class="">
</span><span class="keyword2"><span class="keyword">where</span></span><span class="">
</span><span class="">  </span><span class="">EvtSeq_h</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; &#8866; E<span class="hidden">&#8681;</span><sub>e</sub> ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre<span class="hidden">&#8681;</span><sub>e</sub> ef, Rely<span class="hidden">&#8681;</span><sub>e</sub> ef, Guar<span class="hidden">&#8681;</span><sub>e</sub> ef, Post<span class="hidden">&#8681;</span><sub>e</sub> ef]; 
              &#8866; fst esf sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre<span class="hidden">&#8681;</span><sub>f</sub> (snd esf), Rely<span class="hidden">&#8681;</span><sub>f</sub> (snd esf), Guar<span class="hidden">&#8681;</span><sub>f</sub> (snd esf), Post<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)]; 
              pre = Pre<span class="hidden">&#8681;</span><sub>e</sub> ef; post = Post<span class="hidden">&#8681;</span><sub>f</sub> (snd esf);
              rely &#8838; Rely<span class="hidden">&#8681;</span><sub>e</sub> ef; rely &#8838;Rely<span class="hidden">&#8681;</span><sub>f</sub> (snd esf); 
              Guar<span class="hidden">&#8681;</span><sub>e</sub> ef &#8838; guar; Guar<span class="hidden">&#8681;</span><sub>f</sub> (snd esf) &#8838; guar; 
              Post<span class="hidden">&#8681;</span><sub>e</sub> ef &#8838; Pre<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)&#10215; 
              &#10233; &#8866; (rgf_EvtSeq ef esf) sat<span class="hidden">&#8681;</span><sub>s</sub> [pre, rely, guar, post]&quot;</span><span class="">
</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">EvtSys_h</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;&#8704;ef&#8712; esf. &#8866; E<span class="hidden">&#8681;</span><sub>e</sub> ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre<span class="hidden">&#8681;</span><sub>e</sub> ef, Rely<span class="hidden">&#8681;</span><sub>e</sub> ef, Guar<span class="hidden">&#8681;</span><sub>e</sub> ef, Post<span class="hidden">&#8681;</span><sub>e</sub> ef];
             &#8704;ef&#8712; esf. pre &#8838; Pre<span class="hidden">&#8681;</span><sub>e</sub> ef;  &#8704;ef&#8712; esf. rely &#8838; Rely<span class="hidden">&#8681;</span><sub>e</sub> ef;
             &#8704;ef&#8712; esf. Guar<span class="hidden">&#8681;</span><sub>e</sub> ef &#8838; guar; &#8704;ef&#8712; esf. Post<span class="hidden">&#8681;</span><sub>e</sub> ef &#8838; post;
             &#8704;ef1 ef2. ef1&#8712; esf &#8743; ef2&#8712; esf &#10230; Post<span class="hidden">&#8681;</span><sub>e</sub> ef1 &#8838; Pre<span class="hidden">&#8681;</span><sub>e</sub> ef2;
             stable pre rely; &#8704;s. (s, s)&#8712;guar&#10215;
             &#10233; &#8866; rgf_EvtSys esf sat<span class="hidden">&#8681;</span><sub>s</sub> [pre, rely, guar, post]&quot;</span><span class="">
</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">EvtSys_conseq</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; pre &#8838; pre&#39;; rely &#8838; rely&#39;; guar&#39; &#8838; guar; post&#39; &#8838; post;
                       &#8866; esys sat<span class="hidden">&#8681;</span><sub>s</sub> [pre&#39;, rely&#39;, guar&#39;, post&#39;] &#10215;
                      &#10233; &#8866; esys sat<span class="hidden">&#8681;</span><sub>s</sub> [pre, rely, guar, post]&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">subsection</span></span><span class=""> </span><span class="cartouche">&#8249;Proof System for Parallel Event Systems&#8250;</span><span class="">
</span><span class="keyword1"><span class="command">inductive</span></span><span class=""> </span><span class="">rghoare_pes</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;[(&#39;l,&#39;k,&#39;s) rgformula_par, &#39;s set, (&#39;s &#215; &#39;s) set, (&#39;s &#215; &#39;s) set, &#39;s set] &#8658; bool&quot;</span><span class="">
</span><span class="">          </span><span class="delimiter">(</span><span class="string">&quot;&#8866; _ SAT [_, _, _, _]&quot;</span><span class=""> </span><span class="delimiter">[</span><span class="">60</span><span class="delimiter">,</span><span class="">0</span><span class="delimiter">,</span><span class="">0</span><span class="delimiter">,</span><span class="">0</span><span class="delimiter">,</span><span class="">0</span><span class="delimiter">]</span><span class=""> </span><span class="">45</span><span class="delimiter">)</span><span class=""> 
</span><span class="keyword2"><span class="keyword">where</span></span><span class="">
</span><span class="">  </span><span class="">ParallelESys</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;&#8704;k. &#8866; fst (pesf k) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesf k), Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesf k), Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesf k), Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesf k)]; 
                  &#8704;k. pre &#8838; Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesf k); 
                  &#8704;k. rely &#8838; Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesf k); 
                  &#8704;k j. j&#8800;k &#10230;  Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesf j) &#8838; Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesf k);
                  &#8704;k. Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesf k) &#8838; guar;
                  &#8704;k. Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesf k) &#8838; post&#10215; 
              &#10233; &#8866; pesf SAT [pre, rely, guar, post]&quot;</span><span class="">
</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">ParallelESys_conseq</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; pre &#8838; pre&#39;; rely &#8838; rely&#39;; guar&#39; &#8838; guar; post&#39; &#8838; post;
                       &#8866; pesf SAT [pre&#39;, rely&#39;, guar&#39;, post&#39;] &#10215;
                      &#10233; &#8866; pesf SAT [pre, rely, guar, post]&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">section</span></span><span class=""> </span><span class="cartouche">&#8249;Soundness&#8250;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">subsection</span></span><span class=""> </span><span class="cartouche">&#8249;Some previous lemmas&#8250;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">subsubsection</span></span><span class=""> </span><span class="cartouche">&#8249;program&#8250;</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">tl_of_assum_in_assum</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;(P, s) # (P, t) # xs &#8712; assume_p (pre, rely) &#10233; stable pre rely
  &#10233; (P, t) # xs &#8712; assume_p (pre, rely)&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">0</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="delimiter">(</span><span class="">no_asm_use</span><span class="delimiter">)</span><span class="">only</span><span class="delimiter">:</span><span class="">stable_def</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class="">erule</span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class="">erule</span><span class=""> </span><span class="">impE</span><span class="delimiter">,</span><span class="">assumption</span><span class="delimiter">,</span><span class="">erule</span><span class=""> </span><span class="">mp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">EnvP</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_p_def</span><span class=""> </span><span class="">gets_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">fastforce</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">etran_in_comm</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;(P, t) # xs &#8712; commit_p(guar, post) &#10233; (P, s) # (P, t) # xs &#8712; commit_p(guar, post)&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_p_def</span><span class=""> </span><span class="">gets_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">i</span><span class="delimiter">,</span><span class="">fastforce</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">ctran_in_comm</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#10214;(s, s) &#8712; guar; (Q, s) # xs &#8712; commit_p(guar, post)&#10215;
  &#10233; (P, s) # (Q, s) # xs &#8712; commit_p(guar, post)&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_p_def</span><span class=""> </span><span class="">gets_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">i</span><span class="delimiter">,</span><span class="">fastforce</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">takecptn_is_cptn</span><span class=""> </span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">,</span><span class=""> </span><span class="">elim</span><span class="delimiter">!</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#8704;j. c &#8712; cpts_p &#10230; take (Suc j) c &#8712; cpts_p&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;c&quot;</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">elim</span><span class="delimiter">:</span><span class=""> </span><span class="">cpts_p.cases</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">j</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">CptsPOne</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">intro</span><span class="delimiter">:</span><span class="">cpts_p.intros</span><span class=""> </span><span class="">elim</span><span class="delimiter">:</span><span class="">cpts_p.cases</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">dropcptn_is_cptn</span><span class=""> </span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">,</span><span class="">elim</span><span class="delimiter">!</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#8704;j&lt;length c. c &#8712; cpts_p &#10230; drop j c &#8712; cpts_p&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="string">&quot;c&quot;</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">elim</span><span class="delimiter">:</span><span class=""> </span><span class="">cpts_p.cases</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">j</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">cpts_p.cases</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">tl_of_cptn_is_cptn</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;x # xs &#8712; cpts_p; xs &#8800; []&#10215; &#10233; xs  &#8712; cpts_p&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">subgoal_tac</span><span class=""> </span><span class="string">&quot;1 &lt; length (x # xs)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule</span><span class=""> </span><span class="">dropcptn_is_cptn</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">not_ctran_None</span><span class=""> </span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#8704;s. (None, s)#xs &#8712; cpts_p &#10230; (&#8704;i&lt;length xs. ((None, s)#xs)!i -pe&#8594; xs!i)&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">xs</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">cpts_p.cases</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">i</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">EnvP</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">elim</span><span class="delimiter">:</span><span class="">ptran.cases</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">cptn_not_empty</span><span class=""> </span><span class="delimiter">[</span><span class="">simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="string">&quot;[] &#8713; cpts_p&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">elim</span><span class="delimiter">:</span><span class="">cpts_p.cases</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">etran_or_ctran</span><span class=""> </span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#8704;m i. x&#8712;cpts_p &#10230; m &#8804; length x
   &#10230; (&#8704;i. Suc i &lt; m &#10230; &#172; x!i -c&#8594; x!Suc i) &#10230; Suc i &lt; m
   &#10230; x!i -pe&#8594; x!Suc i&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">x</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">cpts_p.cases</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">i</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">EnvP</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;m - 1&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">m</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">subgoal_tac</span><span class=""> </span><span class="string">&quot;(&#8704;i. Suc i &lt; nata &#10230; (((P, t) # xs) ! i, xs ! i) &#8713; ptran)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;Suc ia&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;0&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">P</span><span class="delimiter">=</span><span class="string">&quot;&#955;j. H j &#10230; (J j) &#8713; ptran&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">for</span></span><span class=""> </span><span class="">H</span><span class=""> </span><span class="">J</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">etran_or_ctran2</span><span class=""> </span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#8704;i. Suc i&lt;length x &#10230; x&#8712;cpts_p &#10230; (x!i -c&#8594; x!Suc i &#10230; &#172; x!i -pe&#8594; x!Suc i)
  &#8744; (x!i -pe&#8594; x!Suc i &#10230; &#172; x!i -c&#8594; x!Suc i)&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">cpts_p.cases</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">i</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">i</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">elim</span><span class="delimiter">:</span><span class="">petran.cases</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">etran_or_ctran2_disjI1</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#10214; x&#8712;cpts_p; Suc i&lt;length x; x!i -c&#8594; x!Suc i&#10215; &#10233; &#172; x!i -pe&#8594; x!Suc i&quot;</span><span class="">
</span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span class="">drule</span><span class=""> </span><span class="">etran_or_ctran2</span><span class="delimiter">,</span><span class="">simp_all</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">etran_or_ctran2_disjI2</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#10214; x&#8712;cpts_p; Suc i&lt;length x; x!i -pe&#8594; x!Suc i&#10215; &#10233; &#172; x!i -c&#8594; x!Suc i&quot;</span><span class="">
</span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span class="">drule</span><span class=""> </span><span class="">etran_or_ctran2</span><span class="delimiter">,</span><span class="">simp_all</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">not_ctran_None2</span><span class=""> </span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#10214; (None, s) # xs &#8712;cpts_p; i&lt;length xs&#10215; &#10233; &#172; ((None, s) # xs) ! i -c&#8594; xs ! i&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">frule</span><span class=""> </span><span class="">not_ctran_None</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">i</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">elim</span><span class="delimiter">:</span><span class="">petranE</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">etran_or_ctran2_disjI2</span><span class="delimiter">,</span><span class="">simp_all</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">intro</span><span class="delimiter">:</span><span class="">tl_of_cptn_is_cptn</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">Ex_first_occurrence</span><span class=""> </span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;P (n::nat) &#10230; (&#8707;m. P m &#8743; (&#8704;i&lt;m. &#172; P i))&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">nat_less_induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;&#8704;m. m&lt;n &#10230; &#172; P m&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">stability</span><span class=""> </span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#8704;j k. x &#8712; cpts_p &#10230; stable p rely &#10230; j&#8804;k &#10230; k&lt;length x &#10230; snd(x!j)&#8712;p  &#10230;
  (&#8704;i. (Suc i)&lt;length x &#10230;
          (x!i -pe&#8594; x!(Suc i)) &#10230; (snd(x!i), snd(x!(Suc i))) &#8712; rely) &#10230;
  (&#8704;i. j&#8804;i &#8743; i&lt;k &#10230; x!i -pe&#8594; x!Suc i) &#10230; snd(x!k)&#8712;p &#8743; fst(x!j)=fst(x!k)&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">elim</span><span class="delimiter">:</span><span class="">cpts_p.cases</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">cpts_p.cases</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">k</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">j</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">0</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;nat&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">P</span><span class="delimiter">=</span><span class="string">&quot;&#955;j. (0&#8804;j) &#10230; (J j)&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">for</span></span><span class=""> </span><span class="">J</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">subgoal_tac</span><span class=""> </span><span class="string">&quot;t&#8712;p&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">subgoal_tac</span><span class=""> </span><span class="string">&quot;(&#8704;i. i &lt; length xs &#10230; ((P, t) # xs) ! i -pe&#8594; xs ! i &#10230; (snd (((P, t) # xs) ! i), snd (xs ! i)) &#8712; rely)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;Suc i&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">P</span><span class="delimiter">=</span><span class="string">&quot;&#955;j. (H j) &#10230; (J j)&#8712;petran&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">for</span></span><span class=""> </span><span class="">H</span><span class=""> </span><span class="">J</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;Suc i&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">P</span><span class="delimiter">=</span><span class="string">&quot;&#955;j. (H j) &#10230; (J j) &#10230; (T j)&#8712;rely&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">for</span></span><span class=""> </span><span class="">H</span><span class=""> </span><span class="">J</span><span class=""> </span><span class="">T</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">0</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">P</span><span class="delimiter">=</span><span class="string">&quot;&#955;j. (H j) &#10230; (J j)&#8712;petran &#10230; T j&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">for</span></span><span class=""> </span><span class="">H</span><span class=""> </span><span class="">J</span><span class=""> </span><span class="">T</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class="delimiter">(</span><span class="">no_asm_use</span><span class="delimiter">)</span><span class=""> </span><span class="">only</span><span class="delimiter">:</span><span class="">stable_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">s</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">t</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">mp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">mp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">EnvP</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;nata&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;nat&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">P</span><span class="delimiter">=</span><span class="string">&quot;&#955;j. (s&#8804;j) &#10230; (J j)&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">for</span></span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">J</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">subgoal_tac</span><span class=""> </span><span class="string">&quot;(&#8704;i. i &lt; length xs &#10230; ((P, t) # xs) ! i -pe&#8594; xs ! i &#10230; (snd (((P, t) # xs) ! i), snd (xs ! i)) &#8712; rely)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;Suc i&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">P</span><span class="delimiter">=</span><span class="string">&quot;&#955;j. (H j) &#10230; (J j)&#8712;petran&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">for</span></span><span class=""> </span><span class="">H</span><span class=""> </span><span class="">J</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;Suc i&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">P</span><span class="delimiter">=</span><span class="string">&quot;&#955;j. (H j) &#10230; (J j) &#10230; (T j)&#8712;rely&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">for</span></span><span class=""> </span><span class="">H</span><span class=""> </span><span class="">J</span><span class=""> </span><span class="">T</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">k</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">j</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">0</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">P</span><span class="delimiter">=</span><span class="string">&quot;&#955;j. (H j) &#10230; (J j)&#8712;petran&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">for</span></span><span class=""> </span><span class="">H</span><span class=""> </span><span class="">J</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">petran.cases</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;nata&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;nat&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">P</span><span class="delimiter">=</span><span class="string">&quot;&#955;j. (s&#8804;j) &#10230; (J j)&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">for</span></span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">J</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">subgoal_tac</span><span class=""> </span><span class="string">&quot;(&#8704;i. i &lt; length xs &#10230; ((Q, t) # xs) ! i -pe&#8594; xs ! i &#10230; (snd (((Q, t) # xs) ! i), snd (xs ! i)) &#8712; rely)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;Suc i&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">P</span><span class="delimiter">=</span><span class="string">&quot;&#955;j. (H j) &#10230; (J j)&#8712;petran&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">for</span></span><span class=""> </span><span class="">H</span><span class=""> </span><span class="">J</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;Suc i&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">P</span><span class="delimiter">=</span><span class="string">&quot;&#955;j. (H j) &#10230; (J j) &#10230; (T j)&#8712;rely&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">for</span></span><span class=""> </span><span class="">H</span><span class=""> </span><span class="">J</span><span class=""> </span><span class="">T</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">subsubsection</span></span><span class=""> </span><span class="cartouche">&#8249;event&#8250;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">assume_e_imp</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;pre1&#8838;pre; rely1&#8838;rely; c&#8712;assume_e(pre1,rely1)&#10215; &#10233; c&#8712;assume_e(pre,rely)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;pre1&#8838;pre&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rely1&#8838;rely&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c&#8712;assume_e(pre1,rely1)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;gets_e (c!0) &#8712; pre1 &#8743; (&#8704;i. Suc i&lt;length c &#10230; 
               c!i -ee&#8594; c!(Suc i) &#10230; (gets_e (c!i), gets_e (c!Suc i)) &#8712; rely1)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_e_def</span><span class="delimiter">,</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;gets_e (c ! 0) &#8712; pre&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &lt; length c &#10230; c ! i -ee&#8594; c ! Suc i 
                            &#10230; (gets_e (c ! i), gets_e (c ! Suc i)) &#8712; rely&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">commit_e_imp</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;guar1&#8838;guar; post1&#8838;post; c&#8712;commit_e(guar1,post1)&#10215; &#10233; c&#8712;commit_e(guar,post)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;guar1&#8838;guar&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;post1&#8838;post&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c&#8712;commit_e(guar1,post1)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;i. Suc i&lt;length c &#10230; 
               (&#8707;t. c!i -et-t&#8594; c!(Suc i)) &#10230; (gets_e (c!i), gets_e (c!Suc i)) &#8712; guar1) &#8743; 
               (getspc_e (last c) = AnonyEvent (None) &#10230; gets_e (last c) &#8712; post1)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;(&#8704;i. Suc i &lt; length c &#10230; (&#8707;t. c ! i -et-t&#8594; c ! Suc i) 
                            &#10230; (gets_e (c ! i), gets_e (c ! Suc i)) &#8712; guar) &#8743; 
               (getspc_e (last c) = AnonyEvent (None) &#10230; gets_e (last c) &#8712; post)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">subsubsection</span></span><span class=""> </span><span class="cartouche">&#8249;event system&#8250;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">assume_es_imp</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;pre1&#8838;pre; rely1&#8838;rely; c&#8712;assume_es(pre1,rely1)&#10215; &#10233; c&#8712;assume_es(pre,rely)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;pre1&#8838;pre&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rely1&#8838;rely&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c&#8712;assume_es(pre1,rely1)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;gets_es (c!0) &#8712; pre1 &#8743; (&#8704;i. Suc i&lt;length c &#10230; 
               c!i -ese&#8594; c!(Suc i) &#10230; (gets_es (c!i), gets_es (c!Suc i)) &#8712; rely1)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_es_def</span><span class="delimiter">,</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;gets_es (c ! 0) &#8712; pre&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &lt; length c &#10230; c ! i -ese&#8594; c ! Suc i 
                            &#10230; (gets_es (c ! i), gets_es (c ! Suc i)) &#8712; rely&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">commit_es_imp</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;guar1&#8838;guar; post1&#8838;post; c&#8712;commit_es(guar1,post1)&#10215; &#10233; c&#8712;commit_es(guar,post)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;guar1&#8838;guar&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;post1&#8838;post&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c&#8712;commit_es(guar1,post1)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length c &#10230; 
               (&#8707;t. c!i -es-t&#8594; c!(Suc i)) &#10230; (gets_es (c!i), gets_es (c!Suc i)) &#8712; guar1&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &lt; length c &#10230; (&#8707;t. c ! i -es-t&#8594; c ! Suc i) 
                            &#10230; (gets_es (c ! i), gets_es (c ! Suc i)) &#8712; guar&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">concat_i_lm</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ls l. concat ls = l &#8743; (&#8704;i&lt;length ls. ls!i &#8800; [])&#10230; (&#8704;i. Suc i &lt; length ls &#10230; 
                      (&#8707;m n. m &#8804; length l &#8743; n &#8804; length l &#8743; m &#8804; n &#8743; ls!i@[(ls!Suc i)!0] = take (n - m) (drop m l)))&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">ls</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;l. concat ls = l &#8743; (&#8704;i&lt;length ls. ls!i &#8800; [])&#10230; (&#8704;i. Suc i &lt; length ls &#10230; 
                      (&#8707;m n. m &#8804; length l &#8743; n &#8804; length l &#8743; m &#8804; n &#8743; ls!i@[(ls!Suc i)!0] = take (n - m) (drop m l)))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">ls</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">Nil</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Cons</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">xs</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;l. concat xs = l &#8743; (&#8704;i&lt;length xs. xs ! i &#8800; []) &#10230;
                        (&#8704;i. Suc i &lt; length xs &#10230; (&#8707;m n. m &#8804; length l &#8743; n &#8804; length l &#8743; 
                                m &#8804; n &#8743; xs ! i @ [xs ! Suc i ! 0] = take (n - m) (drop m l)))&quot;</span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">l</span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;concat (x # xs) = l&quot;</span><span class="">
</span><span class="">            </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i&lt;length (x # xs). (x # xs) ! i &#8800; []&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?l&#39;</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;concat xs&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;l = x@?l&#39;&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &lt; length (x # xs) &#10230; (&#8707;m n. m &#8804; length l &#8743; n &#8804; length l &#8743; 
                        m &#8804; n &#8743; (x # xs) ! i @ [(x # xs) ! Suc i ! 0] = take (n - m) (drop m l))&quot;</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">              </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">              </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length (x # xs)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length xs &gt; 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;m n. m &#8804; length l &#8743; n &#8804; length l &#8743; m &#8804; n &#8743; 
                        (x # xs) ! i @ [(x # xs) ! Suc i ! 0] = take (n - m) (drop m l)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;i = 0&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i = 0&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(x # xs) ! 1 &#8800; []&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">d0</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;x @ [xs!0 ! 0] = take (length x + 1) (drop 0 l)&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Cons_nth_drop_Suc</span><span class=""> </span><span class="">Nil_is_append_conv</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">append_eq_conv_conj</span><span class=""> 
</span><span class="">                      </span><span class="">c0</span><span class=""> </span><span class="">concat.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">drop_0</span><span class=""> </span><span class="">drop_Suc_Cons</span><span class=""> </span><span class="">length_greater_0_conv</span><span class=""> 
</span><span class="">                      </span><span class="">nth_Cons_Suc</span><span class=""> </span><span class="">nth_append</span><span class=""> </span><span class="">self_append_conv2</span><span class=""> </span><span class="">take_0</span><span class=""> </span><span class="">take_Suc_conv_app_nth</span><span class=""> </span><span class="">take_add</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(x # xs) ! 0 @ [(x # xs) ! 1 ! 0] = take (length x + 1) (drop 0 l)&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;0 &#8804; length l&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">calculation</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;length x + 1 &#8804; length l&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Suc_eq_plus1</span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="">drop_0</span><span class=""> </span><span class="">length_append_singleton</span><span class=""> </span><span class="">linear</span><span class=""> </span><span class="">take_all</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                  </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i &#8800; 0&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i&lt;length xs. xs ! i &#8800; []&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;Suc (i - 1) &lt; length xs&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;m n. m &#8804; length ?l&#39; &#8743; n &#8804; length ?l&#39; &#8743; 
                                m &#8804; n &#8743; xs ! (i - 1) @ [xs ! Suc (i - 1) ! 0] = take (n - m) (drop m ?l&#39;)&quot;</span><span class=""> 
</span><span class="">                     </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">m</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">n</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m &#8804; length ?l&#39; &#8743; n &#8804; length ?l&#39; &#8743; 
                                m &#8804; n &#8743; xs ! (i - 1) @ [xs ! Suc (i - 1) ! 0] = take (n - m) (drop m ?l&#39;)&quot;</span><span class="">
</span><span class="">                     </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?m&#39;</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;m + length x&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?n&#39;</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;n + length x&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?m&#39; &#8804; length l&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?n&#39; &#8804; length l&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?m&#39; &#8804; ?n&#39;&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(x # xs) ! i @ [(x # xs) ! Suc i ! 0] = take (?n&#39; - ?m&#39;) (drop ?m&#39; l)&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?m&#39; &#8804; length l &#8743; ?n&#39; &#8804; length l &#8743; ?m&#39; &#8804; ?n&#39; &#8743; 
                          (x # xs) ! i @ [(x # xs) ! Suc i ! 0] = take (?n&#39; - ?m&#39;) (drop ?m&#39; l)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">concat_last_lm</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ls l. concat ls = l &#8743; length ls &gt; 0 &#10230; 
                      (&#8707;m . m &#8804; length l &#8743; last ls = drop m l)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> 
</span><span class="">    </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">ls</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;&#8704;l. concat ls = l &#8743; length ls &gt; 0 &#10230; 
                      (&#8707;m . m &#8804; length l &#8743; last ls = drop m l)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">ls</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">Nil</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Cons</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">xs</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;l. concat xs = l &#8743; 0 &lt; length xs &#10230; (&#8707;m&#8804;length l. last xs = drop m l)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">l</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;concat (x # xs) = l&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;0 &lt; length (x # xs)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?l&#39;</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;concat xs&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;m&#8804;length l. last (x # xs) = drop m l&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;xs = []&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;xs = []&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;xs &#8800; []&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length xs &gt; 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;m&#8804;length ?l&#39;. last xs = drop m ?l&#39;&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">m</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m&#8804;length ?l&#39; &#8743; last xs = drop m ?l&#39;&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">append_eq_conv_conj</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">concat.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                      </span><span class="">drop_all</span><span class=""> </span><span class="">drop_drop</span><span class=""> </span><span class="">last.simps</span><span class=""> </span><span class="">nat_le_linear</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">concat_equiv</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;l &#8800; []; l = concat lt; &#8704;i&lt;length lt. length (lt!i) &#8805; 2&#10215; &#10233; 
          &#8704;i. i &#8804; length l &#10230; (&#8707;k j. k &lt; length lt &#8743; j &#8804; length (lt!k) &#8743; 
                  drop i l = (drop j (lt!k)) @ concat (drop (Suc k) lt) )&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;l = concat lt&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i&lt;length lt. length (lt!i) &#8805; 2&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;l &#8800; []&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;lt &#8800; []&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">concat.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">    </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i &#8804; length l&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;k j. k &lt; length lt &#8743; j &#8804; length (lt!k) &#8743; 
                  drop i l = (drop j (lt!k)) @ concat (drop (Suc k) lt)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">i</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">0</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;0 &#8804; length l&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;drop 0 l = drop 0 (lt ! 0) @ concat (drop (Suc 0) lt)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">concat.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">drop_0</span><span class=""> </span><span class="">drop_Suc_Cons</span><span class=""> </span><span class="">list.exhaust</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p4</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Suc</span><span class=""> </span><span class="">m</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m &#8804; length l &#10233; &#8707;k j. k &lt; length lt &#8743; j &#8804; length (lt ! k) &#8743; 
                          drop m l = drop j (lt ! k) @ concat (drop (Suc k) lt)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc m &#8804; length l&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;k j. k &lt; length lt &#8743; j &#8804; length (lt ! k) &#8743; 
                          drop m l = drop j (lt ! k) @ concat (drop (Suc k) lt)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">j</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;k &lt; length lt &#8743; j &#8804; length (lt ! k) &#8743; 
                          drop m l = drop j (lt ! k) @ concat (drop (Suc k) lt)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;j = length (lt!k)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j = length (lt!k)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;drop m l = concat (drop (Suc k) lt)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;drop m l &#8800; []&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;drop (Suc k) lt &#8800; []&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">lt1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">lts</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;drop (Suc k) lt = lt1#lts&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">neq_Nil_conv</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;drop (Suc (Suc k)) lt = lts&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">drop_Suc</span><span class=""> </span><span class="">list.sel</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">tl_drop</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;lt!Suc k = lt1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">nth_via_drop</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;drop (Suc m) l = drop 1 lt1 @ concat lts&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c3</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_leI</span><span class=""> </span><span class="">Suc_lessI</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">concat.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="">drop_0</span><span class=""> </span><span class="">drop_Suc</span><span class=""> </span><span class="">drop_all</span><span class=""> </span><span class="">list.distinct</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">list.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="">not_less_eq_eq</span><span class=""> </span><span class="">numeral_2_eq_2</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">tl_append2</span><span class=""> </span><span class="">tl_drop</span><span class=""> </span><span class="">zero_less_Suc</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="">c5</span><span class="">  </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;drop (Suc m) l = drop 1 (lt!Suc k) @ concat (drop (Suc (Suc k)) lt)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_leD</span><span class=""> </span><span class="">Suc_leI</span><span class=""> </span><span class="">Suc_lessI</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">drop_all</span><span class=""> </span><span class="">numeral_2_eq_2</span><span class=""> </span><span class="">p1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j &#8800; length (lt!k)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j &lt; length (lt!k)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;drop (Suc m) l = drop (Suc j) (lt ! k) @ concat (drop (Suc k) lt)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">drop_Suc</span><span class=""> </span><span class="">drop_eq_Nil</span><span class=""> </span><span class="">le_antisym</span><span class=""> </span><span class="">tl_append2</span><span class=""> </span><span class="">tl_drop</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Suc_leI</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">rely_take_rely</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length l &#10230; l!i -ese&#8594; l!(Suc i) 
        &#10230; (gets_es (l!i), gets_es (l!Suc i)) &#8712; rely &#10233; 
        &#8704;m subl. m &#8804; length l &#8743; subl = take m l &#10230; (&#8704;i. Suc i&lt;length subl &#10230; subl!i -ese&#8594; subl!(Suc i) 
        &#10230; (gets_es (subl!i), gets_es (subl!Suc i)) &#8712; rely)&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length l &#10230; l!i -ese&#8594; l!(Suc i) 
        &#10230; (gets_es (l!i), gets_es (l!Suc i)) &#8712; rely&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">m</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;subl. m &#8804; length l &#8743; subl = take m l &#10230; (&#8704;i. Suc i&lt;length subl &#10230; subl!i -ese&#8594; subl!(Suc i) 
        &#10230; (gets_es (subl!i), gets_es (subl!Suc i)) &#8712; rely)&quot;</span><span class="">        
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">m</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Suc</span><span class=""> </span><span class="">n</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;subl. n &#8804; length l &#8743; subl = take n l &#10230;
                          (&#8704;i. Suc i &lt; length subl &#10230; subl ! i -ese&#8594; subl ! Suc i &#10230; 
                              (gets_es (subl ! i), gets_es (subl ! Suc i)) &#8712; rely)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">subl</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc n &#8804; length l&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;subl = take (Suc n) l&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &lt; length subl &#10230; subl ! i -ese&#8594; subl ! Suc i &#10230; 
                              (gets_es (subl ! i), gets_es (subl ! Suc i)) &#8712; rely&quot;</span><span class="">
</span><span class="">                   </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">rely_drop_rely</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length l &#10230; l!i -ese&#8594; l!(Suc i) 
        &#10230; (gets_es (l!i), gets_es (l!Suc i)) &#8712; rely &#10233; 
        &#8704;m subl. m &#8804; length l &#8743; subl = drop m l &#10230; (&#8704;i. Suc i&lt;length subl &#10230; subl!i -ese&#8594; subl!(Suc i) 
        &#10230; (gets_es (subl!i), gets_es (subl!Suc i)) &#8712; rely)&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length l &#10230; l!i -ese&#8594; l!(Suc i) 
        &#10230; (gets_es (l!i), gets_es (l!Suc i)) &#8712; rely&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">m</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;subl. m &#8804; length l &#8743; subl = drop m l &#10230; (&#8704;i. Suc i&lt;length subl &#10230; subl!i -ese&#8594; subl!(Suc i) 
        &#10230; (gets_es (subl!i), gets_es (subl!Suc i)) &#8712; rely)&quot;</span><span class="">        
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">m</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">p0</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Suc</span><span class=""> </span><span class="">n</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;subl. n &#8804; length l &#8743; subl = drop n l &#10230;
                          (&#8704;i. Suc i &lt; length subl &#10230; subl ! i -ese&#8594; subl ! Suc i &#10230; 
                              (gets_es (subl ! i), gets_es (subl ! Suc i)) &#8712; rely)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">subl</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc n &#8804; length l&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;subl = drop (Suc n) l&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &lt; length subl &#10230; subl ! i -ese&#8594; subl ! Suc i &#10230; 
                              (gets_es (subl ! i), gets_es (subl ! Suc i)) &#8712; rely&quot;</span><span class="">
</span><span class="">                   </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">rely_takedrop_rely</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;&#8704;i. Suc i&lt;length l &#10230; l!i -ese&#8594; l!(Suc i) 
        &#10230; (gets_es (l!i), gets_es (l!Suc i)) &#8712; rely; 
        &#8707;m n. m &#8804; length l &#8743; n &#8804; length l &#8743; m &#8804; n &#8743; subl = take (n - m) (drop m l)&#10215; &#10233; 
        &#8704;i. Suc i&lt;length subl &#10230; subl!i -ese&#8594; subl!(Suc i) 
        &#10230; (gets_es (subl!i), gets_es (subl!Suc i)) &#8712; rely&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length l &#10230; l!i -ese&#8594; l!(Suc i) 
        &#10230; (gets_es (l!i), gets_es (l!Suc i)) &#8712; rely&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;m n. m &#8804; length l &#8743; n &#8804; length l &#8743; m &#8804; n &#8743; subl = take (n - m) (drop m l)&quot;</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">m</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">n</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m &#8804; length l &#8743; n &#8804; length l &#8743; m &#8804; n &#8743; subl = take (n - m) (drop m l)&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?subl1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;drop m l&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length ?subl1 &#10230; ?subl1!i -ese&#8594; ?subl1!(Suc i) 
        &#10230; (gets_es (?subl1!i), gets_es (?subl1!Suc i)) &#8712; rely&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">rely_drop_rely</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">    </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">a0</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">pre_trans</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;esl &#8712; assume_es(pre, rely); &#8704;i&lt;length esl. getspc_es (esl!i) = es; stable pre rely&#10215;
        &#10233; &#8704;i&lt;length esl. gets_es (esl!i) &#8712; pre&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl &#8712; assume_es(pre, rely)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i&lt;length esl. getspc_es (esl!i) = es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;stable pre rely&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i&lt;length esl&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_es (esl!i) &#8712; pre&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">i</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">0</span><span class=""> </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Suc</span><span class=""> </span><span class="">j</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j &lt; length esl &#10233; gets_es (esl ! j) &#8712; pre&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc j &lt; length esl&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;gets_es (esl ! j) &#8712; pre&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (esl ! j) = es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (esl ! Suc j) = es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;esl ! j -ese&#8594; esl ! Suc j&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">eqconf_esetran</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_es (esl!j), gets_es (esl!Suc j)) &#8712; rely&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">stable_def</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">pre_trans_assume_es</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;&#10214;esl &#8712; assume_es(pre, rely); n &lt; length esl; 
    &#8704;j. j &#8804; n &#10230; getspc_es (esl ! j) = es; stable pre rely&#10215;
        &#10233; drop n esl &#8712; assume_es(pre, rely)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl &#8712; assume_es(pre, rely)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;j. j &#8804; n &#10230; getspc_es (esl ! j) = es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;stable pre rely&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;n &lt; length esl&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;n = 0&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;n = 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;n &#8800; 0&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;n &gt; 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esl</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;drop n esl&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esl1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;take (Suc n) esl&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?esl1&#8712;assume_es(pre, rely)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assume_es_take_n</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;Suc n&quot;</span><span class=""> </span><span class="">esl</span><span class=""> </span><span class="">pre</span><span class=""> </span><span class="">rely</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i&lt;length ?esl1. getspc_es (?esl1 ! i) = es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">ultimately</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i&lt;length ?esl1. gets_es (?esl1!i) &#8712; pre&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">pre_trans</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;take (Suc n) esl&quot;</span><span class=""> </span><span class="">pre</span><span class=""> </span><span class="">rely</span><span class=""> </span><span class="">es</span><span class="delimiter">]</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_es (?esl!0)&#8712;pre&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Cons_nth_drop_Suc</span><span class=""> </span><span class="">Suc_leI</span><span class=""> </span><span class="">length_take</span><span class=""> </span><span class="">lessI</span><span class=""> </span><span class="">less_or_eq_imp_le</span><span class=""> 
</span><span class="">          </span><span class="">min.absorb2</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">nth_append_length</span><span class=""> </span><span class="">take_Suc_conv_app_nth</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length ?esl &#10230; 
               ?esl!i -ese&#8594; ?esl!(Suc i) &#10230; (gets_es (?esl!i), gets_es (?esl!Suc i)) &#8712; rely&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i&lt;length ?esl&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl!i -ese&#8594; ?esl!(Suc i)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length esl &#10230; 
               esl!i -ese&#8594; esl!(Suc i) &#10230; (gets_es (esl!i), gets_es (esl!Suc i)) &#8712; rely&quot;</span><span class="">
</span><span class="">               </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_es (?esl!i), gets_es (?esl!Suc i)) &#8712; rely&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">less_imp_le_nat</span><span class=""> </span><span class="">rely_drop_rely</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_es_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">subsubsection</span></span><span class=""> </span><span class="cartouche">&#8249;parallel event system&#8250;</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">subsection</span></span><span class=""> </span><span class="cartouche">&#8249;State trace equivalence&#8250;</span><span class="">
</span><span class="keyword1"><span class="command">subsubsection</span></span><span class=""> </span><span class="cartouche">&#8249;trace equivalence of program and anonymous event&#8250;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">definition</span></span><span class=""> </span><span class="">lift_progs</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;s pconfs) &#8658; (&#39;l,&#39;k,&#39;s) x &#8658; (&#39;l,&#39;k,&#39;s) econfs&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;lift_progs pcfs x &#8801; map (&#955;c. (AnonyEvent (fst c), snd c, x)) pcfs&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">equiv_prog_lift0</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;p&#8712;cpts_p &#10233; lift_progs p x &#8712; cpts_of_ev (AnonyEvent (getspc_p (p!0))) (gets_p (p!0)) x&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;p&#8712;cpts_p&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;p s x. p&#8712;cpts_p &#10230; lift_progs p x &#8712; cpts_of_ev (AnonyEvent (getspc_p (p!0))) (gets_p (p!0)) x&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">p</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;p&#8712;cpts_p&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;lift_progs p x &#8712; cpts_of_ev (AnonyEvent (getspc_p (p!0))) (gets_p (p!0)) x&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">p</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsPOne</span><span class=""> </span><span class="">P&#39;</span><span class=""> </span><span class="">s&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;lift_progs [(P&#39;, s&#39;)] x ! 0 = ((AnonyEvent (getspc_p ([(P&#39;, s&#39;)]!0))), (gets_p ([(P&#39;, s&#39;)]!0)), x)&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">lift_progs_def</span><span class=""> </span><span class="">getspc_p_def</span><span class=""> </span><span class="">gets_p_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class="string">&quot;lift_progs [(P&#39;, s&#39;)] x &#8712; cpts_ev&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">cpts_ev.CptsEvOne</span><span class=""> </span><span class="">lift_progs_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">cpts_of_ev_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsPEnv</span><span class=""> </span><span class="">P&#39;</span><span class=""> </span><span class="">t&#39;</span><span class=""> </span><span class="">xs&#39;</span><span class=""> </span><span class="">s&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(P&#39;, t&#39;) # xs&#39; &#8712; cpts_p&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class="">
</span><span class="">                   </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;lift_progs ((P&#39;, t&#39;) # xs&#39;) x &#8712; cpts_of_ev (AnonyEvent (getspc_p (((P&#39;, t&#39;) # xs&#39;) ! 0))) (gets_p (((P&#39;, t&#39;) # xs&#39;) ! 0)) x&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;lift_progs ((P&#39;, s&#39;) # (P&#39;, t&#39;) # xs&#39;) x ! 0 = 
                ((AnonyEvent (getspc_p (((P&#39;, s&#39;) # (P&#39;, t&#39;) # xs&#39;) ! 0))), (gets_p (((P&#39;, s&#39;) # (P&#39;, t&#39;) # xs&#39;) ! 0)), x)&quot;</span><span class="">
</span><span class="">                 </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">lift_progs_def</span><span class=""> </span><span class="">getspc_p_def</span><span class=""> </span><span class="">gets_p_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;lift_progs ((P&#39;, s&#39;) # (P&#39;, t&#39;) # xs&#39;) x = (AnonyEvent P&#39;, s&#39;, x) # lift_progs ((P&#39;, t&#39;) # xs&#39;) x&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">lift_progs_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;lift_progs ((P&#39;, t&#39;) # xs&#39;) x &#8712; cpts_ev&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">cpts_of_ev_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;lift_progs ((P&#39;, s&#39;) # (P&#39;, t&#39;) # xs&#39;) x &#8712; cpts_ev&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">cpts_ev.CptsEvEnv</span><span class=""> </span><span class="">lift_progs_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_of_ev_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsPComp</span><span class=""> </span><span class="">P&#39;</span><span class=""> </span><span class="">s&#39;</span><span class=""> </span><span class="">Q&#39;</span><span class=""> </span><span class="">t&#39;</span><span class=""> </span><span class="">xs&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(P&#39;, s&#39;) -c&#8594; (Q&#39;, t&#39;)&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class="">
</span><span class="">                   </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(Q&#39;, t&#39;) # xs&#39; &#8712; cpts_p&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class="">
</span><span class="">                   </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;lift_progs ((Q&#39;, t&#39;) # xs&#39;) x &#8712; cpts_of_ev (AnonyEvent (getspc_p (((Q&#39;, t&#39;) # xs&#39;) ! 0))) (gets_p (((Q&#39;, t&#39;) # xs&#39;) ! 0)) x&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;lift_progs ((P&#39;, s&#39;) # (Q&#39;, t&#39;) # xs&#39;) x ! 0 =
                      ((AnonyEvent (getspc_p (((P&#39;, s&#39;) # (Q&#39;, t&#39;) # xs&#39;) ! 0))), (gets_p (((P&#39;, s&#39;) # (Q&#39;, t&#39;) # xs&#39;) ! 0)), x)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">lift_progs_def</span><span class=""> </span><span class="">getspc_p_def</span><span class=""> </span><span class="">gets_p_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;lift_progs ((P&#39;, s&#39;) # (Q&#39;, t&#39;) # xs&#39;) x = (AnonyEvent P&#39;, s&#39;, x) # lift_progs ((Q&#39;, t&#39;) # xs&#39;) x&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">lift_progs_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;lift_progs ((Q&#39;, t&#39;) # xs&#39;) x &#8712; cpts_ev&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">cpts_of_ev_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(AnonyEvent P&#39;, s&#39;, x) -et-(Cmd CMP)&#9839;k&#8594; (AnonyEvent Q&#39;, t&#39;, x)&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">etran.AnonyEvent</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c6</span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;lift_progs ((P&#39;, s&#39;) # (Q&#39;, t&#39;) # xs&#39;) x &#8712; cpts_ev&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">cpts_ev.CptsEvComp</span><span class=""> </span><span class="">lift_progs_def</span><span class="delimiter">)</span><span class="">
</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_of_ev_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">equiv_prog_lift</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;p&#8712;cpts_of_p P s &#10233; lift_progs p x &#8712; cpts_of_ev (AnonyEvent P) s x&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;p&#8712;cpts_of_p P s&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;p&#8712;cpts_p&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">cpts_of_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;p!0=(P,s)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">cpts_of_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">equiv_prog_lift0</span><span class=""> </span><span class="">getspc_p_def</span><span class=""> </span><span class="">gets_p_def</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">snd_conv</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">primrec</span></span><span class=""> </span><span class="">lower_anonyevt0</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) event &#8658; &#39;s &#8658; &#39;s pconf&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">AnonyEv</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;lower_anonyevt0 (AnonyEvent p) s = (p, s)&quot;</span><span class=""> </span><span class="delimiter">|</span><span class="">
</span><span class="">        </span><span class="">BasicEv</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;lower_anonyevt0 (BasicEvent p) s = (None, s)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">definition</span></span><span class=""> </span><span class="">lower_anonyevt1</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) econf  &#8658; &#39;s pconf&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;lower_anonyevt1 ec &#8801; lower_anonyevt0 (getspc_e ec) (gets_e ec) &quot;</span><span class=""> 
</span><span class="">
</span><span class="keyword1"><span class="command">definition</span></span><span class=""> </span><span class="">lower_evts</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) econfs &#8658; (&#39;s pconfs)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;lower_evts ecfs &#8801; map lower_anonyevt1 ecfs&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">lower_anonyevt_s</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_e e = AnonyEvent P &#10233; gets_p (lower_anonyevt1 e) = gets_e e&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">gets_p_def</span><span class=""> </span><span class="">lower_anonyevt1_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">equiv_lower_evts0</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;&#8707;P. getspc_e (es ! 0) = AnonyEvent P; es &#8712; cpts_ev&#10215; &#10233; lower_evts es &#8712;cpts_p&quot;</span><span class="">
</span><span class="keyword1"><span class="command">proof</span></span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;es &#8712; cpts_ev&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;P. getspc_e (es ! 0) = AnonyEvent P&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;es P. getspc_e (es ! 0) = AnonyEvent P &#8743; es &#8712; cpts_ev &#10230; lower_evts es &#8712;cpts_p&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">es</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;P. getspc_e (es ! 0) = AnonyEvent P&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class="">
</span><span class="">               </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;es &#8712; cpts_ev&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;lower_evts es &#8712;cpts_p&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">es</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsEvOne</span><span class=""> </span><span class="">e&#39;</span><span class=""> </span><span class="">s&#39;</span><span class=""> </span><span class="">x&#39;</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;P. getspc_e ([(e&#39;, s&#39;, x&#39;)] ! 0) = AnonyEvent P&quot;</span><span class="">  
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">P</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;getspc_e ([(e&#39;, s&#39;, x&#39;)] ! 0) = AnonyEvent P&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;e&#39; = AnonyEvent P&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;lower_anonyevt1 (e&#39;, s&#39;, x&#39;) = (P, s&#39;)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">gets_e_def</span><span class=""> </span><span class="">getspc_e_def</span><span class=""> </span><span class="">lower_anonyevt1_def</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;lower_evts [(e&#39;, s&#39;, x&#39;)] = [(P, s&#39;)]&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">lower_evts_def</span><span class="delimiter">)</span><span class="">  
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">cpts_of_p_def</span><span class=""> </span><span class="">cpts_p.CptsPOne</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsEvEnv</span><span class=""> </span><span class="">e&#39;</span><span class=""> </span><span class="">t&#39;</span><span class=""> </span><span class="">x&#39;</span><span class=""> </span><span class="">xs&#39;</span><span class=""> </span><span class="">s&#39;</span><span class=""> </span><span class="">y&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot; (e&#39;, t&#39;, x&#39;) # xs&#39; &#8712; cpts_ev&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class="">
</span><span class="">                   </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;P. getspc_e (((e&#39;, t&#39;, x&#39;) # xs&#39;) ! 0) = AnonyEvent P &#10233; lower_evts ((e&#39;, t&#39;, x&#39;) # xs&#39;) &#8712; cpts_p&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class="">
</span><span class="">                   </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;P. getspc_e (((e&#39;, s&#39;, y&#39;) # (e&#39;, t&#39;, x&#39;) # xs&#39;) ! 0) = AnonyEvent P&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?ob</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;lower_evts ((e&#39;, s&#39;, y&#39;) # (e&#39;, t&#39;, x&#39;) # xs&#39;)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">P</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c_</span><span class="delimiter">:</span><span class="string">&quot;getspc_e (((e&#39;, s&#39;, y&#39;) # (e&#39;, t&#39;, x&#39;) # xs&#39;) ! 0) = AnonyEvent P&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?ob ! 0 = (P, s&#39;)&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">lower_evts_def</span><span class=""> </span><span class="">lower_anonyevt1_def</span><span class=""> </span><span class="">lower_anonyevt0_def</span><span class=""> </span><span class="">gets_e_def</span><span class=""> </span><span class="">getspc_e_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c_</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(e&#39;, s&#39;, y&#39;) = (AnonyEvent P, s&#39;, y&#39;)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;e&#39; = AnonyEvent P&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;lower_evts ((e&#39;, t&#39;, x&#39;) # xs&#39;) &#8712; cpts_p&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?ob = (P, s&#39;) # lower_evts ((e&#39;, t&#39;, x&#39;) # xs&#39;)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">list.simps</span><span class="delimiter">(</span><span class="">9</span><span class="delimiter">)</span><span class=""> </span><span class="">lower_evts_def</span><span class=""> </span><span class="">nth_Cons_0</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;lower_evts ((e&#39;, t&#39;, x&#39;) # xs&#39;) = (P, t&#39;) # lower_evts xs&#39;&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lower_evts_def</span><span class=""> </span><span class="">lower_anonyevt1_def</span><span class=""> </span><span class="">lower_anonyevt0_def</span><span class=""> </span><span class="">gets_e_def</span><span class=""> </span><span class="">getspc_e_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c6</span><span class=""> </span><span class="">c7</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">cpts_p.CptsPEnv</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsEvComp</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">et</span><span class=""> </span><span class="">e2</span><span class=""> </span><span class="">t1</span><span class=""> </span><span class="">y1</span><span class=""> </span><span class="">xs1</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(e1, s1, x1) -et-et&#8594; (e2, t1, y1)&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class="">
</span><span class="">                   </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(e2, t1, y1) # xs1 &#8712; cpts_ev&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class="">
</span><span class="">                   </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;P. getspc_e (((e2, t1, y1) # xs1) ! 0) = AnonyEvent P 
                        &#10233; lower_evts ((e2, t1, y1) # xs1) &#8712; cpts_p&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class="">
</span><span class="">                   </span><span class="">c3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;P. getspc_e (((e1, s1, x1) # (e2, t1, y1) # xs1) ! 0) = AnonyEvent P&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">P</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c_</span><span class="delimiter">:</span><span class="string">&quot;getspc_e (((e1, s1, x1) # (e2, t1, y1) # xs1) ! 0) = AnonyEvent P&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;e1 = AnonyEvent P&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;Q. e2 = AnonyEvent Q&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">clarify</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">etran.cases</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp_all</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">Q</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;e2 = AnonyEvent Q&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c6</span><span class="delimiter">:</span><span class="string">&quot;lower_evts ((e2, t1, y1) # xs1) &#8712; cpts_p&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">getspc_e_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;lower_evts ((e1, s1, x1) # (e2, t1, y1) # xs1) = 
                  (lower_anonyevt1 (e1, s1, x1)) # lower_evts ((e2, t1, y1) # xs1)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">lower_evts_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c7_</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;lower_evts ((e2, t1, y1) # xs1) = lower_anonyevt1 (e2, t1, y1) # lower_evts xs1&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">lower_evts_def</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;lower_anonyevt1 (e2, t1, y1) # lower_evts xs1 &#8712; cpts_p&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;lower_anonyevt1 (e1, s1, x1) = (P, s1)&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">gets_e_def</span><span class=""> </span><span class="">getspc_e_def</span><span class=""> </span><span class="">lower_anonyevt1_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c10</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;lower_anonyevt1 (e2, t1, y1) = (Q, t1)&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">gets_e_def</span><span class=""> </span><span class="">getspc_e_def</span><span class=""> </span><span class="">lower_anonyevt1_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c11</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(AnonyEvent P, s1, x1) -et-et&#8594; (AnonyEvent Q, t1, y1)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(P, s1) -c&#8594; (Q, t1)&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">etran.cases</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp_all</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c8</span><span class=""> </span><span class="">c9</span><span class=""> </span><span class="">c10</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;lower_anonyevt1 (e1, s1, x1) # lower_anonyevt1 (e2, t1, y1) # lower_evts xs1 &#8712; cpts_p&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">CptsPComp</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c7</span><span class=""> </span><span class="">c7_</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">equiv_lower_evts</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;es &#8712; cpts_of_ev (AnonyEvent P) s x &#10233; lower_evts es &#8712;cpts_of_p P s&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;es &#8712; cpts_of_ev (AnonyEvent P) s x&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;es!0=(AnonyEvent P,(s,x)) &#8743; es &#8712; cpts_ev&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">cpts_of_ev_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_e (es ! 0) = AnonyEvent P&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;lower_evts es &#8712;cpts_p&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">equiv_lower_evts0</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">equiv_lower_evts0</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;lower_evts es ! 0 = lower_anonyevt1 (es ! 0)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">cptn_not_empty</span><span class=""> </span><span class="">list.simps</span><span class="delimiter">(</span><span class="">8</span><span class="delimiter">)</span><span class=""> </span><span class="">list.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">lower_evts_def</span><span class=""> </span><span class="">neq0_conv</span><span class=""> </span><span class="">not_less0</span><span class=""> </span><span class="">nth_equalityI</span><span class=""> </span><span class="">nth_map</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;lower_anonyevt1 (es ! 0) = (P,s)&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">gets_e_def</span><span class=""> </span><span class="">getspc_e_def</span><span class=""> </span><span class="">lower_anonyevt1_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;lower_evts es ! 0 = (P,s)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">subsubsection</span></span><span class=""> </span><span class="cartouche">&#8249;trace between of basic and anonymous events&#8250;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">evtent_in_cpts1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; cpts_ev &#8743; el ! 0 = (BasicEvent ev, s, x) &#10233; 
      Suc i &lt; length el &#8743; el ! i -et-(EvtEnt (BasicEvent ev))&#9839;k&#8594; el ! (Suc i) &#10233; 
      (&#8704;j. Suc j &#8804; i &#10230; getspc_e (el ! j) = BasicEvent ev &#8743; el ! j -ee&#8594; el ! (Suc j))&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; cpts_ev &#8743; el ! 0 = (BasicEvent ev, s, x)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length el &#8743; el ! i -et-(EvtEnt (BasicEvent ev))&#9839;k&#8594; el ! (Suc i)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p01</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; cpts_ev&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class="">
</span><span class="">                 </span><span class="">p02</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el ! 0 = (BasicEvent ev, s, x)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_e (el ! i) = BasicEvent ev&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">ent_spec</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;&#8704;j. Suc j &#8804; i &#10230; getspc_e (el ! j) = BasicEvent ev &#8743; el ! j -ee&#8594; el ! (Suc j)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">j</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc j &#8804; i&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;k. k &lt; i &#10230; getspc_e (el ! (i -k -1)) = BasicEvent ev &#8743; el ! (i -k -1)-ee&#8594; el ! (i - k)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">k</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;k &lt; i&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_e (el ! (i -k -1)) = BasicEvent ev &#8743; el ! (i -k -1)-ee&#8594; el ! (i - k)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">k</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">0</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(&#8707;t ec1. ec1-et-t&#8594;(el ! i))&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">no_tran2basic</span><span class=""> </span><span class="">getspc_e_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">prod.collapse</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p01</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_e (el ! (i - 1)) = getspc_e (el ! i)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">notran_confeqi</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="string">&quot;0.prems&quot;</span><span class=""> </span><span class="">Suc_diff_1</span><span class=""> </span><span class="">Suc_lessD</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">eqconf_eetran</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Suc</span><span class=""> </span><span class="">m</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m &lt; i &#10233; getspc_e (el ! (i - m - 1)) = BasicEvent ev 
                                    &#8743; el ! (i - m - 1) -ee&#8594; el ! (i - m)&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class="">
</span><span class="">                       </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc m &lt; i&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_e (el ! (i - m - 1)) = BasicEvent ev&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class="">
</span><span class="">                          </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el ! (i - m - 1) -ee&#8594; el ! (i - m)&quot;</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc m = m + 1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172;(&#8707;t ec1. ec1-et-t&#8594;(el ! (i - Suc m))) &quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">no_tran2basic</span><span class=""> </span><span class="">getspc_e_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">diff_diff_left</span><span class=""> </span><span class="">prod.collapse</span><span class="delimiter">)</span><span class="">  
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p02</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_e (el ! ((i - Suc m - 1))) = getspc_e (el ! (i - Suc m))&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">notran_confeqi</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Suc_diff_1</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">diff_less</span><span class=""> </span><span class="">less_trans</span><span class=""> </span><span class="">p01</span><span class=""> 
</span><span class="">                                          </span><span class="">zero_less_Suc</span><span class=""> </span><span class="">zero_less_diff</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_e (el ! ((i - Suc m - 1))) = BasicEvent ev&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">diff_diff_left</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;el ! (i - Suc m - 1) -ee&#8594; el ! (i - Suc m)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">eqconf_eetran</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b6</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">            
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_le_lessD</span><span class=""> </span><span class="">diff_Suc_1</span><span class=""> </span><span class="">diff_Suc_less</span><span class=""> 
</span><span class="">                            </span><span class="">diff_diff_cancel</span><span class=""> </span><span class="">gr_implies_not0</span><span class=""> </span><span class="">less_antisym</span><span class=""> </span><span class="">zero_less_Suc</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">evtent_in_cpts2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; cpts_ev &#8743; el ! 0 = (BasicEvent ev, s, x) &#10233; 
      Suc i &lt; length el &#8743; el ! i -et-(EvtEnt (BasicEvent ev))&#9839;k&#8594; el ! (Suc i) &#10233; 
      (gets_e (el ! i) &#8712; guard ev &#8743; drop (Suc i) el &#8712; 
          cpts_of_ev (AnonyEvent (Some (body ev))) (gets_e (el ! (Suc i))) ((getx_e (el ! i)) (k := BasicEvent ev)) )&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; cpts_ev &#8743; el ! 0 = (BasicEvent ev, s, x)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length el &#8743; el ! i -et-(EvtEnt (BasicEvent ev))&#9839;k&#8594; el ! (Suc i)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;gets_e (el ! i) &#8712; guard ev &#8743; gets_e (el ! i) = gets_e (el ! (Suc i))
                            &#8743; getspc_e (el ! (Suc i)) = AnonyEvent (Some (body ev))
                            &#8743; getx_e (el ! (Suc i)) = (getx_e (el ! i)) (k := BasicEvent ev)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">ent_spec2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(drop (Suc i) el)!0 = el ! (Suc i)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(drop (Suc i) el)!0 = (AnonyEvent (Some (body ev)),(gets_e (el ! (Suc i)), 
                                          (getx_e (el ! i)) (k := BasicEvent ev) ))&quot;</span><span class=""> 
</span><span class="">       </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">gets_e_def</span><span class=""> </span><span class="">getspc_e_def</span><span class=""> </span><span class="">getx_e_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">prod.collapse</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;drop (Suc i) el &#8712; cpts_ev&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">cpts_ev_subi</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;gets_e (el ! i) &#8712; guard ev &#8743; drop (Suc i) el &#8712; 
          cpts_of_ev (AnonyEvent (Some (body ev))) (gets_e (el ! (Suc i))) ((getx_e (el ! i)) (k := BasicEvent ev))&quot;</span><span class="">
</span><span class="">       </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">mono_tags</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">CollectI</span><span class=""> </span><span class="">cpts_of_ev_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">no_evtent_in_cpts</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; cpts_ev &#10233; el ! 0 = (BasicEvent ev, s, x) &#10233; 
      (&#172; (&#8707;i k. Suc i &lt; length el &#8743; el ! i -et-(EvtEnt (BasicEvent ev))&#9839;k&#8594; el ! (Suc i)) ) &#10233; 
      (&#8704;j. Suc j &lt; length el &#10230; getspc_e (el ! j) = BasicEvent ev 
                                &#8743; el ! j -ee&#8594; el ! (Suc j)
                                &#8743; getspc_e (el ! (Suc j)) = BasicEvent ev)&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">  
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; cpts_ev&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class="">
</span><span class="">           </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el ! 0 = (BasicEvent ev, s, x)&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class="">
</span><span class="">           </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172; (&#8707;i k. Suc i &lt; length el &#8743; el ! i -et-(EvtEnt (BasicEvent ev))&#9839;k&#8594; el ! (Suc i))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">j</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;Suc j &lt; length el&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_e (el ! j) = BasicEvent ev &#8743; el ! j -ee&#8594; el ! (Suc j) 
                  &#8743; getspc_e (el ! (Suc j)) = BasicEvent ev&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">j</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">0</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc 0 &lt; length el&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a00</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_e (el ! 0) = BasicEvent ev&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172; (&#8707;k. el ! 0 -et-(EvtEnt (BasicEvent ev))&#9839;k&#8594; el ! (Suc 0))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172; (&#8707;t. el ! 0 -et-t&#8594; el ! (Suc 0))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">noevtent_notran</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_e (el ! 0) = getspc_e (el ! (Suc 0))&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">notran_confeqi</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a00</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_e (el ! (Suc 0)) = BasicEvent ev&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;el ! 0 -ee&#8594; el ! Suc 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_e_def</span><span class=""> </span><span class="">eetran.EnvE</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">eq_fst_iff</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">a00</span><span class=""> </span><span class="">a2</span><span class="delimiter">)</span><span class="">  
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Suc</span><span class=""> </span><span class="">m</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc m &lt; length el &#10233; getspc_e (el ! m) = BasicEvent ev &#8743; el ! m -ee&#8594; el ! Suc m
                        &#8743; getspc_e (el ! Suc m) = BasicEvent ev&quot;</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc (Suc m) &lt; length el&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_e (el ! m) = BasicEvent ev &#8743; el ! m -ee&#8594; el ! Suc m&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_e (el ! Suc m) = BasicEvent ev&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_e_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">eetranE</span><span class=""> </span><span class="">fstI</span><span class="delimiter">)</span><span class="">
</span><span class="">            
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;s x. el ! Suc m = (BasicEvent ev, s, x)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">unfolding</span></span><span class=""> </span><span class="">getspc_e_def</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">surj_pair</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172; (&#8707;k. el ! (Suc m) -et-(EvtEnt (BasicEvent ev))&#9839;k&#8594; el ! (Suc (Suc m) ))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172; (&#8707;t. el ! (Suc m) -et-t&#8594; el ! (Suc (Suc m)))&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">noevtent_notran</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">
</span><span class="">            
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_e (el ! (Suc m)) = getspc_e (el ! (Suc (Suc m)))&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">notran_confeqi</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_e (el ! (Suc (Suc m))) = BasicEvent ev&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;el ! Suc m -ee&#8594; el ! Suc (Suc m)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_e_def</span><span class=""> </span><span class="">eetran.EnvE</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">eq_fst_iff</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">a7</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  
</span><span class="keyword1"><span class="command">subsubsection</span></span><span class=""> </span><span class="cartouche">&#8249;trace between of event and event system&#8250;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">primrec</span></span><span class=""> </span><span class="">rm_evtsys0</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) esys &#8658; &#39;s &#8658; (&#39;l,&#39;k,&#39;s) x &#8658; (&#39;l,&#39;k,&#39;s) econf&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">EvtSeqrm</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rm_evtsys0 (EvtSeq e es) s x= (e, s, x)&quot;</span><span class=""> </span><span class="delimiter">|</span><span class="">
</span><span class="">        </span><span class="">EvtSysrm</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rm_evtsys0 (EvtSys es) s x= (AnonyEvent None, s, x)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">definition</span></span><span class=""> </span><span class="">rm_evtsys1</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) esconf &#8658; (&#39;l,&#39;k,&#39;s) econf&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;rm_evtsys1 esc &#8801; rm_evtsys0 (getspc_es esc) (gets_es esc) (getx_es esc)&quot;</span><span class=""> 
</span><span class="">
</span><span class="keyword1"><span class="command">definition</span></span><span class=""> </span><span class="">rm_evtsys</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) esconfs &#8658; (&#39;l,&#39;k,&#39;s) econfs&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;rm_evtsys escfs &#8801; map rm_evtsys1 escfs&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">definition</span></span><span class=""> </span><span class="">e_eqv_einevtseq</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) esconfs &#8658; (&#39;l,&#39;k,&#39;s) econfs &#8658; (&#39;l,&#39;k,&#39;s) esys &#8658; bool&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;e_eqv_einevtseq esl el es &#8801; length esl = length el &#8743; 
            (&#8704;i. Suc i &#8804; length el &#10230; gets_e (el ! i) = gets_es (esl ! i) &#8743;
                                       getx_e (el ! i) = getx_es (esl ! i) &#8743;
                                       getspc_es (esl ! i) = EvtSeq (getspc_e (el ! i)) es)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">e_eqv_einevtseq_s</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;e_eqv_einevtseq esl el es; gets_e e1 = gets_es es1; getx_e e1 = getx_es es1;
                            getspc_es es1 = EvtSeq (getspc_e e1) es&#10215; &#10233; e_eqv_einevtseq (es1 # esl) (e1 # el) es&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;e_eqv_einevtseq esl el es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;gets_e e1 = gets_es es1&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getx_e e1 = getx_es es1&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es es1 = EvtSeq (getspc_e e1) es&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?el&#39;</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;e1 # el&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esl&#39;</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;es1 # esl&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length esl = length el&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">e_eqv_einevtseq_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &#8804; length el &#10230; gets_e (el ! i) = gets_es (esl ! i) &#8743;
                                                 getx_e (el ! i) = getx_es (esl ! i) &#8743;
                                                 getspc_es (esl ! i) = EvtSeq (getspc_e (el ! i)) es&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">e_eqv_einevtseq_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;length (es1 # esl) = length (e1 # el)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &#8804; length ?el&#39; &#10230; gets_e (?el&#39; ! i) = gets_es (?esl&#39; ! i) &#8743;
                                       getx_e (?el&#39; ! i) = getx_es (?esl&#39; ! i) &#8743;
                                       getspc_es (?esl&#39; ! i) = EvtSeq (getspc_e (?el&#39; ! i)) es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">nth_Cons&#39;</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;e_eqv_einevtseq ?esl&#39; ?el&#39; es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">e_eqv_einevtseq_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">       
</span><span class="keyword1"><span class="command">definition</span></span><span class=""> </span><span class="">same_s_x</span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) esconfs &#8658; (&#39;l,&#39;k,&#39;s) econfs &#8658; bool&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;same_s_x esl el &#8801; length esl = length el &#8743; 
            (&#8704;i. Suc i &#8804; length el &#10230; gets_e (el ! i) = gets_es (esl ! i) &#8743;
                                       getx_e (el ! i) = getx_es (esl ! i))&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">rm_evtsys_same_sx</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;same_s_x esl (rm_evtsys esl)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">esl</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">Nil</span><span class=""> 
</span><span class="">    </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">rm_evtsys_def</span><span class=""> </span><span class="">same_s_x_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Cons</span><span class=""> </span><span class="">ec1</span><span class=""> </span><span class="">esl1</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;same_s_x esl1 (rm_evtsys esl1)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rm_evtsys (ec1 # esl1) = rm_evtsys1 ec1 # rm_evtsys esl1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">rm_evtsys_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">es</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">s</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;ec1 = (es, s, x)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">prod_cases3</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">es</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">EvtSeq</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">es1</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;ec1 = (EvtSeq x1 es1, s, x)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rm_evtsys1 ec1 # rm_evtsys esl1 = (x1, s, x) # rm_evtsys esl1&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">rm_evtsys1_def</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">getx_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;length (ec1 # esl1) = length (rm_evtsys (ec1 # esl1))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">rm_evtsys_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &#8804; length (rm_evtsys (ec1 # esl1)) &#10230; 
                            gets_e ((rm_evtsys (ec1 # esl1)) ! i) = gets_es ((ec1 # esl1) ! i) 
                          &#8743; getx_e ((rm_evtsys (ec1 # esl1)) ! i) = getx_es ((ec1 # esl1) ! i)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &#8804; length (rm_evtsys (ec1 # esl1))&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_e ((rm_evtsys (ec1 # esl1)) ! i) = gets_es ((ec1 # esl1) ! i) 
                          &#8743; getx_e ((rm_evtsys (ec1 # esl1)) ! i) = getx_es ((ec1 # esl1) ! i)&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;i = 0&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i = 0&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">gets_e_def</span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">getx_e_def</span><span class=""> </span><span class="">getx_es_def</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">snd_conv</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i &#8800; 0&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(rm_evtsys (ec1 # esl1)) ! i = (rm_evtsys esl1) ! (i - 1)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">a1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(ec1 # esl1) ! i = esl1 ! (i - 1)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">nth_Cons&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">same_s_x_def</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_diff_1</span><span class=""> </span><span class="">Suc_leI</span><span class=""> </span><span class="">Suc_le_lessD</span><span class=""> 
</span><span class="">                      </span><span class="">Suc_less_eq</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">length_Cons</span><span class=""> </span><span class="">neq0_conv</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">same_s_x_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">EvtSys</span><span class=""> </span><span class="">xa</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;ec1 = (EvtSys xa, s, x)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rm_evtsys1 ec1 # rm_evtsys esl1 = (AnonyEvent None, s, x) # rm_evtsys esl1&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">rm_evtsys1_def</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">getx_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;length (ec1 # esl1) = length (rm_evtsys (ec1 # esl1))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">rm_evtsys_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &#8804; length (rm_evtsys (ec1 # esl1)) &#10230; 
                            gets_e ((rm_evtsys (ec1 # esl1)) ! i) = gets_es ((ec1 # esl1) ! i) 
                          &#8743; getx_e ((rm_evtsys (ec1 # esl1)) ! i) = getx_es ((ec1 # esl1) ! i)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &#8804; length (rm_evtsys (ec1 # esl1))&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_e ((rm_evtsys (ec1 # esl1)) ! i) = gets_es ((ec1 # esl1) ! i) 
                          &#8743; getx_e ((rm_evtsys (ec1 # esl1)) ! i) = getx_es ((ec1 # esl1) ! i)&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;i = 0&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i = 0&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">gets_e_def</span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">getx_e_def</span><span class=""> </span><span class="">getx_es_def</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">snd_conv</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i &#8800; 0&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(rm_evtsys (ec1 # esl1)) ! i = (rm_evtsys esl1) ! (i - 1)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">a1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(ec1 # esl1) ! i = esl1 ! (i - 1)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">nth_Cons&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">same_s_x_def</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_diff_1</span><span class=""> </span><span class="">Suc_leI</span><span class=""> </span><span class="">Suc_le_lessD</span><span class=""> 
</span><span class="">                      </span><span class="">Suc_less_eq</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">length_Cons</span><span class=""> </span><span class="">neq0_conv</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">same_s_x_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">definition</span></span><span class=""> </span><span class="">e_sim_es</span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) esconfs &#8658; (&#39;l,&#39;k,&#39;s) econfs 
                          &#8658; (&#39;l,&#39;k,&#39;s) event set &#8658; (&#39;l,&#39;s) event&#39; &#8658; bool&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;e_sim_es esl el es e &#8801; length esl = length el &#8743; getspc_es (esl!0) = EvtSys es &#8743;
                                getspc_e (el!0) = BasicEvent e &#8743;
                                (&#8704;i. i &lt; length el &#10230; gets_e (el ! i) = gets_es (esl ! i) &#8743;
                                                        getx_e (el ! i) = getx_es (esl ! i)) &#8743;
                                (&#8704;i. i &gt; 0 &#8743; i &lt; length el &#10230; 
                                    (getspc_es (esl!i) = EvtSys es &#8743; getspc_e (el!i) = AnonyEvent None) 
                                      &#8744; (getspc_es (esl!i) = EvtSeq (getspc_e (el!i)) (EvtSys es))
                                 )&quot;</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">subsection</span></span><span class=""> </span><span class="cartouche">&#8249;Soundness of Programs&#8250;</span><span class="">
</span><span class="keyword1"><span class="command">subsubsection</span></span><span class=""> </span><span class="cartouche">&#8249;Soundness of the Basic rule&#8250;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">unique_ctran_Basic</span><span class=""> </span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#8704;s i. x &#8712; cpts_p &#10230; x ! 0 = (Some (Basic f), s) &#10230;
  Suc i&lt;length x &#10230; x!i -c&#8594; x!Suc i &#10230;
  (&#8704;j. Suc j&lt;length x &#10230; i&#8800;j &#10230; x!j -pe&#8594; x!Suc j)&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">x</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">cpts_p.cases</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">i</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">j</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">EnvP</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">i</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">j</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">ptran.cases</span><span class="delimiter">,</span><span class="">simp_all</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">elim</span><span class="delimiter">:</span><span class=""> </span><span class="">not_ctran_None</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">ind_cases</span><span class=""> </span><span class="string">&quot;((Some (Basic f), sa), Q, t) &#8712; ptran&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">for</span></span><span class=""> </span><span class="">sa</span><span class=""> </span><span class="">Q</span><span class=""> </span><span class="">t</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">i</span><span class="delimiter">=</span><span class="">nat</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">not_ctran_None</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">petranE</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">exists_ctran_Basic_None</span><span class=""> </span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#8704;s i. x &#8712; cpts_p &#10230; x ! 0 = (Some (Basic f), s)
  &#10230; i&lt;length x &#10230; fst(x!i)=None &#10230; (&#8707;j&lt;i. x!j -c&#8594; x!Suc j)&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">x</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">cpts_p.cases</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">i</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">nat</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;Suc j&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">exI</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">i</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">0</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">exI</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">Basic_sound</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot; &#10214;pre &#8838; {s. f s &#8712; post}; {(s, t). s &#8712; pre &#8743; t = f s} &#8838; guar;
  stable pre rely; stable post rely&#10215;
  &#10233; &#8872; Basic f sat<span class="hidden">&#8681;</span><sub>p</sub> [pre, rely, guar, post]&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">unfold</span><span class=""> </span><span class="">prog_validity_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_p_def</span><span class=""> </span><span class="">gets_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_p_def</span><span class=""> </span><span class="">assume_p_def</span><span class=""> </span><span class="">gets_p_def</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">frule_tac</span><span class=""> </span><span class="">j</span><span class="delimiter">=</span><span class="">0</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">k</span><span class="delimiter">=</span><span class="">i</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">p</span><span class="delimiter">=</span><span class="">pre</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">stability</span><span class="delimiter">)</span><span class="">
</span><span class="">       </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp_all</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">ia</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">i</span><span class="delimiter">=</span><span class="">i</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">f</span><span class="delimiter">=</span><span class="">f</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">unique_ctran_Basic</span><span class="delimiter">,</span><span class="">simp_all</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">subsetD</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;x!i&quot;</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">s</span><span class="delimiter">=</span><span class="string">&quot;Some (Basic f)&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">sym</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">thin_tac</span><span class=""> </span><span class="string">&quot;&#8704;j. H j&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">for</span></span><span class=""> </span><span class="">H</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">elim</span><span class="delimiter">:</span><span class="">ptran.cases</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">frule_tac</span><span class=""> </span><span class="">i</span><span class="delimiter">=</span><span class="string">&quot;length x - 1&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">f</span><span class="delimiter">=</span><span class="">f</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">exists_ctran_Basic_None</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">last_fst_esp</span><span class="delimiter">,</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">last_length</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_p_def</span><span class=""> </span><span class="">gets_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">frule_tac</span><span class=""> </span><span class="">j</span><span class="delimiter">=</span><span class="">0</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">k</span><span class="delimiter">=</span><span class="string">&quot;j&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">p</span><span class="delimiter">=</span><span class="">pre</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">stability</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp_all</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">i</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">i</span><span class="delimiter">=</span><span class="">j</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">f</span><span class="delimiter">=</span><span class="">f</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">unique_ctran_Basic</span><span class="delimiter">,</span><span class="">simp_all</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;x!j&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">s</span><span class="delimiter">=</span><span class="string">&quot;Some (Basic f)&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">sym</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;x!Suc j&quot;</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">ptran.cases</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp_all</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">c</span><span class="delimiter">=</span><span class="">sa</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">subsetD</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">frule_tac</span><span class=""> </span><span class="">j</span><span class="delimiter">=</span><span class="string">&quot;Suc j&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">k</span><span class="delimiter">=</span><span class="string">&quot;length x - 1&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">p</span><span class="delimiter">=</span><span class="">post</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">stability</span><span class="delimiter">,</span><span class="">simp_all</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">i</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">i</span><span class="delimiter">=</span><span class="">j</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">f</span><span class="delimiter">=</span><span class="">f</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">unique_ctran_Basic</span><span class="delimiter">,</span><span class="">simp_all</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">arith</span><span class="delimiter">+</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">last_length</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">subsubsection</span></span><span class="cartouche">&#8249;Soundness of the Await rule&#8250;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">unique_ctran_Await</span><span class=""> </span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#8704;s i. x &#8712; cpts_p &#10230; x ! 0 = (Some (Await b c), s) &#10230;
  Suc i&lt;length x &#10230; x!i -c&#8594; x!Suc i &#10230;
  (&#8704;j. Suc j&lt;length x &#10230; i&#8800;j &#10230; x!j -pe&#8594; x!Suc j)&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">x</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">cpts_p.cases</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">i</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">j</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">EnvP</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">i</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">j</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">ptran.cases</span><span class="delimiter">,</span><span class="">simp_all</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">elim</span><span class="delimiter">:</span><span class=""> </span><span class="">not_ctran_None</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">ind_cases</span><span class=""> </span><span class="string">&quot;((Some (Await b c), sa), Q, t) &#8712; ptran&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">for</span></span><span class=""> </span><span class="">sa</span><span class=""> </span><span class="">Q</span><span class=""> </span><span class="">t</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">i</span><span class="delimiter">=</span><span class="">nat</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">not_ctran_None</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">petranE</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">exists_ctran_Await_None</span><span class=""> </span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#8704;s i.  x &#8712; cpts_p &#10230; x ! 0 = (Some (Await b c), s)
  &#10230; i&lt;length x &#10230; fst(x!i)=None &#10230; (&#8707;j&lt;i. x!j -c&#8594; x!Suc j)&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">x</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">cpts_p.cases</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">i</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">nat</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;Suc j&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">exI</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">i</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">0</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">exI</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">Star_imp_cptn</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;(P, s) -c*&#8594; (R, t) &#10233; &#8707;l &#8712; cpts_of_p P s. (last l)=(R, t)
  &#8743; (&#8704;i. Suc i&lt;length l &#10230; l!i -c&#8594; l!Suc i)&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">converse_rtrancl_induct2</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;[(R,t)]&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">bexI</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_p_def</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">CptsPOne</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;(a, b)#l&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">bexI</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">l</span><span class="delimiter">,</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">last_length</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">i</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_p_def</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">l</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">elim</span><span class="delimiter">:</span><span class="">cpts_p.cases</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">CptsPComp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">Await_sound</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#10214;stable pre rely; stable post rely;
  &#8704;V. &#8866; P sat<span class="hidden">&#8681;</span><sub>p</sub> [pre &#8745; b &#8745; {s. s = V}, {(s, t). s = t},
                 UNIV, {s. (V, s) &#8712; guar} &#8745; post] &#8743;
  &#8872; P sat<span class="hidden">&#8681;</span><sub>p</sub> [pre &#8745; b &#8745; {s. s = V}, {(s, t). s = t},
                 UNIV, {s. (V, s) &#8712; guar} &#8745; post] &#10215;
  &#10233; &#8872; Await b P sat<span class="hidden">&#8681;</span><sub>p</sub> [pre, rely, guar, post]&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">unfold</span><span class=""> </span><span class="">prog_validity_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_p_def</span><span class=""> </span><span class="">assume_p_def</span><span class=""> </span><span class="">gets_p_def</span><span class=""> </span><span class="">getspc_p_def</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">frule_tac</span><span class=""> </span><span class="">j</span><span class="delimiter">=</span><span class="">0</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">k</span><span class="delimiter">=</span><span class="">i</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">p</span><span class="delimiter">=</span><span class="">pre</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">stability</span><span class="delimiter">,</span><span class="">simp_all</span><span class="delimiter">)</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">ia</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">subgoal_tac</span><span class=""> </span><span class="string">&quot;x&#8712; cpts_of_p (Some(Await b P)) s&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">i</span><span class="delimiter">=</span><span class="">i</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">unique_ctran_Await</span><span class="delimiter">,</span><span class="">force</span><span class="delimiter">,</span><span class="">simp_all</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="delimiter">--</span><span class="cartouche">&#8249;here starts the different part.&#8250;</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">ptran.cases</span><span class="delimiter">,</span><span class="">simp_all</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule</span><span class=""> </span><span class="">Star_imp_cptn</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">sa</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">sa</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">c</span><span class="delimiter">=</span><span class="">l</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">subsetD</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">ia</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">P</span><span class="delimiter">=</span><span class="string">&quot;&#955;i. H i &#10230; (J i, I i)&#8712;ptran&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">for</span></span><span class=""> </span><span class="">H</span><span class=""> </span><span class="">J</span><span class=""> </span><span class="">I</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">petranE</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">gets_p_def</span><span class=""> </span><span class="">getspc_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">frule_tac</span><span class=""> </span><span class="">i</span><span class="delimiter">=</span><span class="string">&quot;length x - 1&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">exists_ctran_Await_None</span><span class="delimiter">,</span><span class="">force</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">last_fst_esp</span><span class="delimiter">,</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">last_length</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">,</span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_p_def</span><span class=""> </span><span class="">gets_p_def</span><span class=""> </span><span class="">getspc_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">frule_tac</span><span class=""> </span><span class="">j</span><span class="delimiter">=</span><span class="">0</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">k</span><span class="delimiter">=</span><span class="string">&quot;j&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">p</span><span class="delimiter">=</span><span class="">pre</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">stability</span><span class="delimiter">,</span><span class="">simp_all</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">i</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">i</span><span class="delimiter">=</span><span class="">j</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">unique_ctran_Await</span><span class="delimiter">,</span><span class="">force</span><span class="delimiter">,</span><span class="">simp_all</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;x!j&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">s</span><span class="delimiter">=</span><span class="string">&quot;Some (Await b P)&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">sym</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;x!Suc j&quot;</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">ptran.cases</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp_all</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule</span><span class=""> </span><span class="">Star_imp_cptn</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">sa</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">sa</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">c</span><span class="delimiter">=</span><span class="">l</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">subsetD</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_p_def</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">i</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">P</span><span class="delimiter">=</span><span class="string">&quot;&#955;i. H i &#10230; (J i, I i)&#8712;ptran&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">for</span></span><span class=""> </span><span class="">H</span><span class=""> </span><span class="">J</span><span class=""> </span><span class="">I</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">petranE</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">frule_tac</span><span class=""> </span><span class="">j</span><span class="delimiter">=</span><span class="string">&quot;Suc j&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">k</span><span class="delimiter">=</span><span class="string">&quot;length x - 1&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">p</span><span class="delimiter">=</span><span class="">post</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">stability</span><span class="delimiter">,</span><span class="">simp_all</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">i</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">i</span><span class="delimiter">=</span><span class="">j</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">unique_ctran_Await</span><span class="delimiter">,</span><span class="">force</span><span class="delimiter">,</span><span class="">simp_all</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">arith</span><span class="delimiter">+</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">last_length</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">subsubsection</span></span><span class="cartouche">&#8249;Soundness of the Conditional rule&#8250;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">Cond_sound</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#10214; stable pre rely; &#8872; P1 sat<span class="hidden">&#8681;</span><sub>p</sub> [pre &#8745; b, rely, guar, post];
  &#8872; P2 sat<span class="hidden">&#8681;</span><sub>p</sub> [pre &#8745; - b, rely, guar, post]; &#8704;s. (s,s)&#8712;guar&#10215;
  &#10233; &#8872; (Cond b P1 P2) sat<span class="hidden">&#8681;</span><sub>p</sub> [pre, rely, guar, post]&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">unfold</span><span class=""> </span><span class="">prog_validity_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_p_def</span><span class=""> </span><span class="">commit_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_p_def</span><span class=""> </span><span class="">gets_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;&#8707;i. Suc i&lt;length x &#8743; x!i -c&#8594; x!Suc i&quot;</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span><span class=""> </span><span class="">2</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">frule_tac</span><span class=""> </span><span class="">j</span><span class="delimiter">=</span><span class="string">&quot;0&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">k</span><span class="delimiter">=</span><span class="string">&quot;length x - 1&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">p</span><span class="delimiter">=</span><span class="">pre</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">stability</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class="">     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_p_def</span><span class=""> </span><span class="">gets_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_p_def</span><span class=""> </span><span class="">gets_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">m</span><span class="delimiter">=</span><span class="string">&quot;length x&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">etran_or_ctran</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">,</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">last_length</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">exE</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">n</span><span class="delimiter">=</span><span class="">i</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">P</span><span class="delimiter">=</span><span class="string">&quot;&#955;i. H i &#8743; (J i, I i) &#8712; ptran&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">for</span></span><span class=""> </span><span class="">H</span><span class=""> </span><span class="">J</span><span class=""> </span><span class="">I</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">Ex_first_occurrence</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_p_def</span><span class=""> </span><span class="">gets_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">frule_tac</span><span class=""> </span><span class="">j</span><span class="delimiter">=</span><span class="">0</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">k</span><span class="delimiter">=</span><span class="string">&quot;m&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">p</span><span class="delimiter">=</span><span class="">pre</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">stability</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">m</span><span class="delimiter">=</span><span class="string">&quot;Suc m&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">etran_or_ctran</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">ptran.cases</span><span class="delimiter">,</span><span class="">simp_all</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;sa&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">c</span><span class="delimiter">=</span><span class="string">&quot;drop (Suc m) x&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">subsetD</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;i&#8804;m&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule</span><span class=""> </span><span class="">le_imp_less_or_eq</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">disjE</span><span class="delimiter">)</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">i</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class=""> </span><span class="">erule</span><span class=""> </span><span class="">impE</span><span class="delimiter">,</span><span class=""> </span><span class="">assumption</span><span class="delimiter">)</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;i - (Suc m)&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">P</span><span class="delimiter">=</span><span class="string">&quot;&#955;j. H j &#10230; J j &#10230; (I j)&#8712;guar&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">for</span></span><span class=""> </span><span class="">H</span><span class=""> </span><span class="">J</span><span class=""> </span><span class="">I</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">subgoal_tac</span><span class=""> </span><span class="string">&quot;(Suc m)+(i - Suc m) &#8804; length x&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">subgoal_tac</span><span class=""> </span><span class="string">&quot;(Suc m)+Suc (i - Suc m) &#8804; length x&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rotate_tac</span><span class=""> </span><span class="">-</span><span class="">2</span><span class="delimiter">)</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">arith</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">arith</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;length (drop (Suc m) x)&quot;</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;sa&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">c</span><span class="delimiter">=</span><span class="string">&quot;drop (Suc m) x&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">subsetD</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;i&#8804;m&quot;</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule</span><span class=""> </span><span class="">le_imp_less_or_eq</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">disjE</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">i</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class=""> </span><span class="">erule</span><span class=""> </span><span class="">impE</span><span class="delimiter">,</span><span class=""> </span><span class="">assumption</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;i - (Suc m)&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">P</span><span class="delimiter">=</span><span class="string">&quot;&#955;j. H j &#10230; J j &#10230; (I j)&#8712;guar&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">for</span></span><span class=""> </span><span class="">H</span><span class=""> </span><span class="">J</span><span class=""> </span><span class="">I</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">subgoal_tac</span><span class=""> </span><span class="string">&quot;(Suc m)+(i - Suc m) &#8804; length x&quot;</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">subgoal_tac</span><span class=""> </span><span class="string">&quot;(Suc m)+Suc (i - Suc m) &#8804; length x&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rotate_tac</span><span class=""> </span><span class="">-</span><span class="">2</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">arith</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">arith</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">subsubsection</span></span><span class="cartouche">&#8249;Soundness of the Sequential rule&#8250;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">inductive_cases</span></span><span class=""> </span><span class="">Seq_cases</span><span class=""> </span><span class="delimiter">[</span><span class="">elim</span><span class="delimiter">!</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(Some (Seq P Q), s) -c&#8594; t&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">last_lift_not_None</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;fst ((lift Q) ((x#xs)!(length xs))) &#8800; None&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">subgoal_tac</span><span class=""> </span><span class="string">&quot;length xs&lt;length (x # xs)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">Q</span><span class="delimiter">=</span><span class="">Q</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class="">  </span><span class="">lift_nth</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">ssubst</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;(x # xs) ! length xs&quot;</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">Seq_sound1</span><span class=""> </span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;x&#8712; cpt_p_mod &#10233; &#8704;s P. x !0=(Some (Seq P Q), s) &#10230;
  (&#8704;i&lt;length x. fst(x!i)&#8800;Some Q) &#10230;
  (&#8707;xs&#8712; cpts_of_p (Some P) s. x=map (lift Q) xs)&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">cpt_p_mod.induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">unfold</span><span class=""> </span><span class="">cpts_of_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">safe</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp_all</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;[(Some Pa, sa)]&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">exI</span><span class="delimiter">,</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">CptsPOne</span><span class="delimiter">)</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">subgoal_tac</span><span class=""> </span><span class="string">&quot;(&#8704;i &lt; Suc (length xs). fst (((Some (Seq Pa Q), t) # xs) ! i) &#8800; Some Q)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;(Some Pa, sa) #(Some Pa, t) # zs&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">exI</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">,</span><span class="">erule</span><span class=""> </span><span class="">CptsPEnv</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="delimiter">(</span><span class="">no_asm_use</span><span class="delimiter">)</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;Suc i&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class=""> </span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">ind_cases</span><span class=""> </span><span class="string">&quot;((Some (Seq Pa Q), sa), None, t) &#8712; ptran&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">for</span></span><span class=""> </span><span class="">Pa</span><span class=""> </span><span class="">sa</span><span class=""> </span><span class="">t</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;(Some P, sa) # xs&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">exI</span><span class="delimiter">,</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_iff_cpt_p_mod</span><span class=""> </span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;length xs&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class=""> </span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">only</span><span class="delimiter">:</span><span class="">Cons_lift_append</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">subgoal_tac</span><span class=""> </span><span class="string">&quot;length xs &lt; length ((Some P, sa) # xs)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">only</span><span class=""> </span><span class="delimiter">:</span><span class="">nth_append</span><span class=""> </span><span class="">length_map</span><span class=""> </span><span class="">last_length</span><span class=""> </span><span class="">nth_map</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;last((Some P, sa) # xs)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">Seq_sound2</span><span class=""> </span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;x &#8712; cpts_p &#10233; &#8704;s P i. x!0=(Some (Seq P Q), s) &#10230; i&lt;length x
  &#10230; fst(x!i)=Some Q &#10230;
  (&#8704;j&lt;i. fst(x!j)&#8800;(Some Q)) &#10230;
  (&#8707;xs ys. xs &#8712; cpts_of_p (Some P) s &#8743; length xs=Suc i
   &#8743; ys &#8712; cpts_of_p (Some Q) (snd(xs !i)) &#8743; x=(map (lift Q) xs)@tl ys)&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">cpts_p.induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">unfold</span><span class=""> </span><span class="">cpts_of_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">safe</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp_all</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">i</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class="">erule</span><span class=""> </span><span class="">impE</span><span class="delimiter">,</span><span class="">assumption</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">subgoal_tac</span><span class=""> </span><span class="string">&quot;(&#8704;j &lt; nat. fst (((Some (Seq Pa Q), t) # xs) ! j) &#8800; Some Q)&quot;</span><span class="delimiter">,</span><span class="">clarify</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span><span class=""> </span><span class="">2</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">xsa</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rename_tac</span><span class=""> </span><span class="">list</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;(Some Pa, sa) #(Some Pa, t) # list&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">exI</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">,</span><span class="">erule</span><span class=""> </span><span class="">CptsPEnv</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="delimiter">(</span><span class="">no_asm_use</span><span class="delimiter">)</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">ys</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">exI</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">ind_cases</span><span class=""> </span><span class="string">&quot;((Some (Seq Pa Q), sa), t) &#8712; ptran&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">for</span></span><span class=""> </span><span class="">Pa</span><span class=""> </span><span class="">sa</span><span class=""> </span><span class="">t</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;(Some Pa, sa)#[(None, ta)]&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">exI</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">xs</span><span class="delimiter">=</span><span class="string">&quot;[]&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">CptsPComp</span><span class="delimiter">,</span><span class="">force</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">CptsPOne</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">i</span><span class="delimiter">,</span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">nat</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;(Some Q,ta)#xs&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">exI</span><span class="delimiter">,</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">nat</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">i</span><span class="delimiter">,</span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">nat</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;Suc nata&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">subgoal_tac</span><span class=""> </span><span class="string">&quot;(&#8704;j&lt;Suc nata. fst (((Some (Seq P2 Q), ta) # xs) ! j) &#8800; Some Q)&quot;</span><span class="delimiter">,</span><span class="">clarify</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span><span class=""> </span><span class="">2</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;(Some Pa, sa)#(Some P2, ta)#(tl xsa)&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">exI</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">,</span><span class="">erule</span><span class=""> </span><span class="">CptsPComp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">nth_tl_if</span><span class="delimiter">,</span><span class="">force</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">ys</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">exI</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">nth_tl_if</span><span class="delimiter">,</span><span class="">force</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">tl_zero</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">,</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">subgoal_tac</span><span class=""> </span><span class="string">&quot;lift Q (Some P2, ta) =(Some (Seq P2 Q), ta)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">Cons_lift</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class="">list.map</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">nth_tl_if</span><span class="delimiter">)</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">last_lift_not_None2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;fst ((lift Q) (last (x#xs))) &#8800; None&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">only</span><span class="delimiter">:</span><span class="">last_length</span><span class=""> </span><span class="delimiter">[</span><span class="">THEN</span><span class=""> </span><span class="">sym</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">subgoal_tac</span><span class=""> </span><span class="string">&quot;length xs&lt;length (x # xs)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">Q</span><span class="delimiter">=</span><span class="">Q</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class="">  </span><span class="">lift_nth</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">ssubst</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;(x # xs) ! length xs&quot;</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">Seq_sound</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#10214;&#8872; P sat<span class="hidden">&#8681;</span><sub>p</sub> [pre, rely, guar, mid]; &#8872; Q sat<span class="hidden">&#8681;</span><sub>p</sub> [mid, rely, guar, post]&#10215;
  &#10233; &#8872; Seq P Q sat<span class="hidden">&#8681;</span><sub>p</sub> [pre, rely, guar, post]&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">unfold</span><span class=""> </span><span class="">prog_validity_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;&#8707;i&lt;length x. fst(x!i)=Some Q&quot;</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span><span class=""> </span><span class="">2</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_p_def</span><span class=""> </span><span class="">cpts_iff_cpt_p_mod</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">frule_tac</span><span class=""> </span><span class="">Seq_sound1</span><span class="delimiter">,</span><span class="">force</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">s</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">c</span><span class="delimiter">=</span><span class="">xs</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">subsetD</span><span class="delimiter">,</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_p_def</span><span class=""> </span><span class="">cpts_iff_cpt_p_mod</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_p_def</span><span class=""> </span><span class="">gets_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">P</span><span class="delimiter">=</span><span class="string">&quot;&#955;j. H j &#10230; J j &#10230; I j&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">for</span></span><span class=""> </span><span class="">H</span><span class=""> </span><span class="">J</span><span class=""> </span><span class="">I</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class="">erule</span><span class=""> </span><span class="">impE</span><span class="delimiter">,</span><span class=""> </span><span class="">assumption</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">snd_lift</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">mp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">elim</span><span class="delimiter">:</span><span class="">petranE</span><span class=""> </span><span class="">intro</span><span class="delimiter">:</span><span class="">EnvP</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_p_def</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">P</span><span class="delimiter">=</span><span class="string">&quot;&#955;j. H j &#10230; J j &#10230; I j&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">for</span></span><span class=""> </span><span class="">H</span><span class=""> </span><span class="">J</span><span class=""> </span><span class="">I</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class="">erule</span><span class=""> </span><span class="">impE</span><span class="delimiter">,</span><span class=""> </span><span class="">assumption</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">snd_lift</span><span class=""> </span><span class="">getspc_p_def</span><span class=""> </span><span class="">gets_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">mp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;(xs!i)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;(xs! Suc i)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;fst(xs!i)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">i</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;fst(xs!Suc i)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">xs</span><span class="delimiter">,</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_p_def</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class="">list.map</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">rename_tac</span><span class=""> </span><span class="">list</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">subgoal_tac</span><span class=""> </span><span class="string">&quot;(map (lift Q) ((a, b) # list))&#8800;[]&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule</span><span class=""> </span><span class="">last_conv_nth</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class="">list.map</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_p_def</span><span class=""> </span><span class="">gets_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">only</span><span class="delimiter">:</span><span class="">last_lift_not_None</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="delimiter">--</span><span class="cartouche">&#8249;@{text &quot;&#8707;i&lt;length x. fst (x ! i) = Some Q&quot;}&#8250;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">exE</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">n</span><span class="delimiter">=</span><span class="">i</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">P</span><span class="delimiter">=</span><span class="string">&quot;&#955;i. i &lt; length x &#8743; fst (x ! i) = Some Q&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">Ex_first_occurrence</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_p_def</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">frule_tac</span><span class=""> </span><span class="">i</span><span class="delimiter">=</span><span class="">m</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">Seq_sound2</span><span class="delimiter">,</span><span class="">force</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">s</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">c</span><span class="delimiter">=</span><span class="">xs</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">subsetD</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;xs=[]&quot;</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_p_def</span><span class=""> </span><span class="">assume_p_def</span><span class=""> </span><span class="">nth_append</span><span class=""> </span><span class="">gets_p_def</span><span class=""> </span><span class="">getspc_p_def</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">i</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">snd_lift</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">mp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">elim</span><span class="delimiter">:</span><span class="">petranE</span><span class=""> </span><span class="">intro</span><span class="delimiter">:</span><span class="">EnvP</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;snd(xs!m)&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_p_def</span><span class=""> </span><span class="">gets_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">c</span><span class="delimiter">=</span><span class="">ys</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">subsetD</span><span class="delimiter">,</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_p_def</span><span class=""> </span><span class="">assume_p_def</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;xs&#8800;[]&quot;</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule</span><span class=""> </span><span class="">last_conv_nth</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">gets_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">mp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;xs!m&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;fst(xs!m)&quot;</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class=""> </span><span class="">nth_append</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class=""> 
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">gets_p_def</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;m+i&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">ys</span><span class="delimiter">,</span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">nth_append</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">i</span><span class="delimiter">,</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">snd_lift</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class="">  
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">mp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;xs!m&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">elim</span><span class="delimiter">:</span><span class="">etran.cases</span><span class=""> </span><span class="">intro</span><span class="delimiter">:</span><span class="">EnvP</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">,</span><span class="">clarify</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;i&lt;m&quot;</span><span class="delimiter">,</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">nth_append</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">snd_lift</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class=""> </span><span class="">erule</span><span class=""> </span><span class="">impE</span><span class="delimiter">,</span><span class=""> </span><span class="">assumption</span><span class="delimiter">,</span><span class=""> </span><span class="">erule</span><span class=""> </span><span class="">mp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;(xs ! i)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;(xs ! Suc i)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;fst(xs ! i)&quot;</span><span class="delimiter">,</span><span class="">force</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;fst(xs ! Suc i)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;i-m&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">back</span></span></span></span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">subgoal_tac</span><span class=""> </span><span class="string">&quot;Suc (i - m) &lt; length ys&quot;</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span><span class=""> </span><span class="">2</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">arith</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">nth_append</span><span class=""> </span><span class="">snd_lift</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">,</span><span class="">clarify</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">subgoal_tac</span><span class=""> </span><span class="string">&quot;i=m&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span><span class=""> </span><span class="">2</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">arith</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">tl_zero</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">mp</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;lift Q (xs!m)&quot;</span><span class="delimiter">,</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">snd_lift</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;xs!m&quot;</span><span class="delimiter">,</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;fst(xs!m)&quot;</span><span class="delimiter">,</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class=""> </span><span class="">snd_lift</span><span class="delimiter">)</span><span class="">
</span><span class="">     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">ys</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">tl_zero</span><span class="delimiter">)</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">tl_zero</span><span class="delimiter">)</span><span class="">
</span><span class="">     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">subgoal_tac</span><span class=""> </span><span class="string">&quot;i-m=Suc(i-Suc m)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">mp</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">ys</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">arith</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;(map (lift Q) xs @ tl ys)&#8800;[]&quot;</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule</span><span class=""> </span><span class="">last_conv_nth</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">snd_lift</span><span class=""> </span><span class="">nth_append</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">,</span><span class="">clarify</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">ys</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">ys</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">subsubsection</span></span><span class="cartouche">&#8249;Soundness of the While rule&#8250;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">last_append</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#8704;xs. ys&#8800;[] &#10230; ((xs@ys)!(length (xs@ys) - (Suc 0)))=(ys!(length ys - (Suc 0)))&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">ys</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">nth_append</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">assum_after_body</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#10214; &#8872; P sat<span class="hidden">&#8681;</span><sub>p</sub> [pre &#8745; b, rely, guar, pre];
  (Some P, s) # xs &#8712; cpt_p_mod; fst (last ((Some P, s) # xs)) = None; s &#8712; b;
  (Some (While b P), s) # (Some (Seq P (While b P)), s) #
   map (lift (While b P)) xs @ ys &#8712; assume_p (pre, rely)&#10215;
  &#10233; (Some (While b P), snd (last ((Some P, s) # xs))) # ys &#8712; assume_p (pre, rely)&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_p_def</span><span class=""> </span><span class="">prog_validity_def</span><span class=""> </span><span class="">cpts_of_p_def</span><span class=""> </span><span class="">cpts_iff_cpt_p_mod</span><span class=""> </span><span class="">gets_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">s</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">c</span><span class="delimiter">=</span><span class="string">&quot;(Some P, s) # xs&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">subsetD</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;Suc i&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">Cons_lift_append</span><span class=""> </span><span class="">nth_append</span><span class=""> </span><span class="">snd_lift</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class="">list.map</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">mp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">petranE</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;fst(((Some P, s) # xs) ! i)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">intro</span><span class="delimiter">:</span><span class="">EnvP</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">intro</span><span class="delimiter">:</span><span class="">EnvP</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_p_def</span><span class=""> </span><span class="">last_length</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_p_def</span><span class=""> </span><span class="">getspc_p_def</span><span class=""> </span><span class="">gets_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;Suc(length xs + i)&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">i</span><span class="delimiter">,</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">nth_append</span><span class=""> </span><span class="">Cons_lift_append</span><span class=""> </span><span class="">snd_lift</span><span class=""> </span><span class="">last_conv_nth</span><span class=""> </span><span class="">lift_def</span><span class=""> </span><span class="">split_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">Cons_lift_append</span><span class=""> </span><span class="">nth_append</span><span class=""> </span><span class="">snd_lift</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">While_sound_aux</span><span class=""> </span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#10214; pre &#8745; - b &#8838; post; &#8872; P sat<span class="hidden">&#8681;</span><sub>p</sub> [pre &#8745; b, rely, guar, pre]; &#8704;s. (s, s) &#8712; guar;
   stable pre rely;  stable post rely; x &#8712; cpt_p_mod &#10215;
  &#10233;  &#8704;s xs. x=(Some(While b P),s)#xs &#10230; x&#8712;assume_p(pre, rely) &#10230; x &#8712; commit_p (guar, post)&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">cpt_p_mod.induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">safe</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp_all</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class="">last.simps</span><span class="delimiter">)</span><span class="">
</span><span class="delimiter">--</span><span class="cartouche">&#8249;5 subgoals left&#8250;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_p_def</span><span class=""> </span><span class="">getspc_p_def</span><span class=""> </span><span class="">gets_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="delimiter">--</span><span class="cartouche">&#8249;4 subgoals left&#8250;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">etran_in_comm</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">mp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">tl_of_assum_in_assum</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="delimiter">--</span><span class="cartouche">&#8249;While-None&#8250;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">ind_cases</span><span class=""> </span><span class="string">&quot;((Some (While b P), s), None, t) &#8712; ptran&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">for</span></span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">t</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_iff_cpt_p_mod</span><span class=""> </span><span class="delimiter">[</span><span class="">THEN</span><span class=""> </span><span class="">sym</span><span class="delimiter">]</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">,</span><span class="">clarify</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_p_def</span><span class=""> </span><span class="">getspc_p_def</span><span class=""> </span><span class="">gets_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">getspc_p_def</span><span class=""> </span><span class="">gets_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">,</span><span class=""> </span><span class="">clarify</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">i</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">not_ctran_None2</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">subgoal_tac</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &lt; length ((None, t) # xs) &#10230; (((None, t) # xs) ! i, ((None, t) # xs) ! Suc i)&#8712; petran&quot;</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span><span class=""> </span><span class="">2</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">m</span><span class="delimiter">=</span><span class="string">&quot;length ((None, s) # xs)&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">etran_or_ctran</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">not_ctran_None2</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">frule_tac</span><span class=""> </span><span class="">j</span><span class="delimiter">=</span><span class="string">&quot;0&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">k</span><span class="delimiter">=</span><span class="string">&quot;length ((None, s) # xs) - 1&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">p</span><span class="delimiter">=</span><span class="">post</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">stability</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_p_def</span><span class=""> </span><span class="">subsetD</span><span class=""> </span><span class="">gets_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;i&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">gets_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;Suc i&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">last_length</span><span class="delimiter">)</span><span class="">
</span><span class="delimiter">--</span><span class="cartouche">&#8249;WhileOne&#8250;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">thin_tac</span><span class=""> </span><span class="string">&quot;P = While b P &#10230; Q&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">for</span></span><span class=""> </span><span class="">Q</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">ctran_in_comm</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">Cons_lift</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class="">list.map</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_p_def</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class="">list.map</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;fst(((Some P, sa) # xs) ! i)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;((Some P, sa) # xs) ! i&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">ind_cases</span><span class=""> </span><span class="string">&quot;(Some (While b P), ba) -c&#8594; t&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">for</span></span><span class=""> </span><span class="">ba</span><span class=""> </span><span class="">t</span><span class="delimiter">)</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">gets_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">gets_p_def</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">snd_lift</span><span class=""> </span><span class="">gets_p_def</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class="">list.map</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">only</span><span class="delimiter">:</span><span class="">prog_validity_def</span><span class=""> </span><span class="">cpts_of_p_def</span><span class=""> </span><span class="">cpts_iff_cpt_p_mod</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">sa</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">c</span><span class="delimiter">=</span><span class="string">&quot;(Some P, sa) # xs&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">subsetD</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_p_def</span><span class=""> </span><span class="">gets_p_def</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class="">list.map</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;Suc ia&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">snd_lift</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class="">list.map</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">mp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;fst(((Some P, sa) # xs) ! ia)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">petranE</span><span class="delimiter">,</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">EnvP</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">petranE</span><span class="delimiter">,</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">EnvP</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_p_def</span><span class=""> </span><span class="">getspc_p_def</span><span class=""> </span><span class="">gets_p_def</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class="">list.map</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class="">erule</span><span class=""> </span><span class="">impE</span><span class="delimiter">,</span><span class="">assumption</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">mp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;((Some P, sa) # xs) ! i&quot;</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;xs!i&quot;</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;fst(xs!i)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="delimiter">--</span><span class="cartouche">&#8249;last=None&#8250;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">subgoal_tac</span><span class=""> </span><span class="string">&quot;(map (lift (While b P)) ((Some P, sa) # xs))&#8800;[]&quot;</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule</span><span class=""> </span><span class="">last_conv_nth</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_p_def</span><span class=""> </span><span class="">gets_p_def</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class="">list.map</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">only</span><span class="delimiter">:</span><span class="">last_lift_not_None</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="delimiter">--</span><span class="cartouche">&#8249;WhileMore&#8250;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">thin_tac</span><span class=""> </span><span class="string">&quot;P = While b P &#10230; Q&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">for</span></span><span class=""> </span><span class="">Q</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">ctran_in_comm</span><span class="delimiter">,</span><span class="">simp</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class="">last.simps</span><span class="delimiter">)</span><span class="">
</span><span class="delimiter">--</span><span class="cartouche">&#8249;metiendo la hipotesis antes de dividir la conclusion.&#8250;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">subgoal_tac</span><span class=""> </span><span class="string">&quot;(Some (While b P), snd (last ((Some P, sa) # xs))) # ys &#8712; assume_p (pre, rely)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class="">last.simps</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span><span class=""> </span><span class="">2</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">assum_after_body</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class="">last.simps</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="delimiter">--</span><span class="cartouche">&#8249;lo de antes.&#8250;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_p_def</span><span class=""> </span><span class="">getspc_p_def</span><span class=""> </span><span class="">gets_p_def</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class="">list.map</span><span class=""> </span><span class="">last.simps</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">only</span><span class="delimiter">:</span><span class="">Cons_lift_append</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;i&lt;length xs&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">nth_append</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class="">list.map</span><span class=""> </span><span class="">last.simps</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;fst(((Some P, sa) # xs) ! i)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;((Some P, sa) # xs) ! i&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class="">last.simps</span><span class="delimiter">)</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">ind_cases</span><span class=""> </span><span class="string">&quot;(Some (While b P), ba) -c&#8594; t&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">for</span></span><span class=""> </span><span class="">ba</span><span class=""> </span><span class="">t</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">snd_lift</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class="">list.map</span><span class=""> </span><span class="">last.simps</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">thin_tac</span><span class=""> </span><span class="string">&quot; &#8704;i. i &lt; length ys &#10230; P i&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">for</span></span><span class=""> </span><span class="">P</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">only</span><span class="delimiter">:</span><span class="">prog_validity_def</span><span class=""> </span><span class="">cpts_of_p_def</span><span class=""> </span><span class="">cpts_iff_cpt_p_mod</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">sa</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">c</span><span class="delimiter">=</span><span class="string">&quot;(Some P, sa) # xs&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">subsetD</span><span class="delimiter">)</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_p_def</span><span class=""> </span><span class="">getspc_p_def</span><span class=""> </span><span class="">gets_p_def</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class="">list.map</span><span class=""> </span><span class="">last.simps</span><span class="delimiter">)</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;Suc ia&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">nth_append</span><span class=""> </span><span class="">snd_lift</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class="">list.map</span><span class=""> </span><span class="">last.simps</span><span class="delimiter">,</span><span class=""> </span><span class="">erule</span><span class=""> </span><span class="">mp</span><span class="delimiter">)</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;fst(((Some P, sa) # xs) ! ia)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">petranE</span><span class="delimiter">,</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">EnvP</span><span class="delimiter">)</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">petranE</span><span class="delimiter">,</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">EnvP</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_p_def</span><span class=""> </span><span class="">getspc_p_def</span><span class=""> </span><span class="">gets_p_def</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class="">list.map</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class="">erule</span><span class=""> </span><span class="">impE</span><span class="delimiter">,</span><span class="">assumption</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">mp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;((Some P, sa) # xs) ! i&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;xs!i&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;fst(xs!i)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="delimiter">--</span><span class="cartouche">&#8249;@{text &quot;i &#8805; length xs&quot;}&#8250;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">subgoal_tac</span><span class=""> </span><span class="string">&quot;i-length xs &lt;length ys&quot;</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span><span class=""> </span><span class="">2</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">arith</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;i-length xs&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class="">clarify</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;i=length xs&quot;</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">nth_append</span><span class=""> </span><span class="">snd_lift</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class="">list.map</span><span class=""> </span><span class="">last.simps</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">last_length</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class="">last.simps</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">mp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;last((Some P, sa) # xs)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class="">last.simps</span><span class="delimiter">)</span><span class="">
</span><span class="delimiter">--</span><span class="cartouche">&#8249;@{text &quot;i&gt;length xs&quot;}&#8250;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;i-length xs&quot;</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">arith</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">nth_append</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class="">list.map</span><span class=""> </span><span class="">last.simps</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rotate_tac</span><span class=""> </span><span class="">-</span><span class="">3</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">subgoal_tac</span><span class=""> </span><span class="string">&quot;i- Suc (length xs)=nat&quot;</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span><span class=""> </span><span class="">2</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">arith</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="delimiter">--</span><span class="cartouche">&#8249;last=None&#8250;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">ys</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">Cons_lift</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class="">list.map</span><span class=""> </span><span class="">last.simps</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">subgoal_tac</span><span class=""> </span><span class="string">&quot;(map (lift (While b P)) ((Some P, sa) # xs))&#8800;[]&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule</span><span class=""> </span><span class="">last_conv_nth</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class="">list.map</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">only</span><span class="delimiter">:</span><span class="">last_lift_not_None</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">subgoal_tac</span><span class=""> </span><span class="string">&quot;((Some (Seq P (While b P)), sa) # map (lift (While b P)) xs @ ys)&#8800;[]&quot;</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule</span><span class=""> </span><span class="">last_conv_nth</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class="">list.map</span><span class=""> </span><span class="">last.simps</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">nth_append</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class="">last.simps</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rename_tac</span><span class=""> </span><span class="">a</span><span class=""> </span><span class="">list</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">subgoal_tac</span><span class=""> </span><span class="string">&quot;((Some (While b P), snd (last ((Some P, sa) # xs))) # a # list)&#8800;[]&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule</span><span class=""> </span><span class="">last_conv_nth</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">del</span><span class="delimiter">:</span><span class="">list.map</span><span class=""> </span><span class="">last.simps</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">While_sound</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#10214;stable pre rely; pre &#8745; - b &#8838; post; stable post rely;
    &#8872; P sat<span class="hidden">&#8681;</span><sub>p</sub> [pre &#8745; b, rely, guar, pre]; &#8704;s. (s,s)&#8712;guar&#10215;
  &#10233; &#8872; While b P sat<span class="hidden">&#8681;</span><sub>p</sub> [pre, rely, guar, post]&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">unfold</span><span class=""> </span><span class="">prog_validity_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">xs</span><span class="delimiter">=</span><span class="string">&quot;tl x&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">While_sound_aux</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">prog_validity_def</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp_all</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_iff_cpt_p_mod</span><span class=""> </span><span class="">cpts_of_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">nth_equalityI</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp_all</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">i</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">subsubsection</span></span><span class="cartouche">&#8249;Soundness of the Rule of Consequence&#8250;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">Conseq_sound</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#10214;pre &#8838; pre&#39;; rely &#8838; rely&#39;; guar&#39; &#8838; guar; post&#39; &#8838; post;
  &#8872; P sat<span class="hidden">&#8681;</span><sub>p</sub> [pre&#39;, rely&#39;, guar&#39;, post&#39;]&#10215;
  &#10233; &#8872; P sat<span class="hidden">&#8681;</span><sub>p</sub> [pre, rely, guar, post]&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">prog_validity_def</span><span class=""> </span><span class="">assume_p_def</span><span class=""> </span><span class="">commit_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">s</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">c</span><span class="delimiter">=</span><span class="">x</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">subsetD</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">subsubsection</span></span><span class="cartouche">&#8249;Soundness of the Nondt rule&#8250;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">unique_ctran_Nondt</span><span class=""> </span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#8704;s i. x &#8712; cpts_p &#10230; x ! 0 = (Some (Nondt r), s) &#10230;
  Suc i&lt;length x &#10230; x!i -c&#8594; x!Suc i &#10230;
  (&#8704;j. Suc j&lt;length x &#10230; i&#8800;j &#10230; x!j -pe&#8594; x!Suc j)&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">x</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">cpts_p.cases</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">i</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">j</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">EnvP</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">i</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">j</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">ptran.cases</span><span class="delimiter">,</span><span class="">simp_all</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">elim</span><span class="delimiter">:</span><span class=""> </span><span class="">not_ctran_None</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">ind_cases</span><span class=""> </span><span class="string">&quot;((Some (Nondt r), sa), Q, t) &#8712; ptran&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">for</span></span><span class=""> </span><span class="">sa</span><span class=""> </span><span class="">Q</span><span class=""> </span><span class="">t</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">i</span><span class="delimiter">=</span><span class="">nat</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">not_ctran_None</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">petranE</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">exists_ctran_Nondt_None</span><span class=""> </span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#8704;s i. x &#8712; cpts_p &#10230; x ! 0 = (Some (Nondt r), s)
  &#10230; i&lt;length x &#10230; fst(x!i)=None &#10230; (&#8707;j&lt;i. x!j -c&#8594; x!Suc j)&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">x</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">cpts_p.cases</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">i</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">nat</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;Suc j&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">exI</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">i</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">0</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">exI</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">Nondt_sound</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#10214;pre &#8838; {s. (&#8704;t. (s,t) &#8712; r &#10230; t &#8712; post) &#8743; (&#8707;t. (s,t) &#8712; r)}; {(s,t). s &#8712; pre &#8743; (s,t)&#8712;r} &#8838; guar;
            stable pre rely; stable post rely&#10215;
  &#10233; &#8872; Nondt r sat<span class="hidden">&#8681;</span><sub>p</sub> [pre, rely, guar, post]&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">unfold</span><span class=""> </span><span class="">prog_validity_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">clarify</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_p_def</span><span class=""> </span><span class="">gets_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_p_def</span><span class=""> </span><span class="">assume_p_def</span><span class=""> </span><span class="">gets_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">frule_tac</span><span class=""> </span><span class="">j</span><span class="delimiter">=</span><span class="">0</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">k</span><span class="delimiter">=</span><span class="">i</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">p</span><span class="delimiter">=</span><span class="">pre</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">stability</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp_all</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">i</span><span class="delimiter">=</span><span class="">i</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">r</span><span class="delimiter">=</span><span class="">r</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">unique_ctran_Nondt</span><span class="delimiter">,</span><span class="">simp_all</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;x!i&quot;</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">s</span><span class="delimiter">=</span><span class="string">&quot;Some (Nondt r)&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">sym</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">thin_tac</span><span class=""> </span><span class="string">&quot;&#8704;j. H j&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">for</span></span><span class=""> </span><span class="">H</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">elim</span><span class="delimiter">:</span><span class="">ptran.cases</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">frule_tac</span><span class=""> </span><span class="">i</span><span class="delimiter">=</span><span class="string">&quot;length x - 1&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">r</span><span class="delimiter">=</span><span class="">r</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">exists_ctran_Nondt_None</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">last_fst_esp</span><span class="delimiter">,</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">last_length</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_p_def</span><span class=""> </span><span class="">gets_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">frule_tac</span><span class=""> </span><span class="">j</span><span class="delimiter">=</span><span class="">0</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">k</span><span class="delimiter">=</span><span class="string">&quot;j&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">p</span><span class="delimiter">=</span><span class="">pre</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">stability</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp_all</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">i</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">i</span><span class="delimiter">=</span><span class="">j</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">r</span><span class="delimiter">=</span><span class="">r</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">unique_ctran_Nondt</span><span class="delimiter">,</span><span class="">simp_all</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;x!j&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">s</span><span class="delimiter">=</span><span class="string">&quot;Some (Nondt r)&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">sym</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="string">&quot;x!Suc j&quot;</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">ptran.cases</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp_all</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">c</span><span class="delimiter">=</span><span class="">sa</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">subsetD</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">frule_tac</span><span class=""> </span><span class="">j</span><span class="delimiter">=</span><span class="string">&quot;Suc j&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">k</span><span class="delimiter">=</span><span class="string">&quot;length x - 1&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">p</span><span class="delimiter">=</span><span class="">post</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">stability</span><span class="delimiter">,</span><span class="">simp_all</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">i</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">i</span><span class="delimiter">=</span><span class="">j</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">r</span><span class="delimiter">=</span><span class="">r</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">unique_ctran_Nondt</span><span class="delimiter">,</span><span class=""> </span><span class="">simp_all</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">arith</span><span class="delimiter">+</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">last_length</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">subsubsection</span></span><span class="cartouche">&#8249;Soundness of the Rule of Unprecond&#8250;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">Unprecond_sound</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot; &#8872; P sat<span class="hidden">&#8681;</span><sub>p</sub> [pre, rely, guar, post]&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot; &#8872; P sat<span class="hidden">&#8681;</span><sub>p</sub> [pre&#39;, rely, guar, post]&quot;</span><span class="">
</span><span class="">   </span><span class="keyword2"><span class="keyword">shows</span></span><span class=""> </span><span class="string">&quot; &#8872; P sat<span class="hidden">&#8681;</span><sub>p</sub> [pre &#8746; pre&#39;, rely, guar, post]&quot;</span><span class="">
</span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">  </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">c</span><span class="">
</span><span class="">  </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;c &#8712; cpts_of_p (Some P) s &#8745; assume_p(pre &#8746; pre&#39;, rely)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8712; cpts_of_p (Some P) s&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class="">
</span><span class="">        </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8712; assume_p(pre &#8746; pre&#39;, rely)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;c &#8712; assume_p(pre, rely) &#8744; c &#8712; assume_p(pre&#39;, rely)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">CollectD</span><span class=""> </span><span class="">CollectI</span><span class=""> </span><span class="">Un_iff</span><span class=""> </span><span class="">assume_p_def</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;c &#8712; commit_p(guar, post)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">proof</span></span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;c &#8712; assume_p (pre, rely)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;c &#8712; commit_p (guar, post)&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">unfolding</span></span><span class=""> </span><span class="">prog_validity_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;c &#8712; assume_p (pre&#39;, rely)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;c &#8712; commit_p (guar, post)&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">unfolding</span></span><span class=""> </span><span class="">prog_validity_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">unfolding</span></span><span class=""> </span><span class="">prog_validity_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">subsubsection</span></span><span class="cartouche">&#8249;Soundness of the Rule of Intpostcond&#8250;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">Intpostcond_sound</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot; &#8872; P sat<span class="hidden">&#8681;</span><sub>p</sub> [pre, rely, guar, post]&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot; &#8872; P sat<span class="hidden">&#8681;</span><sub>p</sub> [pre, rely, guar, post&#39;]&quot;</span><span class="">
</span><span class="">   </span><span class="keyword2"><span class="keyword">shows</span></span><span class=""> </span><span class="string">&quot; &#8872; P sat<span class="hidden">&#8681;</span><sub>p</sub> [pre, rely, guar, post &#8745; post&#39;]&quot;</span><span class="">
</span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">  </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">c</span><span class="">
</span><span class="">  </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8712; cpts_of_p (Some P) s &#8745; assume_p(pre, rely)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;c &#8712; commit_p(guar, post)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">unfolding</span></span><span class=""> </span><span class="">prog_validity_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;c &#8712; commit_p(guar, post&#39;)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">unfolding</span></span><span class=""> </span><span class="">prog_validity_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;c &#8712; commit_p(guar, post &#8745; post&#39;)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">commit_p_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">unfolding</span></span><span class=""> </span><span class="">prog_validity_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">subsubsection</span></span><span class="cartouche">&#8249;Soundness of the Rule of Allprecond&#8250;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">Allprecond_sound</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;v&#8712;U. &#8872; P sat<span class="hidden">&#8681;</span><sub>p</sub> [{v}, rely, guar, post]&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2"><span class="keyword">shows</span></span><span class=""> </span><span class="string">&quot; &#8872; P sat<span class="hidden">&#8681;</span><sub>p</sub> [U, rely, guar, post]&quot;</span><span class="">
</span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">  </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">c</span><span class="">
</span><span class="">  </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8712; cpts_of_p (Some P) s &#8745; assume_p(U, rely)&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">x</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;x&#8712;U &#8743; gets_p (c!0) = x&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">CollectD</span><span class=""> </span><span class="">IntD2</span><span class=""> </span><span class="">assume_p_def</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8872; P sat<span class="hidden">&#8681;</span><sub>p</sub> [{x}, rely, guar, post]&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;s. cpts_of_p (Some P) s &#8745; assume_p({x}, rely) &#8838; commit_p(guar, post)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">unfolding</span></span><span class=""> </span><span class="">prog_validity_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;c &#8712; assume_p(U, rely)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;gets_p (c!0) &#8712; U &#8743; (&#8704;i. Suc i&lt;length c &#10230; 
               c!i -pe&#8594; c!(Suc i) &#10230; (gets_p (c!i), gets_p (c!Suc i)) &#8712; rely)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_p (c!0) &#8712; {x} &#8743; (&#8704;i. Suc i&lt;length c &#10230; 
               c!i -pe&#8594; c!(Suc i) &#10230; (gets_p (c!i), gets_p (c!Suc i)) &#8712; rely)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">hence</span></span><span class=""> </span><span class="string">&quot;c&#8712;assume_p({x}, rely)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;c &#8712; commit_p(guar, post)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">prog_validity_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">subsubsection</span></span><span class="cartouche">&#8249;Soundness of the Rule of Emptyprecond&#8250;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">Emptyprecond_sound</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot; &#8872; P sat<span class="hidden">&#8681;</span><sub>p</sub> [{}, rely, guar, post]&quot;</span><span class="">
</span><span class="keyword1"><span class="command">unfolding</span></span><span class=""> </span><span class="">prog_validity_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">subsubsection</span></span><span class=""> </span><span class="cartouche">&#8249;Soundness of the system for programs&#8250;</span><span class="">
</span><span class="comment">(* declare [[show_types]] *)</span><span class="">
</span><span class="keyword1"><span class="command">theorem</span></span><span class=""> </span><span class="">rgsound_p</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#8866; P sat<span class="hidden">&#8681;</span><sub>p</sub> [pre, rely, guar, post] &#10233; &#8872; P sat<span class="hidden">&#8681;</span><sub>p</sub> [pre, rely, guar, post]&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">rghoare_p.induct</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">elim</span><span class="delimiter">:</span><span class="">Basic_sound</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">elim</span><span class="delimiter">:</span><span class="">Seq_sound</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">elim</span><span class="delimiter">:</span><span class="">Cond_sound</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">elim</span><span class="delimiter">:</span><span class="">While_sound</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">elim</span><span class="delimiter">:</span><span class="">Await_sound</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">elim</span><span class="delimiter">:</span><span class="">Nondt_sound</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">Conseq_sound</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">Unprecond_sound</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">Intpostcond_sound</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Allprecond_sound</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Emptyprecond_sound</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">subsection</span></span><span class=""> </span><span class="cartouche">&#8249;Soundness of Events&#8250;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">anony_cfgs0</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;&#8707;P. getspc_e (es ! 0) = AnonyEvent P; es &#8712; cpts_ev&#10215; 
                      &#10233; &#8704;i. (i &lt; length es &#10230; (&#8707;Q. getspc_e (es!i) = AnonyEvent Q) )&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;es &#8712; cpts_ev&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;P. getspc_e (es ! 0) = AnonyEvent P&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;&#8704;i. (i &lt; length es &#10230; (&#8707;Q. getspc_e (es!i) = AnonyEvent Q) )&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">es</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsEvOne</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;P. getspc_e ([(e, s, x)] ! 0) = AnonyEvent P&quot;</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsEvEnv</span><span class=""> </span><span class="">e&#39;</span><span class=""> </span><span class="">t&#39;</span><span class=""> </span><span class="">x&#39;</span><span class=""> </span><span class="">xs&#39;</span><span class=""> </span><span class="">s&#39;</span><span class=""> </span><span class="">y&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(e&#39;, t&#39;, x&#39;) # xs&#39; &#8712; cpts_ev&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class="">
</span><span class="">               </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;P. getspc_e (((e&#39;, t&#39;, x&#39;) # xs&#39;) ! 0) = AnonyEvent P &#10233;
                    &#8704;i&lt;length ((e&#39;, t&#39;, x&#39;) # xs&#39;). &#8707;Q. getspc_e (((e&#39;, t&#39;, x&#39;) # xs&#39;) ! i) = AnonyEvent Q&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class="">
</span><span class="">               </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;P. getspc_e (((e&#39;, s&#39;, y&#39;) # (e&#39;, t&#39;, x&#39;) # xs&#39;) ! 0) = AnonyEvent P&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">P1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_e (((e&#39;, s&#39;, y&#39;) # (e&#39;, t&#39;, x&#39;) # xs&#39;) ! 0) = AnonyEvent P1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;e&#39; = AnonyEvent P1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">getspc_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i&lt;length ((e&#39;, t&#39;, x&#39;) # xs&#39;). &#8707;Q. getspc_e (((e&#39;, t&#39;, x&#39;) # xs&#39;) ! i) = AnonyEvent Q&quot;</span><span class="">  
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">getspc_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">hide_lams</span><span class="delimiter">)</span><span class=""> </span><span class="">Ex_list_of_length</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="">gr0_conv_Suc</span><span class=""> 
</span><span class="">                        </span><span class="">length_Cons</span><span class=""> </span><span class="">length_tl</span><span class=""> </span><span class="">list.sel</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">not_less_eq</span><span class=""> </span><span class="">nth_non_equal_first_eq</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsEvComp</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">et</span><span class=""> </span><span class="">e2</span><span class=""> </span><span class="">t1</span><span class=""> </span><span class="">y1</span><span class=""> </span><span class="">xs1</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(e1, s1, x1) -et-et&#8594; (e2, t1, y1)&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class="">
</span><span class="">               </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(e2, t1, y1) # xs1 &#8712; cpts_ev&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class="">
</span><span class="">               </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;P. getspc_e (((e2, t1, y1) # xs1) ! 0) = AnonyEvent P &#10233;
                    &#8704;i&lt;length ((e2, t1, y1) # xs1). &#8707;Q. getspc_e (((e2, t1, y1) # xs1) ! i) = AnonyEvent Q&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class="">
</span><span class="">               </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;P. getspc_e (((e1, s1, x1) # (e2, t1, y1) # xs1) ! 0) = AnonyEvent P&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">P1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">b4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_e (((e1, s1, x1) # (e2, t1, y1) # xs1) ! 0) = AnonyEvent P1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;e1 = AnonyEvent P1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">getspc_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;Q. e2 = AnonyEvent Q&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">clarify</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">etran.cases</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp_all</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;P. getspc_e (((e2, t1, y1) # xs1) ! 0) = AnonyEvent P&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i&lt;length ((e2, t1, y1) # xs1). &#8707;Q. getspc_e (((e2, t1, y1) # xs1) ! i) = AnonyEvent Q&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b5</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">hide_lams</span><span class="delimiter">)</span><span class=""> </span><span class="">Ex_list_of_length</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="">gr0_conv_Suc</span><span class=""> 
</span><span class="">                        </span><span class="">length_Cons</span><span class=""> </span><span class="">length_tl</span><span class=""> </span><span class="">list.sel</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">not_less_eq</span><span class=""> </span><span class="">nth_non_equal_first_eq</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">anony_cfgs</span><span class=""> </span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;es &#8712; cpts_of_ev (AnonyEvent P) s x  &#10233; &#8704;i. (i &lt; length es &#10230; (&#8707;Q. getspc_e (es!i) = AnonyEvent Q) )&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;es &#8712; cpts_of_ev (AnonyEvent P) s x&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;es!0=(AnonyEvent P,(s,x)) &#8743; es &#8712; cpts_ev&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_ev_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;P. getspc_e (es ! 0) = AnonyEvent P&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">anony_cfgs0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">AnonyEvt_sound</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8872; P sat<span class="hidden">&#8681;</span><sub>p</sub> [pre, rely, guar, post] &#10233; &#8872; AnonyEvent (Some P) sat<span class="hidden">&#8681;</span><sub>e</sub> [pre, rely, guar, post]&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8872; P sat<span class="hidden">&#8681;</span><sub>p</sub> [pre, rely, guar, post]&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;s. cpts_of_p (Some P) s &#8745; assume_p (pre, rely) &#8838; commit_p (guar, post)&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">unfolding</span></span><span class=""> </span><span class="">prog_validity_def</span><span class=""> </span><span class="">cpts_of_p_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;s x. (cpts_of_ev (AnonyEvent (Some P)) s x) &#8745; assume_e (pre, rely) 
                      &#8838; commit_e (guar, post)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;el. el&#8712;(cpts_of_ev (AnonyEvent (Some P)) s x) &#8745; assume_e (pre, rely) &#10230; el&#8712; commit_e (guar, post)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">el</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el&#8712;(cpts_of_ev (AnonyEvent (Some P)) s x) &#8745; assume_e (pre, rely)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">pl</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;pl = lower_evts el&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;pl &#8712; cpts_of_p (Some P) s&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">equiv_lower_evts</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el!0=(AnonyEvent (Some P),(s,x))&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">b4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; cpts_ev&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_ev_def</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; assume_e (pre, rely)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;gets_p (pl!0) &#8712; pre&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;gets_e (el!0) &#8712; pre&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;gets_p (pl!0) = gets_e (el!0)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_p_def</span><span class=""> </span><span class="">gets_p_def</span><span class=""> </span><span class="">gets_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length pl &#10230; 
               pl!i -pe&#8594; pl!(Suc i) &#10230; (gets_p (pl!i), gets_p (pl!Suc i)) &#8712; rely&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i&lt;length pl&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;pl!i -pe&#8594; pl!(Suc i)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length el&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lower_evts_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_p (pl!i) = getspc_p (pl!(Suc i))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_p_def</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">petranE</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;lower_anonyevt1 (el!i) = pl!i&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="">lower_evts_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;lower_anonyevt1 (el!Suc i) = pl!Suc i&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="">lower_evts_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;Q. getspc_e (el!i) = AnonyEvent Q&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">Int_iff</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">anony_cfgs</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">Q1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c71</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_e (el!i) = AnonyEvent Q1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;Q. getspc_e (el ! (Suc i)) = AnonyEvent Q&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">Int_iff</span><span class=""> </span><span class="">anony_cfgs</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">Q2</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c81</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_e (el ! (Suc i)) = AnonyEvent Q2&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="">c71</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_p (pl ! i) = Q1&quot;</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">lower_anonyevt1_def</span><span class=""> </span><span class="">AnonyEv</span><span class=""> </span><span class="">getspc_p_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">fst_conv</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="">c81</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c10</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_p (pl ! (Suc i)) = Q2&quot;</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">lower_anonyevt1_def</span><span class=""> </span><span class="">AnonyEv</span><span class=""> </span><span class="">getspc_p_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">fst_conv</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">c9</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c11</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Q1 = Q2&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="">c71</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c61</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;gets_p (pl!i) = gets_e (el!i)&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">lower_anonyevt1_def</span><span class=""> </span><span class="">AnonyEv</span><span class=""> </span><span class="">gets_p_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">snd_conv</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="">c81</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c62</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;gets_p (pl! (Suc i)) = gets_e (el! (Suc i))&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">lower_anonyevt1_def</span><span class=""> </span><span class="">AnonyEv</span><span class=""> </span><span class="">gets_p_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">snd_conv</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c71</span><span class=""> </span><span class="">c81</span><span class=""> </span><span class="">c11</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c12</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_e (el!i) = getspc_e (el!(Suc i))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c13</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el!i -ee&#8594; el!(Suc i)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">eetran.EnvE</span><span class=""> </span><span class="">getspc_e_def</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">prod.collapse</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b5</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(&#8704;i. Suc i &lt; length el &#10230; el ! i -ee&#8594; el ! Suc i 
                      &#10230; (gets_e (el ! i), gets_e (el ! Suc i)) &#8712; rely)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="">c13</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_e (el!i), gets_e (el!Suc i)) &#8712; rely&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c61</span><span class=""> </span><span class="">c62</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_p (pl!i), gets_p (pl!Suc i)) &#8712; rely&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;pl &#8712; assume_p (pre, rely)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;pl &#8712; commit_p (guar, post)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b10</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;i. Suc i&lt;length el &#10230; 
               (&#8707;t. el!i -et-t&#8594; el!(Suc i)) &#10230; (gets_e (el!i), gets_e (el!Suc i)) &#8712; guar)&quot;</span><span class="">
</span><span class="">               </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">               </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">                 </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">                 </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i&lt;length el&quot;</span><span class="">
</span><span class="">                 </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;t. el!i -et-t&#8594; el!(Suc i)&quot;</span><span class="">
</span><span class="">                 </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length pl&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lower_evts_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                 
</span><span class="">                 </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;lower_anonyevt1 (el!i) = pl!i&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">lower_evts_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;lower_anonyevt1 (el!Suc i) = pl!Suc i&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">lower_evts_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;Q. getspc_e (el!i) = AnonyEvent Q&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">Int_iff</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">anony_cfgs</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                 </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">Q1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c71</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_e (el!i) = AnonyEvent Q1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                 </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;Q. getspc_e (el ! (Suc i)) = AnonyEvent Q&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">Int_iff</span><span class=""> </span><span class="">anony_cfgs</span><span class="delimiter">)</span><span class="">
</span><span class="">                 </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">Q2</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c81</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_e (el! (Suc i)) = AnonyEvent Q2&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">                 </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;pl!i -c&#8594; pl!(Suc i)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">t</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el!i -et-t&#8594; el!(Suc i)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;s1 = gets_e (el ! i) &#8743; x1 = getx_e (el ! i)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">s2</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;s2 = gets_e (el ! (Suc i)) &#8743; x2 = getx_e (el ! (Suc i))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">c71</span><span class=""> </span><span class="">c81</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d21</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el ! i = (AnonyEvent Q1, s1, x1) 
                                           &#8743; el ! (Suc i) = (AnonyEvent Q2, s2, x2)&quot;</span><span class=""> 
</span><span class="">                         </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">gets_e_def</span><span class=""> </span><span class="">getx_e_def</span><span class=""> </span><span class="">getspc_e_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">prod.collapse</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(AnonyEvent Q1, s1, x1) -et-t&#8594; (AnonyEvent Q2, s2, x2)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;k. t = ((Cmd CMP)&#9839;k)&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">etran.cases</span><span class="delimiter">)</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp_all</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;t = ((Cmd CMP)&#9839;k)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(Q1,s1) -c&#8594; (Q2, s2)&quot;</span><span class=""> 
</span><span class="">                      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">clarify</span><span class="delimiter">)</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">etran.cases</span><span class="delimiter">)</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp_all</span><span class="delimiter">+</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">d21</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;pl!i = (Q1,s1)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lower_anonyevt1_def</span><span class=""> </span><span class="">getspc_e_def</span><span class=""> </span><span class="">gets_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="">d21</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;pl! (Suc i) = (Q2,s2)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lower_anonyevt1_def</span><span class=""> </span><span class="">getspc_e_def</span><span class=""> </span><span class="">gets_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d4</span><span class=""> </span><span class="">d5</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                 </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b9</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(gets_p (pl!i), gets_p (pl!Suc i)) &#8712; guar&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">                 
</span><span class="">                 </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">c71</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;gets_e (el!i) = gets_p (pl!i)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">lower_anonyevt_s</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">                 </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="">c81</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c10</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;gets_e (el!Suc i) = gets_p (pl!Suc i)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">lower_anonyevt_s</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">                 </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c6</span><span class=""> </span><span class="">c9</span><span class=""> </span><span class="">c10</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class="">  </span><span class="string">&quot;(gets_e (el!i), gets_e (el!Suc i)) &#8712; guar&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">               </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">               </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">               </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b11</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(getspc_e (last el) = AnonyEvent (None) &#10230; gets_e (last el) &#8712; post)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class=""> 
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_e (last el) = AnonyEvent (None)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;last pl = lower_anonyevt1 (last el)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">CollectD</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">cptn_not_empty</span><span class=""> </span><span class="">cpts_of_p_def</span><span class=""> 
</span><span class="">                      </span><span class="">last_map</span><span class=""> </span><span class="">length_greater_0_conv</span><span class=""> </span><span class="">length_map</span><span class=""> </span><span class="">lower_evts_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b9</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_p (last pl) = None &#10230; gets_p (last pl) &#8712; post&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_p (last pl) = None&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">getspc_p_def</span><span class=""> </span><span class="">lower_anonyevt1_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;gets_p (last pl) &#8712; post&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_p (last pl) = gets_e (last el)&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">getspc_p_def</span><span class=""> </span><span class="">lower_anonyevt1_def</span><span class=""> </span><span class="">gets_p_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;gets_e (last el) &#8712; post&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">            
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b10</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;el &#8712; commit_e (guar, post)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(cpts_of_ev (AnonyEvent (Some P)) s x) &#8745; assume_e (pre, rely) &#8838; commit_e (guar, post)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">evt_validity_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">BasicEvt_sound</span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;&#10214; &#8872; (body ev) sat<span class="hidden">&#8681;</span><sub>p</sub> [pre &#8745; (guard ev), rely, guar, post]; 
        stable pre rely; &#8704;s. (s, s)&#8712;guar&#10215; 
     &#10233; &#8872; ((BasicEvent ev)::(&#39;l,&#39;k,&#39;s) event) sat<span class="hidden">&#8681;</span><sub>e</sub> [pre, rely, guar, post]&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8872; (body ev) sat<span class="hidden">&#8681;</span><sub>p</sub> [pre &#8745; (guard ev), rely, guar, post]&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;s. (s, s)&#8712;guar&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;stable pre rely&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;s x. (cpts_of_ev ((BasicEvent ev)::(&#39;l,&#39;k,&#39;s) event) s x) &#8745; assume_e (pre, rely) 
                      &#8838; commit_e (guar, post)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;el. el&#8712;(cpts_of_ev (BasicEvent ev) s x) &#8745; assume_e (pre, rely) &#10230; el&#8712; commit_e (guar, post)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">el</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el&#8712;(cpts_of_ev (BasicEvent ev) s x) &#8745; assume_e (pre, rely)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b0_1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el&#8712;(cpts_of_ev (BasicEvent ev) s x)&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class="">
</span><span class="">                      </span><span class="">b0_2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; assume_e (pre, rely)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0_1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el ! 0 = (BasicEvent ev, (s, x))&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class="">
</span><span class="">                           </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; cpts_ev&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_ev_def</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0_2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;gets_e (el!0) &#8712; pre&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class="">
</span><span class="">                           </span><span class="">b4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;i. Suc i&lt;length el &#10230; el!i -ee&#8594; el!(Suc i) &#10230; 
                                (gets_e (el!i), gets_e (el!Suc i)) &#8712; rely)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">assume_e_def</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;el&#8712; commit_e (guar, post)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;&#8707;i k. Suc i &lt; length el &#8743; el ! i -et-(EvtEnt (BasicEvent ev))&#9839;k&#8594; el ! (Suc i)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;i k. Suc i &lt; length el &#8743; el ! i -et-(EvtEnt (BasicEvent ev))&#9839;k&#8594; el ! (Suc i)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">m</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc m &lt; length el &#8743; el ! m -et-(EvtEnt (BasicEvent ev))&#9839;k&#8594; el ! (Suc m)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;j. Suc j &#8804; m &#10230; getspc_e (el ! j) = BasicEvent ev &#8743; el ! j -ee&#8594; el ! (Suc j)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">evtent_in_cpts1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;gets_e (el ! m) &#8712; guard ev&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class="">
</span><span class="">                        </span><span class="">c6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;drop (Suc m) el &#8712; cpts_of_ev (AnonyEvent (Some (body ev))) (gets_e (el ! (Suc m))) ((getx_e (el ! m)) (k := BasicEvent ev))&quot;</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtent_in_cpts2</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">el</span><span class=""> </span><span class="">ev</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">m</span><span class=""> </span><span class="">k</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8872; ((AnonyEvent (Some (body ev)))::(&#39;l,&#39;k,&#39;s) event) 
                                sat<span class="hidden">&#8681;</span><sub>e</sub> [pre &#8745; (guard ev), rely, guar, post]&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">AnonyEvt_sound</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c8</span><span class="delimiter">:</span><span class="string">&quot;&#8704;j. Suc j &#8804; m &#10230; (gets_e (el ! j), gets_e (el ! (Suc j))) &#8712; rely&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;j. j &#8804; m &#10230; gets_e (el ! j) &#8712; pre&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">j</span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j &#8804; m&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_e (el ! j) &#8712; pre&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">j</span><span class="delimiter">)</span><span class="">
</span><span class="">                        </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">b3</span><span class="delimiter">)</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                        </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Suc</span><span class=""> </span><span class="">jj</span><span class="delimiter">)</span><span class="">
</span><span class="">                        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc jj &#8804; m&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;jj &#8804; m &#10233; gets_e (el ! jj) &#8712; pre&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">c8</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_e (el ! jj), gets_e (el ! (Suc jj))) &#8712; rely&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">Suc_leD</span><span class=""> </span><span class="">stable_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c10</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;gets_e (el ! m) = gets_e (el ! (Suc m))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">ent_spec2</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c9</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c11</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;gets_e (el ! (Suc m)) &#8712; pre&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c7</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c12</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;s x. (cpts_of_ev ((AnonyEvent (Some (body ev)))::(&#39;l,&#39;k,&#39;s) event) s x) &#8745; 
                    assume_e(pre &#8745; (guard ev), rely) &#8838; commit_e(guar, post)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">evt_validity_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                
</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;drop (Suc m) el &#8712; assume_e(pre &#8745; (guard ev), rely)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c11</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;gets_e (drop (Suc m) el ! 0) &#8712; pre&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="">c10</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;gets_e (drop (Suc m) el ! 0) &#8712; guard ev&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &lt; length el - Suc m &#10230;
                             el ! Suc (m + i) -ee&#8594; el ! Suc (Suc (m + i)) &#10230; 
                             (gets_e (el ! Suc (m + i)), gets_e (el ! Suc (Suc (m + i)))) &#8712; rely&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c6</span><span class=""> </span><span class="">c12</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c13</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;drop (Suc m) el &#8712; commit_e(guar, post)&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">AnonyEvt_sound</span><span class=""> </span><span class="">IntI</span><span class=""> </span><span class="">contra_subsetD</span><span class=""> </span><span class="">evt_validity_def</span><span class=""> </span><span class="">p0</span><span class="delimiter">)</span><span class="">
</span><span class="">               
</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c14</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &lt; length el &#10230; (&#8707;t. el ! i -et-t&#8594; el ! Suc i) 
                    &#10230; (gets_e (el ! i), gets_e (el ! Suc i)) &#8712; guar&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class=""> 
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length el&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class="">
</span><span class="">                           </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8707;t. el ! i -et-t&#8594; el ! Suc i)&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_e (el ! i), gets_e (el ! Suc i)) &#8712; guar&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;Suc i &#8804; m&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &#8804; m&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;el ! i -ee&#8594; el ! (Suc i)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172;(&#8707;t. el ! i -et-t&#8594; el ! Suc i)&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">eetranE</span><span class=""> </span><span class="">evt_not_eq_in_tran</span><span class=""> </span><span class="">prod.collapse</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172; Suc i &#8804; m&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &gt; m&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                        </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;Suc i = m + 1&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">f0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i = m + 1&quot;</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i = m&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;el ! i -et-(EvtEnt (BasicEvent ev))&#9839;k&#8594; el ! (Suc i)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_e (el ! i) = gets_e (el ! (Suc i))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">ent_spec2</span><span class="delimiter">)</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">f0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172; Suc i = m + 1&quot;</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &gt; Suc m&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c13</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &lt; length (drop (Suc m) el) &#10230; 
                                    (&#8707;t. (drop (Suc m) el) ! i -et-t&#8594; (drop (Suc m) el) ! Suc i) &#10230; 
                                    (gets_e ((drop (Suc m) el) ! i), gets_e ((drop (Suc m) el) ! Suc i)) &#8712; guar&quot;</span><span class="">
</span><span class="">                                    </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_e (drop (Suc m) el ! (i - Suc m)), gets_e (drop (Suc m) el ! Suc (i - Suc m))) &#8712; guar&quot;</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">g0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc (i - Suc m) &lt; length (drop (Suc m) el)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(&#8707;t. drop (Suc m) el ! (i - Suc m) -et-t&#8594; drop (Suc m) el ! Suc (i - Suc m))&quot;</span><span class="">
</span><span class="">                                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">g0</span><span class=""> </span><span class="">f2</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">add_Suc_right</span><span class=""> 
</span><span class="">                                </span><span class="">add_diff_inverse_nat</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="">less_imp_le_nat</span><span class=""> </span><span class="">not_less_eq</span><span class=""> </span><span class="">nth_drop</span><span class="delimiter">)</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                   </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c13</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c15</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot; getspc_e (last el) = AnonyEvent None &#10230; gets_e (last el) &#8712; post&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;last (drop (Suc m) el) = last el&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c13</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c14</span><span class=""> </span><span class="">c15</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172; (&#8707;i k. Suc i &lt; length el &#8743; el ! i -et-(EvtEnt (BasicEvent ev))&#9839;k&#8594; el ! (Suc i) )&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;j. Suc j &lt; length el &#10230; getspc_e (el ! j) = BasicEvent ev 
                              &#8743; el ! j -ee&#8594; el ! (Suc j)
                              &#8743; getspc_e (el ! (Suc j)) = BasicEvent ev&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">no_evtent_in_cpts</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;i. Suc i&lt;length el &#10230; (&#8707;t. el!i -et-t&#8594; el!(Suc i)) 
                          &#10230; (gets_e (el!i), gets_e (el!Suc i)) &#8712; guar)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;Suc i&lt;length el&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;t. el!i -et-t&#8594; el!(Suc i)&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;el ! i -ee&#8594; el ! Suc i&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172; (&#8707;t. el!i -et-t&#8594; el!(Suc i))&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">eetranE</span><span class=""> </span><span class="">evt_not_eq_in_tran2</span><span class=""> </span><span class="">prod.collapse</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">False</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;el &#8800; []&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_e_not_empty</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">els</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;el = (BasicEvent ev, s, x) # els&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">hd_Cons_tl</span><span class=""> </span><span class="">hd_conv_nth</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_e (last el) = BasicEvent ev&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">els</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">Nil</span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;el = [(BasicEvent ev, s, x)]&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;last el = (BasicEvent ev, s, x)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Cons</span><span class=""> </span><span class="">els1</span><span class=""> </span><span class="">elsr</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el = (BasicEvent ev, s, x) # els1 # elsr&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length el &gt; 1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">mm</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc mm = length el&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">jj</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">d3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc jj = mm&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;last el = el ! mm&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">last.simps</span><span class=""> </span><span class="">last_length</span><span class=""> </span><span class="">nth_Cons_Suc</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_e (el ! (Suc jj)) = BasicEvent ev&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="">d3</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d3</span><span class=""> </span><span class="">d4</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_e (last el) = AnonyEvent (None) &#10230; gets_e (last el) &#8712; post&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">evt_validity_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">ev_seq_sound</span><span class="delimiter">:</span><span class=""> 
</span><span class="">      </span><span class="string">&quot;&#10214;pre &#8838; pre&#39;; rely &#8838; rely&#39;; guar&#39; &#8838; guar; post&#39; &#8838; post;
        &#8872; ev sat<span class="hidden">&#8681;</span><sub>e</sub> [pre&#39;, rely&#39;, guar&#39;, post&#39;]&#10215; 
    &#10233; &#8872; ev sat<span class="hidden">&#8681;</span><sub>e</sub> [pre, rely, guar, post]&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;pre &#8838; pre&#39;&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rely &#8838; rely&#39;&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;guar&#39; &#8838; guar&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;post&#39; &#8838; post&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8872; ev sat<span class="hidden">&#8681;</span><sub>e</sub> [pre&#39;, rely&#39;, guar&#39;, post&#39;]&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;s x. (cpts_of_ev ev s x) &#8745; assume_e(pre&#39;, rely&#39;) &#8838; commit_e(guar&#39;, post&#39;)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">evt_validity_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;s x. (cpts_of_ev ev s x) &#8745; assume_e(pre, rely) &#8838; commit_e(guar, post)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c&#8712;(cpts_of_ev ev s x) &#8745; assume_e(pre, rely)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;c&#8712;(cpts_of_ev ev s x) &#8743; c&#8712;assume_e(pre, rely)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;c&#8712;(cpts_of_ev ev s x) &#8743; c&#8712;assume_e(pre&#39;, rely&#39;)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assume_e_imp</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">pre</span><span class=""> </span><span class="">pre&#39;</span><span class=""> </span><span class="">rely</span><span class=""> </span><span class="">rely&#39;</span><span class=""> </span><span class="">c</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;c&#8712;commit_e(guar&#39;, post&#39;)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;c&#8712;commit_e(guar, post)&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">commit_e_imp</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">guar&#39;</span><span class=""> </span><span class="">guar</span><span class=""> </span><span class="">post&#39;</span><span class=""> </span><span class="">post</span><span class=""> </span><span class="">c</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">evt_validity_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">theorem</span></span><span class=""> </span><span class="">rgsound_e</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#8866; Evt sat<span class="hidden">&#8681;</span><sub>e</sub> [pre, rely, guar, post] &#10233; &#8872; Evt sat<span class="hidden">&#8681;</span><sub>e</sub> [pre, rely, guar, post]&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">rghoare_e.induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">AnonyEvt_sound</span><span class=""> </span><span class="">rgsound_p</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">BasicEvt_sound</span><span class=""> </span><span class="">rgsound_p</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">ev_seq_sound</span><span class=""> </span><span class="">rgsound_p</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">  
</span><span class="keyword1"><span class="command">subsection</span></span><span class=""> </span><span class="cartouche">&#8249;Soundness of Event Systems&#8250;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">evtseq_nfin_samelower</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;esl &#8712; cpts_of_es (EvtSeq e es) s x; &#8704;i. Suc i &#8804; length esl &#10230; getspc_es (esl ! i) &#8800; es&#10215; 
        &#10233; (&#8707;el. (el &#8712; cpts_of_ev e s x &#8743; length esl = length el &#8743; e_eqv_einevtseq esl el es))&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl &#8712; cpts_of_es (EvtSeq e es) s x&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &#8804; length esl &#10230; getspc_es (esl ! i) &#8800; es&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p01</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl ! 0 = (EvtSeq e es, s, x) &#8743; esl &#8712; cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">cpts_of_es_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p01_1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl ! 0 = (EvtSeq e es, s, x)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;e. getspc_es (esl ! 0) = EvtSeq e es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p01</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p01_2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl &#8712; cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?el</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;rm_evtsys esl&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length esl = length ?el&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">rm_evtsys_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?el &#8712; cpts_of_ev e s x&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p01_2</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el &#8712; cpts_ev&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">esl</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsEsOne</span><span class=""> </span><span class="">es1</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">x1</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;e. getspc_es ([(es1, s1, x1)] ! 0) = EvtSeq e es&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es ([(es1, s1, x1)] ! 0) = EvtSeq e1 es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;es1 = EvtSeq e1 es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;rm_evtsys1 (es1, s1, x1) = (e1, s1, x1)&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">rm_evtsys1_def</span><span class=""> </span><span class="">getx_es_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;rm_evtsys [(es1, s1, x1)] = [(e1, s1, x1)]&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">rm_evtsys_def</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">cpts_ev.CptsEvOne</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsEsEnv</span><span class=""> </span><span class="">es1</span><span class=""> </span><span class="">t1</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">xs1</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">y1</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(es1, t1, x1) # xs1 &#8712; cpts_es&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &#8804; length ((es1, t1, x1) # xs1) &#10230; getspc_es (((es1, t1, x1) # xs1) ! i) &#8800; es
                            &#10233;&#8707;e. getspc_es (((es1, t1, x1) # xs1) ! 0) = EvtSeq e es 
                            &#10233; rm_evtsys ((es1, t1, x1) # xs1) &#8712; cpts_ev&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">c11</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &#8804; length ((es1, s1, y1) # (es1, t1, x1) # xs1) 
                                  &#10230; getspc_es (((es1, s1, y1) # (es1, t1, x1) # xs1) ! i) &#8800; es&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;e. getspc_es (((es1, s1, y1) # (es1, t1, x1) # xs1) ! 0) = EvtSeq e es&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (((es1, s1, y1) # (es1, t1, x1) # xs1) ! 0) = EvtSeq e1 es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;es1 = EvtSeq e1 es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c11</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &#8804; length ((es1, t1, x1) # xs1) &#10230; getspc_es (((es1, t1, x1) # xs1) ! i) &#8800; es&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rm_evtsys ((es1, t1, x1) # xs1) &#8712; cpts_ev&quot;</span><span class="">  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rm_evtsys ((es1, t1, x1) # xs1) = (rm_evtsys1 (es1, t1, x1)) # (rm_evtsys xs1)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">rm_evtsys_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rm_evtsys ((es1, s1, y1) # (es1, t1, x1) # xs1) = 
                  (rm_evtsys1 (es1, s1, y1)) # (rm_evtsys1 (es1, t1, x1)) # (rm_evtsys xs1)&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">rm_evtsys_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rm_evtsys1 (es1, s1, y1) = (e1, s1, y1)&quot;</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">rm_evtsys1_def</span><span class=""> </span><span class="">getx_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rm_evtsys1 (es1, t1, x1) = (e1, t1, x1)&quot;</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">rm_evtsys1_def</span><span class=""> </span><span class="">getx_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c10</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rm_evtsys ((es1, s1, y1) # (es1, t1, x1) # xs1) = (e1, s1, y1) # (e1, t1, x1) # rm_evtsys xs1&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">c7</span><span class=""> </span><span class="">c8</span><span class=""> </span><span class="">c9</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;rm_evtsys ((es1, t1, x1) # xs1) = (e1, t1, x1) # rm_evtsys xs1&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">c6</span><span class=""> </span><span class="">c9</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="">c10</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">cpts_ev.CptsEvEnv</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsEsComp</span><span class=""> </span><span class="">es1</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">et</span><span class=""> </span><span class="">es2</span><span class=""> </span><span class="">t1</span><span class=""> </span><span class="">y1</span><span class=""> </span><span class="">xs1</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(es1, s1, x1) -es-et&#8594; (es2, t1, y1)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(es2, t1, y1) # xs1 &#8712; cpts_es&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &#8804; length ((es2, t1, y1) # xs1) &#10230; getspc_es (((es2, t1, y1) # xs1) ! i) &#8800; es
                            &#10233; &#8707;e. getspc_es (((es2, t1, y1) # xs1) ! 0) = EvtSeq e es 
                            &#10233; rm_evtsys ((es2, t1, y1) # xs1) &#8712; cpts_ev&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">c3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &#8804; length ((es1, s1, x1) # (es2, t1, y1) # xs1)
                              &#10230; getspc_es (((es1, s1, x1) # (es2, t1, y1) # xs1) ! i) &#8800; es&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">c4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;e. getspc_es (((es1, s1, x1) # (es2, t1, y1) # xs1) ! 0) = EvtSeq e es&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c41</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (((es1, s1, x1) # (es2, t1, y1) # xs1) ! 0) = EvtSeq e1 es&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;es1 = EvtSeq e1 es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (es2, t1, y1) &#8800; es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;es2 &#8800; es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">              
</span><span class="">              </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;e2. es2 = EvtSeq e2 es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">evtseq_tran_evtsys</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">e2</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;es2 = EvtSeq e2 es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;t. (e1,s1,x1) -et-t&#8594; (e2,t1,y1)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">evtseq_tran_exist_etran</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">t</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c71</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(e1,s1,x1) -et-t&#8594; (e2,t1,y1)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rm_evtsys ((es1, s1, x1) # (es2, t1, y1) # xs1) = 
                  (rm_evtsys1 (es1, s1, x1)) # (rm_evtsys1 (es2, t1, y1)) # (rm_evtsys xs1)&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">rm_evtsys_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rm_evtsys ((es2, t1, y1) # xs1) = rm_evtsys1 (es2, t1, y1) # (rm_evtsys xs1)&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">rm_evtsys_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c10</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &#8804; length ((es2, t1, y1) # xs1) &#10230; getspc_es (((es2, t1, y1) # xs1) ! i) &#8800; es&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c7</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;e. getspc_es (((es2, t1, y1) # xs1) ! 0) = EvtSeq e es&quot;</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="">c10</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c11</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rm_evtsys ((es2, t1, y1) # xs1) &#8712; cpts_ev&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c12</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rm_evtsys1 (es1, s1, x1) = (e1, s1, x1)&quot;</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">rm_evtsys1_def</span><span class=""> </span><span class="">getx_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c7</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c13</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rm_evtsys1 (es2, t1, y1) = (e2, t1, y1)&quot;</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">rm_evtsys1_def</span><span class=""> </span><span class="">getx_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c71</span><span class=""> </span><span class="">c8</span><span class=""> </span><span class="">c9</span><span class=""> </span><span class="">c11</span><span class=""> </span><span class="">c12</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_ev.CptsEvComp</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?el ! 0=(e,(s,x))&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p01</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;rm_evtsys1 (esl ! 0) = (e, s, x)&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">getx_es_def</span><span class=""> </span><span class="">rm_evtsys1_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?el ! 0 = rm_evtsys1 (esl ! 0)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">rm_evtsys_def</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">cpts_e_not_empty</span><span class=""> </span><span class="">length_greater_0_conv</span><span class=""> </span><span class="">nth_map</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?el ! 0=(e,(s,x)) &#8743; ?el &#8712; cpts_ev&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">cpts_of_ev_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p01_2</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;e_eqv_einevtseq esl ?el es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">esl</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsEsOne</span><span class=""> </span><span class="">es1</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">x1</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;e. getspc_es ([(es1, s1, x1)] ! 0) = EvtSeq e es&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es ([(es1, s1, x1)] ! 0) = EvtSeq e1 es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;es1 = EvtSeq e1 es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;rm_evtsys1 (es1, s1, x1) = (e1, s1, x1)&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">rm_evtsys1_def</span><span class=""> </span><span class="">getx_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rm_evtsys [(es1, s1, x1)] = [(e1, s1, x1)]&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">rm_evtsys_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">e_eqv_einevtseq_def</span><span class="delimiter">,</span><span class=""> </span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc 0 = length (rm_evtsys [(es1, s1, x1)])&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">a2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_e (rm_evtsys [(es1, s1, x1)] ! 0) = gets_es ([(es1, s1, x1)] ! 0)&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">rm_evtsys1_def</span><span class=""> </span><span class="">gets_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getx_e (rm_evtsys [(es1, s1, x1)] ! 0) = getx_es ([(es1, s1, x1)] ! 0)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">getx_es_def</span><span class=""> </span><span class="">rm_evtsys1_def</span><span class=""> </span><span class="">getx_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es ([(es1, s1, x1)] ! 0) = EvtSeq (getspc_e (rm_evtsys [(es1, s1, x1)] ! 0)) es&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">getspc_e_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">nth_Cons_0</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &#8804; length (rm_evtsys [(es1, s1, x1)]) &#10230;
                      gets_e (rm_evtsys [(es1, s1, x1)] ! i) = gets_es ([(es1, s1, x1)] ! i) &#8743;
                      getx_e (rm_evtsys [(es1, s1, x1)] ! i) = getx_es ([(es1, s1, x1)] ! i) &#8743;
                      getspc_es ([(es1, s1, x1)] ! i) = EvtSeq (getspc_e (rm_evtsys [(es1, s1, x1)] ! i)) es&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_le_lessD</span><span class=""> </span><span class="">less_one</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsEsEnv</span><span class=""> </span><span class="">es1</span><span class=""> </span><span class="">t1</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">xs1</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">y1</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(es1, t1, x1) # xs1 &#8712; cpts_es&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &#8804; length ((es1, t1, x1) # xs1) &#10230; getspc_es (((es1, t1, x1) # xs1) ! i) &#8800; es &#10233;
                    &#8707;e. getspc_es (((es1, t1, x1) # xs1) ! 0) = EvtSeq e es &#10233;
                    e_eqv_einevtseq ((es1, t1, x1) # xs1) (rm_evtsys ((es1, t1, x1) # xs1)) es&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &#8804; length ((es1, s1, y1) # (es1, t1, x1) # xs1) 
                      &#10230; getspc_es (((es1, s1, y1) # (es1, t1, x1) # xs1) ! i) &#8800; es&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;e. getspc_es (((es1, s1, y1) # (es1, t1, x1) # xs1) ! 0) = EvtSeq e es&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &#8804; length ((es1, t1, x1) # xs1) &#10230; getspc_es (((es1, t1, x1) # xs1) ! i) &#8800; es&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;es1 = EvtSeq e1 es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">nth_Cons_0</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;e. getspc_es (((es1, t1, x1) # xs1) ! 0) = EvtSeq e es&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">getspc_es_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;e_eqv_einevtseq ((es1, t1, x1) # xs1) (rm_evtsys ((es1, t1, x1) # xs1)) es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rm_evtsys1 (es1, s1, y1) = (e1, s1, y1)&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">rm_evtsys1_def</span><span class=""> </span><span class="">getx_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;rm_evtsys ((es1, s1, y1) # (es1, t1, x1) # xs1) = 
          rm_evtsys1 (es1, s1, y1) # rm_evtsys ((es1, t1, x1) # xs1)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">rm_evtsys_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a6</span><span class=""> </span><span class="">a7</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">gets_e_def</span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">getx_e_def</span><span class=""> </span><span class="">getx_es_def</span><span class=""> 
</span><span class="">          </span><span class="">getspc_es_def</span><span class=""> </span><span class="">getspc_e_def</span><span class=""> </span><span class="">e_eqv_einevtseq_s</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">a5</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">snd_conv</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsEsComp</span><span class=""> </span><span class="">es1</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">et</span><span class=""> </span><span class="">es2</span><span class=""> </span><span class="">t1</span><span class=""> </span><span class="">y1</span><span class=""> </span><span class="">xs1</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(es1, s1, x1) -es-et&#8594; (es2, t1, y1)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(es2, t1, y1) # xs1 &#8712; cpts_es&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &#8804; length ((es2, t1, y1) # xs1) &#10230; getspc_es (((es2, t1, y1) # xs1) ! i) &#8800; es &#10233;
                      &#8707;e. getspc_es (((es2, t1, y1) # xs1) ! 0) = EvtSeq e es &#10233;
                      e_eqv_einevtseq ((es2, t1, y1) # xs1) (rm_evtsys ((es2, t1, y1) # xs1)) es&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &#8804; length ((es1, s1, x1) # (es2, t1, y1) # xs1) 
                      &#10230; getspc_es (((es1, s1, x1) # (es2, t1, y1) # xs1) ! i) &#8800; es&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;e. getspc_es (((es1, s1, x1) # (es2, t1, y1) # xs1) ! 0) = EvtSeq e es&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &#8804; length ((es2, t1, y1) # xs1) &#10230; getspc_es (((es2, t1, y1) # xs1) ! i) &#8800; es&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;es1 = EvtSeq e1 es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">nth_Cons_0</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (es2, t1, y1) &#8800; es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;es2 &#8800; es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;e2. es2 = EvtSeq e2 es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">evtseq_tran_evtsys</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">e2</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;es2 = EvtSeq e2 es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;e. getspc_es (((es2, t1, y1) # xs1) ! 0) = EvtSeq e es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">a5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a10</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;e_eqv_einevtseq ((es2, t1, y1) # xs1) (rm_evtsys ((es2, t1, y1) # xs1)) es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a11</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rm_evtsys ((es1, s1, x1) # (es2, t1, y1) # xs1) = rm_evtsys1 (es1, s1, x1) # rm_evtsys ((es2, t1, y1) # xs1)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">rm_evtsys_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a12</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rm_evtsys1 (es1, s1, x1) = (e1, s1, x1)&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">rm_evtsys1_def</span><span class=""> </span><span class="">getx_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a6</span><span class=""> </span><span class="">a11</span><span class=""> </span><span class="">a10</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">gets_e_def</span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">getx_e_def</span><span class=""> </span><span class="">getx_es_def</span><span class=""> 
</span><span class="">          </span><span class="">getspc_es_def</span><span class=""> </span><span class="">getspc_e_def</span><span class=""> </span><span class="">e_eqv_einevtseq_s</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">snd_conv</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?el &#8712; cpts_of_ev e s x &#8743; length esl = length ?el &#8743; e_eqv_einevtseq esl ?el es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">evtseq_fst_finish</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;&#10214;esl &#8712; cpts_es; getspc_es (esl ! 0) = EvtSeq e es; Suc m &#8804; length esl; 
     &#8707;i. i &#8804; m &#8743; getspc_es (esl ! i) = es&#10215; &#10233; 
      &#8707;i. (i &#8804; m &#8743; getspc_es (esl ! i) = es) &#8743; (&#8704;j. j &lt; i &#10230; getspc_es (esl ! j) &#8800; es)&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl &#8712; cpts_es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl ! 0) = EvtSeq e es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc m &#8804; length esl&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;i. i &#8804; m &#8743; getspc_es (esl ! i) = es&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;m. esl &#8712; cpts_es &#8743; getspc_es (esl ! 0) = EvtSeq e es &#8743; Suc m &#8804; length esl &#8743; 
              (&#8707;i. i &#8804; m &#8743; getspc_es (esl ! i) = es) &#10230;
          (&#8707;i. (i &#8804; m &#8743; getspc_es (esl ! i) = es) &#8743; (&#8704;j. j &lt; i &#10230; getspc_es (esl ! j) &#8800; es) )&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">m</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl &#8712; cpts_es&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl ! 0) = EvtSeq e es&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc m &#8804; length esl&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8707;i. i &#8804; m &#8743; getspc_es (esl ! i) = es)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;i. (i &#8804; m &#8743; getspc_es (esl ! i) = es) &#8743; (&#8704;j. j &lt; i &#10230; getspc_es (esl ! j) &#8800; es)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">m</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="string">&quot;0.prems&quot;</span><span class="delimiter">(</span><span class="">4</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Suc</span><span class=""> </span><span class="">n</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl &#8712; cpts_es &#10233;
                        getspc_es (esl ! 0) = EvtSeq e es &#10233;
                        Suc n &#8804; length esl &#10233;
                        &#8707;i&#8804;n. getspc_es (esl ! i) = es &#10233; 
                        &#8707;i. (i &#8804; n &#8743; getspc_es (esl ! i) = es) &#8743; (&#8704;j. j &lt; i &#10230; getspc_es (esl ! j) &#8800; es)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl &#8712; cpts_es&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl ! 0) = EvtSeq e es&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc (Suc n) &#8804; length esl&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;i&#8804;Suc n. getspc_es (esl ! i) = es&quot;</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;&#8707;i&#8804;n. getspc_es (esl ! i) = es&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;i&#8804;n. getspc_es (esl ! i) = es&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;i. (i &#8804; n &#8743; getspc_es (esl ! i) = es) &#8743; (&#8704;j. j &lt; i &#10230; getspc_es (esl ! j) &#8800; es)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Suc_leD</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">le_Suc_eq</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172; (&#8707;i&#8804;n. getspc_es (esl ! i) = es)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (esl ! (Suc n)) = es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">le_SucE</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;j. j &lt; Suc n &#10230; getspc_es (esl ! j) &#8800; es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">EventSeq_sound</span><span class=""> </span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;&#10214; &#8872; e sat<span class="hidden">&#8681;</span><sub>e</sub> [pre, rely1, guar1, post1]; &#8872; es sat<span class="hidden">&#8681;</span><sub>s</sub> [pre2, rely2, guar2, post]; 
      rely &#8838; rely1; rely &#8838; rely2; guar1 &#8838; guar; guar2 &#8838; guar; post1 &#8838; pre2&#10215; 
      &#10233; &#8872; EvtSeq e es sat<span class="hidden">&#8681;</span><sub>s</sub> [pre, rely, guar, post]&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8872; e sat<span class="hidden">&#8681;</span><sub>e</sub> [pre, rely1, guar1, post1]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8872; es sat<span class="hidden">&#8681;</span><sub>s</sub> [pre2, rely2, guar2, post]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rely &#8838; rely1&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rely &#8838; rely2&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;guar1 &#8838; guar&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;guar2 &#8838; guar&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;post1 &#8838; pre2&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;s x. (cpts_of_es (EvtSeq e es) s x) &#8745; assume_es(pre, rely) &#8838; commit_es(guar, post)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;esl. esl&#8712;(cpts_of_es (EvtSeq e es) s x) &#8745; assume_es (pre, rely) &#10230; esl&#8712; commit_es (guar, post)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">esl</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl &#8712; (cpts_of_es (EvtSeq e es) s x) &#8745; assume_es (pre, rely)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a01</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl &#8712; cpts_of_es (EvtSeq e es) s x&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a02</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl &#8712; assume_es (pre, rely)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a01</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a01_1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl ! 0 = (EvtSeq e es, s, x)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">cpts_of_es_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a01</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a01_2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl &#8712; cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">cpts_of_es_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;esl&#8712; commit_es (guar, post)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &#8804; length esl &#10230; getspc_es (esl ! i) &#8800; es&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &#8804; length esl &#10230; getspc_es (esl ! i) &#8800; es&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a01</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;el. (el &#8712; cpts_of_ev e s x &#8743; length esl = length el &#8743; e_eqv_einevtseq esl el es)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">evtseq_nfin_samelower</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">el</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; cpts_of_ev e s x &#8743; length esl = length el &#8743; e_eqv_einevtseq esl el es&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;el &#8712; assume_e (pre, rely1)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_e_def</span><span class="delimiter">,</span><span class=""> </span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a02</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;gets_es (esl ! 0) &#8712; pre&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_e (el ! 0) = s&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_ev_def</span><span class=""> </span><span class="">gets_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a01_1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_es (esl ! 0) = s&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_ev_def</span><span class=""> </span><span class="">gets_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;gets_e (el ! 0) &#8712; pre&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &lt; length el &#10230; el ! i -ee&#8594; el ! Suc i &#10230; 
                            (gets_e (el ! i), gets_e (el ! Suc i)) &#8712; rely1 &quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">                        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">                        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;Suc i &lt; length el&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el ! i -ee&#8594; el ! Suc i&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_e (el ! i) = getspc_e (el ! Suc i)&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">eetran_eqconf1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (esl ! i) = EvtSeq (getspc_e (el ! i)) es&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">e_eqv_einevtseq_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (esl ! Suc i) = EvtSeq (getspc_e (el ! Suc i)) es&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">e_eqv_einevtseq_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl ! i) = getspc_es (esl ! Suc i)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;esl ! i -ese&#8594; esl ! Suc i&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">eqconf_esetran</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a02</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_es (esl!i), gets_es (esl!Suc i)) &#8712; rely&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">assume_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_es (esl!i) = gets_e (el ! i)&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">e_eqv_einevtseq_def</span><span class=""> </span><span class="">less_imp_le_nat</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_es (esl!Suc i) = gets_e (el ! Suc i)&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Suc_le_eq</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">e_eqv_einevtseq_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_e (el ! i), gets_e (el ! Suc i)) &#8712; rely&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_e (el ! i), gets_e (el ! Suc i)) &#8712; rely1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;el &#8712; commit_e(guar1, post1)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">IntI</span><span class=""> </span><span class="">contra_subsetD</span><span class=""> </span><span class="">evt_validity_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length el &#10230; (&#8707;t. el!i -et-t&#8594; el!(Suc i)) 
                        &#10230; (gets_e (el!i), gets_e (el!Suc i)) &#8712; guar1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length el &#10230; (&#8707;t. el!i -et-t&#8594; el!(Suc i)) 
                        &#10230; (gets_e (el!i), gets_e (el!Suc i)) &#8712; guar&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &lt; length esl &#10230; (&#8707;t. esl ! i -es-t&#8594; esl ! Suc i) 
                              &#10230; (gets_es (esl ! i), gets_es (esl ! Suc i)) &#8712; guar&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">                        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">                        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length esl&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8707;t. esl ! i -es-t&#8594; esl ! Suc i)&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl ! i) = EvtSeq (getspc_e (el ! i)) es&quot;</span><span class=""> 
</span><span class="">                          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">e_eqv_einevtseq_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                        
</span><span class="">                        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl ! Suc i) = EvtSeq (getspc_e (el ! Suc i)) es&quot;</span><span class=""> 
</span><span class="">                          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">e_eqv_einevtseq_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (esl ! i) &#8800; getspc_es (esl ! Suc i)&quot;</span><span class=""> 
</span><span class="">                          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsys_not_eq_in_tran_aux</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">surjective_pairing</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_e (el ! i) &#8800; getspc_e (el ! Suc i)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;t. (el ! i) -et-t&#8594; (el ! Suc i)&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">cpts_of_ev_def</span><span class=""> </span><span class="">notran_confeqi</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_e (el!i), gets_e (el!Suc i)) &#8712; guar&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_e (el!i) = gets_es (esl ! i)&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">e_eqv_einevtseq_def</span><span class=""> </span><span class="">less_imp_le</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_e (el!Suc i) = gets_es (esl ! Suc i)&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Suc_leI</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">e_eqv_einevtseq_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_es (esl ! i), gets_es (esl ! Suc i)) &#8712; guar&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172; (&#8704;i. Suc i &#8804; length esl &#10230; getspc_es (esl ! i) &#8800; es)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a01_1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b00</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl ! 0) = EvtSeq e es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;m. Suc m &#8804; length esl &#8743; getspc_es (esl ! m) = es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">m</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc m &#8804; length esl &#8743; getspc_es (esl ! m) = es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;i. i &#8804; m &#8743; getspc_es (esl ! i) = es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a01_1</span><span class=""> </span><span class="">a01_2</span><span class=""> </span><span class="">b00</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;i. (i &#8804; m &#8743; getspc_es (esl ! i) = es) &#8743; (&#8704;j. j &lt; i &#10230; getspc_es (esl ! j) &#8800; es)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtseq_fst_finish</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">n</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(n &#8804; m &#8743; getspc_es (esl ! n) = es) &#8743; (&#8704;j. j &lt; n &#10230; getspc_es (esl ! j) &#8800; es)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b00</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b41</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;n &#8800; 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">hide_lams</span><span class="delimiter">)</span><span class=""> </span><span class="">add.commute</span><span class=""> </span><span class="">add.right_neutral</span><span class=""> 
</span><span class="">                                                </span><span class="">add_Suc</span><span class=""> </span><span class="">dual_order.irrefl</span><span class=""> </span><span class="">esys.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">le_add1</span><span class=""> </span><span class="">le_imp_less_Suc</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;n &gt; 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">esl0</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">b5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl0 = take n esl&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b5_1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length esl0 = n&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="">less_le_trans</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">esl1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">b6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl1 = drop n esl&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl0 @ esl1 = esl&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a01_2</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="">b5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl0 &#8712; cpts_es&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_diff_1</span><span class=""> </span><span class="">Suc_le_lessD</span><span class=""> </span><span class="">cpts_es_take</span><span class=""> </span><span class="">less_trans</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a01_2</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="">b5</span><span class=""> </span><span class="">b6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl1 &#8712; cpts_es&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_diff_1</span><span class=""> </span><span class="">Suc_le_lessD</span><span class=""> </span><span class="">cpts_es_dropi</span><span class=""> </span><span class="">le_neq_implies_less</span><span class=""> </span><span class="">less_trans</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b10</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl0 ! 0 = (EvtSeq e es, s, x)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">a01_1</span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="">b5</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b11</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl1 ! 0) = es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="">b6</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="">b5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b11_1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. i &lt; length esl0 &#10230; getspc_es (esl0 ! i) &#8800; es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b8</span><span class=""> </span><span class="">b10</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;esl0 &#8712; cpts_of_es (EvtSeq e es) s x&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b12</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;el. (el &#8712; cpts_of_ev e s x &#8743; length esl0 = length el &#8743; e_eqv_einevtseq esl0 el es)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">evtseq_nfin_samelower</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">el</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">b12_1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; cpts_of_ev e s x &#8743; length esl0 = length el &#8743; e_eqv_einevtseq esl0 el es&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b12_2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; cpts_ev&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_ev_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a02</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b13</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;gets_es (esl!0) &#8712; pre &#8743; (&#8704;i. Suc i&lt;length esl &#10230; 
                                    esl!i -ese&#8594; esl!(Suc i) &#10230; (gets_es (esl!i), gets_es (esl!Suc i)) &#8712; rely)&quot;</span><span class="">
</span><span class="">                       </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b14</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl0 &#8712; assume_es (pre, rely)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_es_def</span><span class="delimiter">,</span><span class=""> </span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;gets_es (esl0 ! 0) &#8712; pre&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a01_1</span><span class=""> </span><span class="">b10</span><span class=""> </span><span class="">b13</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b5</span><span class=""> </span><span class="">b13</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &lt; length esl0 &#10230; esl0 ! i -ese&#8594; esl0 ! Suc i 
                            &#10230; (gets_es (esl0 ! i), gets_es (esl0 ! Suc i)) &#8712; rely&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b15</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl0 &#8712; assume_es (pre, rely1)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">assume_es_def</span><span class=""> </span><span class="">subset_iff</span><span class="delimiter">)</span><span class="">
</span><span class="">                
</span><span class="">                
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b16</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; assume_e (pre, rely1)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_e_def</span><span class="delimiter">,</span><span class=""> </span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a02</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;gets_es (esl ! 0) &#8712; pre&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b12_1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_e (el ! 0) = s&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_ev_def</span><span class=""> </span><span class="">gets_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a01_1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_es (esl ! 0) = s&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_ev_def</span><span class=""> </span><span class="">gets_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;gets_e (el ! 0) &#8712; pre&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &lt; length el &#10230; el ! i -ee&#8594; el ! Suc i &#10230; 
                            (gets_e (el ! i), gets_e (el ! Suc i)) &#8712; rely1 &quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">                        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">                        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class="string">&quot;Suc i &lt; length el&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el ! i -ee&#8594; el ! Suc i&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_e (el ! i) = getspc_e (el ! Suc i)&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">eetran_eqconf1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b12_1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (esl0 ! i) = EvtSeq (getspc_e (el ! i)) es&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">e_eqv_einevtseq_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b12_1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (esl0 ! Suc i) = EvtSeq (getspc_e (el ! Suc i)) es&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">e_eqv_einevtseq_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl0 ! i) = getspc_es (esl0 ! Suc i)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl0 ! i -ese&#8594; esl0 ! Suc i&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">eqconf_esetran</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b14</span><span class=""> </span><span class="">b12_1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_es (esl0!i), gets_es (esl0!Suc i)) &#8712; rely&quot;</span><span class=""> 
</span><span class="">                          </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b14</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length esl0 &#10230; esl0!i -ese&#8594; esl0!(Suc i) 
                                      &#10230; (gets_es (esl0!i), gets_es (esl0!Suc i)) &#8712; rely&quot;</span><span class=""> 
</span><span class="">                               </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b12_1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_es (esl0!i) = gets_e (el ! i)&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">b12_1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">e_eqv_einevtseq_def</span><span class=""> </span><span class="">less_imp_le_nat</span><span class="delimiter">)</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_es (esl0!Suc i) = gets_e (el ! Suc i)&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b12_1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">b12_1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">e_eqv_einevtseq_def</span><span class=""> </span><span class="">Suc_leI</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_e (el ! i), gets_e (el ! Suc i)) &#8712; rely&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_e (el ! i), gets_e (el ! Suc i)) &#8712; rely1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b17</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; commit_e(guar1, post1)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b12_1</span><span class=""> </span><span class="">b16</span><span class=""> </span><span class="">evt_validity_def</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b18</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length el &#10230; (&#8707;t. el!i -et-t&#8594; el!(Suc i)) 
                        &#10230; (gets_e (el!i), gets_e (el!Suc i)) &#8712; guar1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b19</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length el &#10230; (&#8707;t. el!i -et-t&#8594; el!(Suc i)) 
                        &#10230; (gets_e (el!i), gets_e (el!Suc i)) &#8712; guar&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b11</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;sn xn. esl1 ! 0 = (es, sn, xn)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">surj_pair</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">sn</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">xn</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">b13</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl1 ! 0 = (es, sn, xn)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b9</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;esl1 &#8712; cpts_of_es es sn xn&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length esl &#10230; (&#8707;t. esl!i -es-t&#8594; esl!(Suc i)) 
                          &#10230; (gets_es (esl!i), gets_es (esl!Suc i)) &#8712; guar&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i&lt;length esl&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;t. esl!i -es-t&#8594; esl!(Suc i)&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_es (esl!i), gets_es (esl!Suc i)) &#8712; guar&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;Suc i &lt; n&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; n&quot;</span><span class="">
</span><span class="">                        
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b5</span><span class=""> </span><span class="">b5_1</span><span class=""> </span><span class="">b12_1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl0 ! i) = EvtSeq (getspc_e (el ! i)) es&quot;</span><span class=""> 
</span><span class="">                          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">e_eqv_einevtseq_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">less_imp_le_nat</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                        
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b5</span><span class=""> </span><span class="">b5_1</span><span class=""> </span><span class="">b12_1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl0 ! Suc i) = EvtSeq (getspc_e (el ! Suc i)) es&quot;</span><span class=""> 
</span><span class="">                          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">e_eqv_einevtseq_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Suc_le_eq</span><span class=""> </span><span class="">d0</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                        
</span><span class="">                        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl ! i) &#8800; getspc_es (esl ! Suc i)&quot;</span><span class=""> 
</span><span class="">                          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsys_not_eq_in_tran_aux</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">surjective_pairing</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_e (el ! i) &#8800; getspc_e (el ! Suc i)&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">b5</span><span class=""> </span><span class="">d0</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;t. (el ! i) -et-t&#8594; (el ! Suc i)&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b12_1</span><span class=""> </span><span class="">b5_1</span><span class=""> </span><span class="">cpts_of_ev_def</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">notran_confeqi</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b19</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_e (el!i), gets_e (el!Suc i)) &#8712; guar&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b12_1</span><span class=""> </span><span class="">b5_1</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_e (el!i) = gets_es (esl0 ! i)&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b12_1</span><span class=""> </span><span class="">b5_1</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">e_eqv_einevtseq_def</span><span class=""> </span><span class="">less_imp_le_nat</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_e (el!Suc i) = gets_es (esl0 ! Suc i)&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Suc_leI</span><span class=""> </span><span class="">b12_1</span><span class=""> </span><span class="">b5_1</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">e_eqv_einevtseq_def</span><span class=""> </span><span class="">less_imp_le_nat</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_es (esl0 ! i), gets_es (esl0 ! Suc i)) &#8712; guar&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">b5</span><span class=""> </span><span class="">d0</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                      </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172; (Suc i &lt; n)&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b5_1</span><span class=""> </span><span class="">b12_1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl0 ! (n-1)) = EvtSeq (getspc_e (el ! (n-1))) es&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">b12_1</span><span class=""> </span><span class="">e_eqv_einevtseq_def</span><span class=""> </span><span class="">b4</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1_1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl ! (n-1)) = EvtSeq (getspc_e (el ! (n-1))) es&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">b4</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;sn1 xn1. esl ! (n-1) = (EvtSeq (getspc_e (el ! (n-1))) es, sn1, xn1)&quot;</span><span class=""> 
</span><span class="">                          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">surj_pair</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">sn1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">xn1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl ! (n-1) = (EvtSeq (getspc_e (el ! (n-1))) es, sn1, xn1)&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="">b5</span><span class=""> </span><span class="">b5_1</span><span class=""> </span><span class="">b12_1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_e (el ! (n -1) ) = gets_es (esl0 ! (n -1)) &#8743;
                                       getx_e (el ! (n -1)) = getx_es (esl0 ! (n -1))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">e_eqv_einevtseq_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b5</span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el ! (n -1) = (getspc_e (el ! (n-1)), sn1, xn1)&quot;</span><span class=""> 
</span><span class="">                          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">gets_e_def</span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">getx_e_def</span><span class=""> </span><span class="">getx_es_def</span><span class=""> </span><span class="">getspc_e_def</span><span class=""> 
</span><span class="">                          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Suc_diff_1</span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="">lessI</span><span class=""> </span><span class="">nth_take</span><span class=""> </span><span class="">prod.collapse</span><span class=""> </span><span class="">snd_conv</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b13</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl ! n = (es, sn, xn)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b6</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a01_2</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;drop (n-1) esl &#8712; cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_es_dropi</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">hide_lams</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_diff_1</span><span class=""> </span><span class="">Suc_le_lessD</span><span class=""> </span><span class="">b5</span><span class=""> </span><span class="">b5_1</span><span class=""> 
</span><span class="">                              </span><span class="">drop_0</span><span class=""> </span><span class="">less_or_eq_imp_le</span><span class=""> </span><span class="">neq0_conv</span><span class=""> </span><span class="">not_le</span><span class=""> </span><span class="">take_all</span><span class=""> </span><span class="">zero_less_diff</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="">d4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;est. esl ! (n-1) -es-est&#8594; esl ! n&quot;</span><span class=""> 
</span><span class="">                          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_le_lessD</span><span class=""> </span><span class="">Suc_pred</span><span class=""> </span><span class="">a01_2</span><span class=""> 
</span><span class="">                            </span><span class="">b3</span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="">b6</span><span class=""> </span><span class="">b9</span><span class=""> </span><span class="">cpts_es_not_empty</span><span class=""> </span><span class="">d1_1</span><span class=""> </span><span class="">diff_less</span><span class=""> </span><span class="">esetran.cases</span><span class=""> 
</span><span class="">                            </span><span class="">incpts_es_impl_evnorcomptran</span><span class=""> </span><span class="">le_numeral_extra</span><span class="delimiter">(</span><span class="">4</span><span class="delimiter">)</span><span class=""> </span><span class="">length_drop</span><span class=""> 
</span><span class="">                            </span><span class="">length_greater_0_conv</span><span class=""> </span><span class="">zero_less_diff</span><span class="delimiter">)</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;t. (getspc_e (el ! (n-1)), sn1, xn1) -et-t&#8594;(AnonyEvent (None),sn, xn)&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtseq_tran_0_exist_etran</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">d4</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="">b5_1</span><span class=""> </span><span class="">b12_1</span><span class=""> </span><span class="">b12_2</span><span class=""> </span><span class="">d3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d8</span><span class="delimiter">:</span><span class="string">&quot;el @ [(AnonyEvent (None),sn, xn)] &#8712; cpts_ev&quot;</span><span class=""> 
</span><span class="">                          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_ev_onemore</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?el1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;el @ [(AnonyEvent (None),sn, xn)]&quot;</span><span class="">
</span><span class="">                        
</span><span class="">                        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d8</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el1 &#8712; cpts_of_ev e s x&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">append_Cons</span><span class=""> </span><span class="">b12_1</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="">b5_1</span><span class=""> 
</span><span class="">                              </span><span class="">cpts_of_ev_def</span><span class=""> </span><span class="">list.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> </span><span class="">neq_Nil_conv</span><span class=""> </span><span class="">nth_Cons_0</span><span class="delimiter">)</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b16</span><span class=""> </span><span class="">d7</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?el1 &#8712; assume_e (pre, rely1)&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_e (?el1!0) &#8712; pre&quot;</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b16</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_e (el!0) &#8712; pre&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">b12_1</span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="">b5_1</span><span class=""> </span><span class="">nth_append</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length ?el1 &#10230;  ?el1!i -ee&#8594; ?el1!(Suc i) &#10230; 
                                  (gets_e (?el1!i), gets_e (?el1!Suc i)) &#8712; rely1&quot;</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">                                </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">                                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i&lt;length ?el1&quot;</span><span class="">
</span><span class="">                                  </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">e1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el1!i -ee&#8594; ?el1!(Suc i)&quot;</span><span class="">
</span><span class="">                                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b16</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length el &#10230;  el!i -ee&#8594; el!(Suc i) &#10230; 
                                  (gets_e (el!i), gets_e (el!Suc i)) &#8712; rely1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_e (?el1!i), gets_e (?el1!Suc i)) &#8712; rely1&quot;</span><span class="">
</span><span class="">                                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;Suc i &lt; length ?el1 - 1&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">f0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length ?el1 - 1&quot;</span><span class="">
</span><span class="">                                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">e2</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_diff_1</span><span class=""> 
</span><span class="">                                        </span><span class="">Suc_less_eq</span><span class=""> </span><span class="">Suc_mono</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">length_append_singleton</span><span class=""> </span><span class="">nth_append</span><span class=""> </span><span class="">zero_less_Suc</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                                  </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;&#172; (Suc i &lt; length ?el1 - 1)&quot;</span><span class="">
</span><span class="">                                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &#8805; length ?el1 - 1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i = length ?el1 - 1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el1!(Suc i) = (AnonyEvent None, sn, xn)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el1!i = (getspc_e (el ! (n-1)), sn1, xn1)&quot;</span><span class="">
</span><span class="">                                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">b12_1</span><span class=""> </span><span class="">b5_1</span><span class=""> </span><span class="">d3</span><span class=""> </span><span class="">diff_Suc_1</span><span class=""> </span><span class="">length_append_singleton</span><span class=""> </span><span class="">lessI</span><span class=""> </span><span class="">nth_append</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                                    
</span><span class="">                                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d7</span><span class=""> </span><span class="">f2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_e (?el1!i) &#8800; getspc_e (?el1!(Suc i))&quot;</span><span class="">
</span><span class="">                                      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evt_not_eq_in_tran_aux</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">eetran.cases</span><span class="delimiter">)</span><span class="">
</span><span class="">                                    </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_e (?el1!i) = getspc_e (?el1!(Suc i))&quot;</span><span class=""> 
</span><span class="">                                      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">eetran_eqconf1</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                                    </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                              
</span><span class="">                            </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d10</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el1 &#8712; commit_e(guar1, post1)&quot;</span><span class=""> 
</span><span class="">                          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evt_validity_def</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">                          
</span><span class="">                        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d11</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_e (last ?el1) = AnonyEvent (None)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d10</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d12</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;gets_e (last ?el1) &#8712; post1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">commit_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                        
</span><span class="">                        </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;Suc i = n&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">g0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i = n&quot;</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d10</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(&#8704;i. Suc i&lt;length ?el1 &#10230; (&#8707;t. ?el1!i -et-t&#8594; ?el1!(Suc i)) 
                                &#10230; (gets_e (?el1!i), gets_e (?el1!Suc i)) &#8712; guar1)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">commit_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d7</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">g1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(gets_e (?el1!i), gets_e (?el1!Suc i)) &#8712; guar1&quot;</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">b12_1</span><span class=""> </span><span class="">b5_1</span><span class=""> </span><span class="">d3</span><span class=""> </span><span class="">diff_Suc_1</span><span class=""> 
</span><span class="">                                </span><span class="">g0</span><span class=""> </span><span class="">length_append_singleton</span><span class=""> </span><span class="">lessI</span><span class=""> </span><span class="">nth_append</span><span class=""> </span><span class="">nth_append_length</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                            </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?el1!(Suc i) = (AnonyEvent None, sn, xn)&quot;</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b12_1</span><span class=""> </span><span class="">b5_1</span><span class=""> </span><span class="">g0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                            </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">g0</span><span class=""> </span><span class="">b5_1</span><span class=""> </span><span class="">b12_1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?el1!i = (getspc_e (el ! (n-1)), sn1, xn1)&quot;</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">b12_1</span><span class=""> </span><span class="">b5_1</span><span class=""> </span><span class="">d3</span><span class=""> </span><span class="">diff_Suc_1</span><span class=""> </span><span class="">lessI</span><span class=""> </span><span class="">nth_append</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                            </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(sn1,sn) &#8712; guar1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">gets_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(sn1,sn) &#8712; guar&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d4</span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_es (esl ! (n - 1)), gets_es (esl ! Suc (n - 1))) &#8712; guar&quot;</span><span class=""> 
</span><span class="">                              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">b4</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">g0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;Suc i &#8800; n&quot;</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">g1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &gt; n&quot;</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">linorder_neqE_nat</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">                            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">g2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl1 ! 0 = (es, sn, xn)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">b13</span><span class="delimiter">)</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b9</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">g3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl1 &#8712; cpts_of_es es sn xn&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;esl1 &#8712; assume_es (pre2, rely2)&quot;</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_es_def</span><span class="delimiter">,</span><span class=""> </span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">                                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d12</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;sn &#8712; post1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">gets_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">g2</span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;gets_es (esl1 ! 0) &#8712; pre2&quot;</span><span class=""> 
</span><span class="">                                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">rev_subsetD</span><span class=""> </span><span class="">snd_conv</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                                </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &lt; length esl1 &#10230; esl1 ! i -ese&#8594; esl1 ! Suc i 
                                  &#10230; (gets_es (esl1 ! i), gets_es (esl1 ! Suc i)) &#8712; rely2&quot;</span><span class="">
</span><span class="">                                  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                                  </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">                                    </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">                                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">h0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length esl1&quot;</span><span class="">
</span><span class="">                                      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">h1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl1 ! i -ese&#8594; esl1 ! Suc i&quot;</span><span class="">
</span><span class="">                                    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">h2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl1 ! i = esl ! (n + i)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b5_1</span><span class=""> </span><span class="">b7</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                                    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">h3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl1 ! Suc i = esl ! (n + Suc i)&quot;</span><span class="">
</span><span class="">                                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">b5_1</span><span class=""> </span><span class="">b7</span><span class=""> </span><span class="">nth_append_length_plus</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">h1</span><span class=""> </span><span class="">h2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">h4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl ! (n + i) -ese&#8594; esl ! (n + Suc i)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                                    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;Suc (n + i) &lt; length esl&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b5_1</span><span class=""> </span><span class="">b7</span><span class=""> </span><span class="">h0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a02</span><span class=""> </span><span class="">h4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_es (esl ! (n + i)), gets_es (esl ! (n + Suc i))) &#8712; rely&quot;</span><span class="">
</span><span class="">                                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">h2</span><span class=""> </span><span class="">h3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_es (esl1 ! i), gets_es (esl1 ! Suc i)) &#8712; rely&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                                      
</span><span class="">                                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_es (esl1 ! i), gets_es (esl1 ! Suc i)) &#8712; rely2&quot;</span><span class="">
</span><span class="">                                      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                                  </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">                                  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">g3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">g4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl1 &#8712; commit_es (guar2,post)&quot;</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">Int_iff</span><span class=""> </span><span class="">es_validity_def</span><span class=""> </span><span class="">subsetCE</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                            
</span><span class="">                            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">g5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl ! i = esl1 ! (i - n)&quot;</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">b5_1</span><span class=""> </span><span class="">b7</span><span class=""> </span><span class="">g1</span><span class=""> </span><span class="">not_less_eq</span><span class=""> </span><span class="">nth_append</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">g6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl ! Suc i = esl1 ! (Suc i - n)&quot;</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">b5_1</span><span class=""> </span><span class="">b7</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">nth_append</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">g7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc (i - n) &lt; length esl1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b6</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">g1</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">g4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length esl1 &#10230; (&#8707;t. esl1!i -es-t&#8594; esl1!(Suc i)) 
                                &#10230; (gets_es (esl1!i), gets_es (esl1!Suc i)) &#8712; guar2&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">g7</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_es (esl1!(i - n)), gets_es (esl1!(Suc i - n))) &#8712; guar2&quot;</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Suc_diff_le</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">g1</span><span class=""> </span><span class="">g5</span><span class=""> </span><span class="">g6</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">g5</span><span class=""> </span><span class="">g6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_es (esl ! i), gets_es (esl ! Suc i)) &#8712; guar2&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">        
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">es_validity_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">primrec</span></span><span class=""> </span><span class="">parse_es_cpts_i2</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) esconfs &#8658;(&#39;l,&#39;k,&#39;s) event set &#8658; 
                             ((&#39;l,&#39;k,&#39;s) esconfs) list &#8658; ((&#39;l,&#39;k,&#39;s) esconfs) list&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;parse_es_cpts_i2 [] es rlst = rlst&quot;</span><span class=""> </span><span class="delimiter">|</span><span class="">
</span><span class="">        </span><span class="string">&quot;parse_es_cpts_i2 (x#xs) es rlst = 
            (if getspc_es x = EvtSys es &#8743; length xs &gt; 0 
                &#8743; (getspc_es (xs!0) &#8800; EvtSys es) then
               parse_es_cpts_i2 xs es (rlst@[[x]])
             else
               parse_es_cpts_i2 xs es (list_update rlst (length rlst - 1) (last rlst @ [x])) )&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">concat_list_lemma_take_n</span><span class=""> </span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;&#10214;esl = concat lst; i &#8804; length lst&#10215; &#10233; 
      &#8707;k. k &#8804; length esl &#8743; take k esl = concat (take i lst)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl = concat lst&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i &#8804; length lst&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">i</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">0</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;concat (take 0 lst) = take 0 esl&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Suc</span><span class=""> </span><span class="">ii</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl = concat lst &#10233; ii &#8804; length lst 
                    &#10233; &#8707;k&#8804;length esl. take k esl = concat (take ii lst)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl = concat lst&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc ii &#8804; length lst&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;k&#8804;length esl. take k esl = concat (take ii lst)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Suc_leD</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;k&#8804;length esl &#8743; take k esl = concat (take ii lst)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;concat (take (Suc ii) lst) = concat (take ii lst) @ lst!ii&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">take_Suc_conv_app_nth</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;concat (take (Suc ii) lst) = take (k + length (lst!ii)) esl&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Cons_nth_drop_Suc</span><span class=""> </span><span class="">Suc_le_lessD</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">append_eq_conv_conj</span><span class=""> 
</span><span class="">            </span><span class="">append_take_drop_id</span><span class=""> </span><span class="">concat.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">concat_append</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">take_add</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">nat_le_linear</span><span class=""> </span><span class="">take_all</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">concat_list_lemma_take_n2</span><span class=""> </span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;&#10214;esl = concat lst; i &#8804; length lst&#10215; &#10233; 
      &#8707;k. k &#8804; length esl &#8743; k = length (concat (take i lst)) &#8743; take k esl = concat (take i lst)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl = concat lst&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i &#8804; length lst&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">i</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">0</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;concat (take 0 lst) = take 0 esl&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Suc</span><span class=""> </span><span class="">ii</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl = concat lst &#10233; ii &#8804; length lst 
                    &#10233; &#8707;k&#8804;length esl. k = length (concat (take ii lst)) 
                        &#8743; take k esl = concat (take ii lst)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl = concat lst&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc ii &#8804; length lst&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;k&#8804;length esl. k = length (concat (take ii lst)) 
                      &#8743; take k esl = concat (take ii lst)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Suc_leD</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;k&#8804;length esl &#8743; k = length (concat (take ii lst)) 
                                &#8743; take k esl = concat (take ii lst)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;concat (take (Suc ii) lst) = concat (take ii lst) @ lst!ii&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">take_Suc_conv_app_nth</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;concat (take (Suc ii) lst) = take (k + length (lst!ii)) esl&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Cons_nth_drop_Suc</span><span class=""> </span><span class="">Suc_le_lessD</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">append_eq_conv_conj</span><span class=""> 
</span><span class="">            </span><span class="">append_take_drop_id</span><span class=""> </span><span class="">concat.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">concat_append</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">take_add</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">concat_list_lemma_take_n</span><span class=""> </span><span class="">length_take</span><span class=""> </span><span class="">min.absorb2</span><span class=""> </span><span class="">p0</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">concat_list_lemma</span><span class=""> </span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;&#8704;esl lst. esl = concat lst &#8743; (&#8704;i&lt;length lst. length (lst!i) &gt; 0)&#10230; 
        (&#8704;i. Suc i &lt; length esl 
          &#10230; (&#8707;k j. Suc k &lt; length lst &#8743; Suc j &lt; length (lst!k@[lst!(Suc k)!0]) 
                      &#8743; esl!i = (lst!k@[lst!(Suc k)!0])!j &#8743; esl!Suc i = (lst!k@[lst!(Suc k)!0])!Suc j
                  &#8744; Suc k = length lst &#8743; Suc j &lt; length (lst!k) &#8743; esl!i = lst!k!j &#8743; esl!Suc i = lst!k!Suc j))&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">lst</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;esl. esl = concat lst &#8743; (&#8704;i&lt;length lst. length (lst!i) &gt; 0)&#10230; 
        (&#8704;i. Suc i &lt; length esl 
          &#10230; (&#8707;k j. Suc k &lt; length lst &#8743; Suc j &lt; length (lst!k@[lst!(Suc k)!0]) 
                      &#8743; esl!i = (lst!k@[lst!(Suc k)!0])!j &#8743; esl!Suc i = (lst!k@[lst!(Suc k)!0])!Suc j
                  &#8744; Suc k = length lst &#8743; Suc j &lt; length (lst!k) &#8743; esl!i = lst!k!j &#8743; esl!Suc i = lst!k!Suc j))&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">lst</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">Nil</span><span class=""> </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Cons</span><span class=""> </span><span class="">l</span><span class=""> </span><span class="">lt</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;esl. esl = concat lt &#8743; (&#8704;i&lt;length lt. 0 &lt; length (lt ! i)) &#10230;
        (&#8704;i. Suc i &lt; length esl &#10230;
             (&#8707;k j. Suc k &lt; length lt &#8743;
                    Suc j &lt; length (lt ! k @ [lt ! Suc k ! 0]) &#8743;
                    esl ! i = (lt ! k @ [lt ! Suc k ! 0]) ! j &#8743; esl ! Suc i = (lt ! k @ [lt ! Suc k ! 0]) ! Suc j &#8744;
                    Suc k = length lt &#8743; Suc j &lt; length (lt ! k) &#8743; esl ! i = lt ! k ! j &#8743; esl ! Suc i = lt ! k ! Suc j))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">esl</span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl = concat (l # lt)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i&lt;length (l # lt). 0 &lt; length ((l # lt) ! i)&quot;</span><span class="">
</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length esl&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;k j. Suc k &lt; length (l # lt) &#8743;
                    Suc j &lt; length ((l # lt) ! k @ [(l # lt) ! Suc k ! 0]) &#8743;
                    esl ! i = ((l # lt) ! k @ [(l # lt) ! Suc k ! 0]) ! j &#8743;
                    esl ! Suc i = ((l # lt) ! k @ [(l # lt) ! Suc k ! 0]) ! Suc j &#8744;
                    Suc k = length (l # lt) &#8743;
                    Suc j &lt; length ((l # lt) ! k) &#8743; esl ! i = (l # lt) ! k ! j &#8743; esl ! Suc i = (l # lt) ! k ! Suc j&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;lt = []&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;lt = []&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;esl = l&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;Suc 0 = length (l # []) &#8743;
                    Suc i &lt; length ((l # []) ! 0) &#8743; esl ! i = (l # []) ! 0 ! i &#8743; esl ! Suc i = (l # []) ! 0 ! Suc i&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;lt &#8800; []&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;Suc i &lt; length (l@[(l # lt) ! Suc 0!0])&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length (l@[(l # lt) ! Suc 0!0])&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Cons_nth_drop_Suc</span><span class=""> </span><span class="">Suc_lessE</span><span class=""> </span><span class="">Suc_lessI</span><span class=""> </span><span class="">Suc_mono</span><span class=""> 
</span><span class="">                        </span><span class="">cancel_comm_monoid_add_class.diff_cancel</span><span class=""> </span><span class="">concat.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                        </span><span class="">d0</span><span class=""> </span><span class="">diff_Suc_1</span><span class=""> </span><span class="">drop_0</span><span class=""> </span><span class="">drop_Suc_Cons</span><span class=""> </span><span class="">length_Cons</span><span class=""> </span><span class="">length_append_singleton</span><span class=""> 
</span><span class="">                        </span><span class="">length_greater_0_conv</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">nth_append</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">e00</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(Suc i &lt; length (l@[(l # lt) ! Suc 0!0]))&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &#8805; length (l@[(l # lt) ! Suc 0!0])&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;esl1. esl = l@esl1 &#8743; esl1 = concat lt&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">esl1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl = l@esl1 &#8743; esl1 = concat lt&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &lt; length esl1 &#10230;
                       (&#8707;k j. Suc k &lt; length lt &#8743;
                              Suc j &lt; length (lt ! k @ [lt ! Suc k ! 0]) &#8743;
                              esl1 ! i = (lt ! k @ [lt ! Suc k ! 0]) ! j &#8743; esl1 ! Suc i = (lt ! k @ [lt ! Suc k ! 0]) ! Suc j &#8744;
                              Suc k = length lt &#8743; Suc j &lt; length (lt ! k) &#8743; esl1 ! i = lt ! k ! j &#8743; esl1 ! Suc i = lt ! k ! Suc j)&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">e00</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl!i = esl1!(i-length l)&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">length_append_singleton</span><span class=""> </span><span class="">nth_append</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">e00</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl!Suc i = esl1!(Suc i - length l)&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">length_append_singleton</span><span class=""> </span><span class="">less_Suc_eq</span><span class=""> </span><span class="">nth_append</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">e00</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc (i-length l) &lt; length esl1&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Suc_le_mono</span><span class=""> </span><span class="">add.commute</span><span class=""> </span><span class="">le_SucI</span><span class=""> </span><span class="">length_append</span><span class=""> 
</span><span class="">                      </span><span class="">length_append_singleton</span><span class=""> </span><span class="">less_diff_conv2</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">e2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;k j. Suc k &lt; length lt &#8743;
                              Suc j &lt; length (lt ! k @ [lt ! Suc k ! 0]) &#8743;
                              esl1 ! (i-length l) = (lt ! k @ [lt ! Suc k ! 0]) ! j &#8743; esl1 ! Suc (i-length l) = (lt ! k @ [lt ! Suc k ! 0]) ! Suc j &#8744;
                              Suc k = length lt &#8743; Suc j &lt; length (lt ! k) &#8743; esl1 ! (i-length l) = lt ! k ! j &#8743; esl1 ! Suc (i-length l) = lt ! k ! Suc j&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">j</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;Suc k &lt; length lt &#8743;
                              Suc j &lt; length (lt ! k @ [lt ! Suc k ! 0]) &#8743;
                              esl1 ! (i-length l) = (lt ! k @ [lt ! Suc k ! 0]) ! j &#8743; esl1 ! Suc (i-length l) = (lt ! k @ [lt ! Suc k ! 0]) ! Suc j &#8744;
                              Suc k = length lt &#8743; Suc j &lt; length (lt ! k) &#8743; esl1 ! (i-length l) = lt ! k ! j &#8743; esl1 ! Suc (i-length l) = lt ! k ! Suc j&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Suc_diff_le</span><span class=""> </span><span class="">Suc_le_mono</span><span class=""> </span><span class="">Suc_mono</span><span class=""> </span><span class="">e3</span><span class=""> </span><span class="">e4</span><span class=""> </span><span class="">length_Cons</span><span class=""> 
</span><span class="">                        </span><span class="">length_append_singleton</span><span class=""> </span><span class="">nat_neq_iff</span><span class=""> </span><span class="">nth_Cons_Suc</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">concat_list_lemma2</span><span class=""> </span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;&#8704;esl lst. esl = concat lst &#10230;
        (&#8704;i &lt; length lst. (take (length (lst!i)) (drop (length (concat (take i lst))) esl) = lst ! i))&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">lst</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;esl. esl = concat lst &#10230;
        (&#8704;i &lt; length lst. (take (length (lst!i)) (drop (length (concat (take i lst))) esl) = lst ! i))&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">lst</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">Nil</span><span class=""> </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Cons</span><span class=""> </span><span class="">l</span><span class=""> </span><span class="">lt</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot; &#8704;esl. esl = concat lt &#10230; 
                            (&#8704;i&lt;length lt. take (length (lt ! i)) (drop (length (concat (take i lt))) esl) = lt ! i)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">esl</span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl = concat (l # lt)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esl</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;concat lt&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl = l @ ?esl&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i&lt;length (l # lt)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;take (length ((l # lt) ! i)) (drop (length (concat (take i (l # lt)))) esl) = (l # lt) ! i&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;i = 0&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i = 0&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">d0</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i &#8800; 0&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;take (length (lt ! (i-1))) (drop (length (concat (take (i-1) lt))) ?esl) = lt ! (i-1)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?esl</span><span class=""> </span><span class="string">&quot;i-1&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">leI</span><span class=""> </span><span class="">less_Suc0</span><span class=""> </span><span class="">less_diff_conv2</span><span class=""> </span><span class="">list.size</span><span class="delimiter">(</span><span class="">4</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;lt ! (i - 1) = (l # lt) ! i&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">nth_Cons&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;drop (length (concat (take (i-1) lt))) ?esl 
                                = drop (length (concat (take i (l # lt)))) esl&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">append_eq_conv_conj</span><span class=""> </span><span class="">append_take_drop_id</span><span class=""> </span><span class="">concat_append</span><span class=""> </span><span class="">drop_Cons&#39;</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">        
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">concat_list_lemma3</span><span class=""> </span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;&#10214;esl = concat lst; i &lt; length lst; length (lst!i) &gt; 1&#10215; &#10233; 
      &#8707;k j. k = length (concat (take i lst)) &#8743; j = length (concat (take (Suc i) lst)) &#8743; 
            k &#8804; length esl &#8743; j &#8804; length esl &#8743; k &lt; j &#8743; drop k (take j esl) = lst ! i&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl = concat lst&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i &lt; length lst&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length (lst!i) &gt; 1&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;take (length (lst!i)) (drop (length (concat (take i lst))) esl) = lst ! i&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">concat_list_lemma2</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?k</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;length (concat (take i lst))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?j</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;length (concat (take (Suc i) lst))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a10</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;drop ?k (take ?j esl) = lst ! i&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;length (lst ! i) + length (concat (take i lst)) = length (concat (take (Suc i) lst))&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">take_Suc_conv_app_nth</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">full_types</span><span class="delimiter">)</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">take_drop</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?j - ?k = length (lst!i)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">take_Suc_conv_app_nth</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?j = ?k + length (lst!i)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">take_Suc_conv_app_nth</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?k &#8804; length esl&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">append_eq_conv_conj</span><span class=""> </span><span class="">append_take_drop_id</span><span class=""> </span><span class="">concat_append</span><span class=""> </span><span class="">nat_le_linear</span><span class=""> </span><span class="">take_all</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?j &#8804; length esl&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">append_eq_conv_conj</span><span class=""> </span><span class="">append_take_drop_id</span><span class=""> </span><span class="">concat_append</span><span class=""> </span><span class="">nat_le_linear</span><span class=""> </span><span class="">take_all</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?k &lt; ?j&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">diff_is_0_eq</span><span class=""> </span><span class="">leI</span><span class=""> </span><span class="">not_less0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">linarith</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?k &#8804; length esl &#8743; ?j &#8804; length esl &#8743; ?k &lt; ?j &#8743; drop ?k (take ?j esl) = lst ! i&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a10</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">concat_list_lemma_withnextfst</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;&#10214;esl = concat lst; Suc i &lt; length lst; length (lst!Suc i) &gt; 0&#10215; &#10233; 
      &#8707;k j. k &#8804; length esl &#8743; j &#8804; length esl &#8743; k &lt; j &#8743; drop k (take j esl) = lst!i @ [lst!Suc i!0]&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl = concat lst&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length lst&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length (lst!Suc i) &gt; 0&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;k. k &#8804; length esl &#8743; take k esl = concat (take (Suc (Suc i)) lst)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">concat_list_lemma_take_n</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">esl</span><span class=""> </span><span class="">lst</span><span class=""> </span><span class="string">&quot;Suc (Suc i)&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;k &#8804; length esl &#8743; take k esl = concat (take (Suc (Suc i)) lst)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;k. k &#8804; length esl &#8743; take k esl = concat (take (Suc i) lst)&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">concat_list_lemma_take_n</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">esl</span><span class=""> </span><span class="">lst</span><span class=""> </span><span class="string">&quot;Suc i&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">k2</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;k2 &#8804; length esl &#8743; take k2 esl = concat (take (Suc i) lst)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;concat (take (Suc i) lst) @ [lst!Suc i!0] = take (Suc k2) esl&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Cons_nth_drop_Suc</span><span class=""> </span><span class="">append_eq_conv_conj</span><span class=""> 
</span><span class="">        </span><span class="">append_take_drop_id</span><span class=""> </span><span class="">concat_list_lemma2</span><span class=""> </span><span class="">drop_eq_Nil</span><span class=""> </span><span class="">length_greater_0_conv</span><span class=""> 
</span><span class="">        </span><span class="">less_eq_Suc_le</span><span class=""> </span><span class="">not_less_eq_eq</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">nth_take</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">take_Suc_conv_app_nth</span><span class=""> </span><span class="">take_eq_Nil</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;concat (take i lst)@lst!i@[lst!Suc i!0] = take (Suc k2) esl&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">append_Nil2</span><span class=""> </span><span class="">append_eq_appendI</span><span class=""> 
</span><span class="">        </span><span class="">concat.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">concat.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">concat_append</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">take_Suc_conv_app_nth</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;k. k &#8804; length esl &#8743; take k esl = concat (take i lst)&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">concat_list_lemma_take_n</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">esl</span><span class=""> </span><span class="">lst</span><span class=""> </span><span class="">i</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">k1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;k1 &#8804; length esl &#8743; take k1 esl = concat (take i lst)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;drop k1 (take (Suc k2) esl) = lst!i@[lst!Suc i!0]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">append_eq_conv_conj</span><span class=""> </span><span class="">length_take</span><span class=""> </span><span class="">min.absorb2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="">a5</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Nil_is_append_conv</span><span class=""> </span><span class="">drop_eq_Nil</span><span class=""> </span><span class="">leI</span><span class=""> </span><span class="">length_take</span><span class=""> 
</span><span class="">        </span><span class="">min.absorb2</span><span class=""> </span><span class="">nat_le_linear</span><span class=""> </span><span class="">not_Cons_self2</span><span class=""> </span><span class="">take_all</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">concat_list_lemma_withnextfst2</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;&#10214;esl = concat lst; Suc i &lt; length lst; length (lst!Suc i) &gt; 0&#10215; &#10233; 
      &#8707;k j. k = length (concat (take i lst)) &#8743; j = Suc (length (concat (take (Suc i) lst))) &#8743;
      k &#8804; length esl &#8743; j &#8804; length esl &#8743; k &lt; j &#8743; drop k (take j esl) = lst!i @ [lst!Suc i!0]&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl = concat lst&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length lst&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length (lst!Suc i) &gt; 0&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;k. k &#8804; length esl &#8743; k = length (concat (take (Suc (Suc i)) lst)) 
      &#8743; take k esl = concat (take (Suc (Suc i)) lst)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">concat_list_lemma_take_n2</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">esl</span><span class=""> </span><span class="">lst</span><span class=""> </span><span class="string">&quot;Suc (Suc i)&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;k &#8804; length esl &#8743; k = length (concat (take (Suc (Suc i)) lst)) 
         &#8743; take k esl = concat (take (Suc (Suc i)) lst)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;k. k &#8804; length esl &#8743; k = length (concat (take (Suc i) lst)) 
      &#8743; take k esl = concat (take (Suc i) lst)&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">concat_list_lemma_take_n2</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">esl</span><span class=""> </span><span class="">lst</span><span class=""> </span><span class="string">&quot;Suc i&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">k2</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;k2 &#8804; length esl &#8743; k2 = length (concat (take (Suc i) lst)) 
      &#8743; take k2 esl = concat (take (Suc i) lst)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;concat (take (Suc i) lst) @ [lst!Suc i!0] = take (Suc k2) esl&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Cons_nth_drop_Suc</span><span class=""> </span><span class="">append_eq_conv_conj</span><span class=""> 
</span><span class="">        </span><span class="">append_take_drop_id</span><span class=""> </span><span class="">concat_list_lemma2</span><span class=""> </span><span class="">drop_eq_Nil</span><span class=""> </span><span class="">length_greater_0_conv</span><span class=""> 
</span><span class="">        </span><span class="">less_eq_Suc_le</span><span class=""> </span><span class="">not_less_eq_eq</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">nth_take</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">take_Suc_conv_app_nth</span><span class=""> </span><span class="">take_eq_Nil</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;concat (take i lst)@lst!i@[lst!Suc i!0] = take (Suc k2) esl&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">append_Nil2</span><span class=""> </span><span class="">append_eq_appendI</span><span class=""> 
</span><span class="">        </span><span class="">concat.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">concat.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">concat_append</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">take_Suc_conv_app_nth</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;k. k &#8804; length esl &#8743; k = length (concat (take i lst)) 
      &#8743; take k esl = concat (take i lst)&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">concat_list_lemma_take_n2</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">esl</span><span class=""> </span><span class="">lst</span><span class=""> </span><span class="">i</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">k1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;k1 &#8804; length esl &#8743; k1 = length (concat (take i lst)) 
      &#8743; take k1 esl = concat (take i lst)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;drop k1 (take (Suc k2) esl) = lst!i@[lst!Suc i!0]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">append_eq_conv_conj</span><span class=""> </span><span class="">length_take</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="">a5</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Nil_is_append_conv</span><span class=""> 
</span><span class="">        </span><span class="">drop_eq_Nil</span><span class=""> </span><span class="">leI</span><span class=""> </span><span class="">length_append_singleton</span><span class=""> </span><span class="">less_or_eq_imp_le</span><span class=""> </span><span class="">not_Cons_self2</span><span class=""> </span><span class="">take_all</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">concat_list_lemma_withnextfst3</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;&#10214;esl = concat lst; Suc i &lt; length lst; length (lst!Suc i) &gt; 1&#10215; &#10233; 
      &#8707;k j. k = length (concat (take i lst)) &#8743; j = Suc (length (concat (take (Suc i) lst))) &#8743;
      k &#8804; length esl &#8743; j &lt; length esl &#8743; k &lt; j &#8743; drop k (take j esl) = lst!i @ [lst!Suc i!0]&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl = concat lst&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length lst&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length (lst!Suc i) &gt; 1&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;k. k &#8804; length esl &#8743; k = length (concat (take (Suc (Suc i)) lst)) 
      &#8743; take k esl = concat (take (Suc (Suc i)) lst)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">concat_list_lemma_take_n2</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">esl</span><span class=""> </span><span class="">lst</span><span class=""> </span><span class="string">&quot;Suc (Suc i)&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;k &#8804; length esl &#8743; k = length (concat (take (Suc (Suc i)) lst)) 
         &#8743; take k esl = concat (take (Suc (Suc i)) lst)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;k. k &#8804; length esl &#8743; k = length (concat (take (Suc i) lst)) 
      &#8743; take k esl = concat (take (Suc i) lst)&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">concat_list_lemma_take_n2</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">esl</span><span class=""> </span><span class="">lst</span><span class=""> </span><span class="string">&quot;Suc i&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">k2</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;k2 &#8804; length esl &#8743; k2 = length (concat (take (Suc i) lst)) 
      &#8743; take k2 esl = concat (take (Suc i) lst)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;concat (take (Suc i) lst) @ [lst!Suc i!0] = take (Suc k2) esl&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">Suc_n_not_le_n</span><span class=""> </span><span class="">append_Nil2</span><span class=""> </span><span class="">append_take_drop_id</span><span class=""> 
</span><span class="">        </span><span class="">concat_list_lemma2</span><span class=""> </span><span class="">concat_list_lemma_withnextfst2</span><span class=""> </span><span class="">hd_conv_nth</span><span class=""> 
</span><span class="">        </span><span class="">le_neq_implies_less</span><span class=""> </span><span class="">nth_take</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">take_hd_drop</span><span class="delimiter">)</span><span class="">
</span><span class="">      
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;concat (take i lst)@lst!i@[lst!Suc i!0] = take (Suc k2) esl&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">append_Nil2</span><span class=""> </span><span class="">append_eq_appendI</span><span class=""> 
</span><span class="">        </span><span class="">concat.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">concat.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">concat_append</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">take_Suc_conv_app_nth</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;k. k &#8804; length esl &#8743; k = length (concat (take i lst)) 
      &#8743; take k esl = concat (take i lst)&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">concat_list_lemma_take_n2</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">esl</span><span class=""> </span><span class="">lst</span><span class=""> </span><span class="">i</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">k1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;k1 &#8804; length esl &#8743; k1 = length (concat (take i lst)) 
      &#8743; take k1 esl = concat (take i lst)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;drop k1 (take (Suc k2) esl) = lst!i@[lst!Suc i!0]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">append_eq_conv_conj</span><span class=""> </span><span class="">length_take</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="">a5</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">append_eq_conv_conj</span><span class=""> </span><span class="">concat_list_lemma2</span><span class=""> </span><span class="">concat_list_lemma_withnextfst2</span><span class=""> 
</span><span class="">        </span><span class="">leI</span><span class=""> </span><span class="">length_Cons</span><span class=""> </span><span class="">less_trans</span><span class=""> </span><span class="">list.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">nat_neq_iff</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">take_all</span><span class=""> </span><span class="">zero_less_one</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">parse_es_cpts_i2_concat</span><span class="delimiter">:</span><span class=""> 
</span><span class="">      </span><span class="string">&quot;&#8704;esl rlst es. esl&#8712;cpts_es &#8743; (rlst::((&#39;l,&#39;k,&#39;s) esconfs) list) &#8800; [] 
                      &#10230; concat (parse_es_cpts_i2 esl es rlst) = concat rlst @ esl&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">esl</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;rlst es. esl&#8712;cpts_es &#8743; (rlst::((&#39;l,&#39;k,&#39;s) esconfs) list) &#8800; [] &#10230; concat (parse_es_cpts_i2 esl es rlst) = concat rlst @ esl&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">esl</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">Nil</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Cons</span><span class=""> </span><span class="">esc</span><span class=""> </span><span class="">esl1</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;rlst es. esl1 &#8712; cpts_es &#8743; rlst &#8800; [] &#10230; concat (parse_es_cpts_i2 esl1 es rlst) = concat rlst @ esl1&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">rlst</span><span class=""> </span><span class="">es</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esc # esl1 &#8712; cpts_es &#8743; (rlst::((&#39;l,&#39;k,&#39;s) esconfs) list) &#8800; []&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;concat (parse_es_cpts_i2 (esc # esl1) es rlst) = concat rlst @ (esc # esl1)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;getspc_es esc = EvtSys es &#8743; length esl1 &gt; 0 &#8743; getspc_es (esl1!0) &#8800; EvtSys es&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es esc = EvtSys es &#8743; length esl1 &gt; 0 &#8743; getspc_es (esl1!0) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;parse_es_cpts_i2 (esc # esl1) es rlst = parse_es_cpts_i2 esl1 es (rlst@[[esc]])&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rlst@[[esc]] &#8800; []&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;esl1 &#8712; cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_es_dropi</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;concat (parse_es_cpts_i2 esl1 es (rlst@[[esc]])) =  concat (rlst@[[esc]]) @ esl1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;concat rlst @ (esc # esl1) = concat (rlst@[[esc]]) @ esl1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">presburger</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(getspc_es esc = EvtSys es &#8743; length esl1 &gt; 0 &#8743; getspc_es (esl1!0) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;parse_es_cpts_i2 (esc # esl1) es rlst = 
                                parse_es_cpts_i2 esl1 es (list_update rlst (length rlst - 1) (last rlst @ [esc]))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;esl1 = []&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl1 = []&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;parse_es_cpts_i2 (esc # []) es rlst = 
                                parse_es_cpts_i2 [] es (list_update rlst (length rlst - 1) (last rlst @ [esc]))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;parse_es_cpts_i2 [] es (list_update rlst (length rlst - 1) (last rlst @ [esc])) = 
                            list_update rlst (length rlst - 1) (last rlst @ [esc])&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;concat (list_update rlst (length rlst - 1) (last rlst @ [esc])) = concat rlst @ esc # []&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">append_assoc</span><span class=""> </span><span class="">append_butlast_last_id</span><span class=""> 
</span><span class="">                            </span><span class="">append_self_conv</span><span class=""> </span><span class="">concat.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">concat_append</span><span class=""> </span><span class="">length_butlast</span><span class=""> </span><span class="">list_update_length</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(esl1 = [])&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;length esl1 &gt; 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl1 &#8712; cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_es_dropi</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;list_update rlst (length rlst - 1) (last rlst @ [esc]) &#8800; []&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;concat (parse_es_cpts_i2 esl1 es (list_update rlst (length rlst - 1) (last rlst @ [esc]))) =
                                    concat (list_update rlst (length rlst - 1) (last rlst @ [esc])) @ esl1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;concat rlst @ (esc # esl1) = concat (list_update rlst (length rlst - 1) (last rlst @ [esc])) @ esl1&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Cons_eq_appendI</span><span class=""> </span><span class="">append_assoc</span><span class=""> </span><span class="">append_butlast_last_id</span><span class=""> 
</span><span class="">                            </span><span class="">concat.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">concat_append</span><span class=""> </span><span class="">length_butlast</span><span class=""> </span><span class="">list_update_length</span><span class=""> </span><span class="">self_append_conv2</span><span class="delimiter">)</span><span class="">
</span><span class="">                    
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">parse_es_cpts_i2_concat1</span><span class="delimiter">:</span><span class=""> 
</span><span class="">      </span><span class="string">&quot;esl&#8712;cpts_es &#10233; concat (parse_es_cpts_i2 esl es [[]]) = esl&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">parse_es_cpts_i2_concat</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">parse_es_cpts_i2_lst0</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="string">&quot;&#8704;esl l1 l2 es. esl&#8712;cpts_es &#8743; (l2::((&#39;l,&#39;k,&#39;s) esconfs) list) &#8800; [] 
                    &#10230; parse_es_cpts_i2 esl es (l1@l2) = l1@(parse_es_cpts_i2 esl es l2)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">esl</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;l1 l2 es. esl&#8712;cpts_es &#8743; (l2::((&#39;l,&#39;k,&#39;s) esconfs) list) &#8800; [] 
                      &#10230; parse_es_cpts_i2 esl es (l1@l2) = l1@(parse_es_cpts_i2 esl es l2)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">esl</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">Nil</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Cons</span><span class=""> </span><span class="">esc</span><span class=""> </span><span class="">esl1</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;l1 l2 es. esl1 &#8712; cpts_es &#8743; (l2::((&#39;l,&#39;k,&#39;s) esconfs) list) &#8800; [] 
                                &#10230; parse_es_cpts_i2 esl1 es (l1 @l2) = l1 @ parse_es_cpts_i2 esl1 es l2&quot;</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">l1</span><span class=""> </span><span class="">l2</span><span class=""> </span><span class="">es</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esc # esl1 &#8712; cpts_es&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(l2::((&#39;l,&#39;k,&#39;s) esconfs) list) &#8800; []&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;parse_es_cpts_i2 (esc # esl1) es (l1 @ l2) = l1 @ parse_es_cpts_i2 (esc # esl1) es l2&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;esl1 = []&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl1 = []&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;parse_es_cpts_i2 (esc # []) es (l1 @ l2) =
                            parse_es_cpts_i2 [] es (list_update (l1 @ l2) (length (l1 @ l2) - 1) (last (l1 @ l2) @ [esc]))&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;parse_es_cpts_i2 (esc # []) es (l1 @ l2) = 
                            list_update (l1 @ l2) (length (l1 @ l2) - 1) (last (l1 @ l2) @ [esc])&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;parse_es_cpts_i2 (esc # []) es (l1 @ l2) = 
                                l1 @ (list_update l2 (length l2 - 1) (last l2 @ [esc]))&quot;</span><span class="">
</span><span class="">                   </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">append1_eq_conv</span><span class=""> </span><span class="">append_assoc</span><span class=""> </span><span class="">append_butlast_last_id</span><span class=""> 
</span><span class="">                      </span><span class="">append_is_Nil_conv</span><span class=""> </span><span class="">length_butlast</span><span class=""> </span><span class="">list_update_length</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;l1 @ parse_es_cpts_i2 (esc # []) es l2 = 
                        l1 @ parse_es_cpts_i2 [] es (list_update l2 (length l2 - 1) (last l2 @ [esc]))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;l1 @ parse_es_cpts_i2 (esc # []) es l2 = 
                            l1 @ (list_update l2 (length l2 - 1) (last l2 @ [esc]))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(esl1 = [])&quot;</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl1 &#8712; cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_es_dropi</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;getspc_es esc = EvtSys es &#8743; length esl1 &gt; 0 &#8743; getspc_es (esl1!0) &#8800; EvtSys es&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es esc = EvtSys es &#8743; length esl1 &gt; 0 &#8743; getspc_es (esl1!0) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class="string">&quot;parse_es_cpts_i2 (esc # esl1) es (l1 @ l2) =
                                    parse_es_cpts_i2 esl1 es (l1 @ l2@[[esc]])&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;parse_es_cpts_i2 esl1 es (l1 @ l2@[[esc]]) =
                                    l1 @ parse_es_cpts_i2 esl1 es (l2@[[esc]])&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;l1 @ parse_es_cpts_i2 (esc # esl1) es l2 =
                                    l1 @ parse_es_cpts_i2 esl1 es (l2@[[esc]])&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(getspc_es esc = EvtSys es &#8743; length esl1 &gt; 0 &#8743; getspc_es (esl1!0) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;parse_es_cpts_i2 (esc # esl1) es (l1 @ l2) =
                                    parse_es_cpts_i2 esl1 es (list_update (l1 @ l2) (length (l1 @ l2) - 1) 
                                                                (last (l1 @ l2) @ [esc]))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;parse_es_cpts_i2 (esc # esl1) es (l1 @ l2) =
                                    parse_es_cpts_i2 esl1 es (l1 @ list_update l2 (length l2 - 1) (last l2 @ [esc]) )&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">append1_eq_conv</span><span class=""> </span><span class="">append_assoc</span><span class=""> </span><span class="">append_butlast_last_id</span><span class=""> 
</span><span class="">                              </span><span class="">append_is_Nil_conv</span><span class=""> </span><span class="">length_butlast</span><span class=""> </span><span class="">list_update_length</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;parse_es_cpts_i2 (esc # esl1) es (l1 @ l2) =
                                    l1 @ parse_es_cpts_i2 esl1 es (list_update l2 (length l2 - 1) (last l2 @ [esc]) )&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;l1 @ parse_es_cpts_i2 (esc # esl1) es l2 = 
                                  l1 @ parse_es_cpts_i2 esl1 es (list_update l2 (length l2 - 1) (last l2 @ [esc]))&quot;</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d3</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">parse_es_cpts_i2_lst</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="string">&quot;&#8704;esl l1 l2 es. esl&#8712;cpts_es &#8743; (l2::((&#39;l,&#39;k,&#39;s) esconfs) list) &#8800; [] 
                    &#10230; parse_es_cpts_i2 esl es ([l1]@l2) = [l1]@(parse_es_cpts_i2 esl es l2)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">parse_es_cpts_i2_lst0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">parse_es_cpts_i2_fst</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;esl elst rlst es l. esl&#8712;cpts_es &#8743; rlst = [l] &#8743; elst = parse_es_cpts_i2 esl es rlst 
                                                  &#10230; (&#8707;i&#8804;length (elst!0). take i (elst!0) = l)&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">esl</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;elst rlst es l. esl&#8712;cpts_es &#8743; rlst = [l] &#8743; elst = parse_es_cpts_i2 esl es rlst 
                            &#10230; (&#8707;i&#8804;length (elst!0). take i (elst!0) = l)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">esl</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">Nil</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Cons</span><span class=""> </span><span class="">esc</span><span class=""> </span><span class="">esl1</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;elst rlst es l. esl1 &#8712; cpts_es &#8743; rlst = [l] &#8743; elst = parse_es_cpts_i2 esl1 es rlst 
                                    &#10230; (&#8707;i&#8804;length (elst ! 0). take i (elst ! 0) = l)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">elst</span><span class=""> </span><span class="">rlst</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="">l</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esc # esl1 &#8712; cpts_es&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rlst = [l]&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;elst = parse_es_cpts_i2 (esc # esl1) es rlst&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;i&#8804;length (elst ! 0). take i (elst ! 0) = l&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;esl1 = []&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl1 = []&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;elst = parse_es_cpts_i2 [] es (list_update rlst (length rlst - 1) (last rlst @ [esc]))&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;elst = list_update rlst (length rlst - 1) (last rlst @ [esc])&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;elst = [l@[esc]]&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">butlast_conv_take</span><span class=""> </span><span class="">butlast_snoc</span><span class=""> </span><span class="">linear</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">take_all</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(esl1 = [])&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl1 &#8712; cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_es_dropi</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">esl2</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">ec1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl1 = ec1 # esl2&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">neq_Nil_conv</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;getspc_es esc = EvtSys es &#8743; length esl1 &gt; 0 &#8743; getspc_es (esl1!0) &#8800; EvtSys es&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es esc = EvtSys es &#8743; length esl1 &gt; 0 &#8743; getspc_es (esl1!0) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d01</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es ec1 &#8800; EvtSys es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;parse_es_cpts_i2 (esc # esl1) es rlst = parse_es_cpts_i2 esl1 es (rlst@[[esc]])&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;elst = parse_es_cpts_i2 esl1 es ([l]@[[esc]])&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;parse_es_cpts_i2 esl1 es ([l]@[[esc]]) = [l]@parse_es_cpts_i2 esl1 es ([[esc]])&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">parse_es_cpts_i2_lst</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;elst = [l] @ parse_es_cpts_i2 esl1 es ([[esc]])&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(getspc_es esc = EvtSys es &#8743; length esl1 &gt; 0 &#8743; getspc_es (esl1!0) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;parse_es_cpts_i2 (esc # esl1) es rlst = 
                                parse_es_cpts_i2 esl1 es (list_update rlst (length rlst - 1) (last rlst @ [esc]))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;elst = parse_es_cpts_i2 esl1 es (list_update rlst (length rlst - 1) (last rlst @ [esc]))&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;elst = parse_es_cpts_i2 esl1 es ([l @ [esc]])&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;i&#8804;length (elst ! 0). take i (elst ! 0) = l @ [esc]&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">i</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;i&#8804;length (elst ! 0) &#8743; take i (elst ! 0) = l @ [esc]&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">butlast_snoc</span><span class=""> </span><span class="">butlast_take</span><span class=""> </span><span class="">diff_le_self</span><span class=""> </span><span class="">dual_order.trans</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">parse_es_cpts_i2_start_withlen</span><span class=""> </span><span class="delimiter">[</span><span class="">simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="string">&quot;&#8704;esl elst rlst es l. esl&#8712;cpts_es &#8743; rlst &#8800; [] &#8743; elst = parse_es_cpts_i2 esl es rlst &#10230;
                        (&#8704;i. i &#8805; length rlst &#8743; i &lt; length elst &#10230; 
                            length (elst!i) &#8805; 2 &#8743; getspc_es (elst!i!0) = EvtSys es &#8743; getspc_es (elst!i!1) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">esl</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;elst rlst es l. esl&#8712;cpts_es &#8743; rlst &#8800; [] &#8743; elst = parse_es_cpts_i2 esl es rlst &#10230;
                        (&#8704;i. i &#8805; length rlst &#8743; i &lt; length elst &#10230; 
                            length (elst!i) &#8805; 2 &#8743; getspc_es (elst!i!0) = EvtSys es &#8743; getspc_es (elst!i!1) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">esl</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">Nil</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Cons</span><span class=""> </span><span class="">esc</span><span class=""> </span><span class="">esl1</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;elst rlst es l. esl1 &#8712; cpts_es &#8743; rlst &#8800; [] &#8743; elst = parse_es_cpts_i2 esl1 es rlst &#10230;
                                    (&#8704;i. i &#8805; length rlst &#8743; i &lt; length elst &#10230; 
                                         length (elst!i) &#8805; 2 &#8743; getspc_es (elst ! i ! 0) = EvtSys es 
                                          &#8743; getspc_es (elst ! i ! 1) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">elst</span><span class=""> </span><span class="">rlst</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="">l</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esc # esl1 &#8712; cpts_es&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rlst &#8800; []&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;elst = parse_es_cpts_i2 (esc # esl1) es rlst&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. i &#8805; length rlst &#8743; i &lt; length elst &#10230; length (elst!i) &#8805; 2 &#8743; getspc_es (elst ! i ! 0) = EvtSys es 
                                                &#8743; getspc_es (elst ! i ! 1) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;esl1 = []&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl1 = []&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;parse_es_cpts_i2 (esc # []) es rlst = 
                            parse_es_cpts_i2 [] es (list_update rlst (length rlst - 1) (last rlst @ [esc]))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;parse_es_cpts_i2 [] es (list_update rlst (length rlst - 1) (last rlst @ [esc]))
                      = list_update rlst (length rlst - 1) (last rlst @ [esc])&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;elst = list_update rlst (length rlst - 1) (last rlst @ [esc])&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(esl1 = [])&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl1 &#8712; cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_es_dropi</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">esl2</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">ec1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl1 = ec1 # esl2&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">neq_Nil_conv</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;getspc_es esc = EvtSys es &#8743; length esl1 &gt; 0 &#8743; getspc_es (esl1!0) &#8800; EvtSys es&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es esc = EvtSys es &#8743; length esl1 &gt; 0 &#8743; getspc_es (esl1!0) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d01</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es ec1 &#8800; EvtSys es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;parse_es_cpts_i2 (esc # esl1) es rlst = parse_es_cpts_i2 esl1 es (rlst@[[esc]])&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;elst = parse_es_cpts_i2 esl1 es (rlst@[[esc]])&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;parse_es_cpts_i2 esl1 es (rlst@[[esc]]) = rlst@parse_es_cpts_i2 esl1 es ([[esc]])&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">parse_es_cpts_i2_lst0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;elst = rlst @ parse_es_cpts_i2 esl1 es ([[esc]])&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;esl2 = []&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl2 = []&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;elst = rlst @ parse_es_cpts_i2 [] es 
                                        (list_update [[esc]] (length [[esc]] - 1) (last [[esc]] @ [ec1]))&quot;</span><span class="">
</span><span class="">                           </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;elst = rlst @ (list_update [[esc]] (length [[esc]] - 1) (last [[esc]] @ [ec1]))&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;elst = rlst @ ([[esc] @ [ec1]])&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">d01</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">leD</span><span class=""> </span><span class="">le_eq_less_or_eq</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(esl2 = [])&quot;</span><span class="">
</span><span class="">                        
</span><span class="">                        </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?elst2</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;parse_es_cpts_i2 esl1 es ([[esc]])&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. i &#8805; 1 &#8743; i &lt; length ?elst2 &#10230; 
                                             length (?elst2!i) &#8805; 2 &#8743; getspc_es (?elst2 ! i ! 0) = EvtSys es 
                                             &#8743; getspc_es (?elst2 ! i ! 1) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">                           </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">length_Cons</span><span class=""> </span><span class="">list.distinct</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">list.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                           
</span><span class="">                        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="">d01</span><span class=""> </span><span class="">d3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;elst = rlst @ parse_es_cpts_i2 esl2 es 
                                                      (list_update [[esc]] (length [[esc]] - 1) (last [[esc]] @ [ec1]))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;elst = rlst @ parse_es_cpts_i2 esl2 es [[esc]@[ec1]]&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?elst2 = parse_es_cpts_i2 esl2 es [[esc]@[ec1]]&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;esl2&#8712;cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_es_dropi</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">e3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;i&#8804;length (?elst2!0). take i (?elst2!0) = [esc]@[ec1]&quot;</span><span class=""> 
</span><span class="">                          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">parse_es_cpts_i2_fst</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">d01</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">e2</span><span class=""> </span><span class="">e3</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">                            </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">                            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">f0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length rlst &#8804; i &#8743; i &lt; length elst&quot;</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;length (elst ! i) &#8805; 2 &#8743; getspc_es (elst ! i ! 0) = EvtSys es 
                                    &#8743; getspc_es (elst ! i ! 1) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;length rlst = i&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">g0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length rlst = i&quot;</span><span class="">
</span><span class="">                                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;elst ! i = ?elst2!0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">e2</span><span class=""> </span><span class="">e3</span><span class=""> </span><span class="">nth_append</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">e4</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_1</span><span class=""> </span><span class="">butlast_snoc</span><span class=""> 
</span><span class="">                                      </span><span class="">butlast_take</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">diff_Suc_1</span><span class=""> </span><span class="">length_Cons</span><span class=""> </span><span class="">length_append_singleton</span><span class=""> 
</span><span class="">                                      </span><span class="">length_take</span><span class=""> </span><span class="">lessI</span><span class=""> </span><span class="">list.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">min.absorb2</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> 
</span><span class="">                                      </span><span class="">nth_append_length</span><span class=""> </span><span class="">nth_take</span><span class="delimiter">)</span><span class="">  
</span><span class="">                              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">g0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172; (length rlst = i)&quot;</span><span class="">
</span><span class="">                                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">f0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;length rlst &lt; i &#8743; i &lt; length elst&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Nil_is_append_conv</span><span class=""> </span><span class="">Suc_leI</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">b1</span><span class=""> 
</span><span class="">                                    </span><span class="">c1</span><span class=""> </span><span class="">d4</span><span class=""> </span><span class="">e2</span><span class=""> </span><span class="">e3</span><span class=""> </span><span class="">length_append_singleton</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(getspc_es esc = EvtSys es &#8743; length esl1 &gt; 0 &#8743; getspc_es (esl1!0) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;parse_es_cpts_i2 (esc # esl1) es rlst = 
                                parse_es_cpts_i2 esl1 es (list_update rlst (length rlst - 1) (last rlst @ [esc]))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;elst = parse_es_cpts_i2 esl1 es (list_update rlst (length rlst - 1) (last rlst @ [esc]))&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">length_list_update</span><span class=""> </span><span class="">list_update_nonempty</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">parse_es_cpts_i2_start_withlen0</span><span class=""> </span><span class="delimiter">[</span><span class="">simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="string">&quot;&#10214;esl&#8712;cpts_es; rlst &#8800; []; elst = parse_es_cpts_i2 esl es rlst&#10215; &#10233;
          &#8704;i. i &#8805; length rlst &#8743; i &lt; length elst &#10230; length (elst!i) &#8805; 2 
            &#8743; getspc_es (elst!i!0) = EvtSys es &#8743; getspc_es (elst!i!1) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">parse_es_cpts_i2_start_withlen</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">parse_es_cpts_i2_fstempty</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs; esl&#8712;cpts_es;
        rlst = parse_es_cpts_i2 esl es [[]]&#10215; &#10233; rlst!0 =[]&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;cpts_es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rlst = parse_es_cpts_i2 esl es [[]]&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;rlst = parse_es_cpts_i2 ((EvtSeq e (EvtSys es), s1,x1) # xs) es ([[]]@[[(EvtSys es, s, x)]])&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(EvtSeq e (EvtSys es), s1,x1) # xs &#8712; cpts_es&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_es_dropi</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;rlst = [[]]@ parse_es_cpts_i2 ((EvtSeq e (EvtSys es), s1,x1) # xs) es ([[(EvtSys es, s, x)]])&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">parse_es_cpts_i2_lst0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">parse_es_cpts_i2_concat3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs; esl&#8712;cpts_es;
        rlst = parse_es_cpts_i2 esl es [[]]&#10215; &#10233; concat (tl rlst) = esl&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">parse_es_cpts_i2_concat1</span><span class=""> </span><span class="">parse_es_cpts_i2_fstempty</span><span class=""> 
</span><span class="">   </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">append_Nil</span><span class=""> </span><span class="">concat.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">concat.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">hd_Cons_tl</span><span class=""> </span><span class="">list.distinct</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">nth_Cons_0</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">parse_es_cpts_i2_noent_mid0</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="string">&quot;&#8704;esl elst l es. esl&#8712;cpts_es &#8743; elst = parse_es_cpts_i2 esl es [l] &#10230;
                        &#172;(length l &gt; 1 &#8743; getspc_es (last l) = EvtSys es &#8743; getspc_es (esl!0) &#8800; EvtSys es) &#10230;
                        &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length l &#8743; 
                             getspc_es (l!j) = EvtSys es &#8743; getspc_es (l!Suc j) &#8800; EvtSys es) &#10230;
                        (&#8704;i. i &lt; length elst &#10230; &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length (elst!i) &#8743; 
                             getspc_es (elst!i!j) = EvtSys es &#8743; getspc_es (elst!i!Suc j) &#8800; EvtSys es))&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">esl</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;elst l es. esl&#8712;cpts_es &#8743; elst = parse_es_cpts_i2 esl es [l] &#10230;
                        &#172;(length l &gt; 1 &#8743; getspc_es (last l) = EvtSys es &#8743; getspc_es (esl!0) &#8800; EvtSys es) &#10230;
                        &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length l &#8743; 
                             getspc_es (l!j) = EvtSys es &#8743; getspc_es (l!Suc j) &#8800; EvtSys es) &#10230;
                        (&#8704;i. i &lt; length elst &#10230; &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length (elst!i) &#8743; 
                             getspc_es (elst!i!j) = EvtSys es &#8743; getspc_es (elst!i!Suc j) &#8800; EvtSys es))&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">esl</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">Nil</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Cons</span><span class=""> </span><span class="">esc</span><span class=""> </span><span class="">esl1</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;elst l es. esl1&#8712;cpts_es &#8743; elst = parse_es_cpts_i2 esl1 es [l] &#10230;
                        &#172;(length l &gt; 1 &#8743; getspc_es (last l) = EvtSys es &#8743; getspc_es (esl1!0) &#8800; EvtSys es) &#10230;
                        &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length l &#8743; 
                             getspc_es (l!j) = EvtSys es &#8743; getspc_es (l!Suc j) &#8800; EvtSys es) &#10230;
                        (&#8704;i. i &lt; length elst &#10230; &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length (elst!i) &#8743; 
                             getspc_es (elst!i!j) = EvtSys es &#8743; getspc_es (elst!i!Suc j) &#8800; EvtSys es))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">elst</span><span class=""> </span><span class="">l</span><span class=""> </span><span class="">es</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esc # esl1 &#8712; cpts_es&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;elst = parse_es_cpts_i2 (esc # esl1) es [l]&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172; (length l &gt; 1 &#8743; getspc_es (last l) = EvtSys es &#8743; getspc_es ((esc # esl1) ! 0) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172; (&#8707;j&gt;0. Suc j &lt; length l &#8743; getspc_es (l ! j) = EvtSys es &#8743; getspc_es (l ! Suc j) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(&#8704;i. i &lt; length elst &#10230; &#172; (&#8707;j&gt;0. Suc j &lt; length (elst ! i) &#8743;
                    getspc_es (elst ! i ! j) = EvtSys es &#8743; getspc_es (elst ! i ! Suc j) &#8800; EvtSys es))&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;esl1 = []&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl1 = []&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;parse_es_cpts_i2 (esc # []) es [l] = 
                            parse_es_cpts_i2 [] es (list_update [l] (length [l] - 1) (last [l] @ [esc]))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;parse_es_cpts_i2 [] es (list_update [l] (length [l] - 1) (last [l] @ [esc]))
                      = list_update [l] (length [l] - 1) (last [l] @ [esc])&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;elst = list_update [l] (length [l] - 1) (last [l] @ [esc])&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;elst = [l @ [esc]]&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Suc_eq_plus1_left</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">Suc_lessI</span><span class=""> </span><span class="">diff_Suc_1</span><span class=""> 
</span><span class="">                  </span><span class="">dual_order.strict_trans</span><span class=""> </span><span class="">last_conv_nth</span><span class=""> </span><span class="">length_Cons</span><span class=""> </span><span class="">length_append_singleton</span><span class=""> 
</span><span class="">                  </span><span class="">less_antisym</span><span class=""> </span><span class="">less_one</span><span class=""> </span><span class="">list.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">nat_neq_iff</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">nth_append</span><span class=""> </span><span class="">nth_append_length</span><span class="delimiter">)</span><span class="">
</span><span class="">                  
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(esl1 = [])&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl1 &#8712; cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_es_dropi</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">esl2</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">ec1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl1 = ec1 # esl2&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">neq_Nil_conv</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;getspc_es esc = EvtSys es &#8743; length esl1 &gt; 0 &#8743; getspc_es (esl1!0) &#8800; EvtSys es&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es esc = EvtSys es &#8743; length esl1 &gt; 0 &#8743; getspc_es (esl1!0) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d01</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es ec1 &#8800; EvtSys es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;parse_es_cpts_i2 (esc # esl1) es [l] = parse_es_cpts_i2 esl1 es ([l]@[[esc]])&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;elst = parse_es_cpts_i2 esl1 es ([l]@[[esc]])&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;parse_es_cpts_i2 esl1 es ([l]@[[esc]]) = [l]@parse_es_cpts_i2 esl1 es ([[esc]])&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">parse_es_cpts_i2_lst0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;elst = [l] @ parse_es_cpts_i2 esl1 es ([[esc]])&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?elst1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;parse_es_cpts_i2 esl1 es ([[esc]])&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172;(length [esc] &gt; 1 &#8743; getspc_es (last [esc]) = EvtSys es &#8743; getspc_es (esl1!0) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length [esc] &#8743; 
                             getspc_es ([esc]!j) = EvtSys es &#8743; getspc_es ([esc]!Suc j) &#8800; EvtSys es)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">                    
</span><span class="">                    </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. i &lt; length ?elst1 &#10230; &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length (?elst1!i) &#8743; 
                             getspc_es (?elst1!i!j) = EvtSys es &#8743; getspc_es (?elst1!i!Suc j) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">                       </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="">d3</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Nil_is_append_conv</span><span class=""> </span><span class="">Nitpick.size_list_simp</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                        </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_diff_Suc</span><span class=""> </span><span class="">Suc_less_eq</span><span class=""> </span><span class="">append_Cons</span><span class=""> </span><span class="">append_Nil</span><span class=""> 
</span><span class="">                        </span><span class="">diff_Suc_1</span><span class=""> </span><span class="">diff_Suc_Suc</span><span class=""> </span><span class="">list.sel</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">not_gr0</span><span class=""> </span><span class="">nth_Cons&#39;</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(getspc_es esc = EvtSys es &#8743; length esl1 &gt; 0 &#8743; getspc_es (esl1!0) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;parse_es_cpts_i2 (esc # esl1) es [l] = 
                                parse_es_cpts_i2 esl1 es (list_update [l] (length [l] - 1) (last [l] @ [esc])) &quot;</span><span class="">
</span><span class="">                                </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;elst = parse_es_cpts_i2 esl1 es ([l@[esc]])&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;length esl1 = 0&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length esl1 = 0&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl1 = []&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;elst = [l@[esc]]&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">linarith</span><span class=""> 
</span><span class="">                      </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(length esl1 = 0)&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;length esl1 &gt; 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(getspc_es esc = EvtSys es &#8743; getspc_es (esl1!0) &#8800; EvtSys es)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172; (1 &lt; length (l@[esc]) &#8743; getspc_es (last (l@[esc])) = EvtSys es 
                                    &#8743; getspc_es (esl1 ! 0) &#8800; EvtSys es)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172; (&#8707;j&gt;0. Suc j &lt; length (l@[esc]) &#8743; getspc_es ((l@[esc]) ! j) = EvtSys es &#8743; 
                                getspc_es ((l@[esc]) ! Suc j) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">hide_lams</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_neq_Zero</span><span class=""> </span><span class="">diff_Suc_1</span><span class=""> </span><span class="">last_conv_nth</span><span class=""> 
</span><span class="">                            </span><span class="">length_append_singleton</span><span class=""> </span><span class="">less_antisym</span><span class=""> </span><span class="">list.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">not_gr0</span><span class=""> </span><span class="">not_less_eq</span><span class=""> 
</span><span class="">                            </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">nth_append</span><span class=""> </span><span class="">zero_less_diff</span><span class="delimiter">)</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">parse_es_cpts_i2_noent_mid</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="string">&quot;&#10214;esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs; esl&#8712;cpts_es; 
      elst = parse_es_cpts_i2 esl es [[]]&#10215; &#10233;  &#8704;i. i &lt; length (tl elst) &#10230; 
                             &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length ((tl elst)!i) &#8743; 
                             getspc_es ((tl elst)!i!j) = EvtSys es &#8743; getspc_es ((tl elst)!i!Suc j) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;cpts_es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;elst = parse_es_cpts_i2 esl es [[]]&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172;(length [] &gt; 1 &#8743; getspc_es (last []) = EvtSys es &#8743; getspc_es (esl!0) &#8800; EvtSys es)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length [] &#8743; 
                      getspc_es ([]!j) = EvtSys es &#8743; getspc_es ([]!Suc j) &#8800; EvtSys es)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. i &lt; length elst &#10230; &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length (elst!i) &#8743; 
                             getspc_es (elst!i!j) = EvtSys es &#8743; getspc_es (elst!i!Suc j) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">parse_es_cpts_i2_noent_mid0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">List.nth_tl</span><span class=""> </span><span class="">Nitpick.size_list_simp</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_mono</span><span class=""> </span><span class="">list.sel</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">parse_es_cpts_i2_start_aux</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs; esl&#8712;cpts_es;
        elst = parse_es_cpts_i2 esl es [[]]&#10215; &#10233; 
        &#8704;i. i &lt; length (tl elst) &#10230; length ((tl elst)!i) &#8805; 2  &#8743; 
            getspc_es ((tl elst)!i!0) = EvtSys es &#8743; getspc_es ((tl elst)!i!1) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;cpts_es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;elst = parse_es_cpts_i2 esl es [[]]&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. i &#8805; length [[]] &#8743; i &lt; length elst &#10230; length (elst!i) &#8805; 2  &#8743; 
            getspc_es (elst!i!0) = EvtSys es &#8743; getspc_es (elst!i!1) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">length_Cons</span><span class=""> </span><span class="">list.distinct</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">list.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">parse_es_cpts_i2_start_withlen0</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i &lt; length (tl elst)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;length (tl elst ! i) &#8805; 2&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">List.nth_tl</span><span class=""> </span><span class="">Nil_tl</span><span class=""> </span><span class="">Nitpick.size_list_simp</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">One_nat_def</span><span class=""> 
</span><span class="">              </span><span class="">Suc_eq_plus1_left</span><span class=""> </span><span class="">Suc_less_eq</span><span class=""> </span><span class="">le_add1</span><span class=""> </span><span class="">length_Cons</span><span class=""> </span><span class="">less_nat_zero_code</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (elst!Suc i!0) = EvtSys es &#8743; getspc_es (elst!Suc i!1) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(tl elst)!i = elst!Suc i&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">List.nth_tl</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;length (tl elst ! i) &#8805; 2 &#8743; getspc_es ((tl elst)!i!0) = EvtSys es 
          &#8743; getspc_es ((tl elst)!i!1) &#8800; EvtSys es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">    
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">parse_es_cpts_i2_noent_mid_i</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="string">&quot;&#10214;esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs; esl&#8712;cpts_es; 
      elst = tl (parse_es_cpts_i2 esl es [[]]); Suc i &lt; length elst; esl1 = elst!i@[elst!Suc i!0]&#10215; &#10233;  
        &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl1 &#8743; 
              getspc_es (esl1!j) = EvtSys es &#8743; getspc_es (esl1!Suc j) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;cpts_es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;elst = tl (parse_es_cpts_i2 esl es [[]])&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length elst&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl1 = elst!i@[elst!Suc i!0]&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esl2</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;elst!i&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length ?esl2 &#8743; 
              getspc_es (?esl2!j) = EvtSys es &#8743; getspc_es (?esl2!Suc j) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">parse_es_cpts_i2_noent_mid</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">esl</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">xs</span><span class=""> </span><span class="">elst</span><span class="delimiter">]</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">parse_es_cpts_i2_noent_mid</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (elst!Suc i!0) = EvtSys es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">parse_es_cpts_i2_start_aux</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">esl</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">xs</span><span class=""> 
</span><span class="">          </span><span class="string">&quot;parse_es_cpts_i2 esl es [[]]&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">nth_append</span><span class=""> </span><span class="">p4</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">parse_es_cpts_i2_drop_cptes</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;&#10214;esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs; esl&#8712;cpts_es;
        elst = tl (parse_es_cpts_i2 esl es [[]])&#10215; &#10233; 
        &#8704;i. i &lt; length elst &#10230; concat (drop i elst)&#8712;cpts_es&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;cpts_es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;elst = tl (parse_es_cpts_i2 esl es [[]])&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;concat elst = esl&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">parse_es_cpts_i2_concat3</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i &lt; length elst&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;concat (drop i elst)&#8712;cpts_es&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">i</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">0</span><span class=""> </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Suc</span><span class=""> </span><span class="">j</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j &lt; length elst &#10233; concat (drop j elst) &#8712; cpts_es&quot;</span><span class="">
</span><span class="">            </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc j &lt; length elst&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;concat (drop (Suc j) elst) = drop (length (elst!j)) (concat (drop j elst))&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Cons_nth_drop_Suc</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">append_eq_conv_conj</span><span class=""> </span><span class="">concat.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;concat (drop j elst) &#8712; cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_es_dropi2</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;concat (drop j elst)&quot;</span><span class=""> </span><span class="string">&quot;length (elst ! j)&quot;</span><span class="delimiter">]</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">List.nth_tl</span><span class=""> </span><span class="">Suc_leI</span><span class=""> </span><span class="">Suc_lessE</span><span class=""> </span><span class="">concat_last_lm</span><span class=""> </span><span class="">diff_Suc_1</span><span class=""> </span><span class="">drop.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="">last_conv_nth</span><span class=""> </span><span class="">last_drop</span><span class=""> </span><span class="">le_less_trans</span><span class=""> </span><span class="">length_0_conv</span><span class=""> </span><span class="">length_Cons</span><span class=""> </span><span class="">length_drop</span><span class=""> 
</span><span class="">              </span><span class="">length_greater_0_conv</span><span class=""> </span><span class="">length_tl</span><span class=""> </span><span class="">lessI</span><span class=""> </span><span class="">numeral_2_eq_2</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">parse_es_cpts_i2_start_withlen0</span><span class=""> 
</span><span class="">              </span><span class="">zero_less_diff</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">parse_es_cpts_i2_in_cptes_i</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;&#10214;esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs; esl&#8712;cpts_es;
        elst = tl (parse_es_cpts_i2 esl es [[]])&#10215; &#10233; 
        &#8704;i. Suc i &lt; length elst &#10230; (elst!i)@[elst!Suc i!0] &#8712;cpts_es&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;cpts_es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;elst = tl (parse_es_cpts_i2 esl es [[]])&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;concat elst = esl&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">parse_es_cpts_i2_concat3</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. i &lt; length elst &#10230; length (elst!i) &#8805; 2&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">parse_es_cpts_i2_start_aux</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">esl</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">xs</span><span class=""> </span><span class="string">&quot;parse_es_cpts_i2 esl es [[]]&quot;</span><span class="delimiter">]</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length elst&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(elst!i)@[elst!Suc i!0] &#8712;cpts_es&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;i = 0&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i = 0&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length (elst!1) &#8805; 2&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;esl = (elst!0) @ concat (drop 1 elst)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Cons_nth_drop_Suc</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">concat.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">drop_0</span><span class="delimiter">)</span><span class="">  
</span><span class="">          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;esl = (elst!0) @ ((elst!1) @ concat (drop 2 elst))&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Cons_nth_drop_Suc</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">concat.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;take ((length (elst ! 0)) + 1) esl = (elst ! 0) @ [elst!Suc 0!0]&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Cons_nth_drop_Suc</span><span class=""> </span><span class="">Nil_is_append_conv</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_1</span><span class=""> </span><span class="">Suc_le_lessD</span><span class=""> 
</span><span class="">                </span><span class="">append.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">append.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">append_eq_conv_conj</span><span class=""> </span><span class="">drop_0</span><span class=""> </span><span class="">length_greater_0_conv</span><span class=""> 
</span><span class="">                </span><span class="">list.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">not_less0</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">take_0</span><span class=""> </span><span class="">take_Suc_conv_app_nth</span><span class=""> </span><span class="">take_add</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_es_take</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">esl</span><span class=""> </span><span class="string">&quot;length (elst ! 0)&quot;</span><span class="delimiter">]</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">add.right_neutral</span><span class=""> </span><span class="">add_Suc_right</span><span class=""> </span><span class="">le_less_linear</span><span class=""> </span><span class="">take_all</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;i&#8800;0&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i &gt; 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?elst</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;drop (i - 1) elst&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esl</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;concat ?elst&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b01</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length ?elst &gt; 2&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length (?elst!1) &#8805; 2&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl&#8712;cpts_es&quot;</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">parse_es_cpts_i2_drop_cptes</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">esl</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">xs</span><span class=""> </span><span class="">elst</span><span class="delimiter">]</span><span class="">
</span><span class="">              </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">Suc_pred</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">presburger</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl = (?elst!0) @ concat (drop 1 ?elst)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Cons_nth_drop_Suc</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">Suc_pred</span><span class=""> </span><span class="">b0</span><span class=""> 
</span><span class="">                </span><span class="">concat.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">drop_0</span><span class=""> </span><span class="">length_drop</span><span class=""> </span><span class="">zero_less_diff</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?esl = (?elst!0) @ ((?elst!1) @ concat (drop 2 ?elst))&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Cons_nth_drop_Suc</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_1</span><span class=""> 
</span><span class="">                </span><span class="">Suc_leI</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">concat.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">diff_diff_cancel</span><span class=""> </span><span class="">diff_le_self</span><span class=""> 
</span><span class="">                </span><span class="">diff_less_mono</span><span class=""> </span><span class="">length_drop</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b01</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;take ((length (?elst ! 0)) + 1) ?esl = (?elst ! 0) @ [?elst!1!0]&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Cons_nth_drop_Suc</span><span class=""> </span><span class="">Nil_is_append_conv</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">append.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="">append_eq_conv_conj</span><span class=""> </span><span class="">drop_0</span><span class=""> </span><span class="">length_greater_0_conv</span><span class=""> </span><span class="">list.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">not_numeral_le_zero</span><span class=""> 
</span><span class="">                </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">take_0</span><span class=""> </span><span class="">take_Suc_conv_app_nth</span><span class=""> </span><span class="">take_add</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_es_take</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?esl</span><span class=""> </span><span class="string">&quot;length (?elst ! 0)&quot;</span><span class="delimiter">]</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Nil_is_append_conv</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">concat_i_lm</span><span class=""> </span><span class="">cpts_es_seg2</span><span class=""> </span><span class="">list.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">not_Cons_self2</span><span class=""> 
</span><span class="">              </span><span class="">not_numeral_le_zero</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">parse_es_cpts_i2_start_aux</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">parse_es_cpts_i2_in_cptes_last</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;&#10214;esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs; esl&#8712;cpts_es;
        elst = tl (parse_es_cpts_i2 esl es [[]])&#10215; &#10233; 
        last elst &#8712;cpts_es&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;cpts_es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;elst = tl (parse_es_cpts_i2 esl es [[]])&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. i &lt; length elst &#10230; concat (drop i elst)&#8712;cpts_es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">parse_es_cpts_i2_drop_cptes</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">esl</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">xs</span><span class=""> </span><span class="">elst</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">append_butlast_last_id</span><span class=""> </span><span class="">append_eq_conv_conj</span><span class=""> 
</span><span class="">          </span><span class="">concat.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">concat.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">diff_less</span><span class=""> </span><span class="">length_butlast</span><span class=""> </span><span class="">length_greater_0_conv</span><span class=""> 
</span><span class="">          </span><span class="">less_one</span><span class=""> </span><span class="">list.simps</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">parse_es_cpts_i2_concat3</span><span class=""> </span><span class="">self_append_conv</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">evtsys_fst_ent</span><span class="delimiter">:</span><span class=""> 
</span><span class="">      </span><span class="string">&quot;&#10214;esl &#8712; cpts_es; getspc_es (esl ! 0) = EvtSys es; Suc m &#8804; length esl; &#8707;i. i &#8804; m &#8743; getspc_es (esl ! i) &#8800; EvtSys es&#10215; 
        &#10233; &#8707;i. (i &lt; m &#8743; getspc_es (esl ! i) = EvtSys es &#8743; getspc_es (esl ! Suc i) &#8800; EvtSys es) 
                &#8743; (&#8704;j. j &lt; i &#10230; getspc_es (esl ! j) = EvtSys es)&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl &#8712; cpts_es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl ! 0) = EvtSys es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc m &#8804; length esl&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;i. i &#8804; m &#8743; getspc_es (esl ! i) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;m. esl &#8712; cpts_es &#8743; getspc_es (esl ! 0) = EvtSys es &#8743; Suc m &#8804; length esl 
                   &#8743; (&#8707;i. i &#8804; m &#8743; getspc_es (esl ! i) &#8800; EvtSys es)  
             &#10230; (&#8707;i. (i &lt; m &#8743; getspc_es (esl ! i) = EvtSys es &#8743; getspc_es (esl ! Suc i) &#8800; EvtSys es) 
                &#8743; (&#8704;j. j &lt; i &#10230; getspc_es (esl ! j) = EvtSys es))&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">m</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl &#8712; cpts_es&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl ! 0) = EvtSys es&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc m &#8804; length esl&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;i. i &#8804; m &#8743; getspc_es (esl ! i) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;i. (i &lt; m &#8743; getspc_es (esl ! i) = EvtSys es 
                        &#8743; getspc_es (esl ! Suc i) &#8800; EvtSys es) 
                        &#8743; (&#8704;j. j &lt; i &#10230; getspc_es (esl ! j) = EvtSys es)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">m</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="string">&quot;0.prems&quot;</span><span class="delimiter">(</span><span class="">4</span><span class="delimiter">)</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Suc</span><span class=""> </span><span class="">n</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl &#8712; cpts_es &#10233;
                        getspc_es (esl ! 0) = EvtSys es &#10233;
                        Suc n &#8804; length esl &#10233;
                        &#8707;i&#8804;n. getspc_es (esl ! i) &#8800; EvtSys es &#10233;
                        &#8707;i. (i &lt; n &#8743; getspc_es (esl ! i) = EvtSys es 
                            &#8743; getspc_es (esl ! Suc i) &#8800; EvtSys es) 
                            &#8743; (&#8704;j&lt;i. getspc_es (esl ! j) = EvtSys es)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl &#8712; cpts_es&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl ! 0) = EvtSys es&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc (Suc n) &#8804; length esl&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;i&#8804;Suc n. getspc_es (esl ! i) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;&#8707;i&#8804;n. getspc_es (esl ! i) &#8800; EvtSys es&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;i&#8804;n. getspc_es (esl ! i) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;i. (i &lt; n &#8743; getspc_es (esl ! i) = EvtSys es 
                            &#8743; getspc_es (esl ! Suc i) &#8800; EvtSys es) 
                            &#8743; (&#8704;j&lt;i. getspc_es (esl ! j) = EvtSys es)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">less_Suc_eq</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(&#8707;i&#8804;n. getspc_es (esl ! i) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (esl ! Suc n) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">le_SucE</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;j&lt;n. getspc_es (esl ! j) = EvtSys es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (esl ! n) = EvtSys es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">rm_evtsys_in_cptse0</span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;&#10214;esl&#8712;cpts_es; length esl &gt; 0; &#8707;e. getspc_es (esl!0) = EvtSeq e (EvtSys es);
      &#172;(&#8707;j. Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es) &#10215;
       &#10233; rm_evtsys esl &#8712; cpts_ev&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;cpts_es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length esl &gt; 0&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;e. getspc_es (esl!0) = EvtSeq e (EvtSys es)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(&#8707;j. Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;esl e es .esl&#8712;cpts_es &#8743; length esl &gt; 0 &#8743; (&#8707;e. getspc_es (esl!0) = EvtSeq e (EvtSys es)) &#8743;
      &#172;(&#8707;j. Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es) 
       &#10230; rm_evtsys esl &#8712; cpts_ev&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">esl</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">es</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;cpts_es&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length esl &gt; 0&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;e. getspc_es (esl!0) = EvtSeq e (EvtSys es)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(&#8707;j. Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;rm_evtsys esl &#8712; cpts_ev&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">esl</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsEsOne</span><span class=""> </span><span class="">es1</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">es1</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">EvtSeq</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">es1</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;rm_evtsys [(EvtSeq x1 es1, s, x)] = [(x1, s, x)]&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">rm_evtsys_def</span><span class=""> </span><span class="">rm_evtsys1_def</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">getx_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">cpts_ev.CptsEvOne</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">EvtSys</span><span class=""> </span><span class="">xa</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;rm_evtsys [(EvtSys xa, s, x)] = [(AnonyEvent None, s, x)]&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">rm_evtsys_def</span><span class=""> </span><span class="">rm_evtsys1_def</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">getx_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">cpts_ev.CptsEvOne</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsEsEnv</span><span class=""> </span><span class="">es1</span><span class=""> </span><span class="">t</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">xs</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">y</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(es1, t, x) # xs &#8712; cpts_es&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;0 &lt; length ((es1, t, x) # xs) &#10233;
                          &#8707;e. getspc_es (((es1, t, x) # xs) ! 0) = EvtSeq e (EvtSys es) &#10233;
                          &#172; (&#8707;j. Suc j &lt; length ((es1, t, x) # xs) &#8743;
                          getspc_es (((es1, t, x) # xs) ! j) = EvtSys es &#8743; 
                          getspc_es (((es1, t, x) # xs) ! Suc j) &#8800; EvtSys es) &#10233;
                            rm_evtsys ((es1, t, x) # xs) &#8712; cpts_ev&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;0 &lt; length ((es1, s, y) # (es1, t, x) # xs)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;e. getspc_es (((es1, s, y) # (es1, t, x) # xs) ! 0) = EvtSeq e (EvtSys es)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172; (&#8707;j. Suc j &lt; length ((es1, s, y) # (es1, t, x) # xs) &#8743;
                                getspc_es (((es1, s, y) # (es1, t, x) # xs) ! j) = EvtSys es &#8743;
                                getspc_es (((es1, s, y) # (es1, t, x) # xs) ! Suc j) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172; (&#8707;j. Suc j &lt; length ((es1, t, x) # xs) &#8743;
                                getspc_es (((es1, t, x) # xs) ! j) = EvtSys es &#8743; 
                                getspc_es (((es1, t, x) # xs) ! Suc j) &#8800; EvtSys es)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;e. getspc_es (((es1, t, x) # xs) ! 0) = EvtSeq e (EvtSys es)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">e</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;getspc_es (((es1, s, y) # (es1, t, x) # xs) ! 0) = EvtSeq e (EvtSys es)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;es1 = EvtSeq e (EvtSys es)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;rm_evtsys ((es1, t, x) # xs) &#8712; cpts_ev&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rm_evtsys1 (es1, t, x) # rm_evtsys xs &#8712; cpts_ev&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">rm_evtsys_def</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rm_evtsys ((es1, s, y) # (es1, t, x) # xs) = 
                    rm_evtsys1 (es1, s, y) # rm_evtsys1 (es1, t, x) # rm_evtsys xs&quot;</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">rm_evtsys_def</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">es1</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">case</span></span><span class="delimiter">(</span><span class="">EvtSeq</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">es2</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rm_evtsys1 (EvtSeq x1 es2, t, x) # rm_evtsys xs &#8712; cpts_ev&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;rm_evtsys ((EvtSeq x1 es2, s, y) # (EvtSeq x1 es2, t, x) # xs) = 
                        (x1,s,y) # (x1, t, x) # rm_evtsys xs&quot;</span><span class=""> 
</span><span class="">                   </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">rm_evtsys_def</span><span class=""> </span><span class="">rm_evtsys1_def</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">getx_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(x1, t, x) # rm_evtsys xs &#8712; cpts_ev&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">rm_evtsys_def</span><span class=""> </span><span class="">rm_evtsys1_def</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">getx_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">cpts_ev.CptsEvEnv</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">EvtSys</span><span class=""> </span><span class="">xa</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rm_evtsys1 (EvtSys xa, t, x) # rm_evtsys xs &#8712; cpts_ev&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;rm_evtsys ((EvtSys xa, s, y) # (EvtSys xa, t, x) # xs) = 
                        (AnonyEvent None, s, y) # (AnonyEvent None, t, x) # rm_evtsys xs&quot;</span><span class=""> 
</span><span class="">                   </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">rm_evtsys_def</span><span class=""> </span><span class="">rm_evtsys1_def</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">getx_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(AnonyEvent None,t, x) # rm_evtsys xs &#8712; cpts_ev&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">rm_evtsys_def</span><span class=""> </span><span class="">rm_evtsys1_def</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">getx_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">cpts_ev.CptsEvEnv</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsEsComp</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">et</span><span class=""> </span><span class="">e2</span><span class=""> </span><span class="">t1</span><span class=""> </span><span class="">y1</span><span class=""> </span><span class="">xs1</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(e1, s1, x1) -es-et&#8594; (e2, t1, y1)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(e2, t1, y1) # xs1 &#8712; cpts_es&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;0 &lt; length ((e2, t1, y1) # xs1) &#10233;
                          &#8707;e. getspc_es (((e2, t1, y1) # xs1) ! 0) = EvtSeq e (EvtSys es) &#10233;
                          &#172; (&#8707;j. Suc j &lt; length ((e2, t1, y1) # xs1) &#8743;
                                  getspc_es (((e2, t1, y1) # xs1) ! j) = EvtSys es &#8743; 
                                  getspc_es (((e2, t1, y1) # xs1) ! Suc j) &#8800; EvtSys es) &#10233;
                                    rm_evtsys ((e2, t1, y1) # xs1) &#8712; cpts_ev&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;0 &lt; length ((e1, s1, x1) # (e2, t1, y1) # xs1)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;e. getspc_es (((e1, s1, x1) # (e2, t1, y1) # xs1) ! 0) = EvtSeq e (EvtSys es)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172; (&#8707;j. Suc j &lt; length ((e1, s1, x1) # (e2, t1, y1) # xs1) &#8743;
                                getspc_es (((e1, s1, x1) # (e2, t1, y1) # xs1) ! j) = EvtSys es &#8743;
                                getspc_es (((e1, s1, x1) # (e2, t1, y1) # xs1) ! Suc j) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rm_evtsys ((e1, s1, x1) # (e2, t1, y1) # xs1) = 
                        rm_evtsys1 (e1, s1, x1) # rm_evtsys1 (e2, t1, y1) # rm_evtsys xs1&quot;</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">rm_evtsys_def</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">e&#39;</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;getspc_es (((e1, s1, x1) # (e2, t1, y1) # xs1) ! 0) = EvtSeq e&#39; (EvtSys es)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;e1 = EvtSeq e&#39; (EvtSys es)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;&#8707;e. e2 = EvtSeq e (EvtSys es)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;e. e2 = EvtSeq e (EvtSys es)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">e</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;e2 = EvtSeq e (EvtSys es)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;e. getspc_es (((e2, t1, y1) # xs1) ! 0) = EvtSeq e (EvtSys es)&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172; (&#8707;j. Suc j &lt; length ((e2, t1, y1) # xs1) &#8743;
                                  getspc_es (((e2, t1, y1) # xs1) ! j) = EvtSys es &#8743; 
                                  getspc_es (((e2, t1, y1) # xs1) ! Suc j) &#8800; EvtSys es)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rm_evtsys ((e2, t1, y1) # xs1) &#8712; cpts_ev&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rm_evtsys1 (e2, t1, y1) # rm_evtsys xs1 &#8712; cpts_ev&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">rm_evtsys_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">b7</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;t. (e&#39;, s1, x1) -et-t&#8594; (e, t1, y1)&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtseq_tran_exist_etran</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">t</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(e&#39;, s1, x1) -et-t&#8594; (e, t1, y1)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b7</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;rm_evtsys1 (e1, s1, x1) = (e&#39;, s1, x1)&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">rm_evtsys_def</span><span class=""> </span><span class="">rm_evtsys1_def</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">getx_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;rm_evtsys1 (e2, t1, y1) = (e, t1, y1)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">rm_evtsys_def</span><span class=""> </span><span class="">rm_evtsys1_def</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">getx_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b6</span><span class=""> </span><span class="">c8</span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_ev.CptsEvComp</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(&#8707;e. e2 = EvtSeq e (EvtSys es))&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b7</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;e2 = EvtSys es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">evtseq_tran_evtseq</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c11</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rm_evtsys1 (e2, t1, y1) # rm_evtsys xs1 &#8712; cpts_ev&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172; (&#8707;j. Suc j &lt; length ((e2, t1, y1) # xs1) &#8743;
                            getspc_es (((e2, t1, y1) # xs1) ! j) = EvtSys es &#8743;
                            getspc_es (((e2, t1, y1) # xs1) ! Suc j) &#8800; EvtSys es)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d00</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;j. j &lt; length xs1 &#10230; getspc_es (xs1!j) = EvtSys es&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">                        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">j</span><span class="">
</span><span class="">                        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j &lt; length xs1&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (xs1!j) = EvtSys es&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">j</span><span class="delimiter">)</span><span class="">
</span><span class="">                            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">0</span><span class=""> </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> 
</span><span class="">                              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">length_Cons</span><span class=""> 
</span><span class="">                                          </span><span class="">less_one</span><span class=""> </span><span class="">not_less_eq</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">nth_Cons_Suc</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Suc</span><span class=""> </span><span class="">m</span><span class="delimiter">)</span><span class="">
</span><span class="">                            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">f0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m &lt; length xs1 &#10233; getspc_es (xs1 ! m) = EvtSys es&quot;</span><span class="">
</span><span class="">                              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">f1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc m &lt; length xs1&quot;</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;j. j &lt; length (rm_evtsys xs1) &#10230; getspc_e ((rm_evtsys xs1)!j) = AnonyEvent None&quot;</span><span class=""> 
</span><span class="">                       </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">rm_evtsys_def</span><span class=""> </span><span class="">rm_evtsys1_def</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">getx_es_def</span><span class=""> </span><span class="">getspc_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rm_evtsys1 (e2, t1, y1) = (AnonyEvent None, t1, y1)&quot;</span><span class=""> 
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">rm_evtsys1_def</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">getx_es_def</span><span class=""> </span><span class="">getspc_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. i &lt; length (rm_evtsys1 (e2, t1, y1) # rm_evtsys xs1) &#10230;
                                      getspc_e ((rm_evtsys1 (e2, t1, y1) # rm_evtsys xs1)!i) = AnonyEvent None&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_e_def</span><span class=""> </span><span class="">less_Suc_eq_0_disj</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;length (rm_evtsys1 (e2, t1, y1) # rm_evtsys xs1) &gt; 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_ev_same</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b7</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rm_evtsys1 (e1, s1, x1) = (e&#39;, s1, x1)&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">rm_evtsys_def</span><span class=""> </span><span class="">rm_evtsys1_def</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">getx_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rm_evtsys1 (e2, t1, y1) = (AnonyEvent None, t1, y1)&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">rm_evtsys_def</span><span class=""> </span><span class="">rm_evtsys1_def</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">getx_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b7</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;t. (e&#39;, s1, x1) -et-t&#8594; (AnonyEvent None, t1, y1)&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtseq_tran_0_exist_etran</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">t</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;(e&#39;, s1, x1) -et-t&#8594; (AnonyEvent None, t1, y1)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b6</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">c11</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_ev.CptsEvComp</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">                  
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">rm_evtsys_in_cptse</span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;&#10214;esl&#8712;cpts_es; esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs;
      (EvtSys es, s, x) -es-(EvtEnt (BasicEvent e))&#9839;k&#8594; (EvtSeq ev (EvtSys es), s1,x1);
      &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es);
      el = (BasicEvent e, s, x) # rm_evtsys ((EvtSeq ev (EvtSys es), s1,x1) # xs) &#10215; &#10233; 
      el &#8712; cpts_ev&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;cpts_es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(EvtSys es, s, x) -es-(EvtEnt (BasicEvent e))&#9839;k&#8594; (EvtSeq ev (EvtSys es), s1,x1)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es 
                      &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el = (BasicEvent e, s, x) # rm_evtsys ((EvtSeq ev (EvtSys es), s1,x1) # xs)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esl1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;(EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl1 &#8712; cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_es_dropi</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length ?esl1 &gt; 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;e. getspc_es (?esl1 ! 0) = EvtSeq e (EvtSys es)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172; (&#8707;j. Suc j &lt; length ?esl1 &#8743; getspc_es (?esl1 ! j) = EvtSys es 
            &#8743; getspc_es (?esl1 ! Suc j) &#8800; EvtSys es)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?esl1 &#8712; cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">rm_evtsys_in_cptse0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rm_evtsys ?esl1 &#8712; cpts_ev&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">rm_evtsys_in_cptse0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;rm_evtsys ?esl1 = rm_evtsys1 (EvtSeq ev (EvtSys es), s1,x1) # rm_evtsys xs&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">rm_evtsys_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rm_evtsys ?esl1 = (ev,s1,x1) # rm_evtsys xs&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">rm_evtsys1_def</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">getx_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(BasicEvent e, s, x) -et-(EvtEnt (BasicEvent e))&#9839;k&#8594; (ev, s1, x1)&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsysent_evtent</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">ev</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">x1</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">a6</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a5</span><span class=""> </span><span class="">cpts_ev.CptsEvComp</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">fstent_nomident_e_sim_es_aux</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="string">&quot;&#10214;esl&#8712;cpts_es; esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs;
      &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es);
      el = (BasicEvent e, s, x) # rm_evtsys ((EvtSeq ev (EvtSys es), s1,x1) # xs); el&#8712;cpts_ev&#10215; &#10233;
        &#8704;i. i &gt; 0 &#8743; i &lt; length el &#10230; 
              (getspc_es (esl!i) = EvtSys es &#8743; getspc_e (el!i) = AnonyEvent None) 
                &#8744; (getspc_es (esl!i) = EvtSeq (getspc_e (el!i)) (EvtSys es))&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;cpts_es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es 
                  &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el = (BasicEvent e, s, x) # rm_evtsys ((EvtSeq ev (EvtSys es), s1,x1) # xs)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el&#8712;cpts_ev&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?el1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;rm_evtsys ((EvtSeq ev (EvtSys es), s1,x1) # xs)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esl1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;(EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length ?esl1 = length ?el1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">rm_evtsys_same_sx</span><span class=""> </span><span class="">same_s_x_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl1&#8712;cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_es_dropi</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p2_1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;j. j &gt; 0 &#8743; Suc j &lt; length esl &#10230; 
          getspc_es (esl ! j) = EvtSys es &#10230; getspc_es (esl ! Suc j) = EvtSys es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">noevtent_inmid_eq</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. i &lt; length ?el1 &#10230; 
          (getspc_es (?esl1!i) = EvtSys es &#8743; getspc_e (?el1!i) = AnonyEvent None) 
                &#8744; (getspc_es (?esl1!i) = EvtSeq (getspc_e (?el1!i)) (EvtSys es))&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i &lt; length ?el1&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(getspc_es (?esl1!i) = EvtSys es &#8743; getspc_e (?el1!i) = AnonyEvent None) 
                &#8744; (getspc_es (?esl1!i) = EvtSeq (getspc_e (?el1!i)) (EvtSys es))&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">i</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">0</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (?esl1!0) = EvtSeq (getspc_e (?el1!0)) (EvtSys es)&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">getspc_e_def</span><span class=""> </span><span class="">rm_evtsys_def</span><span class=""> </span><span class="">rm_evtsys1_def</span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">getx_es_def</span><span class=""> </span><span class="">EvtSeqrm</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">fstI</span><span class=""> </span><span class="">length_greater_0_conv</span><span class=""> </span><span class="">list.distinct</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">nth_map</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Suc</span><span class=""> </span><span class="">j</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j &lt; length ?el1 &#10233; getspc_es (?esl1 ! j) = EvtSys es &#8743;
                        getspc_e (?el1 ! j) = AnonyEvent None &#8744;
                        getspc_es (?esl1 ! j) =
                        EvtSeq (getspc_e (?el1 ! j)) (EvtSys es)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc j &lt; length ?el1&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (?esl1 ! j) = EvtSys es &#8743;
                        getspc_e (?el1 ! j) = AnonyEvent None &#8744;
                        getspc_es (?esl1 ! j) =
                        EvtSeq (getspc_e (?el1 ! j)) (EvtSys es)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;getspc_es (?esl1 ! j) = EvtSys es &#8743;
                        getspc_e (?el1 ! j) = AnonyEvent None&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (?esl1 ! j) = EvtSys es &#8743;
                        getspc_e (?el1 ! j) = AnonyEvent None&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2_1</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (?esl1 ! Suc j) = EvtSys es&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (esl ! Suc j) = EvtSys es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;0 &lt; Suc j &#8743; Suc (Suc j) &lt; length esl&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (esl ! Suc (Suc j)) = EvtSys es&quot;</span><span class=""> 
</span><span class="">                      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">p2_1</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_e (?el1 ! Suc j) = AnonyEvent None&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">getspc_e_def</span><span class=""> </span><span class="">rm_evtsys_def</span><span class=""> </span><span class="">rm_evtsys1_def</span><span class=""> 
</span><span class="">                    </span><span class="">gets_es_def</span><span class=""> </span><span class="">getx_es_def</span><span class=""> </span><span class="">EvtSysrm</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">nth_map</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;&#172;(getspc_es (?esl1 ! j) = EvtSys es &#8743;
                        getspc_e (?el1 ! j) = AnonyEvent None)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (?esl1 ! j) =
                        EvtSeq (getspc_e (?el1 ! j)) (EvtSys es)&quot;</span><span class="">
</span><span class="">                   </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">e</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el1 ! j = (e,s1,x1)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">prod_cases3</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl1 ! j = (EvtSeq e (EvtSys es),s1,x1)&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;same_s_x ?esl1 ?el1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">rm_evtsys_same_sx</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (?esl1 ! j) = EvtSeq e (EvtSys es)&quot;</span><span class=""> 
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_es_def</span><span class=""> </span><span class="">getspc_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_e (?el1 ! j) = gets_es (?esl1 ! j)&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Suc.prems</span><span class=""> </span><span class="">less_or_eq_imp_le</span><span class=""> </span><span class="">same_s_x_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getx_e (?el1 ! j) = getx_es (?esl1 ! j)&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Suc.prems</span><span class=""> </span><span class="">less_or_eq_imp_le</span><span class=""> </span><span class="">same_s_x_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> 
</span><span class="">                      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">getx_es_def</span><span class=""> </span><span class="">gets_e_def</span><span class=""> </span><span class="">getx_e_def</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">prod.collapse</span><span class=""> </span><span class="">snd_conv</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;getspc_es (?esl1 ! Suc j) = EvtSys es&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (?esl1 ! Suc j) = EvtSys es&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">s2</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl1 ! Suc j = (EvtSys es, s2,x2)&quot;</span><span class=""> 
</span><span class="">                      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">surj_pair</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el1 ! Suc j = (AnonyEvent None, s2,x2)&quot;</span><span class=""> 
</span><span class="">                      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">rm_evtsys_def</span><span class=""> </span><span class="">rm_evtsys1_def</span><span class=""> 
</span><span class="">                        </span><span class="">gets_es_def</span><span class=""> </span><span class="">getx_es_def</span><span class=""> </span><span class="">EvtSysrm</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Suc.prems</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">nth_map</span><span class=""> </span><span class="">snd_conv</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (?esl1 ! Suc j) = EvtSys es &#8743;
                        getspc_e (?el1 ! Suc j) = AnonyEvent None&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">getspc_e_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">fst_conv</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (?esl1 ! Suc j) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;e1. getspc_es (?esl1 ! Suc j) = EvtSeq e1 (EvtSys es)&quot;</span><span class=""> 
</span><span class="">                      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtseq_next_in_cpts</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class="string">&quot;getspc_es (?esl1 ! Suc j) = EvtSeq e1 (EvtSys es)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_e (?el1 ! Suc j) = e1&quot;</span><span class=""> 
</span><span class="">                      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">getspc_e_def</span><span class=""> </span><span class="">rm_evtsys_def</span><span class=""> </span><span class="">rm_evtsys1_def</span><span class=""> 
</span><span class="">                        </span><span class="">gets_es_def</span><span class=""> </span><span class="">getx_es_def</span><span class=""> </span><span class="">EvtSeqrm</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">fstI</span><span class=""> </span><span class="">nth_map</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (?esl1 ! Suc j) =
                                EvtSeq (getspc_e (?el1 ! Suc j)) (EvtSys es)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_diff_1</span><span class=""> 
</span><span class="">              </span><span class="">Suc_less_SucD</span><span class=""> </span><span class="">length_Cons</span><span class=""> </span><span class="">nth_Cons_pos</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">fstent_nomident_e_sim_es</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="string">&quot;&#10214;esl&#8712;cpts_es; esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs;
      &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es)&#10215; &#10233;
      &#8707;el e s x. el&#8712;cpts_of_ev (BasicEvent e) s x &#8743; e_sim_es esl el es e&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;cpts_es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es 
                    &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;t. (EvtSys es, s, x) -es-t&#8594; (EvtSeq ev (EvtSys es), s1,x1)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">esl</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">esys.distinct</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">exist_estran</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">t</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(EvtSys es, s, x) -es-t&#8594; (EvtSeq ev (EvtSys es), s1,x1)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;evt e. evt &#8712; es &#8743; evt = BasicEvent e &#8743; Act t = EvtEnt (BasicEvent e) &#8743;
            (BasicEvent e, s, x) -et-t&#8594; (ev, s1, x1)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsysent_evtent0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">evt</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">e</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;evt &#8712; es &#8743; evt = BasicEvent e &#8743; Act t = EvtEnt (BasicEvent e) &#8743;
            (BasicEvent e, s, x) -et-t&#8594; (ev, s1, x1)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esl1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;(EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?el</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;(BasicEvent e, s, x) # rm_evtsys ?esl1&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?el1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;rm_evtsys ?esl1&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el = (BasicEvent e, s, x) # ?el1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl = (EvtSys es, s, x) # ?esl1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">at</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">ak</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;(BasicEvent e, s, x) -et-(at&#9839;ak)&#8594; (ev, s1, x1)&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">get_actk_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">actk.cases</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el &#8712; cpts_ev&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">rm_evtsys_in_cptse</span><span class=""> </span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">esl</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">ev</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">xs</span><span class="delimiter">]</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">estran.EvtOccur</span><span class=""> </span><span class="">evtsysent_evtent0</span><span class=""> </span><span class="">noevtent_notran0</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;e_sim_es esl ?el es e&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length esl = length ?el&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">rm_evtsys_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl ! 0) = EvtSys es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_e (?el ! 0) = BasicEvent e&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. i &lt; length ?el &#10230; 
                  gets_e (?el ! i) = gets_es (esl ! i) &#8743;
                  getx_e (?el ! i) = getx_es (esl ! i)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;same_s_x ?esl1 (rm_evtsys ?esl1)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">rm_evtsys_same_sx</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;i &lt; length ?el &#10230; 
                  gets_e (?el ! i) = gets_es (esl ! i) &#8743;
                  getx_e (?el ! i) = getx_es (esl ! i)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;i = 0&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;i = 0&quot;</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">gets_e_def</span><span class=""> </span><span class="">getx_e_def</span><span class=""> </span><span class="">gets_es_def</span><span class=""> 
</span><span class="">                        </span><span class="">getx_es_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">snd_conv</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;i&#8800;0&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">same_s_x_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. i &gt; 0 &#8743; i &lt; length ?el &#10230; 
                  (getspc_es (esl!i) = EvtSys es &#8743; getspc_e (?el!i) = AnonyEvent None) 
                    &#8744; (getspc_es (esl!i) = EvtSeq (getspc_e (?el!i)) (EvtSys es))&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">a4</span><span class="">  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">fstent_nomident_e_sim_es_aux</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">e_sim_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_of_ev_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> </span><span class="">nth_Cons&#39;</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">fstent_nomident_e_sim_es2</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="string">&quot;&#10214;esl&#8712;cpts_es; esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs;
      (EvtSys es, s, x) -es-(EvtEnt (BasicEvent e))&#9839;k&#8594; (EvtSeq ev (EvtSys es), s1,x1);
      &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es);
      el = (BasicEvent e, s, x) # rm_evtsys ((EvtSeq ev (EvtSys es), s1,x1) # xs); el&#8712;cpts_ev&#10215; &#10233;
      e_sim_es esl el es e&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;cpts_es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(EvtSys es, s, x) -es-(EvtEnt (BasicEvent e))&#9839;k&#8594; (EvtSeq ev (EvtSys es), s1,x1)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es 
                    &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el = (BasicEvent e, s, x) # rm_evtsys ((EvtSeq ev (EvtSys es), s1,x1) # xs)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el&#8712;cpts_ev&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(BasicEvent e, s, x) -et-(EvtEnt (BasicEvent e))&#9839;k&#8594; (ev, s1, x1)&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsysent_evtent</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">ev</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">x1</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esl1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;(EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?el</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;(BasicEvent e, s, x) # rm_evtsys ?esl1&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?el1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;rm_evtsys ?esl1&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el = (BasicEvent e, s, x) # ?el1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl = (EvtSys es, s, x) # ?esl1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el &#8712; cpts_ev&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">rm_evtsys_in_cptse</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length esl = length ?el&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">rm_evtsys_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl ! 0) = EvtSys es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_e (?el ! 0) = BasicEvent e&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. i &lt; length ?el &#10230; 
                  gets_e (?el ! i) = gets_es (esl ! i) &#8743;
                  getx_e (?el ! i) = getx_es (esl ! i)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;same_s_x ?esl1 (rm_evtsys ?esl1)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">rm_evtsys_same_sx</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;i &lt; length ?el &#10230; 
                  gets_e (?el ! i) = gets_es (esl ! i) &#8743;
                  getx_e (?el ! i) = getx_es (esl ! i)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;i = 0&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;i = 0&quot;</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">gets_e_def</span><span class=""> </span><span class="">getx_e_def</span><span class=""> </span><span class="">gets_es_def</span><span class=""> 
</span><span class="">                        </span><span class="">getx_es_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">snd_conv</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;i&#8800;0&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">same_s_x_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. i &gt; 0 &#8743; i &lt; length ?el &#10230; 
                  (getspc_es (esl!i) = EvtSys es &#8743; getspc_e (?el!i) = AnonyEvent None) 
                    &#8744; (getspc_es (esl!i) = EvtSeq (getspc_e (?el!i)) (EvtSys es))&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">a4</span><span class="">  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">fstent_nomident_e_sim_es_aux</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">e_sim_es_def</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">e_sim_es_same_assume</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;&#10214;esl&#8712;cpts_es; esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs;
      (EvtSys es, s, x) -es-(EvtEnt (BasicEvent e))&#9839;k&#8594; (EvtSeq ev (EvtSys es), s1,x1);
      &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es);
      el = (BasicEvent e, s, x) # rm_evtsys ((EvtSeq ev (EvtSys es), s1,x1) # xs); 
      e_sim_es esl el es e; esl&#8712;assume_es(pre,rely)&#10215;
      &#10233; el&#8712;assume_e(pre,rely)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;cpts_es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(EvtSys es, s, x) -es-(EvtEnt (BasicEvent e))&#9839;k&#8594; (EvtSeq ev (EvtSys es), s1,x1)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es 
                    &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el = (BasicEvent e, s, x) # rm_evtsys ((EvtSeq ev (EvtSys es), s1,x1) # xs)&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;e_sim_es esl el es e&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;assume_es(pre,rely)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p3_1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;j. j &gt; 0 &#8743; Suc j &lt; length esl &#10230; getspc_es (esl ! j) = EvtSys es 
          &#10230; getspc_es (esl ! Suc j) = EvtSys es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">noevtent_inmid_eq</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esl1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;(EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?el1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;rm_evtsys ((EvtSeq ev (EvtSys es), s1,x1) # xs)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el = (BasicEvent e, s, x) # (ev,s1,x1) # rm_evtsys xs&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">getx_es_def</span><span class=""> </span><span class="">rm_evtsys1_def</span><span class=""> </span><span class="">rm_evtsys_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length esl = length el&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">rm_evtsys_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;gets_es (esl!0) &#8712; pre &#8743; (&#8704;i. Suc i&lt;length esl &#10230; 
           esl!i -ese&#8594; esl!(Suc i) &#10230; (gets_es (esl!i), gets_es (esl!Suc i)) &#8712; rely)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_e (el!0) &#8712; pre&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">gets_e_def</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">snd_conv</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length el &#10230; el!i -ee&#8594; el!(Suc i) 
                &#10230; (gets_e (el!i), gets_e (el!Suc i)) &#8712; rely&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i&lt;length el&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el!i -ee&#8594; el!(Suc i)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172;(el!0 -ee&#8594; el!1)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">eetran.simps</span><span class=""> </span><span class="">evtsysent_evtent0</span><span class=""> 
</span><span class="">                    </span><span class="">no_tran2basic0</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">nth_Cons_Suc</span><span class=""> </span><span class="">p2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i &#8800; 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">One_nat_def</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(getspc_es (esl!i) = EvtSys es &#8743; getspc_e (el!i) = AnonyEvent None) 
                                  &#8744; (getspc_es (esl!i) = EvtSeq (getspc_e (el!i)) (EvtSys es))&quot;</span><span class="">
</span><span class="">               </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">e_sim_es_def</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_e (el!i) = getspc_e (el!Suc i)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">eetran_eqconf1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;gets_es (esl!i) = gets_e (el!i) 
                              &#8743; gets_es (esl!Suc i) = gets_e (el!Suc i)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">e_sim_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c6</span><span class="delimiter">:</span><span class=""> 
</span><span class="">                        </span><span class="string">&quot;(getspc_es (esl!Suc i) = EvtSys es &#8743; getspc_e (el!Suc i) = AnonyEvent None) 
                         &#8744; (getspc_es (esl!Suc i) = EvtSeq (getspc_e (el!Suc i)) (EvtSys es))&quot;</span><span class="">
</span><span class="">               </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">e_sim_es_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_e (el!i), gets_e (el!Suc i)) &#8712; rely&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;getspc_es (esl!i) = EvtSys es &#8743; getspc_e (el!i) = AnonyEvent None&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl!i) = EvtSys es &#8743; getspc_e (el!i) = AnonyEvent None&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="">p3_1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (esl!Suc i) = EvtSys es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;esl!i -ese&#8594; esl!Suc i&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">eqconf_esetran</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_es (esl!i), gets_es (esl!Suc i)) &#8712; rely&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;&#172;(getspc_es (esl!i) = EvtSys es &#8743; getspc_e (el!i) = AnonyEvent None)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl!i) = EvtSeq (getspc_e (el!i)) (EvtSys es)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?ei</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;getspc_e (el!i)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;?ei = AnonyEvent None&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?ei = AnonyEvent None&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_e (el!Suc i) = AnonyEvent None&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">eetran_eqconf1</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">                    </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;getspc_es (esl!Suc i) = EvtSys es &#8743; getspc_e (el!Suc i) = AnonyEvent None&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">f0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl!Suc i) = EvtSys es &#8743; getspc_e (el!Suc i) = AnonyEvent None&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_e (el!i) &#8800; AnonyEvent None&quot;</span><span class=""> 
</span><span class="">                          </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esl&#39;</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;drop i esl&quot;</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?esl&#39;&#8712;cpts_es&quot;</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="">cpts_es_dropi</span><span class=""> </span><span class="">old.nat.exhaust</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;length ?esl&#39; &gt; 1&quot;</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (?esl&#39;!0) = EvtSeq (getspc_e (el!i)) (EvtSys es)&quot;</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">f0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (?esl&#39;!1) = EvtSys es&quot;</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">                            </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">not_anonyevt_none_in_evtseq1</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;&#172;(getspc_es (esl!Suc i) = EvtSys es &#8743; getspc_e (el!Suc i) = AnonyEvent None)&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl!Suc i) = EvtSeq (getspc_e (el!Suc i)) (EvtSys es)&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (esl!Suc i) = EvtSeq (getspc_e (el!i)) (EvtSys es)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (esl!Suc i) = getspc_es (esl!i)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;esl!i -ese&#8594; esl!Suc i&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">eqconf_esetran</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_es (esl!i), gets_es (esl!Suc i)) &#8712; rely&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">c0</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?ei &#8800; AnonyEvent None&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="">c6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (esl!Suc i) = EvtSeq (getspc_e (el!Suc i)) (EvtSys es)&quot;</span><span class=""> 
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (esl!Suc i) = getspc_es (esl!i)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;esl!i -ese&#8594; esl!Suc i&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">eqconf_esetran</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_es (esl!i), gets_es (esl!Suc i)) &#8712; rely&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">c0</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">e_sim_es_same_commit</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;&#10214;esl&#8712;cpts_es; esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs;
      (EvtSys es, s, x) -es-(EvtEnt (BasicEvent e))&#9839;k&#8594; (EvtSeq ev (EvtSys es), s1,x1);
      &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es);
      el = (BasicEvent e, s, x) # rm_evtsys ((EvtSeq ev (EvtSys es), s1,x1) # xs); 
      e_sim_es esl el es e; el&#8712;commit_e(guar,post)&#10215;
      &#10233; esl&#8712;commit_es(guar,post)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;cpts_es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(EvtSys es, s, x) -es-(EvtEnt (BasicEvent e))&#9839;k&#8594; (EvtSeq ev (EvtSys es), s1,x1)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es 
                    &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el = (BasicEvent e, s, x) # rm_evtsys ((EvtSeq ev (EvtSys es), s1,x1) # xs)&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;e_sim_es esl el es e&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el&#8712;commit_e(guar,post)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p3_1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;j. j &gt; 0 &#8743; Suc j &lt; length esl &#10230; getspc_es (esl ! j) = EvtSys es 
          &#10230; getspc_es (esl ! Suc j) = EvtSys es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">noevtent_inmid_eq</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; cpts_ev&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">rm_evtsys_in_cptse</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esl1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;(EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?el1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;rm_evtsys ((EvtSeq ev (EvtSys es), s1,x1) # xs)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el = (BasicEvent e, s, x) # (ev,s1,x1) # rm_evtsys xs&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">getx_es_def</span><span class=""> </span><span class="">rm_evtsys1_def</span><span class=""> </span><span class="">rm_evtsys_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length esl = length el&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">rm_evtsys_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length el &#10230; 
               (&#8707;t. el!i -et-t&#8594; el!(Suc i)) &#10230; (gets_e (el!i), gets_e (el!Suc i)) &#8712; guar&quot;</span><span class=""> 
</span><span class="">               </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;esl&#8712;commit_es(guar,post)&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length esl &#10230; (&#8707;t. esl!i -es-t&#8594; esl!(Suc i)) 
              &#10230; (gets_es (esl!i), gets_es (esl!Suc i)) &#8712; guar&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i&lt;length esl&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;t. esl!i -es-t&#8594; esl!(Suc i)&quot;</span><span class="">
</span><span class="">            
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_es (esl!i), gets_es (esl!Suc i)) &#8712; guar&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;i = 0&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i = 0&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(BasicEvent e, s, x) -et-(EvtEnt (BasicEvent e))&#9839;k&#8594; (ev, s1, x1)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsysent_evtent</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(s, s1) &#8712; guar&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">gets_e_def</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">nth_Cons_Suc</span><span class=""> </span><span class="">snd_conv</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">d0</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i &#8800; 0&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;getspc_es (esl!i) = EvtSys es&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl!i) = EvtSys es&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p3_1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl!Suc i) = EvtSys es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">t</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;esl ! i -es-t&#8594; esl ! Suc i&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (esl!i) &#8800; getspc_es (esl!Suc i)&quot;</span><span class=""> 
</span><span class="">                      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsys_not_eq_in_tran_aux1</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl!i) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (esl!i) = EvtSys es &#8744; 
                        (&#8707;e. getspc_es (esl!i) = EvtSeq e (EvtSys es))&quot;</span><span class=""> 
</span><span class="">                      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsys_all_es_in_cpts</span><span class=""> </span><span class="">getspc_es_def</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">length_Cons</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">zero_less_Suc</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;e. getspc_es (esl!i) = EvtSeq e (EvtSys es)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">e</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl!i) = EvtSeq e (EvtSys es)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e0_1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl!Suc i) = EvtSys es &#8744; 
                        (&#8707;e. getspc_es (esl!Suc i) = EvtSeq e (EvtSys es))&quot;</span><span class=""> 
</span><span class="">                      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsys_all_es_in_cpts</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> 
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">length_greater_0_conv</span><span class=""> </span><span class="">list.distinct</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">nth_Cons_0</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">esi</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">si</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">xi</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">esi&#39;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">si&#39;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">xi&#39;</span><span class=""> 
</span><span class="">                      </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">e2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl!i = (esi,si,xi) &#8743; esl!(Suc i) = (esi&#39;,si&#39;,xi&#39;)&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">prod.collapse</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">t</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">e3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(esi,si,xi) -es-t&#8594; (esi&#39;,si&#39;,xi&#39;)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">e0_1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">proof</span></span><span class="">
</span><span class="">                        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">f0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl!Suc i) = EvtSys es&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">e2</span><span class=""> </span><span class="">e3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;t. (e, si, xi) -et-t&#8594; (AnonyEvent (None), si&#39;,xi&#39;)&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">evtseq_tran_0_exist_etran</span><span class=""> </span><span class="">getspc_es_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">et</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">f1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(e, si, xi) -et-et&#8594; (AnonyEvent (None), si&#39;,xi&#39;)&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">e2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f2</span><span class="delimiter">:</span><span class="string">&quot;el!i = (e, si, xi)&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">getspc_e_def</span><span class=""> </span><span class="">rm_evtsys_def</span><span class=""> </span><span class="">rm_evtsys1_def</span><span class=""> 
</span><span class="">                            </span><span class="">gets_es_def</span><span class=""> </span><span class="">getx_es_def</span><span class=""> </span><span class="">EvtSeqrm</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">less_Suc_eq_0_disj</span><span class=""> </span><span class="">list.simps</span><span class="delimiter">(</span><span class="">9</span><span class="delimiter">)</span><span class=""> </span><span class="">nth_Cons_Suc</span><span class=""> </span><span class="">nth_map</span><span class=""> </span><span class="">snd_conv</span><span class="delimiter">)</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">e2</span><span class=""> </span><span class="">f0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f3</span><span class="delimiter">:</span><span class="string">&quot;el!Suc i = (AnonyEvent (None), si&#39;,xi&#39;)&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">getspc_e_def</span><span class=""> </span><span class="">rm_evtsys_def</span><span class=""> </span><span class="">rm_evtsys1_def</span><span class=""> 
</span><span class="">                            </span><span class="">gets_es_def</span><span class=""> </span><span class="">getx_es_def</span><span class=""> </span><span class="">EvtSysrm</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">List.nth_tl</span><span class=""> </span><span class="">Suc_lessE</span><span class=""> </span><span class="">diff_Suc_1</span><span class=""> </span><span class="">fst_conv</span><span class=""> 
</span><span class="">                              </span><span class="">length_tl</span><span class=""> </span><span class="">list.sel</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">nth_map</span><span class=""> </span><span class="">snd_conv</span><span class="delimiter">)</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(si,si&#39;)&#8712;guar&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">gets_e_def</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">snd_conv</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">e2</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">gets_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">f0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;e. getspc_es (esl!Suc i) = EvtSeq e (EvtSys es)&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">e&#39;</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">f1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl!Suc i) = EvtSeq e&#39; (EvtSys es)&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">e2</span><span class=""> </span><span class="">e3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;t. (e, si, xi) -et-t&#8594; (e&#39;, si&#39;, xi&#39;)&quot;</span><span class=""> 
</span><span class="">                          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">evtseq_tran_exist_etran</span><span class=""> </span><span class="">getspc_es_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">e2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f2</span><span class="delimiter">:</span><span class="string">&quot;el!i = (e, si, xi)&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">getspc_e_def</span><span class=""> </span><span class="">rm_evtsys_def</span><span class=""> </span><span class="">rm_evtsys1_def</span><span class=""> 
</span><span class="">                            </span><span class="">gets_es_def</span><span class=""> </span><span class="">getx_es_def</span><span class=""> </span><span class="">EvtSeqrm</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">less_Suc_eq_0_disj</span><span class=""> </span><span class="">list.simps</span><span class="delimiter">(</span><span class="">9</span><span class="delimiter">)</span><span class=""> </span><span class="">nth_Cons_Suc</span><span class=""> </span><span class="">nth_map</span><span class=""> </span><span class="">snd_conv</span><span class="delimiter">)</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">e2</span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f3</span><span class="delimiter">:</span><span class="string">&quot;el!Suc i = (e&#39;, si&#39;,xi&#39;)&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">getspc_e_def</span><span class=""> </span><span class="">rm_evtsys_def</span><span class=""> </span><span class="">rm_evtsys1_def</span><span class=""> 
</span><span class="">                            </span><span class="">gets_es_def</span><span class=""> </span><span class="">getx_es_def</span><span class=""> </span><span class="">EvtSeqrm</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">less_Suc_eq_0_disj</span><span class=""> </span><span class="">list.simps</span><span class="delimiter">(</span><span class="">9</span><span class="delimiter">)</span><span class=""> </span><span class="">nth_Cons_Suc</span><span class=""> </span><span class="">nth_map</span><span class=""> </span><span class="">snd_conv</span><span class="delimiter">)</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(si,si&#39;)&#8712;guar&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">gets_e_def</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">snd_conv</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">e2</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">gets_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">rm_evtsys_assum_comm</span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;&#10214;esl&#8712;cpts_es; esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs;
      (EvtSys es, s, x) -es-(EvtEnt (BasicEvent e))&#9839;k&#8594; (EvtSeq ev (EvtSys es), s1,x1);
      &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es);
      el = (BasicEvent e, s, x) # rm_evtsys ((EvtSeq ev (EvtSys es), s1,x1) # xs); 
      el&#8712;assume_e(pre,rely) &#10230; el&#8712;commit_e(guar,post) &#10215;
      &#10233; esl&#8712;assume_es(pre,rely) &#10230; esl&#8712;commit_es(guar,post)&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;cpts_es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(EvtSys es, s, x) -es-(EvtEnt (BasicEvent e))&#9839;k&#8594; (EvtSeq ev (EvtSys es), s1,x1)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es 
                    &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el = (BasicEvent e, s, x) # rm_evtsys ((EvtSeq ev (EvtSys es), s1,x1) # xs)&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el&#8712;assume_e(pre,rely) &#10230; el&#8712;commit_e(guar,post)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p3_1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;j. j &gt; 0 &#8743; Suc j &lt; length esl &#10230; getspc_es (esl ! j) = EvtSys es 
          &#10230; getspc_es (esl ! Suc j) = EvtSys es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">noevtent_inmid_eq</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; cpts_ev&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">rm_evtsys_in_cptse</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esl1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;(EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?el1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;rm_evtsys ((EvtSeq ev (EvtSys es), s1,x1) # xs)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;e_sim_es esl el es e&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">fstent_nomident_e_sim_es2</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el = (BasicEvent e, s, x) # (ev,s1,x1) # rm_evtsys xs&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">getx_es_def</span><span class=""> </span><span class="">rm_evtsys1_def</span><span class=""> </span><span class="">rm_evtsys_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length esl = length el&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">rm_evtsys_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> 
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;assume_es(pre,rely)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el&#8712;assume_e(pre,rely)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">e_sim_es_same_assume</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el&#8712;commit_e(guar,post)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;esl&#8712;commit_es(guar,post)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">e_sim_es_same_commit</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">EventSys_sound_aux1</span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;&#10214;&#8704;ef&#8712;es. &#8872; ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre ef, Rely ef, Guar ef, Post ef];
     esl&#8712;cpts_es;length esl &#8805; 2 &#8743; getspc_es (esl!0) = EvtSys es &#8743; getspc_es (esl!1) &#8800; EvtSys es;
     &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es)&#10215;
      &#10233; &#8707;m&#8712;es. (esl&#8712;assume_es(Pre m,Rely m) &#10230; esl&#8712;commit_es(Guar m,Post m)) 
                          &#8743; (&#8707;k. esl!0-es-(EvtEnt m)&#9839;k&#8594;esl!1)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;es. &#8872; ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre ef, Rely ef, Guar ef, Post ef]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length esl &#8805; 2 &#8743; getspc_es (esl!0) = EvtSys es &#8743; getspc_es (esl!1) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">c41</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;cpts_es&quot;</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;s x ev s1 x1 xs. esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">fst_esys_snd_eseq_exist</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">s</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">ev</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">xs</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="string">&quot;esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;e k. (EvtSys es, s, x) -es-(EvtEnt (BasicEvent e))&#9839;k&#8594; (EvtSeq ev (EvtSys es), s1,x1)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">fst_esys_snd_eseq_exist_evtent2</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">e</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c4</span><span class="delimiter">:</span><span class=""> 
</span><span class="">      </span><span class="string">&quot;(EvtSys es, s, x) -es-(EvtEnt (BasicEvent e))&#9839;k&#8594; (EvtSeq ev (EvtSys es), s1,x1)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?el</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;(BasicEvent e, s, x) # rm_evtsys ((EvtSeq ev (EvtSys es), s1,x1) # xs)&quot;</span><span class="">
</span><span class="">    
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="">c41</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el &#8712; cpts_ev&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">rm_evtsys_in_cptse</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;ei&#8712;es. ei = BasicEvent e&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsysent_evtent</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">ei</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;ei&#8712;es &#8743; ei = BasicEvent e&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="">c6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c61</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl!0-es-(EvtEnt ei)&#9839;k&#8594;esl!1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el&#8712;assume_e(Pre ei, Rely ei) &#10230; ?el&#8712;commit_e(Guar ei,Post ei)&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> 
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el&#8712;assume_e(Pre ei, Rely ei)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">c6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8872; ei sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre ei, Rely ei, Guar ei, Post ei]&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?el&#8712;cpts_of_ev (BasicEvent e) s x&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_ev_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;?el&#8712;commit_e(Guar ei,Post ei)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evt_validity_def</span><span class=""> </span><span class="">c6</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="">c41</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;assume_es(Pre ei, Rely ei) &#10230; esl&#8712;commit_es(Guar ei,Post ei)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">rm_evtsys_assum_comm</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">c6</span><span class=""> </span><span class="">c61</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">EventSys_sound_aux1_forall</span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;&#10214;&#8704;ef&#8712;es. &#8872; ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre ef, Rely ef, Guar ef, Post ef];
     esl&#8712;cpts_es;length esl &#8805; 2 &#8743; getspc_es (esl!0) = EvtSys es &#8743; getspc_es (esl!1) &#8800; EvtSys es;
     &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es)&#10215;
      &#10233; &#8704;m&#8712;es. (&#8707;k. esl!0-es-(EvtEnt m)&#9839;k&#8594;esl!1) 
                          &#10230; (esl&#8712;assume_es(Pre m,Rely m) &#10230; esl&#8712;commit_es(Guar m,Post m))&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;es. &#8872; ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre ef, Rely ef, Guar ef, Post ef]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length esl &#8805; 2 &#8743; getspc_es (esl!0) = EvtSys es &#8743; getspc_es (esl!1) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">c41</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;cpts_es&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">m</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c01</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m&#8712;es&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">c02</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;k. esl!0-es-(EvtEnt m)&#9839;k&#8594;esl!1&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;s x ev s1 x1 xs. esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">fst_esys_snd_eseq_exist</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">s</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">ev</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">xs</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class="">
</span><span class="">          </span><span class="string">&quot;esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c02</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;k. (EvtSys es, s, x) -es-(EvtEnt m)&#9839;k&#8594; (EvtSeq ev (EvtSys es), s1,x1)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(EvtSys es, s, x) -es-(EvtEnt m)&#9839;k&#8594; (EvtSeq ev (EvtSys es), s1,x1)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;e. m = BasicEvent e&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">evtent_is_basicevt</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">e</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c40</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m = BasicEvent e&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?el</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;(m, s, x) # rm_evtsys ((EvtSeq ev (EvtSys es), s1,x1) # xs)&quot;</span><span class="">    
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="">c40</span><span class=""> </span><span class="">c41</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el &#8712; cpts_ev&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">rm_evtsys_in_cptse</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="">c40</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c61</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl!0-es-(EvtEnt m)&#9839;k&#8594;esl!1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el&#8712;assume_e(Pre m, Rely m) &#10230; ?el&#8712;commit_e(Guar m,Post m)&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class=""> 
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el&#8712;assume_e(Pre m, Rely m)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">c01</span><span class=""> </span><span class="">c40</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8872; m sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre m, Rely m, Guar m, Post m]&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="">c40</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?el&#8712;cpts_of_ev (BasicEvent e) s x&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_ev_def</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;?el&#8712;commit_e(Guar m,Post m)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evt_validity_def</span><span class=""> </span><span class="">c40</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="">c40</span><span class=""> </span><span class="">c41</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;assume_es(Pre m, Rely m) &#10230; esl&#8712;commit_es(Guar m,Post m)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">rm_evtsys_assum_comm</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">EventSys_sound_seg_aux0_exist</span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;&#10214;esl&#8712;cpts_es;length esl &#8805; 2; getspc_es (esl!0) = EvtSys es; getspc_es (esl!1) &#8800; EvtSys es&#10215;
      &#10233; &#8707;m&#8712;es. (&#8707;k. esl!0-es-(EvtEnt m)&#9839;k&#8594;esl!1)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;cpts_es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length esl &#8805; 2&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl!0) = EvtSys es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl!1) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;s x ev s1 x1 xs. esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">fst_esys_snd_eseq_exist</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">s</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">ev</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">xs</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class="">
</span><span class="">      </span><span class="string">&quot;esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;e k. (EvtSys es, s, x) -es-(EvtEnt (BasicEvent e))&#9839;k&#8594; (EvtSeq ev (EvtSys es), s1,x1)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">fst_esys_snd_eseq_exist_evtent2</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">e</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class=""> 
</span><span class="">      </span><span class="string">&quot;(EvtSys es, s, x) -es-(EvtEnt (BasicEvent e))&#9839;k&#8594; (EvtSeq ev (EvtSys es), s1,x1)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;i&#8712;es. i = BasicEvent e&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsysent_evtent</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">ei</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;ei&#8712; es &#8743; ei = BasicEvent e&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">nth_Cons_Suc</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">EventSys_sound_seg_aux0_forall</span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;&#10214;&#8704;ef&#8712;es. &#8872; ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre ef, Rely ef, Guar ef, Post ef];
     esl&#8712;cpts_es;length esl &#8805; 2 &#8743; getspc_es (esl!0) = EvtSys es &#8743; getspc_es (esl!1) &#8800; EvtSys es;
     getspc_es (last esl) = EvtSys es;
     &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es)&#10215;
      &#10233; &#8704;ei&#8712;es. (&#8707;k. esl!0-es-(EvtEnt ei)&#9839;k&#8594;esl!1) 
                              &#10230; (esl&#8712;assume_es(Pre ei,Rely ei) &#10230; esl&#8712;commit_es(Guar ei,Post ei)
                                    &#8743; gets_es (last esl) &#8712; Post ei)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;es. &#8872; ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre ef, Rely ef, Guar ef, Post ef]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length esl &#8805; 2 &#8743; getspc_es (esl!0) = EvtSys es &#8743; getspc_es (esl!1) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (last esl) = EvtSys es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">c41</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;cpts_es&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">ei</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c01</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;ei&#8712;es&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">c02</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;k. esl!0-es-(EvtEnt ei)&#9839;k&#8594;esl!1&quot;</span><span class="">        
</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;s x ev s1 x1 xs. esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">fst_esys_snd_eseq_exist</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">s</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">ev</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">xs</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class="">
</span><span class="">          </span><span class="string">&quot;esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c02</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;k. (EvtSys es, s, x) -es-(EvtEnt ei)&#9839;k&#8594; (EvtSeq ev (EvtSys es), s1,x1)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(EvtSys es, s, x) -es-(EvtEnt ei)&#9839;k&#8594; (EvtSeq ev (EvtSys es), s1,x1)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;e. ei = BasicEvent e&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">evtent_is_basicevt</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">e</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;ei = BasicEvent e&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?el</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;(ei, s, x) # rm_evtsys ((EvtSeq ev (EvtSys es), s1,x1) # xs)&quot;</span><span class="">    
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="">c6</span><span class=""> </span><span class="">c41</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el &#8712; cpts_ev&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">rm_evtsys_in_cptse</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="">c6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c61</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl!0-es-(EvtEnt ei)&#9839;k&#8594;esl!1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el&#8712;assume_e(Pre ei, Rely ei) &#10230; ?el&#8712;commit_e(Guar ei,Post ei)&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class=""> 
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el&#8712;assume_e(Pre ei, Rely ei)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">c01</span><span class=""> </span><span class="">c6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8872; ei sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre ei, Rely ei, Guar ei, Post ei]&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="">c6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?el&#8712;cpts_of_ev (BasicEvent e) s x&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_ev_def</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;?el&#8712;commit_e(Guar ei,Post ei)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evt_validity_def</span><span class=""> </span><span class="">c6</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="">c41</span><span class=""> </span><span class="">c6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;assume_es(Pre ei, Rely ei) &#10230; esl&#8712;commit_es(Guar ei,Post ei)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">rm_evtsys_assum_comm</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;esl&#8712;assume_es(Pre ei, Rely ei) &#10230; gets_es (last esl) &#8712; Post ei&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class=""> 
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;assume_es(Pre ei, Rely ei)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="">c41</span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="">c6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;e_sim_es esl ?el es e&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">fstent_nomident_e_sim_es2</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="">c41</span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="">c6</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el&#8712;assume_e(Pre ei, Rely ei)&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">e_sim_es_same_assume</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c8</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el&#8712;commit_e(Guar ei,Post ei)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_e (last ?el) = AnonyEvent None&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length ?el = length esl&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">e_sim_es_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. i &gt; 0 &#8743; i &lt; length ?el &#10230; 
                                        (getspc_es (esl!i) = EvtSys es &#8743; getspc_e (?el!i) = AnonyEvent None) 
                                          &#8744; (getspc_es (esl!i) = EvtSeq (getspc_e (?el!i)) (EvtSys es))&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">e_sim_es_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(getspc_es (last esl) = EvtSys es &#8743; getspc_e (last ?el) = AnonyEvent None) 
                                          &#8744; (getspc_es (last esl) = EvtSeq (getspc_e (last ?el)) (EvtSys es))&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">hide_lams</span><span class="delimiter">)</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">last_length</span><span class=""> </span><span class="">length_Cons</span><span class=""> </span><span class="">length_tl</span><span class=""> </span><span class="">lessI</span><span class=""> </span><span class="">list.sel</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">zero_less_Suc</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_e (last ?el) &#8712; Post ei&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">commit_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_e (last ?el) = gets_es (last esl)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">e_sim_es_def</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length ?el = length esl&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">e_sim_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. i &lt; length ?el &#10230; gets_e (?el ! i) = gets_es (esl ! i) &#8743;
                                                            getx_e (?el ! i) = getx_es (esl ! i)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">e_sim_es_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">hide_lams</span><span class="delimiter">)</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">last_length</span><span class=""> 
</span><span class="">                        </span><span class="">length_Cons</span><span class=""> </span><span class="">length_tl</span><span class=""> </span><span class="">lessI</span><span class=""> </span><span class="">list.sel</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;gets_es (last esl) &#8712; Post ei&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(esl&#8712;assume_es(Pre ei,Rely ei) &#10230; esl&#8712;commit_es(Guar ei,Post ei)
                                    &#8743; gets_es (last esl) &#8712; Post ei)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">EventSys_sound_seg_aux0</span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;&#10214;&#8704;ef&#8712;es. &#8872; ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre ef, Rely ef, Guar ef, Post ef];
     esl&#8712;cpts_es;length esl &#8805; 2 &#8743; getspc_es (esl!0) = EvtSys es &#8743; getspc_es (esl!1) &#8800; EvtSys es;
     getspc_es (last esl) = EvtSys es;
     &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es)&#10215;
      &#10233; &#8707;m&#8712;es. (esl&#8712;assume_es(Pre m,Rely m) &#10230; esl&#8712;commit_es(Guar m,Post m)
                                &#8743; gets_es (last esl) &#8712; Post m)
                        &#8743; (&#8707;k. esl!0-es-(EvtEnt m)&#9839;k&#8594;esl!1)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;es. &#8872; ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre ef, Rely ef, Guar ef, Post ef]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length esl &#8805; 2 &#8743; getspc_es (esl!0) = EvtSys es &#8743; getspc_es (esl!1) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (last esl) = EvtSys es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;cpts_es&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;m&#8712;es. (&#8707;k. esl!0-es-(EvtEnt m)&#9839;k&#8594;esl!1)&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">EventSys_sound_seg_aux0_exist</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">esl</span><span class=""> </span><span class="">es</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">m</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m&#8712; es &#8743; (&#8707;k. esl!0-es-(EvtEnt m)&#9839;k&#8594;esl!1)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(esl&#8712;assume_es(Pre m,Rely m) &#10230; esl&#8712;commit_es(Guar m,Post m)
                                &#8743; gets_es (last esl) &#8712; Post m)&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">EventSys_sound_seg_aux0_forall</span><span class=""> </span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="">Pre</span><span class=""> </span><span class="">Rely</span><span class=""> </span><span class="">Guar</span><span class=""> </span><span class="">Post</span><span class=""> </span><span class="">esl</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">EventSys_sound_aux_i_forall</span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;&#10214;&#8704;ef&#8712;es. &#8872; ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre ef, Rely ef, Guar ef, Post ef];
     &#8704;ef&#8712;es. pre &#8838; Pre ef;  &#8704;ef&#8712;es. rely &#8838; Rely ef;
     &#8704;ef&#8712;es. Guar ef &#8838; guar; &#8704;ef&#8712;es. Post ef &#8838; post;
     &#8704;ef1 ef2. ef1&#8712;es &#8743; ef2&#8712;es &#10230; Post ef1 &#8838; Pre ef2;
     esl&#8712;cpts_es; esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs;
     esl&#8712;assume_es(pre,rely);
     elst = tl (parse_es_cpts_i2 esl es [[]])&#10215;
      &#10233; &#8704;i. Suc i &lt; length elst &#10230; 
                (&#8704;ei&#8712;es. (&#8707;k. (elst!i@[(elst!Suc i)!0])!0-es-(EvtEnt ei)&#9839;k&#8594;(elst!i@[(elst!Suc i)!0])!1) 
                                  &#10230; elst!i@[(elst!Suc i)!0]&#8712;commit_es(Guar ei,Post ei)
                                      &#8743; gets_es ((elst!Suc i)!0) &#8712; Post ei)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;es. &#8872; ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre ef, Rely ef, Guar ef, Post ef]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;es. pre &#8838; Pre ef&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;es. rely &#8838; Rely ef&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;es. Guar ef &#8838; guar&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;es. Post ef &#8838; post&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p5</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef1 ef2. ef1&#8712;es &#8743; ef2&#8712;es &#10230; Post ef1 &#8838; Pre ef2&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;cpts_es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p10</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;assume_es(pre,rely)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p11</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;elst = tl (parse_es_cpts_i2 esl es [[]])&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p9</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. i &lt; length elst &#10230; length (elst!i) &#8805; 2 &#8743;
                  getspc_es (elst!i!0) = EvtSys es &#8743; getspc_es (elst!i!1) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">parse_es_cpts_i2_start_aux</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p9</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. i &lt; length elst &#10230; 
                 &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length (elst!i) &#8743; 
                 getspc_es (elst!i!j) = EvtSys es &#8743; getspc_es (elst!i!Suc j) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">parse_es_cpts_i2_noent_mid</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p9</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;concat elst = esl&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">parse_es_cpts_i2_concat3</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length elst&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;ei&#8712;es. (&#8707;k. (elst!i@[(elst!Suc i)!0])!0-es-(EvtEnt ei)&#9839;k&#8594;(elst!i@[(elst!Suc i)!0])!1) 
                                  &#10230; elst!i@[(elst!Suc i)!0]&#8712;commit_es(Guar ei,Post ei)
                                      &#8743; gets_es ((elst!Suc i)!0) &#8712; Post ei&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">i</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">0</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc 0 &lt; length elst&quot;</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?els</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;elst ! 0 @ [elst ! Suc 0 ! 0]&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?els &#8712; cpts_es&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c11</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i&lt;length elst. elst ! i &#8800; []&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">list.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">not_numeral_le_zero</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;m n. m &#8804; length esl &#8743; n &#8804; length esl &#8743; m &#8804; n &#8743; ?els = take (n - m) (drop m esl)&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">concat_i_lm</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">m</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">n</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m &#8804; length esl &#8743; n &#8804; length esl &#8743; m &#8804; n 
                          &#8743; ?els = take (n - m) (drop m esl)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?els &#8800; []&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">cpts_es_seg2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (last ?els) = EvtSys es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">c0</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length ?els &#8743; getspc_es (?els!j) = EvtSys es 
                  &#8743; getspc_es (?els!Suc j) &#8800; EvtSys es)&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (elst ! Suc 0 ! 0) = EvtSys es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_leI</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> 
</span><span class="">                      </span><span class="">Suc_lessE</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">diff_Suc_1</span><span class=""> </span><span class="">diff_is_0_eq&#39;</span><span class=""> </span><span class="">length_append_singleton</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">nth_append</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;2 &#8804; length ?els &#8743; getspc_es (?els ! 0) = EvtSys es &#8743; getspc_es (?els ! 1) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">hide_lams</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_1</span><span class=""> </span><span class="">Suc_eq_plus1_left</span><span class=""> </span><span class="">Suc_le_lessD</span><span class=""> 
</span><span class="">                      </span><span class="">Suc_lessD</span><span class=""> </span><span class="">add.right_neutral</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">length_append_singleton</span><span class=""> </span><span class="">not_less</span><span class=""> </span><span class="">nth_append</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ei&#8712;es. (&#8707;k. ?els!0-es-(EvtEnt ei)&#9839;k&#8594;?els!1) 
                              &#10230; (?els&#8712;assume_es(Pre ei,Rely ei) &#10230; ?els&#8712;commit_es(Guar ei,Post ei)
                                    &#8743; gets_es (last ?els) &#8712; Post ei)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">EventSys_sound_seg_aux0_forall</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="">Pre</span><span class=""> </span><span class="">Rely</span><span class=""> </span><span class="">Guar</span><span class=""> </span><span class="">Post</span><span class=""> </span><span class="var">?els</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p10</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?els&#8712;assume_es(pre,rely)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i&lt;length elst. elst ! i &#8800; []&quot;</span><span class=""> 
</span><span class="">                      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">list.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">not_numeral_le_zero</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;m n. m &#8804; length esl &#8743; n &#8804; length esl &#8743; m &#8804; n &#8743; ?els = take (n - m) (drop m esl)&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">concat_i_lm</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p10</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length esl &#10230; esl!i -ese&#8594; esl!(Suc i) &#10230; 
                        (gets_es (esl!i), gets_es (esl!Suc i)) &#8712; rely&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length ?els &#10230; ?els!i -ese&#8594; ?els!(Suc i) &#10230; 
                        (gets_es (?els!i), gets_es (?els!Suc i)) &#8712; rely&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">rely_takedrop_rely</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_es (?els!0) &#8712; pre&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?els!0 = esl!0&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">d1</span><span class=""> 
</span><span class="">                              </span><span class="">c0</span><span class=""> </span><span class="">concat.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">cpts_es_not_empty</span><span class=""> </span><span class="">hd_append2</span><span class=""> 
</span><span class="">                              </span><span class="">length_greater_0_conv</span><span class=""> </span><span class="">list.collapse</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">snoc_eq_iff_butlast</span><span class="delimiter">)</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p10</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_es (esl!0) &#8712; pre&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;ei&#8712;es. ?els&#8712;assume_es(Pre ei, Rely ei)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assume_es_imp</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Suc</span><span class=""> </span><span class="">j</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?elstjj</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;elst ! j @ [elst ! Suc j ! 0]&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?els</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;elst ! Suc j @ [elst ! Suc (Suc j) ! 0]&quot;</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c01</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc j &lt; length elst 
                            &#10233; &#8704;ei&#8712;es. (&#8707;k. ?elstjj ! 0 -es-EvtEnt ei&#9839;k&#8594; ?elstjj ! 1) &#10230;
                             ?elstjj &#8712; commit_es (Guar ei, Post ei) &#8743; gets_es (elst ! Suc j ! 0) &#8712; Post ei&quot;</span><span class="">
</span><span class="">                 </span><span class="keyword2"><span class="keyword">and</span></span><span class="">   </span><span class="">c02</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc (Suc j) &lt; length elst&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class="">-</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">ei</span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;ei&#8712;es&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;k. ?els ! 0 -es-EvtEnt ei&#9839;k&#8594; ?els ! 1&quot;</span><span class="">
</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c02</span><span class=""> </span><span class="">a0</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">j</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;m&#8712;es. (&#8707;k. ?elstjj!0-es-(EvtEnt m)&#9839;k&#8594;?elstjj!1)&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">EventSys_sound_seg_aux0_exist</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?elstjj</span><span class=""> </span><span class="">es</span><span class="delimiter">]</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">p9</span><span class=""> </span><span class="">p11</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_1</span><span class=""> </span><span class="">Suc_le_lessD</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">le_SucI</span><span class=""> </span><span class="">length_append_singleton</span><span class=""> 
</span><span class="">                          </span><span class="">nth_append</span><span class=""> </span><span class="">parse_es_cpts_i2_in_cptes_i</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">ei&#39;</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c03</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;ei&#39;&#8712;es &#8743; (&#8707;k. ?elstjj!0-es-(EvtEnt ei&#39;)&#9839;k&#8594;?elstjj!1)&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c01</span><span class=""> </span><span class="">c02</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c04</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?elstjj &#8712; commit_es (Guar ei&#39;, Post ei&#39;) 
                                        &#8743; gets_es (elst ! Suc j ! 0) &#8712; Post ei&#39;&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    
</span><span class="">                    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?els &#8712; cpts_es&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c11</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i&lt;length elst. elst ! i &#8800; []&quot;</span><span class=""> 
</span><span class="">                          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">list.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">not_numeral_le_zero</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">c02</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;m n. m &#8804; length esl &#8743; n &#8804; length esl &#8743; m &#8804; n &#8743; ?els = take (n - m) (drop m esl)&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">concat_i_lm</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">m</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">n</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m &#8804; length esl &#8743; n &#8804; length esl &#8743; m &#8804; n 
                              &#8743; ?els = take (n - m) (drop m esl)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?els &#8800; []&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">cpts_es_seg2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                    
</span><span class="">                    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (last ?els) = EvtSys es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">c02</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length ?els &#8743; getspc_es (?els!j) = EvtSys es 
                      &#8743; getspc_es (?els!Suc j) &#8800; EvtSys es)&quot;</span><span class=""> 
</span><span class="">                      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (elst ! Suc (Suc j) ! 0) = EvtSys es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">c02</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_leI</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> 
</span><span class="">                          </span><span class="">Suc_lessE</span><span class=""> </span><span class="">c02</span><span class=""> </span><span class="">diff_Suc_1</span><span class=""> </span><span class="">diff_is_0_eq&#39;</span><span class=""> </span><span class="">length_append_singleton</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">nth_append</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;2 &#8804; length ?els &#8743; getspc_es (?els ! 0) = EvtSys es &#8743; getspc_es (?els ! 1) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">hide_lams</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_1</span><span class=""> </span><span class="">Suc_eq_plus1_left</span><span class=""> </span><span class="">Suc_le_lessD</span><span class=""> 
</span><span class="">                          </span><span class="">Suc_lessD</span><span class=""> </span><span class="">add.right_neutral</span><span class=""> </span><span class="">c02</span><span class=""> </span><span class="">length_append_singleton</span><span class=""> </span><span class="">not_less</span><span class=""> </span><span class="">nth_append</span><span class="delimiter">)</span><span class="">
</span><span class="">        
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(?els&#8712;assume_es(Pre ei,Rely ei) &#10230; ?els&#8712;commit_es(Guar ei,Post ei)
                                &#8743; gets_es (last ?els) &#8712; Post ei)&quot;</span><span class=""> 
</span><span class="">                      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">EventSys_sound_seg_aux0_forall</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="">Pre</span><span class=""> </span><span class="">Rely</span><span class=""> </span><span class="">Guar</span><span class=""> </span><span class="">Post</span><span class=""> </span><span class="var">?els</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p10</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?els&#8712;assume_es(Pre ei,rely)&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i&lt;length elst. elst ! i &#8800; []&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">list.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">not_numeral_le_zero</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">c02</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;m n. m &#8804; length esl &#8743; n &#8804; length esl &#8743; m &#8804; n &#8743; ?els = take (n - m) (drop m esl)&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">concat_i_lm</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p10</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length esl &#10230; esl!i -ese&#8594; esl!(Suc i) &#10230; 
                            (gets_es (esl!i), gets_es (esl!Suc i)) &#8712; rely&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length ?els &#10230; ?els!i -ese&#8594; ?els!(Suc i) &#10230; 
                            (gets_es (?els!i), gets_es (?els!Suc i)) &#8712; rely&quot;</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">rely_takedrop_rely</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_es (?els!0) &#8712; Pre ei&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p5</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">ei&#39;</span><span class=""> </span><span class="">ei</span><span class="delimiter">]</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">c03</span><span class=""> </span><span class="">c04</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_es (elst ! Suc j ! 0) &#8712; Pre ei&quot;</span><span class="">
</span><span class="">                               </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">                            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">c02</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">nth_append</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">        
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?els&#8712;assume_es(Pre ei, Rely ei)&quot;</span><span class=""> 
</span><span class="">                      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assume_es_imp</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;Pre ei&quot;</span><span class=""> </span><span class="string">&quot;Pre ei&quot;</span><span class=""> </span><span class="">rely</span><span class=""> </span><span class="string">&quot;Rely ei&quot;</span><span class="delimiter">]</span><span class="">
</span><span class="">                       </span><span class="">d0</span><span class=""> </span><span class="">order_refl</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                      
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?els&#8712;commit_es(Guar ei,Post ei) &#8743; gets_es (last ?els) &#8712; Post ei&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">EventSys_sound_aux_i</span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;&#10214;&#8704;ef&#8712;es. &#8872; ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre ef, Rely ef, Guar ef, Post ef];
     &#8704;ef&#8712;es. pre &#8838; Pre ef;  &#8704;ef&#8712;es. rely &#8838; Rely ef;
     &#8704;ef&#8712;es. Guar ef &#8838; guar; &#8704;ef&#8712;es. Post ef &#8838; post;
     &#8704;ef1 ef2. ef1&#8712;es &#8743; ef2&#8712;es &#10230; Post ef1 &#8838; Pre ef2;
     esl&#8712;cpts_es; esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs;
     esl&#8712;assume_es(pre,rely);
     elst = tl (parse_es_cpts_i2 esl es [[]])&#10215;
      &#10233; &#8704;i. Suc i &lt; length elst &#10230; 
                (&#8707;m&#8712;es. elst!i@[(elst!Suc i)!0]&#8712;commit_es(Guar m,Post m)
                                &#8743; gets_es ((elst!Suc i)!0) &#8712; Post m
                &#8743; (&#8707;k. (elst!i@[(elst!Suc i)!0])!0-es-(EvtEnt m)&#9839;k&#8594;(elst!i@[(elst!Suc i)!0])!1))&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;es. &#8872; ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre ef, Rely ef, Guar ef, Post ef]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;es. pre &#8838; Pre ef&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;es. rely &#8838; Rely ef&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;es. Guar ef &#8838; guar&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;es. Post ef &#8838; post&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef1 ef2. ef1&#8712;es &#8743; ef2&#8712;es &#10230; Post ef1 &#8838; Pre ef2&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;cpts_es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p10</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;assume_es(pre,rely)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p11</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;elst = tl (parse_es_cpts_i2 esl es [[]])&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p9</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. i &lt; length elst &#10230; length (elst!i) &#8805; 2 &#8743;
                  getspc_es (elst!i!0) = EvtSys es &#8743; getspc_es (elst!i!1) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">parse_es_cpts_i2_start_aux</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p9</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. i &lt; length elst &#10230; 
                 &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length (elst!i) &#8743; 
                 getspc_es (elst!i!j) = EvtSys es &#8743; getspc_es (elst!i!Suc j) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">parse_es_cpts_i2_noent_mid</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p9</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;concat elst = esl&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">parse_es_cpts_i2_concat3</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length elst&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">i</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;m&#8712;es. (&#8707;k. elst!i!0-es-(EvtEnt m)&#9839;k&#8594;elst!i!1)&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">EventSys_sound_seg_aux0_exist</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;elst!i@[(elst!Suc i)!0]&quot;</span><span class=""> </span><span class="">es</span><span class="delimiter">]</span><span class=""> 
</span><span class="">            </span><span class="">parse_es_cpts_i2_in_cptes_i</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">esl</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">xs</span><span class=""> </span><span class="">elst</span><span class="delimiter">]</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Suc_1</span><span class=""> </span><span class="">Suc_le_lessD</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">le_SucI</span><span class=""> </span><span class="">length_append_singleton</span><span class=""> 
</span><span class="">              </span><span class="">length_greater_0_conv</span><span class=""> </span><span class="">list.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">not_numeral_le_zero</span><span class=""> </span><span class="">nth_append</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">p9</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">m</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m&#8712;es &#8743; (&#8707;k. elst!i!0-es-(EvtEnt m)&#9839;k&#8594;elst!i!1)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">p9</span><span class=""> </span><span class="">p10</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">b0</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b2</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &lt; length elst &#10230; (&#8704;ei&#8712;es.
            (&#8707;k. (elst ! i @ [elst ! Suc i ! 0]) ! 0 -es-EvtEnt ei&#9839;k&#8594; (elst ! i @ [elst ! Suc i ! 0]) ! 1) &#10230;
            elst ! i @ [elst ! Suc i ! 0] &#8712; commit_es (Guar ei, Post ei) &#8743; gets_es (elst ! Suc i ! 0) &#8712; Post ei)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">EventSys_sound_aux_i_forall</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="">Pre</span><span class=""> </span><span class="">Rely</span><span class=""> </span><span class="">Guar</span><span class=""> </span><span class="">Post</span><span class=""> </span><span class="">pre</span><span class=""> </span><span class="">rely</span><span class=""> </span><span class="">guar</span><span class=""> </span><span class="">post</span><span class=""> </span><span class="">esl</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">xs</span><span class=""> </span><span class="">elst</span><span class="delimiter">]</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b2</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">i</span><span class=""> </span><span class="">m</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;elst!i@[(elst!Suc i)!0]&#8712;commit_es(Guar m,Post m)
                 &#8743; gets_es ((elst!Suc i)!0) &#8712; Post m&quot;</span><span class="">
</span><span class="">           </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_1</span><span class=""> </span><span class="">Suc_le_lessD</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">length_greater_0_conv</span><span class=""> 
</span><span class="">              </span><span class="">list.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">not_numeral_le_zero</span><span class=""> </span><span class="">nth_append</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;m&#8712;es. elst!i@[(elst!Suc i)!0]&#8712;commit_es(Guar m,Post m)
                  &#8743; gets_es ((elst!Suc i)!0) &#8712; Post m 
                  &#8743; (&#8707;k. (elst!i@[(elst!Suc i)!0])!0-es-(EvtEnt m)&#9839;k&#8594;(elst!i@[(elst!Suc i)!0])!1)&quot;</span><span class="">
</span><span class="">           </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">lessI</span><span class=""> </span><span class="">less_le_trans</span><span class=""> </span><span class="">nth_append</span><span class=""> </span><span class="">numeral_2_eq_2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">EventSys_sound_aux_last_forall</span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;&#10214;&#8704;ef&#8712;es. &#8872; ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre ef, Rely ef, Guar ef, Post ef];
     &#8704;ef&#8712;es. pre &#8838; Pre ef;  &#8704;ef&#8712;es. rely &#8838; Rely ef;
     &#8704;ef&#8712;es. Guar ef &#8838; guar; &#8704;ef&#8712;es. Post ef &#8838; post;
     &#8704;ef1 ef2. ef1&#8712;es &#8743; ef2&#8712;es &#10230; Post ef1 &#8838; Pre ef2;
     esl&#8712;cpts_es; esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs;
     esl&#8712;assume_es(pre,rely);
     elst = tl (parse_es_cpts_i2 esl es [[]])&#10215;
      &#10233; &#8704;ei&#8712;es. (&#8707;k. (last elst)!0-es-(EvtEnt ei)&#9839;k&#8594;(last elst)!1) 
                           &#10230; last elst&#8712;commit_es(Guar ei,Post ei)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;es. &#8872; ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre ef, Rely ef, Guar ef, Post ef]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;es. pre &#8838; Pre ef&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;es. rely &#8838; Rely ef&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;es. Guar ef &#8838; guar&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;es. Post ef &#8838; post&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef1 ef2. ef1&#8712;es &#8743; ef2&#8712;es &#10230; Post ef1 &#8838; Pre ef2&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;cpts_es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p10</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;assume_es(pre,rely)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p11</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;elst = tl (parse_es_cpts_i2 esl es [[]])&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p9</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. i &lt; length elst &#10230; length (elst!i) &#8805; 2 &#8743;
                  getspc_es (elst!i!0) = EvtSys es &#8743; getspc_es (elst!i!1) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">parse_es_cpts_i2_start_aux</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p9</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. i &lt; length elst &#10230; 
                 &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length (elst!i) &#8743; 
                 getspc_es (elst!i!j) = EvtSys es &#8743; getspc_es (elst!i!Suc j) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">parse_es_cpts_i2_noent_mid</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p9</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;concat elst = esl&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">parse_es_cpts_i2_concat3</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p9</span><span class="">  </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;elst &#8800; []&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">ei</span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a01</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;ei&#8712;es&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a02</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;k. (last elst)!0-es-(EvtEnt ei)&#9839;k&#8594;(last elst)!1&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;last elst&#8712;commit_es(Guar ei,Post ei)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;length elst = 1&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length elst = 1&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;last elst = esl&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">append_butlast_last_id</span><span class=""> </span><span class="">append_self_conv2</span><span class=""> </span><span class="">concat.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">concat.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">diff_Suc_1</span><span class=""> </span><span class="">length_0_conv</span><span class=""> </span><span class="">length_butlast</span><span class=""> </span><span class="">self_append_conv</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?els</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;elst ! 0&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?els &#8712; cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">last_conv_nth</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">        
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length ?els &#8743; getspc_es (?els!j) = EvtSys es 
          &#8743; getspc_es (?els!Suc j) &#8800; EvtSys es)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;2 &#8804; length ?els &#8743; getspc_es (?els ! 0) = EvtSys es &#8743; getspc_es (?els ! 1) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;m&#8712;es. (&#8707;k. ?els!0-es-(EvtEnt m)&#9839;k&#8594;?els!1) 
                          &#10230; (?els&#8712;assume_es(Pre m,Rely m) &#10230; ?els&#8712;commit_es(Guar m,Post m))&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">EventSys_sound_aux1_forall</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="">Pre</span><span class=""> </span><span class="">Rely</span><span class=""> </span><span class="">Guar</span><span class=""> </span><span class="">Post</span><span class=""> </span><span class="var">?els</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p10</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?els&#8712;assume_es(pre,rely)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">            
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;m n. m &#8804; length esl &#8743; last elst = (drop m esl)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">concat_last_lm</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p10</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length esl &#10230; esl!i -ese&#8594; esl!(Suc i) &#10230; 
                (gets_es (esl!i), gets_es (esl!Suc i)) &#8712; rely&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length ?els &#10230; ?els!i -ese&#8594; ?els!(Suc i) &#10230; 
                (gets_es (?els!i), gets_es (?els!Suc i)) &#8712; rely&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">last_conv_nth</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_es (?els!0) &#8712; pre&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?els!0 = esl!0&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">last_conv_nth</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p10</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_es (esl!0) &#8712; pre&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">a01</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?els&#8712;assume_es(Pre ei, Rely ei)&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assume_es_imp</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">pre</span><span class=""> </span><span class="string">&quot;Pre ei&quot;</span><span class=""> </span><span class="">rely</span><span class=""> </span><span class="string">&quot;Rely ei&quot;</span><span class=""> </span><span class="string">&quot;elst ! 0&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a01</span><span class=""> </span><span class="">a02</span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?els&#8712;commit_es(Guar ei,Post ei)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">last_conv_nth</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">last_conv_nth</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">diff_Suc_1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;length elst &#8800; 1&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length elst &gt; 1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Suc_lessI</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?els</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;last elst&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?els &#8712; cpts_es&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;m . m &#8804; length esl &#8743; ?els = drop m esl&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">concat_last_lm</span><span class=""> </span><span class="">a3</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">m</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m &#8804; length esl &#8743; ?els = drop m esl&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;m &lt; length esl&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">diff_less</span><span class=""> </span><span class="">drop_all</span><span class=""> </span><span class="">last_conv_nth</span><span class=""> </span><span class="">le_less_linear</span><span class=""> 
</span><span class="">                  </span><span class="">length_greater_0_conv</span><span class=""> </span><span class="">list.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">not_less_eq</span><span class=""> </span><span class="">not_numeral_le_zero</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_es_dropi</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">drop_0</span><span class=""> </span><span class="">le_0_eq</span><span class=""> </span><span class="">le_SucE</span><span class=""> </span><span class="">zero_induct</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length ?els &#8743; getspc_es (?els!j) = EvtSys es 
          &#8743; getspc_es (?els!Suc j) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">diff_less</span><span class=""> </span><span class="">last_conv_nth</span><span class=""> </span><span class="">zero_less_one</span><span class="delimiter">)</span><span class="">  
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;2 &#8804; length ?els &#8743; getspc_es (?els ! 0) = EvtSys es &#8743; getspc_es (?els ! 1) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">last_conv_nth</span><span class="delimiter">)</span><span class="">
</span><span class="">          
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;m&#8712;es. (&#8707;k. ?els!0-es-(EvtEnt m)&#9839;k&#8594;?els!1) 
                          &#10230; (?els&#8712;assume_es(Pre m,Rely m) &#10230; ?els&#8712;commit_es(Guar m,Post m))&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">EventSys_sound_aux1_forall</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="">Pre</span><span class=""> </span><span class="">Rely</span><span class=""> </span><span class="">Guar</span><span class=""> </span><span class="">Post</span><span class=""> </span><span class="var">?els</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p10</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?els&#8712;assume_es(Pre ei,rely)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;m . m &#8804; length esl &#8743; ?els = drop m esl&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">concat_last_lm</span><span class=""> </span><span class="">a3</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p10</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length esl &#10230; esl!i -ese&#8594; esl!(Suc i) &#10230; 
                (gets_es (esl!i), gets_es (esl!Suc i)) &#8712; rely&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length ?els &#10230; ?els!i -ese&#8594; ?els!(Suc i) &#10230; 
                (gets_es (?els!i), gets_es (?els!Suc i)) &#8712; rely&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">last_conv_nth</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_es (?els!0) &#8712; Pre ei&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">p9</span><span class=""> </span><span class="">p10</span><span class=""> </span><span class="">p11</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &lt; length elst &#10230; 
                (&#8704;ei&#8712;es. (&#8707;k. (elst!i@[(elst!Suc i)!0])!0-es-(EvtEnt ei)&#9839;k&#8594;(elst!i@[(elst!Suc i)!0])!1) 
                                  &#10230; elst!i@[(elst!Suc i)!0]&#8712;commit_es(Guar ei,Post ei)
                                      &#8743; gets_es ((elst!Suc i)!0) &#8712; Post ei)&quot;</span><span class=""> 
</span><span class="">                   </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">EventSys_sound_aux_i_forall</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="">Pre</span><span class=""> </span><span class="">Rely</span><span class=""> </span><span class="">Guar</span><span class=""> </span><span class="">Post</span><span class=""> </span><span class="">pre</span><span class=""> </span><span class="">rely</span><span class=""> </span><span class="">guar</span><span class=""> 
</span><span class="">                          </span><span class="">post</span><span class=""> </span><span class="">esl</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">xs</span><span class=""> </span><span class="">elst</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?els1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;elst!(length elst - 2)@[(elst!(length elst - 1))!0]&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?els1 &#8712; cpts_es&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c11</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i&lt;length elst. elst ! i &#8800; []&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">list.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">not_numeral_le_zero</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;m n. m &#8804; length esl &#8743; n &#8804; length esl &#8743; m &#8804; n &#8743; ?els1 = take (n - m) (drop m esl)&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">concat_i_lm</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">elst</span><span class=""> </span><span class="">esl</span><span class=""> </span><span class="string">&quot;length elst - 2&quot;</span><span class="delimiter">]</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_1</span><span class=""> </span><span class="">Suc_diff_1</span><span class=""> 
</span><span class="">                            </span><span class="">Suc_diff_Suc</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">length_greater_0_conv</span><span class=""> </span><span class="">lessI</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">m</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">n</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m &#8804; length esl &#8743; n &#8804; length esl &#8743; m &#8804; n 
                          &#8743; ?els1 = take (n - m) (drop m esl)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?els1 &#8800; []&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">cpts_es_seg2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;length ?els1 &gt; 2&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;length elst - 2&quot;</span><span class="delimiter">]</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">a3</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (?els1 ! 0) = EvtSys es &#8743; getspc_es (?els1 ! 1) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;length elst - 2&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">One_nat_def</span><span class=""> 
</span><span class="">                      </span><span class="">Suc_lessD</span><span class=""> </span><span class="">Suc_less_SucD</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">calculation</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">diff_less</span><span class=""> 
</span><span class="">                      </span><span class="">length_append_singleton</span><span class=""> </span><span class="">nth_append</span><span class=""> </span><span class="">numeral_2_eq_2</span><span class=""> </span><span class="">zero_less_numeral</span><span class="delimiter">)</span><span class="">  
</span><span class="">                </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;m&#8712;es. (&#8707;k. ?els1!0-es-(EvtEnt m)&#9839;k&#8594;?els1!1)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">EventSys_sound_seg_aux0_exist</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?els1</span><span class=""> </span><span class="">es</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">m</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m&#8712;es &#8743; (&#8707;k. ?els1!0-es-(EvtEnt m)&#9839;k&#8594;?els1!1)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_es (elst ! (length elst - 1) ! 0) &#8712; Post m&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;length elst - 2&quot;</span><span class=""> </span><span class="">m</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">One_nat_def</span><span class=""> 
</span><span class="">                    </span><span class="">Suc_diff_Suc</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">diff_less</span><span class=""> </span><span class="">le_imp_less_Suc</span><span class=""> </span><span class="">le_numeral_extra</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">numeral_2_eq_2</span><span class="delimiter">)</span><span class="">
</span><span class="">              
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_es (last elst ! 0) &#8712; Post m&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">last_conv_nth</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">a01</span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;rely &#8838; Rely ei&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">a01</span><span class="delimiter">)</span><span class="">  
</span><span class="">        </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?els&#8712;assume_es(Pre ei, Rely ei)&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assume_es_imp</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?els&#8712;commit_es(Guar ei,Post ei)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a01</span><span class=""> </span><span class="">a02</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">        
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">last_conv_nth</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">EventSys_sound_aux_last</span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;&#10214;&#8704;ef&#8712;es. &#8872; ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre ef, Rely ef, Guar ef, Post ef];
     &#8704;ef&#8712;es. pre &#8838; Pre ef;  &#8704;ef&#8712;es. rely &#8838; Rely ef;
     &#8704;ef&#8712;es. Guar ef &#8838; guar; &#8704;ef&#8712;es. Post ef &#8838; post;
     &#8704;ef1 ef2. ef1&#8712;es &#8743; ef2&#8712;es &#10230; Post ef1 &#8838; Pre ef2;
     esl&#8712;cpts_es; esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs;
     esl&#8712;assume_es(pre,rely);
     elst = tl (parse_es_cpts_i2 esl es [[]])&#10215;
      &#10233; &#8707;m&#8712;es. last elst&#8712;commit_es(Guar m,Post m) 
                        &#8743; (&#8707;k. (last elst)!0-es-(EvtEnt m)&#9839;k&#8594;(last elst)!1)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class="">  </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;es. &#8872; ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre ef, Rely ef, Guar ef, Post ef]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;es. pre &#8838; Pre ef&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;es. rely &#8838; Rely ef&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;es. Guar ef &#8838; guar&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;es. Post ef &#8838; post&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef1 ef2. ef1&#8712;es &#8743; ef2&#8712;es &#10230; Post ef1 &#8838; Pre ef2&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;cpts_es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p10</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;assume_es(pre,rely)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p11</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;elst = tl (parse_es_cpts_i2 esl es [[]])&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p9</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. i &lt; length elst &#10230; length (elst!i) &#8805; 2 &#8743;
                  getspc_es (elst!i!0) = EvtSys es &#8743; getspc_es (elst!i!1) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">parse_es_cpts_i2_start_aux</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p9</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. i &lt; length elst &#10230; 
                 &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length (elst!i) &#8743; 
                 getspc_es (elst!i!j) = EvtSys es &#8743; getspc_es (elst!i!Suc j) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">parse_es_cpts_i2_noent_mid</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p9</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;concat elst = esl&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">parse_es_cpts_i2_concat3</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p9</span><span class="">  </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;elst &#8800; []&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">p9</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">a0</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;length elst - 1&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;m&#8712;es. (&#8707;k. last elst!0-es-(EvtEnt m)&#9839;k&#8594;last elst!1)&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">EventSys_sound_seg_aux0_exist</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;last elst&quot;</span><span class=""> </span><span class="">es</span><span class="delimiter">]</span><span class=""> 
</span><span class="">        </span><span class="">parse_es_cpts_i2_in_cptes_last</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">esl</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">xs</span><span class=""> </span><span class="">elst</span><span class="delimiter">]</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">diff_less</span><span class=""> </span><span class="">last_conv_nth</span><span class=""> </span><span class="">length_greater_0_conv</span><span class=""> </span><span class="">less_one</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">m</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m&#8712;es &#8743; (&#8707;k. last elst!0-es-(EvtEnt m)&#9839;k&#8594;last elst!1)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">p9</span><span class=""> </span><span class="">p10</span><span class=""> </span><span class="">p11</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;last elst&#8712;commit_es(Guar m,Post m)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">EventSys_sound_aux_last_forall</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="">Pre</span><span class=""> </span><span class="">Rely</span><span class=""> </span><span class="">Guar</span><span class=""> </span><span class="">Post</span><span class=""> </span><span class="">pre</span><span class=""> 
</span><span class="">        </span><span class="">rely</span><span class=""> </span><span class="">guar</span><span class=""> </span><span class="">post</span><span class=""> </span><span class="">esl</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">xs</span><span class=""> </span><span class="">elst</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">EventSys_sound_0</span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;&#10214;&#8704;ef&#8712;es. &#8872; ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre ef, Rely ef, Guar ef, Post ef];
     &#8704;ef&#8712;es. pre &#8838; Pre ef;  &#8704;ef&#8712;es. rely &#8838; Rely ef;
     &#8704;ef&#8712;es. Guar ef &#8838; guar; &#8704;ef&#8712;es. Post ef &#8838; post;
     &#8704;ef1 ef2. ef1&#8712;es &#8743; ef2&#8712;es &#10230; Post ef1 &#8838; Pre ef2;
     stable pre rely; &#8704;s. (s, s)&#8712;guar;
     esl&#8712;cpts_es; esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs;
     esl&#8712;assume_es(pre,rely)&#10215;
      &#10233; &#8704;i. Suc i&lt;length esl &#10230; (&#8707;t. esl!i -es-t&#8594; esl!(Suc i)) &#10230; 
                          (gets_es (esl!i), gets_es (esl!Suc i)) &#8712; guar&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;es. &#8872; ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre ef, Rely ef, Guar ef, Post ef]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;es. pre &#8838; Pre ef&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;es. rely &#8838; Rely ef&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;es. Guar ef &#8838; guar&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;es. Post ef &#8838; post&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef1 ef2. ef1&#8712;es &#8743; ef2&#8712;es &#10230; Post ef1 &#8838; Pre ef2&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;stable pre rely&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;s. (s, s)&#8712;guar&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;cpts_es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p10</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;assume_es(pre,rely)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?elst</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;tl (parse_es_cpts_i2 esl es [[]])&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p9</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;concat ?elst = esl&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">parse_es_cpts_i2_concat3</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class="">  
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p9</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. i &lt; length ?elst &#10230; length (?elst!i) &#8805; 2 &#8743;
                  getspc_es (?elst!i!0) = EvtSys es &#8743; getspc_es (?elst!i!1) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">parse_es_cpts_i2_start_aux</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">p9</span><span class=""> </span><span class="">p10</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &lt; length ?elst &#10230; 
                (&#8707;m&#8712;es. ?elst!i@[(?elst!Suc i)!0]&#8712;commit_es(Guar m,Post m)
                                &#8743; gets_es ((?elst!Suc i)!0) &#8712; Post m)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">EventSys_sound_aux_i</span><span class=""> 
</span><span class="">        </span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="">Pre</span><span class=""> </span><span class="">Rely</span><span class=""> </span><span class="">Guar</span><span class=""> </span><span class="">Post</span><span class=""> </span><span class="">pre</span><span class=""> </span><span class="">rely</span><span class=""> </span><span class="">guar</span><span class=""> </span><span class="">post</span><span class=""> </span><span class="">esl</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">xs</span><span class=""> </span><span class="var">?elst</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &lt; length ?elst &#10230; 
                (&#8707;m&#8712;es. ?elst!i@[(?elst!Suc i)!0]&#8712;commit_es(Guar m,Post m))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">p9</span><span class=""> </span><span class="">p10</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;m&#8712;es. last ?elst&#8712;commit_es(Guar m,Post m)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">EventSys_sound_aux_last</span><span class="">
</span><span class="">        </span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="">Pre</span><span class=""> </span><span class="">Rely</span><span class=""> </span><span class="">Guar</span><span class=""> </span><span class="">Post</span><span class=""> </span><span class="">pre</span><span class=""> </span><span class="">rely</span><span class=""> </span><span class="">guar</span><span class=""> </span><span class="">post</span><span class=""> </span><span class="">esl</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">xs</span><span class=""> </span><span class="var">?elst</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">m</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m&#8712;es &#8743; last ?elst&#8712;commit_es(Guar m,Post m)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length esl&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;t. esl ! i -es-t&#8594; esl ! Suc i&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p9</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b01</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl &#8800; []&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i&lt;length ?elst. length (?elst!i) &#8805; 2&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;k j. k &lt; length ?elst &#8743; j &#8804; length (?elst!k) &#8743; 
                  drop i esl = (drop j (?elst!k)) @ concat (drop (Suc k) ?elst)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">concat_equiv</span><span class=""> </span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">esl</span><span class=""> </span><span class="var">?elst</span><span class="delimiter">]</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">j</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;k &lt; length ?elst &#8743; j &#8804; length (?elst!k) &#8743; 
                  drop i esl = (drop j (?elst!k)) @ concat (drop (Suc k) ?elst)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_es (esl!i), gets_es (esl!Suc i)) &#8712; guar&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;k = length ?elst - 1&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;k = length ?elst - 1&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;drop i esl = drop j (last ?elst)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Nitpick.size_list_simp</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_leI</span><span class=""> </span><span class="">b01</span><span class=""> 
</span><span class="">                  </span><span class="">a0</span><span class=""> </span><span class="">concat.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">drop_all</span><span class=""> </span><span class="">last_conv_nth</span><span class=""> </span><span class="">length_tl</span><span class=""> </span><span class="">self_append_conv</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b01</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;drop j (last ?elst) &#8800; []&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j &lt; length (last ?elst)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl ! i = (last ?elst) ! j&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">hd_drop_conv_nth</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl ! Suc i = (last ?elst) ! Suc j&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Cons_nth_drop_Suc</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">list.sel</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">nth_via_drop</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length (last ?elst) &#10230; (&#8707;t. (last ?elst)!i -es-t&#8594; (last ?elst)!(Suc i)) 
                  &#10230; (gets_es ((last ?elst)!i), gets_es ((last ?elst)!Suc i)) &#8712; Guar m&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">commit_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_es (esl ! i), gets_es (esl ! Suc i)) &#8712; Guar m&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Cons_nth_drop_Suc</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">length_drop</span><span class=""> </span><span class="">list.sel</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">zero_less_diff</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c00</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;k &#8800; length ?elst - 1&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;k &lt; length ?elst - 1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;j = length (?elst!k)&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j = length (?elst!k)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;drop i esl = concat (drop (Suc k) ?elst)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length (?elst ! (Suc k)) &#8805; 2&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;concat (drop (Suc k) ?elst) = ?elst ! (Suc k) @ concat (drop (Suc (Suc k)) ?elst)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">hide_lams</span><span class="delimiter">)</span><span class=""> </span><span class="">Cons_nth_drop_Suc</span><span class=""> </span><span class="">List.nth_tl</span><span class=""> </span><span class="">concat.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">drop_Suc</span><span class=""> </span><span class="">length_tl</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;drop i esl = ?elst ! (Suc k) @ concat (drop (Suc (Suc k)) ?elst)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl ! i = ?elst ! (Suc k) ! 0&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">hide_lams</span><span class="delimiter">)</span><span class=""> </span><span class="">Cons_nth_drop_Suc</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_1</span><span class=""> 
</span><span class="">                      </span><span class="">less_or_eq_imp_le</span><span class=""> </span><span class="">not_less</span><span class=""> </span><span class="">not_less_eq_eq</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">nth_append</span><span class="delimiter">)</span><span class="">
</span><span class="">                  
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="">d3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl ! Suc i = ?elst ! (Suc k) ! 1&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">hide_lams</span><span class="delimiter">)</span><span class=""> </span><span class="">Cons_nth_drop_Suc</span><span class=""> </span><span class="">One_nat_def</span><span class=""> 
</span><span class="">                    </span><span class="">Suc_1</span><span class=""> </span><span class="">Suc_le_lessD</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">nth_Cons_Suc</span><span class=""> </span><span class="">nth_append</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;Suc k &lt; length ?elst&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;Suc k = length ?elst - 1&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc k = length ?elst - 1&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl ! i = (last ?elst) ! 0&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">b01</span><span class=""> </span><span class="">concat.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">last_conv_nth</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">d4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl ! Suc i = (last ?elst) ! 1&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">b01</span><span class=""> </span><span class="">concat.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">d5</span><span class=""> </span><span class="">last_conv_nth</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length (last ?elst) &#10230; (&#8707;t. (last ?elst)!i -es-t&#8594; (last ?elst)!(Suc i)) 
                          &#10230; (gets_es ((last ?elst)!i), gets_es ((last ?elst)!Suc i)) &#8712; Guar m&quot;</span><span class=""> 
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">commit_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">e2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_es (esl ! i), gets_es (esl ! Suc i)) &#8712; Guar m&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_1</span><span class=""> </span><span class="">Suc_le_lessD</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">b01</span><span class=""> </span><span class="">concat.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">last_conv_nth</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;Suc k &#8800; length ?elst - 1&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc k &lt; length ?elst - 1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?els&#39;</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;?elst!(Suc k)@[(?elst!Suc (Suc k))!0]&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;Suc (Suc k) &lt; length ?elst&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;m&#8712;es. ?els&#39;&#8712;commit_es(Guar m,Post m)&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">m</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m&#8712;es &#8743; ?els&#39;&#8712;commit_es(Guar m,Post m)&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length ?els&#39; &#10230; (&#8707;t. ?els&#39;!i -es-t&#8594; ?els&#39;!(Suc i)) 
                                  &#10230; (gets_es (?els&#39;!i), gets_es (?els&#39;!Suc i)) &#8712; Guar m&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">commit_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl ! i = ?els&#39; ! 0&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_le_eq</span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="">dual_order.strict_trans</span><span class=""> </span><span class="">lessI</span><span class=""> </span><span class="">nth_append</span><span class=""> </span><span class="">numeral_2_eq_2</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl ! Suc i = ?els&#39; ! 1&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_1</span><span class=""> </span><span class="">Suc_le_lessD</span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="">nth_append</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">e3</span><span class=""> </span><span class="">e4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;t. ?els&#39;!0 -es-t&#8594; ?els&#39;!1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;length ?els&#39; &gt; 1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">e2</span><span class=""> </span><span class="">e5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_es (?els&#39;!0), gets_es (?els&#39;!1)) &#8712; Guar m&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">e3</span><span class=""> </span><span class="">e4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_es (esl ! i), gets_es (esl ! Suc i)) &#8712; Guar m&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d00</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j &#8800; length (?elst!k)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j &lt; length (?elst!k)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl ! i = (?elst!k) ! j&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Cons_nth_drop_Suc</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">append_Cons</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">list.inject</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;drop (Suc i) esl = (drop (Suc j) (?elst!k)) @ concat (drop (Suc k) ?elst)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">d00</span><span class=""> </span><span class="">drop_Suc</span><span class=""> </span><span class="">drop_eq_Nil</span><span class=""> </span><span class="">le_antisym</span><span class=""> </span><span class="">tl_append2</span><span class=""> </span><span class="">tl_drop</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;j = length (?elst!k) - 1&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j = length (?elst!k) - 1&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?els&#39;</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;?elst!k@[(?elst!(Suc k))!0]&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl ! i = last (?elst!k)&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">gr_implies_not0</span><span class=""> </span><span class="">last_conv_nth</span><span class=""> </span><span class="">length_0_conv</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;drop (Suc i) esl = concat (drop (Suc k) ?elst)&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">d2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;drop (Suc i) esl = ?elst!Suc k @ concat (drop (Suc (Suc k)) ?elst)&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Cons_nth_drop_Suc</span><span class=""> </span><span class="">Suc_lessI</span><span class=""> </span><span class="">c00</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">concat.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">diff_Suc_1</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;length (?elst ! (Suc k)) &#8805; 2&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">e3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl ! Suc i = ?elst!(Suc k)!0&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_1</span><span class=""> </span><span class="">Suc_leD</span><span class=""> 
</span><span class="">                        </span><span class="">Suc_n_not_le_n</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">hd_append2</span><span class=""> </span><span class="">hd_conv_nth</span><span class=""> </span><span class="">hd_drop_conv_nth</span><span class=""> </span><span class="">list.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl ! Suc i = ?els&#39; ! Suc j&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Suc_pred&#39;</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">gr_implies_not0</span><span class=""> </span><span class="">linorder_neqE_nat</span><span class=""> </span><span class="">nth_append_length</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl ! i = ?els&#39; ! j&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">nth_append</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;m&#8712;es. ?els&#39;&#8712;commit_es(Guar m,Post m)&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">m</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">e7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m&#8712;es &#8743; 
                          ?els&#39;&#8712;commit_es(Guar m,Post m)&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length ?els&#39; &#10230; (&#8707;t. ?els&#39;!i -es-t&#8594; ?els&#39;!(Suc i)) 
                                  &#10230; (gets_es (?els&#39;!i), gets_es (?els&#39;!Suc i)) &#8712; Guar m&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">commit_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                    
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">e5</span><span class=""> </span><span class="">e6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;t. ?els&#39;!j -es-t&#8594; ?els&#39;!Suc j&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;Suc j &lt; length ?els&#39;&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">e8</span><span class=""> </span><span class="">e9</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_es (?els&#39;!j), gets_es (?els&#39;!Suc j)) &#8712; Guar m&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">e5</span><span class=""> </span><span class="">e6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_es (esl ! i), gets_es (esl ! Suc i)) &#8712; Guar m&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">e7</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j &#8800; length (?elst!k) - 1&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e00</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j &lt; length (?elst!k) - 1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl ! Suc i = (?elst!k) ! Suc j&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">List.nth_tl</span><span class=""> </span><span class="">Suc_diff_Suc</span><span class=""> </span><span class="">drop_Suc</span><span class=""> 
</span><span class="">                          </span><span class="">drop_eq_Nil</span><span class=""> </span><span class="">hd_conv_nth</span><span class=""> </span><span class="">hd_drop_conv_nth</span><span class=""> </span><span class="">leD</span><span class=""> </span><span class="">length_drop</span><span class=""> </span><span class="">length_tl</span><span class=""> </span><span class="">nth_append</span><span class=""> </span><span class="">zero_less_Suc</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    
</span><span class="">                    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?els&#39;</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;?elst!k@[(?elst!(Suc k))!0]&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;m&#8712;es. ?els&#39;&#8712;commit_es(Guar m,Post m)&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">m</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">e2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m&#8712;es &#8743; ?els&#39;&#8712;commit_es(Guar m,Post m)&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length ?els&#39; &#10230; (&#8707;t. ?els&#39;!i -es-t&#8594; ?els&#39;!(Suc i)) 
                                  &#10230; (gets_es (?els&#39;!i), gets_es (?els&#39;!Suc i)) &#8712; Guar m&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">commit_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">e00</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl ! i = ?els&#39; ! j&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">nth_append</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">e00</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl ! Suc i = ?els&#39; ! Suc j&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Suc_lessI</span><span class=""> </span><span class="">nth_append</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">e5</span><span class=""> </span><span class="">e4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;t. ?els&#39;!j -es-t&#8594; ?els&#39;!Suc j&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;Suc j &lt; length ?els&#39;&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">e00</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">e3</span><span class=""> </span><span class="">e4</span><span class=""> </span><span class="">e6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_es (?els&#39;!j), gets_es (?els&#39;!Suc j)) &#8712; Guar m&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">e4</span><span class=""> </span><span class="">e5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_es (esl ! i), gets_es (esl ! Suc i)) &#8712; Guar m&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">e2</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">    
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">EventSys_sound</span><span class=""> </span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;&#10214;&#8704;ef&#8712;es. &#8872; ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre ef, Rely ef, Guar ef, Post ef];
     &#8704;ef&#8712;es. pre &#8838; Pre ef;  &#8704;ef&#8712;es. rely &#8838; Rely ef;
     &#8704;ef&#8712;es. Guar ef &#8838; guar; &#8704;ef&#8712;es. Post ef &#8838; post;
     &#8704;ef1 ef2. ef1&#8712;es &#8743; ef2&#8712;es &#10230; Post ef1 &#8838; Pre ef2;
     stable pre rely; &#8704;s. (s, s)&#8712;guar &#10215;
      &#10233; &#8872; EvtSys es sat<span class="hidden">&#8681;</span><sub>s</sub> [pre, rely, guar, post]&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;es. &#8872; ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre ef, Rely ef, Guar ef, Post ef]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;es. pre &#8838; Pre ef&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;es. rely &#8838; Rely ef&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;es. Guar ef &#8838; guar&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;es. Post ef &#8838; post&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef1 ef2. ef1&#8712;es &#8743; ef2&#8712;es &#10230; Post ef1 &#8838; Pre ef2&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;stable pre rely&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;s. (s, s)&#8712;guar&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;s x. (cpts_of_es (EvtSys es) s x) &#8745; assume_es(pre, rely) &#8838; commit_es(guar, post)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;esl. esl&#8712;(cpts_of_es (EvtSys es) s x) &#8745; assume_es (pre, rely) &#10230; esl&#8712; commit_es (guar, post)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">esl</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;(cpts_of_es (EvtSys es) s x) &#8745; assume_es (pre, rely)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;(cpts_of_es (EvtSys es) s x)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a1_1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl!0 = (EvtSys es, s, x)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a1_2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl &#8712; cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;assume_es (pre, rely)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length esl &#10230; (&#8707;t. esl!i -es-t&#8594; esl!(Suc i)) &#10230; 
                          (gets_es (esl!i), gets_es (esl!Suc i)) &#8712; guar&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i&lt;length esl&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;t. esl!i -es-t&#8594; esl!(Suc i)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">t</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl!i -es-t&#8594; esl!(Suc i)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a1_2</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_es (esl!i), gets_es (esl!Suc i)) &#8712; guar&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &#8804; length esl &#10230; getspc_es (esl ! i) = EvtSys es&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &#8804; length esl &#10230; getspc_es (esl ! i) = EvtSys es&quot;</span><span class="">
</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (esl ! i) = EvtSys es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (esl ! (Suc i)) = EvtSys es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172;(&#8707;t. esl!i -es-t&#8594; esl!(Suc i))&quot;</span><span class=""> 
</span><span class="">                      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsys_not_eq_in_tran2</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">surjective_pairing</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172; (&#8704;i. Suc i &#8804; length esl &#10230; getspc_es (esl ! i) = EvtSys es)&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">m</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc m &#8804; length esl &#8743; getspc_es (esl ! m) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a1_1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl!0) = EvtSys es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;i. i &#8804; m &#8743; getspc_es (esl ! i) &#8800; EvtSys es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a1_2</span><span class=""> </span><span class="">a1_1</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;i. (i &lt; m &#8743; getspc_es (esl ! i) = EvtSys es 
                              &#8743; getspc_es (esl ! Suc i) &#8800; EvtSys es) 
                              &#8743; (&#8704;j. j &lt; i &#10230; getspc_es (esl ! j) = EvtSys es)&quot;</span><span class=""> 
</span><span class="">                      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsys_fst_ent</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">n</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(n &lt; m &#8743; getspc_es (esl ! n) = EvtSys es 
                              &#8743; getspc_es (esl ! Suc n) &#8800; EvtSys es) 
                              &#8743; (&#8704;j. j &lt; n &#10230; getspc_es (esl ! j) = EvtSys es)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i &#8805; n&quot;</span><span class=""> 
</span><span class="">                      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">                        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i &lt; n&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (esl ! i) = EvtSys es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (esl ! Suc i) = EvtSys es&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Suc_lessI</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172;(&#8707;t. esl!i -es-t&#8594; esl!Suc i)&quot;</span><span class=""> 
</span><span class="">                          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsys_not_eq_in_tran</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">surjective_pairing</span><span class="delimiter">)</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">False</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">leI</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esl</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;drop n esl&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length ?esl &#8805; 2&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_eq_plus1_left</span><span class=""> </span><span class="">Suc_le_eq</span><span class=""> </span><span class="">length_drop</span><span class=""> 
</span><span class="">                          </span><span class="">less_diff_conv</span><span class=""> </span><span class="">less_trans_Suc</span><span class=""> </span><span class="">numeral_2_eq_2</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (?esl!0) = EvtSys es &#8743; getspc_es (?esl!1) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="">                    
</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a1_2</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl &#8712; cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_es_dropi</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="">drop_0</span><span class=""> </span><span class="">dual_order.strict_trans</span><span class=""> 
</span><span class="">                            </span><span class="">le_0_eq</span><span class=""> </span><span class="">le_SucE</span><span class=""> </span><span class="">le_imp_less_Suc</span><span class=""> </span><span class="">zero_induct</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="">c6</span><span class=""> </span><span class="">c7</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;s x ev s1 x1 xs. ?esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">fst_esys_snd_eseq_exist</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">s</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">e</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">xs</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c8</span><span class="delimiter">:</span><span class="">
</span><span class="">                        </span><span class="string">&quot;?esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    
</span><span class="">                    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?elst</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;tl (parse_es_cpts_i2 ?esl es [[]])&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c8</span><span class=""> </span><span class="">c7</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;concat ?elst = ?esl&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">parse_es_cpts_i2_concat3</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class="">           
</span><span class="">                    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c10</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl&#8712;assume_es(pre,rely)&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;n = 0&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;n = 0&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?esl = esl&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;n &#8800; 0&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?eslh</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;take (n + 1) esl&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length ?esl &#10230; ?esl!i -ese&#8594; ?esl!(Suc i) 
                          &#10230; (gets_es (?esl!i), gets_es (?esl!Suc i)) &#8712; rely&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_es (?esl!0) &#8712; pre&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class=""> 
</span><span class="">                            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_es (?eslh!0) &#8712; pre&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length ?eslh &#10230; ?eslh!i -ese&#8594; ?eslh!(Suc i) 
                              &#10230; (gets_es (?eslh!i), gets_es (?eslh!Suc i)) &#8712; rely&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?eslh &#8712; assume_es(pre, rely)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i&lt;length ?eslh. getspc_es (?eslh!i) = EvtSys es&quot;</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Suc_eq_plus1</span><span class=""> </span><span class="">length_take</span><span class=""> </span><span class="">less_antisym</span><span class=""> </span><span class="">min_less_iff_conj</span><span class=""> </span><span class="">nth_take</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                            </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i&lt;length ?eslh. gets_es (?eslh!i) &#8712; pre&quot;</span><span class=""> 
</span><span class="">                              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="">pre_trans</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_es (?eslh ! n) &#8712; pre&quot;</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">c8</span><span class=""> </span><span class="">nth_via_drop</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                    
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">c7</span><span class=""> </span><span class="">c8</span><span class=""> </span><span class="">c10</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c11</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length ?esl &#10230; (&#8707;t. ?esl!i -es-t&#8594; ?esl!(Suc i)) &#10230; 
                          (gets_es (?esl!i), gets_es (?esl!Suc i)) &#8712; guar&quot;</span><span class=""> 
</span><span class="">                      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">EventSys_sound_0</span><span class=""> 
</span><span class="">                          </span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="">Pre</span><span class=""> </span><span class="">Rely</span><span class=""> </span><span class="">Guar</span><span class=""> </span><span class="">Post</span><span class=""> </span><span class="">pre</span><span class=""> </span><span class="">rely</span><span class=""> </span><span class="">guar</span><span class=""> </span><span class="">post</span><span class=""> </span><span class="var">?esl</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">xs</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c12</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl ! i = ?esl ! (i - n)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c13</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl ! Suc i = ?esl ! Suc (i - n)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;Suc (i - n) &lt; length ?esl&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c12</span><span class=""> </span><span class="">c13</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;t. ?esl ! (i - n) -es-t&#8594; ?esl ! Suc (i - n)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_es (?esl ! (i - n)), gets_es (?esl ! Suc (i - n))) &#8712; guar&quot;</span><span class=""> 
</span><span class="">                      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">c11</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c12</span><span class=""> </span><span class="">c13</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                    
</span><span class="">              </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;esl&#8712;commit_es (guar, post)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">        
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;&#8872; EvtSys es sat<span class="hidden">&#8681;</span><sub>s</sub> [pre, rely, guar, post]&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">es_validity_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">esys_seq_sound</span><span class="delimiter">:</span><span class=""> 
</span><span class="">      </span><span class="string">&quot;&#10214;pre &#8838; pre&#39;; rely &#8838; rely&#39;; guar&#39; &#8838; guar; post&#39; &#8838; post;
        &#8872; esys sat<span class="hidden">&#8681;</span><sub>s</sub> [pre&#39;, rely&#39;, guar&#39;, post&#39;]&#10215; 
    &#10233; &#8872; esys sat<span class="hidden">&#8681;</span><sub>s</sub> [pre, rely, guar, post]&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;pre &#8838; pre&#39;&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rely &#8838; rely&#39;&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;guar&#39; &#8838; guar&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;post&#39; &#8838; post&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8872; esys sat<span class="hidden">&#8681;</span><sub>s</sub> [pre&#39;, rely&#39;, guar&#39;, post&#39;]&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;s x. (cpts_of_es esys s x) &#8745; assume_es(pre&#39;, rely&#39;) &#8838; commit_es(guar&#39;, post&#39;)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">es_validity_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;s x. (cpts_of_es esys s x) &#8745; assume_es(pre, rely) &#8838; commit_es(guar, post)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c&#8712;(cpts_of_es esys s x) &#8745; assume_es(pre, rely)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;c&#8712;(cpts_of_es esys s x) &#8743; c&#8712;assume_es(pre, rely)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;c&#8712;(cpts_of_es esys s x) &#8743; c&#8712;assume_es(pre&#39;, rely&#39;)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assume_es_imp</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">pre</span><span class=""> </span><span class="">pre&#39;</span><span class=""> </span><span class="">rely</span><span class=""> </span><span class="">rely&#39;</span><span class=""> </span><span class="">c</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;c&#8712;commit_es(guar&#39;, post&#39;)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;c&#8712;commit_es(guar, post)&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">commit_es_imp</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">guar&#39;</span><span class=""> </span><span class="">guar</span><span class=""> </span><span class="">post&#39;</span><span class=""> </span><span class="">post</span><span class=""> </span><span class="">c</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">es_validity_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">theorem</span></span><span class=""> </span><span class="">rgsound_es</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8866; esf sat<span class="hidden">&#8681;</span><sub>s</sub> [pre, rely, guar, post] &#10233; &#8872; evtsys_spec esf sat<span class="hidden">&#8681;</span><sub>s</sub> [pre, rely, guar, post]&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">rghoare_es.induct</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">ef</span><span class=""> </span><span class="">esf</span><span class=""> </span><span class="">pre</span><span class=""> </span><span class="">post</span><span class=""> </span><span class="">rely</span><span class=""> </span><span class="">guar</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8866; E<span class="hidden">&#8681;</span><sub>e</sub> (ef::(&#39;l,&#39;k,&#39;s) rgformula_e) sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre<span class="hidden">&#8681;</span><sub>e</sub> ef, Rely<span class="hidden">&#8681;</span><sub>e</sub> ef, Guar<span class="hidden">&#8681;</span><sub>e</sub> ef, Post<span class="hidden">&#8681;</span><sub>e</sub> ef]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8866; fst (esf::(&#39;l,&#39;k,&#39;s) rgformula_ess &#215; &#39;s rgformula) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre<span class="hidden">&#8681;</span><sub>f</sub> (snd esf), Rely<span class="hidden">&#8681;</span><sub>f</sub> (snd esf), Guar<span class="hidden">&#8681;</span><sub>f</sub> (snd esf), Post<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8872; evtsys_spec (fst esf) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre<span class="hidden">&#8681;</span><sub>f</sub> (snd esf), Rely<span class="hidden">&#8681;</span><sub>f</sub> (snd esf), Guar<span class="hidden">&#8681;</span><sub>f</sub> (snd esf), Post<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;pre = Pre<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;post = Post<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rely &#8838; Rely<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rely &#8838; Rely<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Guar<span class="hidden">&#8681;</span><sub>e</sub> ef &#8838; guar&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Guar<span class="hidden">&#8681;</span><sub>f</sub> (snd esf) &#8838; guar&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Post<span class="hidden">&#8681;</span><sub>e</sub> ef &#8838; Pre<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8872; E<span class="hidden">&#8681;</span><sub>e</sub> (ef::(&#39;l,&#39;k,&#39;s) rgformula_e) sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre<span class="hidden">&#8681;</span><sub>e</sub> ef, Rely<span class="hidden">&#8681;</span><sub>e</sub> ef, Guar<span class="hidden">&#8681;</span><sub>e</sub> ef, Post<span class="hidden">&#8681;</span><sub>e</sub> ef]&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">rgsound_e</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;evtsys_spec (rgf_EvtSeq ef esf) = EvtSeq (fst ef) (evtsys_spec (fst esf))&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsys_spec_evtseq</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">E<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">p9</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;&#8872; evtsys_spec (rgf_EvtSeq ef esf) sat<span class="hidden">&#8681;</span><sub>s</sub> [pre, rely, guar, post]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">EventSeq_sound</span><span class=""> </span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;fst ef&quot;</span><span class=""> </span><span class="string">&quot;pre&quot;</span><span class=""> </span><span class="string">&quot;Rely<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class=""> </span><span class="string">&quot;Guar<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class=""> </span><span class="string">&quot;Post<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class="">
</span><span class="">            </span><span class="string">&quot;evtsys_spec (fst esf)&quot;</span><span class=""> </span><span class="string">&quot;Pre<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)&quot;</span><span class=""> </span><span class="string">&quot;Rely<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)&quot;</span><span class=""> </span><span class="string">&quot;Guar<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)&quot;</span><span class=""> </span><span class="string">&quot;post&quot;</span><span class="">
</span><span class="">            </span><span class="">rely</span><span class=""> </span><span class="">guar</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">E<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">esf</span><span class=""> </span><span class="">pre</span><span class=""> </span><span class="">rely</span><span class=""> </span><span class="">guar</span><span class=""> </span><span class="">post</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;esf. &#8866; E<span class="hidden">&#8681;</span><sub>e</sub> ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre<span class="hidden">&#8681;</span><sub>e</sub> ef, Rely<span class="hidden">&#8681;</span><sub>e</sub> ef, Guar<span class="hidden">&#8681;</span><sub>e</sub> ef, Post<span class="hidden">&#8681;</span><sub>e</sub> ef]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;esf. pre &#8838; Pre<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;esf. rely &#8838;  Rely<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;esf. Guar<span class="hidden">&#8681;</span><sub>e</sub> ef &#8838; guar&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;esf. Post<span class="hidden">&#8681;</span><sub>e</sub> ef &#8838; post&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef1 ef2. ef1&#8712;esf &#8743; ef2&#8712;esf &#10230; Post<span class="hidden">&#8681;</span><sub>e</sub> ef1 &#8838; Pre<span class="hidden">&#8681;</span><sub>e</sub> ef2&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;stable pre rely&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;s. (s, s) &#8712; guar&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?es</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;Domain esf&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?RG</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;&#955;e. SOME rg. (e,rg)&#8712;esf&quot;</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;e&#8712;?es. &#8707;ef&#8712;esf. ?RG e = snd ef&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Domain.cases</span><span class=""> </span><span class="">snd_conv</span><span class=""> </span><span class="">someI</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?Pre</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;pre_rgf &#8728; ?RG&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?Rely</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;rely_rgf &#8728; ?RG&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?Guar</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;guar_rgf &#8728; ?RG&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?Post</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;post_rgf &#8728; ?RG&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i&#8712;esf. &#8872; E<span class="hidden">&#8681;</span><sub>e</sub> i sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre<span class="hidden">&#8681;</span><sub>e</sub> i, Rely<span class="hidden">&#8681;</span><sub>e</sub> i, Guar<span class="hidden">&#8681;</span><sub>e</sub> i, Post<span class="hidden">&#8681;</span><sub>e</sub> i]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">rgsound_e</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;?es. &#8872; ef sat<span class="hidden">&#8681;</span><sub>e</sub> [?Pre ef, ?Rely ef, ?Guar ef, ?Post ef]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">mono_tags</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Domain.cases</span><span class=""> </span><span class="">E<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span class=""> </span><span class="">Guar<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span class=""> </span><span class="">Post<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span class=""> 
</span><span class="">          </span><span class="">Pre<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span class=""> </span><span class="">Rely<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">comp_apply</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">snd_conv</span><span class=""> </span><span class="">someI_ex</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;?es. pre &#8838; ?Pre ef&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Pre<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">comp_def</span><span class=""> </span><span class="">p1</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;?es. rely &#8838; ?Rely ef&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Rely<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">comp_apply</span><span class=""> </span><span class="">p2</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;?es. ?Guar ef &#8838; guar&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Guar<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">comp_apply</span><span class=""> </span><span class="">p3</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;?es. ?Post ef &#8838; post&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Post<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">comp_apply</span><span class=""> </span><span class="">p4</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;ef1 ef2. ef1 &#8712; ?es &#8743; ef2 &#8712; ?es &#10230; ?Post ef1 &#8838; ?Pre ef2&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">mono_tags</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Post<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span class=""> </span><span class="">Pre<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">comp_def</span><span class=""> </span><span class="">p5</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8872; EvtSys (Domain esf) sat<span class="hidden">&#8681;</span><sub>s</sub> [pre, rely, guar, post]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">EventSys_sound</span><span class=""> </span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?es</span><span class=""> </span><span class="var">?Pre</span><span class=""> </span><span class="var">?Rely</span><span class=""> </span><span class="var">?Guar</span><span class=""> </span><span class="var">?Post</span><span class=""> </span><span class="">pre</span><span class=""> </span><span class="">rely</span><span class=""> </span><span class="">guar</span><span class=""> </span><span class="">post</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;&#8872; evtsys_spec (rgf_EvtSys esf) sat<span class="hidden">&#8681;</span><sub>s</sub> [pre, rely, guar, post]&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">pre</span><span class=""> </span><span class="">pre&#39;</span><span class=""> </span><span class="">rely</span><span class=""> </span><span class="">rely&#39;</span><span class=""> </span><span class="">guar&#39;</span><span class=""> </span><span class="">guar</span><span class=""> </span><span class="">post&#39;</span><span class=""> </span><span class="">post</span><span class=""> </span><span class="">esys</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;pre &#8838; pre&#39;&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="string">&quot;rely &#8838; rely&#39;&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="string">&quot;guar&#39; &#8838; guar&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="string">&quot;post&#39; &#8838; post&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="string">&quot;&#8866; esys sat<span class="hidden">&#8681;</span><sub>s</sub> [pre&#39;, rely&#39;, guar&#39;, post&#39;]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="string">&quot;&#8872; evtsys_spec esys sat<span class="hidden">&#8681;</span><sub>s</sub> [pre&#39;, rely&#39;, guar&#39;, post&#39;]&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;&#8872; evtsys_spec esys sat<span class="hidden">&#8681;</span><sub>s</sub> [pre, rely, guar, post] &quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">esys_seq_sound</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">pre</span><span class=""> </span><span class="">pre&#39;</span><span class=""> </span><span class="">rely</span><span class=""> </span><span class="">rely&#39;</span><span class=""> </span><span class="">guar&#39;</span><span class=""> </span><span class="">guar</span><span class=""> </span><span class="">post&#39;</span><span class=""> </span><span class="">post</span><span class=""> </span><span class="string">&quot;evtsys_spec esys&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">subsection</span></span><span class=""> </span><span class="cartouche">&#8249;Soundness of Parallel Event Systems&#8250;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">conjoin_comm_imp_rely_n</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#10214;&#8704;k. pre &#8838; Pre k; &#8704;k. rely &#8838; Rely k; 
    &#8704;k j. j&#8800;k &#10230; Guar j &#8838; Rely k;
    &#8704;k. cs k &#8712; commit_es(Guar k, Post k);
    c &#8712; cpts_of_pes pes s x; c&#8712;assume_pes(pre, rely); c &#8733; cs&#10215; &#10233;
    &#8704;n k. n &#8804; length (cs k) &#8743; n &gt; 0 &#10230; take n (cs k) &#8712; assume_es(Pre k, Rely k)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. pre &#8838; Pre k&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. rely &#8838; Rely k&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k j. j&#8800;k &#10230;  Guar j &#8838; Rely k&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8712; cpts_of_pes pes s x&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8712; assume_pes(pre, rely)&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8733; cs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. cs k &#8712; commit_es(Guar k, Post k)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. length (cs k) = length c&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class=""> </span><span class="">same_length_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. cs k &#8712; cpts_of_es (pes k) s x&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">conjoin_imp_cptses_k</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. cs k &#8712; cpts_es &#8743; cs k !0 = (pes k,s,x)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p10</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k j. j &lt; length c &#10230; gets (c!j) = gets_es ((cs k)!j)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class=""> </span><span class="">same_state_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">n</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;k. n &#8804; length (cs k) &#8743; n &gt; 0 &#10230; take n (cs k) &#8712; assume_es(Pre k, Rely k)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">n</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">0</span><span class=""> </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Suc</span><span class=""> </span><span class="">m</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. m &#8804; length (cs k) &#8743; 0 &lt; m &#10230; take m (cs k) &#8712; assume_es (Pre k, Rely k)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">k</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc m &#8804; length (cs k) &#8743; 0 &lt; Suc m&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length (cs k) &gt; 0&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">cpts_es_not_empty</span><span class=""> </span><span class="">cpts_of_es_def</span><span class=""> </span><span class="">gr0I</span><span class=""> </span><span class="">length_0_conv</span><span class=""> </span><span class="">mem_Collect_eq</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length (cs k) = length c&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class=""> </span><span class="">same_length_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esl</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;take (Suc m) (cs k)&quot;</span><span class="">
</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;take (Suc m) (cs k) &#8712; assume_es (Pre k, Rely k)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;m = 0&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m = 0&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_es (take (Suc m) (cs k)!0) &#8712; Pre k&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets (c!0) = gets_es ((cs k)!0)&quot;</span><span class=""> 
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class=""> </span><span class="">same_state_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets (c!0) &#8712; pre&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_pes_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p8</span><span class="">  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length (take (Suc m) (cs k)) = 1&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="">gr0_implies_Suc</span><span class=""> </span><span class="">length_take</span><span class=""> </span><span class="">min_0R</span><span class=""> </span><span class="">min_Suc_Suc</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &lt; length (take (Suc m) (cs k)) 
                      &#10230; (take (Suc m) (cs k)) ! i -ese&#8594; (take (Suc m) (cs k)) ! Suc i 
                      &#10230; (gets_es ((take (Suc m) (cs k)) ! i), gets_es ((take (Suc m) (cs k)) ! Suc i)) &#8712; rely&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;assume_es (Pre k, Rely k) = {c. gets_es (c ! 0) &#8712; Pre k &#8743;
                      (&#8704;i. Suc i &lt; length c &#10230; c ! i -ese&#8594; c ! Suc i 
                            &#10230; (gets_es (c ! i), gets_es (c ! Suc i)) &#8712; Rely k)}&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Suc_neq_Zero</span><span class=""> </span><span class="">less_one</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;m &#8800; 0&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">dd0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m &gt; 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">dd1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;take m (cs k) &#8712; assume_es (Pre k, Rely k)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_es (?esl ! 0) &#8712; Pre k&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets (c!0) = gets_es ((cs k)!0)&quot;</span><span class=""> 
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class=""> </span><span class="">same_state_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets (c!0) &#8712; pre&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_pes_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length ?esl &#10230; 
                     ?esl!i -ese&#8594; ?esl!(Suc i) &#10230; 
                     (gets_es (?esl!i), gets_es (?esl!Suc i)) &#8712; Rely k&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i&lt;length ?esl&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl!i -ese&#8594; ?esl!Suc i&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl!i = (cs k)!i &#8743; ?esl!Suc i = (cs k)! Suc i&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8707;t k. (c!i -pes-(t&#9839;k)&#8594; c!Suc i) &#8743;
                              (&#8704;k t. (c!i -pes-(t&#9839;k)&#8594; c!Suc i) &#10230; (cs k!i -es-(t&#9839;k)&#8594; cs k! Suc i) &#8743;
                                      (&#8704;k&#39;. k&#39; &#8800; k &#10230; (cs k&#39;!i -ese&#8594; cs k&#39;! Suc i))))
                              &#8744;
                              (((c!i) -pese&#8594; (c!Suc i)) &#8743; (&#8704;k. (((cs k)!i) -ese&#8594; ((cs k)! Suc i))))&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class=""> </span><span class="">compat_tran_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;((cs k)!i) -ese&#8594; ((cs k)! Suc i)&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">d2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_es (?esl!i), gets_es (?esl!Suc i)) &#8712; Rely k&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">proof</span></span><span class="">
</span><span class="">                        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;t k. (c!i -pes-(t&#9839;k)&#8594; c!Suc i) &#8743;
                              (&#8704;k t. (c!i -pes-(t&#9839;k)&#8594; c!Suc i) &#10230; (cs k!i -es-(t&#9839;k)&#8594; cs k! Suc i) &#8743;
                                      (&#8704;k&#39;. k&#39; &#8800; k &#10230; (cs k&#39;!i -ese&#8594; cs k&#39;! Suc i)))&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">ct</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">k&#39;</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;((c!i) -pes-(ct&#9839;k&#39;)&#8594; (c!Suc i)) &#8743;
                                    (((cs k&#39;)!i) -es-(ct&#9839;k&#39;)&#8594; ((cs k&#39;)! Suc i))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">d5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;k &#8800; k&#39;&quot;</span><span class=""> 
</span><span class="">                          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">conjoin_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="">same_spec_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class="">
</span><span class="">                             </span><span class="">es_tran_not_etran1</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">  
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;((cs k)!i) -ese&#8594; ((cs k)! Suc i)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(?esl!i) -ese&#8594; (?esl! Suc i)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;i &lt; m - 1&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">f0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i &lt; m - 1&quot;</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f1</span><span class="delimiter">:</span><span class="string">&quot;take (Suc m) (cs k) ! i = take m (cs k) ! i&quot;</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">diff_less_Suc</span><span class=""> </span><span class="">less_trans_Suc</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                            
</span><span class="">                            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">f0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;take (Suc m) (cs k) ! Suc i = take m (cs k) ! Suc i&quot;</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="">gr_implies_not0</span><span class=""> </span><span class="">nat_le_linear</span><span class="delimiter">)</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">dd1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length (take m (cs k)) &#10230; 
                                (take m (cs k))!i -ese&#8594; (take m (cs k))!(Suc i) &#10230; 
                                (gets_es ((take m (cs k))!i), gets_es ((take m (cs k))!Suc i)) &#8712; Rely k&quot;</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">dd0</span><span class=""> </span><span class="">f0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_es (take m (cs k) ! i), gets_es (take m (cs k) ! Suc i)) &#8712; Rely k&quot;</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_mono</span><span class=""> </span><span class="">Suc_pred</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="">f2</span><span class=""> </span><span class="">length_take</span><span class=""> </span><span class="">min_less_iff_conj</span><span class="delimiter">)</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="">f2</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                            </span><span class="keyword3"><span class="command">assume</span></span><span class="">  </span><span class="string">&quot;&#172;(i &lt; m - 1)&quot;</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i = m - 1&quot;</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">dd0</span><span class=""> </span><span class="">less_antisym</span><span class=""> </span><span class="">min.absorb2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                            </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esl2</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;take (Suc m) (cs k&#39;)&quot;</span><span class="">
</span><span class="">                            
</span><span class="">                            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">dd0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;take m (cs k&#39;) &#8712; assume_es (Pre k&#39;, Rely k&#39;)&quot;</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Suc_leD</span><span class=""> </span><span class="">p8</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">f0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172;(cs k&#39; ! (m-1) -ese&#8594; cs k&#39; !m)&quot;</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Suc_pred&#39;</span><span class=""> </span><span class="">dd0</span><span class=""> </span><span class="">es_tran_not_etran1</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">                            </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;take (Suc m) (cs k&#39;) &#8712; assume_es (Pre k&#39;, Rely k&#39;)&quot;</span><span class=""> 
</span><span class="">                              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assume_es_one_more</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;cs k&#39;&quot;</span><span class=""> </span><span class="">m</span><span class=""> </span><span class="string">&quot;Pre k&#39;&quot;</span><span class=""> </span><span class="string">&quot;Rely k&#39;&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">p9</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">dd0</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Suc_le_eq</span><span class="delimiter">)</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;cs k&#39; &#8712; cpts_of_es (pes k&#39;) s x&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">dd0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl2&#8712;cpts_of_es (pes k&#39;) s x&quot;</span><span class=""> 
</span><span class="">                              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_es_take</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;cs k&#39;&quot;</span><span class=""> </span><span class="">m</span><span class="delimiter">]</span><span class=""> </span><span class="">cpts_of_es_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;pes k&#39;&quot;</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class="delimiter">]</span><span class="">
</span><span class="">                                </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Suc_le_lessD</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?esl2&#8712;commit_es(Guar k&#39;, Post k&#39;)&quot;</span><span class=""> 
</span><span class="">                              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">commit_es_take_n</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;Suc m&quot;</span><span class=""> </span><span class="string">&quot;cs k&#39;&quot;</span><span class=""> </span><span class="string">&quot;Guar k&#39;&quot;</span><span class=""> </span><span class="string">&quot;Post k&#39;&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length ?esl2 &#10230; 
                                          (&#8707;t. ?esl2!i -es-t&#8594; ?esl2!(Suc i)) &#10230; 
                                          (gets_es (?esl2!i), gets_es (?esl2!Suc i)) &#8712; Guar k&#39;&quot;</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                            
</span><span class="">                            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">f0</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">dd0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_es (?esl2 ! (m-1)), gets_es (?esl2 ! m))&#8712;Guar k&#39;&quot;</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_pred</span><span class=""> </span><span class="">diff_less_Suc</span><span class=""> </span><span class="">length_take</span><span class=""> </span><span class="">lessI</span><span class=""> </span><span class="">min.absorb2</span><span class=""> </span><span class="">nth_take</span><span class="delimiter">)</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p10</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">f0</span><span class=""> </span><span class="">e2</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Suc_diff_1</span><span class=""> </span><span class="">Suc_leD</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">dd0</span><span class=""> </span><span class="">le_less_linear</span><span class=""> </span><span class="">not_less_eq_eq</span><span class=""> </span><span class="">nth_take</span><span class=""> </span><span class="">subsetCE</span><span class="delimiter">)</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(((c!i) -pese&#8594; (c!Suc i)) &#8743; (&#8704;k. (((cs k)!i) -ese&#8594; ((cs k)! Suc i))))&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length c &#10230; 
                                          c!i -pese&#8594; c!(Suc i) &#10230; 
                                          (gets (c!i), gets (c!Suc i)) &#8712; rely&quot;</span><span class="">
</span><span class="">                           </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_pes_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class="string">&quot;Suc i &lt; length c&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets (c!i), gets (c!Suc i)) &#8712; rely&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets (c!i), gets (c!Suc i)) &#8712; Rely k&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">p10</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">conjoin_comm_imp_rely</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#10214;&#8704;k. pre &#8838; Pre k; &#8704;k. rely &#8838; Rely k; 
    &#8704;k j. j&#8800;k &#10230; Guar j &#8838; Rely k;
    &#8704;k. cs k &#8712; commit_es(Guar k, Post k);
    c &#8712; cpts_of_pes pes s x; c&#8712;assume_pes(pre, rely); c &#8733; cs&#10215; &#10233;
    &#8704;k. (cs k) &#8712; assume_es(Pre k, Rely k)&quot;</span><span class="">
</span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. pre &#8838; Pre k&quot;</span><span class="">
</span><span class="">  </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. rely &#8838; Rely k&quot;</span><span class="">
</span><span class="">  </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k j. j &#8800; k &#10230; Guar j &#8838; Rely k&quot;</span><span class="">
</span><span class="">  </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. cs k &#8712; commit_es (Guar k, Post k)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8712; cpts_of_pes pes s x&quot;</span><span class="">
</span><span class="">  </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8712; assume_pes (pre, rely)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8733; cs&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8800; []&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a5</span><span class=""> </span><span class="">cpts_of_pes_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a7</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. length (cs k) = length c&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class=""> </span><span class="">same_length_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">k</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(cs k) &#8712; assume_es(Pre k, Rely k)&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="">a5</span><span class=""> </span><span class="">a6</span><span class=""> </span><span class="">a7</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">f8</span><span class=""> 
</span><span class="">      </span><span class="">conjoin_comm_imp_rely_n</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">pre</span><span class=""> </span><span class="">Pre</span><span class=""> </span><span class="">rely</span><span class=""> </span><span class="">Rely</span><span class=""> </span><span class="">Guar</span><span class=""> </span><span class="">cs</span><span class=""> </span><span class="">Post</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">pes</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="string">&quot;length (cs k)&quot;</span><span class=""> </span><span class="">k</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">}</span></span><span class="">  
</span><span class="">  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">    
</span><span class="keyword1"><span class="command">qed</span></span><span class=""> 
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">cpts_es_sat_rely</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#10214;&#8704;k. &#8872; (pes k) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre k, Rely k, Guar k, Post k]; 
        &#8704;k. pre &#8838; Pre k; 
        &#8704;k. rely &#8838; Rely k; 
        &#8704;k j. j&#8800;k &#10230; Guar j &#8838; Rely k;
        c &#8712; cpts_of_pes pes s x; c&#8712;assume_pes(pre, rely);
        c &#8733; cs; &#8704;k. cs k &#8712; cpts_of_es (pes k) s x&#10215; &#10233;
        &#8704;n k. n &#8804; length (cs k) &#8743; n &gt; 0 &#10230; take n (cs k)&#8712;assume_es(Pre k, Rely k)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. &#8872; (pes k) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre k, Rely k, Guar k, Post k]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. pre &#8838; Pre k&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. rely &#8838; Rely k&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k j. j&#8800;k &#10230;  Guar j &#8838; Rely k&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8712; cpts_of_pes pes s x&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8712; assume_pes(pre, rely)&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8733; cs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. cs k &#8712; cpts_of_es (pes k) s x&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. length (cs k) = length c&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class=""> </span><span class="">same_length_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. cs k &#8712; cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_of_es_def</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p10</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k j. j &lt; length c &#10230; gets (c!j) = gets_es ((cs k)!j)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class=""> </span><span class="">same_state_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">n</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;k. n &#8804; length (cs k) &#8743; n &gt; 0 &#10230; take n (cs k)&#8712;assume_es(Pre k, Rely k)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">n</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">0</span><span class=""> </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Suc</span><span class=""> </span><span class="">m</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. m &#8804; length (cs k) &#8743; 0 &lt; m &#10230; take m (cs k) &#8712; assume_es (Pre k, Rely k)&quot;</span><span class="">
</span><span class="">           
</span><span class="">          </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">k</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc m &#8804; length (cs k) &#8743; 0 &lt; Suc m&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length (cs k) &gt; 0&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">cpts_es_not_empty</span><span class=""> </span><span class="">cpts_of_es_def</span><span class=""> </span><span class="">gr0I</span><span class=""> </span><span class="">length_0_conv</span><span class=""> </span><span class="">mem_Collect_eq</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length (cs k) = length c&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class=""> </span><span class="">same_length_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esl</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;take (Suc m) (cs k)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?esl &#8712; assume_es (Pre k, Rely k)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;m = 0&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m = 0&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_es (take (Suc m) (cs k)!0) &#8712; Pre k&quot;</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets (c!0) = gets_es ((cs k)!0)&quot;</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class=""> </span><span class="">same_state_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets (c!0) &#8712; pre&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_pes_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p8</span><span class="">  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length (take (Suc m) (cs k)) = 1&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="">gr0_implies_Suc</span><span class=""> </span><span class="">length_take</span><span class=""> </span><span class="">min_0R</span><span class=""> </span><span class="">min_Suc_Suc</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &lt; length (take (Suc m) (cs k)) 
                    &#10230; (take (Suc m) (cs k)) ! i -ese&#8594; (take (Suc m) (cs k)) ! Suc i 
                    &#10230; (gets_es ((take (Suc m) (cs k)) ! i), gets_es ((take (Suc m) (cs k)) ! Suc i)) &#8712; rely&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;assume_es (Pre k, Rely k) = {c. gets_es (c ! 0) &#8712; Pre k &#8743;
                    (&#8704;i. Suc i &lt; length c &#10230; c ! i -ese&#8594; c ! Suc i 
                          &#10230; (gets_es (c ! i), gets_es (c ! Suc i)) &#8712; Rely k)}&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Suc_neq_Zero</span><span class=""> </span><span class="">less_one</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">              </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;m &#8800; 0&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">dd0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m &gt; 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">dd1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;take m (cs k) &#8712; assume_es (Pre k, Rely k)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">              
</span><span class="">              </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_es (?esl ! 0) &#8712; Pre k&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets (c!0) = gets_es ((cs k)!0)&quot;</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class=""> </span><span class="">same_state_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets (c!0) &#8712; pre&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_pes_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length ?esl &#10230; 
                   ?esl!i -ese&#8594; ?esl!(Suc i) &#10230; 
                   (gets_es (?esl!i), gets_es (?esl!Suc i)) &#8712; Rely k&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">                  </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">                  </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i&lt;length ?esl&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl!i -ese&#8594; ?esl!Suc i&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl!i = (cs k)!i &#8743; ?esl!Suc i = (cs k)! Suc i&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8707;t k. (c!i -pes-(t&#9839;k)&#8594; c!Suc i) &#8743;
                            (&#8704;k t. (c!i -pes-(t&#9839;k)&#8594; c!Suc i) &#10230; (cs k!i -es-(t&#9839;k)&#8594; cs k! Suc i) &#8743;
                                    (&#8704;k&#39;. k&#39; &#8800; k &#10230; (cs k&#39;!i -ese&#8594; cs k&#39;! Suc i))))
                            &#8744;
                            (((c!i) -pese&#8594; (c!Suc i)) &#8743; (&#8704;k. (((cs k)!i) -ese&#8594; ((cs k)! Suc i))))&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class=""> </span><span class="">compat_tran_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;((cs k)!i) -ese&#8594; ((cs k)! Suc i)&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">d2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_es (?esl!i), gets_es (?esl!Suc i)) &#8712; Rely k&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">proof</span></span><span class="">
</span><span class="">                      </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;t k. (c!i -pes-(t&#9839;k)&#8594; c!Suc i) &#8743;
                            (&#8704;k t. (c!i -pes-(t&#9839;k)&#8594; c!Suc i) &#10230; (cs k!i -es-(t&#9839;k)&#8594; cs k! Suc i) &#8743;
                                    (&#8704;k&#39;. k&#39; &#8800; k &#10230; (cs k&#39;!i -ese&#8594; cs k&#39;! Suc i)))&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">ct</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">k&#39;</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;((c!i) -pes-(ct&#9839;k&#39;)&#8594; (c!Suc i)) &#8743;
                                  (((cs k&#39;)!i) -es-(ct&#9839;k&#39;)&#8594; ((cs k&#39;)! Suc i))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">d5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;k &#8800; k&#39;&quot;</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">conjoin_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="">same_spec_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class="">
</span><span class="">                           </span><span class="">es_tran_not_etran1</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;((cs k)!i) -ese&#8594; ((cs k)! Suc i)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(?esl!i) -ese&#8594; (?esl! Suc i)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;i &lt; m - 1&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                          </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">f0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i &lt; m - 1&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f1</span><span class="delimiter">:</span><span class="string">&quot;take (Suc m) (cs k) ! i = take m (cs k) ! i&quot;</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">diff_less_Suc</span><span class=""> </span><span class="">less_trans_Suc</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                          
</span><span class="">                          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">f0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;take (Suc m) (cs k) ! Suc i = take m (cs k) ! Suc i&quot;</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="">gr_implies_not0</span><span class=""> </span><span class="">nat_le_linear</span><span class="delimiter">)</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">dd1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length (take m (cs k)) &#10230; 
                              (take m (cs k))!i -ese&#8594; (take m (cs k))!(Suc i) &#10230; 
                              (gets_es ((take m (cs k))!i), gets_es ((take m (cs k))!Suc i)) &#8712; Rely k&quot;</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">dd0</span><span class=""> </span><span class="">f0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_es (take m (cs k) ! i), gets_es (take m (cs k) ! Suc i)) &#8712; Rely k&quot;</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_mono</span><span class=""> </span><span class="">Suc_pred</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="">f2</span><span class=""> </span><span class="">length_take</span><span class=""> </span><span class="">min_less_iff_conj</span><span class="delimiter">)</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="">f2</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                          </span><span class="keyword3"><span class="command">assume</span></span><span class="">  </span><span class="string">&quot;&#172;(i &lt; m - 1)&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i = m - 1&quot;</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">dd0</span><span class=""> </span><span class="">less_antisym</span><span class=""> </span><span class="">min.absorb2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                          </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esl2</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;take (Suc m) (cs k&#39;)&quot;</span><span class="">
</span><span class="">                          
</span><span class="">                          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">dd0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;take m (cs k&#39;) &#8712; assume_es (Pre k&#39;, Rely k&#39;)&quot;</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Suc_leD</span><span class=""> </span><span class="">p8</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                          </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">f0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172;(cs k&#39; ! (m-1) -ese&#8594; cs k&#39; !m)&quot;</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Suc_pred&#39;</span><span class=""> </span><span class="">dd0</span><span class=""> </span><span class="">es_tran_not_etran1</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">                          </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;take (Suc m) (cs k&#39;) &#8712; assume_es (Pre k&#39;, Rely k&#39;)&quot;</span><span class=""> 
</span><span class="">                            </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assume_es_one_more</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;cs k&#39;&quot;</span><span class=""> </span><span class="">m</span><span class=""> </span><span class="string">&quot;Pre k&#39;&quot;</span><span class=""> </span><span class="string">&quot;Rely k&#39;&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">p9</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">dd0</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Suc_le_eq</span><span class="delimiter">)</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;cs k&#39; &#8712; cpts_of_es (pes k&#39;) s x&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">dd0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl2&#8712;cpts_of_es (pes k&#39;) s x&quot;</span><span class=""> 
</span><span class="">                            </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_es_take</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;cs k&#39;&quot;</span><span class=""> </span><span class="">m</span><span class="delimiter">]</span><span class=""> </span><span class="">cpts_of_es_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;pes k&#39;&quot;</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class="delimiter">]</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Suc_le_lessD</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8872; pes k&#39; sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre k&#39;, Rely k&#39;, Guar k&#39;, Post k&#39;] &quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="">f2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?esl2&#8712;commit_es(Guar k&#39;, Post k&#39;)&quot;</span><span class=""> 
</span><span class="">                            </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">es_validity_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;pes k&#39;&quot;</span><span class=""> </span><span class="string">&quot;Pre k&#39;&quot;</span><span class=""> </span><span class="string">&quot;Rely k&#39;&quot;</span><span class=""> </span><span class="string">&quot;Guar k&#39;&quot;</span><span class=""> </span><span class="string">&quot;Post k&#39;&quot;</span><span class="delimiter">]</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length ?esl2 &#10230; 
                                        (&#8707;t. ?esl2!i -es-t&#8594; ?esl2!(Suc i)) &#10230; 
                                        (gets_es (?esl2!i), gets_es (?esl2!Suc i)) &#8712; Guar k&#39;&quot;</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                          
</span><span class="">                          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">f0</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">dd0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_es (?esl2 ! (m-1)), gets_es (?esl2 ! m))&#8712;Guar k&#39;&quot;</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_pred</span><span class=""> </span><span class="">diff_less_Suc</span><span class=""> </span><span class="">length_take</span><span class=""> </span><span class="">lessI</span><span class=""> </span><span class="">min.absorb2</span><span class=""> </span><span class="">nth_take</span><span class="delimiter">)</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p10</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">f0</span><span class=""> </span><span class="">e2</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Suc_diff_1</span><span class=""> </span><span class="">Suc_leD</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">dd0</span><span class=""> </span><span class="">le_less_linear</span><span class=""> </span><span class="">not_less_eq_eq</span><span class=""> </span><span class="">nth_take</span><span class=""> </span><span class="">subsetCE</span><span class="delimiter">)</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                      </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(((c!i) -pese&#8594; (c!Suc i)) &#8743; (&#8704;k. (((cs k)!i) -ese&#8594; ((cs k)! Suc i))))&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length c &#10230; 
                                        c!i -pese&#8594; c!(Suc i) &#10230; 
                                        (gets (c!i), gets (c!Suc i)) &#8712; rely&quot;</span><span class="">
</span><span class="">                         </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_pes_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                      </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class="string">&quot;Suc i &lt; length c&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets (c!i), gets (c!Suc i)) &#8712; rely&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets (c!i), gets (c!Suc i)) &#8712; Rely k&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">p10</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                
</span><span class="">          </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">es_tran_sat_guar_aux</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;&#10214;&#8704;k. &#8872; (pes k) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre k, Rely k, Guar k, Post k]; 
        &#8704;k. pre &#8838; Pre k; 
        &#8704;k. rely &#8838; Rely k; 
        &#8704;k j. j&#8800;k &#10230; Guar j &#8838; Rely k;
        c &#8712; cpts_of_pes pes s x; c&#8712;assume_pes(pre, rely);
        c &#8733; cs; &#8704;k. cs k &#8712; cpts_of_es (pes k) s x &#10215; 
        &#10233;&#8704;k i m. m &#8804; length c &#10230; Suc i &lt; length (take m (cs k)) &#10230; (&#8707;t.((take m (cs k))!i-es-t&#8594;((take m (cs k))!Suc i))) 
                &#10230; (gets_es ((take m (cs k))!i),gets_es ((take m (cs k))!Suc i)) &#8712; Guar k&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. &#8872; (pes k) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre k, Rely k, Guar k, Post k]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. pre &#8838; Pre k&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. rely &#8838; Rely k&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k j. j&#8800;k &#10230;  Guar j &#8838; Rely k&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8712; cpts_of_pes pes s x&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8712; assume_pes(pre, rely)&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8733; cs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. cs k &#8712; cpts_of_es (pes k) s x&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. length (cs k) = length c&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class=""> </span><span class="">same_length_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">i</span><span class=""> </span><span class="">m</span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m &#8804; length c&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length (take m (cs k))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;t.((take m (cs k))!i-es-t&#8594;((take m (cs k))!Suc i))&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_es ((take m (cs k))!i),gets_es ((take m (cs k))!Suc i)) &#8712; Guar k&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;m = 0&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;m = 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;m &#8800; 0&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m &gt; 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esl</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;take m (cs k)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;cs k &#8712; cpts_of_es (pes k) s x&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;cs k!0=(pes k,s,x) &#8743; cs k &#8712; cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?esl!0=(pes k,s,x) &#8743; ?esl &#8712; cpts_es&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Suc_pred</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">cpts_es_take</span><span class=""> </span><span class="">leD</span><span class=""> </span><span class="">not_less_eq</span><span class=""> </span><span class="">nth_take</span><span class=""> </span><span class="">p8</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">r1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl &#8712; cpts_of_es (pes k) s x&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="">p7</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;n. n &#8804; length (cs k) &#8743; n &gt; 0 &#10230; take n (cs k)&#8712;assume_es(Pre k, Rely k)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_es_sat_rely</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">pes</span><span class=""> </span><span class="">Pre</span><span class=""> </span><span class="">Rely</span><span class=""> </span><span class="">Guar</span><span class=""> </span><span class="">Post</span><span class=""> </span><span class="">pre</span><span class=""> </span><span class="">rely</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">r2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl&#8712;assume_es(Pre k, Rely k)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          
</span><span class="">          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(cpts_of_es (pes k) s x) &#8745; assume_es(Pre k, Rely k) &#8838; commit_es(Guar k, Post k)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">es_validity_def</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">r1</span><span class=""> </span><span class="">r2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?esl &#8712; commit_es(Guar k, Post k)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">IntI</span><span class=""> </span><span class="">subsetCE</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length ?esl &#10230; 
               (&#8707;t. ?esl!i -es-t&#8594; ?esl!(Suc i)) &#10230; (gets_es (?esl!i), gets_es (?esl!Suc i)) &#8712; Guar k&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">es_tran_sat_guar</span><span class="delimiter">:</span><span class=""> 
</span><span class="">      </span><span class="string">&quot;&#10214;&#8704;k. &#8872; (pes k) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre k, Rely k, Guar k, Post k]; 
        &#8704;k. pre &#8838; Pre k; 
        &#8704;k. rely &#8838; Rely k; 
        &#8704;k j. j&#8800;k &#10230;  Guar j &#8838; Rely k;
        c &#8712; cpts_of_pes pes s x; c&#8712;assume_pes(pre, rely);
        c &#8733; cs; &#8704;k. cs k &#8712; cpts_of_es (pes k) s x &#10215; 
        &#10233;&#8704;k i. Suc i &lt; length (cs k) &#10230; (&#8707;t.((cs k)!i-es-t&#8594;(cs k)!Suc i)) 
                &#10230; (gets_es ((cs k)!i),gets_es ((cs k)!Suc i)) &#8712; Guar k&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. &#8872; (pes k) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre k, Rely k, Guar k, Post k]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. pre &#8838; Pre k&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. rely &#8838; Rely k&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k j. j&#8800;k &#10230;  Guar j &#8838; Rely k&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8712; cpts_of_pes pes s x&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8712; assume_pes(pre, rely)&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8733; cs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. cs k &#8712; cpts_of_es (pes k) s x&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;k i m. m &#8804; length c &#10230; Suc i &lt; length (take m (cs k)) &#10230; (&#8707;t.((take m (cs k))!i-es-t&#8594;((take m (cs k))!Suc i))) 
                &#10230; (gets_es ((take m (cs k))!i),gets_es ((take m (cs k))!Suc i)) &#8712; Guar k&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">es_tran_sat_guar_aux</span><span class=""> </span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">pes</span><span class=""> </span><span class="">Pre</span><span class=""> </span><span class="">Rely</span><span class=""> </span><span class="">Guar</span><span class=""> </span><span class="">Post</span><span class=""> </span><span class="">pre</span><span class=""> </span><span class="">rely</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;k. length c = length (cs k)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class=""> </span><span class="">same_length_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">conjoin_es_sat_assume</span><span class="delimiter">:</span><span class=""> 
</span><span class="">      </span><span class="string">&quot;&#10214;&#8704;k. &#8872; (pes k) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre k, Rely k, Guar k, Post k]; 
        &#8704;k. pre &#8838; Pre k; 
        &#8704;k. rely &#8838; Rely k; 
        &#8704;k j. j&#8800;k &#10230;  Guar j &#8838; Rely k;
        c &#8712; cpts_of_pes pes s x; c&#8712;assume_pes(pre, rely);
        c &#8733; cs; &#8704;k. cs k &#8712; cpts_of_es (pes k) s x &#10215; 
        &#10233; &#8704;k. cs k &#8712; assume_es(Pre k, Rely k)&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. &#8872; (pes k) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre k, Rely k, Guar k, Post k]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. pre &#8838; Pre k&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. rely &#8838; Rely k&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k j. j&#8800;k &#10230;  Guar j &#8838; Rely k&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8712; cpts_of_pes pes s x&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8712; assume_pes(pre, rely)&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8733; cs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. cs k &#8712; cpts_of_es (pes k) s x&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p11</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. length (cs k) = length c&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class=""> </span><span class="">same_length_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p12</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. cs k &#8712; cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_of_es_def</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;c &#8800; Nil&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_es_not_empty</span><span class=""> </span><span class="">length_0_conv</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p13</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length c &gt; 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">k</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;cs k &#8712; assume_es(Pre k, Rely k)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">p13</span><span class=""> </span><span class="">p11</span><span class=""> 
</span><span class="">          </span><span class="">cpts_es_sat_rely</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">pes</span><span class=""> </span><span class="">Pre</span><span class=""> </span><span class="">Rely</span><span class=""> </span><span class="">Guar</span><span class=""> </span><span class="">Post</span><span class=""> </span><span class="">pre</span><span class=""> </span><span class="">rely</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">cs</span><span class=""> </span><span class="string">&quot;length (cs k)&quot;</span><span class=""> </span><span class="">k</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">pes_tran_sat_guar</span><span class="delimiter">:</span><span class=""> 
</span><span class="">      </span><span class="string">&quot;&#10214;&#8704;k. &#8872; (pes k) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre k, Rely k, Guar k, Post k]; 
        &#8704;k. pre &#8838; Pre k; 
        &#8704;k. rely &#8838; Rely k; 
        &#8704;k j. j&#8800;k &#10230;  Guar j &#8838; Rely k;
        &#8704;k. Guar k &#8838; guar;
        c &#8712; cpts_of_pes pes s x; c&#8712;assume_pes(pre, rely)&#10215; 
        &#10233;&#8704;i. Suc i &lt; length c &#10230; (&#8707;t. c!i -pes-t&#8594; c!(Suc i))
                &#10230; (gets (c!i),gets (c!Suc i)) &#8712; guar&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. &#8872; (pes k) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre k, Rely k, Guar k, Post k]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. pre &#8838; Pre k&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. rely &#8838; Rely k&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k j. j&#8800;k &#10230;  Guar j &#8838; Rely k&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. Guar k &#8838; guar&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8712; cpts_of_pes pes s x&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c&#8712;assume_pes(pre, rely)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length c&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;t. c!i -pes-t&#8594; c!(Suc i)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;cs. (&#8704;k. (cs k) &#8712; cpts_of_es (pes k) s x) &#8743; c &#8733; cs&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">cpt_imp_exist_conjoin_cs</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">cs</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;k. (cs k) &#8712; cpts_of_es (pes k) s x) &#8743; c &#8733; cs&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;compat_tran c cs&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8707;t k. (c!i -pes-(t&#9839;k)&#8594; c!Suc i) &#8743;
                          (&#8704;k t. (c!i -pes-(t&#9839;k)&#8594; c!Suc i) &#10230; (cs k!i -es-(t&#9839;k)&#8594; cs k! Suc i) &#8743;
                                  (&#8704;k&#39;. k&#39; &#8800; k &#10230; (cs k&#39;!i -ese&#8594; cs k&#39;! Suc i))))
                          &#8744;
                          (((c!i) -pese&#8594; (c!Suc i)) &#8743; (&#8704;k. (((cs k)!i) -ese&#8594; ((cs k)! Suc i))))&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">compat_tran_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172;((c!i) -pese&#8594; (c!Suc i))&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">pes_tran_not_etran1</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;t k. (c!i -pes-(t&#9839;k)&#8594; c!Suc i) &#8743;
                          (&#8704;k t. (c!i -pes-(t&#9839;k)&#8594; c!Suc i) &#10230; (cs k!i -es-(t&#9839;k)&#8594; cs k! Suc i) &#8743;
                                  (&#8704;k&#39;. k&#39; &#8800; k &#10230; (cs k&#39;!i -ese&#8594; cs k&#39;! Suc i)))&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">t</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(c!i -pes-(t&#9839;k)&#8594; c!Suc i) &#8743;
                          (&#8704;k t. (c!i -pes-(t&#9839;k)&#8594; c!Suc i) &#10230; (cs k!i -es-(t&#9839;k)&#8594; cs k! Suc i) &#8743;
                                  (&#8704;k&#39;. k&#39; &#8800; k &#10230; (cs k&#39;!i -ese&#8594; cs k&#39;! Suc i)))&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class="">
</span><span class="">          </span><span class="string">&quot;&#8704;k i. Suc i &lt; length (cs k) &#10230; (&#8707;t.((cs k)!i-es-t&#8594;(cs k)!Suc i)) 
                &#10230; (gets_es ((cs k)!i),gets_es ((cs k)!Suc i)) &#8712; Guar k&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">es_tran_sat_guar</span><span class=""> </span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">pes</span><span class=""> </span><span class="">Pre</span><span class=""> </span><span class="">Rely</span><span class=""> </span><span class="">Guar</span><span class=""> </span><span class="">Post</span><span class=""> </span><span class="">pre</span><span class=""> </span><span class="">rely</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length (cs k) &#10230; (&#8707;t.((cs k)!i-es-t&#8594;(cs k)!Suc i)) 
                &#10230; (gets_es ((cs k)!i),gets_es ((cs k)!Suc i)) &#8712; Guar k&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length c = length (cs k)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class=""> </span><span class="">same_length_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="">a5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(gets_es ((cs k)!i),gets_es ((cs k)!Suc i)) &#8712; Guar k&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;gets_es ((cs k)!i) = gets (c!i)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class=""> </span><span class="">same_state_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;gets_es ((cs k)!Suc i) = gets (c!Suc i)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class=""> </span><span class="">same_state_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a7</span><span class=""> </span><span class="">a8</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets (c!i),gets (c!Suc i)) &#8712; Guar k&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets (c!i),gets (c!Suc i)) &#8712; guar&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">thus</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">parallel_sound</span><span class="delimiter">:</span><span class=""> 
</span><span class="">      </span><span class="string">&quot;&#10214;&#8704;k. &#8872; (pes k) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre k, Rely k, Guar k, Post k]; 
        &#8704;k. pre &#8838; Pre k; 
        &#8704;k. rely &#8838; Rely k; 
        &#8704;k j. j&#8800;k &#10230;  Guar j &#8838; Rely k;
        &#8704;k. Guar k &#8838; guar;
        &#8704;k. Post k &#8838; post&#10215; 
    &#10233; &#8872; pes SAT [pre, rely, guar, post]&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. &#8872; (pes k) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre k, Rely k, Guar k, Post k]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. pre &#8838; Pre k&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. rely &#8838; Rely k&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k j. j&#8800;k &#10230;  Guar j &#8838; Rely k&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. Guar k &#8838; guar&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. Post k &#8838; post&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;s x. (cpts_of_pes pes s x) &#8745; assume_pes(pre, rely) &#8838; commit_pes(guar, post)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c&#8712;(cpts_of_pes pes s x) &#8745; assume_pes(pre, rely)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c&#8712;(cpts_of_pes pes s x) &#8743; c&#8712;assume_pes(pre, rely)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &lt; length c &#10230; (&#8707;t. c!i -pes-t&#8594; c!(Suc i))
            &#10230; (gets (c!i),gets (c!Suc i)) &#8712; guar&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">pes_tran_sat_guar</span><span class=""> </span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">pes</span><span class=""> </span><span class="">Pre</span><span class=""> </span><span class="">Rely</span><span class=""> </span><span class="">Guar</span><span class=""> </span><span class="">Post</span><span class=""> </span><span class="">pre</span><span class=""> </span><span class="">rely</span><span class=""> </span><span class="">guar</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;c&#8712;commit_pes(guar, post)&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">commit_pes_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">pes_validity_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">parallel_seq_sound</span><span class="delimiter">:</span><span class=""> 
</span><span class="">      </span><span class="string">&quot;&#10214;pre &#8838; pre&#39;; rely &#8838; rely&#39;; guar&#39; &#8838; guar; post&#39; &#8838; post;
        &#8872; pes SAT [pre&#39;, rely&#39;, guar&#39;, post&#39;]&#10215; 
    &#10233; &#8872; pes SAT [pre, rely, guar, post]&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;pre &#8838; pre&#39;&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rely &#8838; rely&#39;&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;guar&#39; &#8838; guar&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;post&#39; &#8838; post&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8872; pes SAT [pre&#39;, rely&#39;, guar&#39;, post&#39;]&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;s x. (cpts_of_pes pes s x) &#8745; assume_pes(pre&#39;, rely&#39;) &#8838; commit_pes(guar&#39;, post&#39;)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">pes_validity_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;s x. (cpts_of_pes pes s x) &#8745; assume_pes(pre, rely) &#8838; commit_pes(guar, post)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c&#8712;(cpts_of_pes pes s x) &#8745; assume_pes(pre, rely)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;c&#8712;(cpts_of_pes pes s x) &#8743; c&#8712;assume_pes(pre, rely)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;c&#8712;(cpts_of_pes pes s x) &#8743; c&#8712;assume_pes(pre&#39;, rely&#39;)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assume_pes_imp</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">pre</span><span class=""> </span><span class="">pre&#39;</span><span class=""> </span><span class="">rely</span><span class=""> </span><span class="">rely&#39;</span><span class=""> </span><span class="">c</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;c&#8712;commit_pes(guar&#39;, post&#39;)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;c&#8712;commit_pes(guar, post)&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">commit_pes_imp</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">guar&#39;</span><span class=""> </span><span class="">guar</span><span class=""> </span><span class="">post&#39;</span><span class=""> </span><span class="">post</span><span class=""> </span><span class="">c</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">pes_validity_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">theorem</span></span><span class=""> </span><span class="">rgsound_pes</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8866; rgf_par SAT [pre, rely, guar, post] &#10233; &#8872; paresys_spec rgf_par SAT [pre, rely, guar, post]&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">rghoare_pes.induct</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">pes</span><span class=""> </span><span class="">pre</span><span class=""> </span><span class="">rely</span><span class=""> </span><span class="">guar</span><span class=""> </span><span class="">post</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. &#8866; fst ((pes::&#39;k &#8658; (&#39;l,&#39;k,&#39;s) rgformula_es) k) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k), Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k), Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k), Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k)]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. pre &#8838; Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. rely &#8838; Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k j. j &#8800; k &#10230; Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes j) &#8838; Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k) &#8838; guar&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k) &#8838; post&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;k. &#8872; evtsys_spec (fst (pes k)) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k), Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k), Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k), Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k)]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">k</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8866; fst (pes k) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k), Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k), Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k), Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k)]&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8872; evtsys_spec (fst (pes k)) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k), Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k), Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k), Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k)]&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">rgsound_es</span><span class=""> </span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;fst (pes k)&quot;</span><span class=""> </span><span class="string">&quot;Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k)&quot;</span><span class=""> </span><span class="string">&quot;Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k)&quot;</span><span class=""> </span><span class="string">&quot;Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k)&quot;</span><span class=""> </span><span class="string">&quot;Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k)&quot;</span><span class="delimiter">]</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;&#8872; paresys_spec pes SAT [pre, rely, guar, post]&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">parallel_sound</span><span class=""> </span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;paresys_spec pes&quot;</span><span class=""> </span><span class="string">&quot;Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>&#8728;pes&quot;</span><span class=""> </span><span class="string">&quot;Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>&#8728;pes&quot;</span><span class=""> </span><span class="string">&quot;Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>&#8728;pes&quot;</span><span class=""> </span><span class="string">&quot;Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>&#8728;pes&quot;</span><span class="">
</span><span class="">            </span><span class="">pre</span><span class=""> </span><span class="">rely</span><span class=""> </span><span class="">guar</span><span class=""> </span><span class="">post</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">paresys_spec_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">pre</span><span class=""> </span><span class="">pre&#39;</span><span class=""> </span><span class="">rely</span><span class=""> </span><span class="">rely&#39;</span><span class=""> </span><span class="">guar&#39;</span><span class=""> </span><span class="">guar</span><span class=""> </span><span class="">post&#39;</span><span class=""> </span><span class="">post</span><span class=""> </span><span class="">pesf</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;pre &#8838; pre&#39;&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="string">&quot;rely &#8838; rely&#39;&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="string">&quot;guar&#39; &#8838; guar&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="string">&quot;post&#39; &#8838; post&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="string">&quot;&#8866; pesf SAT [pre&#39;, rely&#39;, guar&#39;, post&#39;]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="string">&quot;&#8872; paresys_spec pesf SAT [pre&#39;, rely&#39;, guar&#39;, post&#39;]&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;&#8872; paresys_spec pesf SAT [pre, rely, guar, post] &quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">parallel_seq_sound</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">pre</span><span class=""> </span><span class="">pre&#39;</span><span class=""> </span><span class="">rely</span><span class=""> </span><span class="">rely&#39;</span><span class=""> </span><span class="">guar&#39;</span><span class=""> </span><span class="">guar</span><span class=""> </span><span class="">post&#39;</span><span class=""> </span><span class="">post</span><span class=""> </span><span class="string">&quot;paresys_spec pesf&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword2"><span class="keyword">end</span></span><span class="">
</span><span class="">
</span></pre>

</div>
</body>
</html>
