<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Theory PiCore_Computation (Isabelle2017: October 2017)</title>
<link media="all" rel="stylesheet" type="text/css" href="isabelle.css"/>
</head>

<body>
<div class="head"><h1>Theory PiCore_Computation</h1>

<span class="command">theory</span> <span class="name">PiCore_Computation</span><br/>
<span class="keyword">imports</span> <a href="PiCore_Semantics.html"><span class="name">PiCore_Semantics</span></a><br/>

</div>
<div class="source">
<pre class="source"><span class="comment">(*
Created by Yongwang Zhao (ywzhao@ntu.edu.sg, zhaoyw@buaa.edu.cn)
School of Computer Engineering, Nanyang Technological University, Singapore
and School of Computer Science &amp; Engineering, Beihang University, China
*)</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">section</span></span><span class=""> </span><span class="cartouche">&#8249;Computations of PiCore Language&#8250;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">theory</span></span><span class=""> </span><span class="">PiCore_Computation</span><span class="">
</span><span class="keyword2"><span class="keyword">imports</span></span><span class=""> </span><span class="">PiCore_Semantics</span><span class="">
</span><span class="keyword2"><span class="keyword">begin</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">subsection</span></span><span class=""> </span><span class="cartouche">&#8249;Environment transitions&#8250;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">inductive_set</span></span><span class="">
</span><span class="">  </span><span class="">petran</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;s pconf &#215; &#39;s pconf) set&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">petran&#39;</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;&#39;s pconf &#8658; &#39;s pconf &#8658; bool&quot;</span><span class="">  </span><span class="delimiter">(</span><span class="string">&quot;_ -pe&#8594; _&quot;</span><span class=""> </span><span class="delimiter">[</span><span class="">81</span><span class="delimiter">,</span><span class="">81</span><span class="delimiter">]</span><span class=""> </span><span class="">80</span><span class="delimiter">)</span><span class="">
</span><span class="keyword2"><span class="keyword">where</span></span><span class="">
</span><span class="">  </span><span class="string">&quot;P -pe&#8594; Q &#8801; (P,Q) &#8712; petran&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">EnvP</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(P, s) -pe&#8594; (P, t)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">petranE</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;p -pe&#8594; p&#39; &#10233; (&#8896;P s t. p = (P, s) &#10233; p&#39; = (P, t) &#10233; Q) &#10233; Q&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">p</span><span class="delimiter">,</span><span class=""> </span><span class="">induct</span><span class=""> </span><span class="">p&#39;</span><span class="delimiter">,</span><span class=""> </span><span class="">erule</span><span class=""> </span><span class="">petran.cases</span><span class="delimiter">,</span><span class=""> </span><span class="">blast</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">inductive_set</span></span><span class="">
</span><span class="">  </span><span class="">eetran</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;((&#39;l,&#39;k,&#39;s) econf &#215; (&#39;l,&#39;k,&#39;s) econf) set&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">eetran&#39;</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) econf &#8658; (&#39;l,&#39;k,&#39;s) econf &#8658; bool&quot;</span><span class="">  </span><span class="delimiter">(</span><span class="string">&quot;_ -ee&#8594; _&quot;</span><span class=""> </span><span class="delimiter">[</span><span class="">81</span><span class="delimiter">,</span><span class="">81</span><span class="delimiter">]</span><span class=""> </span><span class="">80</span><span class="delimiter">)</span><span class="">
</span><span class="keyword2"><span class="keyword">where</span></span><span class="">
</span><span class="">  </span><span class="string">&quot;P -ee&#8594; Q &#8801; (P,Q) &#8712; eetran&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">EnvE</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(P, s, x) -ee&#8594; (P, t, y)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">eetranE</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;p -ee&#8594; p&#39; &#10233; (&#8896;P s t. p = (P, s) &#10233; p&#39; = (P, t) &#10233; Q) &#10233; Q&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">p</span><span class="delimiter">,</span><span class=""> </span><span class="">induct</span><span class=""> </span><span class="">p&#39;</span><span class="delimiter">,</span><span class=""> </span><span class="">erule</span><span class=""> </span><span class="">eetran.cases</span><span class="delimiter">,</span><span class=""> </span><span class="">blast</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">inductive_set</span></span><span class="">
</span><span class="">  </span><span class="">esetran</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;((&#39;l,&#39;k,&#39;s) esconf &#215; (&#39;l,&#39;k,&#39;s) esconf) set&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">esetran&#39;</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) esconf &#8658; (&#39;l,&#39;k,&#39;s) esconf &#8658; bool&quot;</span><span class="">  </span><span class="delimiter">(</span><span class="string">&quot;_ -ese&#8594; _&quot;</span><span class=""> </span><span class="delimiter">[</span><span class="">81</span><span class="delimiter">,</span><span class="">81</span><span class="delimiter">]</span><span class=""> </span><span class="">80</span><span class="delimiter">)</span><span class="">
</span><span class="keyword2"><span class="keyword">where</span></span><span class="">
</span><span class="">  </span><span class="string">&quot;P -ese&#8594; Q &#8801; (P,Q) &#8712; esetran&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">EnvES</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(P, s, x) -ese&#8594; (P, t, y)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">esetranE</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;p -ese&#8594; p&#39; &#10233; (&#8896;P s t. p = (P, s) &#10233; p&#39; = (P, t) &#10233; Q) &#10233; Q&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">p</span><span class="delimiter">,</span><span class=""> </span><span class="">induct</span><span class=""> </span><span class="">p&#39;</span><span class="delimiter">,</span><span class=""> </span><span class="">erule</span><span class=""> </span><span class="">esetran.cases</span><span class="delimiter">,</span><span class=""> </span><span class="">blast</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">inductive_set</span></span><span class="">
</span><span class="">  </span><span class="">pesetran</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;((&#39;l,&#39;k,&#39;s) pesconf &#215; (&#39;l,&#39;k,&#39;s) pesconf) set&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">pesetran&#39;</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) pesconf &#8658; (&#39;l,&#39;k,&#39;s) pesconf &#8658; bool&quot;</span><span class="">  </span><span class="delimiter">(</span><span class="string">&quot;_ -pese&#8594; _&quot;</span><span class=""> </span><span class="delimiter">[</span><span class="">81</span><span class="delimiter">,</span><span class="">81</span><span class="delimiter">]</span><span class=""> </span><span class="">80</span><span class="delimiter">)</span><span class="">
</span><span class="keyword2"><span class="keyword">where</span></span><span class="">
</span><span class="">  </span><span class="string">&quot;P -pese&#8594; Q &#8801; (P,Q) &#8712; pesetran&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">EnvPES</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(P, s, x) -pese&#8594; (P, t, y)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">pesetranE</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;p -pese&#8594; p&#39; &#10233; (&#8896;P s t. p = (P, s) &#10233; p&#39; = (P, t) &#10233; Q) &#10233; Q&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">p</span><span class="delimiter">,</span><span class=""> </span><span class="">induct</span><span class=""> </span><span class="">p&#39;</span><span class="delimiter">,</span><span class=""> </span><span class="">erule</span><span class=""> </span><span class="">pesetran.cases</span><span class="delimiter">,</span><span class=""> </span><span class="">blast</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">subsection</span></span><span class=""> </span><span class="cartouche">&#8249;Sequential computations&#8250;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">subsubsection</span></span><span class=""> </span><span class="cartouche">&#8249;Sequential computations of programs&#8250;</span><span class="">
</span><span class="keyword1"><span class="command">type_synonym</span></span><span class=""> </span><span class="tfree">&#39;s</span><span class=""> </span><span class="">pconfs</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;&#39;s pconf list&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">inductive_set</span></span><span class=""> </span><span class="">cpts_p</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;&#39;s pconfs set&quot;</span><span class="">
</span><span class="keyword2"><span class="keyword">where</span></span><span class="">
</span><span class="">  </span><span class="">CptsPOne</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;[(P,s)] &#8712; cpts_p&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">CptsPEnv</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(P, t)#xs &#8712; cpts_p &#10233; (P,s)#(P,t)#xs &#8712; cpts_p&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">CptsPComp</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;(P,s) -c&#8594; (Q,t); (Q, t)#xs &#8712; cpts_p&#10215; &#10233; (P,s)#(Q,t)#xs &#8712; cpts_p&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">definition</span></span><span class=""> </span><span class="">cpts_of_p</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;s prog) option &#8658; &#39;s &#8658; (&#39;s pconfs) set&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class="">
</span><span class="">  </span><span class="string">&quot;cpts_of_p P s &#8801; {l. l!0=(P,s) &#8743; l &#8712; cpts_p}&quot;</span><span class=""> 
</span><span class="">
</span><span class="keyword1"><span class="command">subsubsection</span></span><span class=""> </span><span class="cartouche">&#8249;Sequential computations of events&#8250;</span><span class="">
</span><span class="keyword1"><span class="command">type_synonym</span></span><span class=""> </span><span class="delimiter">(</span><span class="tfree">&#39;l</span><span class="delimiter">,</span><span class="tfree">&#39;k</span><span class="delimiter">,</span><span class="tfree">&#39;s</span><span class="delimiter">)</span><span class=""> </span><span class="">econfs</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) econf list&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">inductive_set</span></span><span class=""> </span><span class="">cpts_ev</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) econfs set&quot;</span><span class="">
</span><span class="keyword2"><span class="keyword">where</span></span><span class="">
</span><span class="">  </span><span class="">CptsEvOne</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;[(e,s,x)] &#8712; cpts_ev&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">CptsEvEnv</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(e, t, x)#xs &#8712; cpts_ev &#10233; (e, s, y)#(e, t, x)#xs &#8712; cpts_ev&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">CptsEvComp</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;(e1,s,x) -et-ct&#8594; (e2,t,y); (e2,t,y)#xs &#8712; cpts_ev&#10215; &#10233; (e1,s,x)#(e2,t,y)#xs &#8712; cpts_ev&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">definition</span></span><span class=""> </span><span class="">cpts_of_ev</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) event &#8658; &#39;s &#8658; (&#39;l,&#39;k,&#39;s) x &#8658; (&#39;l,&#39;k,&#39;s) econfs set&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class="">
</span><span class="">  </span><span class="string">&quot;cpts_of_ev ev s x &#8801; {l. l!0=(ev,(s,x)) &#8743; l &#8712; cpts_ev}&quot;</span><span class=""> 
</span><span class="">
</span><span class="keyword1"><span class="command">subsubsection</span></span><span class=""> </span><span class="cartouche">&#8249;Sequential computations of event systems&#8250;</span><span class="">
</span><span class="keyword1"><span class="command">type_synonym</span></span><span class=""> </span><span class="delimiter">(</span><span class="tfree">&#39;l</span><span class="delimiter">,</span><span class="tfree">&#39;k</span><span class="delimiter">,</span><span class="tfree">&#39;s</span><span class="delimiter">)</span><span class=""> </span><span class="">esconfs</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) esconf list&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">inductive_set</span></span><span class=""> </span><span class="">cpts_es</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) esconfs set&quot;</span><span class="">
</span><span class="keyword2"><span class="keyword">where</span></span><span class="">
</span><span class="">  </span><span class="">CptsEsOne</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;[(es,s,x)] &#8712; cpts_es&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">CptsEsEnv</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(es, t, x)#xs &#8712; cpts_es &#10233; (es, s, y)#(es, t, x)#xs &#8712; cpts_es&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">CptsEsComp</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;(es1,s,x) -es-ct&#8594; (es2,t,y); (es2,t,y)#xs &#8712; cpts_es&#10215; &#10233; (es1,s,x)#(es2,t,y)#xs &#8712; cpts_es&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">definition</span></span><span class=""> </span><span class="">cpts_of_es</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) esys &#8658; &#39;s &#8658; (&#39;l,&#39;k,&#39;s) x &#8658; (&#39;l,&#39;k,&#39;s) esconfs set&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class="">
</span><span class="">  </span><span class="string">&quot;cpts_of_es es s x &#8801; {l. l!0=(es,s,x) &#8743; l &#8712; cpts_es}&quot;</span><span class=""> 
</span><span class="">
</span><span class="keyword1"><span class="command">subsubsection</span></span><span class=""> </span><span class="cartouche">&#8249;Sequential computations of par event systems&#8250;</span><span class="">
</span><span class="keyword1"><span class="command">type_synonym</span></span><span class=""> </span><span class="delimiter">(</span><span class="tfree">&#39;l</span><span class="delimiter">,</span><span class="tfree">&#39;k</span><span class="delimiter">,</span><span class="tfree">&#39;s</span><span class="delimiter">)</span><span class=""> </span><span class="">pesconfs</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) pesconf list&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">inductive_set</span></span><span class=""> </span><span class="">cpts_pes</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) pesconfs set&quot;</span><span class="">
</span><span class="keyword2"><span class="keyword">where</span></span><span class="">
</span><span class="">  </span><span class="">CptsPesOne</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;[(pes,s,x)] &#8712; cpts_pes&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">CptsPesEnv</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(pes, t, x)#xs &#8712; cpts_pes &#10233; (pes, s, y)#(pes, t, x)#xs &#8712; cpts_pes&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">CptsPesComp</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;(pes1,s,x) -pes-ct&#8594; (pes2,t,y); (pes2,t,y)#xs &#8712; cpts_pes&#10215; &#10233; (pes1,s,x)#(pes2,t,y)#xs &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">definition</span></span><span class=""> </span><span class="">cpts_of_pes</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) paresys &#8658; &#39;s &#8658; (&#39;l,&#39;k,&#39;s) x &#8658; (&#39;l,&#39;k,&#39;s) pesconfs set&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class="">
</span><span class="">  </span><span class="string">&quot;cpts_of_pes pes s x &#8801; {l. l!0=(pes,s,x) &#8743; l &#8712; cpts_pes}&quot;</span><span class=""> 
</span><span class="">
</span><span class="keyword1"><span class="command">subsection</span></span><span class=""> </span><span class="cartouche">&#8249;Modular definition of program computations&#8250;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">definition</span></span><span class=""> </span><span class="">lift</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;&#39;s prog &#8658; &#39;s pconf &#8658; &#39;s pconf&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class="">
</span><span class="">  </span><span class="string">&quot;lift Q &#8801; &#955;(P, s). (if P=None then (Some Q,s) else (Some(Seq (the P) Q), s))&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">inductive_set</span></span><span class=""> </span><span class="">cpt_p_mod</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;s pconfs) set&quot;</span><span class="">
</span><span class="keyword2"><span class="keyword">where</span></span><span class="">
</span><span class="">  </span><span class="">CptPModOne</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;[(P, s)] &#8712; cpt_p_mod&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">CptPModEnv</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(P, t)#xs &#8712; cpt_p_mod &#10233; (P, s)#(P, t)#xs &#8712; cpt_p_mod&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">CptPModNone</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;(Some P, s) -c&#8594; (None, t); (None, t)#xs &#8712; cpt_p_mod &#10215; &#10233; (Some P,s)#(None, t)#xs &#8712;cpt_p_mod&quot;</span><span class="">
</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">CptPModCondT</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;(Some P0, s)#ys &#8712; cpt_p_mod; s &#8712; b &#10215; &#10233; (Some(Cond b P0 P1), s)#(Some P0, s)#ys &#8712; cpt_p_mod&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">CptPModCondF</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;(Some P1, s)#ys &#8712; cpt_p_mod; s &#8713; b &#10215; &#10233; (Some(Cond b P0 P1), s)#(Some P1, s)#ys &#8712; cpt_p_mod&quot;</span><span class="">
</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">CptPModSeq1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;(Some P0, s)#xs &#8712; cpt_p_mod; zs=map (lift P1) xs &#10215;
                 &#10233; (Some(Seq P0 P1), s)#zs &#8712; cpt_p_mod&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">CptPModSeq2</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;&#10214;(Some P0, s)#xs &#8712; cpt_p_mod; fst(last ((Some P0, s)#xs)) = None; 
  (Some P1, snd(last ((Some P0, s)#xs)))#ys &#8712; cpt_p_mod; 
  zs=(map (lift P1) xs)@ys &#10215; &#10233; (Some(Seq P0 P1), s)#zs &#8712; cpt_p_mod&quot;</span><span class="">
</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">CptPModWhile1</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;&#10214; (Some P, s)#xs &#8712; cpt_p_mod; s &#8712; b; zs=map (lift (While b P)) xs &#10215; 
  &#10233; (Some(While b P), s)#(Some(Seq P (While b P)), s)#zs &#8712; cpt_p_mod&quot;</span><span class="">
</span><span class="delimiter">|</span><span class=""> </span><span class="">CptPModWhile2</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;&#10214; (Some P, s)#xs &#8712; cpt_p_mod; fst(last ((Some P, s)#xs))=None; s &#8712; b; 
  zs=(map (lift (While b P)) xs)@ys; 
  (Some(While b P), snd(last ((Some P, s)#xs)))#ys &#8712; cpt_p_mod&#10215; 
  &#10233; (Some(While b P), s)#(Some(Seq P (While b P)), s)#zs &#8712; cpt_p_mod&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">subsection</span></span><span class=""> </span><span class="cartouche">&#8249;Lemmas&#8250;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">subsubsection</span></span><span class=""> </span><span class="cartouche">&#8249;Programs&#8250;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">tl_in_cptn</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214; a#xs &#8712;cpts_p; xs&#8800;[] &#10215; &#10233; xs&#8712;cpts_p&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">elim</span><span class="delimiter">:</span><span class=""> </span><span class="">cpts_p.cases</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">tl_zero</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;P (ys!Suc j) &#10230; Suc j&lt;length ys &#10230; ys&#8800;[] &#10230; P (tl(ys)!j)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">ys</span><span class="delimiter">)</span><span class=""> </span><span class="">simp_all</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">subsubsection</span></span><span class=""> </span><span class="cartouche">&#8249;Events&#8250;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">cpts_e_not_empty</span><span class=""> </span><span class="delimiter">[</span><span class="">simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="string">&quot;[] &#8713; cpts_ev&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">elim</span><span class="delimiter">:</span><span class="">cpts_ev.cases</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">eetran_eqconf</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(e1, s1, x1) -ee&#8594; (e2, s2, x2) &#10233; e1 = e2&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">eetran.cases</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">eetran_eqconf1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;ec1 -ee&#8594; ec2 &#10233; getspc_e ec1 = getspc_e ec2&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;ec1 -ee&#8594; ec2&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">e2</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">s2</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;ec1 = (e1, s1, x1)&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;ec2 = (e2, s2, x2)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">prod_cases3</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;e1 = e2&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">eetran_eqconf</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">getspc_e_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">eqconf_eetran1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;e1 = e2 &#10233; (e1, s1, x1) -ee&#8594; (e2, s2, x2)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">eetran.intros</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">eqconf_eetran</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_e ec1 = getspc_e ec2 &#10233; ec1 -ee&#8594; ec2&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;getspc_e ec1 = getspc_e ec2&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_e_def</span><span class=""> </span><span class="">eetran.EnvE</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">eq_fst_iff</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">cpts_ev_sub0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;el &#8712; cpts_ev; Suc 0 &lt; length el&#10215; &#10233; drop (Suc 0) el &#8712; cpts_ev&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">cpts_ev.cases</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">  
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">cpts_ev_subi</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;el &#8712; cpts_ev; Suc i &lt; length el&#10215; &#10233; drop (Suc i) el &#8712; cpts_ev&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class="string">&quot;el &#8712; cpts_ev&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;Suc i &lt; length el&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;el i. el &#8712; cpts_ev &#8743; Suc i &lt; length el &#10230; drop (Suc i) el &#8712; cpts_ev&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">el</span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;el &#8712; cpts_ev &#8743; Suc i &lt; length el &#10230; drop (Suc i) el &#8712; cpts_ev&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">i</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">cpts_ev_sub0</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Suc</span><span class=""> </span><span class="">j</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; cpts_ev &#8743; Suc j &lt; length el &#10230; drop (Suc j) el &#8712; cpts_ev&quot;</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; cpts_ev &#8743; Suc (Suc j) &lt; length el&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;drop (Suc j) el &#8712; cpts_ev&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">Suc_lessD</span><span class="delimiter">)</span><span class="">                 
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;drop (Suc (Suc j)) el &#8712; cpts_ev&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">cpts_ev_sub0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">notran_confeq0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;el &#8712; cpts_ev; Suc 0 &lt; length el; &#172; (&#8707;t. el ! 0 -et-t&#8594; el ! 1)&#10215;
                      &#10233; getspc_e (el ! 0) = getspc_e (el ! 1)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">cpts_ev.cases</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_e_def</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">notran_confeqi</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;el &#8712; cpts_ev; Suc i &lt; length el; &#172; (&#8707;t. el ! i -et-t&#8594; el ! Suc i)&#10215;
                      &#10233; getspc_e (el ! i) = getspc_e (el ! (Suc i))&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; cpts_ev&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class="">
</span><span class="">           </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length el&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class="">
</span><span class="">           </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172; (&#8707;t. el ! i -et-t&#8594; el ! Suc i)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;el i. el &#8712; cpts_ev &#8743;  Suc i &lt; length el &#8743; &#172; (&#8707;t. el ! i -et-t&#8594; el ! Suc i)
                &#10230; getspc_e (el ! i) = getspc_e (el ! (Suc i))&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">el</span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; cpts_ev &#8743;  Suc i &lt; length el &#8743; &#172; (&#8707;t. el ! i -et-t&#8594; el ! Suc i)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_e (el ! i) = getspc_e (el ! (Suc i))&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">i</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;0.prems&quot;</span><span class=""> </span><span class="">notran_confeq0</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Suc</span><span class=""> </span><span class="">j</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?subel</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;drop (Suc j) el&quot;</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; cpts_ev &#8743; Suc (Suc j) &lt; length el &#8743; &#172; (&#8707;t. el ! Suc j -et-t&#8594; el ! Suc (Suc j))&quot;</span><span class="">            
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?subel &#8712; cpts_ev&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">cpts_ev_subi</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc 0 &lt; length ?subel&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172; (&#8707;t. ?subel ! 0 -et-t&#8594; ?subel ! 1)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_e (?subel ! 0) = getspc_e (?subel ! 1)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">notran_confeq0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Cons_nth_drop_Suc</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">nth_Cons_Suc</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">cpts_ev_onemore</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;el &#8712; cpts_ev; length el &gt; 0; el ! (length el - 1) -et-t&#8594; ec&#10215; &#10233;
                          el @ [ec] &#8712; cpts_ev&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; cpts_ev&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length el &gt; 0&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el ! (length el - 1) -et-t&#8594; ec&quot;</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;el ec t. el &#8712; cpts_ev &#8743; length el &gt; 0 &#8743; el ! (length el - 1) -et-t&#8594; ec &#10230; el @ [ec] &#8712; cpts_ev&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">el</span><span class=""> </span><span class="">ec</span><span class=""> </span><span class="">t</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; cpts_ev&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length el &gt; 0&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el ! (length el - 1) -et-t&#8594; ec&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;el @ [ec] &#8712; cpts_ev&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">el</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsEvOne</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;[(e, s, x)] ! (length [(e, s, x)] - 1) -et-t&#8594; ec&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(e, s, x) -et-t&#8594; ec&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">append_Cons</span><span class=""> </span><span class="">append_Nil</span><span class=""> </span><span class="">cpts_ev.CptsEvComp</span><span class=""> 
</span><span class="">                  </span><span class="">cpts_ev.CptsEvOne</span><span class=""> </span><span class="">surj_pair</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsEvEnv</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">xs</span><span class=""> </span><span class="">s2</span><span class=""> </span><span class="">y</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(e, s1, x) # xs &#8712; cpts_ev&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;0 &lt; length ((e, s1, x) # xs) &#10233;
                        ((e, s1, x) # xs) ! (length ((e, s1, x) # xs) - 1) -et-t&#8594; ec 
                        &#10233; ((e, s1, x) # xs) @ [ec] &#8712; cpts_ev&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;0 &lt; length ((e, s2, y) # (e, s1, x) # xs)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;((e, s2, y) # (e, s1, x) # xs) ! (length ((e, s2, y) # (e, s1, x) # xs) - 1) -et-t&#8594; ec&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;xs = []&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;xs = []&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(e, s1, x)-et-t&#8594; ec&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;((e, s1, x) # xs) @ [ec] &#8712; cpts_ev&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">cpts_ev.CptsEvEnv</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;xs &#8800; []&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;last xs -et-t&#8594; ec&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">last_conv_nth</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;((e, s1, x) # xs) @ [ec] &#8712; cpts_ev&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">cpts_ev.CptsEvEnv</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsEvComp</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">et</span><span class=""> </span><span class="">e2</span><span class=""> </span><span class="">t1</span><span class=""> </span><span class="">y1</span><span class=""> </span><span class="">xs1</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(e1, s1, x1) -et-et&#8594; (e2, t1, y1)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(e2, t1, y1) # xs1 &#8712; cpts_ev&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;0 &lt; length ((e2, t1, y1) # xs1) &#10233;
                ((e2, t1, y1) # xs1) ! (length ((e2, t1, y1) # xs1) - 1) -et-t&#8594; ec 
                  &#10233; ((e2, t1, y1) # xs1) @ [ec] &#8712; cpts_ev&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;0 &lt; length ((e1, s1, x1) # (e2, t1, y1) # xs1)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;((e1, s1, x1) # (e2, t1, y1) # xs1) ! (length ((e1, s1, x1) # (e2, t1, y1) # xs1) - 1) -et-t&#8594; ec&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;xs1 = []&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;xs1 = []&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(e2, t1, y1)-et-t&#8594; ec&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;((e2, t1, y1) # xs1) @ [ec] &#8712; cpts_ev&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_ev.CptsEvComp</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;xs1 &#8800; []&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;last xs1 -et-t&#8594; ec&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">last_conv_nth</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;((e2, t1, y1) # xs1) @ [ec] &#8712; cpts_ev&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">cpts_ev.CptsEvComp</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;el @ [ec] &#8712; cpts_ev&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">cpts_ev_same</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;length el &gt; 0; &#8704;i. i &lt; length el &#10230; getspc_e (el!i) = es&#10215; &#10233; el &#8712; cpts_ev&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length el &gt; 0&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. i &lt; length el &#10230; getspc_e (el!i) = es&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;el es. length el &gt; 0 &#8743; (&#8704;i. i &lt; length el &#10230; getspc_e (el!i) = es) &#10230; el &#8712; cpts_ev&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">el</span><span class=""> </span><span class="">es</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length el &gt; 0&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. i &lt; length el &#10230; getspc_e (el!i) = es&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;el &#8712; cpts_ev&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">el</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">Nil</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Nil.prems</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Cons</span><span class=""> </span><span class="">a</span><span class=""> </span><span class="">as</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;0 &lt; length as &#10233; &#8704;i&lt;length as. getspc_e (as ! i) = es &#10233; as &#8712; cpts_ev&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;0 &lt; length (a # as)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i&lt;length (a # as). getspc_e ((a # as) ! i) = es&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;as = []&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;as = []&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">cpts_ev.CptsEvOne</span><span class=""> </span><span class="">old.prod.exhaust</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(as = [])&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">b</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">bs</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;as = b # bs&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">neq_Nil_conv</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;0 &lt; length as&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i&lt;length as. getspc_e (as ! i) = es &#10233; as &#8712; cpts_ev&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;as &#8712; cpts_ev&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_e a = es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_e b = es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">getspc_e_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">cpts_ev.CptsEvEnv</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">prod_cases3</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">subsubsection</span></span><span class=""> </span><span class="cartouche">&#8249;Event systems&#8250;</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">cpts_es_not_empty</span><span class=""> </span><span class="delimiter">[</span><span class="">simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="string">&quot;[] &#8713; cpts_es&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">elim</span><span class="delimiter">:</span><span class="">cpts_es.cases</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">esetran_eqconf</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(es1, s1, x1) -ese&#8594; (es2, s2, x2) &#10233; es1 = es2&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">esetran.cases</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">esetran_eqconf1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esc1 -ese&#8594; esc2 &#10233; getspc_es esc1 = getspc_es esc2&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esc1 -ese&#8594; esc2&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">es1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">es2</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">s2</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esc1 = (es1, s1, x1)&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esc2 = (es2, s2, x2)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">prod_cases3</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;es1 = es2&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">esetran_eqconf</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">getspc_es_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">eqconf_esetran1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;es1 = es2 &#10233; (es1, s1, x1) -ese&#8594; (es2, s2, x2)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">esetran.intros</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">eqconf_esetran</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es esc1 = getspc_es esc2 &#10233; esc1 -ese&#8594; esc2&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es esc1 = getspc_es esc2&quot;</span><span class="">
</span><span class="">    </span><span class="comment">(*then show ?thesis using getspc_es_def esetran.EnvES by (metis eq_fst_iff)*)</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">es1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esc1 = (es1, s1, x1)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">prod_cases3</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">    </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">es2</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">s2</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esc2 = (es2, s2, x2)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">prod_cases3</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;es1 = es2&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(es1, s1, x1) -ese&#8594; (es2, s2, x2)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">eqconf_esetran1</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">exist_estran</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;(es1, s1, x1) # (es, s, x) # esl &#8712; cpts_es; es1 &#8800; es&#10215; &#10233; (&#8707;est. (es1, s1, x1) -es-est&#8594; (es, s, x))&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">cpts_es.cases</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">cpts_es_drop0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;el &#8712; cpts_es; Suc 0 &lt; length el&#10215; &#10233; drop (Suc 0) el &#8712; cpts_es&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">cpts_es.cases</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">  
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">cpts_es_dropi</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;el &#8712; cpts_es; Suc i &lt; length el&#10215; &#10233; drop (Suc i) el &#8712; cpts_es&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class="string">&quot;el &#8712; cpts_es&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;Suc i &lt; length el&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;el i. el &#8712; cpts_es &#8743; Suc i &lt; length el &#10230; drop (Suc i) el &#8712; cpts_es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">el</span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;el &#8712; cpts_es &#8743; Suc i &lt; length el &#10230; drop (Suc i) el &#8712; cpts_es&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">i</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">cpts_es_drop0</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Suc</span><span class=""> </span><span class="">j</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; cpts_es &#8743; Suc j &lt; length el &#10230; drop (Suc j) el &#8712; cpts_es&quot;</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; cpts_es &#8743; Suc (Suc j) &lt; length el&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;drop (Suc j) el &#8712; cpts_es&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">Suc_lessD</span><span class="delimiter">)</span><span class="">                 
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;drop (Suc (Suc j)) el &#8712; cpts_es&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">cpts_es_drop0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">cpts_es_dropi2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;el &#8712; cpts_es; i &lt; length el&#10215; &#10233; drop i el &#8712; cpts_es&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_es_dropi</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">hide_lams</span><span class="delimiter">)</span><span class=""> </span><span class="">drop_0</span><span class=""> </span><span class="">lessI</span><span class=""> </span><span class="">less_Suc_eq_0_disj</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">cpts_es_take0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;el &#8712; cpts_es; i &lt; length el; el1 = take (Suc i) el; j &lt; length el1&#10215; 
                        &#10233; drop (length el1 - Suc j) el1 &#8712; cpts_es&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; cpts_es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i &lt; length el&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el1 = take (Suc i) el&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j &lt; length el1&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i j. el &#8712; cpts_es &#8743; i &lt; length el &#8743; el1 = take (Suc i) el &#8743; j &lt; length el1 
          &#10230; drop (length el1 - Suc j) el1 &#8712; cpts_es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class=""> </span><span class="">j</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; cpts_es&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i &lt; length el&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el1 = take (Suc i) el&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j &lt; length el1&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;drop (length el1 - Suc j) el1 &#8712; cpts_es&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">j</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">0</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;drop (length el1 - Suc 0) el1 = [el ! i]&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">take_Suc_conv_app_nth</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">cpts_es.CptsEsOne</span><span class=""> </span><span class="">old.prod.exhaust</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Suc</span><span class=""> </span><span class="">jj</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; cpts_es &#10233; i &lt; length el &#10233; el1 = take (Suc i) el 
                        &#10233; jj &lt; length el1 &#10233; drop (length el1 - Suc jj) el1 &#8712; cpts_es&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; cpts_es&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i &lt; length el&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el1 = take (Suc i) el&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc jj &lt; length el1&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;drop (length el1 - Suc jj) el1 &#8712; cpts_es&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?el2</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;drop (Suc i) el&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el1 @ ?el2 = el&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?el1sht</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;drop (length el1 - Suc jj) el1&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?el1lng</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;drop (length el1 - Suc (Suc jj)) el1&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?elsht</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;drop (length el1 - Suc jj) el&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?ellng</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;drop (length el1 - Suc (Suc jj)) el&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el1sht @ ?el2 = ?elsht&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">diff_is_0_eq</span><span class=""> </span><span class="">diff_le_self</span><span class=""> </span><span class="">drop_0</span><span class=""> </span><span class="">drop_append</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el1lng @ ?el2 = ?ellng&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">a7</span><span class=""> </span><span class="">append_eq_append_conv</span><span class=""> </span><span class="">diff_is_0_eq&#39;</span><span class=""> </span><span class="">diff_le_self</span><span class=""> </span><span class="">drop_append</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?ellng = (el ! (length el1 - Suc (Suc jj))) # ?elsht&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Cons_nth_drop_Suc</span><span class=""> </span><span class="">Suc_diff_Suc</span><span class=""> </span><span class="">Suc_leI</span><span class=""> </span><span class="">a8</span><span class=""> 
</span><span class="">                  </span><span class="">append_is_Nil_conv</span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="">diff_diff_cancel</span><span class=""> </span><span class="">drop_all</span><span class=""> </span><span class="">length_drop</span><span class=""> 
</span><span class="">                  </span><span class="">list.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">not_less</span><span class=""> </span><span class="">old.nat.distinct</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a10</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?elsht &#8712; cpts_es&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">a7</span><span class=""> </span><span class="">append_is_Nil_conv</span><span class=""> </span><span class="">b5</span><span class=""> </span><span class="">cpts_es_dropi2</span><span class=""> </span><span class="">drop_all</span><span class=""> </span><span class="">not_less</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a11</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?ellng &#8712; cpts_es&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">a9</span><span class=""> </span><span class="">cpts_es_dropi2</span><span class=""> </span><span class="">drop_all</span><span class=""> </span><span class="">list.simps</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">not_less</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a12</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el1lng = (el ! (length el1 - Suc (Suc jj))) # ?el1sht&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Cons_nth_drop_Suc</span><span class=""> </span><span class="">Suc_diff_Suc</span><span class=""> 
</span><span class="">                </span><span class="">b4</span><span class=""> </span><span class="">b6</span><span class=""> </span><span class="">diff_less</span><span class=""> </span><span class="">gr_implies_not0</span><span class=""> </span><span class="">length_0_conv</span><span class=""> </span><span class="">length_greater_0_conv</span><span class=""> 
</span><span class="">                </span><span class="">nth_append</span><span class=""> </span><span class="">zero_less_Suc</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a11</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?el1lng &#8712; cpts_es&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="var">?ellng</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">CptsEsOne</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">CptsEsOne.hyps</span><span class=""> </span><span class="">a7</span><span class=""> </span><span class="">a9</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsEsEnv</span><span class=""> </span><span class="">es1</span><span class=""> </span><span class="">t1</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">xs1</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">y1</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(es1, t1, x1) # xs1 &#8712; cpts_es&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(es1, t1, x1) # xs1 = drop (length el1 - Suc (Suc jj)) el &#10233;
                            drop (length el1 - Suc (Suc jj)) el1 &#8712; cpts_es&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(es1, s1, y1) # (es1, t1, x1) # xs1 = drop (length el1 - Suc (Suc jj)) el&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(es1, s1, y1) # (es1, t1, x1) # xs1 &#8712; cpts_es&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">a11</span><span class=""> </span><span class="">c2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el1sht ! 0 = (es1, t1, x1)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_leI</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">a7</span><span class=""> 
</span><span class="">                        </span><span class="">a9</span><span class=""> </span><span class="">append_eq_Cons_conv</span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="">diff_diff_cancel</span><span class=""> </span><span class="">length_drop</span><span class=""> </span><span class="">list.inject</span><span class=""> 
</span><span class="">                        </span><span class="">list.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">old.nat.distinct</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;el1sht&#39;. ?el1sht = (es1, t1, x1) # el1sht&#39;&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Cons_nth_drop_Suc</span><span class=""> </span><span class="">b4</span><span class=""> 
</span><span class="">                    </span><span class="">diff_diff_cancel</span><span class=""> </span><span class="">drop_0</span><span class=""> </span><span class="">length_drop</span><span class=""> </span><span class="">less_or_eq_imp_le</span><span class=""> </span><span class="">zero_less_Suc</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el1lng = (es1, s1, y1) # ?el1sht&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a12</span><span class=""> </span><span class="">a9</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b5</span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_es.CptsEsEnv</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsEsComp</span><span class=""> </span><span class="">es1</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">et</span><span class=""> </span><span class="">es2</span><span class=""> </span><span class="">t1</span><span class=""> </span><span class="">y1</span><span class=""> </span><span class="">xs1</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(es1, s1, x1) -es-et&#8594; (es2, t1, y1)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(es2, t1, y1) # xs1 &#8712; cpts_es&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(es2, t1, y1) # xs1 = drop (length el1 - Suc (Suc jj)) el 
                            &#10233; drop (length el1 - Suc (Suc jj)) el1 &#8712; cpts_es&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">c3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(es1, s1, x1) # (es2, t1, y1) # xs1 = drop (length el1 - Suc (Suc jj)) el&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el1sht ! 0 = (es2, t1, y1)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_leI</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">a7</span><span class=""> 
</span><span class="">                        </span><span class="">a9</span><span class=""> </span><span class="">append_eq_Cons_conv</span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">diff_diff_cancel</span><span class=""> </span><span class="">length_drop</span><span class=""> </span><span class="">list.inject</span><span class=""> 
</span><span class="">                        </span><span class="">list.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">old.nat.distinct</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;el1sht&#39;. ?el1sht = (es2, t1, y1) # el1sht&#39;&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Cons_nth_drop_Suc</span><span class=""> </span><span class="">b4</span><span class=""> 
</span><span class="">                    </span><span class="">diff_diff_cancel</span><span class=""> </span><span class="">drop_0</span><span class=""> </span><span class="">length_drop</span><span class=""> </span><span class="">less_or_eq_imp_le</span><span class=""> </span><span class="">zero_less_Suc</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el1lng = (es1, s1, x1) # ?el1sht&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a12</span><span class=""> </span><span class="">a9</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b5</span><span class=""> </span><span class="">c5</span><span class="">  </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">cpts_es.CptsEsComp</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;drop (length el1 - Suc j) el1 &#8712; cpts_es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">cpts_es_take</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;el &#8712; cpts_es; i &lt; length el&#10215; &#10233; take (Suc i) el &#8712; cpts_es&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_es_take0</span><span class=""> </span><span class="">gr_implies_not0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">cpts_es_seg</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;el &#8712; cpts_es; m &#8804; length el; n &#8804; length el; m &lt; n&#10215; 
                    &#10233; take (n - m) (drop m el) &#8712; cpts_es&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; cpts_es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m &#8804; length el&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;n &#8804; length el&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m &lt; n&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;drop m el &#8712; cpts_es&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_es_dropi</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">drop_0</span><span class=""> </span><span class="">le_0_eq</span><span class=""> </span><span class="">le_SucE</span><span class=""> </span><span class="">less_le_trans</span><span class=""> </span><span class="">zero_induct</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_es_take</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">cpts_es_dropi2</span><span class=""> </span><span class="">drop_take</span><span class=""> </span><span class="">inc_induct</span><span class=""> 
</span><span class="">        </span><span class="">leD</span><span class=""> </span><span class="">le_SucE</span><span class=""> </span><span class="">length_take</span><span class=""> </span><span class="">min.absorb2</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">cpts_es_seg2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;el &#8712; cpts_es; m &#8804; length el; n &#8804; length el; take (n - m) (drop m el) &#8800; []&#10215; 
                    &#10233; take (n - m) (drop m el) &#8712; cpts_es&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; cpts_es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m &#8804; length el&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;n &#8804; length el&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;take (n - m) (drop m el) &#8800; []&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;m &lt; n&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_es_seg</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">cpts_es_same</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;length el &gt; 0; &#8704;i. i &lt; length el &#10230; getspc_es (el!i) = es&#10215; &#10233; el &#8712; cpts_es&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length el &gt; 0&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. i &lt; length el &#10230; getspc_es (el!i) = es&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;el es. length el &gt; 0 &#8743; (&#8704;i. i &lt; length el &#10230; getspc_es (el!i) = es) &#10230; el &#8712; cpts_es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">el</span><span class=""> </span><span class="">es</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length el &gt; 0&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. i &lt; length el &#10230; getspc_es (el!i) = es&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;el &#8712; cpts_es&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">el</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">Nil</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Nil.prems</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Cons</span><span class=""> </span><span class="">a</span><span class=""> </span><span class="">as</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;0 &lt; length as &#10233; &#8704;i&lt;length as. getspc_es (as ! i) = es &#10233; as &#8712; cpts_es&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;0 &lt; length (a # as)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i&lt;length (a # as). getspc_es ((a # as) ! i) = es&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;as = []&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;as = []&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">cpts_es.CptsEsOne</span><span class=""> </span><span class="">old.prod.exhaust</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(as = [])&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">b</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">bs</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;as = b # bs&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">neq_Nil_conv</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;0 &lt; length as&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i&lt;length as. getspc_es (as ! i) = es &#10233; as &#8712; cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;as &#8712; cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es a = es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es b = es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">cpts_es.CptsEsEnv</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">prod_cases3</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">noevtent_inmid_eq</span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;(&#172; (&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl &#8743; getspc_es (esl ! j) = EvtSys es &#8743; getspc_es (esl ! Suc j) &#8800; EvtSys es))
      = (&#8704;j. j &gt; 0 &#8743; Suc j &lt; length esl &#10230; getspc_es (esl ! j) = EvtSys es &#10230; getspc_es (esl ! Suc j) = EvtSys es)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">evtseq_next_in_cpts</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;esl&#8712;cpts_es &#10233; &#8704;i. Suc i &lt; length esl &#8743; getspc_es (esl!i) = EvtSeq e esys
                       &#10230; getspc_es (esl!Suc i) = esys &#8744; (&#8707;e. getspc_es (esl!Suc i) = EvtSeq e esys)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;cpts_es&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length esl&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl!i) = EvtSeq e esys&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esl1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;drop i esl&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl1&#8712;cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">hide_lams</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_diff_1</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> 
</span><span class="">              </span><span class="">cpts_es_dropi</span><span class=""> </span><span class="">diff_diff_cancel</span><span class=""> </span><span class="">drop_0</span><span class=""> </span><span class="">length_drop</span><span class=""> </span><span class="">length_greater_0_conv</span><span class=""> 
</span><span class="">              </span><span class="">less_or_eq_imp_le</span><span class=""> </span><span class="">list.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (?esl1!0) = EvtSeq e esys&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl1!0 = (EvtSeq e esys,s1,x1)&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">old.prod.exhaust</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (?esl1!1) = esys &#8744; (&#8707;e. getspc_es (?esl1!1) = EvtSeq e esys)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="var">?esl1</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsEsOne</span><span class=""> </span><span class="">es&#39;</span><span class=""> </span><span class="">s&#39;</span><span class=""> </span><span class="">x&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_eq_plus1_left</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">a0</span><span class=""> 
</span><span class="">                </span><span class="">le_add_diff_inverse2</span><span class=""> </span><span class="">length_Cons</span><span class=""> </span><span class="">length_drop</span><span class=""> </span><span class="">less_imp_le</span><span class=""> 
</span><span class="">                </span><span class="">list.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">not_less_iff_gr_or_eq</span><span class="delimiter">)</span><span class="">  
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsEsEnv</span><span class=""> </span><span class="">es&#39;</span><span class=""> </span><span class="">t&#39;</span><span class=""> </span><span class="">x&#39;</span><span class=""> </span><span class="">xs&#39;</span><span class=""> </span><span class="">s&#39;</span><span class=""> </span><span class="">y&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(es&#39;, s&#39;, y&#39;) # (es&#39;, t&#39;, x&#39;) # xs&#39; = drop i esl&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl ! i) = EvtSeq e esys&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;es&#39; = EvtSeq e esys&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">nth_Cons_0</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (drop i esl ! 1) = EvtSeq e esys&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">nth_Cons_Suc</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsEsComp</span><span class=""> </span><span class="">es1&#39;</span><span class=""> </span><span class="">s&#39;</span><span class=""> </span><span class="">x&#39;</span><span class=""> </span><span class="">et&#39;</span><span class=""> </span><span class="">es2&#39;</span><span class=""> </span><span class="">t&#39;</span><span class=""> </span><span class="">y&#39;</span><span class=""> </span><span class="">xs&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(es1&#39;, s&#39;, x&#39;) -es-et&#39;&#8594; (es2&#39;, t&#39;, y&#39;)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(es1&#39;, s&#39;, x&#39;) # (es2&#39;, t&#39;, y&#39;) # xs&#39; = drop i esl&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl ! i) = EvtSeq e esys&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;es1&#39; = EvtSeq e esys&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Pair_inject</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">nth_Cons_0</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;es2&#39; = esys &#8744; (&#8707;e. es2&#39; = EvtSeq e esys)&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtseq_tran_sys_or_seq</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">nth_Cons_Suc</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (esl!Suc i) = esys &#8744; (&#8707;e. getspc_es (esl!Suc i) = EvtSeq e esys)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">evtseq_next_in_cpts_anony</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;esl&#8712;cpts_es &#10233; &#8704;i. Suc i &lt; length esl &#8743; getspc_es (esl!i) = EvtSeq e esys &#8743; is_anonyevt e
                       &#10230; getspc_es (esl!Suc i) = esys 
                        &#8744; (&#8707;e. getspc_es (esl!Suc i) = EvtSeq e esys &#8743; is_anonyevt e)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;cpts_es&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length esl&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl!i) = EvtSeq e esys &#8743; is_anonyevt e&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esl1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;drop i esl&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl1&#8712;cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">hide_lams</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_diff_1</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> 
</span><span class="">              </span><span class="">cpts_es_dropi</span><span class=""> </span><span class="">diff_diff_cancel</span><span class=""> </span><span class="">drop_0</span><span class=""> </span><span class="">length_drop</span><span class=""> </span><span class="">length_greater_0_conv</span><span class=""> 
</span><span class="">              </span><span class="">less_or_eq_imp_le</span><span class=""> </span><span class="">list.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (?esl1!0) = EvtSeq e esys&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl1!0 = (EvtSeq e esys,s1,x1)&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">old.prod.exhaust</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (?esl1!1) = esys 
                        &#8744; (&#8707;e. getspc_es (?esl1!1) = EvtSeq e esys &#8743; is_anonyevt e)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="var">?esl1</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsEsOne</span><span class=""> </span><span class="">es&#39;</span><span class=""> </span><span class="">s&#39;</span><span class=""> </span><span class="">x&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_eq_plus1_left</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">a0</span><span class=""> 
</span><span class="">                </span><span class="">le_add_diff_inverse2</span><span class=""> </span><span class="">length_Cons</span><span class=""> </span><span class="">length_drop</span><span class=""> </span><span class="">less_imp_le</span><span class=""> 
</span><span class="">                </span><span class="">list.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">not_less_iff_gr_or_eq</span><span class="delimiter">)</span><span class="">  
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsEsEnv</span><span class=""> </span><span class="">es&#39;</span><span class=""> </span><span class="">t&#39;</span><span class=""> </span><span class="">x&#39;</span><span class=""> </span><span class="">xs&#39;</span><span class=""> </span><span class="">s&#39;</span><span class=""> </span><span class="">y&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(es&#39;, s&#39;, y&#39;) # (es&#39;, t&#39;, x&#39;) # xs&#39; = drop i esl&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl ! i) = EvtSeq e esys &#8743; is_anonyevt e&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;es&#39; = EvtSeq e esys&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">nth_Cons_0</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (drop i esl ! 1) = EvtSeq e esys &#8743; is_anonyevt e&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">nth_Cons_Suc</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsEsComp</span><span class=""> </span><span class="">es1&#39;</span><span class=""> </span><span class="">s&#39;</span><span class=""> </span><span class="">x&#39;</span><span class=""> </span><span class="">et&#39;</span><span class=""> </span><span class="">es2&#39;</span><span class=""> </span><span class="">t&#39;</span><span class=""> </span><span class="">y&#39;</span><span class=""> </span><span class="">xs&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(es1&#39;, s&#39;, x&#39;) -es-et&#39;&#8594; (es2&#39;, t&#39;, y&#39;)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(es1&#39;, s&#39;, x&#39;) # (es2&#39;, t&#39;, y&#39;) # xs&#39; = drop i esl&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl ! i) = EvtSeq e esys &#8743; is_anonyevt e&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;es1&#39; = EvtSeq e esys&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Pair_inject</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">nth_Cons_0</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;es2&#39; = esys &#8744; (&#8707;e. es2&#39; = EvtSeq e esys &#8743; is_anonyevt e)&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtseq_tran_sys_or_seq_anony</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">nth_Cons_Suc</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (esl!Suc i) = esys 
          &#8744; (&#8707;e. getspc_es (esl!Suc i) = EvtSeq e esys &#8743; is_anonyevt e)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">evtsys_next_in_cpts</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;esl&#8712;cpts_es &#10233; &#8704;i. Suc i &lt; length esl &#8743; getspc_es (esl!i) = EvtSys es 
                       &#10230; getspc_es (esl!Suc i) = EvtSys es &#8744; (&#8707;e. getspc_es (esl!Suc i) = EvtSeq e (EvtSys es))&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;cpts_es&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length esl&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl!i) = EvtSys es&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esl1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;drop i esl&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl1&#8712;cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">hide_lams</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_diff_1</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> 
</span><span class="">              </span><span class="">cpts_es_dropi</span><span class=""> </span><span class="">diff_diff_cancel</span><span class=""> </span><span class="">drop_0</span><span class=""> </span><span class="">length_drop</span><span class=""> </span><span class="">length_greater_0_conv</span><span class=""> 
</span><span class="">              </span><span class="">less_or_eq_imp_le</span><span class=""> </span><span class="">list.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (?esl1!0) = EvtSys es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl1!0 = (EvtSys es,s1,x1)&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">old.prod.exhaust</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (?esl1!1) = EvtSys es &#8744; (&#8707;e. getspc_es (?esl1!1) = EvtSeq e (EvtSys es))&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="var">?esl1</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsEsOne</span><span class=""> </span><span class="">es&#39;</span><span class=""> </span><span class="">s&#39;</span><span class=""> </span><span class="">x&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_eq_plus1_left</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">a0</span><span class=""> 
</span><span class="">                </span><span class="">le_add_diff_inverse2</span><span class=""> </span><span class="">length_Cons</span><span class=""> </span><span class="">length_drop</span><span class=""> </span><span class="">less_imp_le</span><span class=""> 
</span><span class="">                </span><span class="">list.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">not_less_iff_gr_or_eq</span><span class="delimiter">)</span><span class="">  
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsEsEnv</span><span class=""> </span><span class="">es&#39;</span><span class=""> </span><span class="">t&#39;</span><span class=""> </span><span class="">x&#39;</span><span class=""> </span><span class="">xs&#39;</span><span class=""> </span><span class="">s&#39;</span><span class=""> </span><span class="">y&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(es&#39;, s&#39;, y&#39;) # (es&#39;, t&#39;, x&#39;) # xs&#39; = drop i esl&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl ! i) = EvtSys es&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;es&#39; = EvtSys es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">nth_Cons_0</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (drop i esl ! 1) = EvtSys es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">nth_Cons_Suc</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsEsComp</span><span class=""> </span><span class="">es1&#39;</span><span class=""> </span><span class="">s&#39;</span><span class=""> </span><span class="">x&#39;</span><span class=""> </span><span class="">et&#39;</span><span class=""> </span><span class="">es2&#39;</span><span class=""> </span><span class="">t&#39;</span><span class=""> </span><span class="">y&#39;</span><span class=""> </span><span class="">xs&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(es1&#39;, s&#39;, x&#39;) -es-et&#39;&#8594; (es2&#39;, t&#39;, y&#39;)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(es1&#39;, s&#39;, x&#39;) # (es2&#39;, t&#39;, y&#39;) # xs&#39; = drop i esl&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl ! i) = EvtSys es&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;es1&#39; = EvtSys es&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Pair_inject</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">nth_Cons_0</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;e. es2&#39; = EvtSeq e (EvtSys es)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsys_evtent</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">e</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;es2&#39; = EvtSeq e (EvtSys es)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;e. getspc_es (drop i esl ! 1) = EvtSeq e (EvtSys es)&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">eq_fst_iff</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">nth_Cons_Suc</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (esl!Suc i) = EvtSys es &#8744; (&#8707;e. getspc_es (esl!Suc i) = EvtSeq e (EvtSys es))&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">evtsys_next_in_cpts_anony</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;esl&#8712;cpts_es &#10233; &#8704;i. Suc i &lt; length esl &#8743; getspc_es (esl!i) = EvtSys es 
                       &#10230; getspc_es (esl!Suc i) = EvtSys es 
                        &#8744; (&#8707;e. getspc_es (esl!Suc i) = EvtSeq e (EvtSys es) &#8743; is_anonyevt e)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;cpts_es&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length esl&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl!i) = EvtSys es&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esl1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;drop i esl&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl1&#8712;cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">hide_lams</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_diff_1</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> 
</span><span class="">              </span><span class="">cpts_es_dropi</span><span class=""> </span><span class="">diff_diff_cancel</span><span class=""> </span><span class="">drop_0</span><span class=""> </span><span class="">length_drop</span><span class=""> </span><span class="">length_greater_0_conv</span><span class=""> 
</span><span class="">              </span><span class="">less_or_eq_imp_le</span><span class=""> </span><span class="">list.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (?esl1!0) = EvtSys es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl1!0 = (EvtSys es,s1,x1)&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">old.prod.exhaust</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (?esl1!1) = EvtSys es 
          &#8744; (&#8707;e. getspc_es (?esl1!1) = EvtSeq e (EvtSys es) &#8743; is_anonyevt e)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="var">?esl1</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsEsOne</span><span class=""> </span><span class="">es&#39;</span><span class=""> </span><span class="">s&#39;</span><span class=""> </span><span class="">x&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_eq_plus1_left</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">a0</span><span class=""> 
</span><span class="">                </span><span class="">le_add_diff_inverse2</span><span class=""> </span><span class="">length_Cons</span><span class=""> </span><span class="">length_drop</span><span class=""> </span><span class="">less_imp_le</span><span class=""> 
</span><span class="">                </span><span class="">list.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">not_less_iff_gr_or_eq</span><span class="delimiter">)</span><span class="">  
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsEsEnv</span><span class=""> </span><span class="">es&#39;</span><span class=""> </span><span class="">t&#39;</span><span class=""> </span><span class="">x&#39;</span><span class=""> </span><span class="">xs&#39;</span><span class=""> </span><span class="">s&#39;</span><span class=""> </span><span class="">y&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(es&#39;, s&#39;, y&#39;) # (es&#39;, t&#39;, x&#39;) # xs&#39; = drop i esl&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl ! i) = EvtSys es&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;es&#39; = EvtSys es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">nth_Cons_0</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (drop i esl ! 1) = EvtSys es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">nth_Cons_Suc</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsEsComp</span><span class=""> </span><span class="">es1&#39;</span><span class=""> </span><span class="">s&#39;</span><span class=""> </span><span class="">x&#39;</span><span class=""> </span><span class="">et&#39;</span><span class=""> </span><span class="">es2&#39;</span><span class=""> </span><span class="">t&#39;</span><span class=""> </span><span class="">y&#39;</span><span class=""> </span><span class="">xs&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(es1&#39;, s&#39;, x&#39;) -es-et&#39;&#8594; (es2&#39;, t&#39;, y&#39;)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(es1&#39;, s&#39;, x&#39;) # (es2&#39;, t&#39;, y&#39;) # xs&#39; = drop i esl&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl ! i) = EvtSys es&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;es1&#39; = EvtSys es&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Pair_inject</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">nth_Cons_0</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;e. es2&#39; = EvtSeq e (EvtSys es)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsys_evtent</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">e</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;es2&#39; = EvtSeq e (EvtSys es)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;e. getspc_es (drop i esl ! 1) = EvtSeq e (EvtSys es) &#8743; is_anonyevt e&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class="">  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">ent_spec2&#39;</span><span class=""> </span><span class="">evtsysent_evtent0</span><span class=""> 
</span><span class="">                </span><span class="">fst_conv</span><span class=""> </span><span class="">is_anonyevt.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">noevtent_notran</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">nth_Cons_Suc</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (esl!Suc i) = EvtSys es 
            &#8744; (&#8707;e. getspc_es (esl!Suc i) = EvtSeq e (EvtSys es) &#8743; is_anonyevt e)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">evtsys_all_es_in_cpts</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#10214;esl&#8712;cpts_es; length esl &gt; 0; getspc_es (esl!0) = EvtSys es &#10215; &#10233;
        &#8704;i. i &lt; length esl &#10230; getspc_es (esl!i) = EvtSys es &#8744; (&#8707;e. getspc_es (esl!i) = EvtSeq e (EvtSys es))&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;cpts_es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length esl &gt; 0&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl!0) = EvtSys es&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i &lt; length esl&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (esl!i) = EvtSys es &#8744; (&#8707;e. getspc_es (esl!i) = EvtSeq e (EvtSys es))&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">i</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">0</span><span class=""> </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Suc</span><span class=""> </span><span class="">j</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j &lt; length esl &#10233; 
                        getspc_es (esl ! j) = EvtSys es &#8744; (&#8707;e. getspc_es (esl ! j) = EvtSeq e (EvtSys es))&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc j &lt; length esl&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (esl ! j) = EvtSys es &#8744; (&#8707;e. getspc_es (esl ! j) = EvtSeq e (EvtSys es))&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class=""> 
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl ! j) = EvtSys es&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsys_next_in_cpts</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;e. getspc_es (esl ! j) = EvtSeq e (EvtSys es)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtseq_next_in_cpts</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">evtsys_all_es_in_cpts_anony</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#10214;esl&#8712;cpts_es; length esl &gt; 0; getspc_es (esl!0) = EvtSys es &#10215; &#10233;
        &#8704;i. i &lt; length esl &#10230; getspc_es (esl!i) = EvtSys es 
            &#8744; (&#8707;e. getspc_es (esl!i) = EvtSeq e (EvtSys es) &#8743; is_anonyevt e)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;cpts_es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length esl &gt; 0&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl!0) = EvtSys es&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i &lt; length esl&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (esl!i) = EvtSys es &#8744; (&#8707;e. getspc_es (esl!i) = EvtSeq e (EvtSys es) &#8743; is_anonyevt e)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">i</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">0</span><span class=""> </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Suc</span><span class=""> </span><span class="">j</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j &lt; length esl &#10233; 
                        getspc_es (esl ! j) = EvtSys es 
                        &#8744; (&#8707;e. getspc_es (esl ! j) = EvtSeq e (EvtSys es) &#8743; is_anonyevt e)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc j &lt; length esl&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (esl ! j) = EvtSys es 
                    &#8744; (&#8707;e. getspc_es (esl ! j) = EvtSeq e (EvtSys es) &#8743; is_anonyevt e)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class=""> 
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl ! j) = EvtSys es&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsys_next_in_cpts_anony</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;e. getspc_es (esl ! j) = EvtSeq e (EvtSys es) &#8743; is_anonyevt e&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtseq_next_in_cpts_anony</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">not_anonyevt_none_in_evtseq</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="string">&quot;&#10214;esl&#8712;cpts_es; esl = (EvtSeq e es,s1,x1)#(es,s2,x2)#xs &#10215; &#10233; e &#8800; AnonyEvent None&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">cpts_es.cases</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Suc_eq_plus1</span><span class=""> </span><span class="">add.commute</span><span class=""> </span><span class="">add.right_neutral</span><span class=""> </span><span class="">esys.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">le_add1</span><span class=""> </span><span class="">lessI</span><span class=""> </span><span class="">not_le</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">estran.cases</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Suc_eq_plus1</span><span class=""> </span><span class="">add.commute</span><span class=""> </span><span class="">add.right_neutral</span><span class=""> </span><span class="">esys.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">le_add1</span><span class=""> </span><span class="">lessI</span><span class=""> </span><span class="">not_le</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">etran.cases</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span><span class=""> </span><span class="">2</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">ptran.cases</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">not_anonyevt_none_in_evtseq1</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="string">&quot;&#10214;esl&#8712;cpts_es; length esl &gt; 1; getspc_es (esl!0) = EvtSeq e es;
      getspc_es (esl!1) = es &#10215; &#10233; e &#8800; AnonyEvent None&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">not_anonyevt_none_in_evtseq</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">hide_lams</span><span class="delimiter">)</span><span class=""> </span><span class="">Cons_nth_drop_Suc</span><span class=""> </span><span class="">drop_0</span><span class=""> </span><span class="">eq_fst_iff</span><span class=""> </span><span class="">less_Suc_eq</span><span class=""> </span><span class="">less_Suc_eq_0_disj</span><span class=""> </span><span class="">less_one</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">fst_esys_snd_eseq_exist_evtent</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="string">&quot;&#10214;esl&#8712;cpts_es; esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs&#10215; &#10233;
          &#8707;t. (EvtSys es, s, x) -es-t&#8594; (EvtSeq ev (EvtSys es), s1,x1)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">cpts_es.cases</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">fst_esys_snd_eseq_exist_evtent2</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="string">&quot;&#10214;esl&#8712;cpts_es; esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs&#10215; &#10233;
          &#8707;e k. (EvtSys es, s, x) -es-(EvtEnt (BasicEvent e))&#9839;k&#8594; (EvtSeq ev (EvtSys es), s1,x1)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">cpts_es.cases</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">hide_lams</span><span class="delimiter">)</span><span class=""> </span><span class="">cmd_enable_impl_notesys2</span><span class=""> </span><span class="">estran_impl_evtentorcmd</span><span class=""> 
</span><span class="">    </span><span class="">evtent_is_basicevt</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">nth_Cons_Suc</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">  
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">fst_esys_snd_eseq_exist</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;&#10214;esl&#8712;cpts_es; length esl &#8805; 2 &#8743; getspc_es (esl!0) = EvtSys es &#8743; getspc_es (esl!1) &#8800; EvtSys es&#10215;
    &#10233; &#8707;s x ev s1 x1 xs. esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length esl &#8805; 2 &#8743; getspc_es (esl!0) = EvtSys es &#8743; getspc_es (esl!1) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;cpts_es&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl!0) = EvtSys es &#8743; getspc_es (esl!1) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">    
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;2 &#8804; length esl&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;s x. esl!0 = (EvtSys es, s, x)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">eq_fst_iff</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;ev s1 x1. esl!1 = (EvtSeq ev (EvtSys es), s1,x1)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;ev. getspc_es (esl!1) = EvtSeq ev (EvtSys es)&quot;</span><span class=""> 
</span><span class="">           </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_1</span><span class=""> </span><span class="">Suc_le_lessD</span><span class=""> </span><span class="">evtsys_next_in_cpts</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">surj_pair</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">hide_lams</span><span class="delimiter">)</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_1</span><span class=""> 
</span><span class="">      </span><span class="">Suc_n_not_le_n</span><span class=""> </span><span class="">diff_is_0_eq</span><span class=""> </span><span class="">hd_Cons_tl</span><span class=""> </span><span class="">hd_conv_nth</span><span class=""> </span><span class="">length_tl</span><span class=""> 
</span><span class="">      </span><span class="">list.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">not_numeral_le_zero</span><span class=""> </span><span class="">nth_Cons_Suc</span><span class=""> </span><span class="">order_trans</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">  
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">notevtent_cptses_isenvorcmd</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;&#10214;esl&#8712;cpts_es; length esl &#8805; 2; &#172; (&#8707;e k. esl ! 0 -es-EvtEnt e&#9839;k&#8594; esl ! 1)&#10215; 
    &#10233; esl ! 0 -ese&#8594; esl ! 1 &#8744; (&#8707;c k. esl ! 0 -es-Cmd c&#9839;k&#8594; esl ! 1)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">cpts_es.cases</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">esetran.intros</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">estran_impl_evtentorcmd2</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">nth_Cons_Suc</span><span class="delimiter">)</span><span class=""> 
</span><span class=""> 
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">only_envtran_to_basicevt</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;esl&#8712;cpts_es &#10233; &#8704;i. Suc i &lt; length esl &#8743; (&#8707;e. getspc_es (esl!i) = EvtSeq e esys) 
                      &#8743; getspc_es (esl!Suc i) = EvtSeq (BasicEvent e) esys
                        &#10230; getspc_es (esl!i) = EvtSeq (BasicEvent e) esys&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;cpts_es&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length esl&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl!Suc i) = EvtSeq (BasicEvent e) esys&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a00</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;e. getspc_es (esl!i) = EvtSeq e esys&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esl1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;drop i esl&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl1&#8712;cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">hide_lams</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_diff_1</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> 
</span><span class="">              </span><span class="">cpts_es_dropi</span><span class=""> </span><span class="">diff_diff_cancel</span><span class=""> </span><span class="">drop_0</span><span class=""> </span><span class="">length_drop</span><span class=""> </span><span class="">length_greater_0_conv</span><span class=""> 
</span><span class="">              </span><span class="">less_or_eq_imp_le</span><span class=""> </span><span class="">list.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (?esl1!1) = EvtSeq (BasicEvent e) esys&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl1!1 = (EvtSeq (BasicEvent e) esys,s1,x1)&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">old.prod.exhaust</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (?esl1!0) = EvtSeq (BasicEvent e) esys&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="var">?esl1</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsEsOne</span><span class=""> </span><span class="">es&#39;</span><span class=""> </span><span class="">s&#39;</span><span class=""> </span><span class="">x&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_eq_plus1_left</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">a0</span><span class=""> 
</span><span class="">                </span><span class="">le_add_diff_inverse2</span><span class=""> </span><span class="">length_Cons</span><span class=""> </span><span class="">length_drop</span><span class=""> </span><span class="">less_imp_le</span><span class=""> 
</span><span class="">                </span><span class="">list.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">not_less_iff_gr_or_eq</span><span class="delimiter">)</span><span class="">  
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsEsEnv</span><span class=""> </span><span class="">es&#39;</span><span class=""> </span><span class="">t&#39;</span><span class=""> </span><span class="">x&#39;</span><span class=""> </span><span class="">xs&#39;</span><span class=""> </span><span class="">s&#39;</span><span class=""> </span><span class="">y&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(es&#39;, s&#39;, y&#39;) # (es&#39;, t&#39;, x&#39;) # xs&#39; = drop i esl&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl ! Suc i) = EvtSeq (BasicEvent e) esys&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;es&#39; = EvtSeq (BasicEvent e) esys&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">nth_Cons_Suc</span><span class=""> </span><span class="">prod.inject</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">nth_Cons_0</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsEsComp</span><span class=""> </span><span class="">es1&#39;</span><span class=""> </span><span class="">s&#39;</span><span class=""> </span><span class="">x&#39;</span><span class=""> </span><span class="">et&#39;</span><span class=""> </span><span class="">es2&#39;</span><span class=""> </span><span class="">t&#39;</span><span class=""> </span><span class="">y&#39;</span><span class=""> </span><span class="">xs&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(es1&#39;, s&#39;, x&#39;) -es-et&#39;&#8594; (es2&#39;, t&#39;, y&#39;)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(es1&#39;, s&#39;, x&#39;) # (es2&#39;, t&#39;, y&#39;) # xs&#39; = drop i esl&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl ! Suc i) = EvtSeq (BasicEvent e) esys&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;es2&#39; = EvtSeq (BasicEvent e) esys&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">Pair_inject</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">nth_Cons_Suc</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a00</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">e&#39;</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">b4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl ! i) = EvtSeq e&#39; esys&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;es1&#39; = EvtSeq e&#39; esys&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">CptsEsComp.hyps</span><span class="delimiter">(</span><span class="">4</span><span class="delimiter">)</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">nth_via_drop</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172; (&#8707;e. es2&#39; = EvtSeq (BasicEvent e) esys)&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">notrans_to_basicevt_insameesys</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">es1&#39;</span><span class=""> </span><span class="">s&#39;</span><span class=""> </span><span class="">x&#39;</span><span class=""> </span><span class="">et&#39;</span><span class=""> </span><span class="">es2&#39;</span><span class=""> </span><span class="">t&#39;</span><span class=""> </span><span class="">y&#39;</span><span class=""> </span><span class="">esys</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">incpts_es_impl_evnorcomptran</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;esl&#8712;cpts_es &#10233; &#8704;i. Suc i &lt; length esl &#10230; esl ! i -ese&#8594; esl ! Suc i &#8744; (&#8707;et. esl ! i -es-et&#8594; esl ! Suc i)&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;cpts_es&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length esl&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esl1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;take 2 (drop i esl)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;take (Suc (Suc i) - i) (drop i esl) &#8712; cpts_es&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_es_seg</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">esl</span><span class=""> </span><span class="">i</span><span class=""> </span><span class="string">&quot;Suc (Suc i)&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?esl1 &#8712; cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">esc1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl ! i = (esc1,s1,x1)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">prod_cases3</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">  
</span><span class="">      </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">esc2</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">s2</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl ! Suc i = (esc2,s2,x2)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">prod_cases3</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">  
</span><span class="">      </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;esl ! i = ?esl1 ! 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Cons_nth_drop_Suc</span><span class=""> </span><span class="">Suc_lessD</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;esl ! Suc i = ?esl1 ! 1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Cons_nth_drop_Suc</span><span class=""> </span><span class="">Suc_lessD</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(esc1, s1, x1)#[(esc2, s2, x2)] &#8712; cpts_es&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Cons_nth_drop_Suc</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">numeral_2_eq_2</span><span class=""> </span><span class="">take_0</span><span class=""> </span><span class="">take_Suc_Cons</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(esc1, s1, x1) -ese&#8594; (esc2, s2, x2) &#8744; (&#8707;et. (esc1, s1, x1) -es-et&#8594; (esc2, s2, x2))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">cpts_es.cases</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">esetran.intros</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;esl ! i -ese&#8594; esl ! Suc i &#8744; (&#8707;et. esl ! i -es-et&#8594; esl ! Suc i)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">incpts_es_eseq_not_evtent</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#10214;esl&#8712;cpts_es; Suc i &lt; length esl; &#8707;e esys. getspc_es (esl!i) = EvtSeq e esys &#8743; is_anonyevt e&#10215; 
    &#10233; &#172;(&#8707;e k. t = EvtEnt e &#8743; esl!i -es-t&#9839;k&#8594; esl!Suc i)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;cpts_es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length esl&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;e esys. getspc_es (esl!i) = EvtSeq e esys &#8743; is_anonyevt e&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esl1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;drop i esl&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl1&#8712;cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">hide_lams</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_diff_1</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> 
</span><span class="">          </span><span class="">cpts_es_dropi</span><span class=""> </span><span class="">diff_diff_cancel</span><span class=""> </span><span class="">drop_0</span><span class=""> </span><span class="">length_drop</span><span class=""> </span><span class="">length_greater_0_conv</span><span class=""> 
</span><span class="">          </span><span class="">less_or_eq_imp_le</span><span class=""> </span><span class="">list.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">e</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">esys</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (?esl1!0) = EvtSeq e esys&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl1!0 = (EvtSeq e esys,s1,x1)&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">old.prod.exhaust</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172;(&#8707;e k. t = EvtEnt e &#8743; ?esl1!0 -es-t&#9839;k&#8594; ?esl1!1)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="var">?esl1</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsEsOne</span><span class=""> </span><span class="">es&#39;</span><span class=""> </span><span class="">s&#39;</span><span class=""> </span><span class="">x&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_eq_plus1_left</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">a0</span><span class=""> 
</span><span class="">              </span><span class="">le_add_diff_inverse2</span><span class=""> </span><span class="">length_Cons</span><span class=""> </span><span class="">length_drop</span><span class=""> </span><span class="">less_imp_le</span><span class=""> 
</span><span class="">              </span><span class="">list.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">not_less_iff_gr_or_eq</span><span class="delimiter">)</span><span class="">  
</span><span class="">        </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsEsEnv</span><span class=""> </span><span class="">es&#39;</span><span class=""> </span><span class="">t&#39;</span><span class=""> </span><span class="">x&#39;</span><span class=""> </span><span class="">xs&#39;</span><span class=""> </span><span class="">s&#39;</span><span class=""> </span><span class="">y&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(es&#39;, s&#39;, y&#39;) # (es&#39;, t&#39;, x&#39;) # xs&#39; = ?esl1&quot;</span><span class="">
</span><span class="">            </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (?esl1 ! 0) = EvtSeq e esys&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;es&#39; = EvtSeq e esys&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Pair_inject</span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="">nth_Cons_0</span><span class="delimiter">)</span><span class="">  
</span><span class="">          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">mono_tags</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">evtseq_no_evtent2</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">nth_via_drop</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsEsComp</span><span class=""> </span><span class="">es1&#39;</span><span class=""> </span><span class="">s&#39;</span><span class=""> </span><span class="">x&#39;</span><span class=""> </span><span class="">et&#39;</span><span class=""> </span><span class="">es2&#39;</span><span class=""> </span><span class="">t&#39;</span><span class=""> </span><span class="">y&#39;</span><span class=""> </span><span class="">xs&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(es1&#39;, s&#39;, x&#39;) -es-et&#39;&#8594; (es2&#39;, t&#39;, y&#39;)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(es1&#39;, s&#39;, x&#39;) # (es2&#39;, t&#39;, y&#39;) # xs&#39; = drop i esl&quot;</span><span class="">
</span><span class="">            </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (?esl1 ! 0) = EvtSeq e esys&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;es1&#39; = EvtSeq e esys&quot;</span><span class="">
</span><span class="">             </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Pair_inject</span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="">nth_Cons_0</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">evtseq_no_evtent2</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">nth_via_drop</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">        
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Cons_nth_drop_Suc</span><span class=""> </span><span class="">Suc_lessD</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">evtsys_not_eq_in_tran_aux</span><span class="delimiter">:</span><span class="string">&quot;(P,s,x) -es-est&#8594; (Q,t,y) &#10233; P &#8800; Q&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">estran.cases</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">evt_not_eq_in_tran_aux</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">evt_not_eq_in_tran_aux</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">add.right_neutral</span><span class=""> </span><span class="">add_Suc_right</span><span class=""> </span><span class="">esys.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">lessI</span><span class=""> </span><span class="">less_irrefl</span><span class=""> </span><span class="">trans_less_add2</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">evtsys_not_eq_in_tran_aux1</span><span class="delimiter">:</span><span class="string">&quot;esc1 -es-est&#8594; esc2 &#10233; getspc_es esc1 &#8800; getspc_es esc2&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esc1 -es-est&#8594; esc2&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">es1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">es2</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">s2</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esc1 = (es1,s1,x1) &#8743; esc2 = (es2,s2,x2)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">prod.collapse</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;es1 &#8800; es2&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsys_not_eq_in_tran_aux</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">evtsys_not_eq_in_tran</span><span class=""> </span><span class="delimiter">[</span><span class="">simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172; (P,s,x) -es-est&#8594; (P,t,y)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule</span><span class=""> </span><span class="">evtsys_not_eq_in_tran_aux</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">evtsys_not_eq_in_tran2</span><span class=""> </span><span class="delimiter">[</span><span class="">simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(&#8707;est. (P,s,x) -es-est&#8594; (P,t,y))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">es_tran_not_etran2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(P,s,x) -es-pt&#8594; (Q,t,y) &#10233; &#172;((P,s,x) -ese&#8594;(Q,t,y))&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">esetran.cases</span><span class=""> </span><span class="">evtsys_not_eq_in_tran_aux</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">es_tran_not_etran1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esc1 -es-pt&#8594; esc2 &#10233; &#172;(esc1 -ese&#8594;esc2)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">esetran_eqconf1</span><span class=""> </span><span class="">evtsys_not_eq_in_tran_aux1</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">subsubsection</span></span><span class=""> </span><span class="cartouche">&#8249;Parallel event systems&#8250;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">cpts_pes_not_empty</span><span class=""> </span><span class="delimiter">[</span><span class="">simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="string">&quot;[] &#8713; cpts_pes&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">elim</span><span class="delimiter">:</span><span class="">cpts_pes.cases</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">pesetran_eqconf</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(es1, s1, x1) -pese&#8594; (es2, s2, x2) &#10233; es1 = es2&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">pesetran.cases</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">pesetran_eqconf1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esc1 -pese&#8594; esc2 &#10233; getspc esc1 = getspc esc2&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esc1 -pese&#8594; esc2&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">es1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">es2</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">s2</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esc1 = (es1, s1, x1)&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esc2 = (es2, s2, x2)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">prod_cases3</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;es1 = es2&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">pesetran_eqconf</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">getspc_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">eqconf_pesetran1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;es1 = es2 &#10233; (es1, s1, x1) -pese&#8594; (es2, s2, x2)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">pesetran.intros</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">eqconf_pesetran</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc esc1 = getspc esc2 &#10233; esc1 -pese&#8594; esc2&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc esc1 = getspc esc2&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">es1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esc1 = (es1, s1, x1)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">prod_cases3</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">    </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">es2</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">s2</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esc2 = (es2, s2, x2)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">prod_cases3</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;es1 = es2&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(es1, s1, x1) -pese&#8594; (es2, s2, x2)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">eqconf_pesetran1</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">pestran_cpts_pes</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;C1 -pes-ct&#8594; C2; C2#xs &#8712; cpts_pes&#10215; &#10233; C1#C2#xs &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;C1 -pes-ct&#8594; C2&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;C2#xs &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">pes1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;C1 = (pes1,s1,x1)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">prod_cases3</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">pes2</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">s2</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;C2 = (pes2,s2,x2)&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">prod_cases3</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">cpts_pes.CptsPesComp</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">cpts_pes_onemore</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;el &#8712; cpts_pes; (el ! (length el - 1) -pes-t&#8594; ec) &#8744; (el ! (length el - 1) -pese&#8594; ec)&#10215; &#10233;
                          el @ [ec] &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(el ! (length el - 1) -pes-t&#8594; ec) &#8744; (el ! (length el - 1) -pese&#8594; ec)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8800; []&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;el ec t. el &#8712; cpts_pes &#8743; ((el ! (length el - 1) -pes-t&#8594; ec) &#8744; (el ! (length el - 1) -pese&#8594; ec)) 
      &#10230; el @ [ec] &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">el</span><span class=""> </span><span class="">ec</span><span class=""> </span><span class="">t</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(el ! (length el - 1) -pes-t&#8594; ec) &#8744; (el ! (length el - 1) -pese&#8594; ec)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length el &gt; 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;el @ [ec] &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">el</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsPesOne</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;([(e, s, x)] ! (length [(e, s, x)] - 1) -pes-t&#8594; ec) 
                          &#8744; [(e, s, x)] ! (length [(e, s, x)] - 1) -pese&#8594; ec&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;((e, s, x) -pes-t&#8594; ec) &#8744; ((e, s, x) -pese&#8594; ec)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class="">  
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;(e, s, x) -pes-t&#8594; ec&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">append_Cons</span><span class=""> </span><span class="">append_Nil</span><span class=""> 
</span><span class="">                    </span><span class="">cpts_pes.CptsPesComp</span><span class=""> </span><span class="">cpts_pes.CptsPesOne</span><span class=""> </span><span class="">surj_pair</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;(e, s, x) -pese&#8594; ec&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">append_Cons</span><span class=""> </span><span class="">append_Nil</span><span class=""> </span><span class="">cpts_pes.CptsPesEnv</span><span class=""> 
</span><span class="">                      </span><span class="">cpts_pes.CptsPesOne</span><span class=""> </span><span class="">pesetranE</span><span class=""> </span><span class="">surj_pair</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsPesEnv</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">xs</span><span class=""> </span><span class="">s2</span><span class=""> </span><span class="">y</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(e, s1, x) # xs &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;0 &lt; length ((e, s1, x) # xs) &#10233;
                          (((e, s1, x) # xs) ! (length ((e, s1, x) # xs) - 1) -pes-t&#8594; ec) &#8744;
                          (((e, s1, x) # xs) ! (length ((e, s1, x) # xs) - 1) -pese&#8594; ec) &#10233;
                          ((e, s1, x) # xs) @ [ec] &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;0 &lt; length ((e, s2, y) # (e, s1, x) # xs)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(((e, s2, y) # (e, s1, x) # xs) ! (length ((e, s2, y) # (e, s1, x) # xs) - 1) -pes-t&#8594; ec) &#8744;
                        (((e, s2, y) # (e, s1, x) # xs) ! (length ((e, s2, y) # (e, s1, x) # xs) - 1) -pese&#8594; ec)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;xs = []&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;xs = []&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;((e, s1, x) -pes-t&#8594; ec) &#8744; ((e, s1, x) -pese&#8594; ec)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;((e, s1, x) # xs) @ [ec] &#8712; cpts_pes&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">cpts_pes.CptsPesEnv</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;xs &#8800; []&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(last xs -pes-t&#8594; ec) &#8744; (last xs -pese&#8594; ec)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">last_conv_nth</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;((e, s1, x) # xs) @ [ec] &#8712; cpts_pes&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">cpts_pes.CptsPesEnv</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsPesComp</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">et</span><span class=""> </span><span class="">e2</span><span class=""> </span><span class="">t1</span><span class=""> </span><span class="">y1</span><span class=""> </span><span class="">xs1</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(e1, s1, x1) -pes-et&#8594; (e2, t1, y1)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(e2, t1, y1) # xs1 &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;0 &lt; length ((e2, t1, y1) # xs1) &#10233;
                        (((e2, t1, y1) # xs1) ! (length ((e2, t1, y1) # xs1) - 1) -pes-t&#8594; ec) &#8744;
                        (((e2, t1, y1) # xs1) ! (length ((e2, t1, y1) # xs1) - 1) -pese&#8594; ec) &#10233;
                        ((e2, t1, y1) # xs1) @ [ec] &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;0 &lt; length ((e1, s1, x1) # (e2, t1, y1) # xs1)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(((e1, s1, x1) # (e2, t1, y1) # xs1) ! (length ((e1, s1, x1) # (e2, t1, y1) # xs1) - 1) -pes-t&#8594; ec) &#8744;
                        ((e1, s1, x1) # (e2, t1, y1) # xs1) ! (length ((e1, s1, x1) # (e2, t1, y1) # xs1) - 1) -pese&#8594; ec&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;xs1 = []&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;xs1 = []&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;((e2, t1, y1) -pes-t&#8594; ec) &#8744; ((e2, t1, y1) -pese&#8594; ec)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;((e2, t1, y1) # xs1) @ [ec] &#8712; cpts_pes&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_pes.CptsPesComp</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;xs1 &#8800; []&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(last xs1 -pes-t&#8594; ec) &#8744; (last xs1 -pese&#8594; ec)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">last_conv_nth</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;((e2, t1, y1) # xs1) @ [ec] &#8712; cpts_pes&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">cpts_pes.CptsPesComp</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;el @ [ec] &#8712; cpts_pes&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">pes_not_eq_in_tran_aux</span><span class="delimiter">:</span><span class="string">&quot;(P,s,x) -pes-est&#8594; (Q,t,y) &#10233; P &#8800; Q&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">pestran.cases</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">evtsys_not_eq_in_tran_aux</span><span class=""> </span><span class="">fun_upd_apply</span><span class="delimiter">)</span><span class="">
</span><span class="">  
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">pes_not_eq_in_tran</span><span class=""> </span><span class="delimiter">[</span><span class="">simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172; (P,s,x) -pes-est&#8594; (P,t,y)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule</span><span class=""> </span><span class="">pes_not_eq_in_tran_aux</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">pes_tran_not_etran1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;pes1 -pes-t&#8594; pes2 &#10233; &#172;(pes1 -pese&#8594;pes2)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">pes_not_eq_in_tran</span><span class=""> </span><span class="">pesetranE</span><span class=""> </span><span class="">surj_pair</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">pes_tran_not_etran2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(P,s,x) -pes-pt&#8594; (Q,t,y) &#10233; &#172;((P,s,x) -pese&#8594;(Q,t,y))&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">pes_tran_not_etran1</span><span class="delimiter">)</span><span class="">
</span><span class="">  
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">incpts_pes_impl_evnorcomptran</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;esl&#8712;cpts_pes &#10233; &#8704;i. Suc i &lt; length esl &#10230; esl ! i -pese&#8594; esl ! Suc i &#8744; (&#8707;et. esl ! i -pes-et&#8594; esl ! Suc i)&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;cpts_pes&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">esl</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsPesOne</span><span class="delimiter">)</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsPesEnv</span><span class=""> </span><span class="">pes</span><span class=""> </span><span class="">t</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">xs</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">y</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(pes, t, x) # xs &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &lt; length ((pes, t, x) # xs) &#10230;
                      ((pes, t, x) # xs) ! i -pese&#8594; ((pes, t, x) # xs) ! Suc i &#8744;
                      (&#8707;et. ((pes, t, x) # xs) ! i -pes-et&#8594; ((pes, t, x) # xs) ! Suc i)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length ((pes, s, y) # (pes, t, x) # xs)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;((pes, s, y) # (pes, t, x) # xs) ! i -pese&#8594; ((pes, s, y) # (pes, t, x) # xs) ! Suc i &#8744;
                  (&#8707;et. ((pes, s, y) # (pes, t, x) # xs) ! i -pes-et&#8594; ((pes, s, y) # (pes, t, x) # xs) ! Suc i)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;i = 0&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i = 0&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">eqconf_pesetran1</span><span class=""> </span><span class="">nth_Cons&#39;</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i &#8800; 0&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;i &gt; 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">length_Cons</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsPesComp</span><span class=""> </span><span class="">pes1</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">ct</span><span class=""> </span><span class="">pes2</span><span class=""> </span><span class="">t</span><span class=""> </span><span class="">y</span><span class=""> </span><span class="">xs</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(pes1, s, x) -pes-ct&#8594; (pes2, t, y)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(pes2, t, y) # xs &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &lt; length ((pes2, t, y) # xs) &#10230;
                      ((pes2, t, y) # xs) ! i -pese&#8594; ((pes2, t, y) # xs) ! Suc i &#8744;
                      (&#8707;et. ((pes2, t, y) # xs) ! i -pes-et&#8594; ((pes2, t, y) # xs) ! Suc i)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length ((pes1, s, x) # (pes2, t, y) # xs)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;((pes1, s, x) # (pes2, t, y) # xs) ! i -pese&#8594; ((pes1, s, x) # (pes2, t, y) # xs) ! Suc i &#8744;
                  (&#8707;et. ((pes1, s, x) # (pes2, t, y) # xs) ! i -pes-et&#8594; ((pes1, s, x) # (pes2, t, y) # xs) ! Suc i)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;i = 0&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i = 0&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">nth_Cons_Suc</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i &#8800; 0&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;i &gt; 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Suc_inject</span><span class=""> </span><span class="">Suc_less_eq2</span><span class=""> </span><span class="">Suc_pred</span><span class=""> 
</span><span class="">                  </span><span class="">length_Cons</span><span class=""> </span><span class="">nth_Cons_Suc</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">cpts_pes_drop0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;el &#8712; cpts_pes; Suc 0 &lt; length el&#10215; &#10233; drop (Suc 0) el &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">cpts_pes.cases</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">  
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">cpts_pes_dropi</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;el &#8712; cpts_pes; Suc i &lt; length el&#10215; &#10233; drop (Suc i) el &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class="string">&quot;el &#8712; cpts_pes&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class="string">&quot;Suc i &lt; length el&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;el i. el &#8712; cpts_pes &#8743; Suc i &lt; length el &#10230; drop (Suc i) el &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">el</span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;el &#8712; cpts_pes &#8743; Suc i &lt; length el &#10230; drop (Suc i) el &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">i</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">cpts_pes_drop0</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Suc</span><span class=""> </span><span class="">j</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; cpts_pes &#8743; Suc j &lt; length el &#10230; drop (Suc j) el &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; cpts_pes &#8743; Suc (Suc j) &lt; length el&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;drop (Suc j) el &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">Suc_lessD</span><span class="delimiter">)</span><span class="">                 
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;drop (Suc (Suc j)) el &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">cpts_pes_drop0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">cpts_pes_take0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;el &#8712; cpts_pes; i &lt; length el; el1 = take (Suc i) el; j &lt; length el1&#10215; 
                        &#10233; drop (length el1 - Suc j) el1 &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i &lt; length el&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el1 = take (Suc i) el&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j &lt; length el1&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i j. el &#8712; cpts_pes &#8743; i &lt; length el &#8743; el1 = take (Suc i) el &#8743; j &lt; length el1 
          &#10230; drop (length el1 - Suc j) el1 &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class=""> </span><span class="">j</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i &lt; length el&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el1 = take (Suc i) el&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j &lt; length el1&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;drop (length el1 - Suc j) el1 &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">j</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">0</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;drop (length el1 - Suc 0) el1 = [el ! i]&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">take_Suc_conv_app_nth</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">cpts_pes.CptsPesOne</span><span class=""> </span><span class="">old.prod.exhaust</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Suc</span><span class=""> </span><span class="">jj</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; cpts_pes &#10233; i &lt; length el &#10233; el1 = take (Suc i) el 
                        &#10233; jj &lt; length el1 &#10233; drop (length el1 - Suc jj) el1 &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i &lt; length el&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el1 = take (Suc i) el&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc jj &lt; length el1&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;drop (length el1 - Suc jj) el1 &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?el2</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;drop (Suc i) el&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el1 @ ?el2 = el&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?el1sht</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;drop (length el1 - Suc jj) el1&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?el1lng</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;drop (length el1 - Suc (Suc jj)) el1&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?elsht</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;drop (length el1 - Suc jj) el&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?ellng</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;drop (length el1 - Suc (Suc jj)) el&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el1sht @ ?el2 = ?elsht&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">diff_is_0_eq</span><span class=""> </span><span class="">diff_le_self</span><span class=""> </span><span class="">drop_0</span><span class=""> </span><span class="">drop_append</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el1lng @ ?el2 = ?ellng&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">a7</span><span class=""> </span><span class="">append_eq_append_conv</span><span class=""> </span><span class="">diff_is_0_eq&#39;</span><span class=""> </span><span class="">diff_le_self</span><span class=""> </span><span class="">drop_append</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?ellng = (el ! (length el1 - Suc (Suc jj))) # ?elsht&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Cons_nth_drop_Suc</span><span class=""> </span><span class="">Suc_diff_Suc</span><span class=""> </span><span class="">Suc_leI</span><span class=""> </span><span class="">a8</span><span class=""> 
</span><span class="">                  </span><span class="">append_is_Nil_conv</span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="">diff_diff_cancel</span><span class=""> </span><span class="">drop_all</span><span class=""> </span><span class="">length_drop</span><span class=""> 
</span><span class="">                  </span><span class="">list.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">not_less</span><span class=""> </span><span class="">old.nat.distinct</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a10</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?elsht &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Suc_diff_Suc</span><span class=""> </span><span class="">a7</span><span class=""> </span><span class="">append_is_Nil_conv</span><span class=""> </span><span class="">b5</span><span class=""> </span><span class="">cpts_pes_dropi</span><span class=""> </span><span class="">drop_all</span><span class=""> </span><span class="">not_less</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a11</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?ellng &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_diff_Suc</span><span class=""> </span><span class="">a9</span><span class=""> </span><span class="">cpts_pes_dropi</span><span class=""> </span><span class="">diff_is_0_eq</span><span class=""> 
</span><span class="">                  </span><span class="">drop_0</span><span class=""> </span><span class="">drop_all</span><span class=""> </span><span class="">leI</span><span class=""> </span><span class="">list.simps</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a12</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el1lng = (el ! (length el1 - Suc (Suc jj))) # ?el1sht&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Cons_nth_drop_Suc</span><span class=""> </span><span class="">Suc_diff_Suc</span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="">b6</span><span class=""> </span><span class="">diff_less</span><span class=""> 
</span><span class="">                  </span><span class="">gr_implies_not0</span><span class=""> </span><span class="">length_0_conv</span><span class=""> </span><span class="">length_greater_0_conv</span><span class=""> </span><span class="">nth_append</span><span class=""> </span><span class="">zero_less_Suc</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a11</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?el1lng &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="var">?ellng</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">CptsPesOne</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">CptsPesOne.hyps</span><span class=""> </span><span class="">a7</span><span class=""> </span><span class="">a9</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsPesEnv</span><span class=""> </span><span class="">es1</span><span class=""> </span><span class="">t1</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">xs1</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">y1</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(es1, t1, x1) # xs1 &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(es1, t1, x1) # xs1 = drop (length el1 - Suc (Suc jj)) el &#10233;
                            drop (length el1 - Suc (Suc jj)) el1 &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(es1, s1, y1) # (es1, t1, x1) # xs1 = drop (length el1 - Suc (Suc jj)) el&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(es1, s1, y1) # (es1, t1, x1) # xs1 &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">a11</span><span class=""> </span><span class="">c2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el1sht ! 0 = (es1, t1, x1)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_leI</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">a7</span><span class=""> 
</span><span class="">                        </span><span class="">a9</span><span class=""> </span><span class="">append_eq_Cons_conv</span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="">diff_diff_cancel</span><span class=""> </span><span class="">length_drop</span><span class=""> </span><span class="">list.inject</span><span class=""> 
</span><span class="">                        </span><span class="">list.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">old.nat.distinct</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;el1sht&#39;. ?el1sht = (es1, t1, x1) # el1sht&#39;&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Cons_nth_drop_Suc</span><span class=""> </span><span class="">b4</span><span class=""> 
</span><span class="">                    </span><span class="">diff_diff_cancel</span><span class=""> </span><span class="">drop_0</span><span class=""> </span><span class="">length_drop</span><span class=""> </span><span class="">less_or_eq_imp_le</span><span class=""> </span><span class="">zero_less_Suc</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el1lng = (es1, s1, y1) # ?el1sht&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a12</span><span class=""> </span><span class="">a9</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b5</span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_pes.CptsPesEnv</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsPesComp</span><span class=""> </span><span class="">es1</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">et</span><span class=""> </span><span class="">es2</span><span class=""> </span><span class="">t1</span><span class=""> </span><span class="">y1</span><span class=""> </span><span class="">xs1</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(es1, s1, x1) -pes-et&#8594; (es2, t1, y1)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(es2, t1, y1) # xs1 &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(es2, t1, y1) # xs1 = drop (length el1 - Suc (Suc jj)) el 
                            &#10233; drop (length el1 - Suc (Suc jj)) el1 &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">c3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(es1, s1, x1) # (es2, t1, y1) # xs1 = drop (length el1 - Suc (Suc jj)) el&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el1sht ! 0 = (es2, t1, y1)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_leI</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">a7</span><span class=""> 
</span><span class="">                        </span><span class="">a9</span><span class=""> </span><span class="">append_eq_Cons_conv</span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">diff_diff_cancel</span><span class=""> </span><span class="">length_drop</span><span class=""> </span><span class="">list.inject</span><span class=""> 
</span><span class="">                        </span><span class="">list.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">old.nat.distinct</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;el1sht&#39;. ?el1sht = (es2, t1, y1) # el1sht&#39;&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Cons_nth_drop_Suc</span><span class=""> </span><span class="">b4</span><span class=""> 
</span><span class="">                    </span><span class="">diff_diff_cancel</span><span class=""> </span><span class="">drop_0</span><span class=""> </span><span class="">length_drop</span><span class=""> </span><span class="">less_or_eq_imp_le</span><span class=""> </span><span class="">zero_less_Suc</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el1lng = (es1, s1, x1) # ?el1sht&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a12</span><span class=""> </span><span class="">a9</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b5</span><span class=""> </span><span class="">c5</span><span class="">  </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">cpts_pes.CptsPesComp</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;drop (length el1 - Suc j) el1 &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">cpts_pes_take</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;el &#8712; cpts_pes; i &lt; length el&#10215; &#10233; take (Suc i) el &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_pes_take0</span><span class=""> </span><span class="">gr_implies_not0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">cpts_pes_seg</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;el &#8712; cpts_pes; m &#8804; length el; n &#8804; length el; m &lt; n&#10215; 
                    &#10233; take (n - m) (drop m el) &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m &#8804; length el&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;n &#8804; length el&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m &lt; n&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;drop m el &#8712; cpts_pes&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_pes_dropi</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">drop_0</span><span class=""> </span><span class="">le_0_eq</span><span class=""> </span><span class="">le_SucE</span><span class=""> </span><span class="">less_le_trans</span><span class=""> </span><span class="">zero_induct</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_pes_take</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Suc_diff_Suc</span><span class=""> </span><span class="">diff_diff_cancel</span><span class=""> </span><span class="">diff_less_Suc</span><span class=""> </span><span class="">diff_right_commute</span><span class=""> </span><span class="">length_drop</span><span class=""> </span><span class="">less_le_trans</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">cpts_pes_seg2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;el &#8712; cpts_pes; m &#8804; length el; n &#8804; length el; take (n - m) (drop m el) &#8800; []&#10215; 
                    &#10233; take (n - m) (drop m el) &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m &#8804; length el&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;n &#8804; length el&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;take (n - m) (drop m el) &#8800; []&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;m &lt; n&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_pes_seg</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">subsection</span></span><span class=""> </span><span class="cartouche">&#8249;Equivalence of Sequential and Modular Definitions of Programs.&#8250;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">last_length</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;((a#xs)!(length xs))=last (a#xs)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">xs</span><span class="delimiter">)</span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">div_seq</span><span class=""> </span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;list &#8712; cpt_p_mod &#10233;
 (&#8704;s P Q zs. list=(Some (Seq P Q), s)#zs &#10230;
  (&#8707;xs. (Some P, s)#xs &#8712; cpt_p_mod  &#8743; (zs=(map (lift Q) xs) &#8744;
  ( fst(((Some P, s)#xs)!length xs)=None &#8743; 
  (&#8707;ys. (Some Q, snd(((Some P, s)#xs)!length xs))#ys &#8712; cpt_p_mod  
  &#8743; zs=(map (lift (Q)) xs)@ys)))))&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">cpt_p_mod.induct</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp_all</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">intro</span><span class="delimiter">:</span><span class="">CptPModOne</span><span class="delimiter">)</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">Pa</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">)</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">Q</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">)</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">disjE</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;(Some Pa,t)#xsa&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">exI</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="">     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">CptPModEnv</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">disjI1</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;(Some Pa,t)#xsa&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">exI</span><span class="delimiter">)</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">CptPModEnv</span><span class="delimiter">)</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">disjI2</span><span class="delimiter">)</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">xsa</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;ys&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">exI</span><span class="delimiter">)</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">ptran.cases</span><span class="delimiter">,</span><span class="">simp_all</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;xs&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">exI</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;xs&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">exI</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">last_length</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">cpts_onlyif_cpt_p_mod_aux</span><span class=""> </span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#8704;s Q t xs .((Some a, s), (Q, t)) &#8712; ptran &#10230; (Q, t) # xs &#8712; cpt_p_mod 
  &#10230; (Some a, s) # (Q, t) # xs &#8712; cpt_p_mod&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">a</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp_all</span><span class="">
</span><span class="delimiter">--</span><span class="cartouche">&#8249;basic&#8250;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">ptran.cases</span><span class="delimiter">,</span><span class="">simp_all</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">CptPModNone</span><span class="delimiter">,</span><span class="">rule</span><span class=""> </span><span class="">Basic</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">ptran.cases</span><span class="delimiter">,</span><span class="">simp_all</span><span class="delimiter">)</span><span class="">
</span><span class="delimiter">--</span><span class="cartouche">&#8249;Seq1&#8250;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule_tac</span><span class=""> </span><span class="">xs</span><span class="delimiter">=</span><span class="string">&quot;[(None,ta)]&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">CptPModSeq2</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">CptPModNone</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">CptPModOne</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class="delimiter">--</span><span class="cartouche">&#8249;Seq2&#8250;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="">sa</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">x</span><span class="delimiter">=</span><span class="string">&quot;Some P2&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">allE</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class="">erule</span><span class=""> </span><span class="">impE</span><span class="delimiter">,</span><span class=""> </span><span class="">assumption</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule</span><span class=""> </span><span class="">div_seq</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">disjE</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class="">erule</span><span class=""> </span><span class="">impE</span><span class="delimiter">,</span><span class=""> </span><span class="">assumption</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">CptPModSeq1</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class=""> 
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">allE</span><span class="delimiter">,</span><span class="">erule</span><span class=""> </span><span class="">impE</span><span class="delimiter">,</span><span class=""> </span><span class="">assumption</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule_tac</span><span class=""> </span><span class="">CptPModSeq2</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">last_length</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">last_length</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class="delimiter">--</span><span class="cartouche">&#8249;Cond&#8250;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">ptran.cases</span><span class="delimiter">,</span><span class="">simp_all</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">elim</span><span class="delimiter">:</span><span class=""> </span><span class="">CptPModCondT</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">elim</span><span class="delimiter">:</span><span class=""> </span><span class="">CptPModCondF</span><span class="delimiter">)</span><span class="">
</span><span class="delimiter">--</span><span class="cartouche">&#8249;While&#8250;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="">  </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">ptran.cases</span><span class="delimiter">,</span><span class="">simp_all</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">CptPModNone</span><span class="delimiter">,</span><span class="">erule</span><span class=""> </span><span class="">WhileF</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule</span><span class=""> </span><span class="">div_seq</span><span class="delimiter">,</span><span class="">force</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">disjE</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">elim</span><span class="delimiter">:</span><span class="">CptPModWhile1</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">last_length</span><span class=""> </span><span class="">elim</span><span class="delimiter">:</span><span class="">CptPModWhile2</span><span class="delimiter">)</span><span class="">
</span><span class="delimiter">--</span><span class="cartouche">&#8249;await&#8250;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">ptran.cases</span><span class="delimiter">,</span><span class="">simp_all</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">CptPModNone</span><span class="delimiter">,</span><span class="">erule</span><span class=""> </span><span class="">Await</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class="delimiter">--</span><span class="cartouche">&#8249;nondt&#8250;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">ptran.cases</span><span class="delimiter">,</span><span class="">simp_all</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">CptPModNone</span><span class="delimiter">,</span><span class="">erule</span><span class=""> </span><span class="">Nondt</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">+</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">cpts_onlyif_cpt_p_mod</span><span class=""> </span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8712; cpts_p &#10233; c &#8712; cpt_p_mod&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">cpts_p.induct</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">CptPModOne</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">CptPModEnv</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">case_tac</span><span class=""> </span><span class="">P</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">ptran.cases</span><span class="delimiter">,</span><span class="">simp_all</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">elim</span><span class="delimiter">:</span><span class="">cpts_onlyif_cpt_p_mod_aux</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">lift_is_cptn</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c&#8712;cpts_p &#10233; map (lift P) c &#8712; cpts_p&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">cpts_p.induct</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class=""> </span><span class="">CptsPOne</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">intro</span><span class="delimiter">:</span><span class="">CptsPEnv</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class=""> </span><span class="">intro</span><span class="delimiter">:</span><span class="">CptsPComp</span><span class=""> </span><span class="">Seq2</span><span class=""> </span><span class="">Seq1</span><span class=""> </span><span class="">elim</span><span class="delimiter">:</span><span class="">ptran.cases</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">cptn_append_is_cptn</span><span class=""> </span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> 
</span><span class=""> </span><span class="string">&quot;&#8704;b a. b#c1&#8712;cpts_p &#10230;  a#c2&#8712;cpts_p &#10230; (b#c1)!length c1=a &#10230; b#c1@c2&#8712;cpts_p&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">c1</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">cpts_p.cases</span><span class="delimiter">,</span><span class="">simp_all</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">intro</span><span class="delimiter">:</span><span class="">CptsPEnv</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">force</span><span class=""> </span><span class="">elim</span><span class="delimiter">:</span><span class="">CptsPComp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">last_lift</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;xs&#8800;[]; fst(xs!(length xs - (Suc 0)))=None&#10215; 
 &#10233; fst((map (lift P) xs)!(length (map (lift P) xs)- (Suc 0)))=(Some P)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;(xs ! (length xs - (Suc 0)))&quot;</span><span class="delimiter">)</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">last_fst</span><span class=""> </span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;P((a#x)!length x) &#10230; &#172;P a &#10230; P (x!(length x - (Suc 0)))&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class=""> </span><span class="">simp_all</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">last_fst_esp</span><span class="delimiter">:</span><span class=""> 
</span><span class=""> </span><span class="string">&quot;fst(((Some a,s)#xs)!(length xs))=None &#10233; fst(xs!(length xs - (Suc 0)))=None&quot;</span><span class=""> 
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">last_fst</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">last_snd</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;xs&#8800;[] &#10233; 
  snd(((map (lift P) xs))!(length (map (lift P) xs) - (Suc 0)))=snd(xs!(length xs - (Suc 0)))&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;(xs ! (length xs - (Suc 0)))&quot;</span><span class="delimiter">)</span><span class=""> </span><span class="delimiter">(</span><span class="">simp_all</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">Cons_lift</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(Some (Seq P Q), s) # (map (lift Q) xs) = map (lift Q) ((Some P, s) # xs)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">Cons_lift_append</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;(Some (Seq P Q), s) # (map (lift Q) xs) @ ys = map (lift Q) ((Some P, s) # xs)@ ys &quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">lift_nth</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i&lt;length xs &#10233; map (lift Q) xs ! i = lift Q  (xs! i)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">snd_lift</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i&lt; length xs &#10233; snd(lift Q (xs ! i))= snd (xs ! i)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;xs!i&quot;</span><span class="delimiter">)</span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">cpts_if_cpt_p_mod</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8712; cpt_p_mod &#10233; c &#8712; cpts_p&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">cpt_p_mod.induct</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">CptsPOne</span><span class="delimiter">)</span><span class="">
</span><span class="">       </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">CptsPEnv</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">CptsPComp</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">CptsPComp</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">CondT</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">CptsPComp</span><span class="delimiter">)</span><span class="">
</span><span class="">     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">CondF</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="delimiter">&#8213;</span><span class="cartouche">&#8249;Seq1&#8250;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">cpts_p.cases</span><span class="delimiter">,</span><span class="">simp_all</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">CptsPOne</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">P</span><span class="delimiter">=</span><span class="">P1</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">lift_is_cptn</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">CptsPEnv</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">conjI</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">CptsPComp</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">Seq1</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">P</span><span class="delimiter">=</span><span class="">P1</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">lift_is_cptn</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">clarify</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">CptsPComp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">Seq2</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">P</span><span class="delimiter">=</span><span class="">P1</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">lift_is_cptn</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class="delimiter">&#8213;</span><span class="cartouche">&#8249;Seq2&#8250;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">cptn_append_is_cptn</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">P</span><span class="delimiter">=</span><span class="">P1</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">lift_is_cptn</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">split</span><span class="delimiter">:</span><span class=""> </span><span class="">if_split_asm</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">frule_tac</span><span class=""> </span><span class="">P</span><span class="delimiter">=</span><span class="">P1</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">last_lift</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">last_fst_esp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">last_length</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">Cons_lift</span><span class=""> </span><span class="">lift_def</span><span class=""> </span><span class="">split_def</span><span class=""> </span><span class="">last_conv_nth</span><span class="delimiter">)</span><span class="">
</span><span class="delimiter">&#8213;</span><span class="cartouche">&#8249;While1&#8250;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">CptsPComp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">WhileT</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">P</span><span class="delimiter">=</span><span class="string">&quot;While b P&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">lift_is_cptn</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class="delimiter">&#8213;</span><span class="cartouche">&#8249;While2&#8250;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">CptsPComp</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">WhileT</span><span class="delimiter">,</span><span class="">simp</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">cptn_append_is_cptn</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">drule_tac</span><span class=""> </span><span class="">P</span><span class="delimiter">=</span><span class="string">&quot;While b P&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">lift_is_cptn</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">lift_def</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">split</span><span class="delimiter">:</span><span class=""> </span><span class="">if_split_asm</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">frule_tac</span><span class=""> </span><span class="">P</span><span class="delimiter">=</span><span class="string">&quot;While b P&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">in</span></span><span class=""> </span><span class="">last_lift</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">last_fst_esp</span><span class="delimiter">,</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">last_length</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">Cons_lift</span><span class=""> </span><span class="">lift_def</span><span class=""> </span><span class="">split_def</span><span class=""> </span><span class="">last_conv_nth</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">theorem</span></span><span class=""> </span><span class="">cpts_iff_cpt_p_mod</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(c &#8712; cpts_p) = (c &#8712; cpt_p_mod)&quot;</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">iffI</span><span class="delimiter">)</span><span class="">
</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">cpts_onlyif_cpt_p_mod</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">erule</span><span class=""> </span><span class="">cpts_if_cpt_p_mod</span><span class="delimiter">)</span><span class="">
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">subsection</span></span><span class=""> </span><span class="cartouche">&#8249;Compositionality of the Semantics&#8250;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">subsubsection</span></span><span class=""> </span><span class="cartouche">&#8249;Definition of the conjoin operator&#8250;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">definition</span></span><span class=""> </span><span class="">same_length</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) pesconfs &#8658; (&#39;k &#8658; (&#39;l,&#39;k,&#39;s) esconfs) &#8658; bool&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class="">
</span><span class="">  </span><span class="string">&quot;same_length c cs &#8801; &#8704;k. length (cs k) = length c&quot;</span><span class="">
</span><span class=""> 
</span><span class="keyword1"><span class="command">definition</span></span><span class=""> </span><span class="">same_state</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) pesconfs &#8658; (&#39;k &#8658; (&#39;l,&#39;k,&#39;s) esconfs) &#8658; bool&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class="">
</span><span class="">  </span><span class="string">&quot;same_state c cs &#8801; &#8704;k j. j &lt; length c &#10230; gets (c!j) = gets_es ((cs k)!j) &#8743; getx (c!j) = getx_es ((cs k)!j)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">definition</span></span><span class=""> </span><span class="">same_spec</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) pesconfs &#8658; (&#39;k &#8658; (&#39;l,&#39;k,&#39;s) esconfs) &#8658; bool&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class="">
</span><span class="">  </span><span class="string">&quot;same_spec c cs &#8801; &#8704;k j. j &lt; length c &#10230; (getspc (c!j)) k = getspc_es ((cs k) ! j)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">definition</span></span><span class=""> </span><span class="">compat_tran</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) pesconfs &#8658; (&#39;k &#8658; (&#39;l,&#39;k,&#39;s) esconfs) &#8658; bool&quot;</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class="">
</span><span class="">  </span><span class="string">&quot;compat_tran c cs &#8801; &#8704;j. Suc j &lt; length c &#10230; 
                              ((&#8707;t k. (c!j -pes-(t&#9839;k)&#8594; c!Suc j)) &#8743;
                              (&#8704;k t. (c!j -pes-(t&#9839;k)&#8594; c!Suc j) &#10230; (cs k!j -es-(t&#9839;k)&#8594; cs k! Suc j) &#8743;
                                      (&#8704;k&#39;. k&#39; &#8800; k &#10230; (cs k&#39;!j -ese&#8594; cs k&#39;! Suc j))))
                              &#8744;
                              (((c!j) -pese&#8594; (c!Suc j)) &#8743; (&#8704;k. (((cs k)!j) -ese&#8594; ((cs k)! Suc j))))&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">definition</span></span><span class=""> </span><span class="">conjoin</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) pesconfs &#8658; (&#39;k &#8658; (&#39;l,&#39;k,&#39;s) esconfs) &#8658; bool&quot;</span><span class="">  </span><span class="delimiter">(</span><span class="string">&quot;_ &#8733; _&quot;</span><span class=""> </span><span class="delimiter">[</span><span class="">65</span><span class="delimiter">,</span><span class="">65</span><span class="delimiter">]</span><span class=""> </span><span class="">64</span><span class="delimiter">)</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class="">
</span><span class="">  </span><span class="string">&quot;c &#8733; cs &#8801; (same_length c cs) &#8743; (same_state c cs) &#8743; (same_spec c cs) &#8743; (compat_tran c cs)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">subsubsection</span></span><span class=""> </span><span class="cartouche">&#8249;Lemmas of conjoin&#8250;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">acts_in_conjoin_cpts</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8733; cs &#10233; &#8704;i. Suc i &lt; length (cs k) &#10230; ((cs k)!i) -ese&#8594; ((cs k)! Suc i) 
        &#8744; (&#8707;e. ((cs k)!i) -es-(EvtEnt e&#9839;k)&#8594; ((cs k)! Suc i))
        &#8744; (&#8707;c. ((cs k)!i) -es-(Cmd c&#9839;k)&#8594; ((cs k)! Suc i))&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8733; cs&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length (cs k)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length c = length (cs k)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class=""> </span><span class="">same_length_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;compat_tran c cs&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(&#8707;t k. (c!i -pes-(t&#9839;k)&#8594; c!Suc i) &#8743;
                          (&#8704;k t. (c!i -pes-(t&#9839;k)&#8594; c!Suc i) &#10230; (cs k!i -es-(t&#9839;k)&#8594; cs k! Suc i) &#8743;
                                  (&#8704;k&#39;. k&#39; &#8800; k &#10230; (cs k&#39;!i -ese&#8594; cs k&#39;! Suc i))))
                          &#8744;
                          (((c!i) -pese&#8594; (c!Suc i)) &#8743; (&#8704;k. (((cs k)!i) -ese&#8594; ((cs k)! Suc i))))&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">compat_tran_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;((cs k)!i) -ese&#8594; ((cs k)! Suc i) 
              &#8744; (&#8707;e. ((cs k)!i) -es-(EvtEnt e&#9839;k)&#8594; ((cs k)! Suc i))
              &#8744; (&#8707;c. ((cs k)!i) -es-(Cmd c&#9839;k)&#8594; ((cs k)! Suc i))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">proof</span></span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;t k. (c!i -pes-(t&#9839;k)&#8594; c!Suc i) &#8743;
                          (&#8704;k t. (c!i -pes-(t&#9839;k)&#8594; c!Suc i) &#10230; (cs k!i -es-(t&#9839;k)&#8594; cs k! Suc i) &#8743;
                                  (&#8704;k&#39;. k&#39; &#8800; k &#10230; (cs k&#39;!i -ese&#8594; cs k&#39;! Suc i)))&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">t</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">k1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(c!i -pes-(t&#9839;k1)&#8594; c!Suc i) &#8743;
                          (&#8704;k t. (c!i -pes-(t&#9839;k)&#8594; c!Suc i) &#10230; (cs k!i -es-(t&#9839;k)&#8594; cs k! Suc i) &#8743;
                                  (&#8704;k&#39;. k&#39; &#8800; k &#10230; (cs k&#39;!i -ese&#8594; cs k&#39;! Suc i)))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;k = k1&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;k = k1&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">estran_impl_evtentorcmd2&#39;</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">              </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;k &#8800; k1&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;((c!i) -pese&#8594; (c!Suc i)) &#8743; (&#8704;k. (((cs k)!i) -ese&#8594; ((cs k)! Suc i)))&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">entevt_in_conjoin_cpts</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;&#10214;c &#8733; cs; Suc i &lt; length (cs k); getspc_es ((cs k)!i) = EvtSys es; 
    getspc_es ((cs k)!Suc i) &#8800; EvtSys es &#10215;
    &#10233; (&#8707;e. ((cs k)!i) -es-(EvtEnt e&#9839;k)&#8594; ((cs k)! Suc i))&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8733; cs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length (cs k)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es ((cs k)!i) = EvtSys es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es ((cs k)!Suc i) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;((cs k)!i) -ese&#8594; ((cs k)! Suc i) 
        &#8744; (&#8707;e. ((cs k)!i) -es-(EvtEnt e&#9839;k)&#8594; ((cs k)! Suc i))
        &#8744; (&#8707;c. ((cs k)!i) -es-(Cmd c&#9839;k)&#8594; ((cs k)! Suc i))&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">acts_in_conjoin_cpts</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;((cs k)!i) -ese&#8594; ((cs k)! Suc i)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">esetran_eqconf1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;(&#8707;e. cs k ! i -es-EvtEnt e&#9839;k&#8594; cs k ! Suc i) 
              &#8744; (&#8707;c. cs k ! i -es-Cmd c&#9839;k&#8594; cs k ! Suc i)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;&#8707;e. cs k ! i -es-EvtEnt e&#9839;k&#8594; cs k ! Suc i&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;&#8707;c. cs k ! i -es-Cmd c&#9839;k&#8594; cs k ! Suc i&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">cmd_enable_impl_anonyevt2</span><span class=""> </span><span class="">esys_not_eseq</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">notentevt_in_conjoin_cpts</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;&#10214;c &#8733; cs; Suc i &lt; length (cs k); &#172;(getspc_es ((cs k)!i) = EvtSys es &#8743; getspc_es ((cs k)!Suc i) &#8800; EvtSys es);
    &#8704;i &lt; length (cs k). getspc_es ((cs k) ! i) = EvtSys es 
                        &#8744; (&#8707;e. is_anonyevt e &#8743; getspc_es ((cs k) ! i) = EvtSeq e (EvtSys es))&#10215;
    &#10233; &#172;(&#8707;e. ((cs k)!i) -es-(EvtEnt e&#9839;k)&#8594; ((cs k)! Suc i))&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8733; cs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length (cs k)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(getspc_es ((cs k)!i) = EvtSys es &#8743; getspc_es ((cs k)!Suc i) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i &lt; length (cs k). getspc_es ((cs k) ! i) = EvtSys es 
                    &#8744; (&#8707;e. is_anonyevt e &#8743; getspc_es ((cs k) ! i) = EvtSeq e (EvtSys es))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es ((cs k)!i) &#8800; EvtSys es &#8744; getspc_es ((cs k)!Suc i) = EvtSys es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(&#8707;e. is_anonyevt e &#8743; getspc_es ((cs k) ! i) = EvtSeq e (EvtSys es)) 
                  &#8744; getspc_es ((cs k)!Suc i) = EvtSys es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;&#8707;e. is_anonyevt e &#8743; getspc_es ((cs k) ! i) = EvtSeq e (EvtSys es)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;is_anonyevt e1 &#8743; getspc_es ((cs k) ! i) = EvtSeq e1 (EvtSys es)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtent_is_basicevt_inevtseq2</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;getspc_es ((cs k)!Suc i) = EvtSys es&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">evtseq_no_evtent2</span><span class=""> </span><span class="">evtsys_not_eq_in_tran_aux1</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">take_n_conjoin</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;c &#8733; cs; n &#8804; length c; c1 = take n c; cs1 = (&#955;k. take n (cs k))&#10215; 
    &#10233; c1 &#8733; cs1&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8733; cs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;n &#8804; length c&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c1 = take n c&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;cs1 = (&#955;k. take n (cs k))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;same_length c1 cs1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">conjoin_def</span><span class=""> </span><span class="">length_take</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">same_length_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. length (cs1 k) = length c1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">same_length_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;same_state c1 cs1&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">j</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j &lt; length c1&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;cs1 k = take n (cs k)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b2</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k j. j &lt; length c 
              &#10230; gets (c!j) = gets_es ((cs k)!j) &#8743; getx (c!j) = getx_es ((cs k)!j)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class=""> </span><span class="">same_state_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets (c ! j) = gets (c1 ! j) &#8743; gets_es ((cs k)!j) = gets_es ((cs1 k)!j)
          &#8743; getx (c!j) = getx (c1!j)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">nth_append</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b2</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">j</span><span class=""> </span><span class="">k</span><span class="delimiter">]</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets (c1!j) = gets_es ((cs1 k)!j) &#8743; getx (c1!j) = getx_es ((cs1 k)!j)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">same_state_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;same_spec c1 cs1&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">j</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j &lt; length c1&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;cs1 k = take n (cs k)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b2</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k j. j &lt; length c 
              &#10230; (getspc (c!j)) k = getspc_es ((cs k) ! j)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class=""> </span><span class="">same_spec_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc (c1!j) = getspc (c!j) 
          &#8743; getspc_es ((cs k) ! j) = getspc_es ((cs1 k) ! j)&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">nth_append</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(getspc (c1!j)) k = getspc_es ((cs1 k) ! j)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">same_spec_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;compat_tran c1 cs1&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">j</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc j &lt; length c1&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;((&#8707;t k. (c!j -pes-(t&#9839;k)&#8594; c!Suc j)) &#8743;
                        (&#8704;k t. (c!j -pes-(t&#9839;k)&#8594; c!Suc j) &#10230; (cs k!j -es-(t&#9839;k)&#8594; cs k! Suc j) &#8743;
                                (&#8704;k&#39;. k&#39; &#8800; k &#10230; (cs k&#39;!j -ese&#8594; cs k&#39;! Suc j))))
                        &#8744;
                        (((c!j) -pese&#8594; (c!Suc j)) &#8743; (&#8704;k. (((cs k)!j) -ese&#8594; ((cs k)! Suc j))))&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class=""> </span><span class="">compat_tran_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;c!j = c1!j&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;c!Suc j = c1!Suc j&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;k. cs1 k!j = cs k!j&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Suc_lessD</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;k. cs1 k!Suc j = cs k!Suc j&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Suc_lessD</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">ultimately</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;((&#8707;t k. (c1!j -pes-(t&#9839;k)&#8594; c1!Suc j)) &#8743;
                    (&#8704;k t. (c1!j -pes-(t&#9839;k)&#8594; c1!Suc j) &#10230; (cs1 k!j -es-(t&#9839;k)&#8594; cs1 k! Suc j) &#8743;
                            (&#8704;k&#39;. k&#39; &#8800; k &#10230; (cs1 k&#39;!j -ese&#8594; cs1 k&#39;! Suc j))))
                    &#8744;
                    (((c1!j) -pese&#8594; (c1!Suc j)) &#8743; (&#8704;k. (((cs1 k)!j) -ese&#8594; ((cs1 k)! Suc j))))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">compat_tran_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class=""> </span><span class="">a0</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">drop_n_conjoin</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;c &#8733; cs; n &#8804; length c; c1 = drop n c; cs1 = (&#955;k. drop n (cs k))&#10215; 
    &#10233; c1 &#8733; cs1&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8733; cs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;n &#8804; length c&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c1 = drop n c&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;cs1 = (&#955;k. drop n (cs k))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;same_length c1 cs1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">conjoin_def</span><span class=""> </span><span class="">length_drop</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">same_length_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. length (cs1 k) = length c1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">same_length_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;same_state c1 cs1&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">j</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j &lt; length c1&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;cs1 k = drop n (cs k)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b2</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k j. j &lt; length c 
              &#10230; gets (c!j) = gets_es ((cs k)!j) &#8743; getx (c!j) = getx_es ((cs k)!j)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class=""> </span><span class="">same_state_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets (c ! (n + j)) = gets (c1 ! j) &#8743; gets_es ((cs k)!(n + j)) = gets_es ((cs1 k)!j)
          &#8743; getx (c!(n + j)) = getx (c1!j)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;n + j &#8804; length c&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;n + j &#8804; length (cs k)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">)</span><span class=""> </span><span class="">conjoin_def</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">same_length_def</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">p2</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b2</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;n + j&quot;</span><span class=""> </span><span class="">k</span><span class="delimiter">]</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets (c1!j) = gets_es ((cs1 k)!j) &#8743; getx (c1!j) = getx_es ((cs1 k)!j)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">add.commute</span><span class=""> </span><span class="">length_drop</span><span class=""> </span><span class="">less_diff_conv</span><span class=""> </span><span class="">less_or_eq_imp_le</span><span class=""> </span><span class="">nth_drop</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">same_state_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;same_spec c1 cs1&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">j</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j &lt; length c1&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;cs1 k = drop n (cs k)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b2</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k j. j &lt; length c 
              &#10230; (getspc (c!j)) k = getspc_es ((cs k) ! j)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class=""> </span><span class="">same_spec_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc (c1!j) = getspc (c!(n+j)) 
          &#8743; getspc_es ((cs k) ! (n+j)) = getspc_es ((cs1 k) ! j)&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;n + j &#8804; length c&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;n + j &#8804; length (cs k)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">)</span><span class=""> </span><span class="">conjoin_def</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">same_length_def</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">p2</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(getspc (c1!j)) k = getspc_es ((cs1 k) ! j)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">same_spec_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;compat_tran c1 cs1&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">j</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc j &lt; length c1&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;((&#8707;t k. (c!(n+j) -pes-(t&#9839;k)&#8594; c!Suc (n+j))) &#8743;
                        (&#8704;k t. (c!(n+j) -pes-(t&#9839;k)&#8594; c!Suc (n+j)) &#10230; (cs k!(n+j) -es-(t&#9839;k)&#8594; cs k! Suc (n+j)) &#8743;
                                (&#8704;k&#39;. k&#39; &#8800; k &#10230; (cs k&#39;!(n+j) -ese&#8594; cs k&#39;! Suc (n+j)))))
                        &#8744;
                        (((c!(n+j)) -pese&#8594; (c!Suc (n+j))) &#8743; (&#8704;k. (((cs k)!(n+j)) -ese&#8594; ((cs k)! Suc (n+j)))))&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class=""> </span><span class="">compat_tran_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;c!(n+j) = c1!j&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;c!Suc (n+j) = c1!Suc j&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;k. cs1 k!j = cs k!(n+j)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">add.commute</span><span class=""> </span><span class="">length_drop</span><span class=""> 
</span><span class="">              </span><span class="">less_diff_conv</span><span class=""> </span><span class="">less_or_eq_imp_le</span><span class=""> </span><span class="">nth_drop</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;k. cs1 k!Suc j = cs k!Suc (n+j)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">add.commute</span><span class=""> </span><span class="">add_Suc_right</span><span class=""> </span><span class="">length_drop</span><span class=""> </span><span class="">less_diff_conv</span><span class=""> </span><span class="">less_or_eq_imp_le</span><span class=""> </span><span class="">nth_drop</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">ultimately</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;((&#8707;t k. (c1!j -pes-(t&#9839;k)&#8594; c1!Suc j)) &#8743;
                    (&#8704;k t. (c1!j -pes-(t&#9839;k)&#8594; c1!Suc j) &#10230; (cs1 k!j -es-(t&#9839;k)&#8594; cs1 k! Suc j) &#8743;
                            (&#8704;k&#39;. k&#39; &#8800; k &#10230; (cs1 k&#39;!j -ese&#8594; cs1 k&#39;! Suc j))))
                    &#8744;
                    (((c1!j) -pese&#8594; (c1!Suc j)) &#8743; (&#8704;k. (((cs1 k)!j) -ese&#8594; ((cs1 k)! Suc j))))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">compat_tran_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class=""> </span><span class="">a0</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">conjoin_imp_cptses_k_help</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;c &#8712; cpts_pes&#10215; &#10233; 
      &#8704;cs k. c &#8733; cs &#10230; (cs k &#8712; cpts_es)&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">k</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;cs. c &#8712; cpts_pes &#8743; c &#8733; cs &#10230; (cs k &#8712; cpts_es)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">c</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsPesOne</span><span class=""> </span><span class="">pes</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">cs</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;[(pes, s, x)] &#8733; cs&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p3</span><span class="delimiter">:</span><span class="string">&quot;length (cs k) = 1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class=""> </span><span class="">same_length_def</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;same_spec [(pes, s, x)] cs &#8743; same_state [(pes, s, x)] cs&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;cs k ! 0  = (pes k, s, x)&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">esconf_trip</span><span class=""> </span><span class="">pesconf_trip</span><span class=""> </span><span class="">same_spec_def</span><span class=""> </span><span class="">same_state_def</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">length_Cons</span><span class=""> </span><span class="">list.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">prod.sel</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">prod.sel</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">zero_less_one</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;cs k &#8712; cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">cpts_es_def</span><span class=""> 
</span><span class="">                </span><span class="">cpts_esp.CptsEsOne</span><span class=""> </span><span class="">length_0_conv</span><span class=""> </span><span class="">length_Suc_conv</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> </span><span class="">nth_Cons_0</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsPesEnv</span><span class=""> </span><span class="">pes</span><span class=""> </span><span class="">t</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">xs</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">y</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(pes, t, x) # xs &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">            </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a1</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;cs. (pes, t, x) # xs &#8712; cpts_pes &#8743; (pes, t, x) # xs &#8733; cs &#10230; cs k &#8712; cpts_es&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">cs</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(pes, s, y) # (pes, t, x) # xs &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(pes, s, y) # (pes, t, x) # xs &#8733; cs&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esl</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;(pes, t, x) # xs&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esllon</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;(pes, s, y) # (pes, t, x) # xs&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?cs</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;(&#955;k. drop 1 (cs k))&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?esl &#8733; ?cs&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">drop_n_conjoin</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?esllon</span><span class=""> </span><span class="">cs</span><span class=""> </span><span class="">1</span><span class=""> </span><span class="var">?esl</span><span class=""> </span><span class="var">?cs</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a1</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?cs</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?cs k &#8712; cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;cs k ! 0 = (pes k, s, y)&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">conjoin_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?esllon</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="">same_state_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?esllon</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="">same_spec_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?esllon</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">esconf_trip</span><span class=""> </span><span class="">gets_def</span><span class=""> </span><span class="">getspc_def</span><span class=""> </span><span class="">getx_def</span><span class=""> </span><span class="">length_greater_0_conv</span><span class=""> 
</span><span class="">                  </span><span class="">list.simps</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">prod.sel</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">prod.sel</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (cs k ! 1) = (getspc (?esllon ! 1)) k&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">conjoin_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?esllon</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="">same_spec_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?esllon</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">diff_Suc_1</span><span class=""> </span><span class="">length_Cons</span><span class=""> </span><span class="">zero_less_Suc</span><span class=""> </span><span class="">zero_less_diff</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets (?esllon ! 1) = gets_es ((cs k)!1) &#8743; getx (?esllon ! 1) = getx_es ((cs k)!1)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">conjoin_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?esllon</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="">same_state_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?esllon</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class="">
</span><span class="">                 </span><span class="">diff_Suc_1</span><span class=""> </span><span class="">length_Cons</span><span class=""> </span><span class="">zero_less_Suc</span><span class=""> </span><span class="">zero_less_diff</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;cs k ! 1 = (pes k, t, x)&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">getspc_def</span><span class=""> </span><span class="">gets_def</span><span class=""> </span><span class="">getx_def</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">esconf_trip</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">nth_Cons_Suc</span><span class=""> </span><span class="">snd_conv</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;cs k &#8712; cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">CptsEsEnv</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Cons_nth_drop_Suc</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">cpts_es_not_empty</span><span class=""> 
</span><span class="">                    </span><span class="">drop_0</span><span class=""> </span><span class="">drop_eq_Nil</span><span class=""> </span><span class="">not_le</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsPesComp</span><span class=""> </span><span class="">pes1</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">y</span><span class=""> </span><span class="">ct</span><span class=""> </span><span class="">pes2</span><span class=""> </span><span class="">t</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">xs</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(pes1, s, y) -pes-ct&#8594; (pes2, t, x)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(pes2, t, x) # xs &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">            </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a2</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;cs. (pes2, t, x) # xs &#8712; cpts_pes &#8743; (pes2, t, x) # xs &#8733; cs &#10230; cs k &#8712; cpts_es&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">cs</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(pes1, s, y) # (pes2, t, x) # xs &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(pes1, s, y) # (pes2, t, x) # xs &#8733; cs&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esl</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;(pes2, t, x) # xs&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esllon</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;(pes1, s, y) # (pes2, t, x) # xs&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?cs</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;(&#955;k. drop 1 (cs k))&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?esl &#8733; ?cs&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">drop_n_conjoin</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?esllon</span><span class=""> </span><span class="">cs</span><span class=""> </span><span class="">1</span><span class=""> </span><span class="var">?esl</span><span class=""> </span><span class="var">?cs</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">a2</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?cs</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?cs k &#8712; cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;cs k ! 0 = (pes1 k, s, y)&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">conjoin_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?esllon</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="">same_state_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?esllon</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="">same_spec_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?esllon</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">esconf_trip</span><span class=""> </span><span class="">gets_def</span><span class=""> </span><span class="">getspc_def</span><span class=""> </span><span class="">getx_def</span><span class=""> </span><span class="">length_greater_0_conv</span><span class=""> 
</span><span class="">                  </span><span class="">list.simps</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">prod.sel</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">prod.sel</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (cs k ! 1) = (getspc (?esllon ! 1)) k&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">conjoin_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?esllon</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="">same_spec_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?esllon</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">diff_Suc_1</span><span class=""> </span><span class="">length_Cons</span><span class=""> </span><span class="">zero_less_Suc</span><span class=""> </span><span class="">zero_less_diff</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets (?esllon ! 1) = gets_es ((cs k)!1) &#8743; getx (?esllon ! 1) = getx_es ((cs k)!1)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">conjoin_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?esllon</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="">same_state_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?esllon</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class="">
</span><span class="">                 </span><span class="">diff_Suc_1</span><span class=""> </span><span class="">length_Cons</span><span class=""> </span><span class="">zero_less_Suc</span><span class=""> </span><span class="">zero_less_diff</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;cs k ! 1 = (pes2 k, t, x)&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">getspc_def</span><span class=""> </span><span class="">gets_def</span><span class=""> </span><span class="">getx_def</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">esconf_trip</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">nth_Cons_Suc</span><span class=""> </span><span class="">snd_conv</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;compat_tran ?esllon cs&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;((&#8707;t k. (?esllon!0 -pes-(t&#9839;k)&#8594; ?esllon!Suc 0)) &#8743;
                                (&#8704;k t. (?esllon!0 -pes-(t&#9839;k)&#8594; ?esllon!Suc 0) &#10230; (cs k!0 -es-(t&#9839;k)&#8594; cs k! Suc 0) &#8743;
                                        (&#8704;k&#39;. k&#39; &#8800; k &#10230; (cs k&#39;!0 -ese&#8594; cs k&#39;! Suc 0))))
                                &#8744;
                                (((?esllon!0) -pese&#8594; (?esllon!Suc 0)) &#8743; (&#8704;k. (((cs k)!0) -ese&#8594; ((cs k)! Suc 0))))&quot;</span><span class="">
</span><span class="">               </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">compat_tran_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?esllon</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;cs k &#8712; cpts_es&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8707;t k. (?esllon!0 -pes-(t&#9839;k)&#8594; ?esllon!Suc 0)) &#8743;
                                (&#8704;k t. (?esllon!0 -pes-(t&#9839;k)&#8594; ?esllon!Suc 0) &#10230; (cs k!0 -es-(t&#9839;k)&#8594; cs k! Suc 0) &#8743;
                                        (&#8704;k&#39;. k&#39; &#8800; k &#10230; (cs k&#39;!0 -ese&#8594; cs k&#39;! Suc 0)))&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">t1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">k1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(?esllon!0 -pes-(t1&#9839;k1)&#8594; ?esllon!Suc 0)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(cs k1!0 -es-(t1&#9839;k1)&#8594; cs k1! Suc 0) &#8743;
                                   (&#8704;k&#39;. k&#39; &#8800; k1 &#10230; (cs k&#39;!0 -ese&#8594; cs k&#39;! Suc 0))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;k = k1&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;k = k1&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(cs k!0 -es-(t1&#9839;k)&#8594; cs k! Suc 0)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">CptsEsComp</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Cons_nth_drop_Suc</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">cpts_es_not_empty</span><span class=""> </span><span class="">drop_0</span><span class=""> </span><span class="">drop_eq_Nil</span><span class=""> </span><span class="">not_le</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;k &#8800; k1&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;cs k!0 -ese&#8594; cs k! Suc 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">CptsEsEnv</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Cons_nth_drop_Suc</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">cpts_es_not_empty</span><span class=""> 
</span><span class="">                        </span><span class="">drop_0</span><span class=""> </span><span class="">drop_eq_Nil</span><span class=""> </span><span class="">esetran_eqconf</span><span class=""> </span><span class="">not_le</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;((?esllon!0) -pese&#8594; (?esllon!Suc 0)) &#8743; (&#8704;k. (((cs k)!0) -ese&#8594; ((cs k)! Suc 0)))&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;((cs k)!0) -ese&#8594; ((cs k)! Suc 0)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">CptsEsEnv</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">pes_tran_not_etran1</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">conjoin_imp_cptses_k</span><span class="delimiter">:</span><span class=""> 
</span><span class="">      </span><span class="string">&quot;&#10214;c &#8712; cpts_of_pes pes s x; c &#8733; cs&#10215; 
        &#10233; cs k &#8712; cpts_of_es (pes k) s x&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8712; cpts_of_pes pes s x&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8733; cs&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c&#8712;cpts_pes &#8743; c!0 = (pes,s,x)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_pes_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;cs k &#8712; cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">conjoin_imp_cptses_k_help</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;cs k ! 0 = (pes k,s,x)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">conjoin_def</span><span class=""> </span><span class="">cpts_pes_not_empty</span><span class=""> </span><span class="">esconf_trip</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">gets_def</span><span class=""> 
</span><span class="">        </span><span class="">getspc_def</span><span class=""> </span><span class="">getx_def</span><span class=""> </span><span class="">length_greater_0_conv</span><span class=""> </span><span class="">same_spec_def</span><span class=""> </span><span class="">same_state_def</span><span class=""> </span><span class="">snd_conv</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">subsubsection</span></span><span class=""> </span><span class="cartouche">&#8249;Semantics is Compositional&#8250;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">conjoin_cs_imp_cpt</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;&#8707;k p. pes k = p; (&#8707;cs. (&#8704;k. (cs k) &#8712; cpts_of_es (pes k) s x) &#8743; c &#8733; cs)&#10215;
                                &#10233; c &#8712; cpts_of_pes pes s x&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;cs. (&#8704;k. (cs k) &#8712; cpts_of_es (pes k) s x) &#8743; c &#8733; cs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;k p. pes k = p&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">cs</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;(&#8704;k. (cs k) &#8712; cpts_of_es (pes k) s x) &#8743; c &#8733; cs&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;k. (cs k)!0=(pes k,s,x) &#8743; (cs k) &#8712; cpts_es) &#8743; c &#8733; cs&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">p</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;pes k = p&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">p</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;pes k = p&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(cs k)!0=(pes k,s,x) &#8743; (cs k) &#8712; cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(cs k) &#8800; []&quot;</span><span class="">  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;same_length c cs&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8800; []&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">same_length_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class=""> 
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">g0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c!0 = (pes,s,x)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;same_spec c cs&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. (getspc (c!0)) k = getspc_es ((cs k) ! 0)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">same_spec_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;k. (getspc (c!0)) k = pes k&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc (c!0) = pes&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;same_state c cs&quot;</span><span class="">  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets (c!0) = gets_es ((cs k)!0) &#8743; getx (c!0) = getx_es ((cs k)!0)&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">same_state_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets (c!0) = s &#8743; getx (c!0) = x&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">gets_def</span><span class=""> </span><span class="">getx_def</span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">getx_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">gets_def</span><span class=""> </span><span class="">getx_def</span><span class=""> </span><span class="">getspc_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">prod.collapse</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. i &gt; 0 &#8743; i &#8804; length c &#10230; take i c &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i &gt; 0 &#8743; i &#8804; length c&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;take i c &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">i</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="string">&quot;0.prems&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Suc</span><span class=""> </span><span class="">j</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;0 &lt; j &#8743; j &#8804; length c &#10233; take j c &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;0 &lt; Suc j &#8743; Suc j &#8804; length c&quot;</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;j = 0&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j = 0&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">cpts_pes.CptsPesOne</span><span class=""> </span><span class="">g0</span><span class=""> </span><span class="">hd_conv_nth</span><span class=""> </span><span class="">take_Suc</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j &#8800; 0&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;compat_tran c cs&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;j. Suc j &lt; length c &#10230; 
                              (&#8707;t k. (c!j -pes-(t&#9839;k)&#8594; c!Suc j) &#8743;
                              (&#8704;k t. (c!j -pes-(t&#9839;k)&#8594; c!Suc j) &#10230; (cs k!j -es-(t&#9839;k)&#8594; cs k! Suc j) &#8743;
                                      (&#8704;k&#39;. k&#39; &#8800; k &#10230; (cs k&#39;!j -ese&#8594; cs k&#39;! Suc j))))
                              &#8744;
                              (((c!j) -pese&#8594; (c!Suc j)) &#8743; (&#8704;k. (((cs k)!j) -ese&#8594; ((cs k)! Suc j))))&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">compat_tran_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j - 1 &#8805; 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc (j - 1) &lt; length c&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8707;t k. (c!(j-1) -pes-(t&#9839;k)&#8594; c!Suc (j-1)) &#8743;
                              (&#8704;k t. (c!(j-1) -pes-(t&#9839;k)&#8594; c!Suc (j-1)) &#10230; (cs k!(j-1) -es-(t&#9839;k)&#8594; cs k! Suc (j-1)) &#8743;
                                      (&#8704;k&#39;. k&#39; &#8800; k &#10230; (cs k&#39;!(j-1) -ese&#8594; cs k&#39;! Suc (j-1)))))
                              &#8744;
                              (((c!(j-1)) -pese&#8594; (c!Suc (j-1))) &#8743; (&#8704;k. (((cs k)!(j-1)) -ese&#8594; ((cs k)!Suc (j-1)))))&quot;</span><span class="">
</span><span class="">                   </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;take j c &#8712; cpts_pes&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d4</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> 
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;(&#8707;t k. (c!(j-1) -pes-(t&#9839;k)&#8594; c!Suc (j-1)) &#8743;
                              (&#8704;k t. (c!(j-1) -pes-(t&#9839;k)&#8594; c!Suc (j-1)) &#10230; (cs k!(j-1) -es-(t&#9839;k)&#8594; cs k! Suc (j-1)) &#8743;
                                      (&#8704;k&#39;. k&#39; &#8800; k &#10230; (cs k&#39;!(j-1) -ese&#8594; cs k&#39;! Suc (j-1)))))&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">t</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;((c!(j-1)) -pes-(t&#9839;k)&#8594; (c!Suc (j-1)))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;((take j c) ! (length (take j c) - 1)) -pes-(t&#9839;k)&#8594; (c!Suc (j-1))&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_diff_1</span><span class=""> </span><span class="">Suc_leD</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> 
</span><span class="">                        </span><span class="">d6</span><span class=""> </span><span class="">butlast_take</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">length_butlast</span><span class=""> </span><span class="">neq0_conv</span><span class=""> </span><span class="">nth_append_length</span><span class=""> </span><span class="">take_Suc_conv_app_nth</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(take j c) @ [c!Suc (j-1)] &#8712; cpts_pes&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_pes_onemore</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">d6</span><span class=""> </span><span class="">take_Suc_conv_app_nth</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;((c!(j-1)) -pese&#8594; (c!Suc (j-1))) &#8743; (&#8704;k. (((cs k)!(j-1)) -ese&#8594; ((cs k)!Suc (j-1))))&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;((take j c) ! (length (take j c) - 1)) -pese&#8594; (c!Suc (j-1))&quot;</span><span class=""> 
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_diff_1</span><span class=""> </span><span class="">Suc_leD</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> 
</span><span class="">                        </span><span class="">d6</span><span class=""> </span><span class="">butlast_take</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">length_butlast</span><span class=""> </span><span class="">neq0_conv</span><span class=""> </span><span class="">nth_append_length</span><span class=""> </span><span class="">take_Suc_conv_app_nth</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(take j c) @ [c!Suc (j-1)] &#8712; cpts_pes&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_pes_onemore</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">d6</span><span class=""> </span><span class="">take_Suc_conv_app_nth</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                    
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">g1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c&#8712;cpts_pes&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">g0</span><span class=""> </span><span class="">g1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_pes_def</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">comp_tran_env</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;(&#8704;k. cs k &#8712; cpts_of_es (pes k) t1 x1); c = (pes, t1, x1) # xs; c&#8712;cpts_pes; 
                        c &#8733; cs; c&#39; = (pes, s1, y1) # (pes, t1, x1) # xs&#10215; &#10233; 
      compat_tran c&#39; (&#955;k. (pes k, s1, y1) # cs k)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?cs&#39;</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;&#955;k. (pes k, s1, y1) # cs k&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. cs k &#8712; cpts_of_es (pes k) t1 x1&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8733; cs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c&#39; = (pes, s1, y1) # (pes, t1, x1) # xs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c = (pes, t1, x1) # xs&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. cs k &#8712; cpts_es &#8743; (cs k)!0 = (pes k,t1,x1)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;compat_tran c&#39; ?cs&#39;&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">j</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">dd0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc j &lt; length c&#39;&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(&#8707;t k. ((c&#39;!j) -pes-(t&#9839;k)&#8594; (c&#39;!Suc j)) &#8743;
                      (&#8704;k t. (c&#39;!j -pes-(t&#9839;k)&#8594; c&#39;!Suc j) &#10230; (?cs&#39; k!j -es-(t&#9839;k)&#8594; ?cs&#39; k! Suc j) &#8743;
                                      (&#8704;k&#39;. k&#39; &#8800; k &#10230; (?cs&#39; k&#39;!j -ese&#8594; ?cs&#39; k&#39;! Suc j))))
                      &#8744;
                      (((c&#39;!j) -pese&#8594; (c&#39;!Suc j)) &#8743; (&#8704;k. (((?cs&#39; k)!j) -ese&#8594; ((?cs&#39; k)! Suc j))))&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;j = 0&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j = 0&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;((c&#39;!0) -pese&#8594; (c&#39;!1))&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">pesetran.intros</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;k. (((?cs&#39; k)!0) -ese&#8594; ((?cs&#39; k)!1))&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="">esetran.intros</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j &#8800; 0&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d0_1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j &gt; 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;compat_tran c cs&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;j. Suc j &lt; length c &#10230; 
                              (&#8707;t k. (c!j -pes-(t&#9839;k)&#8594; c!Suc j) &#8743;
                              (&#8704;k t. (c!j -pes-(t&#9839;k)&#8594; c!Suc j) &#10230; (cs k!j -es-(t&#9839;k)&#8594; cs k! Suc j) &#8743;
                                      (&#8704;k&#39;. k&#39; &#8800; k &#10230; (cs k&#39;!j -ese&#8594; cs k&#39;! Suc j))))
                              &#8744;
                              (((c!j) -pese&#8594; (c!Suc j)) &#8743; (&#8704;k. (((cs k)!j) -ese&#8594; ((cs k)! Suc j))))&quot;</span><span class="">
</span><span class="">               </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">compat_tran_def</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">dd0</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc (j-1) &lt; length c&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?j1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;j - 1&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8707;t k. (c!(j-1) -pes-(t&#9839;k)&#8594; c!Suc (j-1)) &#8743;
                              (&#8704;k t. (c!(j-1) -pes-(t&#9839;k)&#8594; c!Suc (j-1)) &#10230; (cs k!(j-1) -es-(t&#9839;k)&#8594; cs k! Suc (j-1)) &#8743;
                                      (&#8704;k&#39;. k&#39; &#8800; k &#10230; (cs k&#39;!(j-1) -ese&#8594; cs k&#39;! Suc (j-1)))))
                              &#8744;
                              (((c!(j-1)) -pese&#8594; (c!Suc (j-1))) &#8743; (&#8704;k. (((cs k)!(j-1)) -ese&#8594; ((cs k)!Suc (j-1)))))&quot;</span><span class="">
</span><span class="">               </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">dd0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c&#39;!j = c!(j-1) &#8743; c&#39;!Suc j = c!Suc (j-1)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;k. (?cs&#39; k) ! j= (cs k)! (j-1)) &#8743; (&#8704;k. (?cs&#39; k) ! Suc j= (cs k)! Suc (j-1))&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">d0_1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d3</span><span class=""> </span><span class="">d4</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">        
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">compat_tran_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">comp_tran_pestran</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;(&#8704;k. cs k &#8712; cpts_of_es (pes2 k) t1 x1); c = (pes2, t1, x1) # xs; c&#8712;cpts_pes; 
                        c &#8733; cs; c&#39; = (pes1, s1, y1) # (pes2, t1, x1) # xs; (pes1, s1, y1) -pes-ct&#8594; (pes2, t1, x1)&#10215;
                        &#10233; compat_tran c&#39; (&#955;k. (pes1 k, s1, y1) # cs k)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?cs&#39;</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;&#955;k. (pes1 k, s1, y1) # cs k&quot;</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. cs k &#8712; cpts_of_es (pes2 k) t1 x1&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8733; cs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c&#39; = (pes1, s1, y1) # (pes2, t1, x1) # xs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c = (pes2, t1, x1) # xs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(pes1, s1, y1) -pes-ct&#8594; (pes2, t1, x1)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. cs k &#8712; cpts_es &#8743; (cs k)!0 = (pes2 k,t1,x1)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;compat_tran c&#39; ?cs&#39;&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">j</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">dd0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc j &lt; length c&#39;&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(&#8707;t k. ((c&#39;!j) -pes-(t&#9839;k)&#8594; (c&#39;!Suc j)) &#8743;
                      (&#8704;k t. (c&#39;!j -pes-(t&#9839;k)&#8594; c&#39;!Suc j) &#10230; (?cs&#39; k!j -es-(t&#9839;k)&#8594; ?cs&#39; k! Suc j) &#8743;
                                      (&#8704;k&#39;. k&#39; &#8800; k &#10230; (?cs&#39; k&#39;!j -ese&#8594; ?cs&#39; k&#39;! Suc j))))
                      &#8744;
                      (((c&#39;!j) -pese&#8594; (c&#39;!Suc j)) &#8743; (&#8704;k. (((?cs&#39; k)!j) -ese&#8594; ((?cs&#39; k)! Suc j))))&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;j = 0&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j = 0&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">aa</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;ct = (aa&#9839;k)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">get_actk_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">cases</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;es&#39;. ((pes1 k, s1, y1) -es-(aa&#9839;k)&#8594; (es&#39;, t1, x1)) &#8743; pes2 = pes1(k:=es&#39;)&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">pestran_estran</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">es&#39;</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;((pes1 k, s1, y1) -es-(aa&#9839;k)&#8594; (es&#39;, t1, x1)) &#8743; pes2 = pes1(k:=es&#39;)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;cs k &#8712;cpts_es &#8743; (cs k)!0 = (pes2 k,t1,x1)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">xs1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(cs k) = (pes2 k,t1,x1)#xs1&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">cpts_es_not_empty</span><span class=""> </span><span class="">neq_Nil_conv</span><span class=""> </span><span class="">nth_Cons_0</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?cs&#39; k = (pes1 k, s1, y1) # (pes2 k,t1,x1)#xs1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">g0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(c&#39;!0) -pes-(aa&#9839;k)&#8594; (c&#39;!Suc 0)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;k1 t1. (c&#39;!0 -pes-(t1&#9839;k1)&#8594; c&#39;!Suc 0) &#10230; (?cs&#39; k1!0 -es-(t1&#9839;k1)&#8594; ?cs&#39; k1! Suc 0) &#8743;
                                      (&#8704;k&#39;. k&#39; &#8800; k1 &#10230; (?cs&#39; k&#39;!0 -ese&#8594; ?cs&#39; k&#39;! Suc 0))&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">k1</span><span class=""> </span><span class="">t1</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c&#39;!0 -pes-(t1&#9839;k1)&#8594; c&#39;!Suc 0&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?cs&#39; k1!0 -es-(t1&#9839;k1)&#8594; ?cs&#39; k1! Suc 0&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="">fun_upd_apply</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">nth_Cons_Suc</span><span class=""> </span><span class="">pestran_estran</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;k&#39;. k&#39; &#8800; k1 &#10230; (?cs&#39; k&#39;!0 -ese&#8594; ?cs&#39; k&#39;! Suc 0)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="">esetran.intros</span><span class=""> </span><span class="">fun_upd_apply</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">nth_Cons_Suc</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">pestran_estran</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(c&#39;!0 -pes-(t1&#9839;k1)&#8594; c&#39;!Suc 0) &#10230; (?cs&#39; k1!0 -es-(t1&#9839;k1)&#8594; ?cs&#39; k1! Suc 0) &#8743;
                                      (&#8704;k&#39;. k&#39; &#8800; k1 &#10230; (?cs&#39; k&#39;!0 -ese&#8594; ?cs&#39; k&#39;! Suc 0))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j &#8800; 0&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d0_1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j &gt; 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;compat_tran c cs&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;j. Suc j &lt; length c &#10230; 
                              (&#8707;t k. (c!j -pes-(t&#9839;k)&#8594; c!Suc j) &#8743;
                              (&#8704;k t. (c!j -pes-(t&#9839;k)&#8594; c!Suc j) &#10230; (cs k!j -es-(t&#9839;k)&#8594; cs k! Suc j) &#8743;
                                      (&#8704;k&#39;. k&#39; &#8800; k &#10230; (cs k&#39;!j -ese&#8594; cs k&#39;! Suc j))))
                              &#8744;
                              (((c!j) -pese&#8594; (c!Suc j)) &#8743; (&#8704;k. (((cs k)!j) -ese&#8594; ((cs k)! Suc j))))&quot;</span><span class="">
</span><span class="">               </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">compat_tran_def</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">dd0</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc (j-1) &lt; length c&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">d0_1</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8707;t k. (c!(j-1) -pes-(t&#9839;k)&#8594; c!Suc (j-1)) &#8743;
                              (&#8704;k t. (c!(j-1) -pes-(t&#9839;k)&#8594; c!Suc (j-1)) &#10230; (cs k!(j-1) -es-(t&#9839;k)&#8594; cs k! Suc (j-1)) &#8743;
                                      (&#8704;k&#39;. k&#39; &#8800; k &#10230; (cs k&#39;!(j-1) -ese&#8594; cs k&#39;! Suc (j-1)))))
                              &#8744;
                              (((c!(j-1)) -pese&#8594; (c!Suc (j-1))) &#8743; (&#8704;k. (((cs k)!(j-1)) -ese&#8594; ((cs k)!Suc (j-1)))))&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">dd0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c&#39;!j = c!(j-1) &#8743; c&#39;!Suc j = c!Suc (j-1)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;k. (?cs&#39; k) ! j= (cs k)! (j-1)) &#8743; (&#8704;k. (?cs&#39; k) ! Suc j= (cs k)! Suc (j-1))&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">d0_1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d3</span><span class=""> </span><span class="">d4</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">        
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">compat_tran_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">cpt_imp_exist_conjoin_cs0</span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;&#8704;c. c &#8712; cpts_pes &#10230;
                (&#8707;cs. (&#8704;k. (cs k) &#8712; cpts_of_es ((getspc (c!0)) k) (gets (c!0)) (getx (c!0))) &#8743; c &#8733; cs)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">c</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8712; cpts_pes&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;cs. (&#8704;k. (cs k) &#8712; cpts_of_es ((getspc (c!0)) k) (gets (c!0)) (getx (c!0))) &#8743; c &#8733; cs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">c</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsPesOne</span><span class=""> </span><span class="">pes1</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">x1</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?cs</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;&#955;k. [(pes1 k, s1,x1)]&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?c</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;[(pes1, s1, x1)]&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;k. ?cs k &#8712; cpts_of_es (getspc (?c ! 0) k) (gets (?c ! 0)) (getx (?c ! 0))&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">k</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?cs k = [(pes1 k,s1,x1)]&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?cs k &#8712; cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">cpts_es.CptsEsOne</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?cs k &#8712; cpts_of_es (pes1 k) s1 x1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">cpts_of_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">gets_def</span><span class=""> </span><span class="">getspc_def</span><span class=""> </span><span class="">getx_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?c &#8733; ?cs&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;same_length ?c ?cs&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">same_length_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;same_state ?c ?cs&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">same_state_def</span><span class=""> </span><span class="">gets_def</span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">getx_def</span><span class=""> </span><span class="">getx_es_def</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">length_Cons</span><span class=""> </span><span class="">less_Suc0</span><span class=""> </span><span class="">list.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">snd_conv</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;same_spec ?c ?cs&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">same_spec_def</span><span class=""> </span><span class="">getspc_def</span><span class=""> </span><span class="">getspc_es_def</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">mono_tags</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">length_Cons</span><span class=""> </span><span class="">less_Suc0</span><span class=""> </span><span class="">list.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">nth_Cons_0</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;compat_tran ?c ?cs&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">compat_tran_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsPesEnv</span><span class=""> </span><span class="">pes1</span><span class=""> </span><span class="">t1</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">xs</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">y1</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?c</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;(pes1, t1, x1) # xs&quot;</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?c&#8712; cpts_pes&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;cs. (&#8704;k. cs k &#8712; cpts_of_es (getspc (?c ! 0) k) (gets (?c ! 0))
                       (getx (?c ! 0))) &#8743; ?c &#8733; cs&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">cs</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;k. cs k &#8712; cpts_of_es (pes1 k) t1 x1) &#8743; ?c &#8733; cs&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_def</span><span class=""> </span><span class="">gets_def</span><span class=""> </span><span class="">getx_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">snd_conv</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. cs k &#8712; cpts_es &#8743; (cs k)!0 = (pes1 k,t1,x1)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?c&#39;</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;(pes1, s1, y1) # (pes1, t1, x1) # xs&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?cs&#39;</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;&#955;k. (pes1 k,s1,y1)#(cs k)&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">g0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. ?cs&#39; k &#8712; cpts_of_es (getspc (?c&#39; ! 0) k)  (gets (?c&#39; ! 0)) (getx (?c&#39; ! 0))&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">k</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;cs k &#8712;cpts_es &#8743; (cs k)!0 = (pes1 k,t1,x1)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">xs1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;(cs k) = (pes1 k,t1,x1)#xs1&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">cpts_es_not_empty</span><span class=""> </span><span class="">neq_Nil_conv</span><span class=""> </span><span class="">nth_Cons_0</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?cs&#39; k &#8712; cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">cpts_es.CptsEsEnv</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?cs&#39; k &#8712; cpts_of_es (getspc (?c&#39; ! 0) k)  (gets (?c&#39; ! 0)) (getx (?c&#39; ! 0))&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">cpts_of_es_def</span><span class=""> </span><span class="">gets_def</span><span class=""> </span><span class="">getspc_def</span><span class=""> </span><span class="">getx_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?c &#8733; cs&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">g1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?c&#39; &#8733; ?cs&#39;&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;same_length ?c&#39; ?cs&#39;&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">conjoin_def</span><span class=""> </span><span class="">same_length_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;same_state ?c&#39; ?cs&#39;&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">k&#39;</span><span class=""> </span><span class="">j</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j &lt; length ?c&#39;&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets (?c&#39;!j) = gets_es ((?cs&#39; k&#39;)!j) &#8743; getx (?c&#39;!j) = getx_es ((?cs&#39; k&#39;)!j)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;j = 0&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j = 0&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">gets_def</span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">getx_def</span><span class=""> </span><span class="">getx_es_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j &#8800; 0&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">same_state_def</span><span class=""> </span><span class="">gets_def</span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">getx_def</span><span class=""> </span><span class="">getx_es_def</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">conjoin_def</span><span class=""> </span><span class="">length_Cons</span><span class=""> </span><span class="">less_Suc_eq_0_disj</span><span class=""> </span><span class="">nth_Cons_Suc</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">same_state_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;same_spec ?c&#39; ?cs&#39;&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">k&#39;</span><span class=""> </span><span class="">j</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j &lt; length ?c&#39;&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(getspc (?c&#39;!j)) k&#39; = getspc_es ((?cs&#39; k&#39;) ! j)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;j = 0&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j = 0&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_def</span><span class=""> </span><span class="">getspc_es_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j &#8800; 0&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">same_spec_def</span><span class=""> </span><span class="">getspc_def</span><span class=""> </span><span class="">getspc_es_def</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Nat.le_diff_conv2</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">conjoin_def</span><span class=""> 
</span><span class="">                        </span><span class="">less_Suc0</span><span class=""> </span><span class="">list.size</span><span class="delimiter">(</span><span class="">4</span><span class="delimiter">)</span><span class=""> </span><span class="">not_less</span><span class=""> </span><span class="">nth_Cons&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">same_spec_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;compat_tran ?c&#39; ?cs&#39;&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">comp_tran_env</span><span class=""> </span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">cs</span><span class=""> </span><span class="">pes1</span><span class=""> </span><span class="">t1</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="var">?c</span><span class=""> </span><span class="">xs</span><span class=""> </span><span class="var">?c&#39;</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">y1</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">g0</span><span class=""> </span><span class="">g1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">CptsPesComp</span><span class=""> </span><span class="">pes1</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">y1</span><span class=""> </span><span class="">ct</span><span class=""> </span><span class="">pes2</span><span class=""> </span><span class="">t1</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">xs</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?c</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;(pes2, t1, x1) # xs&quot;</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?c&#8712; cpts_pes&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;cs. (&#8704;k. cs k &#8712; cpts_of_es (getspc (?c ! 0) k) (gets (?c ! 0))
                       (getx (?c ! 0))) &#8743; ?c &#8733; cs&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b00</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(pes1, s1, y1) -pes-ct&#8594; (pes2, t1, x1)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">cs</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;k. cs k &#8712; cpts_of_es (pes2 k) t1 x1) &#8743; ?c &#8733; cs&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_def</span><span class=""> </span><span class="">gets_def</span><span class=""> </span><span class="">getx_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">snd_conv</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. cs k &#8712; cpts_es &#8743; (cs k)!0 = (pes2 k,t1,x1)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?c&#39;</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;(pes1, s1, y1) # (pes2, t1, x1) # xs&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?cs&#39;</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;&#955;k. (pes1 k,s1,y1)#(cs k)&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">g0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. ?cs&#39; k &#8712; cpts_of_es (getspc (?c&#39; ! 0) k)  (gets (?c&#39; ! 0)) (getx (?c&#39; ! 0))&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">k</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">ka</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">aa</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;ct = (aa&#9839;ka)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">get_actk_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">cases</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b00</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;es&#39;. ((pes1 ka, s1, y1) -es-(aa&#9839;ka)&#8594; (es&#39;, t1, x1)) &#8743; pes2 = pes1(ka:=es&#39;)&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">pestran_estran</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">es&#39;</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;((pes1 ka, s1, y1) -es-(aa&#9839;ka)&#8594; (es&#39;, t1, x1)) &#8743; pes2 = pes1(ka:=es&#39;)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;cs k &#8712;cpts_es &#8743; (cs k)!0 = (pes2 k,t1,x1)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">xs1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(cs k) = (pes2 k,t1,x1)#xs1&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">cpts_es_not_empty</span><span class=""> </span><span class="">neq_Nil_conv</span><span class=""> </span><span class="">nth_Cons_0</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?cs&#39; k = (pes1 k, s1, y1) # (pes2 k,t1,x1)#xs1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?cs&#39; k &#8712; cpts_of_es (getspc (?c&#39; ! 0) k)  (gets (?c&#39; ! 0)) (getx (?c&#39; ! 0))&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;k = ka&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;k = ka&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(pes1 k, s1, y1) -es-(aa&#9839;k)&#8594; (pes2 k, t1, x1)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?cs&#39; k &#8712; cpts_es&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_es.CptsEsComp</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">cpts_of_es_def</span><span class=""> </span><span class="">gets_def</span><span class=""> </span><span class="">getspc_def</span><span class=""> </span><span class="">getx_def</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;k &#8800; ka&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;pes1 k = pes2 k&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?cs&#39; k &#8712; cpts_es&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">cpts_es.CptsEsEnv</span><span class="delimiter">)</span><span class="">  
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">cpts_of_es_def</span><span class=""> </span><span class="">gets_def</span><span class=""> </span><span class="">getspc_def</span><span class=""> </span><span class="">getx_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?c &#8733; cs&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">g1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?c&#39; &#8733; ?cs&#39;&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;same_length ?c&#39; ?cs&#39;&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">conjoin_def</span><span class=""> </span><span class="">same_length_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;same_state ?c&#39; ?cs&#39;&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">k&#39;</span><span class=""> </span><span class="">j</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j &lt; length ?c&#39;&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets (?c&#39;!j) = gets_es ((?cs&#39; k&#39;)!j) &#8743; getx (?c&#39;!j) = getx_es ((?cs&#39; k&#39;)!j)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;j = 0&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j = 0&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">gets_def</span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">getx_def</span><span class=""> </span><span class="">getx_es_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">next</span></span><span class=""> 
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j &#8800; 0&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">same_state_def</span><span class=""> </span><span class="">gets_def</span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">getx_def</span><span class=""> </span><span class="">getx_es_def</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">conjoin_def</span><span class=""> </span><span class="">length_Cons</span><span class=""> </span><span class="">less_Suc_eq_0_disj</span><span class=""> </span><span class="">nth_Cons_Suc</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">same_state_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;same_spec ?c&#39; ?cs&#39;&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">k&#39;</span><span class=""> </span><span class="">j</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j &lt; length ?c&#39;&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(getspc (?c&#39;!j)) k&#39; = getspc_es ((?cs&#39; k&#39;) ! j)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;j = 0&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j = 0&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_def</span><span class=""> </span><span class="">getspc_es_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j &#8800; 0&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">same_spec_def</span><span class=""> </span><span class="">getspc_def</span><span class=""> </span><span class="">getspc_es_def</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Nat.le_diff_conv2</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_leI</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">conjoin_def</span><span class=""> 
</span><span class="">                        </span><span class="">list.size</span><span class="delimiter">(</span><span class="">4</span><span class="delimiter">)</span><span class=""> </span><span class="">neq0_conv</span><span class=""> </span><span class="">not_less</span><span class=""> </span><span class="">nth_Cons&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">same_spec_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b00</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;compat_tran ?c&#39; ?cs&#39;&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">comp_tran_pestran</span><span class=""> </span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">cs</span><span class=""> </span><span class="">pes2</span><span class=""> </span><span class="">t1</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="var">?c</span><span class=""> </span><span class="">xs</span><span class=""> </span><span class="var">?c&#39;</span><span class=""> </span><span class="">pes1</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">y1</span><span class=""> </span><span class="">ct</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">g0</span><span class=""> </span><span class="">g1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      
</span><span class="">  </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">mono_tags</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">cpt_imp_exist_conjoin_cs</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8712; cpts_of_pes pes s x
                &#10233; &#8707;cs. (&#8704;k. (cs k) &#8712; cpts_of_es (pes k) s x) &#8743; c &#8733; cs&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8712; cpts_of_pes pes s x&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;c!0=(pes,s,x) &#8743; c &#8712; cpts_pes&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_pes_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpt_imp_exist_conjoin_cs0</span><span class=""> </span><span class="">getspc_def</span><span class=""> </span><span class="">gets_def</span><span class=""> </span><span class="">getx_def</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">snd_conv</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">theorem</span></span><span class=""> </span><span class="">par_evtsys_semantics_comp</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;cpts_of_pes pes s x = {c. &#8707;cs. (&#8704;k. (cs k) &#8712; cpts_of_es (pes k) s x) &#8743; c &#8733; cs}&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;c. c&#8712;cpts_of_pes pes s x &#10230; (&#8707;cs. (&#8704;k. (cs k) &#8712; cpts_of_es (pes k) s x) &#8743; c &#8733; cs)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">c</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c&#8712;cpts_of_pes pes s x&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;cs. (&#8704;k. (cs k) &#8712; cpts_of_es (pes k) s x) &#8743; c &#8733; cs&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpt_imp_exist_conjoin_cs</span><span class=""> </span><span class="">cpts_of_pes_def</span><span class=""> </span><span class="">getx_def</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> </span><span class="">prod.sel</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;c. (&#8707;cs. (&#8704;k. (cs k) &#8712; cpts_of_es (pes k) s x) &#8743; c &#8733; cs) &#10230; c&#8712;cpts_of_pes pes s x&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">c</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;cs. (&#8704;k. (cs k) &#8712; cpts_of_es (pes k) s x) &#8743; c &#8733; cs&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;c&#8712;cpts_of_pes pes s x&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">conjoin_cs_imp_cpt</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword2"><span class="keyword">end</span></span><span class=""> </span><span class="comment">(*end of theory Computation*)</span></pre>

</div>
</body>
</html>
