<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Theory PiCore_RG_Prop (Isabelle2017: October 2017)</title>
<link media="all" rel="stylesheet" type="text/css" href="isabelle.css"/>
</head>

<body>
<div class="head"><h1>Theory PiCore_RG_Prop</h1>

<span class="command">theory</span> <span class="name">PiCore_RG_Prop</span><br/>
<span class="keyword">imports</span> <a href="PiCore_Hoare.html"><span class="name">PiCore_Hoare</span></a><br/>

</div>
<div class="source">
<pre class="source"><span class="comment">(*
Created by Yongwang Zhao (ywzhao@ntu.edu.sg, zhaoyw@buaa.edu.cn)
School of Computer Engineering, Nanyang Technological University, Singapore
and School of Computer Science &amp; Engineering, Beihang University, China
*)</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">section</span></span><span class=""> </span><span class="cartouche">&#8249;Rely-guarantee Reasoning&#8250;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">theory</span></span><span class=""> </span><span class="">PiCore_RG_Prop</span><span class="">
</span><span class="keyword2"><span class="keyword">imports</span></span><span class=""> </span><span class="">PiCore_Hoare</span><span class="">
</span><span class="keyword2"><span class="keyword">begin</span></span><span class="">
</span><span class="">  
</span><span class="keyword1"><span class="command">fun</span></span><span class=""> </span><span class="">all_evts_es</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) rgformula_ess &#8658; (&#39;l,&#39;k,&#39;s) rgformula_e set&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">all_evts_es_seq</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;all_evts_es (rgf_EvtSeq e es) = insert e (all_evts_es (fst es))&quot;</span><span class=""> </span><span class="delimiter">|</span><span class="">
</span><span class="">        </span><span class="">all_evts_es_esys</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;all_evts_es (rgf_EvtSys es) = es&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">fun</span></span><span class=""> </span><span class="">all_evts_esspec</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) esys &#8658; (&#39;l,&#39;k,&#39;s) event set&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;all_evts_esspec (EvtSeq e es) = insert e (all_evts_esspec es)&quot;</span><span class=""> </span><span class="delimiter">|</span><span class="">
</span><span class="">        </span><span class="string">&quot;all_evts_esspec (EvtSys es) = es&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">fun</span></span><span class=""> </span><span class="">all_basicevts_es</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) esys &#8658; (&#39;l,&#39;k,&#39;s) event set&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;all_basicevts_es (EvtSeq e es) = (if is_basicevt e then 
                                            insert e (all_basicevts_es es) 
                                           else all_basicevts_es es) &quot;</span><span class=""> </span><span class="delimiter">|</span><span class="">
</span><span class="">        </span><span class="string">&quot;all_basicevts_es (EvtSys es) = {x. x&#8712;es &#8743; is_basicevt x}&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">definition</span></span><span class=""> </span><span class="">all_evts</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) rgformula_par &#8658; (&#39;l,&#39;k,&#39;s) rgformula_e set&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;all_evts parsys &#8801; &#8899;k. all_evts_es (fst (parsys k))&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">definition</span></span><span class=""> </span><span class="">all_basicevts</span><span class=""> </span><span class="delimiter">::</span><span class=""> </span><span class="string">&quot;(&#39;l,&#39;k,&#39;s) paresys &#8658; (&#39;l,&#39;k,&#39;s) event set&quot;</span><span class="">
</span><span class="">  </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;all_basicevts parsys &#8801; &#8899;k. all_basicevts_es (parsys k)&quot;</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">all_evts_same</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Domain (all_evts_es rgfes) = all_evts_esspec (evtsys_spec rgfes)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">rgfes</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="string">&quot;all_evts_esspec.simps&quot;</span><span class=""> </span><span class="string">&quot;all_evts_es.simps&quot;</span><span class=""> </span><span class="string">&quot;evtsys_spec.simps&quot;</span><span class="">
</span><span class="">   </span><span class="">E<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span class=""> </span><span class="">eq_fst_iff</span><span class=""> </span><span class="">fsts.intros</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="string">&quot;all_evts_esspec.simps&quot;</span><span class=""> </span><span class="string">&quot;all_evts_es.simps&quot;</span><span class=""> </span><span class="string">&quot;evtsys_spec.simps&quot;</span><span class="">
</span><span class="">   </span><span class="">E<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span class=""> </span><span class="">fsts.intros</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">allbasicevts_es_blto_allevts</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;all_basicevts_es esys &#8838; all_evts_esspec esys&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">esys</span><span class="delimiter">)</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">auto</span><span class="delimiter">[</span><span class="">1</span><span class="delimiter">]</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">  
</span><span class="">  
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">allevts_es_blto_allevts</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. all_evts_esspec (evtsys_spec (fst (pesrgf k))) &#8838; Domain (all_evts pesrgf)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">k</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;all_evts_esspec (evtsys_spec (fst (pesrgf k))) = Domain (all_evts_es (fst (pesrgf k)))&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">all_evts_same</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;all_evts_es (fst (pesrgf k)) &#8838; all_evts pesrgf&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">all_evts_def</span><span class=""> </span><span class="">UNIV_I</span><span class=""> </span><span class="">UN_upper</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;all_evts_esspec (evtsys_spec (fst (pesrgf k))) &#8838; Domain (all_evts pesrgf)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">etran_nchg_curevt</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;c &#8733; cs &#10233; &#8704;k i. Suc i &lt; length (cs k) &#8743; (&#8707;actk. c!i-pes-actk&#8594;c!Suc i) 
                &#8743; (cs k ! i -ese&#8594; cs k ! Suc i) 
                &#10230; getx_es (cs k ! i) k = getx_es (cs k ! Suc i) k&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8733; cs&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length (cs k)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;actk. c!i-pes-actk&#8594;c!Suc i&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;cs k ! i -ese&#8594; cs k ! Suc i&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. length c = length (cs k)&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">conjoin_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="">same_length_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172;(c!i-pese&#8594;c!Suc i)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">pes_tran_not_etran1</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;t k. (c!i -pes-(t&#9839;k)&#8594; c!Suc i) &#8743;
                          (&#8704;k t. (c!i -pes-(t&#9839;k)&#8594; c!Suc i) &#10230; (cs k!i -es-(t&#9839;k)&#8594; cs k! Suc i) &#8743;
                                  (&#8704;k&#39;. k&#39; &#8800; k &#10230; (cs k&#39;!i -ese&#8594; cs k&#39;! Suc i)))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">conjoin_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="">compat_tran_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">t1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">k1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(c!i -pes-(t1&#9839;k1)&#8594; c!Suc i) &#8743;
                          (&#8704;k t. (c!i -pes-(t&#9839;k)&#8594; c!Suc i) &#10230; (cs k!i -es-(t&#9839;k)&#8594; cs k! Suc i) &#8743;
                                  (&#8704;k&#39;. k&#39; &#8800; k &#10230; (cs k&#39;!i -ese&#8594; cs k&#39;! Suc i)))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getx_es (cs k ! i) = getx_es (cs k1 ! i) 
                            &#8743; getx_es (cs k ! Suc i) = getx_es (cs k1 ! Suc i)&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">conjoin_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="">same_state_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="">same_spec_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;k &#8800; k1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">es_tran_not_etran1</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getx_es (cs k ! i) k = getx_es (cs k ! Suc i) k&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">t1</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Cmd</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cmd_ines_nchg_x2</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;cs k1 ! i&quot;</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">k1</span><span class=""> </span><span class="string">&quot;cs k1 ! Suc i&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="">a5</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">EvtEnt</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a5</span><span class=""> </span><span class="">a6</span><span class=""> </span><span class="">entevt_ines_notchg_otherx2</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;cs k1 ! i&quot;</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">k1</span><span class=""> </span><span class="string">&quot;cs k1 ! Suc i&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">            
</span><span class="">    </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">compt_notevtent_iscmd</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;c &#8733; cs &#10233; &#8704;k i. Suc i &lt; length (cs k) &#8743; (&#8707;actk. c!i-pes-actk&#8594;c!Suc i) 
                &#8743; (&#172; (&#8707;e. cs k ! i -es-EvtEnt e&#9839;k&#8594; cs k ! Suc i)) 
                &#10230; (&#8707;cmd. cs k ! i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc i) &#8744; cs k ! i -ese&#8594; cs k ! Suc i&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8733; cs&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length (cs k)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;actk. c!i-pes-actk&#8594;c!Suc i&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172; (&#8707;e. cs k ! i -es-EvtEnt e&#9839;k&#8594; cs k ! Suc i)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. length c = length (cs k)&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">conjoin_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="">same_length_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172;(c!i-pese&#8594;c!Suc i)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">pes_tran_not_etran1</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;t k. (c!i -pes-(t&#9839;k)&#8594; c!Suc i) &#8743;
                          (&#8704;k t. (c!i -pes-(t&#9839;k)&#8594; c!Suc i) &#10230; (cs k!i -es-(t&#9839;k)&#8594; cs k! Suc i) &#8743;
                                  (&#8704;k&#39;. k&#39; &#8800; k &#10230; (cs k&#39;!i -ese&#8594; cs k&#39;! Suc i)))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">conjoin_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="">compat_tran_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">t1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">k1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(c!i -pes-(t1&#9839;k1)&#8594; c!Suc i) &#8743;
                          (&#8704;k t. (c!i -pes-(t&#9839;k)&#8594; c!Suc i) &#10230; (cs k!i -es-(t&#9839;k)&#8594; cs k! Suc i) &#8743;
                                  (&#8704;k&#39;. k&#39; &#8800; k &#10230; (cs k&#39;!i -ese&#8594; cs k&#39;! Suc i)))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(&#8707;cmd. cs k ! i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc i) &#8744; cs k ! i -ese&#8594; cs k ! Suc i&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;k = k1&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;k = k1&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;cmd. cs k ! i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc i&quot;</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">t1</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Cmd</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">              </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">EvtEnt</span><span class=""> </span><span class="">x</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;k &#8800; k1&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;cs k ! i -ese&#8594; cs k ! Suc i&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">evtent_impl_curevt_in_cpts_es</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#10214;c &#8733; cs; &#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. c!j-pes-actk&#8594;c!Suc j)&#10215;
      &#10233; &#8704;k i. Suc i &lt; length (cs k) &#8743; ((cs k)!i -es-((EvtEnt e)&#9839;k)&#8594; (cs k)!(Suc i)) 
                &#10230; (&#8704;j. j &gt; Suc i &#8743; Suc j &lt; length (cs k) 
                        &#8743; (&#8704;m. m &gt; i &#8743; m &lt; j &#10230; &#172;(&#8707;e. (cs k)!m -es-((EvtEnt e)&#9839;k)&#8594; (cs k)!(Suc m)))
                        &#10230; (&#8704;m. m &gt; i &#8743; m &#8804; j &#10230; getx_es ((cs k)!m) k = e))&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8733; cs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. c!j-pes-actk&#8594;c!Suc j)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i k. Suc i &lt; length (cs k) &#8743; (&#8707;actk. c ! i -pes-actk&#8594; c ! Suc i) 
                          &#8743; &#172; (&#8707;e. cs k ! i -es-EvtEnt e&#9839;k&#8594; cs k ! Suc i) 
                                &#10230; (&#8707;cmd. cs k ! i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc i) &#8744; cs k ! i -ese&#8594; cs k ! Suc i&quot;</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">compt_notevtent_iscmd</span><span class=""> </span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8896;i k. Suc i &lt; length (cs k) &#8743; (&#8707;actk. c ! i -pes-actk&#8594; c ! Suc i) 
                        &#8743; &#172; (&#8707;e. cs k ! i -es-EvtEnt e&#9839;k&#8594; cs k ! Suc i) 
                                &#10233; (&#8707;cmd. cs k ! i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc i) 
                                    &#8744; cs k ! i -ese&#8594; cs k ! Suc i&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;k i. Suc i &lt; length (cs k) &#8743; (&#8707;actk. c ! i -pes-actk&#8594; c ! Suc i) 
                        &#8743; cs k ! i -ese&#8594; cs k ! Suc i &#10230;
                        getx_es (cs k ! i) k = getx_es (cs k ! Suc i) k&quot;</span><span class=""> 
</span><span class="">       </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">etran_nchg_curevt</span><span class=""> </span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8896;i k. Suc i &lt; length (cs k) &#8743; (&#8707;actk. c ! i -pes-actk&#8594; c ! Suc i) 
                        &#8743; cs k ! i -ese&#8594; cs k ! Suc i &#10233;
                        getx_es (cs k ! i) k = getx_es (cs k ! Suc i) k&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length (cs k) &#8743; ((cs k)!i -es-((EvtEnt e)&#9839;k)&#8594; (cs k)!(Suc i))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">es1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a01</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(cs k)!i = (es1,s1,x1)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">prod_cases3</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">es2</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">s2</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a02</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(cs k)!Suc i = (es2,s2,x2)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">prod_cases3</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. length c = length (cs k)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">conjoin_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="">same_length_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;j. j &gt; Suc i &#8743; Suc j &lt; length (cs k) 
                        &#8743; (&#8704;m. m &gt; i &#8743; m &lt; j &#10230; &#172;(&#8707;e. (cs k)!m -es-((EvtEnt e)&#9839;k)&#8594; (cs k)!(Suc m)))
                        &#10230; (&#8704;m. m &gt; i &#8743; m &#8804; j &#10230; getx_es ((cs k)!m) k = e)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class="">-</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">j</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j &gt; Suc i &#8743; Suc j &lt; length (cs k)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;m. m &gt; i &#8743; m &lt; j &#10230; &#172;(&#8707;e. (cs k)!m -es-((EvtEnt e)&#9839;k)&#8594; (cs k)!(Suc m))&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;m. m &gt; i &#8743; m &#8804; j &#10230; getx_es ((cs k)!m) k = e&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">j</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Suc</span><span class=""> </span><span class="">sj</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; sj &#8743; Suc sj &lt; length (cs k) &#10233;
                                (&#8704;m. i &lt; m &#8743; m &lt; sj &#10230; &#172; (&#8707;e. cs k ! m -es-EvtEnt e&#9839;k&#8594; cs k ! Suc m)) &#10233;
                                (&#8704;m. i &lt; m &#8743; m &#8804; sj &#10230; getx_es (cs k ! m) k = e)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; Suc sj &#8743; Suc (Suc sj) &lt; length (cs k)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;m. i &lt; m &#8743; m &lt; Suc sj &#10230; &#172; (&#8707;e. cs k ! m -es-EvtEnt e&#9839;k&#8594; cs k ! Suc m)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;Suc i = sj&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i = sj&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> 
</span><span class="">                      </span><span class="keyword1"><span class="command">proof</span></span><span class="">-</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">                        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">m</span><span class="">
</span><span class="">                        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i &lt; m &#8743; m &#8804; Suc sj&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getx_es (cs k ! Suc i) k = e&quot;</span><span class=""> 
</span><span class="">                          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">entevt_ines_chg_selfx2</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;cs k ! i&quot;</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="string">&quot;cs k ! Suc i&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getx_es (cs k ! m) k = e&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;m = Suc i&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">f0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m = Suc i&quot;</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;m &#8800; Suc i&quot;</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m = Suc (Suc i)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172; (&#8707;e. cs k ! Suc i -es-EvtEnt e&#9839;k&#8594; cs k ! Suc (Suc i))&quot;</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;actk. c ! Suc i -pes-actk&#8594; c ! Suc (Suc i)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(&#8707;cmd. cs k ! Suc i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc (Suc i)) &#8744;
                                      cs k ! Suc i -ese&#8594; cs k ! Suc (Suc i)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;Suc i&quot;</span><span class=""> </span><span class="">k</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> 
</span><span class="">                              </span><span class="keyword1"><span class="command">proof</span></span><span class=""> 
</span><span class="">                                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;&#8707;cmd. cs k ! Suc i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc (Suc i)&quot;</span><span class="">
</span><span class="">                                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">cmd</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">g0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;cs k ! Suc i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc (Suc i)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">f0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getx_es (cs k ! Suc (Suc i)) k = e&quot;</span><span class=""> 
</span><span class="">                                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cmd_ines_nchg_x2</span><span class=""> </span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;cs k ! Suc i&quot;</span><span class=""> </span><span class="">cmd</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="string">&quot;cs k ! Suc (Suc i)&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">f0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">g0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;cs k ! Suc i -ese&#8594; cs k ! Suc (Suc i)&quot;</span><span class="">
</span><span class="">                                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">g1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;actk. c ! Suc i -pes-actk&#8594; c ! Suc (Suc i)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">f0</span><span class=""> </span><span class="">g0</span><span class=""> </span><span class="">g1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;Suc i&quot;</span><span class=""> </span><span class="">k</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &#8800; sj&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; sj&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;m. i &lt; m &#8743; m &#8804; sj &#10230; getx_es (cs k ! m) k = e&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">                        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">m</span><span class="">
</span><span class="">                        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i &lt; m &#8743; m &#8804; Suc sj&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot; getx_es (cs k ! m) k = e&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;i &lt; m &#8743; m &lt; Suc sj&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">f0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i &lt; m &#8743; m &lt; Suc sj&quot;</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">f0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(i &lt; m &#8743; m &lt; Suc sj)&quot;</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m = Suc sj&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getx_es (cs k ! sj) k = e&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172; (&#8707;e. cs k ! sj -es-EvtEnt e&#9839;k&#8594; cs k ! Suc sj)&quot;</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172; (&#8707;e. cs k ! sj -es-EvtEnt e&#9839;k&#8594; cs k ! Suc sj)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;actk. c ! sj -pes-actk&#8594; c ! Suc sj&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="">f3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(&#8707;cmd. cs k ! sj -es-Cmd cmd&#9839;k&#8594; cs k ! Suc sj) &#8744;
                                      cs k ! sj -ese&#8594; cs k ! Suc sj&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">sj</span><span class=""> </span><span class="">k</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">proof</span></span><span class="">
</span><span class="">                                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;(&#8707;cmd. cs k ! sj -es-Cmd cmd&#9839;k&#8594; cs k ! Suc sj)&quot;</span><span class="">
</span><span class="">                                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">cmd</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">g0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;cs k !sj -es-Cmd cmd&#9839;k&#8594; cs k ! Suc sj&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">f2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getx_es (cs k ! Suc sj) k = e&quot;</span><span class=""> 
</span><span class="">                                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cmd_ines_nchg_x2</span><span class=""> </span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;cs k ! sj&quot;</span><span class=""> </span><span class="">cmd</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="string">&quot;cs k ! Suc sj&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">g0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;cs k ! sj -ese&#8594; cs k ! Suc sj&quot;</span><span class="">
</span><span class="">                                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">g1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;actk. c ! sj -pes-actk&#8594; c ! Suc sj&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="">f2</span><span class=""> </span><span class="">g0</span><span class=""> </span><span class="">g1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">sj</span><span class=""> </span><span class="">k</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">}</span></span><span class=""> 
</span><span class="">                      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">evtent_impl_curevt_in_cpts_es1</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#10214;c &#8733; cs; &#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. c!j-pes-actk&#8594;c!Suc j)&#10215; 
      &#10233; &#8704;k i. Suc i &lt; length (cs k) &#8743; ((cs k)!i -es-((EvtEnt e)&#9839;k)&#8594; (cs k)!(Suc i)) 
                &#10230; (&#8704;j. j &#8805; Suc i &#8743; Suc j &#8804; length (cs k) 
                        &#8743; (&#8704;m. m &gt; i &#8743; m &lt; j &#10230; &#172;(&#8707;e. (cs k)!m -es-((EvtEnt e)&#9839;k)&#8594; (cs k)!(Suc m)))
                        &#10230; (&#8704;m. m &gt; i &#8743; m &#8804; j &#10230; getx_es ((cs k)!m) k = e))&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8733; cs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. c!j-pes-actk&#8594;c!Suc j)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i k. Suc i &lt; length (cs k) &#8743; (&#8707;actk. c ! i -pes-actk&#8594; c ! Suc i) 
                          &#8743; &#172; (&#8707;e. cs k ! i -es-EvtEnt e&#9839;k&#8594; cs k ! Suc i) 
                                &#10230; (&#8707;cmd. cs k ! i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc i) &#8744; cs k ! i -ese&#8594; cs k ! Suc i&quot;</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">compt_notevtent_iscmd</span><span class=""> </span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8896;i k. Suc i &lt; length (cs k) &#8743; (&#8707;actk. c ! i -pes-actk&#8594; c ! Suc i) 
                        &#8743; &#172; (&#8707;e. cs k ! i -es-EvtEnt e&#9839;k&#8594; cs k ! Suc i) 
                                &#10233; (&#8707;cmd. cs k ! i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc i) 
                                    &#8744; cs k ! i -ese&#8594; cs k ! Suc i&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;k i. Suc i &lt; length (cs k) &#8743; (&#8707;actk. c ! i -pes-actk&#8594; c ! Suc i) 
                        &#8743; cs k ! i -ese&#8594; cs k ! Suc i &#10230;
                        getx_es (cs k ! i) k = getx_es (cs k ! Suc i) k&quot;</span><span class=""> 
</span><span class="">       </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">etran_nchg_curevt</span><span class=""> </span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8896;i k. Suc i &lt; length (cs k) &#8743; (&#8707;actk. c ! i -pes-actk&#8594; c ! Suc i) 
                        &#8743; cs k ! i -ese&#8594; cs k ! Suc i &#10233;
                        getx_es (cs k ! i) k = getx_es (cs k ! Suc i) k&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length (cs k) &#8743; ((cs k)!i -es-((EvtEnt e)&#9839;k)&#8594; (cs k)!(Suc i))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">es1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a01</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(cs k)!i = (es1,s1,x1)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">prod_cases3</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">es2</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">s2</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a02</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(cs k)!Suc i = (es2,s2,x2)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">prod_cases3</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. length c = length (cs k)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">conjoin_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="">same_length_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;j. j &#8805; Suc i &#8743; Suc j &#8804; length (cs k) 
                        &#8743; (&#8704;m. m &gt; i &#8743; m &lt; j &#10230; &#172;(&#8707;e. (cs k)!m -es-((EvtEnt e)&#9839;k)&#8594; (cs k)!(Suc m)))
                        &#10230; (&#8704;m. m &gt; i &#8743; m &#8804; j &#10230; getx_es ((cs k)!m) k = e)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class="">-</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">j</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j &#8805; Suc i &#8743; Suc j &#8804; length (cs k)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;m. m &gt; i &#8743; m &lt; j &#10230; &#172;(&#8707;e. (cs k)!m -es-((EvtEnt e)&#9839;k)&#8594; (cs k)!(Suc m))&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;m. m &gt; i &#8743; m &#8804; j &#10230; getx_es ((cs k)!m) k = e&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">j</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Suc</span><span class=""> </span><span class="">sj</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &#8804; sj &#8743; Suc sj &#8804; length (cs k) &#10233;
                                (&#8704;m. i &lt; m &#8743; m &lt; sj &#10230; &#172; (&#8707;e. cs k ! m -es-EvtEnt e&#9839;k&#8594; cs k ! Suc m)) &#10233;
                                (&#8704;m. i &lt; m &#8743; m &#8804; sj &#10230; getx_es (cs k ! m) k = e)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &#8804; Suc sj &#8743; Suc (Suc sj) &#8804; length (cs k)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;m. i &lt; m &#8743; m &lt; Suc sj &#10230; &#172; (&#8707;e. cs k ! m -es-EvtEnt e&#9839;k&#8594; cs k ! Suc m)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;Suc i = Suc sj&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i = Suc sj&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> 
</span><span class="">                      </span><span class="keyword1"><span class="command">proof</span></span><span class="">-</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">                        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">m</span><span class="">
</span><span class="">                        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i &lt; m &#8743; m &#8804; Suc sj&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getx_es (cs k ! Suc i) k = e&quot;</span><span class=""> 
</span><span class="">                          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">entevt_ines_chg_selfx2</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;cs k ! i&quot;</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="string">&quot;cs k ! Suc i&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getx_es (cs k ! m) k = e&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;m = Suc i&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">f0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m = Suc i&quot;</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;m &#8800; Suc i&quot;</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m = Suc (Suc i)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172; (&#8707;e. cs k ! Suc i -es-EvtEnt e&#9839;k&#8594; cs k ! Suc (Suc i))&quot;</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Suc_n_not_le_n</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;actk. c ! Suc i -pes-actk&#8594; c ! Suc (Suc i)&quot;</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Suc_le_lessD</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">Suc_n_not_le_n</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">f0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(&#8707;cmd. cs k ! Suc i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc (Suc i)) &#8744;
                                      cs k ! Suc i -ese&#8594; cs k ! Suc (Suc i)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;Suc i&quot;</span><span class=""> </span><span class="">k</span><span class="delimiter">]</span><span class="">
</span><span class="">                                        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Suc_le_eq</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">Suc_n_not_le_n</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">f0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> 
</span><span class="">                              </span><span class="keyword1"><span class="command">proof</span></span><span class=""> 
</span><span class="">                                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;&#8707;cmd. cs k ! Suc i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc (Suc i)&quot;</span><span class="">
</span><span class="">                                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">cmd</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">g0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;cs k ! Suc i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc (Suc i)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">f0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getx_es (cs k ! Suc (Suc i)) k = e&quot;</span><span class=""> 
</span><span class="">                                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cmd_ines_nchg_x2</span><span class=""> </span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;cs k ! Suc i&quot;</span><span class=""> </span><span class="">cmd</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="string">&quot;cs k ! Suc (Suc i)&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">f0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">g0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;cs k ! Suc i -ese&#8594; cs k ! Suc (Suc i)&quot;</span><span class="">
</span><span class="">                                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">g1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;actk. c ! Suc i -pes-actk&#8594; c ! Suc (Suc i)&quot;</span><span class="">
</span><span class="">                                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="cartouche">&#8249;&#8707;actk. c ! Suc i -pes-actk&#8594; c ! Suc (Suc i)&#8250;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">f0</span><span class=""> </span><span class="">g0</span><span class=""> </span><span class="">g1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;Suc i&quot;</span><span class=""> </span><span class="">k</span><span class="delimiter">]</span><span class="">
</span><span class="">                                  </span><span class="">Suc_n_not_le_n</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &#8800; Suc sj&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; Suc sj&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;m. i &lt; m &#8743; m &#8804; sj &#10230; getx_es (cs k ! m) k = e&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">                        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">m</span><span class="">
</span><span class="">                        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i &lt; m &#8743; m &#8804; Suc sj&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot; getx_es (cs k ! m) k = e&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;i &lt; m &#8743; m &lt; Suc sj&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">f0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i &lt; m &#8743; m &lt; Suc sj&quot;</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">f0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(i &lt; m &#8743; m &lt; Suc sj)&quot;</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m = Suc sj&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getx_es (cs k ! sj) k = e&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172; (&#8707;e. cs k ! sj -es-EvtEnt e&#9839;k&#8594; cs k ! Suc sj)&quot;</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Suc_less_SucD</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">lessI</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172; (&#8707;e. cs k ! sj -es-EvtEnt e&#9839;k&#8594; cs k ! Suc sj)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;actk. c ! sj -pes-actk&#8594; c ! Suc sj&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="">f3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(&#8707;cmd. cs k ! sj -es-Cmd cmd&#9839;k&#8594; cs k ! Suc sj) &#8744;
                                      cs k ! sj -ese&#8594; cs k ! Suc sj&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">sj</span><span class=""> </span><span class="">k</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">proof</span></span><span class="">
</span><span class="">                                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;(&#8707;cmd. cs k ! sj -es-Cmd cmd&#9839;k&#8594; cs k ! Suc sj)&quot;</span><span class="">
</span><span class="">                                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">cmd</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">g0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;cs k !sj -es-Cmd cmd&#9839;k&#8594; cs k ! Suc sj&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">f2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getx_es (cs k ! Suc sj) k = e&quot;</span><span class=""> 
</span><span class="">                                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cmd_ines_nchg_x2</span><span class=""> </span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;cs k ! sj&quot;</span><span class=""> </span><span class="">cmd</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="string">&quot;cs k ! Suc sj&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">g0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;cs k ! sj -ese&#8594; cs k ! Suc sj&quot;</span><span class="">
</span><span class="">                                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">g1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;actk. c ! sj -pes-actk&#8594; c ! Suc sj&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="">f2</span><span class=""> </span><span class="">g0</span><span class=""> </span><span class="">g1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">sj</span><span class=""> </span><span class="">k</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">}</span></span><span class=""> 
</span><span class="">                      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">evtent_impl_curevt_in_cpts_es2</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#10214;c &#8733; cs; &#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. c!j-pes-actk&#8594;c!Suc j)&#10215;
      &#10233; &#8704;k i. Suc i &lt; length (cs k) &#8743; ((cs k)!i -es-((EvtEnt e)&#9839;k)&#8594; (cs k)!(Suc i)) 
                &#10230; (&#8704;j. j &gt; i &#8743; Suc j &lt; length (cs k) 
                        &#8743; (&#8704;m. m &gt; i &#8743; m &lt; j &#10230; &#172;(&#8707;e. (cs k)!m -es-((EvtEnt e)&#9839;k)&#8594; (cs k)!(Suc m)))
                        &#10230; (&#8704;m. m &gt; i &#8743; m &#8804; j &#10230; getx_es ((cs k)!m) k = e))&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8733; cs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. c!j-pes-actk&#8594;c!Suc j)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length (cs k) &#8743; ((cs k)!i -es-((EvtEnt e)&#9839;k)&#8594; (cs k)!(Suc i))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;j. j &gt; i &#8743; Suc j &lt; length (cs k) 
                        &#8743; (&#8704;m. m &gt; i &#8743; m &lt; j &#10230; &#172;(&#8707;e. (cs k)!m -es-((EvtEnt e)&#9839;k)&#8594; (cs k)!(Suc m)))
                        &#10230; (&#8704;m. m &gt; i &#8743; m &#8804; j &#10230; getx_es ((cs k)!m) k = e)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">j</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j &gt; i &#8743; Suc j &lt; length (cs k)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;m. m &gt; i &#8743; m &lt; j &#10230; &#172;(&#8707;e. (cs k)!m -es-((EvtEnt e)&#9839;k)&#8594; (cs k)!(Suc m))&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;m. m &gt; i &#8743; m &#8804; j &#10230; getx_es ((cs k)!m) k = e&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;j = Suc i&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j = Suc i&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">entevt_ines_chg_selfx2</span><span class=""> </span><span class="">le_SucE</span><span class=""> </span><span class="">not_less</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j &#8800; Suc i&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;j &gt; Suc i&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtent_impl_curevt_in_cpts_es</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">cs</span><span class=""> </span><span class="">i</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">j</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">anonyevtseq_and_noet_impl_allanonyevtseq_bef</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;esl &#8712; cpts_es &#10233;
    &#8704;m &lt; length esl. (&#8707;e es. getspc_es (esl!m) = EvtSeq e es &#8743; is_anonyevt e) 
                      &#10230; (&#8704;i &lt; m. &#172; (&#8707;e k. esl ! i -es-EvtEnt e&#9839;k&#8594; esl ! Suc i)) 
                      &#10230; (&#8704;i &lt; m. &#8707;e es. getspc_es (esl!i) = EvtSeq e es &#8743; is_anonyevt e)&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl &#8712; cpts_es&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">m</span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m &lt; length esl&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;e es. getspc_es (esl!m) = EvtSeq e es &#8743; is_anonyevt e&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i &lt; m. &#172; (&#8707;e k. esl ! i -es-EvtEnt e&#9839;k&#8594; esl ! Suc i)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i &lt; m. &#8707;e es. getspc_es (esl!i) = EvtSeq e es &#8743; is_anonyevt e&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">m</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">0</span><span class=""> </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Suc</span><span class=""> </span><span class="">n</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;n &lt; length esl &#10233;
                      &#8707;e es. getspc_es (esl ! n) = EvtSeq e es &#8743; is_anonyevt e &#10233;
                      &#8704;i &lt; n. &#172; (&#8707;e k. esl ! i -es-EvtEnt e&#9839;k&#8594; esl ! Suc i) &#10233;
                      &#8704;i &lt; n. &#8707;e es. getspc_es (esl ! i) = EvtSeq e es &#8743; is_anonyevt e&quot;</span><span class="">
</span><span class="">            </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc n &lt; length esl&quot;</span><span class="">
</span><span class="">            </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;e es. getspc_es (esl ! Suc n) = EvtSeq e es &#8743; is_anonyevt e&quot;</span><span class="">
</span><span class="">            </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i &lt; Suc n. &#172; (&#8707;e k. esl ! i -es-EvtEnt e&#9839;k&#8594; esl ! Suc i)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;n = 0&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;n = 0&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172; (&#8707;e k. esl ! 0 -es-EvtEnt e&#9839;k&#8594; esl ! 1)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;esl ! 0 -ese&#8594; esl ! 1 &#8744; (&#8707;c k. esl ! 0 -es-Cmd c&#9839;k&#8594; esl ! 1)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">notevtent_cptses_isenvorcmd</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">esl</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;e es. getspc_es (esl ! 0) = EvtSeq e es &#8743; is_anonyevt e&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">proof</span></span><span class="">
</span><span class="">                  </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl ! 0 -ese&#8594; esl ! 1&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">esetran_eqconf1</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;esl ! 0&quot;</span><span class=""> </span><span class="string">&quot;esl ! 1&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                  </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;c k. esl ! 0 -es-Cmd c&#9839;k&#8594; esl ! 1&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">c</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;esl ! 0 -es-Cmd c&#9839;k&#8594; esl ! 1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cmd_enable_impl_anonyevt2</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;esl ! 0&quot;</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="string">&quot;esl ! 1&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">              </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;n &#8800; 0&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;n &gt; 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172; (&#8707;e k. esl ! n -es-EvtEnt e&#9839;k&#8594; esl ! Suc n)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;drop n esl&#8712;cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_es_dropi2</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">esl</span><span class=""> </span><span class="">n</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;2 &#8804; length (drop n esl)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;drop n esl ! 0 = esl ! n&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;drop n esl ! 1 = esl ! Suc n&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;esl ! n -ese&#8594; esl ! Suc n &#8744; (&#8707;c k. esl ! n -es-Cmd c&#9839;k&#8594; esl ! Suc n)&quot;</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">notevtent_cptses_isenvorcmd</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;drop n esl&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">proof</span></span><span class="">
</span><span class="">                  </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl ! n -ese&#8594; esl ! Suc n&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;e es. getspc_es (esl ! n) = EvtSeq e es &#8743; is_anonyevt e&quot;</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">esetran_eqconf1</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;esl ! n&quot;</span><span class=""> </span><span class="string">&quot;esl ! Suc n&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i &lt; n. &#8707;e es. getspc_es (esl ! i) = EvtSeq e es &#8743; is_anonyevt e&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">less_Suc_eq</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                  </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;c k. esl ! n -es-Cmd c&#9839;k&#8594; esl ! Suc n&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">k1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;esl ! n -es-Cmd c1&#9839;k1&#8594; esl ! Suc n&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;e e&#39; es1. getspc_es (esl ! n) = EvtSeq e es1 &#8743; e = AnonyEvent e&#39;&quot;</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cmd_enable_impl_anonyevt2</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;(esl ! n)&quot;</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">k1</span><span class=""> </span><span class="string">&quot;esl ! Suc n&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i &lt; n. &#8707;e es. getspc_es (esl ! i) = EvtSeq e es &#8743; is_anonyevt e&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">is_anonyevt.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">less_Suc_eq</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">qed</span></span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">anonyevtseq_and_noet_impl_allanonyevtseq_bef3</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;&#10214;c &#8733; cs; cs k &#8712; cpts_es; m &lt; length (cs k)&#10215; &#10233;
    (&#8707;e es. getspc_es ((cs k)!m) = EvtSeq e es &#8743; is_anonyevt e) 
                      &#10230; (&#8704;i &lt; m. &#172; (&#8707;e. (cs k) ! i -es-EvtEnt e&#9839;k&#8594; (cs k) ! Suc i)) 
                      &#10230; (&#8704;i &lt; m. &#8707;e es. getspc_es ((cs k)!i) = EvtSeq e es &#8743; is_anonyevt e)&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(cs k) &#8712; cpts_es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8733; cs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m &lt; length (cs k)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;e es. getspc_es ((cs k)!m) = EvtSeq e es &#8743; is_anonyevt e&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i &lt; m. &#172; (&#8707;e. (cs k) ! i -es-EvtEnt e&#9839;k&#8594; (cs k) ! Suc i)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i &lt; m. &#8707;e es. getspc_es ((cs k)!i) = EvtSeq e es &#8743; is_anonyevt e&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">m</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">0</span><span class=""> </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Suc</span><span class=""> </span><span class="">n</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;n &lt; length (cs k) &#10233;
                      &#8707;e es. getspc_es ((cs k) ! n) = EvtSeq e es &#8743; is_anonyevt e &#10233;
                      &#8704;i &lt; n. &#172; (&#8707;e. (cs k) ! i -es-EvtEnt e&#9839;k&#8594; (cs k) ! Suc i) &#10233;
                      &#8704;i &lt; n. &#8707;e es. getspc_es ((cs k) ! i) = EvtSeq e es &#8743; is_anonyevt e&quot;</span><span class="">
</span><span class="">            </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc n &lt; length (cs k)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;e es. getspc_es ((cs k) ! Suc n) = EvtSeq e es &#8743; is_anonyevt e&quot;</span><span class="">
</span><span class="">            </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i &lt; Suc n. &#172; (&#8707;e. (cs k) ! i -es-EvtEnt e&#9839;k&#8594; (cs k) ! Suc i)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;n = 0&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;n = 0&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172; (&#8707;e. (cs k) ! 0 -es-EvtEnt e&#9839;k&#8594; (cs k) ! 1)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(cs k) ! 0 -ese&#8594; (cs k) ! 1 &#8744; (&#8707;c. (cs k) ! 0 -es-Cmd c&#9839;k&#8594; (cs k) ! 1)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">acts_in_conjoin_cpts</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">One_nat_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;e es. getspc_es ((cs k) ! 0) = EvtSeq e es &#8743; is_anonyevt e&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">proof</span></span><span class="">
</span><span class="">                  </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(cs k) ! 0 -ese&#8594; (cs k) ! 1&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">esetran_eqconf1</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;(cs k) ! 0&quot;</span><span class=""> </span><span class="string">&quot;(cs k) ! 1&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                  </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;c. (cs k) ! 0 -es-Cmd c&#9839;k&#8594; (cs k) ! 1&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">c</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;(cs k) ! 0 -es-Cmd c&#9839;k&#8594; (cs k) ! 1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cmd_enable_impl_anonyevt2</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;(cs k) ! 0&quot;</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="string">&quot;(cs k) ! 1&quot;</span><span class="delimiter">]</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">cmd_enable_impl_anonyevt2</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">is_anonyevt.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">              </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;n &#8800; 0&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;n &gt; 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172; (&#8707;e. (cs k) ! n -es-EvtEnt e&#9839;k&#8594; (cs k) ! Suc n)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(cs k) ! n -ese&#8594; (cs k) ! Suc n &#8744; (&#8707;c. (cs k) ! n -es-Cmd c&#9839;k&#8594; (cs k) ! Suc n)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">acts_in_conjoin_cpts</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">proof</span></span><span class="">
</span><span class="">                  </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(cs k) ! n -ese&#8594; (cs k) ! Suc n&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;e es. getspc_es ((cs k) ! n) = EvtSeq e es &#8743; is_anonyevt e&quot;</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">esetran_eqconf1</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;(cs k) ! n&quot;</span><span class=""> </span><span class="string">&quot;(cs k) ! Suc n&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i &lt; n. &#8707;e es. getspc_es ((cs k) ! i) = EvtSeq e es &#8743; is_anonyevt e&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">less_Suc_eq</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                  </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;c. (cs k) ! n -es-Cmd c&#9839;k&#8594; (cs k) ! Suc n&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;(cs k) ! n -es-Cmd c1&#9839;k&#8594; (cs k) ! Suc n&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;e e&#39; es1. getspc_es ((cs k) ! n) = EvtSeq e es1 &#8743; e = AnonyEvent e&#39;&quot;</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cmd_enable_impl_anonyevt2</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;((cs k) ! n)&quot;</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="string">&quot;(cs k) ! Suc n&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i &lt; n. &#8707;e es. getspc_es ((cs k) ! i) = EvtSeq e es &#8743; is_anonyevt e&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">is_anonyevt.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">less_Suc_eq</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">qed</span></span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">evtseq_noesys_allevtseq</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;esl&#8712;cpts_es; esl = (EvtSeq ev esys, s, x) # esl1; 
        (&#8704;i. Suc i &#8804; length esl &#10230; getspc_es (esl ! i) &#8800; esys)&#10215;
        &#10233; (&#8704;i &lt; length esl. &#8707;e&#39;. getspc_es (esl ! i) = EvtSeq e&#39; esys)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;cpts_es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl = (EvtSeq ev esys, s, x) # esl1&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &#8804; length esl &#10230; getspc_es (esl ! i) &#8800; esys&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i &lt; length esl&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;e&#39;. getspc_es (esl ! i) = EvtSeq e&#39; esys&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">i</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">0</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Suc</span><span class=""> </span><span class="">ii</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;ii &lt; length esl &#10233; &#8707;e&#39;. getspc_es (esl ! ii) = EvtSeq e&#39; esys&quot;</span><span class="">
</span><span class="">            </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc ii &lt; length esl&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">e&#39;</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;getspc_es (esl ! ii) = EvtSeq e&#39; esys&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (esl!Suc ii) = esys &#8744; (&#8707;e. getspc_es (esl!Suc ii) = EvtSeq e esys)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtseq_next_in_cpts</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">esl</span><span class=""> </span><span class="">e&#39;</span><span class=""> </span><span class="">esys</span><span class="delimiter">]</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">evtseq_noesys_allevtseq2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;esl&#8712;cpts_es; esl = (EvtSeq ev esys, s, x) # esl1; &#172; is_basicevt ev;
        (&#8704;i. Suc i &#8804; length esl &#10230; getspc_es (esl ! i) &#8800; esys)&#10215;
        &#10233; (&#8704;i &lt; length esl. &#8707;e&#39;. &#172; is_basicevt e&#39; &#8743; getspc_es (esl ! i) = EvtSeq e&#39; esys)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;cpts_es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl = (EvtSeq ev esys, s, x) # esl1&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172; is_basicevt ev&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &#8804; length esl &#10230; getspc_es (esl ! i) &#8800; esys&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i &lt; length esl&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;e&#39;. &#172; is_basicevt e&#39; &#8743; getspc_es (esl ! i) = EvtSeq e&#39; esys&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">i</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">0</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Suc</span><span class=""> </span><span class="">ii</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;ii &lt; length esl &#10233; &#8707;e&#39;. &#172; is_basicevt e&#39; &#8743; getspc_es (esl ! ii) = EvtSeq e&#39; esys&quot;</span><span class="">
</span><span class="">            </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc ii &lt; length esl&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;e&#39;. &#172; is_basicevt e&#39; &#8743; getspc_es (esl ! ii) = EvtSeq e&#39; esys&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">e&#39;</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172; is_basicevt e&#39; &#8743; getspc_es (esl ! ii) = EvtSeq e&#39; esys&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (esl!Suc ii) = esys &#8744; (&#8707;e. getspc_es (esl!Suc ii) = EvtSeq e esys)&quot;</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtseq_next_in_cpts</span><span class=""> </span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">esl</span><span class="delimiter">]</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;e. getspc_es (esl!Suc ii) = EvtSeq e esys&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">e</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">b4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl!Suc ii) = EvtSeq e esys&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172; is_basicevt e&quot;</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">              </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;is_basicevt e&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">be</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;e = BasicEvent be&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">event.exhaust</span><span class=""> </span><span class="">is_basicevt.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (esl ! ii) = EvtSeq (BasicEvent be) esys&quot;</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">only_envtran_to_basicevt</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">esl</span><span class=""> </span><span class="">esys</span><span class=""> </span><span class="">be</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;False&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">is_basicevt_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">evtseq_evtent_befaft</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;esl&#8712;cpts_es; esl = (EvtSeq ev esys, s, x) # esl1; 
        (&#8704;i. Suc i &#8804; length esl &#10230; getspc_es (esl ! i) &#8800; esys);
        (&#8707;e k. m &lt;length esl - 1 &#8743; esl ! m -es-EvtEnt e&#9839;k&#8594; esl ! Suc m)&#10215; &#10233; 
         is_basicevt ev &#8743; (&#8704;i. i &#8804; m &#10230; getspc_es (esl ! i) = EvtSeq ev esys) 
         &#8743; (&#8704;i. i &gt; m &#8743; i &lt; length esl &#10230; (&#8707;e&#39;. &#172; is_basicevt e&#39; &#8743; getspc_es (esl ! i) = EvtSeq e&#39; esys))&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;cpts_es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl = (EvtSeq ev esys, s, x) # esl1&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &#8804; length esl &#10230; getspc_es (esl ! i) &#8800; esys&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;e k. m &lt;length esl - 1 &#8743; esl ! m -es-EvtEnt e&#9839;k&#8594; esl ! Suc m&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i &lt; length esl. &#8707;e&#39;. getspc_es (esl ! i) = EvtSeq e&#39; esys&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtseq_noesys_allevtseq</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">esl</span><span class=""> </span><span class="">ev</span><span class=""> </span><span class="">esys</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">esl1</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">e</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m &lt;length esl - 1 &#8743; esl ! m -es-EvtEnt e&#9839;k&#8594; esl ! Suc m&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">e&#39;</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl ! m) = EvtSeq e&#39; esys&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">length_Cons</span><span class=""> </span><span class="">length_tl</span><span class=""> </span><span class="">less_SucI</span><span class=""> </span><span class="">list.sel</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;e = e&#39; &#8743; (&#8707;e&#39;&#39;. e&#39; = BasicEvent e&#39;&#39;)&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtent_is_basicevt_inevtseq2</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;esl ! m&quot;</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="string">&quot;esl ! Suc m&quot;</span><span class=""> </span><span class="">e&#39;</span><span class=""> </span><span class="">esys</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">be</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;e&#39; = BasicEvent be&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. i &#8804; m &#10230; getspc_es ((drop (m - i) esl) ! 0) = EvtSeq e esys&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i &#8804; m&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es ((drop (m - i) esl) ! 0) = EvtSeq e esys&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">i</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">0</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Suc</span><span class=""> </span><span class="">ii</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;ii &#8804; m &#10233; getspc_es (drop (m - ii) esl ! 0) = EvtSeq e esys&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc ii &#8804; m&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &lt; length esl &#8743;
                  (&#8707;e. getspc_es (esl ! i) = EvtSeq e esys) &#8743; getspc_es (esl ! Suc i) = EvtSeq (BasicEvent be) esys &#10230;
                  getspc_es (esl ! i) = EvtSeq (BasicEvent be) esys&quot;</span><span class=""> 
</span><span class="">               </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">only_envtran_to_basicevt</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">esl</span><span class=""> </span><span class="">esys</span><span class=""> </span><span class="">be</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c01</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8896;i. Suc i &lt; length esl &#8743;
                  (&#8707;e. getspc_es (esl ! i) = EvtSeq e esys) &#8743; getspc_es (esl ! Suc i) = EvtSeq (BasicEvent be) esys &#10230;
                  getspc_es (esl ! i) = EvtSeq (BasicEvent be) esys&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (drop (m - ii) esl ! 0) = EvtSeq e esys&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;drop (m - Suc ii) esl ! 0 = esl ! (m - Suc ii)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;drop (m - ii) esl ! 0 = esl ! (m - ii)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(&#8707;e. getspc_es (esl ! (m - Suc ii)) = EvtSeq e esys)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c01</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;(m - Suc ii)&quot;</span><span class="delimiter">]</span><span class="">
</span><span class="">              </span><span class="">Suc_diff_Suc</span><span class=""> </span><span class="">Suc_le_lessD</span><span class=""> </span><span class="">length_Cons</span><span class=""> </span><span class="">length_tl</span><span class=""> </span><span class="">less_SucI</span><span class=""> </span><span class="">less_imp_diff_less</span><span class=""> 
</span><span class="">              </span><span class="">list.sel</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (esl ! 0) = EvtSeq e esys&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a51</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;ev =  e&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">esys.inject</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">nth_Cons_0</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">r1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. i &#8804; m &#10230; getspc_es (esl ! i) = EvtSeq ev esys&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Cons_nth_drop_Suc</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">diff_diff_cancel</span><span class=""> </span><span class="">diff_le_self</span><span class=""> 
</span><span class="">        </span><span class="">le_less_trans</span><span class=""> </span><span class="">length_Cons</span><span class=""> </span><span class="">length_tl</span><span class=""> </span><span class="">less_SucI</span><span class=""> </span><span class="">list.sel</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">p1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    
</span><span class="">    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esl</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;drop (Suc m) esl&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl&#8712;cpts_es&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Suc_mono</span><span class=""> </span><span class="">cpts_es_dropi</span><span class=""> </span><span class="">length_Cons</span><span class=""> </span><span class="">length_tl</span><span class=""> </span><span class="">list.sel</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">esc1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">esc2</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">s2</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x2</span><span class=""> 
</span><span class="">      </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl ! m = (esc1,s1,x1) &#8743; esl ! Suc m = (esc2,s2,x2) &#8743; (esc1,s1,x1) -es-EvtEnt e&#9839;k&#8594; (esc2,s2,x2)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">prod_cases3</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a7</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;e. &#172; is_basicevt e &#8743; getspc_es (?esl!0) = EvtSeq e esys&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">is_basicevt_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">estran.cases</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">esys.simps</span><span class="delimiter">(</span><span class="">4</span><span class="delimiter">)</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">getspc_es_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">get_actk_def</span><span class=""> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Cons_nth_drop_Suc</span><span class=""> </span><span class="">Suc_mono</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">ent_spec2&#39;</span><span class=""> 
</span><span class="">        </span><span class="">esys.inject</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">event.simps</span><span class="delimiter">(</span><span class="">7</span><span class="delimiter">)</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">length_Cons</span><span class=""> </span><span class="">length_tl</span><span class=""> </span><span class="">list.sel</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">p1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_leI</span><span class=""> </span><span class="">Suc_le_mono</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">esys.inject</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">fst_conv</span><span class=""> 
</span><span class="">          </span><span class="">getspc_es_def</span><span class=""> </span><span class="">length_Cons</span><span class=""> </span><span class="">length_tl</span><span class=""> </span><span class="">list.sel</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">s3</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x3</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172; is_basicevt e1 &#8743; ?esl!0 = (EvtSeq e1 esys,s3,x3)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">surj_pair</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &#8804; length ?esl &#10230; getspc_es (?esl ! i) &#8800; esys&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">a6</span><span class=""> </span><span class="">a7</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i &lt; length ?esl. &#8707;e&#39;. &#172; is_basicevt e&#39; &#8743; getspc_es (?esl ! i) = EvtSeq e&#39; esys&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtseq_noesys_allevtseq2</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?esl</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">esys</span><span class=""> </span><span class="">s3</span><span class=""> </span><span class="">x3</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="">Cons_nth_drop_Suc</span><span class=""> </span><span class="">Suc_mono</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">length_Cons</span><span class=""> </span><span class="">length_tl</span><span class=""> </span><span class="">list.sel</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">p1</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. i &gt; m &#8743; i &lt; length esl &#10230; (&#8707;e&#39;. &#172; is_basicevt e&#39; &#8743; getspc_es (esl ! i) = EvtSeq e&#39; esys)&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i &gt; m &#8743; i &lt; length esl&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;esl ! i = ?esl ! (i - Suc m)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;i - Suc m &#8805; 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;i - Suc m &lt; length ?esl&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;e&#39;. &#172; is_basicevt e&#39; &#8743; getspc_es (?esl ! (i - Suc m)) = EvtSeq e&#39; esys&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a8</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="">a51</span><span class=""> </span><span class="">r1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">evtsys_allevtseqorevtsys</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;&#10214;esl&#8712;cpts_es; esl = (EvtSys es, s, x) # esl1&#10215;
        &#10233; (&#8704;i &lt; length esl. getspc_es (esl ! i) = EvtSys es 
                              &#8744; (&#8707;e&#39;. is_anonyevt e&#39; &#8743; getspc_es (esl ! i) = EvtSeq e&#39; (EvtSys es)))&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;cpts_es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl = (EvtSys es, s, x) # esl1&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i &lt; length esl&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (esl ! i) = EvtSys es &#8744; 
                (&#8707;e&#39;. is_anonyevt e&#39; &#8743; getspc_es (esl ! i) = EvtSeq e&#39; (EvtSys es))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">i</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">0</span><span class=""> </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Suc</span><span class=""> </span><span class="">ii</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;ii &lt; length esl &#10233; getspc_es (esl ! ii) = EvtSys es &#8744; 
            (&#8707;e&#39;. is_anonyevt e&#39; &#8743; getspc_es (esl ! ii) = EvtSeq e&#39; (EvtSys es))&quot;</span><span class="">
</span><span class="">            </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc ii &lt; length esl&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">esc1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl ! ii = (esc1,s1,x1)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">prod_cases3</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">  
</span><span class="">          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">esc2</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">s2</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl ! Suc ii = (esc2,s2,x2)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">prod_cases3</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">  
</span><span class="">          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(esc1,s1,x1) -ese&#8594; (esc2,s2,x2) &#8744; (&#8707;et. (esc1,s1,x1) -es-et&#8594; (esc2,s2,x2))&quot;</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">incpts_es_impl_evnorcomptran</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">esl</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (esl ! ii) = EvtSys es &#8744; 
            (&#8707;e&#39;. is_anonyevt e&#39; &#8743; getspc_es (esl ! ii) = EvtSeq e&#39; (EvtSys es))&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">proof</span></span><span class="">
</span><span class="">              </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl ! ii) = EvtSys es&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esc1 = EvtSys es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">fst_conv</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;esc2 = EvtSys es &#8744; (&#8707;e&#39;. is_anonyevt e&#39; &#8743; esc2 = EvtSeq e&#39; (EvtSys es))&quot;</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">proof</span></span><span class="">
</span><span class="">                  </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;(esc1,s1,x1) -ese&#8594; (esc2,s2,x2)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;esc1 = esc2&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">esetran_eqconf</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                  </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;&#8707;et. (esc1,s1,x1) -es-et&#8594; (esc2,s2,x2)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">et</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;(esc1,s1,x1) -es-et&#8594; (esc2,s2,x2)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;e&#39;. is_anonyevt e&#39; &#8743; esc2 = EvtSeq e&#39; (EvtSys es)&quot;</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">is_anonyevt_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">estran.cases</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">get_actk_def</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">etran.cases</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">              </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;e&#39;. is_anonyevt e&#39; &#8743; getspc_es (esl ! ii) = EvtSeq e&#39; (EvtSys es)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">e&#39;</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;is_anonyevt e&#39; &#8743; getspc_es (esl ! ii) = EvtSeq e&#39; (EvtSys es)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esc1 = EvtSeq e&#39; (EvtSys es)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">fst_conv</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;esc2 =EvtSys es &#8744; (&#8707;e&#39;. is_anonyevt e&#39; &#8743; esc2 = EvtSeq e&#39; (EvtSys es))&quot;</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">proof</span></span><span class="">
</span><span class="">                  </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class="string">&quot;(esc1,s1,x1) -ese&#8594; (esc2,s2,x2)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;esc1 = esc2&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">esetran_eqconf</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                  </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;&#8707;et. (esc1,s1,x1) -es-et&#8594; (esc2,s2,x2)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">et</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;(esc1,s1,x1) -es-et&#8594; (esc2,s2,x2)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">clarsimp</span><span class=""> </span><span class="">simp</span><span class="delimiter">:</span><span class="">is_anonyevt_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">estran.cases</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">get_actk_def</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">etran.cases</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">qed</span></span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">evtsys_befevtent_isevtsys</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;&#10214;esl&#8712;cpts_es; esl = (EvtSys es, s, x) # esl1&#10215;
        &#10233; &#8704;i. Suc i &lt; length esl &#8743; (&#8707;e k. esl ! i -es-EvtEnt e&#9839;k&#8594; esl ! Suc i) &#10230; getspc_es (esl!i) = EvtSys es&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl&#8712;cpts_es&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl = (EvtSys es, s, x) # esl1&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length esl&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8707;e k. esl ! i -es-EvtEnt e&#9839;k&#8594; esl ! Suc i)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a00</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl ! i) = EvtSys es &#8744; (&#8707;e&#39;. is_anonyevt e&#39; &#8743; getspc_es (esl ! i) = EvtSeq e&#39; (EvtSys es))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsys_allevtseqorevtsys</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">esl</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">esl1</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">esc1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl ! i = (esc1,s1,x1)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">prod_cases3</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">  
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">esc2</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">s2</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl ! Suc i = (esc2,s2,x2)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">prod_cases3</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">e</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(esc1,s1,x1)-es-EvtEnt e&#9839;k&#8594;(esc2,s2,x2)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a00</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esc1 = EvtSys es &#8744; (&#8707;e&#39;. is_anonyevt e&#39; &#8743; esc1 = EvtSeq e&#39; (EvtSys es))&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">fst_conv</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172;(&#8707;e&#39;. is_anonyevt e&#39; &#8743; esc1 = EvtSeq e&#39; (EvtSys es))&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">get_actk_def</span><span class=""> </span><span class="">is_anonyevt_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">estran.cases</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="delimiter">+</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">etran.cases</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">get_actk_def</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">etran.cases</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">get_actk_def</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;esc1 = EvtSys es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (esl!i) = EvtSys es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">fst_conv</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">allentev_isin_basicevts</span><span class="delimiter">:</span><span class="">
</span><span class="">    </span><span class="string">&quot;&#8704;esl esc s x esl1 e k. esl&#8712;cpts_es &#8743; esl = (esc,s,x)#esl1 &#10230;
          (&#8704;m&lt;length esl - 1. (esl ! m -es-EvtEnt e&#9839;k&#8594; esl ! Suc m) &#10230; e&#8712;all_basicevts_es esc)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">esc</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;esl s x esl1 e k. esl&#8712;cpts_es &#8743; esl = (esc,s,x)#esl1 &#10230;
          (&#8704;m&lt;length esl - 1. (esl ! m -es-EvtEnt e&#9839;k&#8594; esl ! Suc m) &#10230; e&#8712;all_basicevts_es esc)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">esc</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">EvtSeq</span><span class=""> </span><span class="">ev</span><span class=""> </span><span class="">esys</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;esl s x esl1 e k.
                     esl &#8712; cpts_es &#8743; esl = (esys, s, x) # esl1 &#10230;
                     (&#8704;i&lt;length esl - 1. (esl ! i -es-EvtEnt e&#9839;k&#8594; esl ! Suc i) &#10230; e &#8712; all_basicevts_es esys)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8896;esl s x esl1 e k.
                     esl &#8712; cpts_es &#8743; esl = (esys, s, x) # esl1 &#10233;
                     (&#8704;i&lt;length esl - 1. (esl ! i -es-EvtEnt e&#9839;k&#8594; esl ! Suc i) &#10230; e &#8712; all_basicevts_es esys)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">esl</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">esl1</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">k</span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl &#8712; cpts_es &#8743; esl = (EvtSeq ev esys, s, x) # esl1&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">m</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m&lt;length esl - 1&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl ! m -es-EvtEnt e&#9839;k&#8594; esl ! Suc m&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;e &#8712; all_basicevts_es (EvtSeq ev esys)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &#8804; length esl &#10230; getspc_es (esl ! i) &#8800; esys&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &#8804; length esl &#10230; getspc_es (esl ! i) &#8800; esys&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;is_basicevt ev &#8743; (&#8704;i. i &#8804; m &#10230; getspc_es (esl ! i) = EvtSeq ev esys)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtseq_evtent_befaft</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">esl</span><span class=""> </span><span class="">ev</span><span class=""> </span><span class="">esys</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">esl1</span><span class=""> </span><span class="">m</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (esl ! m) = EvtSeq ev esys&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;e = ev&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtent_is_basicevt_inevtseq2</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">all_basicevts_es.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">insertI1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(&#8704;i. Suc i &#8804; length esl &#10230; getspc_es (esl ! i) &#8800; esys)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;m. Suc m &#8804; length esl &#8743; getspc_es (esl ! m) = esys&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">m1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc m1 &#8804; length esl &#8743; getspc_es (esl ! m1) = esys&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;i. i &#8804; m1 &#8743; getspc_es (esl ! i) = esys&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;i. (i &#8804; m1 &#8743; getspc_es (esl ! i) = esys) 
                                    &#8743; (&#8704;j. j &lt; i &#10230; getspc_es (esl ! j) &#8800; esys)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtseq_fst_finish</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">esl</span><span class=""> </span><span class="">ev</span><span class=""> </span><span class="">esys</span><span class=""> </span><span class="">m1</span><span class="delimiter">]</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">nth_Cons&#39;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">n</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">d3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(n &#8804; m1 &#8743; getspc_es (esl ! n) = esys) 
                                          &#8743; (&#8704;j. j &lt; n &#10230; getspc_es (esl ! j) &#8800; esys)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">d3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;n &#8800; 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Groups.add_ac</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="">Suc_n_not_le_n</span><span class=""> </span><span class="">add.right_neutral</span><span class=""> </span><span class="">add_Suc_right</span><span class=""> </span><span class="">esys.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">fst_conv</span><span class=""> 
</span><span class="">                    </span><span class="">getspc_es_def</span><span class=""> </span><span class="">le_add1</span><span class=""> </span><span class="">nth_Cons&#39;</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d4</span><span class="delimiter">:</span><span class="string">&quot;n &gt; 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                
</span><span class="">                </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;m &lt; n&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m &lt; n&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esl0</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;take n esl&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">d3</span><span class=""> </span><span class="">d4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl0 &#8712; cpts_es&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_le_lessD</span><span class=""> </span><span class="">Suc_pred&#39;</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">cpts_es_take</span><span class=""> </span><span class="">less_trans</span><span class="delimiter">)</span><span class="">
</span><span class="">                    
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">d3</span><span class=""> </span><span class="">d4</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">esl2</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">e2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl0 = (EvtSeq ev esys, s, x) # esl2&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">take_Cons&#39;</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                     
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">d3</span><span class=""> </span><span class="">d4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &#8804; length ?esl0 &#10230; getspc_es (?esl0 ! i) &#8800; esys&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">drop_take</span><span class=""> </span><span class="">leD</span><span class=""> </span><span class="">le_less_linear</span><span class=""> </span><span class="">not_less_eq</span><span class="delimiter">)</span><span class="">
</span><span class="">                    
</span><span class="">                    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc m &#8800; n&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">                        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">f0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc m = n&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">d3</span><span class=""> </span><span class="">d4</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;m &lt; length ?esl0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">d3</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">e2</span><span class=""> </span><span class="">e3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;e&#39;. getspc_es (?esl0 ! m) = EvtSeq e&#39; esys&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtseq_noesys_allevtseq</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?esl0</span><span class=""> </span><span class="">ev</span><span class=""> </span><span class="">esys</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">esl2</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">e&#39;</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;getspc_es (?esl0 ! m) = EvtSeq e&#39; esys&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">s&#39;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x&#39;</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">f1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl0 ! m = (EvtSeq e&#39; esys, s&#39;,x&#39;)&quot;</span><span class=""> 
</span><span class="">                          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">surj_pair</span><span class="delimiter">)</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d3</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">s&#39;&#39;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x&#39;&#39;</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">f2</span><span class="delimiter">:</span><span class="string">&quot;esl ! n = (esys,s&#39;&#39;,x&#39;&#39;)&quot;</span><span class=""> 
</span><span class="">                          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">surj_pair</span><span class="delimiter">)</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">d3</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?esl0 ! m = esl ! m&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f4</span><span class="delimiter">:</span><span class="string">&quot;?esl0 ! m -es-EvtEnt e&#9839;k&#8594; esl ! Suc m&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f3</span><span class="delimiter">:</span><span class="string">&quot;(EvtSeq e&#39; esys, s&#39;,x&#39;)-es-EvtEnt e&#9839;k&#8594;(esys,s&#39;&#39;,x&#39;&#39;)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">f0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">False</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">estran.cases</span><span class="delimiter">)</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">get_actk_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">etran.cases</span><span class="delimiter">)</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">get_actk_def</span><span class="delimiter">)</span><span class="delimiter">+</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">f3</span><span class=""> </span><span class="">ent_spec2&#39;</span><span class=""> </span><span class="">event.inject</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">evtseq_tran_0_exist_etran</span><span class=""> 
</span><span class="">                            </span><span class="">noevtent_notran</span><span class=""> </span><span class="">option.distinct</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">f2</span><span class=""> </span><span class="">f4</span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="">ent_spec2&#39;</span><span class=""> </span><span class="">event.inject</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">evtent_is_basicevt_inevtseq</span><span class=""> </span><span class="">f0</span><span class=""> </span><span class="">option.simps</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">}</span></span><span class=""> </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">   
</span><span class="">                      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                    
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">d3</span><span class=""> </span><span class="">d4</span><span class=""> </span><span class="">e4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl0 ! m -es-EvtEnt e&#9839;k&#8594; ?esl0 ! Suc m&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Suc_lessI</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">d3</span><span class=""> </span><span class="">d4</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">e4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;m &lt; length ?esl0 - 1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">e2</span><span class=""> </span><span class="">e3</span><span class=""> </span><span class="">e4</span><span class=""> </span><span class="">e5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;is_basicevt ev &#8743; (&#8704;i. i &#8804; m &#10230; getspc_es (esl ! i) = EvtSeq ev esys)&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtseq_evtent_befaft</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?esl0</span><span class=""> </span><span class="">ev</span><span class=""> </span><span class="">esys</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">esl2</span><span class=""> </span><span class="">m</span><span class="delimiter">]</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">diff_diff_cancel</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">less_imp_diff_less</span><span class=""> </span><span class="">nth_take</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (esl ! m) = EvtSeq ev esys&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;e = ev&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtent_is_basicevt_inevtseq2</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">all_basicevts_es.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">insertI1</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;&#172;m &lt; n&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m &#8805; n&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esl0</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;drop n esl&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?esl0 &#8712; cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">cpts_es_dropi2</span><span class=""> </span><span class="">length_Cons</span><span class=""> 
</span><span class="">                      </span><span class="">length_tl</span><span class=""> </span><span class="">less_SucI</span><span class=""> </span><span class="">list.sel</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">d3</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">s&#39;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x&#39;</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">esl1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;?esl0 = (esys,s&#39;,x&#39;)#esl1&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">hide_lams</span><span class="delimiter">)</span><span class=""> </span><span class="">Cons_nth_drop_Suc</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> 
</span><span class="">                        </span><span class="">less_le_trans</span><span class=""> </span><span class="">not_less_eq</span><span class=""> </span><span class="">old.prod.exhaust</span><span class=""> </span><span class="">prod.sel</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">d3</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;m - n &lt;length ?esl0 - 1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">d3</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;esl ! m = ?esl0 ! (m - n)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">d3</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;esl ! Suc m = ?esl0 ! Suc (m - n)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;e &#8712; all_basicevts_es esys&quot;</span><span class=""> 
</span><span class="">                      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">d3</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">a1</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?esl0</span><span class=""> </span><span class="">s&#39;</span><span class=""> </span><span class="">x&#39;</span><span class=""> </span><span class="">esl1</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">k</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">all_basicevts_es.simps</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">EvtSys</span><span class=""> </span><span class="">es</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">esl</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">esl1</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">k</span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl &#8712; cpts_es &#8743; esl = (EvtSys es, s, x) # esl1&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">m</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m&lt;length esl - 1&quot;</span><span class="">
</span><span class="">              </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl ! m -es-EvtEnt e&#9839;k&#8594; esl ! Suc m&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c00</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (esl!m) = EvtSys es&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsys_befevtent_isevtsys</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">esl</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">esl1</span><span class="delimiter">]</span><span class=""> 
</span><span class="">              </span><span class="">Suc_mono</span><span class=""> </span><span class="">length_Cons</span><span class=""> </span><span class="">length_tl</span><span class=""> </span><span class="">list.sel</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">esc1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl ! m = (esc1,s1,x1)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">prod_cases3</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">  
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">esc2</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">s2</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;esl ! Suc m = (esc2,s2,x2)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">prod_cases3</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(esc1,s1,x1)-es-EvtEnt e&#9839;k&#8594;(esc2,s2,x2)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c00</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;i&#8712;es. i = e&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsysent_evtent2</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">esc2</span><span class=""> </span><span class="">s2</span><span class=""> </span><span class="">x2</span><span class="delimiter">]</span><span class=""> </span><span class="">getspc_es_def</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">fst_conv</span><span class="delimiter">)</span><span class="">  
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;is_basicevt e&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtent_is_basicevt</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">esc1</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">esc2</span><span class=""> </span><span class="">s2</span><span class=""> </span><span class="">x2</span><span class="delimiter">]</span><span class=""> </span><span class="">is_basicevt.simps</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;e &#8712; all_basicevts_es (EvtSys es)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="string">&quot;all_basicevts_es.simps&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">cmd_impl_evtent_before</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#10214;c &#8733; cs; cs k&#8712;cpts_of_es esc s x; &#8704;ef&#8712;all_evts_esspec esc. is_basicevt ef&#10215;
    &#10233; &#8704;i. Suc i &lt; length (cs k) &#10230; (&#8707;cmd. (cs k)!i -es-((Cmd cmd)&#9839;k)&#8594; (cs k)!(Suc i)) 
            &#10230; (&#8707;m. m &lt; i &#8743; (&#8707;e. (cs k)!m -es-(EvtEnt e&#9839;k)&#8594; (cs k)!(Suc m)))&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8733; cs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;cs k&#8712;cpts_of_es esc s x&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;all_evts_esspec esc. is_basicevt ef&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esl</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;cs k&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p01</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl &#8712; cpts_es &#8743; ?esl ! 0 = (esc,s,x)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length ?esl&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;cmd. ?esl!i -es-((Cmd cmd)&#9839;k)&#8594; ?esl!(Suc i)&quot;</span><span class="">
</span><span class="">      
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">cmd</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl!i -es-((Cmd cmd)&#9839;k)&#8594; ?esl!(Suc i)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">esc1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">esc2</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">s2</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x2</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class="">
</span><span class="">        </span><span class="string">&quot;?esl!i = (esc1,s1,x1) &#8743; ?esl!Suc i = (esc2,s2,x2)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">prod_cases3</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;e&#39; es. esc1 = EvtSeq e&#39; es &#8743; is_anonyevt e&#39;&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cmd_enable_impl_anonyevt</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">esc1</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">cmd</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">esc2</span><span class=""> </span><span class="">s2</span><span class=""> </span><span class="">x2</span><span class="delimiter">]</span><span class=""> </span><span class="">is_anonyevt.simps</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p01</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i &#8800; 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">all_evts_esspec.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">anonyevt_isnot_basic</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">insertI1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;m. m &lt; i &#8743; (&#8707;e. ?esl!m -es-(EvtEnt e&#9839;k)&#8594; ?esl!(Suc m))&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">proof</span></span><span class="">-</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(&#8707;m. m &lt; i &#8743; (&#8707;e. ?esl!m -es-(EvtEnt e&#9839;k)&#8594; ?esl!(Suc m)))&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;j. j &lt; i &#10230; &#172;(&#8707;e. ?esl!j -es-(EvtEnt e&#9839;k)&#8594; ?esl!(Suc j))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p01</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;j &lt; i. &#8707;e es. getspc_es (?esl!j) = EvtSeq e es &#8743; is_anonyevt e&quot;</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">anonyevtseq_and_noet_impl_allanonyevtseq_bef3</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">cs</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">i</span><span class="delimiter">]</span><span class=""> </span><span class="">getspc_es_def</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">fst_conv</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;e es. getspc_es (?esl!0) = EvtSeq e es &#8743; is_anonyevt e&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p01</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">False</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">all_evts_esspec.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">anonyevt_isnot_basic</span><span class=""> 
</span><span class="">              </span><span class="">getspc_es_def</span><span class=""> </span><span class="">insertI1</span><span class=""> </span><span class="">prod.sel</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">cmd_impl_evtent_before_and_cmds</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#10214;c &#8733; cs; cs k&#8712;cpts_of_es esc s x; &#8704;ef&#8712;all_evts_esspec esc. is_basicevt ef&#10215;
    &#10233; &#8704;i. Suc i &lt; length (cs k) &#10230; (&#8707;cmd. (cs k)!i -es-((Cmd cmd)&#9839;k)&#8594; (cs k)!(Suc i)) 
            &#10230; (&#8707;m. m &lt; i &#8743; (&#8707;e. (cs k)!m -es-(EvtEnt e&#9839;k)&#8594; (cs k)!(Suc m))
                      &#8743; (&#8704;j. j &gt; m &#8743; j &lt; i &#10230; &#172;(&#8707;e. (cs k)!j -es-(EvtEnt e&#9839;k)&#8594; (cs k)!(Suc j))))&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8733; cs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;cs k&#8712;cpts_of_es esc s x&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;all_evts_esspec esc. is_basicevt ef&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esl</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;cs k&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p01</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl &#8712; cpts_es &#8743; ?esl ! 0 = (esc,s,x)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length ?esl&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;cmd. ?esl!i -es-((Cmd cmd)&#9839;k)&#8594; ?esl!(Suc i)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;m. m &lt; i &#8743; (&#8707;e. ?esl!m -es-(EvtEnt e&#9839;k)&#8594; ?esl!(Suc m))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cmd_impl_evtent_before</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">cs</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">esc</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">m</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m &lt; i &#8743; (&#8707;e. ?esl!m -es-(EvtEnt e&#9839;k)&#8594; ?esl!(Suc m))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;m. m &lt; i &#8743; (&#8707;e. ?esl!m -es-(EvtEnt e&#9839;k)&#8594; ?esl!(Suc m))
                    &#8743; (&#8704;j. j &gt; m &#8743; j &lt; i &#10230; &#172;(&#8707;e. ?esl!j -es-(EvtEnt e&#9839;k)&#8594; ?esl!(Suc j)))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">induct</span><span class=""> </span><span class="">i</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="">0</span><span class=""> </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">case</span></span><span class=""> </span><span class="delimiter">(</span><span class="">Suc</span><span class=""> </span><span class="">ii</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc ii &lt; length ?esl &#10233;
                      m &lt; ii &#8743; (&#8707;e. ?esl ! m -es-EvtEnt e&#9839;k&#8594; ?esl ! Suc m) &#10233;
                      &#8707;m&lt;ii. (&#8707;e. ?esl ! m -es-EvtEnt e&#9839;k&#8594; ?esl ! Suc m) &#8743;
                             (&#8704;j. m &lt; j &#8743; j &lt; ii &#10230; &#172; (&#8707;e. ?esl ! j -es-EvtEnt e&#9839;k&#8594; ?esl ! Suc j))&quot;</span><span class="">
</span><span class="">            </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc (Suc ii) &lt; length ?esl&quot;</span><span class="">
</span><span class="">            </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m &lt; Suc ii &#8743; (&#8707;e. ?esl ! m -es-EvtEnt e&#9839;k&#8594; ?esl ! Suc m)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;m = ii&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m = ii&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">not_less_eq</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">              </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;m &#8800; ii&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m &lt; ii&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;m&lt;ii. (&#8707;e. ?esl ! m -es-EvtEnt e&#9839;k&#8594; ?esl ! Suc m) &#8743;
                             (&#8704;j. m &lt; j &#8743; j &lt; ii &#10230; &#172; (&#8707;e. ?esl ! j -es-EvtEnt e&#9839;k&#8594; ?esl ! Suc j))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">m1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m1&lt;ii &#8743; (&#8707;e. ?esl ! m1 -es-EvtEnt e&#9839;k&#8594; ?esl ! Suc m1) &#8743;
                             (&#8704;j. m1 &lt; j &#8743; j &lt; ii &#10230; &#172; (&#8707;e. ?esl ! j -es-EvtEnt e&#9839;k&#8594; ?esl ! Suc j))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?case</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;&#8707;e. ?esl ! ii -es-EvtEnt e&#9839;k&#8594; ?esl ! Suc ii&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;e. ?esl ! ii -es-EvtEnt e&#9839;k&#8594; ?esl ! Suc ii&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">lessI</span><span class=""> </span><span class="">not_less_eq</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                  </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172; (&#8707;e. ?esl ! ii -es-EvtEnt e&#9839;k&#8594; ?esl ! Suc ii)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">less_Suc_eq</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">cur_evt_in_cpts_es</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#10214;c&#8712;cpts_of_pes (paresys_spec pesrgf) s x; c &#8733; cs; 
    (&#8704;k. (cs k) &#8712; cpts_of_es (evtsys_spec (fst (pesrgf k))) s x); 
    &#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. c!j-pes-actk&#8594;c!Suc j); 
    &#8704;ef&#8712;all_evts pesrgf. is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> ef)&#10215;
      &#10233; &#8704;k i. Suc i &lt; length (cs k) &#10230; (&#8707;cmd. (cs k)!i -es-((Cmd cmd)&#9839;k)&#8594; (cs k)!(Suc i)) 
                &#10230; (&#8707;ef&#8712;all_evts_es (fst (pesrgf k)). getx_es ((cs k)!i) k = E<span class="hidden">&#8681;</span><sub>e</sub> ef)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c&#8712;cpts_of_pes (paresys_spec pesrgf) s x&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8733; cs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;k. (cs k) &#8712; cpts_of_es (evtsys_spec (fst (pesrgf k))) s x)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. c!j-pes-actk&#8594;c!Suc j)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;all_evts pesrgf. is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> ef)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length (cs k)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;cmd. (cs k)!i -es-((Cmd cmd)&#9839;k)&#8594; (cs k)!(Suc i)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;all_evts_esspec (evtsys_spec (fst (pesrgf k))). is_basicevt ef&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">allevts_es_blto_allevts</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">pesrgf</span><span class="delimiter">]</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">hide_lams</span><span class="delimiter">)</span><span class=""> </span><span class="">DomainE</span><span class=""> </span><span class="">E<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span class=""> </span><span class="">prod.sel</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">subsetCE</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;cs k &#8712; cpts_of_es (evtsys_spec (fst (pesrgf k))) s x&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(&#8707;m. m &lt; i &#8743; (&#8707;e. cs k!m -es-(EvtEnt e&#9839;k)&#8594; cs k!(Suc m))
                    &#8743; (&#8704;j. j &gt; m &#8743; j &lt; i &#10230; &#172;(&#8707;e. cs k!j -es-(EvtEnt e&#9839;k)&#8594; cs k!(Suc j))))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cmd_impl_evtent_before_and_cmds</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">cs</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="string">&quot;evtsys_spec (fst (pesrgf k))&quot;</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">m</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">e</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m &lt; i &#8743; (cs k!m -es-(EvtEnt e&#9839;k)&#8594; cs k!(Suc m))
                    &#8743; (&#8704;j. j &gt; m &#8743; j &lt; i &#10230; &#172;(&#8707;e. cs k!j -es-(EvtEnt e&#9839;k)&#8594; cs k!(Suc j)))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;j. j &gt; m &#8743; j &#8804; i &#10230; getx_es ((cs k)!j) k = e&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtent_impl_curevt_in_cpts_es</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">cs</span><span class=""> </span><span class="">m</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">i</span><span class="delimiter">]</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">Suc_lessI</span><span class=""> </span><span class="">entevt_ines_chg_selfx2</span><span class=""> </span><span class="">less_trans_Suc</span><span class=""> </span><span class="">not_less</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getx_es ((cs k)!i) k = e&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;cs k &#8712; cpts_es &#8743; (&#8707;esl1. cs k = (evtsys_spec (fst (pesrgf k)), s, x)#esl1)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_of_es_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">hd_Cons_tl</span><span class=""> </span><span class="">list.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> </span><span class="">not_less0</span><span class=""> </span><span class="">nth_Cons_0</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;e&#8712;all_basicevts_es (evtsys_spec (fst (pesrgf k)))&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">allentev_isin_basicevts</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Suc_lessE</span><span class=""> </span><span class="">diff_Suc_1</span><span class=""> </span><span class="">le_less_trans</span><span class=""> </span><span class="">less_imp_le_nat</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;ef&#8712;all_evts_es (fst (pesrgf k)). getx_es ((cs k)!i) k = E<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">allbasicevts_es_blto_allevts</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;evtsys_spec (fst (pesrgf k))&quot;</span><span class="delimiter">]</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">hide_lams</span><span class="delimiter">)</span><span class=""> </span><span class="">DomainE</span><span class=""> </span><span class="">E<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span class=""> </span><span class="">all_evts_same</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">set_mp</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">cur_evt_in_specevts</span><span class="delimiter">:</span><span class=""> 
</span><span class="">    </span><span class="string">&quot;&#10214;pesl&#8712;cpts_of_pes (paresys_spec pesf) s x; 
      &#8704;j. Suc j &lt; length pesl &#10230; (&#8707;actk. pesl!j-pes-actk&#8594;pesl!Suc j);
      &#8704;ef&#8712;all_evts pesf. is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> ef)&#10215; &#10233;
        (&#8704;k i. Suc i &lt; length pesl &#10230; (&#8707;c. (pesl!i -pes-((Cmd c)&#9839;k)&#8594; pesl!(Suc i)))
            &#10230; (&#8707;ef&#8712;all_evts pesf. getx (pesl!i) k = E<span class="hidden">&#8681;</span><sub>e</sub> ef) )&quot;</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;pesl&#8712;cpts_of_pes (paresys_spec pesf) s x&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;j. Suc j &lt; length pesl &#10230; (&#8707;actk. pesl!j-pes-actk&#8594;pesl!Suc j)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;all_evts pesf. is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> ef)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;cs. (&#8704;k. (cs k) &#8712; cpts_of_es ((paresys_spec pesf) k) s x) &#8743; pesl &#8733; cs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">par_evtsys_semantics_comp</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;paresys_spec pesf&quot;</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">cs</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;k. (cs k) &#8712; cpts_of_es ((paresys_spec pesf) k) s x) &#8743; pesl &#8733; cs&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. length pesl = length (cs k)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class=""> </span><span class="">same_length_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k j. j &lt; length pesl &#10230; getx (pesl!j) = getx_es ((cs k)!j)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class=""> </span><span class="">same_state_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length pesl&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;c. (pesl!i -pes-((Cmd c)&#9839;k)&#8594; pesl!(Suc i))&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">c</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;pesl!i -pes-((Cmd c)&#9839;k)&#8594; pesl!(Suc i)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;compat_tran pesl cs&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;t k. (pesl!i -pes-(t&#9839;k)&#8594; pesl!Suc i) &#8743;
                          (&#8704;k t. (pesl!i -pes-(t&#9839;k)&#8594; pesl!Suc i) &#10230; (cs k!i -es-(t&#9839;k)&#8594; cs k! Suc i) &#8743;
                                  (&#8704;k&#39;. k&#39; &#8800; k &#10230; (cs k&#39;!i -ese&#8594; cs k&#39;! Suc i)))
                          &#8744;
                          (((pesl!i) -pese&#8594; (pesl!Suc i)) &#8743; (&#8704;k. (((cs k)!i) -ese&#8594; ((cs k)! Suc i))))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">compat_tran_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">pesl</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;t k1. k1 = k &#8743; t = Cmd c &#8743; pesl ! i -pes-t&#9839;k&#8594; pesl ! Suc i&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172;(pesl ! i -pese&#8594; pesl ! Suc i)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">pes_tran_not_etran1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;t k. (pesl!i -pes-(t&#9839;k)&#8594; pesl!Suc i) &#8743;
                          (&#8704;k t. (pesl!i -pes-(t&#9839;k)&#8594; pesl!Suc i) &#10230; (cs k!i -es-(t&#9839;k)&#8594; cs k! Suc i) &#8743;
                                  (&#8704;k&#39;. k&#39; &#8800; k &#10230; (cs k&#39;!i -ese&#8594; cs k&#39;! Suc i)))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">t</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">k1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">b5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(pesl!i -pes-(t&#9839;k1)&#8594; pesl!Suc i) &#8743;
                          (&#8704;k t. (pesl!i -pes-(t&#9839;k)&#8594; pesl!Suc i) &#10230; (cs k!i -es-(t&#9839;k)&#8594; cs k! Suc i) &#8743;
                                  (&#8704;k&#39;. k&#39; &#8800; k &#10230; (cs k&#39;!i -ese&#8594; cs k&#39;! Suc i)))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;cs k ! i -es-((Cmd c)&#9839;k)&#8594; cs k!(Suc i)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">b5</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;ef&#8712;all_evts_es (fst (pesf k)). getx_es ((cs k)!i) k = E<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cur_evt_in_cpts_es</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">pesl</span><span class=""> </span><span class="">pesf</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">paresys_spec_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">ef</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;ef&#8712;all_evts_es (fst (pesf k)) &#8743; getx_es ((cs k)!i) k = E<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;all_evts_es (fst (pesf k)) &#8838; all_evts pesf&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">all_evts_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getx_es ((cs k)!i) k = getx (pesl!i) k&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;ef&#8712;all_evts pesf. getx (pesl!i) k = E<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">drop_take_ln</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;l1 = drop i (take j l); length l1 &gt; n&#10215; &#10233; j &gt; i + n&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">add.commute</span><span class=""> </span><span class="">add_lessD1</span><span class=""> </span><span class="">leI</span><span class=""> </span><span class="">length_drop</span><span class=""> </span><span class="">length_take</span><span class=""> </span><span class="">less_diff_conv</span><span class=""> 
</span><span class="">    </span><span class="">less_imp_add_positive</span><span class=""> </span><span class="">min.absorb2</span><span class=""> </span><span class="">nat_le_linear</span><span class=""> </span><span class="">take_all</span><span class="delimiter">)</span><span class=""> 
</span><span class="">   
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">drop_take_eq</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;l1 = drop i (take j l); j &#8804; length l; length l1 = n; n &gt; 0&#10215; &#10233; j = i + n&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class=""> 
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">drop_take_sametrace</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#10214;l1 = drop i (take j l)&#10215; &#10233; &#8704;m &lt; length l1. l1 ! m = l ! (i + m)&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">less_imp_le_nat</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">act_cpts_evtsys_sat_guar_curevt_gen0_new2</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">  </span><span class="string">&quot;&#10214;&#8866; (esspc::(&#39;l,&#39;k,&#39;s) rgformula_ess) sat<span class="hidden">&#8681;</span><sub>s</sub> [pre, rely, guar, post]&#10215;
      &#10233; &#8704;c pes s x cs pre1 rely1 Pre Rely Guar Post k cmd. 
            Pre k &#8838; pre &#8743; Rely k &#8838; rely &#8743; guar &#8838; Guar k &#8743; post &#8838; Post k &#10230;
            c&#8712;cpts_of_pes pes s x &#8743; c &#8733; cs &#8743; c&#8712;assume_pes(pre1, rely1) &#10230;
           (&#8704;k. (cs k) &#8712; cpts_of_es (pes k) s x)  &#10230; 
           (&#8704;k. (cs k)&#8712;commit_es(Guar k, Post k)) &#10230;
           (&#8704;k. pre1 &#8838; Pre k) &#10230;
           (&#8704;k. rely1 &#8838; Rely k) &#10230;
           (&#8704;k j. j &#8800; k &#10230; Guar j &#8838; Rely k) &#10230;
           evtsys_spec esspc = EvtSys es &#8743;  EvtSys es = getspc_es (cs k!0) &#10230;
           (&#8704;e&#8712;all_evts_es esspc. is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> e)) &#10230;
           (&#8704;e&#8712;all_evts_es esspc. the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> e)) = snd e) &#10230;
           (&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. c!j-pes-actk&#8594;c!Suc j)) &#10230;
          (&#8704;i. Suc i &lt; length (cs k) &#8743; ((cs k)!i -es-((Cmd cmd)&#9839;k)&#8594; (cs k)!(Suc i)) 
                &#10230; (gets_es ((cs k)!i), gets_es ((cs k)!(Suc i)))&#8712;Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es ((cs k)!i) k))))&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">rghoare_es.induct</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">esspc</span><span class=""> </span><span class="">pre</span><span class=""> </span><span class="">rely</span><span class=""> </span><span class="">guar</span><span class=""> </span><span class="">post</span><span class="delimiter">]</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">esf</span><span class=""> </span><span class="">prea</span><span class=""> </span><span class="">relya</span><span class=""> </span><span class="">guara</span><span class=""> </span><span class="">posta</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot; &#8866; (esspc::(&#39;l,&#39;k,&#39;s) rgformula_ess) sat<span class="hidden">&#8681;</span><sub>s</sub> [pre, rely, guar, post]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;(esf::(&#39;l,&#39;k,&#39;s) rgformula_e set). &#8866; E<span class="hidden">&#8681;</span><sub>e</sub> ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre<span class="hidden">&#8681;</span><sub>e</sub> ef, Rely<span class="hidden">&#8681;</span><sub>e</sub> ef, Guar<span class="hidden">&#8681;</span><sub>e</sub> ef, Post<span class="hidden">&#8681;</span><sub>e</sub> ef]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;esf. prea &#8838; Pre<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;esf. relya &#8838; Rely<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;esf. Guar<span class="hidden">&#8681;</span><sub>e</sub> ef &#8838; guara&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;esf. Post<span class="hidden">&#8681;</span><sub>e</sub> ef &#8838; posta&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b10</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef1 ef2. ef1 &#8712; esf &#8743; ef2 &#8712; esf &#10230; Post<span class="hidden">&#8681;</span><sub>e</sub> ef1 &#8838; Pre<span class="hidden">&#8681;</span><sub>e</sub> ef2&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b11</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;stable prea relya&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b12</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;s. (s, s) &#8712; guara&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">pes</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">cs</span><span class=""> </span><span class="">pre1</span><span class=""> </span><span class="">rely1</span><span class=""> </span><span class="">Pre</span><span class=""> </span><span class="">Rely</span><span class=""> </span><span class="">Guar</span><span class=""> </span><span class="">Post</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">cmd</span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Pre k &#8838; prea&quot;</span><span class="">
</span><span class="">         </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Rely k &#8838; relya&quot;</span><span class="">
</span><span class="">         </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;guara &#8838; Guar k&quot;</span><span class="">
</span><span class="">         </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">b4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;posta &#8838; Post k&quot;</span><span class="">
</span><span class="">         </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8712; cpts_of_pes pes s x&quot;</span><span class="">
</span><span class="">         </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8733; cs&quot;</span><span class="">
</span><span class="">         </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">p8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8712; assume_pes (pre1, rely1)&quot;</span><span class="">
</span><span class="">         </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;k. cs k &#8712; cpts_of_es (pes k) s x)&quot;</span><span class="">
</span><span class="">         </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. (cs k)&#8712;commit_es(Guar k, Post k)&quot;</span><span class="">
</span><span class="">         </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">a5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;k. pre1 &#8838; Pre k)&quot;</span><span class="">
</span><span class="">         </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">a6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;k. rely1 &#8838; Rely k)&quot;</span><span class="">
</span><span class="">         </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;k j. j &#8800; k &#10230; Guar j &#8838; Rely k)&quot;</span><span class="">
</span><span class="">         </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;evtsys_spec (rgf_EvtSys esf) = EvtSys es &#8743; EvtSys es = getspc_es (cs k ! 0) 
                  &#8743; (&#8704;e&#8712;all_evts_es (rgf_EvtSys esf). is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> e))
                  &#8743; (&#8704;e&#8712;all_evts_es (rgf_EvtSys esf). the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> e)) = snd e)&quot;</span><span class="">
</span><span class="">         </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">p6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. c ! j -pes-actk&#8594; c ! Suc j))&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p30</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;k. cs k &#8712; assume_es (Pre k, Rely k))&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">conjoin_comm_imp_rely</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">pre1</span><span class=""> </span><span class="">Pre</span><span class=""> </span><span class="">rely1</span><span class=""> </span><span class="">Rely</span><span class=""> </span><span class="">Guar</span><span class=""> </span><span class="">cs</span><span class=""> </span><span class="">Post</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">pes</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p31</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;k. cs k &#8712; commit_es (Guar k, Post k))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">IntI</span><span class=""> </span><span class="">contra_subsetD</span><span class=""> </span><span class="">cpts_of_es_def</span><span class=""> </span><span class="">es_validity_def</span><span class=""> </span><span class="">p2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p11</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. length (cs k) = length c&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class=""> </span><span class="">same_length_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p12</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. cs k &#8712; cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_of_es_def</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;c &#8800; Nil&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_es_not_empty</span><span class=""> </span><span class="">length_0_conv</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p13</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length c &gt; 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esl</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;cs k&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esys</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;EvtSys es&quot;</span><span class="">
</span><span class="">      
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl &#8712; cpts_es &#8743; ?esl!0 = (EvtSys es,s,x)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">cpts_of_es_def</span><span class=""> </span><span class="">eq_fst_iff</span><span class=""> </span><span class="">getspc_es_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">esll</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a81</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl = (EvtSys es,s,x)#esll&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">hd_Cons_tl</span><span class=""> </span><span class="">length_greater_0_conv</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">p13</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length (cs k)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;cs k ! i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc i&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k)))&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &#8804; length ?esl &#10230; getspc_es (?esl ! i) = EvtSys es&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &#8804; length ?esl &#10230; getspc_es (?esl ! i) = EvtSys es&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (?esl ! i) = EvtSys es &#8743; getspc_es (?esl ! Suc i) = EvtSys es&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsys_not_eq_in_tran_aux1</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">              </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(&#8704;i. Suc i &#8804; length ?esl &#10230; getspc_es (?esl ! i) = EvtSys es)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">m</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc m &#8804; length ?esl &#8743; getspc_es (?esl ! m) &#8800; EvtSys es&quot;</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a8</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (?esl!0) = EvtSys es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">getspc_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;i. i &#8804; m &#8743; getspc_es (?esl ! i) &#8800; EvtSys es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a8</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;i. (i &lt; m &#8743; getspc_es (?esl ! i) = EvtSys es 
                        &#8743; getspc_es (?esl ! Suc i) &#8800; EvtSys es) 
                        &#8743; (&#8704;j. j &lt; i &#10230; getspc_es (?esl ! j) = EvtSys es)&quot;</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsys_fst_ent</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">n</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(n &lt; m &#8743; getspc_es (?esl ! n) = EvtSys es 
                        &#8743; getspc_es (?esl ! Suc n) &#8800; EvtSys es) 
                        &#8743; (&#8704;j. j &lt; n &#10230; getspc_es (?esl ! j) = EvtSys es)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i &#8805; n&quot;</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">                  </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;i &lt; n&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (?esl ! i) = EvtSys es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (?esl ! Suc i) = EvtSys es&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Suc_lessI</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172;(&#8707;t. ?esl!i -es-t&#8594; ?esl!Suc i)&quot;</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsys_not_eq_in_tran</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">surjective_pairing</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">False</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">leI</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">              
</span><span class="">              </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esl1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;drop n ?esl&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?eslh</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;take (Suc n) ?esl&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length ?esl1 &#8805; 2&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_eq_plus1_left</span><span class=""> </span><span class="">Suc_le_eq</span><span class=""> </span><span class="">length_drop</span><span class=""> 
</span><span class="">                    </span><span class="">less_diff_conv</span><span class=""> </span><span class="">less_trans_Suc</span><span class=""> </span><span class="">numeral_2_eq_2</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (?esl1!0) = EvtSys es &#8743; getspc_es (?esl1!1) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">a8</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl1 &#8712; cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_es_dropi</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">drop_0</span><span class=""> </span><span class="">dual_order.strict_trans</span><span class=""> 
</span><span class="">                      </span><span class="">le_0_eq</span><span class=""> </span><span class="">le_SucE</span><span class=""> </span><span class="">le_imp_less_Suc</span><span class=""> </span><span class="">zero_induct</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="">c6</span><span class=""> </span><span class="">c7</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;s x ev s1 x1 xs. 
                ?esl1 = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">fst_esys_snd_eseq_exist</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">s0</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x0</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">e</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">xs</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c8</span><span class="delimiter">:</span><span class="">
</span><span class="">                  </span><span class="string">&quot;?esl1 = (EvtSys es, s0, x0) # (EvtSeq e (EvtSys es), s1,x1) # xs&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c3_1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;j&#8804;n. getspc_es (cs k ! j) = EvtSys es)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">antisym_conv2</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?elst</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;tl (parse_es_cpts_i2 ?esl1 es [[]])&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c8</span><span class=""> </span><span class="">c7</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;concat ?elst = ?esl1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">parse_es_cpts_i2_concat3</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class=""> 
</span><span class="">              
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c13</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;es = Domain esf&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsys_spec_evtsys</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c14</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i&#8712;esf. &#8872; E<span class="hidden">&#8681;</span><sub>e</sub> i sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre<span class="hidden">&#8681;</span><sub>e</sub> i, Rely<span class="hidden">&#8681;</span><sub>e</sub> i, Guar<span class="hidden">&#8681;</span><sub>e</sub> i, Post<span class="hidden">&#8681;</span><sub>e</sub> i]&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">rgsound_e</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?RG</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;&#955;e. SOME rg. (e,rg)&#8712;esf&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c13</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c131</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;e&#8712;es. &#8707;ef&#8712;esf. ?RG e = snd ef&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Domain.cases</span><span class=""> </span><span class="">snd_conv</span><span class=""> </span><span class="">someI</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          
</span><span class="">              </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?Pre</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;pre_rgf &#8728; ?RG&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?Rely</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;rely_rgf &#8728; ?RG&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?Guar</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;guar_rgf &#8728; ?RG&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?Post</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;post_rgf &#8728; ?RG&quot;</span><span class="">
</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c13</span><span class=""> </span><span class="">c14</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c16</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;es. &#8872; ef sat<span class="hidden">&#8681;</span><sub>e</sub> [?Pre ef, ?Rely ef, ?Guar ef, ?Post ef]&quot;</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">mono_tags</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Domain.cases</span><span class=""> </span><span class="">E<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span class=""> </span><span class="">Guar<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span class=""> </span><span class="">Post<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span class=""> 
</span><span class="">                    </span><span class="">Pre<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span class=""> </span><span class="">Rely<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span class=""> </span><span class="">comp_apply</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">snd_conv</span><span class=""> </span><span class="">someI_ex</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c17</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;j&#8712;es. prea &#8838; ?Pre j&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Pre<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span class=""> </span><span class="">c131</span><span class=""> </span><span class="">comp_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">b7</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c18</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;j&#8712;es. Rely k &#8838; ?Rely j&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Rely<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span class=""> </span><span class="">c131</span><span class=""> </span><span class="">comp_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">subsetCE</span><span class=""> </span><span class="">subsetI</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="">b8</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c19</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;j&#8712;es. ?Guar j &#8838; Guar k&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Guar<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span class=""> </span><span class="">c131</span><span class=""> </span><span class="">comp_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">subsetCE</span><span class=""> </span><span class="">subsetI</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="">b9</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c20</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;j&#8712;es. ?Post j &#8838; Post k&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">c131</span><span class=""> </span><span class="">comp_def</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Post<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span class=""> </span><span class="">contra_subsetD</span><span class=""> </span><span class="">subsetI</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b5</span><span class=""> </span><span class="">b10</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c21</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef1 ef2. ef1 &#8712; es &#8743; ef2 &#8712; es &#10230; ?Post ef1 &#8838; ?Pre ef2&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Post<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span class=""> </span><span class="">Pre<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span class=""> </span><span class="">c131</span><span class=""> </span><span class="">comp_apply</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c3_1</span><span class=""> </span><span class="">p30</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c24</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl1&#8712;assume_es (prea, Rely k)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;n = 0&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;n = 0&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">p30</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?esl&#8712;assume_es(prea,Rely k)&quot;</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assume_es_imp</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;Pre k&quot;</span><span class=""> </span><span class="">prea</span><span class=""> </span><span class="string">&quot;Rely k&quot;</span><span class=""> </span><span class="string">&quot;Rely k&quot;</span><span class=""> </span><span class="var">?esl</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                  </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;n &#8800; 0&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">p30</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?esl&#8712;assume_es(prea,relya)&quot;</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assume_es_imp</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;Pre k&quot;</span><span class=""> </span><span class="">prea</span><span class=""> </span><span class="string">&quot;Rely k&quot;</span><span class=""> </span><span class="">relya</span><span class=""> </span><span class="var">?esl</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?eslh &#8712; assume_es(prea,relya)&quot;</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assume_es_take_n</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;Suc n&quot;</span><span class=""> </span><span class="var">?esl</span><span class=""> </span><span class="">prea</span><span class=""> </span><span class="">relya</span><span class="delimiter">]</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i&lt;length ?eslh. getspc_es (?eslh!i) = EvtSys es&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length ?eslh &#10230; getspc_es (?eslh!i) = EvtSys es&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Suc_le_lessD</span><span class=""> </span><span class="">length_take</span><span class=""> </span><span class="">less_antisym</span><span class=""> </span><span class="">less_imp_le_nat</span><span class=""> 
</span><span class="">                        </span><span class="">min.bounded_iff</span><span class=""> </span><span class="">nth_take</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                      </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (last ?eslh) = EvtSys es&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="">dual_order.strict_trans</span><span class=""> 
</span><span class="">                          </span><span class="">getspc_es_def</span><span class=""> </span><span class="">last_snoc</span><span class=""> </span><span class="">le_imp_less_Suc</span><span class=""> </span><span class="">take_Suc_conv_app_nth</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                      </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Suc_lessI</span><span class=""> </span><span class="">diff_Suc_1</span><span class=""> </span><span class="">last_conv_nth</span><span class=""> 
</span><span class="">                          </span><span class="">length_greater_0_conv</span><span class=""> </span><span class="">nat.distinct</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">p13</span><span class=""> </span><span class="">take_eq_Nil</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i&lt;length ?eslh. gets_es (?eslh!i) &#8712; prea&quot;</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b11</span><span class=""> </span><span class="">pre_trans</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?eslh</span><span class=""> </span><span class="">prea</span><span class=""> </span><span class="">relya</span><span class=""> </span><span class="string">&quot;EvtSys es&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc n &#8804; length ?esl&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;n &lt; length ?eslh&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_es (?eslh ! n) &#8712; prea&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?eslh ! n = ?esl1 ! 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">c8</span><span class=""> </span><span class="">nth_via_drop</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_es (?esl ! n) &#8712; prea&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p30</span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assume_es_drop_n</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">n</span><span class=""> </span><span class="var">?esl</span><span class=""> </span><span class="string">&quot;Pre k&quot;</span><span class=""> </span><span class="string">&quot;Rely k&quot;</span><span class=""> </span><span class="">prea</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">ri</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &lt; length ?elst &#10230; 
                          (&#8707;m&#8712;es. ?elst!i@[(?elst!Suc i)!0]&#8712;commit_es(?Guar m,?Post m)
                              &#8743; gets_es ((?elst!Suc i)!0) &#8712; ?Post m
                            &#8743; (&#8707;k. (?elst!i@[(?elst!Suc i)!0])!0-es-(EvtEnt m)&#9839;k&#8594;(?elst!i@[(?elst!Suc i)!0])!1))&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">EventSys_sound_aux_i</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="var">?Pre</span><span class=""> </span><span class="var">?Rely</span><span class=""> </span><span class="var">?Guar</span><span class=""> </span><span class="var">?Post</span><span class="">
</span><span class="">                      </span><span class="string">&quot;prea&quot;</span><span class=""> </span><span class="string">&quot;Rely k&quot;</span><span class=""> </span><span class="string">&quot;Guar k&quot;</span><span class=""> </span><span class="string">&quot;Post k&quot;</span><span class=""> </span><span class="var">?esl1</span><span class=""> </span><span class="">s0</span><span class=""> </span><span class="">x0</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">xs</span><span class=""> </span><span class="var">?elst</span><span class="delimiter">]</span><span class="">
</span><span class="">                      </span><span class="">c7</span><span class=""> </span><span class="">c8</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c16</span><span class=""> </span><span class="">c17</span><span class=""> </span><span class="">c18</span><span class=""> </span><span class="">c19</span><span class=""> </span><span class="">c20</span><span class=""> </span><span class="">c21</span><span class=""> </span><span class="">c24</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">ri_forall</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> 
</span><span class="">                </span><span class="string">&quot;&#8704;i. Suc i &lt; length ?elst &#10230; 
                    (&#8704;ei&#8712;es. (&#8707;k. (?elst!i@[(?elst!Suc i)!0])!0-es-(EvtEnt ei)&#9839;k&#8594;(?elst!i@[(?elst!Suc i)!0])!1) 
                                  &#10230; ?elst!i@[(?elst!Suc i)!0]&#8712;commit_es(?Guar ei,?Post ei)
                                    &#8743; gets_es ((?elst!Suc i)!0) &#8712; ?Post ei)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">EventSys_sound_aux_i_forall</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="var">?Pre</span><span class=""> </span><span class="var">?Rely</span><span class=""> </span><span class="var">?Guar</span><span class=""> </span><span class="var">?Post</span><span class="">
</span><span class="">                      </span><span class="string">&quot;prea&quot;</span><span class=""> </span><span class="string">&quot;Rely k&quot;</span><span class=""> </span><span class="string">&quot;Guar k&quot;</span><span class=""> </span><span class="string">&quot;Post k&quot;</span><span class=""> </span><span class="var">?esl1</span><span class=""> </span><span class="">s0</span><span class=""> </span><span class="">x0</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">xs</span><span class=""> </span><span class="var">?elst</span><span class="delimiter">]</span><span class=""> 
</span><span class="">                      </span><span class="">c7</span><span class=""> </span><span class="">c8</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                      
</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c16</span><span class=""> </span><span class="">c17</span><span class=""> </span><span class="">c18</span><span class=""> </span><span class="">c19</span><span class=""> </span><span class="">c20</span><span class=""> </span><span class="">c21</span><span class=""> </span><span class="">b10</span><span class=""> </span><span class="">c7</span><span class=""> </span><span class="">c8</span><span class=""> </span><span class="">c24</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">rl_forall</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ei&#8712;es. (&#8707;k. (last ?elst)!0-es-(EvtEnt ei)&#9839;k&#8594;(last ?elst)!1)
                            &#10230; last ?elst&#8712;commit_es(?Guar ei,?Post ei)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">EventSys_sound_aux_last_forall</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="var">?Pre</span><span class=""> </span><span class="var">?Rely</span><span class=""> </span><span class="var">?Guar</span><span class=""> </span><span class="var">?Post</span><span class="">
</span><span class="">                      </span><span class="string">&quot;prea&quot;</span><span class=""> </span><span class="string">&quot;Rely k&quot;</span><span class=""> </span><span class="string">&quot;Guar k&quot;</span><span class=""> </span><span class="string">&quot;Post k&quot;</span><span class=""> </span><span class="var">?esl1</span><span class=""> </span><span class="">s0</span><span class=""> </span><span class="">x0</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">xs</span><span class=""> </span><span class="var">?elst</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                      
</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c16</span><span class=""> </span><span class="">c17</span><span class=""> </span><span class="">c18</span><span class=""> </span><span class="">c19</span><span class=""> </span><span class="">c20</span><span class=""> </span><span class="">c21</span><span class=""> </span><span class="">b10</span><span class=""> </span><span class="">c7</span><span class=""> </span><span class="">c8</span><span class=""> </span><span class="">c24</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">rl</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;m&#8712;es. last ?elst&#8712;commit_es(?Guar m,?Post m) 
                        &#8743; (&#8707;k. (last ?elst)!0-es-(EvtEnt m)&#9839;k&#8594;(last ?elst)!1)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">EventSys_sound_aux_last</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="var">?Pre</span><span class=""> </span><span class="var">?Rely</span><span class=""> </span><span class="var">?Guar</span><span class=""> </span><span class="var">?Post</span><span class="">
</span><span class="">                      </span><span class="string">&quot;prea&quot;</span><span class=""> </span><span class="string">&quot;Rely k&quot;</span><span class=""> </span><span class="string">&quot;Guar k&quot;</span><span class=""> </span><span class="string">&quot;Post k&quot;</span><span class=""> </span><span class="var">?esl1</span><span class=""> </span><span class="">s0</span><span class=""> </span><span class="">x0</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">xs</span><span class=""> </span><span class="var">?elst</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                      
</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c8</span><span class=""> </span><span class="">c7</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">no_mident</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. i &lt; length ?elst &#10230; 
                             &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length (?elst!i) &#8743; 
                             getspc_es (?elst!i!j) = EvtSys es &#8743; getspc_es (?elst!i!Suc j) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">                 </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">parse_es_cpts_i2_noent_mid</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?esl1</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="">s0</span><span class=""> </span><span class="">x0</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">xs</span><span class=""> </span><span class="string">&quot;parse_es_cpts_i2 ?esl1 es [[]]&quot;</span><span class="delimiter">]</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c8</span><span class=""> </span><span class="">c7</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">no_mident_i</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &lt; length ?elst &#10230; 
                             &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length (?elst!i@[?elst!Suc i!0]) &#8743; 
                             getspc_es ((?elst!i@[?elst!Suc i!0])!j) = EvtSys es &#8743; getspc_es ((?elst!i@[?elst!Suc i!0])!Suc j) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">                 </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">parse_es_cpts_i2_noent_mid_i</span><span class="delimiter">)</span><span class="">
</span><span class="">              
</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">in_cpts_i</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &lt; length ?elst &#10230; (?elst!i)@[?elst!Suc i!0] &#8712;cpts_es&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">parse_es_cpts_i2_in_cptes_i</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?esl1</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="">s0</span><span class=""> </span><span class="">x0</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">xs</span><span class=""> </span><span class="var">?elst</span><span class="delimiter">]</span><span class=""> </span><span class="">c7</span><span class=""> </span><span class="">c8</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">              
</span><span class="">              </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">in_cpts_last</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;last ?elst &#8712;cpts_es&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">parse_es_cpts_i2_in_cptes_last</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?esl1</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="">s0</span><span class=""> </span><span class="">x0</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">xs</span><span class=""> </span><span class="var">?elst</span><span class="delimiter">]</span><span class=""> </span><span class="">c7</span><span class=""> </span><span class="">c8</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">in_cpts_last1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?elst ! (length ?elst - 1) &#8712; cpts_es&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">c7</span><span class=""> </span><span class="">c9</span><span class=""> </span><span class="">concat.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">cpts_es_not_empty</span><span class=""> </span><span class="">last_conv_nth</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="">c8</span><span class=""> </span><span class="">c7</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">len_start_elst</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> 
</span><span class="">                </span><span class="string">&quot;&#8704;i&lt;length ?elst. length (?elst!i) &#8805; 2 &#8743; getspc_es (?elst!i!0) = EvtSys es 
                                  &#8743; getspc_es (?elst!i!1) &#8800; EvtSys es&quot;</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">parse_es_cpts_i2_start_aux</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?esl1</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="">s0</span><span class=""> </span><span class="">x0</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">s1</span><span class=""> </span><span class="">x1</span><span class=""> </span><span class="">xs</span><span class=""> </span><span class="string">&quot;parse_es_cpts_i2 ?esl1 es [[]]&quot;</span><span class="delimiter">]</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c30</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &lt; length ?esl1 
                      &#10230; (&#8707;k j. (Suc k &lt; length ?elst &#8743; Suc j &lt; length (?elst!k@[(?elst!Suc k)!0]) &#8743; 
                                  ?esl1!i = (?elst!k@[(?elst!Suc k)!0])!j &#8743; ?esl1!Suc i = (?elst!k@[(?elst!Suc k)!0])!Suc j) 
                              &#8744; (Suc k = length ?elst &#8743; Suc j &lt; length (?elst!k) &#8743; 
                                  ?esl1!i = ?elst!k!j &#8743; ?esl1!Suc i = ?elst!k!Suc j))&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">c9</span><span class=""> </span><span class="">concat_list_lemma</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?esl1</span><span class=""> </span><span class="var">?elst</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">              
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p12</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c33</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. i &lt; length ?esl 
                &#10230; getspc_es (?esl!i) = EvtSys es &#8744; (&#8707;e. getspc_es (?esl!i) = EvtSeq e (EvtSys es) &#8743; is_anonyevt e)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsys_all_es_in_cpts_anony</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?esl</span><span class=""> </span><span class="">es</span><span class="delimiter">]</span><span class="">
</span><span class="">                  </span><span class="">c2</span><span class=""> </span><span class="">gr0I</span><span class=""> </span><span class="">gr_implies_not0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c34</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl!i = ?esl1!(i - n)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">add_diff_inverse_nat</span><span class=""> </span><span class="">leD</span><span class=""> </span><span class="">less_imp_le_nat</span><span class=""> </span><span class="">nth_drop</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c340</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl!Suc i = ?esl1!(Suc (i - n))&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">add_diff_inverse_nat</span><span class=""> </span><span class="">leD</span><span class=""> </span><span class="">less_imp_le_nat</span><span class=""> </span><span class="">nth_drop</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;Suc (i - n) &lt; length ?esl1&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Suc_diff_le</span><span class=""> </span><span class="">diff_less_mono</span><span class=""> </span><span class="">le_SucI</span><span class="delimiter">)</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c30</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;k j. (Suc k &lt; length ?elst &#8743; Suc j &lt; length (?elst!k@[(?elst!Suc k)!0]) &#8743; 
                                  ?esl1!(i - n) = (?elst!k@[(?elst!Suc k)!0])!j &#8743; ?esl1!Suc (i - n) = (?elst!k@[(?elst!Suc k)!0])!Suc j) 
                              &#8744; (Suc k = length ?elst &#8743; Suc j &lt; length (?elst!k) &#8743; 
                                  ?esl1!(i - n) = ?elst!k!j &#8743; ?esl1!Suc (i - n) = ?elst!k!Suc j)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">kk</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">j</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c35</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(Suc kk &lt; length ?elst &#8743; Suc j &lt; length (?elst!kk@[(?elst!Suc kk)!0]) &#8743; 
                                  ?esl1!(i - n) = (?elst!kk@[(?elst!Suc kk)!0])!j &#8743; ?esl1!Suc (i - n) = (?elst!kk@[(?elst!Suc kk)!0])!Suc j) 
                              &#8744; (Suc kk = length ?elst &#8743; Suc j &lt; length (?elst!kk) &#8743; 
                                  ?esl1!(i - n) = ?elst!kk!j &#8743; ?esl1!Suc (i - n) = ?elst!kk!Suc j)&quot;</span><span class="">
</span><span class="">                 </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?elstk</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;?elst!kk@[(?elst!Suc kk)!0]&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c36</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length ?elstk &gt; 2&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">len_start_elst</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">kk</span><span class="delimiter">]</span><span class=""> </span><span class="">c35</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">le_imp_less_Suc</span><span class=""> </span><span class="">length_append_singleton</span><span class=""> </span><span class="">lessI</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?elstl</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;?elst!kk&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c37</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length ?elstl &#8805; 2&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">len_start_elst</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">kk</span><span class="delimiter">]</span><span class=""> </span><span class="">c35</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">lessI</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c35</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c38</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc kk &#8804; length ?elst&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">less_or_eq_imp_le</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c38</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length (?elst!kk) &#8743; 
                         getspc_es (?elst!kk!j) = EvtSys es &#8743; getspc_es (?elst!kk!Suc j) &#8800; EvtSys es)&quot;</span><span class=""> 
</span><span class="">                 </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">no_mident</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;j. j &gt; 0 &#8743; Suc j &lt; length (?elst!kk) &#10230; getspc_es ((?elst!kk) ! j) = EvtSys es 
                      &#10230; getspc_es ((?elst!kk) ! Suc j) = EvtSys es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">noevtent_inmid_eq</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d43</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length ?esl = n + length ?esl1&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="cartouche">&#8249;Suc (i - n) &lt; length (drop n (cs k))&#8250;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c35</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">proof</span></span><span class="">
</span><span class="">                  </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(Suc kk &lt; length ?elst &#8743; Suc j &lt; length ?elstk &#8743; 
                             ?esl1!(i - n) = ?elstk!j &#8743; ?esl1!Suc (i - n) = ?elstk!Suc j)&quot;</span><span class="">
</span><span class="">                  
</span><span class="">                  </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d01</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j &#8800; 0&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">proof</span></span><span class="">
</span><span class="">                      </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j = 0&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">len_start_elst</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">kk</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (?elstk!j) = EvtSys es 
                            &#8743; getspc_es (?elstk!Suc j) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">                         </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">hide_lams</span><span class="delimiter">)</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_1</span><span class=""> </span><span class="">Suc_le_lessD</span><span class=""> </span><span class="">c34</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">less_imp_le_nat</span><span class=""> </span><span class="">nth_append</span><span class="delimiter">)</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172;(&#8707;ess. getspc_es (?esl ! i) = EvtSys ess)&quot;</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cmd_enable_impl_notesys2</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;?esl ! i&quot;</span><span class=""> </span><span class="">cmd</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="string">&quot;?esl ! Suc i&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?esl!i = ?elstk!j&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">c34</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                      </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="">False</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">                  
</span><span class="">                  </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1_1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ii. ii &gt; 0 &#8743; Suc ii &lt; length ?elstk 
                        &#10230; &#172;(&#8707;e. (?elstk!ii) -es-((EvtEnt e)&#9839;k)&#8594; (?elstk!(Suc ii)))&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">                      </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">ii</span><span class="">
</span><span class="">                      </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;ii &gt; 0 &#8743; Suc ii &lt; length ?elstk&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172;(&#8707;e. (?elstk!ii) -es-((EvtEnt e)&#9839;k)&#8594; (?elstk!(Suc ii)))&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;getspc_es (?elstk!ii) = EvtSys es&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                          </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">f0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (?elstk!ii) = EvtSys es&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (?elstk!(Suc ii)) = EvtSys es&quot;</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Suc_lessI</span><span class=""> </span><span class="">Suc_less_eq</span><span class=""> </span><span class="">c7</span><span class=""> </span><span class="">c8</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">length_append_singleton</span><span class=""> 
</span><span class="">                              </span><span class="">nth_append</span><span class=""> </span><span class="">nth_append_length</span><span class=""> </span><span class="">parse_es_cpts_i2_start_aux</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">f0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsys_not_eq_in_tran_aux1</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                          </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">f0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (?elstk!ii) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">in_cpts_i</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">kk</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?elstk &#8712; cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="">len_start_elst</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">kk</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> 
</span><span class="">                            </span><span class="string">&quot;length ?elstk &gt; 0 &#8743; getspc_es (?elstk!0) = EvtSys es&quot;</span><span class=""> 
</span><span class="">                            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">cpts_es_not_empty</span><span class=""> </span><span class="">length_greater_0_conv</span><span class=""> 
</span><span class="">                                </span><span class="">list.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">not_numeral_le_zero</span><span class=""> </span><span class="">nth_append</span><span class="delimiter">)</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;e. getspc_es (?elstk!ii) = EvtSeq e (EvtSys es) 
                                            &#8743; is_anonyevt e&quot;</span><span class=""> 
</span><span class="">                            </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsys_all_es_in_cpts_anony</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?elstk</span><span class=""> </span><span class="">es</span><span class="delimiter">]</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">f0</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">                          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">incpts_es_eseq_not_evtent</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?elstk</span><span class=""> </span><span class="">ii</span><span class="delimiter">]</span><span class=""> 
</span><span class="">                            </span><span class="">in_cpts_i</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">kk</span><span class="delimiter">]</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (?elstk!0) = EvtSys es &#8743; getspc_es (?elstk!1) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">len_start_elst</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">0</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">hide_lams</span><span class="delimiter">)</span><span class=""> </span><span class="">One_nat_def</span><span class=""> 
</span><span class="">                      </span><span class="">Suc_1</span><span class=""> </span><span class="">Suc_le_lessD</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">len_start_elst</span><span class=""> </span><span class="">nth_append</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c9</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">len_start_elst</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;si ti. si = length (concat (take kk ?elst)) &#8743; ti = Suc (length (concat (take (Suc kk) ?elst))) &#8743;
                      si &#8804; length ?esl1 &#8743; ti &lt; length ?esl1 &#8743; si &lt; ti &#8743; drop si (take ti ?esl1) = ?elstk&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">concat_list_lemma_withnextfst3</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?esl1</span><span class=""> </span><span class="var">?elst</span><span class=""> </span><span class="">kk</span><span class="delimiter">]</span><span class="">
</span><span class="">                      </span><span class="">Suc_1</span><span class=""> </span><span class="">Suc_le_lessD</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">presburger</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">si</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">ti</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">d4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;si = length (concat (take kk ?elst)) 
                      &#8743; ti = Suc (length (concat (take (Suc kk) ?elst))) 
                      &#8743; si &#8804; length ?esl1 &#8743; ti &lt; length ?esl1 
                      &#8743; si &lt; ti &#8743; drop si (take ti ?esl1) = ?elstk&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d42</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;si + (length ?elstk) = ti&quot;</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">drop_take_eq</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?elstk</span><span class=""> </span><span class="">si</span><span class=""> </span><span class="">ti</span><span class=""> </span><span class="var">?esl1</span><span class=""> </span><span class="string">&quot;length ?elstk&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="">c36</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">cpts_es_not_empty</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">in_cpts_i</span><span class=""> </span><span class="">length_greater_0_conv</span><span class=""> </span><span class="">less_imp_le_nat</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;ti &lt; length ?esl1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d43</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d41</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;n + ti &lt; length ?esl&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?elstk = drop (si+n) (take (ti+n) ?esl)&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">drop_drop</span><span class=""> </span><span class="">take_drop</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?elstk!0 = ?esl!(si+n)&quot;</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Nat.add_0_right</span><span class=""> 
</span><span class="">                        </span><span class="">append_is_Nil_conv</span><span class=""> </span><span class="">append_take_drop_id</span><span class=""> </span><span class="">drop_eq_Nil</span><span class=""> 
</span><span class="">                        </span><span class="">leI</span><span class=""> </span><span class="">nat_le_linear</span><span class=""> </span><span class="">not_Cons_self2</span><span class=""> </span><span class="">nth_append</span><span class=""> </span><span class="">nth_drop</span><span class="delimiter">)</span><span class="">
</span><span class="">                  
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?elstk!1 = drop (si+n) (take (ti+n) ?esl) ! 1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">d5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;drop (si+n) (take (ti+n) ?esl) ! 1 = ?esl!(Suc (si+n))&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_eq_plus1</span><span class=""> </span><span class="">Suc_leI</span><span class=""> </span><span class="">Suc_lessI</span><span class=""> 
</span><span class="">                      </span><span class="">add_diff_cancel_left&#39;</span><span class=""> </span><span class="">append_is_Nil_conv</span><span class=""> </span><span class="">append_take_drop_id</span><span class="">
</span><span class="">                      </span><span class="">drop_eq_Nil</span><span class=""> </span><span class="">length_drop</span><span class=""> </span><span class="">not_less</span><span class=""> </span><span class="">nth_append</span><span class=""> </span><span class="">nth_drop</span><span class=""> </span><span class="">zero_less_Suc</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?elstk!1 = ?esl!(Suc (si+n))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">                  
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c36</span><span class=""> </span><span class="">d4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d71</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;ti &gt; si + 2&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">drop_take_ln</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?elstk</span><span class=""> </span><span class="">si</span><span class=""> </span><span class="">ti</span><span class=""> </span><span class="var">?esl1</span><span class=""> </span><span class="">2</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">d4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d72</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc (si+n) &lt; length ?esl&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;si + 2 &lt; length (cs k) - n&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="cartouche">&#8249;ti &lt; length (drop n (cs k))&#8250;</span><span class=""> </span><span class="">d71</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;Suc (Suc (si + n)) &lt; length (cs k)&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">linarith</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Suc_le_lessD</span><span class=""> </span><span class="">order.strict_implies_order</span><span class="delimiter">)</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="">d6</span><span class=""> </span><span class="">d7</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;e. ?esl!(si+n) -es-((EvtEnt e)&#9839;k)&#8594; ?esl!(Suc (si+n))&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">entevt_in_conjoin_cpts</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">cs</span><span class=""> </span><span class="string">&quot;si+n&quot;</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">es</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">ente</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">d8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl!(si+n) -es-((EvtEnt ente)&#9839;k)&#8594; ?esl!(Suc (si+n))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="">d6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;ei&#8712;es. ente = ei&quot;</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsysent_evtent3</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;?esl!(si+n)&quot;</span><span class=""> </span><span class="">ente</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="string">&quot;?esl!(Suc (si+n))&quot;</span><span class=""> </span><span class="">es</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">ei</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">d9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;ei&#8712;es &#8743; ente = ei&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">ri_forall</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">kk</span><span class=""> </span><span class="">ei</span><span class="delimiter">]</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">d6</span><span class=""> </span><span class="">d7</span><span class=""> </span><span class="">d8</span><span class=""> </span><span class="">d9</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d10</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?elstk &#8712; commit_es(?Guar ei,?Post ei)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d11</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;cs k ! i = ?elstk ! j&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">c34</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d12</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;cs k ! Suc i = ?elstk ! Suc j&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">c340</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d13</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?elstk ! j -es-Cmd cmd&#9839;k&#8594; ?elstk ! Suc j&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d14</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(gets_es (?elstk ! j), gets_es (?elstk ! Suc j)) &#8712; ?Guar ei&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d10</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length ?elstk &#10230; 
                              (&#8707;t. ?elstk!i -es-t&#8594; ?elstk!(Suc i)) &#10230; 
                                  (gets_es (?elstk!i), gets_es (?elstk!Suc i)) &#8712; ?Guar ei&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">d13</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d11</span><span class=""> </span><span class="">d12</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d15</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; ?Guar ei&quot;</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">no_mident_i</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">kk</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172;(&#8707;m. m &gt; 0 &#8743; Suc m &lt; length ?elstk &#8743; 
                             getspc_es (?elstk!m) = EvtSys es &#8743; getspc_es (?elstk!Suc m) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d16</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;m. m &gt; 0 &#8743; Suc m &lt; length ?elstk 
                      &#10230; &#172;(getspc_es (?elstk!m) = EvtSys es &#8743; getspc_es (?elstk!Suc m) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d17</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;m. m &gt; (si + n) &#8743; m &lt; ti + n - 1 &#10230; 
                             &#172;(getspc_es (?esl!m) = EvtSys es &#8743; getspc_es (?esl!Suc m) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">                      </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">m</span><span class="">
</span><span class="">                      </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m &gt; (si + n) &#8743; m &lt; ti + n - 1&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m - (n+si) &gt; 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc (m - (n+si)) &lt; length ?elstk&quot;</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;m - (n + si) &lt; ti - si - 1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;Suc (m - (n + si)) &lt; ti - si&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d42</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172;(getspc_es (?elstk!(m-(n+si))) = EvtSys es 
                          &#8743; getspc_es (?elstk!Suc (m-(n+si))) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">d16</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;m - (n+si)&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">e2</span><span class=""> </span><span class="">d5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?esl!m = ?elstk!(m - (n+si))&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">drop_take_sametrace</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?elstk</span><span class=""> </span><span class="string">&quot;si+n&quot;</span><span class=""> </span><span class="string">&quot;ti+n&quot;</span><span class=""> </span><span class="var">?esl</span><span class=""> </span><span class="string">&quot;m - (n+si)&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">e2</span><span class=""> </span><span class="">d5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?esl!Suc m = ?elstk!Suc (m - (n+si))&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">drop_take_sametrace</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?elstk</span><span class=""> </span><span class="string">&quot;si+n&quot;</span><span class=""> </span><span class="string">&quot;ti+n&quot;</span><span class=""> </span><span class="var">?esl</span><span class=""> </span><span class="string">&quot;Suc (m - (n+si))&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172;(getspc_es (?esl!m) = EvtSys es &#8743; getspc_es (?esl!Suc m) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d18</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;m. m &gt; (si + n) &#8743; m &lt; ti + n - 1 &#10230; 
                             &#172;(&#8707;e. ?esl!m -es-((EvtEnt e)&#9839;k)&#8594; ?esl!Suc m)&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">                      </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">m</span><span class="">
</span><span class="">                      </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m &gt; (si + n) &#8743; m &lt; ti + n - 1&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d17</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172;(getspc_es (?esl!m) = EvtSys es &#8743; getspc_es (?esl!Suc m) &#8800; EvtSys es)&quot;</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">a8</span><span class=""> </span><span class="">a81</span><span class=""> </span><span class="">d41</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172;(&#8707;e. ?esl!m -es-((EvtEnt e)&#9839;k)&#8594; ?esl!Suc m)&quot;</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">notentevt_in_conjoin_cpts</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">cs</span><span class=""> </span><span class="">m</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">es</span><span class="delimiter">]</span><span class=""> </span><span class="">evtsys_allevtseqorevtsys</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?esl</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">esll</span><span class="delimiter">]</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                  
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d71</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;Suc (si + n) &lt; ti + n - 1&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Suc_eq_plus1</span><span class=""> </span><span class="">add.assoc</span><span class=""> </span><span class="">add_2_eq_Suc</span><span class=""> </span><span class="">add_diff_cancel_right&#39;</span><span class=""> </span><span class="">less_diff_conv</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">linarith</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d41</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;Suc (ti + n - 1) &lt; length (cs k)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">calculation</span><span class=""> </span><span class="">d41</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">linarith</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d19</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="string">&quot;&#8704;m. m &gt; (si + n) &#8743; m &#8804; (ti + n - 1) &#10230; getx_es ((cs k)!m) k = ente&quot;</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtent_impl_curevt_in_cpts_es</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">cs</span><span class=""> </span><span class="string">&quot;si + n&quot;</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">ente</span><span class=""> </span><span class="string">&quot;ti + n - 1&quot;</span><span class="delimiter">]</span><span class="">
</span><span class="">                       </span><span class="">d18</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="">d8</span><span class=""> </span><span class="">d41</span><span class=""> </span><span class="">d71</span><span class=""> </span><span class="">d72</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">d42</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;si + n + j &#8804; ti + n - 1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d19</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;si + n + j&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="">d01</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getx_es ((cs k)!(si + n + j)) k = ente&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d11</span><span class=""> </span><span class="">d5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getx_es ((cs k)!i) k = ente&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">drop_take_sametrace</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;the (evtrgfs (ei)) = (?RG ei)&quot;</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">all_evts_es_esys</span><span class=""> </span><span class="">d9</span><span class=""> </span><span class="">c13</span><span class=""> </span><span class="">c131</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Domain.cases</span><span class=""> </span><span class="">E<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span class=""> </span><span class="">prod.sel</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">snd_conv</span><span class=""> </span><span class="">someI_ex</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d9</span><span class=""> </span><span class="">c13</span><span class=""> </span><span class="">c131</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?Guar ei = Guar<span class="hidden">&#8681;</span><sub>f</sub> (?RG ei)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Guar<span class="hidden">&#8681;</span><sub>f</sub>_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">d15</span><span class=""> </span><span class="">d9</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                  </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc kk = length ?elst &#8743; Suc j &lt; length ?elstl &#8743; 
                              ?esl1!(i - n) = ?elstl!j &#8743; ?esl1!Suc (i - n) = ?elstl!Suc j&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d01</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j &#8800; 0&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">proof</span></span><span class="">
</span><span class="">                      </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;j = 0&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">len_start_elst</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">kk</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (?elstl!j) = EvtSys es 
                            &#8743; getspc_es (?elstl!Suc j) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">                         </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">lessI</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172;(&#8707;ess. getspc_es (?esl ! i) = EvtSys ess)&quot;</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cmd_enable_impl_notesys2</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;?esl ! i&quot;</span><span class=""> </span><span class="">cmd</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="string">&quot;?esl ! Suc i&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?esl!i = ?elstl!j&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">c34</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                      </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="">False</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">                  
</span><span class="">                  </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1_1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ii. ii &gt; 0 &#8743; Suc ii &lt; length ?elstl 
                        &#10230; &#172;(&#8707;e. (?elstl!ii) -es-((EvtEnt e)&#9839;k)&#8594; (?elstl!(Suc ii)))&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">                      </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">ii</span><span class="">
</span><span class="">                      </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;ii &gt; 0 &#8743; Suc ii &lt; length ?elstl&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172;(&#8707;e. (?elstl!ii) -es-((EvtEnt e)&#9839;k)&#8594; (?elstl!(Suc ii)))&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;getspc_es (?elstl!ii) = EvtSys es&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                          </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">f0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (?elstl!ii) = EvtSys es&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (?elstl!(Suc ii)) = EvtSys es&quot;</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Suc_lessI</span><span class=""> </span><span class="">Suc_less_eq</span><span class=""> </span><span class="">c7</span><span class=""> </span><span class="">c8</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">length_append_singleton</span><span class=""> 
</span><span class="">                              </span><span class="">nth_append</span><span class=""> </span><span class="">nth_append_length</span><span class=""> </span><span class="">parse_es_cpts_i2_start_aux</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">f0</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsys_not_eq_in_tran_aux1</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                          </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">f0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (?elstl!ii) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc kk = length ?elst&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">in_cpts_last1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?elstl &#8712; cpts_es&quot;</span><span class="">
</span><span class="">                            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">diff_Suc_1</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                          </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="">len_start_elst</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">kk</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> 
</span><span class="">                            </span><span class="string">&quot;length ?elstl &gt; 0 &#8743; getspc_es (?elstl!0) = EvtSys es&quot;</span><span class="">
</span><span class="">                              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Suc_le_lessD</span><span class=""> </span><span class="">c38</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">gr_implies_not0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">                          </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;e. getspc_es (?elstl!ii) = EvtSeq e (EvtSys es) 
                                            &#8743; is_anonyevt e&quot;</span><span class=""> 
</span><span class="">                            </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsys_all_es_in_cpts_anony</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?elstl</span><span class=""> </span><span class="">es</span><span class="delimiter">]</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">f0</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">                          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">incpts_es_eseq_not_evtent</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?elstl</span><span class=""> </span><span class="">ii</span><span class="delimiter">]</span><span class=""> 
</span><span class="">                            </span><span class="">in_cpts_last1</span><span class=""> </span><span class="">f2</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (?elstl!0) = EvtSys es &#8743; getspc_es (?elstl!1) &#8800; EvtSys es&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">len_start_elst</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">kk</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c9</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">len_start_elst</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">kk</span><span class="delimiter">]</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;si ti. si = length (concat (take kk ?elst)) &#8743; ti = length (concat (take (Suc kk) ?elst)) &#8743;
                      si &#8804; length ?esl1 &#8743; ti &#8804; length ?esl1 &#8743; si &lt; ti &#8743; drop si (take ti ?esl1) = ?elstl&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">concat_list_lemma3</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?esl1</span><span class=""> </span><span class="var">?elst</span><span class=""> </span><span class="">kk</span><span class="delimiter">]</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Suc_1</span><span class=""> </span><span class="">Suc_le_lessD</span><span class=""> </span><span class="">c38</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">presburger</span><span class="">
</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">si</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">ti</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">d4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;si = length (concat (take kk ?elst)) 
                      &#8743; ti = length (concat (take (Suc kk) ?elst)) 
                      &#8743; si &#8804; length ?esl1 &#8743; ti &#8804; length ?esl1 &#8743; si &lt; ti 
                      &#8743; drop si (take ti ?esl1) = ?elstl&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d42</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;si + (length ?elstl) = ti&quot;</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">drop_take_eq</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?elstl</span><span class=""> </span><span class="">si</span><span class=""> </span><span class="">ti</span><span class=""> </span><span class="var">?esl1</span><span class=""> </span><span class="string">&quot;length ?elstl&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="">c37</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">gr_implies_not0</span><span class=""> </span><span class="">not_gr0</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">d4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;ti = length ?esl1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">c38</span><span class=""> </span><span class="">c9</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d43</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d41</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;n + ti = length ?esl&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?elstl = drop (si+n) (take (ti+n) ?esl)&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">drop_drop</span><span class=""> </span><span class="">take_drop</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?elstl!0 = ?esl!(si+n)&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Cons_nth_drop_Suc</span><span class=""> </span><span class="cartouche">&#8249;ti = length (drop n (cs k))&#8250;</span><span class=""> </span><span class="">d4</span><span class=""> 
</span><span class="">                      </span><span class="">drop_drop</span><span class=""> </span><span class="">drop_eq_Nil</span><span class=""> </span><span class="">linorder_not_less</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">take_all</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                  
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?elstl!1 = drop (si+n) (take (ti+n) ?esl) ! 1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">d5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;drop (si+n) (take (ti+n) ?esl) ! 1 = ?esl!(Suc (si+n))&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_eq_plus1</span><span class=""> </span><span class="">Suc_leI</span><span class=""> </span><span class="">Suc_lessI</span><span class=""> 
</span><span class="">                      </span><span class="">add_diff_cancel_left&#39;</span><span class=""> </span><span class="">append_is_Nil_conv</span><span class=""> </span><span class="">append_take_drop_id</span><span class="">
</span><span class="">                      </span><span class="">drop_eq_Nil</span><span class=""> </span><span class="">length_drop</span><span class=""> </span><span class="">not_less</span><span class=""> </span><span class="">nth_append</span><span class=""> </span><span class="">nth_drop</span><span class=""> </span><span class="">zero_less_Suc</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?elstl!1 = ?esl!(Suc (si+n))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c37</span><span class=""> </span><span class="">d4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d71</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;ti &gt; si + 2&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">drop_take_ln</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?elstl</span><span class=""> </span><span class="">si</span><span class=""> </span><span class="">ti</span><span class=""> </span><span class="var">?esl1</span><span class=""> </span><span class="">2</span><span class="delimiter">]</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Suc_inject</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">d01</span><span class=""> </span><span class="">le_eq_less_or_eq</span><span class=""> </span><span class="">less_2_cases</span><span class=""> </span><span class="">nat.distinct</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">d4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d72</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc (si+n) &lt; length ?esl&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Suc_leI</span><span class=""> </span><span class="">Suc_n_not_le_n</span><span class=""> </span><span class="">add.commute</span><span class=""> </span><span class="">add_2_eq_Suc&#39;</span><span class=""> </span><span class="">add_Suc_right</span><span class="">
</span><span class="">                      </span><span class="">d41</span><span class=""> </span><span class="">leI</span><span class=""> </span><span class="">le_antisym</span><span class=""> </span><span class="">less_trans_Suc</span><span class=""> </span><span class="">nat_add_left_cancel_less</span><span class=""> 
</span><span class="">                      </span><span class="">nat_le_linear</span><span class=""> </span><span class="">not_less</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">linarith</span><span class="">
</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="">d6</span><span class=""> </span><span class="">d7</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;e. ?esl!(si+n) -es-((EvtEnt e)&#9839;k)&#8594; ?esl!(Suc (si+n))&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">entevt_in_conjoin_cpts</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">cs</span><span class=""> </span><span class="string">&quot;si+n&quot;</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">es</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">ente</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">d8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl!(si+n) -es-((EvtEnt ente)&#9839;k)&#8594; ?esl!(Suc (si+n))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="">d6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;ei&#8712;es. ente = ei&quot;</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsysent_evtent3</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;?esl!(si+n)&quot;</span><span class=""> </span><span class="">ente</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="string">&quot;?esl!(Suc (si+n))&quot;</span><span class=""> </span><span class="">es</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">ei</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">d9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;ei&#8712;es &#8743; ente = ei&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">d6</span><span class=""> </span><span class="">d7</span><span class=""> </span><span class="">d8</span><span class=""> </span><span class="">d9</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d10</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?elstl &#8712; commit_es(?Guar ei,?Post ei)&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">c7</span><span class=""> </span><span class="">c9</span><span class=""> </span><span class="">concat.simps</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">cpts_es_not_empty</span><span class=""> </span><span class="">diff_Suc_1</span><span class=""> </span><span class="">last_conv_nth</span><span class=""> </span><span class="">rl_forall</span><span class="delimiter">)</span><span class="">
</span><span class="">                  
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d11</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;cs k ! i = ?elstl ! j&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">c34</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d12</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;cs k ! Suc i = ?elstl ! Suc j&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">c340</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d13</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?elstl ! j -es-Cmd cmd&#9839;k&#8594; ?elstl ! Suc j&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d14</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(gets_es (?elstl ! j), gets_es (?elstl ! Suc j)) &#8712; ?Guar ei&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d10</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length ?elstl &#10230; 
                              (&#8707;t. ?elstl!i -es-t&#8594; ?elstl!(Suc i)) &#10230; 
                                  (gets_es (?elstl!i), gets_es (?elstl!Suc i)) &#8712; ?Guar ei&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">d13</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d11</span><span class=""> </span><span class="">d12</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d15</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; ?Guar ei&quot;</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">no_mident</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">kk</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172;(&#8707;m. m &gt; 0 &#8743; Suc m &lt; length ?elstl &#8743; 
                             getspc_es (?elstl!m) = EvtSys es &#8743; getspc_es (?elstl!Suc m) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d16</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;m. m &gt; 0 &#8743; Suc m &lt; length ?elstl 
                      &#10230; &#172;(getspc_es (?elstl!m) = EvtSys es &#8743; getspc_es (?elstl!Suc m) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d17</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;m. m &gt; (si + n) &#8743; m &lt; ti + n - 1 &#10230; 
                             &#172;(getspc_es (?esl!m) = EvtSys es &#8743; getspc_es (?esl!Suc m) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">                      </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">m</span><span class="">
</span><span class="">                      </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m &gt; (si + n) &#8743; m &lt; ti + n - 1&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m - (n+si) &gt; 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc (m - (n+si)) &lt; length ?elstl&quot;</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;m - (n + si) &lt; ti - si - 1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;Suc (m - (n + si)) &lt; ti - si&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d42</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172;(getspc_es (?elstl!(m-(n+si))) = EvtSys es 
                          &#8743; getspc_es (?elstl!Suc (m-(n+si))) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">d16</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;m - (n+si)&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">e2</span><span class=""> </span><span class="">d5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?esl!m = ?elstl!(m - (n+si))&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">drop_take_sametrace</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?elstl</span><span class=""> </span><span class="string">&quot;si+n&quot;</span><span class=""> </span><span class="string">&quot;ti+n&quot;</span><span class=""> </span><span class="var">?esl</span><span class=""> </span><span class="string">&quot;m - (n+si)&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">e2</span><span class=""> </span><span class="">d5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?esl!Suc m = ?elstl!Suc (m - (n+si))&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">drop_take_sametrace</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?elstl</span><span class=""> </span><span class="string">&quot;si+n&quot;</span><span class=""> </span><span class="string">&quot;ti+n&quot;</span><span class=""> </span><span class="var">?esl</span><span class=""> </span><span class="string">&quot;Suc (m - (n+si))&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172;(getspc_es (?esl!m) = EvtSys es &#8743; getspc_es (?esl!Suc m) &#8800; EvtSys es)&quot;</span><span class="">
</span><span class="">                        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d18</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;m. m &gt; (si + n) &#8743; m &lt; ti + n - 1 &#10230; 
                             &#172;(&#8707;e. ?esl!m -es-((EvtEnt e)&#9839;k)&#8594; ?esl!Suc m)&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">                      </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">m</span><span class="">
</span><span class="">                      </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;m &gt; (si + n) &#8743; m &lt; ti + n - 1&quot;</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d17</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172;(getspc_es (?esl!m) = EvtSys es &#8743; getspc_es (?esl!Suc m) &#8800; EvtSys es)&quot;</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">a8</span><span class=""> </span><span class="">a81</span><span class=""> </span><span class="">d41</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#172;(&#8707;e. ?esl!m -es-((EvtEnt e)&#9839;k)&#8594; ?esl!Suc m)&quot;</span><span class=""> 
</span><span class="">                        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">notentevt_in_conjoin_cpts</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">cs</span><span class=""> </span><span class="">m</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">es</span><span class="delimiter">]</span><span class=""> </span><span class="">evtsys_allevtseqorevtsys</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?esl</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">esll</span><span class="delimiter">]</span><span class="">
</span><span class="">                          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">                  
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d71</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;Suc (si + n) &lt; ti + n - 1&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Suc_eq_plus1</span><span class=""> </span><span class="">add.assoc</span><span class=""> </span><span class="">add_2_eq_Suc</span><span class=""> </span><span class="">add_diff_cancel_right&#39;</span><span class=""> </span><span class="">less_diff_conv</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">linarith</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d41</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;Suc (ti + n - 1) = length (cs k)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">calculation</span><span class=""> </span><span class="">d41</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">linarith</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d19</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="string">&quot;&#8704;m. m &gt; (si + n) &#8743; m &#8804; (ti + n - 1) &#10230; getx_es ((cs k)!m) k = ente&quot;</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtent_impl_curevt_in_cpts_es1</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">cs</span><span class=""> </span><span class="string">&quot;si + n&quot;</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">ente</span><span class=""> </span><span class="string">&quot;ti + n - 1&quot;</span><span class="delimiter">]</span><span class="">
</span><span class="">                       </span><span class="">d18</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="">d8</span><span class=""> </span><span class="">d41</span><span class=""> </span><span class="">d71</span><span class=""> </span><span class="">d72</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">d42</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;si + n + j &#8804; ti + n - 1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d19</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;si + n + j&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="">d01</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getx_es ((cs k)!(si + n + j)) k = ente&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d11</span><span class=""> </span><span class="">d5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getx_es ((cs k)!i) k = ente&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">drop_take_sametrace</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;the (evtrgfs (ei)) = (?RG ei)&quot;</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">all_evts_es_esys</span><span class=""> </span><span class="">d9</span><span class=""> </span><span class="">c13</span><span class=""> </span><span class="">c131</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Domain.cases</span><span class=""> </span><span class="">E<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span class=""> </span><span class="">prod.sel</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">snd_conv</span><span class=""> </span><span class="">someI_ex</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d9</span><span class=""> </span><span class="">c13</span><span class=""> </span><span class="">c131</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?Guar ei = Guar<span class="hidden">&#8681;</span><sub>f</sub> (?RG ei)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Guar<span class="hidden">&#8681;</span><sub>f</sub>_def</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">d15</span><span class=""> </span><span class="">d9</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &lt; length (cs k) &#8743; cs k ! i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc i &#10230;
               (gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k)))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;&#8704;c pes s x cs pre1 rely1 Pre Rely Guar Post k cmd.
          Pre k &#8838; prea &#8743; Rely k &#8838; relya &#8743; guara &#8838; Guar k &#8743; posta &#8838; Post k &#10230;
          c &#8712; cpts_of_pes pes s x &#8743; c &#8733; cs &#8743; c &#8712; assume_pes (pre1, rely1) &#10230;
          (&#8704;k. cs k &#8712; cpts_of_es (pes k) s x) &#10230;
          (&#8704;k. (cs k)&#8712;commit_es(Guar k, Post k)) &#10230;
          (&#8704;k. pre1 &#8838; Pre k) &#10230;
          (&#8704;k. rely1 &#8838; Rely k) &#10230;
          (&#8704;k j. j &#8800; k &#10230; Guar j &#8838; Rely k) &#10230;
          evtsys_spec (rgf_EvtSys esf) = EvtSys es &#8743; EvtSys es = getspc_es (cs k ! 0) &#10230;
          (&#8704;e&#8712;all_evts_es (rgf_EvtSys esf). is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> e)) &#10230;
          (&#8704;e&#8712;all_evts_es (rgf_EvtSys esf). the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> e)) = snd e) &#10230;
          (&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. c ! j -pes-actk&#8594; c ! Suc j)) &#10230;
          (&#8704;i. Suc i &lt; length (cs k) &#8743; cs k ! i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc i &#10230;
               (gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k))))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">prea</span><span class=""> </span><span class="">pre&#39;</span><span class=""> </span><span class="">relya</span><span class=""> </span><span class="">rely&#39;</span><span class=""> </span><span class="">guar&#39;</span><span class=""> </span><span class="">guara</span><span class=""> </span><span class="">post&#39;</span><span class=""> </span><span class="">posta</span><span class=""> </span><span class="">esys</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8866; (esspc::(&#39;l,&#39;k,&#39;s) rgformula_ess) sat<span class="hidden">&#8681;</span><sub>s</sub> [pre, rely, guar, post]&quot;</span><span class="">
</span><span class="">       </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;prea &#8838; pre&#39;&quot;</span><span class="">
</span><span class="">       </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;relya &#8838; rely&#39;&quot;</span><span class="">
</span><span class="">       </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;guar&#39; &#8838; guara&quot;</span><span class="">
</span><span class="">       </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;post&#39; &#8838; posta&quot;</span><span class="">
</span><span class="">       </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">p5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8866; esys sat<span class="hidden">&#8681;</span><sub>s</sub> [pre&#39;, rely&#39;, guar&#39;, post&#39;]&quot;</span><span class="">
</span><span class="">       </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">p6</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;c pes s x cs pre1 rely1 Pre Rely Guar Post k cmd.
          Pre k &#8838; pre&#39; &#8743; Rely k &#8838; rely&#39; &#8743; guar&#39; &#8838; Guar k &#8743; post&#39; &#8838; Post k &#10230;
          c &#8712; cpts_of_pes pes s x &#8743; c &#8733; cs &#8743; c &#8712; assume_pes (pre1, rely1) &#10230;
          (&#8704;k. cs k &#8712; cpts_of_es (pes k) s x) &#10230;
          (&#8704;k. (cs k)&#8712;commit_es(Guar k, Post k)) &#10230;
          (&#8704;k. pre1 &#8838; Pre k) &#10230;
          (&#8704;k. rely1 &#8838; Rely k) &#10230;
          (&#8704;k j. j &#8800; k &#10230; Guar j &#8838; Rely k) &#10230;
          evtsys_spec esys = EvtSys es &#8743; EvtSys es = getspc_es (cs k ! 0) &#10230;
          (&#8704;e&#8712;all_evts_es esys. is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> e)) &#10230;
          (&#8704;e&#8712;all_evts_es esys. the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> e)) = snd e) &#10230;
          (&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. c ! j -pes-actk&#8594; c ! Suc j)) &#10230;
          (&#8704;i. Suc i &lt; length (cs k) &#8743; cs k ! i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc i &#10230;
               (gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k))))&quot;</span><span class="">
</span><span class="">     </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">       </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">pes</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">cs</span><span class=""> </span><span class="">pre1</span><span class=""> </span><span class="">rely1</span><span class=""> </span><span class="">Pre</span><span class=""> </span><span class="">Rely</span><span class=""> </span><span class="">Guar</span><span class=""> </span><span class="">Post</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">cmd</span><span class="">
</span><span class="">       </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Pre k &#8838; prea &#8743; Rely k &#8838; relya &#8743; guara &#8838; Guar k &#8743; posta &#8838; Post k&quot;</span><span class="">
</span><span class="">         </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8712; cpts_of_pes pes s x &#8743; c &#8733; cs &#8743; c &#8712; assume_pes (pre1, rely1)&quot;</span><span class="">
</span><span class="">         </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;k. cs k &#8712; cpts_of_es (pes k) s x)&quot;</span><span class="">
</span><span class="">         </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. (cs k)&#8712;commit_es(Guar k, Post k)&quot;</span><span class="">
</span><span class="">         </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">a5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;k. pre1 &#8838; Pre k)&quot;</span><span class="">
</span><span class="">         </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">a6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;k. rely1 &#8838; Rely k)&quot;</span><span class="">
</span><span class="">         </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">a7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;k j. j &#8800; k &#10230; Guar j &#8838; Rely k)&quot;</span><span class="">
</span><span class="">         </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">a8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;evtsys_spec esys = EvtSys es &#8743; EvtSys es = getspc_es (cs k ! 0)&quot;</span><span class="">
</span><span class="">         </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">a9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;e&#8712;all_evts_es esys. is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> e))&quot;</span><span class="">
</span><span class="">         </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">a10</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;e&#8712;all_evts_es esys. the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> e)) = snd e)&quot;</span><span class="">
</span><span class="">         </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">a11</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. c ! j -pes-actk&#8594; c ! Suc j))&quot;</span><span class="">
</span><span class="">       </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;Pre k &#8838; pre&#39; &#8743; Rely k &#8838; rely&#39; &#8743; guar&#39; &#8838; Guar k &#8743; post&#39; &#8838; Post k&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">       </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">a5</span><span class=""> </span><span class="">a6</span><span class=""> </span><span class="">a7</span><span class=""> </span><span class="">a8</span><span class=""> </span><span class="">a9</span><span class=""> </span><span class="">a10</span><span class=""> </span><span class="">a11</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p6</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">Pre</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">Rely</span><span class=""> </span><span class="">Guar</span><span class=""> </span><span class="">Post</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">pes</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">cs</span><span class=""> </span><span class="">pre1</span><span class=""> </span><span class="">rely1</span><span class="delimiter">]</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &lt; length (cs k) &#8743; cs k ! i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc i &#10230;
               (gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k)))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="">     </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">     </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;&#8704;c pes s x cs pre1 rely1 Pre Rely Guar Post k cmd.
          Pre k &#8838; prea &#8743; Rely k &#8838; relya &#8743; guara &#8838; Guar k &#8743; posta &#8838; Post k &#10230;
          c &#8712; cpts_of_pes pes s x &#8743; c &#8733; cs &#8743; c &#8712; assume_pes (pre1, rely1) &#10230;
          (&#8704;k. cs k &#8712; cpts_of_es (pes k) s x) &#10230;
          (&#8704;k. (cs k)&#8712;commit_es(Guar k, Post k)) &#10230;
          (&#8704;k. pre1 &#8838; Pre k) &#10230;
          (&#8704;k. rely1 &#8838; Rely k) &#10230;
          (&#8704;k j. j &#8800; k &#10230; Guar j &#8838; Rely k) &#10230;
          evtsys_spec esys = EvtSys es &#8743; EvtSys es = getspc_es (cs k ! 0) &#10230;
          (&#8704;e&#8712;all_evts_es esys. is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> e)) &#10230;
          (&#8704;e&#8712;all_evts_es esys. the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> e)) = snd e) &#10230;
          (&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. c ! j -pes-actk&#8594; c ! Suc j)) &#10230;
          (&#8704;i. Suc i &lt; length (cs k) &#8743; cs k ! i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc i &#10230;
               (gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k))))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">     
</span><span class="">  </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">act_cpts_evtseq_sat_guar_curevt_fstseg_new2</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">   </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="">b51</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8866; (E<span class="hidden">&#8681;</span><sub>e</sub> ef) sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre<span class="hidden">&#8681;</span><sub>e</sub> ef, Rely<span class="hidden">&#8681;</span><sub>e</sub> ef, Guar<span class="hidden">&#8681;</span><sub>e</sub> ef, Post<span class="hidden">&#8681;</span><sub>e</sub> ef]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b52</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8866; (fst esf) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre<span class="hidden">&#8681;</span><sub>f</sub> (snd esf), Rely<span class="hidden">&#8681;</span><sub>f</sub> (snd esf), Guar<span class="hidden">&#8681;</span><sub>f</sub> (snd esf), Post<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;pre = Pre<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;post = Post<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rely &#8838; Rely<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rely &#8838; Rely<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b10</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Guar<span class="hidden">&#8681;</span><sub>e</sub> ef &#8838; guar&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b11</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Guar<span class="hidden">&#8681;</span><sub>f</sub> (snd esf) &#8838; guar&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b12</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Post<span class="hidden">&#8681;</span><sub>e</sub> ef &#8838; Pre<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Pre k &#8838; pre&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Rely k &#8838; rely&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;guar &#8838; Guar k&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;post &#8838; Post k&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c&#8712;cpts_of_pes pes s x&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8733; cs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c&#8712;assume_pes(pre1, rely1)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. (cs k) &#8712; cpts_of_es (pes k) s x&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p16</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. (cs k)&#8712;commit_es(Guar k, Post k)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. pre1 &#8838; Pre k&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p10</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. rely1 &#8838; Rely k&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k j. j &#8800; k &#10230; Guar j &#8838; Rely k&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;evtsys_spec (rgf_EvtSeq ef esf) = getspc_es (cs k ! 0) &#8743; 
                (&#8704;i. Suc i &#8804; length (cs k) &#10230; getspc_es ((cs k) ! i) &#8800; evtsys_spec (fst esf))&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;e&#8712;all_evts_es (rgf_EvtSeq ef esf). is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> e)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a01</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;e&#8712;all_evts_es (rgf_EvtSeq ef esf). the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> e)) = snd e&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. ((c ! j) -pes-actk&#8594; (c ! Suc j)))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2"><span class="keyword">shows</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &lt; length (cs k) &#8743; ((cs k ! i) -es-(Cmd cmd)&#9839;k&#8594; (cs k ! Suc i)) &#10230;
               (gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k)))&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p11</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. length (cs k) = length c&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class=""> </span><span class="">same_length_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p12</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. cs k &#8712; cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_of_es_def</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;c &#8800; Nil&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_es_not_empty</span><span class=""> </span><span class="">length_0_conv</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p13</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length c &gt; 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">    
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p16</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">p9</span><span class=""> </span><span class="">p10</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p14</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. (cs k) &#8712; assume_es(Pre k, Rely k)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">conjoin_comm_imp_rely</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">mono_tags</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esys</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;evtsys_spec (rgf_EvtSeq ef esf)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esl</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;cs k&quot;</span><span class="">
</span><span class="">      
</span><span class="">      </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length ?esl&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(?esl!i -es-((Cmd cmd)&#9839;k)&#8594; ?esl!(Suc i))&quot;</span><span class=""> 
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;e es ess. ?esys = EvtSeq e es &#8743; getspc_es (cs k ! 0) = EvtSeq e es&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsys_spec_evtseq</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">ef</span><span class=""> </span><span class="">esf</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">e</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">es</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esys = EvtSeq e es &#8743; getspc_es (cs k ! 0) = EvtSeq e es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">a6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl &#8712; cpts_es &#8743; ?esl!0 = (EvtSeq e es,s,x)&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_of_es_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;pes k&quot;</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class="delimiter">]</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">mono_tags</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">mem_Collect_eq</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">esl1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl = (EvtSeq e es,s,x)#esl1&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Suc_pred</span><span class=""> </span><span class="">length_Suc_conv</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">p13</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b17</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;E<span class="hidden">&#8681;</span><sub>e</sub> ef = e&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsys_spec_evtseq</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b18</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;evtsys_spec (fst esf) = es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsys_spec_evtsys</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b19</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;ef&#8712;all_evts_es (rgf_EvtSeq ef esf)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">all_evts_es_seq</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">ef</span><span class=""> </span><span class="">esf</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a5</span><span class=""> </span><span class="">b18</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &#8804; length ?esl &#10230; getspc_es (?esl ! i) &#8800; es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a8</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;el. (el &#8712; cpts_of_ev e s x &#8743; length ?esl = length el &#8743; e_eqv_einevtseq ?esl el es)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">evtseq_nfin_samelower</span><span class=""> </span><span class="">cpts_of_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">el</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; cpts_of_ev e s x &#8743; length ?esl = length el &#8743; e_eqv_einevtseq ?esl el es&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p14</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?esl &#8712; assume_es(Pre k, Rely k)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">b6</span><span class=""> </span><span class="">b8</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?esl &#8712; assume_es(Pre<span class="hidden">&#8681;</span><sub>e</sub> ef, Rely<span class="hidden">&#8681;</span><sub>e</sub> ef)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">assume_es_imp</span><span class=""> </span><span class="">equalityE</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; assume_e(Pre<span class="hidden">&#8681;</span><sub>e</sub> ef, Rely<span class="hidden">&#8681;</span><sub>e</sub> ef)&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">e_eqv_einevtseq_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?esl</span><span class=""> </span><span class="">el</span><span class=""> </span><span class="">es</span><span class="delimiter">]</span><span class=""> </span><span class="">assume_es_def</span><span class=""> </span><span class="">assume_e_def</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Suc_leI</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">eetran_eqconf1</span><span class=""> </span><span class="">eqconf_esetran</span><span class=""> </span><span class="">less_or_eq_imp_le</span><span class=""> 
</span><span class="">          </span><span class="">less_trans_Suc</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> </span><span class="">old.prod.case</span><span class=""> </span><span class="">zero_less_Suc</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b51</span><span class=""> </span><span class="">b17</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; commit_e(Guar<span class="hidden">&#8681;</span><sub>e</sub> ef, Post<span class="hidden">&#8681;</span><sub>e</sub> ef)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">Int_iff</span><span class=""> </span><span class="">contra_subsetD</span><span class=""> </span><span class="">evt_validity_def</span><span class=""> </span><span class="">rgsound_e</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (?esl ! i) = EvtSeq (getspc_e (el ! i)) es&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">e_eqv_einevtseq_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (?esl ! Suc i) = EvtSeq (getspc_e (el ! Suc i)) es&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">e_eqv_einevtseq_def</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (?esl ! i) &#8800; getspc_es (?esl ! Suc i)&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsys_not_eq_in_tran_aux</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">surjective_pairing</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_e (el ! i) &#8800; getspc_e (el ! Suc i)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;t. (el ! i) -et-t&#8594; (el ! Suc i)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_of_ev_def</span><span class=""> </span><span class="">notran_confeqi</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(gets_e (el!i), gets_e (el!Suc i))&#8712;Guar<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">a5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;evtsys_spec (rgf_EvtSeq ef esf) = pes k&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_of_es_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;pes k&quot;</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class="delimiter">]</span><span class=""> </span><span class="">getspc_es_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;cs k ! 0&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;all_evts_esspec (evtsys_spec (rgf_EvtSeq ef esf)). is_basicevt ef&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsys_spec_evtseq</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">ef</span><span class=""> </span><span class="">esf</span><span class="delimiter">]</span><span class=""> </span><span class="">all_evts_same</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;rgf_EvtSeq ef esf&quot;</span><span class="delimiter">]</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">DomainE</span><span class=""> </span><span class="">E<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span class=""> </span><span class="">prod.sel</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">a6</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;ie. ie &lt; i &#8743; (&#8707;e. (cs k)!ie -es-(EvtEnt e&#9839;k)&#8594; (cs k)!(Suc ie))
              &#8743; (&#8704;j. j &gt; ie &#8743; j &lt; i &#10230; &#172;(&#8707;e. (cs k)!j -es-(EvtEnt e&#9839;k)&#8594; (cs k)!(Suc j)))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cmd_impl_evtent_before_and_cmds</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">cs</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="string">&quot;evtsys_spec (rgf_EvtSeq ef esf)&quot;</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">ie</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">ev</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;ie &lt; i &#8743; ((cs k)!ie -es-(EvtEnt ev&#9839;k)&#8594; (cs k)!(Suc ie))
              &#8743; (&#8704;j. j &gt; ie &#8743; j &lt; i &#10230; &#172;(&#8707;e. (cs k)!j -es-(EvtEnt e&#9839;k)&#8594; (cs k)!(Suc j)))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;m. m &gt; ie &#8743; m &#8804; i &#10230; getx_es ((cs k)!m) k = ev&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtent_impl_curevt_in_cpts_es2</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">cs</span><span class=""> </span><span class="">ie</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">ev</span><span class=""> </span><span class="">i</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getx_es ((cs k)!i) k = ev&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      
</span><span class="">      </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;is_basicevt e&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b17</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">a8</span><span class=""> </span><span class="">a9</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. i &#8804; ie &#10230; getspc_es (?esl ! i) = EvtSeq e es&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtseq_evtent_befaft</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?esl</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">esl1</span><span class=""> </span><span class="">ie</span><span class="delimiter">]</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Suc_diff_1</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">Suc_less_eq</span><span class=""> </span><span class="">less_trans_Suc</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">p13</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;ev = e&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">evtent_is_basicevt_inevtseq2</span><span class=""> </span><span class="">leI</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">e_eqv_einevtseq_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?esl</span><span class=""> </span><span class="">el</span><span class=""> </span><span class="">es</span><span class="delimiter">]</span><span class=""> </span><span class="">Suc_leI</span><span class=""> </span><span class="">less_imp_le_nat</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a01</span><span class=""> </span><span class="">b17</span><span class=""> </span><span class="">b19</span><span class=""> </span><span class="">c7</span><span class=""> </span><span class="">c8</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k))) = Guar<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Guar<span class="hidden">&#8681;</span><sub>f</sub>_def</span><span class=""> </span><span class="">Guar<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">metis</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k)))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">act_cpts_evtseq_sat_guar_curevt_fstseg_new2_withlst</span><span class=""> </span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">   </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="">b51</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8866; (E<span class="hidden">&#8681;</span><sub>e</sub> ef) sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre<span class="hidden">&#8681;</span><sub>e</sub> ef, Rely<span class="hidden">&#8681;</span><sub>e</sub> ef, Guar<span class="hidden">&#8681;</span><sub>e</sub> ef, Post<span class="hidden">&#8681;</span><sub>e</sub> ef]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b52</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8866; (fst esf) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre<span class="hidden">&#8681;</span><sub>f</sub> (snd esf), Rely<span class="hidden">&#8681;</span><sub>f</sub> (snd esf), Guar<span class="hidden">&#8681;</span><sub>f</sub> (snd esf), Post<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;pre = Pre<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;post = Post<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rely &#8838; Rely<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rely &#8838; Rely<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b10</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Guar<span class="hidden">&#8681;</span><sub>e</sub> ef &#8838; guar&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b11</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Guar<span class="hidden">&#8681;</span><sub>f</sub> (snd esf) &#8838; guar&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b12</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Post<span class="hidden">&#8681;</span><sub>e</sub> ef &#8838; Pre<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Pre k &#8838; pre&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Rely k &#8838; rely&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;guar &#8838; Guar k&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;post &#8838; Post k&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c&#8712;cpts_of_pes pes s x&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8733; cs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c&#8712;assume_pes(pre1, rely1)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. (cs k) &#8712; cpts_of_es (pes k) s x&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p16</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. (cs k)&#8712;commit_es(Guar k, Post k)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. pre1 &#8838; Pre k&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p10</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. rely1 &#8838; Rely k&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k j. j &#8800; k &#10230; Guar j &#8838; Rely k&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;evtsys_spec (rgf_EvtSeq ef esf) = getspc_es (cs k ! 0) &#8743; 
                (&#8704;i. Suc i &lt; length (cs k) &#10230; getspc_es ((cs k) ! i) &#8800; evtsys_spec (fst esf)) &#8743;
                getspc_es(last (cs k)) = evtsys_spec (fst esf)&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;e&#8712;all_evts_es (rgf_EvtSeq ef esf). is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> e)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a01</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;e&#8712;all_evts_es (rgf_EvtSeq ef esf). the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> e)) = snd e&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. ((c ! j) -pes-actk&#8594; (c ! Suc j)))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2"><span class="keyword">shows</span></span><span class=""> </span><span class="string">&quot;(&#8704;i. Suc i &lt; length (cs k) &#8743; ((cs k ! i) -es-(Cmd cmd)&#9839;k&#8594; (cs k ! Suc i)) &#10230;
               (gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k))))&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p11</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. length (cs k) = length c&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class=""> </span><span class="">same_length_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p12</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. cs k &#8712; cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_of_es_def</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;c &#8800; Nil&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_es_not_empty</span><span class=""> </span><span class="">length_0_conv</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p13</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length c &gt; 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">    
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p16</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">p9</span><span class=""> </span><span class="">p10</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p14</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. (cs k) &#8712; assume_es(Pre k, Rely k)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">conjoin_comm_imp_rely</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">mono_tags</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esys</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;evtsys_spec (rgf_EvtSeq ef esf)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esl</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;cs k&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?n</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;length ?esl&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?eslh</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;take (?n - 1) ?esl&quot;</span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length ?esl&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(?esl!i -es-((Cmd cmd)&#9839;k)&#8594; ?esl!(Suc i))&quot;</span><span class=""> 
</span><span class="">
</span><span class="">      
</span><span class="">      
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;e es ess. ?esys = EvtSeq e es &#8743; getspc_es (cs k ! 0) = EvtSeq e es&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsys_spec_evtseq</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">ef</span><span class=""> </span><span class="">esf</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">e</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">es</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esys = EvtSeq e es &#8743; getspc_es (cs k ! 0) = EvtSeq e es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">a6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl &#8712; cpts_es &#8743; ?esl!0 = (EvtSeq e es,s,x)&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_of_es_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;pes k&quot;</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class="delimiter">]</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">mono_tags</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">mem_Collect_eq</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">esl1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl = (EvtSeq e es,s,x)#esl1&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Suc_pred</span><span class=""> </span><span class="">length_Suc_conv</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">p13</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a10</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?n &gt; 1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">linarith</span><span class=""> 
</span><span class="">        
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a8</span><span class=""> </span><span class="">a10</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a81</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?eslh &#8712; cpts_es&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_diff_Suc</span><span class=""> </span><span class="">butlast_conv_take</span><span class=""> </span><span class="">cpts_es_take</span><span class=""> </span><span class="">diff_less</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">p13</span><span class=""> </span><span class="">zero_less_Suc</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a10</span><span class=""> </span><span class="">a8</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a82</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?eslh!0 = (EvtSeq e es,s,x)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">nth_butlast</span><span class=""> </span><span class="">p11</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">esl2</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a83</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?eslh = (EvtSeq e es,s,x)#esl2&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Suc_diff_Suc</span><span class=""> </span><span class="">a10</span><span class=""> </span><span class="">a9</span><span class=""> </span><span class="">take_Suc_Cons</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b17</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;E<span class="hidden">&#8681;</span><sub>e</sub> ef = e&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsys_spec_evtseq</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b18</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;evtsys_spec (fst esf) = es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsys_spec_evtsys</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b19</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;ef&#8712;all_evts_es (rgf_EvtSeq ef esf)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">all_evts_es_seq</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">ef</span><span class=""> </span><span class="">esf</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a5</span><span class=""> </span><span class="">b18</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &#8804; length ?eslh &#10230; getspc_es (?eslh ! i) &#8800; es&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Suc_diff_1</span><span class=""> </span><span class="">Suc_le_lessD</span><span class=""> </span><span class="">Suc_less_eq</span><span class=""> </span><span class="">length_take</span><span class=""> </span><span class="">min.bounded_iff</span><span class=""> 
</span><span class="">          </span><span class="">nth_take</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">p13</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a81</span><span class=""> </span><span class="">a82</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;el. (el &#8712; cpts_of_ev e s x &#8743; length ?eslh = length el &#8743; e_eqv_einevtseq ?eslh el es)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtseq_nfin_samelower</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?eslh</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class="delimiter">]</span><span class=""> </span><span class="">cpts_of_es_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;EvtSeq e es&quot;</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">el</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; cpts_of_ev e s x &#8743; length ?eslh = length el &#8743; e_eqv_einevtseq ?eslh el es&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; cpts_ev&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_ev_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a5</span><span class=""> </span><span class="">b18</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;sn xn. last (cs k) = (es, sn, xn)&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">surj_pair</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">sn</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">xn</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;last (cs k) = (es, sn, xn)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?el1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;el @ [(AnonyEvent (None),sn, xn)]&quot;</span><span class="">
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c23</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length ?el1 = ?n&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a9</span><span class=""> </span><span class="">butlast_conv_take</span><span class=""> </span><span class="">diff_Suc_1</span><span class=""> </span><span class="">length_Cons</span><span class=""> </span><span class="">length_append_singleton</span><span class=""> </span><span class="">length_butlast</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (last ?eslh) = EvtSeq (getspc_e (last el)) es&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">e_eqv_einevtseq_def</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">,</span><span class=""> </span><span class="">of</span><span class=""> </span><span class="var">?eslh</span><span class=""> </span><span class="">el</span><span class=""> </span><span class="">es</span><span class="delimiter">]</span><span class=""> </span><span class="">a10</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_diff_Suc</span><span class=""> </span><span class="">butlast_conv_take</span><span class=""> </span><span class="">diff_Suc_1</span><span class=""> </span><span class="">diff_is_0_eq</span><span class=""> 
</span><span class="">            </span><span class="">last_conv_nth</span><span class=""> </span><span class="">length_butlast</span><span class=""> </span><span class="">length_greater_0_conv</span><span class=""> </span><span class="">not_le</span><span class=""> </span><span class="">order_refl</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">p13</span><span class=""> </span><span class="">take_eq_Nil</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;sn1 xn1. last ?eslh = (EvtSeq (getspc_e (last el)) es, sn1, xn1)&quot;</span><span class=""> 
</span><span class="">         </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">surj_pair</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">sn1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">xn1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">d4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;last ?eslh = (EvtSeq (getspc_e (last el)) es, sn1, xn1)&quot;</span><span class="">
</span><span class="">         </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d41</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;gets_e (last el) = sn1 &#8743; getx_e (last el) = xn1&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">e_eqv_einevtseq_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?eslh</span><span class=""> </span><span class="">el</span><span class=""> </span><span class="">es</span><span class="delimiter">]</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Suc_diff_Suc</span><span class=""> </span><span class="">a10</span><span class=""> </span><span class="">a9</span><span class=""> </span><span class="">diff_Suc_1</span><span class=""> </span><span class="">diff_is_0_eq</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">gets_es_def</span><span class=""> 
</span><span class="">            </span><span class="">getx_es_def</span><span class=""> </span><span class="">last_conv_nth</span><span class=""> </span><span class="">le_refl</span><span class=""> </span><span class="">length_0_conv</span><span class=""> </span><span class="">list.distinct</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">not_le</span><span class=""> </span><span class="">snd_conv</span><span class=""> </span><span class="">take_eq_Nil</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d42</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;last el = (getspc_e (last el), sn1, xn1)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">gets_e_def</span><span class=""> </span><span class="">getspc_e_def</span><span class=""> </span><span class="">getx_e_def</span><span class=""> </span><span class="">prod.collapse</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d51</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;last ?eslh = ?esl ! (?n - 2)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_1</span><span class=""> </span><span class="">Suc_diff_Suc</span><span class=""> </span><span class="">a10</span><span class=""> </span><span class="">butlast_conv_take</span><span class=""> 
</span><span class="">          </span><span class="">diff_Suc_eq_diff_pred</span><span class=""> </span><span class="">last_conv_nth</span><span class=""> </span><span class="">length_butlast</span><span class=""> </span><span class="">length_greater_0_conv</span><span class=""> 
</span><span class="">          </span><span class="">lessI</span><span class=""> </span><span class="">nth_butlast</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">p13</span><span class=""> </span><span class="">take_eq_Nil</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d52</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;last ?esl = ?esl ! (?n - 1)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">a9</span><span class=""> </span><span class="">last_conv_nth</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a8</span><span class=""> </span><span class="">a10</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;drop (?n-2) ?esl &#8712; cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_es_dropi2</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?esl</span><span class=""> </span><span class="string">&quot;?n - 2&quot;</span><span class="delimiter">]</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Suc_1</span><span class=""> </span><span class="">diff_Suc_less</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">p13</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">linarith</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="">d4</span><span class=""> </span><span class="">b18</span><span class=""> </span><span class="">d51</span><span class=""> </span><span class="">d52</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;est. ?esl ! (?n-2) -es-est&#8594; ?esl ! (?n-1)&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">exist_estran</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;EvtSeq (getspc_e (last el)) es&quot;</span><span class=""> </span><span class="">sn1</span><span class=""> </span><span class="">xn1</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="">sn</span><span class=""> </span><span class="">xn</span><span class=""> </span><span class="string">&quot;[]&quot;</span><span class="delimiter">]</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Cons_nth_drop_Suc</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_1</span><span class=""> </span><span class="">Suc_diff_Suc</span><span class=""> 
</span><span class="">            </span><span class="">a10</span><span class=""> </span><span class="">a5</span><span class=""> </span><span class="">d3</span><span class=""> </span><span class="">diff_Suc_less</span><span class=""> </span><span class="">exist_estran</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">p13</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">est</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;?esl ! (?n-2) -es-est&#8594; ?esl ! (?n-1)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="">d4</span><span class=""> </span><span class="">d51</span><span class=""> </span><span class="">d52</span><span class=""> </span><span class="">b18</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;t. (getspc_e (last el), sn1, xn1) -et-t&#8594;(AnonyEvent (None),sn, xn)&quot;</span><span class="">
</span><span class="">           </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtseq_tran_0_exist_etran</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;getspc_e (last el)&quot;</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="">sn1</span><span class=""> </span><span class="">xn1</span><span class=""> </span><span class="">est</span><span class=""> </span><span class="">sn</span><span class=""> </span><span class="">xn</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a10</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="">d41</span><span class=""> </span><span class="">d42</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d8</span><span class="delimiter">:</span><span class="string">&quot;?el1 &#8712; cpts_ev&quot;</span><span class=""> 
</span><span class="">         </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_ev_onemore</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">diff_is_0_eq</span><span class=""> </span><span class="">last_conv_nth</span><span class=""> </span><span class="">length_greater_0_conv</span><span class=""> </span><span class="">not_le</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">p13</span><span class=""> </span><span class="">take_eq_Nil</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d8</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el1 &#8712; cpts_of_ev e s x&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">a10</span><span class=""> </span><span class="">butlast_conv_take</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">cpts_of_ev_def</span><span class=""> 
</span><span class="">          </span><span class="">length_butlast</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> </span><span class="">nth_append</span><span class=""> </span><span class="">zero_less_diff</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                         
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p14</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?esl &#8712; assume_es(Pre k, Rely k)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">b6</span><span class=""> </span><span class="">b8</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?esl &#8712; assume_es(Pre<span class="hidden">&#8681;</span><sub>e</sub> ef, Rely<span class="hidden">&#8681;</span><sub>e</sub> ef)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">assume_es_imp</span><span class=""> </span><span class="">equalityE</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?eslh &#8712; assume_es(Pre<span class="hidden">&#8681;</span><sub>e</sub> ef, Rely<span class="hidden">&#8681;</span><sub>e</sub> ef)&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assume_es_take_n</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;?n-1&quot;</span><span class=""> </span><span class="var">?esl</span><span class=""> </span><span class="string">&quot;Pre<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class=""> </span><span class="string">&quot;Rely<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class="delimiter">]</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">a10</span><span class=""> </span><span class="">butlast_conv_take</span><span class=""> </span><span class="">diff_le_self</span><span class=""> </span><span class="">zero_less_diff</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c21</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; assume_e(Pre<span class="hidden">&#8681;</span><sub>e</sub> ef, Rely<span class="hidden">&#8681;</span><sub>e</sub> ef)&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">e_eqv_einevtseq_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?eslh</span><span class=""> </span><span class="">el</span><span class=""> </span><span class="">es</span><span class="delimiter">]</span><span class=""> </span><span class="">assume_es_def</span><span class=""> </span><span class="">assume_e_def</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Suc_leI</span><span class=""> </span><span class="">a10</span><span class=""> </span><span class="">diff_is_0_eq</span><span class=""> </span><span class="">eetran_eqconf1</span><span class=""> </span><span class="">eqconf_esetran</span><span class=""> </span><span class="">length_greater_0_conv</span><span class=""> 
</span><span class="">            </span><span class="">less_imp_le_nat</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> </span><span class="">not_le</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">p13</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">take_eq_Nil</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?el1 &#8712; assume_e(Pre<span class="hidden">&#8681;</span><sub>e</sub> ef, Rely<span class="hidden">&#8681;</span><sub>e</sub> ef)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_e (?el1!0) &#8712; Pre<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c21</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_e (el!0) &#8712; Pre<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">a10</span><span class=""> </span><span class="">butlast_conv_take</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">length_butlast</span><span class=""> </span><span class="">nth_append</span><span class=""> </span><span class="">zero_less_diff</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length ?el1 &#10230;  ?el1!i -ee&#8594; ?el1!(Suc i) &#10230; 
                (gets_e (?el1!i), gets_e (?el1!Suc i)) &#8712; Rely<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">              </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">              </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i&lt;length ?el1&quot;</span><span class="">
</span><span class="">                </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">e1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el1!i -ee&#8594; ?el1!(Suc i)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c21</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length el &#10230;  el!i -ee&#8594; el!(Suc i) &#10230; 
                (gets_e (el!i), gets_e (el!Suc i)) &#8712; Rely<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_e (?el1!i), gets_e (?el1!Suc i)) &#8712; Rely<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;Suc i &lt; length ?el1 - 1&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">f0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length ?el1 - 1&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">e2</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_diff_1</span><span class=""> 
</span><span class="">                      </span><span class="">Suc_less_eq</span><span class=""> </span><span class="">Suc_mono</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">length_append_singleton</span><span class=""> </span><span class="">nth_append</span><span class=""> </span><span class="">zero_less_Suc</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                  </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;&#172; (Suc i &lt; length ?el1 - 1)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &#8805; length ?el1 - 1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i = length ?el1 - 1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el1!(Suc i) = (AnonyEvent None, sn, xn)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el1!i = (getspc_e (last el), sn1, xn1)&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">a10</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">d42</span><span class=""> </span><span class="">diff_Suc_1</span><span class=""> </span><span class="">diff_is_0_eq</span><span class=""> 
</span><span class="">                      </span><span class="">last_conv_nth</span><span class=""> </span><span class="">length_append_singleton</span><span class=""> </span><span class="">length_greater_0_conv</span><span class=""> 
</span><span class="">                      </span><span class="">lessI</span><span class=""> </span><span class="">not_le</span><span class=""> </span><span class="">nth_append</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">p13</span><span class=""> </span><span class="">take_eq_Nil</span><span class="delimiter">)</span><span class="">
</span><span class="">                  
</span><span class="">                  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d7</span><span class=""> </span><span class="">f2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_e (?el1!i) &#8800; getspc_e (?el1!(Suc i))&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evt_not_eq_in_tran_aux</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">eetran.cases</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_e (?el1!i) = getspc_e (?el1!(Suc i))&quot;</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">eetran_eqconf1</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">            
</span><span class="">          </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">     
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d9</span><span class=""> </span><span class="">b51</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d10</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el1 &#8712; commit_e(Guar<span class="hidden">&#8681;</span><sub>e</sub> ef, Post<span class="hidden">&#8681;</span><sub>e</sub> ef)&quot;</span><span class=""> 
</span><span class="">         </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evt_validity_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;E<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class=""> </span><span class="string">&quot;Pre<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class=""> </span><span class="string">&quot;Rely<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class=""> </span><span class="string">&quot;Guar<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class=""> </span><span class="string">&quot;Post<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class="delimiter">]</span><span class="">
</span><span class="">          </span><span class="">Int_iff</span><span class=""> </span><span class="">b17</span><span class=""> </span><span class="">contra_subsetD</span><span class=""> </span><span class="">rgsound_e</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">      
</span><span class="">      </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_e (last ?el1) = AnonyEvent None&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_e_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;last ?el1&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_e (last ?el1) = sn&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">gets_e_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;last ?el1&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;sn&#8712;Post<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">d10</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d101</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;gets_es (last (cs k)) &#8712; Post<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">gets_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;all_evts_esspec (evtsys_spec (rgf_EvtSeq ef esf)). is_basicevt ef&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsys_spec_evtseq</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">ef</span><span class=""> </span><span class="">esf</span><span class="delimiter">]</span><span class=""> </span><span class="">all_evts_same</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;rgf_EvtSeq ef esf&quot;</span><span class="delimiter">]</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">DomainE</span><span class=""> </span><span class="">E<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span class=""> </span><span class="">prod.sel</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">a6</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="">a8</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;ie. ie &lt; i &#8743; (&#8707;e. (cs k)!ie -es-(EvtEnt e&#9839;k)&#8594; (cs k)!(Suc ie))
              &#8743; (&#8704;j. j &gt; ie &#8743; j &lt; i &#10230; &#172;(&#8707;e. (cs k)!j -es-(EvtEnt e&#9839;k)&#8594; (cs k)!(Suc j)))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cmd_impl_evtent_before_and_cmds</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">cs</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="string">&quot;evtsys_spec (rgf_EvtSeq ef esf)&quot;</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class="delimiter">]</span><span class=""> 
</span><span class="">          </span><span class="">cpts_of_es_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;EvtSeq e es&quot;</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">ie</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">ev</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;ie &lt; i &#8743; ((cs k)!ie -es-(EvtEnt ev&#9839;k)&#8594; (cs k)!(Suc ie))
              &#8743; (&#8704;j. j &gt; ie &#8743; j &lt; i &#10230; &#172;(&#8707;e. (cs k)!j -es-(EvtEnt e&#9839;k)&#8594; (cs k)!(Suc j)))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;m. m &gt; ie &#8743; m &#8804; i &#10230; getx_es ((cs k)!m) k = ev&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtent_impl_curevt_in_cpts_es2</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">cs</span><span class=""> </span><span class="">ie</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">ev</span><span class=""> </span><span class="">i</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getx_es ((cs k)!i) k = ev&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;ie &lt; i &#8743; (?eslh!ie -es-(EvtEnt ev&#9839;k)&#8594; ?eslh!(Suc ie))
              &#8743; (&#8704;j. j &gt; ie &#8743; j &lt; i &#10230; &#172;(&#8707;e. ?eslh!j -es-(EvtEnt e&#9839;k)&#8594; ?eslh!(Suc j)))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">a81</span><span class=""> </span><span class="">a82</span><span class=""> </span><span class="">a83</span><span class=""> </span><span class="">c8</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. i &#8804; ie &#10230; getspc_es (?eslh ! i) = EvtSeq e es&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtseq_evtent_befaft</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?eslh</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">esl2</span><span class=""> </span><span class="">ie</span><span class="delimiter">]</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Suc_diff_1</span><span class=""> </span><span class="">Suc_diff_Suc</span><span class=""> </span><span class="">Suc_less_eq</span><span class=""> </span><span class="">a10</span><span class=""> </span><span class="">butlast_conv_take</span><span class=""> 
</span><span class="">            </span><span class="">diff_Suc_eq_diff_pred</span><span class=""> </span><span class="">length_butlast</span><span class=""> </span><span class="">less_trans_Suc</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">p13</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c8</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c10</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;ev = e&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">evtent_is_basicevt_inevtseq2</span><span class=""> </span><span class="">order_refl</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c11</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k))) = Guar<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Guar<span class="hidden">&#8681;</span><sub>f</sub>_def</span><span class=""> </span><span class="">Guar<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">a01</span><span class=""> </span><span class="">b17</span><span class=""> </span><span class="">b19</span><span class=""> </span><span class="">c10</span><span class=""> </span><span class="">c7</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k)))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;Suc i &lt; ?n - 1&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; ?n - 1&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (?eslh ! i) = EvtSeq (getspc_e (el ! i)) es&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">e_eqv_einevtseq_def</span><span class=""> </span><span class="">length_take</span><span class=""> </span><span class="">less_imp_le_nat</span><span class=""> </span><span class="">min.bounded_iff</span><span class="delimiter">)</span><span class="">  
</span><span class="">           
</span><span class="">          </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (?eslh ! Suc i) = EvtSeq (getspc_e (el ! Suc i)) es&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Suc_leI</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">e_eqv_einevtseq_def</span><span class=""> </span><span class="">length_take</span><span class=""> </span><span class="">min.bounded_iff</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    
</span><span class="">          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (?eslh ! i) &#8800; getspc_es (?eslh ! Suc i)&quot;</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">evtsys_not_eq_in_tran_aux1</span><span class=""> </span><span class="">nth_take</span><span class="delimiter">)</span><span class="">  
</span><span class="">    
</span><span class="">          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">e2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_e (el ! i) &#8800; getspc_e (el ! Suc i)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;t. (el ! i) -et-t&#8594; (el ! Suc i)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_of_ev_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class="delimiter">]</span><span class=""> </span><span class="">notran_confeqi</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">el</span><span class=""> </span><span class="">i</span><span class="delimiter">]</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">length_take</span><span class=""> </span><span class="">less_eq_Suc_le</span><span class=""> </span><span class="">min.bounded_iff</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">    
</span><span class="">          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length ?el1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">c23</span><span class=""> </span><span class="">e4</span><span class=""> </span><span class="">e5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;t. ?el1 ! i -et-t&#8594; ?el1 ! Suc i&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">butlast_snoc</span><span class=""> </span><span class="">length_butlast</span><span class=""> </span><span class="">nth_append</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(gets_e (?el1!i), gets_e (?el1!Suc i))&#8712;Guar<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">d10</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_es (?eslh ! i), gets_es (?eslh ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">e_eqv_einevtseq_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?eslh</span><span class=""> </span><span class="">el</span><span class=""> </span><span class="">es</span><span class="delimiter">]</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_leI</span><span class=""> </span><span class="">Suc_lessE</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c23</span><span class=""> </span><span class="">diff_Suc_1</span><span class=""> 
</span><span class="">                </span><span class="">e0</span><span class=""> </span><span class="">length_append_singleton</span><span class=""> </span><span class="">nth_append</span><span class="delimiter">)</span><span class="">  
</span><span class="">          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c11</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">nth_take</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;&#172; (Suc i &lt; ?n - 1)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i = ?n - 1&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Suc_pred&#39;</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">less_antisym</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">p13</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">linarith</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length ?el1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">c23</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">linarith</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;t. (?el1 ! i) -et-t&#8594;(?el1 ! Suc i)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i = length (butlast (el @ [(AnonyEvent None, sn, xn)]))&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">c23</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">length_butlast</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length el = length (cs k) - 1&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">c23</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(el @ [(AnonyEvent None, sn, xn)]) ! i = el ! i&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">nth_append</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(el @ [(AnonyEvent None, sn, xn)]) ! i = last el&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">f2</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">a83</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">diff_Suc_1</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">last_conv_nth</span><span class=""> </span><span class="">length_greater_0_conv</span><span class=""> </span><span class="">list.simps</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="">d42</span><span class=""> </span><span class="">d7</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">qed</span></span><span class=""> 
</span><span class="">          
</span><span class="">          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d10</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_e (?el1 ! i), gets_e (?el1 ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">c23</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?el1 !i = last el&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">a10</span><span class=""> </span><span class="">butlast_snoc</span><span class=""> </span><span class="">diff_Suc_1</span><span class=""> </span><span class="">diff_is_0_eq</span><span class=""> 
</span><span class="">              </span><span class="">last_conv_nth</span><span class=""> </span><span class="">length_0_conv</span><span class=""> </span><span class="">length_butlast</span><span class=""> </span><span class="">lessI</span><span class=""> </span><span class="">not_le</span><span class=""> </span><span class="">nth_append</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">c23</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?el1 ! Suc i = (AnonyEvent None, sn, xn)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">butlast_snoc</span><span class=""> </span><span class="">length_butlast</span><span class=""> </span><span class="">nth_append_length</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(sn1,sn)&#8712;Guar<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">d42</span><span class=""> </span><span class="">gets_e_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;(getspc_e (last el), sn1, xn1)&quot;</span><span class="delimiter">]</span><span class="">
</span><span class="">            </span><span class="">gets_e_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;(AnonyEvent None, sn, xn)&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">snd_conv</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="">d52</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_es (cs k ! Suc i) = sn&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">gets_es_def</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">snd_conv</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">d42</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_es (cs k ! i) = sn1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">e_eqv_einevtseq_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?eslh</span><span class=""> </span><span class="">el</span><span class=""> </span><span class="">es</span><span class="delimiter">]</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Suc_1</span><span class=""> </span><span class="">d4</span><span class=""> </span><span class="">d51</span><span class=""> </span><span class="">diff_Suc_1</span><span class=""> </span><span class="">diff_Suc_eq_diff_pred</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">snd_conv</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">c11</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">act_cpts_evtseq_sat_guar_curevt_fstseg_new2_withlst_pst</span><span class=""> </span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="">
</span><span class="">   </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="">b51</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8866; (E<span class="hidden">&#8681;</span><sub>e</sub> ef) sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre<span class="hidden">&#8681;</span><sub>e</sub> ef, Rely<span class="hidden">&#8681;</span><sub>e</sub> ef, Guar<span class="hidden">&#8681;</span><sub>e</sub> ef, Post<span class="hidden">&#8681;</span><sub>e</sub> ef]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b52</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8866; (fst esf) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre<span class="hidden">&#8681;</span><sub>f</sub> (snd esf), Rely<span class="hidden">&#8681;</span><sub>f</sub> (snd esf), Guar<span class="hidden">&#8681;</span><sub>f</sub> (snd esf), Post<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;pre = Pre<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;post = Post<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rely &#8838; Rely<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;rely &#8838; Rely<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b10</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Guar<span class="hidden">&#8681;</span><sub>e</sub> ef &#8838; guar&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b11</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Guar<span class="hidden">&#8681;</span><sub>f</sub> (snd esf) &#8838; guar&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b12</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Post<span class="hidden">&#8681;</span><sub>e</sub> ef &#8838; Pre<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Pre k &#8838; pre&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Rely k &#8838; rely&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;guar &#8838; Guar k&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;post &#8838; Post k&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c&#8712;cpts_of_pes pes s x&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8733; cs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c&#8712;assume_pes(pre1, rely1)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. (cs k) &#8712; cpts_of_es (pes k) s x&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p16</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. (cs k)&#8712;commit_es(Guar k, Post k)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. pre1 &#8838; Pre k&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p10</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. rely1 &#8838; Rely k&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k j. j &#8800; k &#10230; Guar j &#8838; Rely k&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;evtsys_spec (rgf_EvtSeq ef esf) = getspc_es (cs k ! 0) &#8743; 
                (&#8704;i. Suc i &lt; length (cs k) &#10230; getspc_es ((cs k) ! i) &#8800; evtsys_spec (fst esf)) &#8743;
                getspc_es(last (cs k)) = evtsys_spec (fst esf)&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;e&#8712;all_evts_es (rgf_EvtSeq ef esf). is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> e)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a01</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;e&#8712;all_evts_es (rgf_EvtSeq ef esf). the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> e)) = snd e&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. ((c ! j) -pes-actk&#8594; (c ! Suc j)))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2"><span class="keyword">shows</span></span><span class=""> </span><span class="string">&quot;(&#8704;i. Suc i &lt; length (cs k) &#8743; ((cs k ! i) -es-(Cmd cmd)&#9839;k&#8594; (cs k ! Suc i)) &#10230;
               (gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k))))
            &#8743; gets_es (last (cs k))&#8712;Post<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p11</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. length (cs k) = length c&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class=""> </span><span class="">same_length_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p12</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. cs k &#8712; cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_of_es_def</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;c &#8800; Nil&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_es_not_empty</span><span class=""> </span><span class="">length_0_conv</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p13</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length c &gt; 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esys</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;evtsys_spec (rgf_EvtSeq ef esf)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esl</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;cs k&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?n</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;length ?esl&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?eslh</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;take (?n - 1) ?esl&quot;</span><span class="">
</span><span class="">    
</span><span class="">    
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;e es ess. ?esys = EvtSeq e es &#8743; getspc_es (cs k ! 0) = EvtSeq e es&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsys_spec_evtseq</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">ef</span><span class=""> </span><span class="">esf</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">e</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">es</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esys = EvtSeq e es &#8743; getspc_es (cs k ! 0) = EvtSeq e es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b17</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;E<span class="hidden">&#8681;</span><sub>e</sub> ef = e&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsys_spec_evtseq</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b18</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;evtsys_spec (fst esf) = es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsys_spec_evtsys</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">a6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl &#8712; cpts_es &#8743; ?esl!0 = (EvtSeq e es,s,x)&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_of_es_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;pes k&quot;</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class="delimiter">]</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">mono_tags</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">mem_Collect_eq</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">esl1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl = (EvtSeq e es,s,x)#esl1&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Suc_pred</span><span class=""> </span><span class="">length_Suc_conv</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">p13</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a5</span><span class=""> </span><span class="">a6</span><span class=""> </span><span class="">b18</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a10</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?n &gt; 1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtseq_ne_es</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a9</span><span class=""> </span><span class="">diff_is_0_eq</span><span class=""> </span><span class="">last_conv_nth</span><span class=""> </span><span class="">leI</span><span class=""> </span><span class="">list.simps</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class=""> 
</span><span class="">      
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a8</span><span class=""> </span><span class="">a10</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a81</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?eslh &#8712; cpts_es&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_diff_Suc</span><span class=""> </span><span class="">butlast_conv_take</span><span class=""> </span><span class="">cpts_es_take</span><span class=""> </span><span class="">diff_less</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">p13</span><span class=""> </span><span class="">zero_less_Suc</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a10</span><span class=""> </span><span class="">a8</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a82</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?eslh!0 = (EvtSeq e es,s,x)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">nth_butlast</span><span class=""> </span><span class="">p11</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">esl2</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a83</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?eslh = (EvtSeq e es,s,x)#esl2&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Suc_diff_Suc</span><span class=""> </span><span class="">a10</span><span class=""> </span><span class="">a9</span><span class=""> </span><span class="">take_Suc_Cons</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p16</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">p9</span><span class=""> </span><span class="">p10</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p14</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. (cs k) &#8712; assume_es(Pre k, Rely k)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">conjoin_comm_imp_rely</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">mono_tags</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b19</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;ef&#8712;all_evts_es (rgf_EvtSeq ef esf)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">all_evts_es_seq</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">ef</span><span class=""> </span><span class="">esf</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a5</span><span class=""> </span><span class="">b18</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &#8804; length ?eslh &#10230; getspc_es (?eslh ! i) &#8800; es&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Suc_diff_1</span><span class=""> </span><span class="">Suc_le_lessD</span><span class=""> </span><span class="">Suc_less_eq</span><span class=""> </span><span class="">length_take</span><span class=""> </span><span class="">min.bounded_iff</span><span class=""> 
</span><span class="">          </span><span class="">nth_take</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">p13</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a81</span><span class=""> </span><span class="">a82</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;el. (el &#8712; cpts_of_ev e s x &#8743; length ?eslh = length el &#8743; e_eqv_einevtseq ?eslh el es)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtseq_nfin_samelower</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?eslh</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class="delimiter">]</span><span class=""> </span><span class="">cpts_of_es_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;EvtSeq e es&quot;</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">el</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; cpts_of_ev e s x &#8743; length ?eslh = length el &#8743; e_eqv_einevtseq ?eslh el es&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; cpts_ev&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_ev_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a5</span><span class=""> </span><span class="">b18</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;sn xn. last (cs k) = (es, sn, xn)&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">surj_pair</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">sn</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">xn</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;last (cs k) = (es, sn, xn)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?el1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;el @ [(AnonyEvent (None),sn, xn)]&quot;</span><span class="">
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c23</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length ?el1 = ?n&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a9</span><span class=""> </span><span class="">butlast_conv_take</span><span class=""> </span><span class="">diff_Suc_1</span><span class=""> </span><span class="">length_Cons</span><span class=""> </span><span class="">length_append_singleton</span><span class=""> </span><span class="">length_butlast</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (last ?eslh) = EvtSeq (getspc_e (last el)) es&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">e_eqv_einevtseq_def</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">,</span><span class=""> </span><span class="">of</span><span class=""> </span><span class="var">?eslh</span><span class=""> </span><span class="">el</span><span class=""> </span><span class="">es</span><span class="delimiter">]</span><span class=""> </span><span class="">a10</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_diff_Suc</span><span class=""> </span><span class="">butlast_conv_take</span><span class=""> </span><span class="">diff_Suc_1</span><span class=""> </span><span class="">diff_is_0_eq</span><span class=""> 
</span><span class="">            </span><span class="">last_conv_nth</span><span class=""> </span><span class="">length_butlast</span><span class=""> </span><span class="">length_greater_0_conv</span><span class=""> </span><span class="">not_le</span><span class=""> </span><span class="">order_refl</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">p13</span><span class=""> </span><span class="">take_eq_Nil</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;sn1 xn1. last ?eslh = (EvtSeq (getspc_e (last el)) es, sn1, xn1)&quot;</span><span class=""> 
</span><span class="">         </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">surj_pair</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">sn1</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">xn1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">d4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;last ?eslh = (EvtSeq (getspc_e (last el)) es, sn1, xn1)&quot;</span><span class="">
</span><span class="">         </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d41</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;gets_e (last el) = sn1 &#8743; getx_e (last el) = xn1&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">e_eqv_einevtseq_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?eslh</span><span class=""> </span><span class="">el</span><span class=""> </span><span class="">es</span><span class="delimiter">]</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Suc_diff_Suc</span><span class=""> </span><span class="">a10</span><span class=""> </span><span class="">a9</span><span class=""> </span><span class="">diff_Suc_1</span><span class=""> </span><span class="">diff_is_0_eq</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">gets_es_def</span><span class=""> 
</span><span class="">            </span><span class="">getx_es_def</span><span class=""> </span><span class="">last_conv_nth</span><span class=""> </span><span class="">le_refl</span><span class=""> </span><span class="">length_0_conv</span><span class=""> </span><span class="">list.distinct</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class=""> </span><span class="">not_le</span><span class=""> </span><span class="">snd_conv</span><span class=""> </span><span class="">take_eq_Nil</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d42</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;last el = (getspc_e (last el), sn1, xn1)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">gets_e_def</span><span class=""> </span><span class="">getspc_e_def</span><span class=""> </span><span class="">getx_e_def</span><span class=""> </span><span class="">prod.collapse</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d51</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;last ?eslh = ?esl ! (?n - 2)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_1</span><span class=""> </span><span class="">Suc_diff_Suc</span><span class=""> </span><span class="">a10</span><span class=""> </span><span class="">butlast_conv_take</span><span class=""> 
</span><span class="">          </span><span class="">diff_Suc_eq_diff_pred</span><span class=""> </span><span class="">last_conv_nth</span><span class=""> </span><span class="">length_butlast</span><span class=""> </span><span class="">length_greater_0_conv</span><span class=""> 
</span><span class="">          </span><span class="">lessI</span><span class=""> </span><span class="">nth_butlast</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">p13</span><span class=""> </span><span class="">take_eq_Nil</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d52</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;last ?esl = ?esl ! (?n - 1)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">a9</span><span class=""> </span><span class="">last_conv_nth</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a8</span><span class=""> </span><span class="">a10</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;drop (?n-2) ?esl &#8712; cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_es_dropi2</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?esl</span><span class=""> </span><span class="string">&quot;?n - 2&quot;</span><span class="delimiter">]</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Suc_1</span><span class=""> </span><span class="">diff_Suc_less</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">p13</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">linarith</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="">d4</span><span class=""> </span><span class="">b18</span><span class=""> </span><span class="">d51</span><span class=""> </span><span class="">d52</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;est. ?esl ! (?n-2) -es-est&#8594; ?esl ! (?n-1)&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">exist_estran</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;EvtSeq (getspc_e (last el)) es&quot;</span><span class=""> </span><span class="">sn1</span><span class=""> </span><span class="">xn1</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="">sn</span><span class=""> </span><span class="">xn</span><span class=""> </span><span class="string">&quot;[]&quot;</span><span class="delimiter">]</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Cons_nth_drop_Suc</span><span class=""> </span><span class="">One_nat_def</span><span class=""> </span><span class="">Suc_1</span><span class=""> </span><span class="">Suc_diff_Suc</span><span class=""> 
</span><span class="">            </span><span class="">a10</span><span class=""> </span><span class="">a5</span><span class=""> </span><span class="">d3</span><span class=""> </span><span class="">diff_Suc_less</span><span class=""> </span><span class="">exist_estran</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">p13</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">est</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="string">&quot;?esl ! (?n-2) -es-est&#8594; ?esl ! (?n-1)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="">d4</span><span class=""> </span><span class="">d51</span><span class=""> </span><span class="">d52</span><span class=""> </span><span class="">b18</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;t. (getspc_e (last el), sn1, xn1) -et-t&#8594;(AnonyEvent (None),sn, xn)&quot;</span><span class="">
</span><span class="">           </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtseq_tran_0_exist_etran</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;getspc_e (last el)&quot;</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="">sn1</span><span class=""> </span><span class="">xn1</span><span class=""> </span><span class="">est</span><span class=""> </span><span class="">sn</span><span class=""> </span><span class="">xn</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a10</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="">d41</span><span class=""> </span><span class="">d42</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d8</span><span class="delimiter">:</span><span class="string">&quot;?el1 &#8712; cpts_ev&quot;</span><span class=""> 
</span><span class="">         </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_ev_onemore</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">diff_is_0_eq</span><span class=""> </span><span class="">last_conv_nth</span><span class=""> </span><span class="">length_greater_0_conv</span><span class=""> </span><span class="">not_le</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">p13</span><span class=""> </span><span class="">take_eq_Nil</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d8</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el1 &#8712; cpts_of_ev e s x&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">a10</span><span class=""> </span><span class="">butlast_conv_take</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">cpts_of_ev_def</span><span class=""> 
</span><span class="">          </span><span class="">length_butlast</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> </span><span class="">nth_append</span><span class=""> </span><span class="">zero_less_diff</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                         
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p14</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?esl &#8712; assume_es(Pre k, Rely k)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">b6</span><span class=""> </span><span class="">b8</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?esl &#8712; assume_es(Pre<span class="hidden">&#8681;</span><sub>e</sub> ef, Rely<span class="hidden">&#8681;</span><sub>e</sub> ef)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">assume_es_imp</span><span class=""> </span><span class="">equalityE</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?eslh &#8712; assume_es(Pre<span class="hidden">&#8681;</span><sub>e</sub> ef, Rely<span class="hidden">&#8681;</span><sub>e</sub> ef)&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assume_es_take_n</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;?n-1&quot;</span><span class=""> </span><span class="var">?esl</span><span class=""> </span><span class="string">&quot;Pre<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class=""> </span><span class="string">&quot;Rely<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class="delimiter">]</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">a10</span><span class=""> </span><span class="">butlast_conv_take</span><span class=""> </span><span class="">diff_le_self</span><span class=""> </span><span class="">zero_less_diff</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c21</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;el &#8712; assume_e(Pre<span class="hidden">&#8681;</span><sub>e</sub> ef, Rely<span class="hidden">&#8681;</span><sub>e</sub> ef)&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">e_eqv_einevtseq_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?eslh</span><span class=""> </span><span class="">el</span><span class=""> </span><span class="">es</span><span class="delimiter">]</span><span class=""> </span><span class="">assume_es_def</span><span class=""> </span><span class="">assume_e_def</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Suc_leI</span><span class=""> </span><span class="">a10</span><span class=""> </span><span class="">diff_is_0_eq</span><span class=""> </span><span class="">eetran_eqconf1</span><span class=""> </span><span class="">eqconf_esetran</span><span class=""> </span><span class="">length_greater_0_conv</span><span class=""> 
</span><span class="">            </span><span class="">less_imp_le_nat</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> </span><span class="">not_le</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">p13</span><span class=""> </span><span class="">prod.simps</span><span class="delimiter">(</span><span class="">2</span><span class="delimiter">)</span><span class=""> </span><span class="">take_eq_Nil</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?el1 &#8712; assume_e(Pre<span class="hidden">&#8681;</span><sub>e</sub> ef, Rely<span class="hidden">&#8681;</span><sub>e</sub> ef)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_e (?el1!0) &#8712; Pre<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c21</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_e (el!0) &#8712; Pre<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">a10</span><span class=""> </span><span class="">butlast_conv_take</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">length_butlast</span><span class=""> </span><span class="">nth_append</span><span class=""> </span><span class="">zero_less_diff</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length ?el1 &#10230;  ?el1!i -ee&#8594; ?el1!(Suc i) &#10230; 
                (gets_e (?el1!i), gets_e (?el1!Suc i)) &#8712; Rely<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">              </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">              </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i&lt;length ?el1&quot;</span><span class="">
</span><span class="">                </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">e1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el1!i -ee&#8594; ?el1!(Suc i)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c21</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i&lt;length el &#10230;  el!i -ee&#8594; el!(Suc i) &#10230; 
                (gets_e (el!i), gets_e (el!Suc i)) &#8712; Rely<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_e (?el1!i), gets_e (?el1!Suc i)) &#8712; Rely<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;Suc i &lt; length ?el1 - 1&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">f0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length ?el1 - 1&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">e2</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_diff_1</span><span class=""> 
</span><span class="">                      </span><span class="">Suc_less_eq</span><span class=""> </span><span class="">Suc_mono</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">length_append_singleton</span><span class=""> </span><span class="">nth_append</span><span class=""> </span><span class="">zero_less_Suc</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">                  </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;&#172; (Suc i &lt; length ?el1 - 1)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &#8805; length ?el1 - 1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i = length ?el1 - 1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el1!(Suc i) = (AnonyEvent None, sn, xn)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el1!i = (getspc_e (last el), sn1, xn1)&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">a10</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">d42</span><span class=""> </span><span class="">diff_Suc_1</span><span class=""> </span><span class="">diff_is_0_eq</span><span class=""> 
</span><span class="">                      </span><span class="">last_conv_nth</span><span class=""> </span><span class="">length_append_singleton</span><span class=""> </span><span class="">length_greater_0_conv</span><span class=""> 
</span><span class="">                      </span><span class="">lessI</span><span class=""> </span><span class="">not_le</span><span class=""> </span><span class="">nth_append</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">p13</span><span class=""> </span><span class="">take_eq_Nil</span><span class="delimiter">)</span><span class="">
</span><span class="">                  
</span><span class="">                  </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d7</span><span class=""> </span><span class="">f2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_e (?el1!i) &#8800; getspc_e (?el1!(Suc i))&quot;</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evt_not_eq_in_tran_aux</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">eetran.cases</span><span class="delimiter">)</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_e (?el1!i) = getspc_e (?el1!(Suc i))&quot;</span><span class=""> 
</span><span class="">                    </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">eetran_eqconf1</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">            
</span><span class="">          </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">     
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d9</span><span class=""> </span><span class="">b51</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d10</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?el1 &#8712; commit_e(Guar<span class="hidden">&#8681;</span><sub>e</sub> ef, Post<span class="hidden">&#8681;</span><sub>e</sub> ef)&quot;</span><span class=""> 
</span><span class="">         </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evt_validity_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;E<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class=""> </span><span class="string">&quot;Pre<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class=""> </span><span class="string">&quot;Rely<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class=""> </span><span class="string">&quot;Guar<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class=""> </span><span class="string">&quot;Post<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class="delimiter">]</span><span class="">
</span><span class="">          </span><span class="">Int_iff</span><span class=""> </span><span class="">b17</span><span class=""> </span><span class="">contra_subsetD</span><span class=""> </span><span class="">rgsound_e</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">      
</span><span class="">      </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_e (last ?el1) = AnonyEvent None&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_e_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;last ?el1&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_e (last ?el1) = sn&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">gets_e_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;last ?el1&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;sn&#8712;Post<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">d10</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d101</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;gets_es (last (cs k)) &#8712; Post<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">gets_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">      
</span><span class="">      </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length ?esl&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(?esl!i -es-((Cmd cmd)&#9839;k)&#8594; ?esl!(Suc i))&quot;</span><span class=""> 
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;all_evts_esspec (evtsys_spec (rgf_EvtSeq ef esf)). is_basicevt ef&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsys_spec_evtseq</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">ef</span><span class=""> </span><span class="">esf</span><span class="delimiter">]</span><span class=""> </span><span class="">all_evts_same</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;rgf_EvtSeq ef esf&quot;</span><span class="delimiter">]</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">DomainE</span><span class=""> </span><span class="">E<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span class=""> </span><span class="">prod.sel</span><span class="delimiter">(</span><span class="">1</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">a6</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="">a8</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;ie. ie &lt; i &#8743; (&#8707;e. (cs k)!ie -es-(EvtEnt e&#9839;k)&#8594; (cs k)!(Suc ie))
              &#8743; (&#8704;j. j &gt; ie &#8743; j &lt; i &#10230; &#172;(&#8707;e. (cs k)!j -es-(EvtEnt e&#9839;k)&#8594; (cs k)!(Suc j)))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cmd_impl_evtent_before_and_cmds</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">cs</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="string">&quot;evtsys_spec (rgf_EvtSeq ef esf)&quot;</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class="delimiter">]</span><span class=""> 
</span><span class="">          </span><span class="">cpts_of_es_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;EvtSeq e es&quot;</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">ie</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">ev</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;ie &lt; i &#8743; ((cs k)!ie -es-(EvtEnt ev&#9839;k)&#8594; (cs k)!(Suc ie))
              &#8743; (&#8704;j. j &gt; ie &#8743; j &lt; i &#10230; &#172;(&#8707;e. (cs k)!j -es-(EvtEnt e&#9839;k)&#8594; (cs k)!(Suc j)))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;m. m &gt; ie &#8743; m &#8804; i &#10230; getx_es ((cs k)!m) k = ev&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtent_impl_curevt_in_cpts_es2</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">cs</span><span class=""> </span><span class="">ie</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">ev</span><span class=""> </span><span class="">i</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getx_es ((cs k)!i) k = ev&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;ie &lt; i &#8743; (?eslh!ie -es-(EvtEnt ev&#9839;k)&#8594; ?eslh!(Suc ie))
              &#8743; (&#8704;j. j &gt; ie &#8743; j &lt; i &#10230; &#172;(&#8707;e. ?eslh!j -es-(EvtEnt e&#9839;k)&#8594; ?eslh!(Suc j)))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">a81</span><span class=""> </span><span class="">a82</span><span class=""> </span><span class="">a83</span><span class=""> </span><span class="">c8</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. i &#8804; ie &#10230; getspc_es (?eslh ! i) = EvtSeq e es&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtseq_evtent_befaft</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?eslh</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">esl2</span><span class=""> </span><span class="">ie</span><span class="delimiter">]</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Suc_diff_1</span><span class=""> </span><span class="">Suc_diff_Suc</span><span class=""> </span><span class="">Suc_less_eq</span><span class=""> </span><span class="">a10</span><span class=""> </span><span class="">butlast_conv_take</span><span class=""> 
</span><span class="">            </span><span class="">diff_Suc_eq_diff_pred</span><span class=""> </span><span class="">length_butlast</span><span class=""> </span><span class="">less_trans_Suc</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">p13</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c8</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c10</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;ev = e&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">evtent_is_basicevt_inevtseq2</span><span class=""> </span><span class="">order_refl</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c11</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k))) = Guar<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Guar<span class="hidden">&#8681;</span><sub>f</sub>_def</span><span class=""> </span><span class="">Guar<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">a01</span><span class=""> </span><span class="">b17</span><span class=""> </span><span class="">b19</span><span class=""> </span><span class="">c10</span><span class=""> </span><span class="">c7</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k)))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;Suc i &lt; ?n - 1&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; ?n - 1&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (?eslh ! i) = EvtSeq (getspc_e (el ! i)) es&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">e_eqv_einevtseq_def</span><span class=""> </span><span class="">length_take</span><span class=""> </span><span class="">less_imp_le_nat</span><span class=""> </span><span class="">min.bounded_iff</span><span class="delimiter">)</span><span class="">  
</span><span class="">           
</span><span class="">          </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (?eslh ! Suc i) = EvtSeq (getspc_e (el ! Suc i)) es&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Suc_leI</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">e_eqv_einevtseq_def</span><span class=""> </span><span class="">length_take</span><span class=""> </span><span class="">min.bounded_iff</span><span class="delimiter">)</span><span class=""> 
</span><span class="">    
</span><span class="">          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es (?eslh ! i) &#8800; getspc_es (?eslh ! Suc i)&quot;</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">evtsys_not_eq_in_tran_aux1</span><span class=""> </span><span class="">nth_take</span><span class="delimiter">)</span><span class="">  
</span><span class="">    
</span><span class="">          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">e2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_e (el ! i) &#8800; getspc_e (el ! Suc i)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;t. (el ! i) -et-t&#8594; (el ! Suc i)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_of_ev_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class="delimiter">]</span><span class=""> </span><span class="">notran_confeqi</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">el</span><span class=""> </span><span class="">i</span><span class="delimiter">]</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">length_take</span><span class=""> </span><span class="">less_eq_Suc_le</span><span class=""> </span><span class="">min.bounded_iff</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">    
</span><span class="">          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length ?el1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">c23</span><span class=""> </span><span class="">e4</span><span class=""> </span><span class="">e5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;t. ?el1 ! i -et-t&#8594; ?el1 ! Suc i&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">butlast_snoc</span><span class=""> </span><span class="">length_butlast</span><span class=""> </span><span class="">nth_append</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(gets_e (?el1!i), gets_e (?el1!Suc i))&#8712;Guar<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">d10</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_es (?eslh ! i), gets_es (?eslh ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">e_eqv_einevtseq_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?eslh</span><span class=""> </span><span class="">el</span><span class=""> </span><span class="">es</span><span class="delimiter">]</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_leI</span><span class=""> </span><span class="">Suc_lessE</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c23</span><span class=""> </span><span class="">diff_Suc_1</span><span class=""> 
</span><span class="">                </span><span class="">e0</span><span class=""> </span><span class="">length_append_singleton</span><span class=""> </span><span class="">nth_append</span><span class="delimiter">)</span><span class="">  
</span><span class="">          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c11</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">nth_take</span><span class="delimiter">)</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="string">&quot;&#172; (Suc i &lt; ?n - 1)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i = ?n - 1&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Suc_pred&#39;</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">less_antisym</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">p13</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">linarith</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length ?el1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">c23</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">linarith</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;t. (?el1 ! i) -et-t&#8594;(?el1 ! Suc i)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i = length (butlast (el @ [(AnonyEvent None, sn, xn)]))&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">c23</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">length_butlast</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length el = length (cs k) - 1&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">c23</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(el @ [(AnonyEvent None, sn, xn)]) ! i = el ! i&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">nth_append</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(el @ [(AnonyEvent None, sn, xn)]) ! i = last el&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">f2</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">a83</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">diff_Suc_1</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">last_conv_nth</span><span class=""> </span><span class="">length_greater_0_conv</span><span class=""> </span><span class="">list.simps</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="">d42</span><span class=""> </span><span class="">d7</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">qed</span></span><span class=""> 
</span><span class="">          
</span><span class="">          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d10</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_e (?el1 ! i), gets_e (?el1 ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">commit_e_def</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">c23</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?el1 !i = last el&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">a10</span><span class=""> </span><span class="">butlast_snoc</span><span class=""> </span><span class="">diff_Suc_1</span><span class=""> </span><span class="">diff_is_0_eq</span><span class=""> 
</span><span class="">              </span><span class="">last_conv_nth</span><span class=""> </span><span class="">length_0_conv</span><span class=""> </span><span class="">length_butlast</span><span class=""> </span><span class="">lessI</span><span class=""> </span><span class="">not_le</span><span class=""> </span><span class="">nth_append</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">c23</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?el1 ! Suc i = (AnonyEvent None, sn, xn)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">butlast_snoc</span><span class=""> </span><span class="">length_butlast</span><span class=""> </span><span class="">nth_append_length</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(sn1,sn)&#8712;Guar<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">d42</span><span class=""> </span><span class="">gets_e_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;(getspc_e (last el), sn1, xn1)&quot;</span><span class="delimiter">]</span><span class="">
</span><span class="">            </span><span class="">gets_e_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;(AnonyEvent None, sn, xn)&quot;</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">snd_conv</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d2</span><span class=""> </span><span class="">d52</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_es (cs k ! Suc i) = sn&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">gets_es_def</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">snd_conv</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">d42</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_es (cs k ! i) = sn1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">e_eqv_einevtseq_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?eslh</span><span class=""> </span><span class="">el</span><span class=""> </span><span class="">es</span><span class="delimiter">]</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Suc_1</span><span class=""> </span><span class="">d4</span><span class=""> </span><span class="">d51</span><span class=""> </span><span class="">diff_Suc_1</span><span class=""> </span><span class="">diff_Suc_eq_diff_pred</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">gets_es_def</span><span class=""> </span><span class="">snd_conv</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">c11</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">d101</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">act_cpts_evtseq_sat_guar_curevt_new2</span><span class="delimiter">:</span><span class="">
</span><span class="">   </span><span class="keyword2"><span class="keyword">assumes</span></span><span class=""> </span><span class="">b51</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8866; (E<span class="hidden">&#8681;</span><sub>e</sub> ef) sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre<span class="hidden">&#8681;</span><sub>e</sub> ef, Rely<span class="hidden">&#8681;</span><sub>e</sub> ef, Guar<span class="hidden">&#8681;</span><sub>e</sub> ef, Post<span class="hidden">&#8681;</span><sub>e</sub> ef]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b52</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8866; (fst esf) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre<span class="hidden">&#8681;</span><sub>f</sub> (snd esf), Rely<span class="hidden">&#8681;</span><sub>f</sub> (snd esf), Guar<span class="hidden">&#8681;</span><sub>f</sub> (snd esf), Post<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;prea = Pre<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;posta = Post<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;relya &#8838; Rely<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;relya &#8838; Rely<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b10</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Guar<span class="hidden">&#8681;</span><sub>e</sub> ef &#8838; guara&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b11</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Guar<span class="hidden">&#8681;</span><sub>f</sub> (snd esf) &#8838; guara&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b12</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Post<span class="hidden">&#8681;</span><sub>e</sub> ef &#8838; Pre<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Pre k &#8838; prea&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Rely k &#8838; relya&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;guara &#8838; Guar k&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;posta &#8838; Post k&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c&#8712;cpts_of_pes pes s x&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8733; cs&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c&#8712;assume_pes(pre1, rely1)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. (cs k) &#8712; cpts_of_es (pes k) s x&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p16</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. cs k&#8712; commit_es(Guar k, Post k)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. pre1 &#8838; Pre k&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p10</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. rely1 &#8838; Rely k&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k j. j &#8800; k &#10230; Guar j &#8838; Rely k&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;evtsys_spec (rgf_EvtSeq ef esf) = getspc_es (cs k ! 0)&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;e&#8712;all_evts_es (rgf_EvtSeq ef esf). is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> e)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a02</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;e&#8712;all_evts_es (rgf_EvtSeq ef esf). the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> e)) = snd e&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. ((c ! j) -pes-actk&#8594; (c ! Suc j)))&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">pp</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;c pes s x cs pre1 rely1 Pre Rely Guar Post k cmd.
          Pre k &#8838; Pre<span class="hidden">&#8681;</span><sub>f</sub> (snd esf) &#8743; Rely k &#8838; Rely<span class="hidden">&#8681;</span><sub>f</sub> (snd esf) 
            &#8743; Guar<span class="hidden">&#8681;</span><sub>f</sub> (snd esf) &#8838; Guar k &#8743; Post<span class="hidden">&#8681;</span><sub>f</sub> (snd esf) &#8838; Post k &#10230;
          c &#8712; cpts_of_pes pes s x &#8743; c &#8733; cs &#8743; c &#8712; assume_pes (pre1, rely1) &#10230;
          (&#8704;k. (cs k) &#8712; cpts_of_es (pes k) s x) &#10230;
          (&#8704;k. cs k&#8712; commit_es(Guar k, Post k)) &#10230;
          (&#8704;k. pre1 &#8838; Pre k) &#10230;
          (&#8704;k. rely1 &#8838; Rely k) &#10230;
          (&#8704;k j. j &#8800; k &#10230; Guar j &#8838; Rely k) &#10230;
          evtsys_spec (fst esf) = getspc_es (cs k ! 0) &#10230;
          (&#8704;e&#8712;all_evts_es (fst esf). is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> e)) &#10230;
          (&#8704;e&#8712;all_evts_es (fst esf). the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> e)) = snd e) &#10230;
          (&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. ((c ! j) -pes-actk&#8594; (c ! Suc j)))) &#10230;
          (&#8704;i. Suc i &lt; length (cs k) &#8743; ((cs k ! i) -es-(Cmd cmd)&#9839;k&#8594; (cs k ! Suc i)) &#10230;
               (gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k))))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword2"><span class="keyword">shows</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &lt; length (cs k) &#8743; ((cs k ! i) -es-(Cmd cmd)&#9839;k&#8594; (cs k ! Suc i)) &#10230;
               (gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k)))&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p11</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. length (cs k) = length c&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">conjoin_def</span><span class=""> </span><span class="">same_length_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p12</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. cs k &#8712; cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_of_es_def</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;c &#8800; Nil&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_es_not_empty</span><span class=""> </span><span class="">length_0_conv</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p13</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length c &gt; 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">    
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">p9</span><span class=""> </span><span class="">p10</span><span class=""> </span><span class="">p16</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p14</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. (cs k) &#8712; assume_es(Pre k, Rely k)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">conjoin_comm_imp_rely</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">mono_tags</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p15</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c&#8712;cpts_pes &#8743; c!0=(pes,s,x)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_pes_def</span><span class="delimiter">)</span><span class="">
</span><span class="">    
</span><span class="">    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esys</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;evtsys_spec (rgf_EvtSeq ef esf)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?esl</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;cs k&quot;</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;e es ess. ?esys = EvtSeq e es &#8743; getspc_es (cs k ! 0) = EvtSeq e es&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsys_spec_evtseq</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">ef</span><span class=""> </span><span class="">esf</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class=""> 
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">e</span><span class=""> </span><span class="keyword2"><span class="keyword">and</span></span><span class=""> </span><span class="">es</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esys = EvtSeq e es &#8743; getspc_es (cs k ! 0) = EvtSeq e es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">    
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">a6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl &#8712; cpts_es &#8743; ?esl!0 = (EvtSeq e es,s,x)&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_of_es_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;pes k&quot;</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class="delimiter">]</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">mono_tags</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">mem_Collect_eq</span><span class="delimiter">)</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">esl1</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">a9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl = (EvtSeq e es,s,x)#esl1&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Suc_pred</span><span class=""> </span><span class="">length_Suc_conv</span><span class=""> </span><span class="">nth_Cons_0</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">p13</span><span class="delimiter">)</span><span class=""> 
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b17</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;E<span class="hidden">&#8681;</span><sub>e</sub> ef = e&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsys_spec_evtseq</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b18</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;evtsys_spec (fst esf) = es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsys_spec_evtsys</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">    
</span><span class="">    </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length ?esl&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(?esl!i -es-((Cmd cmd)&#9839;k)&#8594; ?esl!(Suc i))&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k)))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &#8804; length ?esl &#10230; getspc_es (?esl ! i) &#8800; es&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &#8804; length ?esl &#10230; getspc_es (?esl ! i) &#8800; es&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p9</span><span class=""> </span><span class="">p10</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="">p16</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">act_cpts_evtseq_sat_guar_curevt_fstseg_new2</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">ef</span><span class=""> </span><span class="">esf</span><span class=""> </span><span class="">prea</span><span class=""> 
</span><span class="">              </span><span class="">posta</span><span class=""> </span><span class="">relya</span><span class=""> </span><span class="">guara</span><span class=""> </span><span class="">Pre</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">Rely</span><span class=""> </span><span class="">Guar</span><span class=""> </span><span class="">Post</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">pes</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">cs</span><span class=""> </span><span class="">pre1</span><span class=""> </span><span class="">rely1</span><span class=""> </span><span class="">evtrgfs</span><span class=""> </span><span class="">i</span><span class=""> </span><span class="">cmd</span><span class="delimiter">]</span><span class="">
</span><span class="">               </span><span class="">a02</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">b18</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="">b6</span><span class=""> </span><span class="">b7</span><span class=""> </span><span class="">b8</span><span class=""> </span><span class="">b9</span><span class=""> </span><span class="">b10</span><span class=""> </span><span class="">b11</span><span class=""> </span><span class="">b12</span><span class=""> </span><span class="">b51</span><span class=""> </span><span class="">b52</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">b18</span><span class=""> </span><span class="">a6</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(&#8704;i. Suc i &#8804; length ?esl &#10230; getspc_es (?esl ! i) &#8800; es)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;m. Suc m &#8804; length ?esl &#8743; getspc_es (?esl ! m) = es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">m</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc m &#8804; length ?esl &#8743; getspc_es (?esl ! m) = es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;i. i &#8804; m &#8743; getspc_es (?esl ! i) = es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a8</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;i. (i &#8804; m &#8743; getspc_es (?esl ! i) = es) 
                                  &#8743; (&#8704;j. j &lt; i &#10230; getspc_es (?esl ! j) &#8800; es)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtseq_fst_finish</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?esl</span><span class=""> </span><span class="">e</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="">m</span><span class="delimiter">]</span><span class=""> </span><span class="">getspc_es_def</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">n</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(n &#8804; m &#8743; getspc_es (?esl ! n) = es) 
                                  &#8743; (&#8704;j. j &lt; n &#10230; getspc_es (?esl ! j) &#8800; es)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a8</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;n &#8800; 0&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">getspc_es_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;cs k ! 0&quot;</span><span class="delimiter">]</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">hide_lams</span><span class="delimiter">)</span><span class=""> </span><span class="">add.commute</span><span class=""> </span><span class="">add.right_neutral</span><span class=""> </span><span class="">fst_conv</span><span class="">
</span><span class="">                  </span><span class="">add_Suc</span><span class=""> </span><span class="">dual_order.irrefl</span><span class=""> </span><span class="">esys.size</span><span class="delimiter">(</span><span class="">3</span><span class="delimiter">)</span><span class=""> </span><span class="">le_add1</span><span class=""> </span><span class="">le_imp_less_Suc</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;n &lt; length ?esl&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?c1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;take n c&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?cs1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;&#955;k. take n (cs k)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?c2</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;drop n c&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?cs2</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;&#955;k. drop n (cs k)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?cs1k</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;?cs1 k&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?cs2k</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;?cs2 k&quot;</span><span class="">
</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c5_1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;length ?c1 = n&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">less_le_trans</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?c1 @ ?c2 = c&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?esl = ?cs1k @ ?cs2k&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?cs1k ! 0 = (EvtSeq e es, s, x)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a9</span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">  
</span><span class="">          </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;getspc_es (?cs2k ! 0) = es&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="">less_or_eq_imp_le</span><span class="delimiter">)</span><span class="">  
</span><span class="">
</span><span class="">
</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?c12</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;take (Suc n) c&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?cs12</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;&#955;k. take (Suc n) (cs k)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p15</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="">c5_1</span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?c12&#8712;cpts_pes&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_pes_take</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="string">&quot;n&quot;</span><span class="delimiter">]</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p15</span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?c12&#8712;cpts_of_pes pes s x&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_of_pes_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">pes</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class="delimiter">]</span><span class="">
</span><span class="">                  </span><span class="">append_take_drop_id</span><span class=""> </span><span class="">length_greater_0_conv</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> 
</span><span class="">                  </span><span class="">nth_append</span><span class=""> </span><span class="">take_eq_Nil</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?c12 &#8733; ?cs12&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">take_n_conjoin</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">cs</span><span class=""> </span><span class="string">&quot;Suc n&quot;</span><span class=""> </span><span class="var">?c12</span><span class=""> </span><span class="var">?cs12</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?c12 &#8712; assume_pes(pre1, rely1)&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assume_pes_take_n</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;Suc n&quot;</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">pre1</span><span class=""> </span><span class="">rely1</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;k. (?cs12 k) &#8712; cpts_of_es (pes k) s x&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">k&#39;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(?cs12 k&#39;)!0 = (pes k&#39;, s, x)&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_of_es_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;pes k&#39;&quot;</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class="delimiter">]</span><span class="">
</span><span class="">                    </span><span class="">Suc_leI</span><span class=""> </span><span class="">less_le_trans</span><span class=""> </span><span class="">mem_Collect_eq</span><span class=""> </span><span class="">nth_take</span><span class=""> </span><span class="">zero_less_Suc</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;cs k&#39;&#8712;cpts_es&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_of_es_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;pes k&#39;&quot;</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(?cs12 k&#39;)&#8712;cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_es_take</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;cs k&#39;&quot;</span><span class=""> </span><span class="string">&quot;n&quot;</span><span class="delimiter">]</span><span class="">
</span><span class="">                  </span><span class="">Suc_diff_1</span><span class=""> </span><span class="">Suc_le_lessD</span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="">c5_1</span><span class=""> </span><span class="">dual_order.trans</span><span class=""> </span><span class="">le_SucI</span><span class=""> 
</span><span class="">                  </span><span class="">length_0_conv</span><span class=""> </span><span class="">length_greater_0_conv</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(?cs12 k&#39;) &#8712; cpts_of_es (pes k&#39;) s x&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_es_def</span><span class="delimiter">)</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;j. Suc j &lt; length ?c12 &#10230; (&#8707;actk. ?c12!j-pes-actk&#8594;?c12!Suc j)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">length_take</span><span class=""> </span><span class="">min_less_iff_conj</span><span class=""> </span><span class="">nth_take</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">b18</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(&#8704;i. Suc i &lt; length (?cs12 k) &#10230; 
                        getspc_es ((?cs12 k) ! i) &#8800; evtsys_spec (fst esf))&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_le_lessD</span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">Suc_lessI</span><span class=""> 
</span><span class="">                </span><span class="">append_take_drop_id</span><span class=""> </span><span class="">ex_least_nat_le</span><span class=""> </span><span class="">gr_implies_not0</span><span class=""> </span><span class="">length_take</span><span class=""> 
</span><span class="">                </span><span class="">lessI</span><span class=""> </span><span class="">less_antisym</span><span class=""> </span><span class="">min.bounded_iff</span><span class=""> </span><span class="">nth_append</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="">b18</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es(last (?cs12 k)) = evtsys_spec (fst esf)&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;last (?cs12 k) = cs k ! n&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">take_Suc_conv_app_nth</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">b18</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p16</span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;k. ?cs12 k &#8712; commit_es (Guar k, Post k)&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">commit_es_take_n</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;Suc n&quot;</span><span class="delimiter">]</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Suc_leI</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">zero_less_Suc</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">ultimately</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">r1</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;i. Suc i &lt; length (?cs12 k) &#8743; ((?cs12 k ! i) -es-(Cmd cmd)&#9839;k&#8594; (?cs12 k ! Suc i)) &#10230;
                     (gets_es (?cs12 k ! i), gets_es (?cs12 k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (?cs12 k ! i) k))))
                  &#8743; gets_es (last (?cs12 k))&#8712;Post<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">act_cpts_evtseq_sat_guar_curevt_fstseg_new2_withlst_pst</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">ef</span><span class=""> </span><span class="">esf</span><span class=""> </span><span class="">prea</span><span class=""> 
</span><span class="">                    </span><span class="">posta</span><span class=""> </span><span class="">relya</span><span class=""> </span><span class="">guara</span><span class=""> </span><span class="">Pre</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">Rely</span><span class=""> </span><span class="">Guar</span><span class=""> </span><span class="">Post</span><span class=""> </span><span class="var">?c12</span><span class=""> </span><span class="">pes</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="var">?cs12</span><span class=""> </span><span class="">pre1</span><span class=""> </span><span class="">rely1</span><span class=""> </span><span class="">evtrgfs</span><span class="delimiter">]</span><span class="">
</span><span class="">                    </span><span class="">p9</span><span class=""> </span><span class="">p10</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="">p16</span><span class=""> </span><span class="">a02</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">b18</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="">b4</span><span class=""> 
</span><span class="">                      </span><span class="">b6</span><span class=""> </span><span class="">b7</span><span class=""> </span><span class="">b8</span><span class=""> </span><span class="">b9</span><span class=""> </span><span class="">b10</span><span class=""> </span><span class="">b11</span><span class=""> </span><span class="">b12</span><span class=""> </span><span class="">b51</span><span class=""> </span><span class="">b52</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">b18</span><span class=""> </span><span class="">a6</span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">r2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &lt; length (?cs12 k) &#8743; ((?cs12 k ! i) -es-(Cmd cmd)&#9839;k&#8594; (?cs12 k ! Suc i)) &#10230;
                     (gets_es (?cs12 k ! i), gets_es (?cs12 k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (?cs12 k ! i) k)))&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span class="">cases</span><span class=""> </span><span class="string">&quot;Suc i &#8804; n&quot;</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &#8804; n&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">r2</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">,</span><span class="">of</span><span class=""> </span><span class="">i</span><span class="delimiter">]</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">a4</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_es ((?cs12 k)!i), gets_es ((?cs12 k)!(Suc i)))&#8712;Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es ((?cs12 k)!i) k)))&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">            </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">d0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;(Suc i &#8804; n)&quot;</span><span class="">
</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?c2</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;drop n c&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?cs2</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;&#955;k. drop n (cs k)&quot;</span><span class="">
</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &gt; n&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            
</span><span class="">            
</span><span class="">            </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?pes</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;&#955;k. getspc_es (?cs2 k!0)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?s</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;gets (?c2!0)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?x</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;getx (?c2!0)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?pre1</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;{?s}&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?Pre</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;&#955;k. {?s}&quot;</span><span class="">
</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?c2 &#8733; ?cs2&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">drop_n_conjoin</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">cs</span><span class=""> </span><span class="">n</span><span class=""> </span><span class="var">?c2</span><span class=""> </span><span class="var">?cs2</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p15</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="">c5_1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?c2&#8712;cpts_pes&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_pes_dropi</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="string">&quot;n-1&quot;</span><span class="delimiter">]</span><span class="">
</span><span class="">              </span><span class="">a3</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">less_Suc_eq_0_disj</span><span class=""> </span><span class="">less_trans</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?c2!0 = (?pes, ?s, ?x)&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;k. getspc (drop n c ! 0) k = getspc_es (drop n (cs k) ! 0)&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">conjoin_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?c2</span><span class=""> </span><span class="var">?cs2</span><span class="delimiter">]</span><span class=""> </span><span class="">same_spec_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?c2</span><span class=""> </span><span class="var">?cs2</span><span class="delimiter">]</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">length_drop</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">zero_less_diff</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc (?c2!0) = ?pes&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">pesconf_trip</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;?c2!0&quot;</span><span class=""> </span><span class="var">?s</span><span class=""> </span><span class="var">?pes</span><span class=""> </span><span class="var">?x</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?c2&#8712;cpts_of_pes ?pes ?s ?x&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_of_pes_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;?pes&quot;</span><span class=""> </span><span class="var">?s</span><span class=""> </span><span class="var">?x</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?c2&#8712;assume_pes(?pre1, rely1)&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assume_pes_drop_n</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">n</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">pre1</span><span class=""> </span><span class="">rely1</span><span class=""> </span><span class="var">?pre1</span><span class="delimiter">]</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">hd_conv_nth</span><span class=""> </span><span class="">hd_drop_conv_nth</span><span class=""> </span><span class="">not_le</span><span class=""> </span><span class="">singleton_iff</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k1. (?cs2 k1) &#8712; cpts_of_es (?pes k1) ?s ?x&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">k1</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">p12</span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">d1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?cs2 k1 &#8712; cpts_es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">cpts_es_dropi2</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getspc_es ((?cs2 k1)!0) = ?pes k1&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_es ((?cs2 k1)!0) = ?s&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">conjoin_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?c2</span><span class=""> </span><span class="var">?cs2</span><span class="delimiter">]</span><span class=""> </span><span class="">same_state_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?c2</span><span class=""> </span><span class="var">?cs2</span><span class="delimiter">]</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">length_drop</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">zero_less_diff</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;getx_es ((?cs2 k1)!0) = ?x&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">conjoin_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?c2</span><span class=""> </span><span class="var">?cs2</span><span class="delimiter">]</span><span class=""> </span><span class="">same_state_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?c2</span><span class=""> </span><span class="var">?cs2</span><span class="delimiter">]</span><span class="">
</span><span class="">                    </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">length_drop</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">zero_less_diff</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(?cs2 k1)!0 = (?pes k1, ?s, ?x)&quot;</span><span class=""> 
</span><span class="">                  </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">esconf_trip</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;(?cs2 k1)!0&quot;</span><span class=""> </span><span class="var">?s</span><span class=""> </span><span class="string">&quot;?pes k1&quot;</span><span class=""> </span><span class="var">?x</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">d1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;?cs2 k1&#8712;cpts_of_es (?pes k1) ?s ?x&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">cpts_of_es_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;?pes k1&quot;</span><span class=""> </span><span class="var">?s</span><span class=""> </span><span class="var">?x</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;n k. n &#8804; length (cs k) &#8743; n &gt; 0 
                                    &#10230; take n (cs k)&#8712;assume_es(Pre k, Rely k)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">conjoin_comm_imp_rely_n</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">pre1</span><span class=""> </span><span class="">Pre</span><span class=""> </span><span class="">rely1</span><span class=""> </span><span class="">Rely</span><span class=""> </span><span class="">Guar</span><span class=""> </span><span class="">cs</span><span class=""> </span><span class="">Post</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">pes</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class="delimiter">]</span><span class="">
</span><span class="">                </span><span class="">p16</span><span class=""> </span><span class="">p9</span><span class=""> </span><span class="">p10</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">p12</span><span class=""> </span><span class="">p13</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. cs k&#8712;assume_es(Pre k, Rely k)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">order_refl</span><span class=""> </span><span class="">take_all</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. cs k&#8712;commit_es(Guar k, Post k)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">IntI</span><span class=""> </span><span class="">contra_subsetD</span><span class=""> </span><span class="">es_validity_def</span><span class=""> </span><span class="">p16</span><span class=""> </span><span class="">p2</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">e6</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. (?cs2 k)&#8712;assume_es(?Pre k, Rely k)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">assume_es_drop_n</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">n</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">smt</span><span class=""> </span><span class="">Un_insert_right</span><span class=""> </span><span class="">conjoin_def</span><span class=""> </span><span class="">drop_0</span><span class=""> 
</span><span class="">                  </span><span class="">hd_drop_conv_nth</span><span class=""> </span><span class="">insertI1</span><span class=""> </span><span class="">length_drop</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">same_state_def</span><span class=""> </span><span class="">zero_less_diff</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">e7</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. ?cs2 k&#8712;commit_es(Guar k, Post k)&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">commit_es_drop_n</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">n</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">smt</span><span class="">
</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e10</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. ?pre1 &#8838; ?Pre k&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e11</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;j. Suc j &lt; length ?c2 &#10230; (&#8707;actk. ?c2!j-pes-actk&#8594;?c2!Suc j)&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">j</span><span class="">
</span><span class="">                </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">f0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc j &lt; length ?c2&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">f1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc (n + j) &lt; length c&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Suc_diff_Suc</span><span class=""> </span><span class="">Suc_eq_plus1</span><span class=""> </span><span class="">Suc_neq_Zero</span><span class=""> </span><span class="">add_diff_inverse_nat</span><span class=""> 
</span><span class="">                    </span><span class="">diff_add_0</span><span class=""> </span><span class="">diff_diff_add</span><span class=""> </span><span class="">length_drop</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;actk. c!(n+j)-pes-actk&#8594;c!Suc (n+j)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="">f0</span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;c ! (n + j) = drop n c ! j&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">Suc_leD</span><span class=""> </span><span class="">less_imp_le_nat</span><span class=""> </span><span class="">nth_drop</span><span class="delimiter">)</span><span class=""> 
</span><span class="">                </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="">f0</span><span class=""> </span><span class="">f1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;c ! Suc (n + j) = drop n c ! Suc j&quot;</span><span class="">
</span><span class="">                  </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">less_or_eq_imp_le</span><span class="delimiter">)</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;actk. ?c2!j-pes-actk&#8594;?c2!Suc j&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets (c!n) = gets_es (cs k ! n)&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">conjoin_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="">same_state_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="">p11</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets_es (last (take (Suc n) (cs k))) = gets_es (cs k ! n)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">take_Suc_conv_app_nth</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets (drop n c ! 0) = gets (c!n)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">c5_1</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e12</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;?s&#8712;Pre<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">r1</span><span class=""> </span><span class="">b12</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b18</span><span class=""> </span><span class="">c3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e13</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;evtsys_spec (fst esf) = getspc_es (?cs2 k ! 0)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="">drop_eq_Nil</span><span class=""> </span><span class="">hd_conv_nth</span><span class=""> </span><span class="">hd_drop_conv_nth</span><span class=""> </span><span class="">not_less</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e14</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;e &#8712; all_evts_es (fst esf). is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> e)&quot;</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">all_evts_es_seq</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">ef</span><span class=""> </span><span class="">esf</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a02</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">e15</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;e &#8712; all_evts_es (fst esf). the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> e)) = snd e&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">all_evts_es_seq</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">ef</span><span class=""> </span><span class="">esf</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">              </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">ii</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">e2</span><span class=""> </span><span class="">e1</span><span class=""> </span><span class="">e3</span><span class=""> </span><span class="">e4</span><span class=""> </span><span class="">e8</span><span class=""> </span><span class="">e9</span><span class=""> </span><span class="">e10</span><span class=""> </span><span class="">p10</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">e11</span><span class=""> </span><span class="">e12</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="">b6</span><span class=""> </span><span class="">b7</span><span class=""> </span><span class="">b8</span><span class=""> </span><span class="">b9</span><span class=""> </span><span class="">b10</span><span class=""> </span><span class="">b11</span><span class=""> </span><span class="">b12</span><span class=""> </span><span class="">p9</span><span class=""> </span><span class="">p10</span><span class=""> </span><span class="">p4</span><span class="">
</span><span class="">                </span><span class="">e13</span><span class=""> </span><span class="">e14</span><span class=""> </span><span class="">e15</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;Suc ii &lt; length (?cs2 k) &#8743; ((?cs2 k)!ii -es-((Cmd cmd)&#9839;k)&#8594; (?cs2 k)!(Suc ii)) 
                      &#10230; (gets_es ((?cs2 k)!ii), gets_es ((?cs2 k)!(Suc ii)))&#8712;Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es ((?cs2 k)!ii) k)))&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">pp</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?Pre</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">Rely</span><span class=""> </span><span class="">Guar</span><span class=""> </span><span class="">Post</span><span class=""> </span><span class="var">?c2</span><span class=""> </span><span class="var">?pes</span><span class=""> </span><span class="var">?s</span><span class=""> </span><span class="var">?x</span><span class=""> </span><span class="var">?cs2</span><span class=""> </span><span class="var">?pre1</span><span class=""> </span><span class="">rely1</span><span class=""> </span><span class="">ii</span><span class=""> </span><span class="">cmd</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &lt; length (?cs2 k) &#8743; ((?cs2 k)!i -es-((Cmd cmd)&#9839;k)&#8594; (?cs2 k)!(Suc i)) 
                      &#10230; (gets_es ((?cs2 k)!i), gets_es ((?cs2 k)!(Suc i)))&#8712;Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es ((?cs2 k)!i) k)))&quot;</span><span class="">
</span><span class="">               </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;cs k ! i = (?cs2 k)!(i - n)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">Suc_lessD</span><span class=""> </span><span class="">add_diff_inverse_nat</span><span class=""> </span><span class="">less_imp_le_nat</span><span class=""> </span><span class="">not_less_eq</span><span class=""> </span><span class="">nth_drop</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;cs k ! Suc i = (?cs2 k)!Suc (i - n)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">Suc_diff_le</span><span class=""> </span><span class="">add_diff_inverse_nat</span><span class=""> </span><span class="">d0</span><span class=""> </span><span class="">less_Suc_eq_le</span><span class=""> </span><span class="">less_or_eq_imp_le</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">e0</span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="">c5</span><span class=""> 
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">Suc_diff_Suc</span><span class=""> 
</span><span class="">                </span><span class="">diff_Suc_Suc</span><span class=""> </span><span class="">length_drop</span><span class=""> </span><span class="">less_diff_iff</span><span class=""> </span><span class="">less_imp_le_nat</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">act_cpts_es_sat_guar_curevt_new2</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;&#10214;&#8866; esspc sat<span class="hidden">&#8681;</span><sub>s</sub> [pre, rely, guar, post]&#10215;
      &#10233; &#8704;c pes s x cs pre1 rely1 Pre Rely Guar Post k cmd. 
            Pre k &#8838; pre &#8743; Rely k &#8838; rely &#8743; guar &#8838; Guar k &#8743; post &#8838; Post k &#10230;
            c&#8712;cpts_of_pes pes s x &#8743; c &#8733; cs &#8743; c&#8712;assume_pes(pre1, rely1) &#10230;
           (&#8704;k. (cs k) &#8712; cpts_of_es (pes k) s x)  &#10230; 
           (&#8704;k. cs k &#8712; commit_es(Guar k, Post k)) &#10230;
           (&#8704;k. pre1 &#8838; Pre k) &#10230;
           (&#8704;k. rely1 &#8838; Rely k) &#10230;
           (&#8704;k j. j &#8800; k &#10230; Guar j &#8838; Rely k) &#10230;
           evtsys_spec esspc = getspc_es (cs k!0) &#10230;
           (&#8704;e&#8712;all_evts_es esspc. is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> e)) &#10230;
           (&#8704;e&#8712;all_evts_es esspc. the ((evtrgfs::(&#39;l,&#39;k,&#39;s) event &#8658; &#39;s rgformula option) (E<span class="hidden">&#8681;</span><sub>e</sub> e)) = snd e) &#10230;
           (&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. c!j-pes-actk&#8594;c!Suc j)) &#10230;
          (&#8704;i. Suc i &lt; length (cs k) &#8743; ((cs k)!i -es-((Cmd cmd)&#9839;k)&#8594; (cs k)!(Suc i)) 
                &#10230; (gets_es ((cs k)!i), gets_es ((cs k)!(Suc i)))&#8712;Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es ((cs k)!i) k))))&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">rghoare_es.induct</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">esspc</span><span class=""> </span><span class="">pre</span><span class=""> </span><span class="">rely</span><span class=""> </span><span class="">guar</span><span class=""> </span><span class="">post</span><span class="delimiter">]</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">ef</span><span class=""> </span><span class="">esf</span><span class=""> </span><span class="">prea</span><span class=""> </span><span class="">posta</span><span class=""> </span><span class="">relya</span><span class=""> </span><span class="">guara</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">p0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot; &#8866; esspc sat<span class="hidden">&#8681;</span><sub>s</sub> [pre, rely, guar, post]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8866; E<span class="hidden">&#8681;</span><sub>e</sub> (ef::(&#39;l,&#39;k,&#39;s) rgformula_e) sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre<span class="hidden">&#8681;</span><sub>e</sub> ef, Rely<span class="hidden">&#8681;</span><sub>e</sub> ef, Guar<span class="hidden">&#8681;</span><sub>e</sub> ef, Post<span class="hidden">&#8681;</span><sub>e</sub> ef]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8866; fst (esf::(&#39;l,&#39;k,&#39;s) rgformula_es) sat<span class="hidden">&#8681;</span><sub>s</sub> 
                  [Pre<span class="hidden">&#8681;</span><sub>f</sub> (snd esf), Rely<span class="hidden">&#8681;</span><sub>f</sub> (snd esf), Guar<span class="hidden">&#8681;</span><sub>f</sub> (snd esf), Post<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;c pes s x cs pre1 rely1 Pre Rely Guar Post k cmd.
          Pre k &#8838; Pre<span class="hidden">&#8681;</span><sub>f</sub> (snd esf) &#8743; Rely k &#8838; Rely<span class="hidden">&#8681;</span><sub>f</sub> (snd esf) 
            &#8743; Guar<span class="hidden">&#8681;</span><sub>f</sub> (snd esf) &#8838; Guar k &#8743; Post<span class="hidden">&#8681;</span><sub>f</sub> (snd esf) &#8838; Post k &#10230;
          c &#8712; cpts_of_pes pes s x &#8743; c &#8733; cs &#8743; c &#8712; assume_pes (pre1, rely1) &#10230;
          (&#8704;k. cs k &#8712; cpts_of_es (pes k) s x) &#10230;
          (&#8704;k. cs k &#8712; commit_es(Guar k, Post k)) &#10230;
          (&#8704;k. pre1 &#8838; Pre k) &#10230;
          (&#8704;k. rely1 &#8838; Rely k) &#10230;
          (&#8704;k j. j &#8800; k &#10230; Guar j &#8838; Rely k) &#10230;
          evtsys_spec (fst esf) = getspc_es (cs k ! 0) &#10230;
          (&#8704;e&#8712;all_evts_es (fst esf). is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> e)) &#10230;
          (&#8704;e&#8712;all_evts_es (fst esf). the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> e)) = snd e) &#10230;
          (&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. c ! j -pes-actk&#8594; c ! Suc j)) &#10230;
          (&#8704;i. Suc i &lt; length (cs k) &#8743; cs k ! i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc i &#10230;
               (gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k))))&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;prea = Pre<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;posta = Post<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;relya &#8838; Rely<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;relya &#8838; Rely<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Guar<span class="hidden">&#8681;</span><sub>e</sub> ef &#8838; guara&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Guar<span class="hidden">&#8681;</span><sub>f</sub> (snd esf) &#8838; guara&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">p10</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Post<span class="hidden">&#8681;</span><sub>e</sub> ef &#8838; Pre<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">p11</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot; &#8866; (rgf_EvtSeq ef esf) sat<span class="hidden">&#8681;</span><sub>s</sub> [prea, relya, guara, posta]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">EvtSeq_h</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">ef</span><span class=""> </span><span class="">esf</span><span class=""> </span><span class="">prea</span><span class=""> </span><span class="">posta</span><span class=""> </span><span class="">relya</span><span class=""> </span><span class="">guara</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">pes</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">cs</span><span class=""> </span><span class="">pre1</span><span class=""> </span><span class="">rely1</span><span class=""> </span><span class="">Pre</span><span class=""> </span><span class="">Rely</span><span class=""> </span><span class="">Guar</span><span class=""> </span><span class="">Post</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">cmd</span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Pre k &#8838; prea &#8743; Rely k &#8838; relya &#8743; guara &#8838; Guar k &#8743; posta &#8838; Post k&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8712; cpts_of_pes pes s x &#8743; c &#8733; cs &#8743; c &#8712; assume_pes (pre1, rely1)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;k. cs k &#8712; cpts_of_es (pes k) s x)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;k. cs k &#8712; commit_es(Guar k, Post k))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;k. pre1 &#8838; Pre k)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;k. rely1 &#8838; Rely k)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;k j. j &#8800; k &#10230; Guar j &#8838; Rely k)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;evtsys_spec (rgf_EvtSeq ef esf) = getspc_es (cs k ! 0)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;e&#8712;all_evts_es (rgf_EvtSeq ef esf). is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> e))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;e&#8712;all_evts_es (rgf_EvtSeq ef esf). the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> e)) = snd e)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a10</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. c ! j -pes-actk&#8594; c ! Suc j))&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &lt; length (cs k) &#8743; cs k ! i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc i &#10230;
               (gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k)))&quot;</span><span class=""> 
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">p0</span><span class=""> </span><span class="">p1</span><span class=""> </span><span class="">p2</span><span class=""> </span><span class="">p3</span><span class=""> </span><span class="">p4</span><span class=""> </span><span class="">p5</span><span class=""> </span><span class="">p6</span><span class=""> </span><span class="">p7</span><span class=""> </span><span class="">p8</span><span class=""> </span><span class="">p9</span><span class=""> </span><span class="">p10</span><span class=""> </span><span class="">act_cpts_evtseq_sat_guar_curevt_new2</span><span class="">
</span><span class="">          </span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">ef</span><span class=""> </span><span class="">esf</span><span class=""> </span><span class="">prea</span><span class=""> </span><span class="">posta</span><span class=""> </span><span class="">relya</span><span class=""> </span><span class="">guara</span><span class=""> </span><span class="">Pre</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">Rely</span><span class=""> </span><span class="">Guar</span><span class=""> 
</span><span class="">              </span><span class="">Post</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">pes</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">cs</span><span class=""> </span><span class="">pre1</span><span class=""> </span><span class="">rely1</span><span class=""> </span><span class="">evtrgfs</span><span class=""> </span><span class="">cmd</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;&#8704;c pes s x cs pre1 rely1 Pre Rely Guar Post k cmd.
          Pre k &#8838; prea &#8743; Rely k &#8838; relya &#8743; guara &#8838; Guar k &#8743; posta &#8838; Post k &#10230;
          c &#8712; cpts_of_pes pes s x &#8743; c &#8733; cs &#8743; c &#8712; assume_pes (pre1, rely1) &#10230;
          (&#8704;k. cs k &#8712; cpts_of_es (pes k) s x) &#10230;
          (&#8704;k. cs k &#8712; commit_es(Guar k, Post k)) &#10230;
          (&#8704;k. pre1 &#8838; Pre k) &#10230;
          (&#8704;k. rely1 &#8838; Rely k) &#10230;
          (&#8704;k j. j &#8800; k &#10230; Guar j &#8838; Rely k) &#10230;
          evtsys_spec (rgf_EvtSeq ef esf) = getspc_es (cs k ! 0) &#10230;
          (&#8704;e&#8712;all_evts_es (rgf_EvtSeq ef esf). is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> e)) &#10230;
          (&#8704;e&#8712;all_evts_es (rgf_EvtSeq ef esf). the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> e)) = snd e) &#10230;
          (&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. c ! j -pes-actk&#8594; c ! Suc j)) &#10230;
          (&#8704;i. Suc i &lt; length (cs k) &#8743; cs k ! i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc i &#10230;
               (gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k))))&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">esf</span><span class=""> </span><span class="">prea</span><span class=""> </span><span class="">relya</span><span class=""> </span><span class="">guara</span><span class=""> </span><span class="">posta</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8866; esspc sat<span class="hidden">&#8681;</span><sub>s</sub> [pre, rely, guar, post]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;(esf::(&#39;l,&#39;k,&#39;s) rgformula_e set). 
                    &#8866; E<span class="hidden">&#8681;</span><sub>e</sub> ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre<span class="hidden">&#8681;</span><sub>e</sub> ef, Rely<span class="hidden">&#8681;</span><sub>e</sub> ef, Guar<span class="hidden">&#8681;</span><sub>e</sub> ef, Post<span class="hidden">&#8681;</span><sub>e</sub> ef]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;esf. prea &#8838; Pre<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;esf. relya &#8838; Rely<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;esf. Guar<span class="hidden">&#8681;</span><sub>e</sub> ef &#8838; guara&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;esf. Post<span class="hidden">&#8681;</span><sub>e</sub> ef &#8838; posta&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef1 ef2. ef1 &#8712; esf &#8743; ef2 &#8712; esf &#10230; Post<span class="hidden">&#8681;</span><sub>e</sub> ef1 &#8838; Pre<span class="hidden">&#8681;</span><sub>e</sub> ef2&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;stable prea relya&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;s. (s, s) &#8712; guara&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">a9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot; &#8866; rgf_EvtSys esf sat<span class="hidden">&#8681;</span><sub>s</sub> [prea, relya, guara, posta]&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">EvtSys_h</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">esf</span><span class=""> </span><span class="">prea</span><span class=""> </span><span class="">relya</span><span class=""> </span><span class="">guara</span><span class=""> </span><span class="">posta</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">pes</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">cs</span><span class=""> </span><span class="">pre1</span><span class=""> </span><span class="">rely1</span><span class=""> </span><span class="">Pre</span><span class=""> </span><span class="">Rely</span><span class=""> </span><span class="">Guar</span><span class=""> </span><span class="">Post</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">cmd</span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Pre k &#8838; prea &#8743; Rely k &#8838; relya &#8743; guara &#8838; Guar k &#8743; posta &#8838; Post k&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8712; cpts_of_pes pes s x &#8743; c &#8733; cs &#8743; c &#8712; assume_pes (pre1, rely1)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;k. cs k &#8712; cpts_of_es (pes k) s x)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;k. (cs k)&#8712;commit_es(Guar k, Post k))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;k. pre1 &#8838; Pre k)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;k. rely1 &#8838; Rely k)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;k j. j &#8800; k &#10230; Guar j &#8838; Rely k)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;evtsys_spec (rgf_EvtSys esf) = getspc_es (cs k ! 0)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;e&#8712;all_evts_es (rgf_EvtSys esf). is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> e))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;e&#8712;all_evts_es (rgf_EvtSys esf). the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> e)) = snd e)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b10</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. c ! j -pes-actk&#8594; c ! Suc j))&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b7</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;es. evtsys_spec (rgf_EvtSys esf) = EvtSys es&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">evtsys_spec_evtsys</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">es</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">b11</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;evtsys_spec (rgf_EvtSys esf) = EvtSys es&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a9</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="">b5</span><span class=""> </span><span class="">b6</span><span class=""> </span><span class="">b7</span><span class=""> </span><span class="">b8</span><span class=""> </span><span class="">b9</span><span class=""> </span><span class="">b10</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &lt; length (cs k) &#8743; cs k ! i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc i &#10230;
               (gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k)))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">act_cpts_evtsys_sat_guar_curevt_gen0_new2</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;rgf_EvtSys esf&quot;</span><span class=""> </span><span class="">prea</span><span class=""> 
</span><span class="">            </span><span class="">relya</span><span class=""> </span><span class="">guara</span><span class=""> </span><span class="">posta</span><span class=""> </span><span class="">Pre</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">Rely</span><span class=""> </span><span class="">Guar</span><span class=""> </span><span class="">Post</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">pes</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">cs</span><span class=""> </span><span class="">pre1</span><span class=""> </span><span class="">rely1</span><span class=""> </span><span class="">es</span><span class=""> </span><span class="">evtrgfs</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;&#8704;c pes s x cs pre1 rely1 Pre Rely Guar Post k cmd.
          Pre k &#8838; prea &#8743; Rely k &#8838; relya &#8743; guara &#8838; Guar k &#8743; posta &#8838; Post k &#10230;
          c &#8712; cpts_of_pes pes s x &#8743; c &#8733; cs &#8743; c &#8712; assume_pes (pre1, rely1) &#10230;
          (&#8704;k. cs k &#8712; cpts_of_es (pes k) s x) &#10230;
          (&#8704;k. (cs k)&#8712;commit_es(Guar k, Post k)) &#10230;
          (&#8704;k. pre1 &#8838; Pre k) &#10230;
          (&#8704;k. rely1 &#8838; Rely k) &#10230;
          (&#8704;k j. j &#8800; k &#10230; Guar j &#8838; Rely k) &#10230;
          evtsys_spec (rgf_EvtSys esf) = getspc_es (cs k ! 0) &#10230;
          (&#8704;e&#8712;all_evts_es (rgf_EvtSys esf). is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> e)) &#10230;
          (&#8704;e&#8712;all_evts_es (rgf_EvtSys esf). the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> e)) = snd e) &#10230;
          (&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. c ! j -pes-actk&#8594; c ! Suc j)) &#10230;
          (&#8704;i. Suc i &lt; length (cs k) &#8743; cs k ! i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc i &#10230;
               (gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k))))&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">next</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">prea</span><span class=""> </span><span class="">pre&#39;</span><span class=""> </span><span class="">relya</span><span class=""> </span><span class="">rely&#39;</span><span class=""> </span><span class="">guar&#39;</span><span class=""> </span><span class="">guara</span><span class=""> </span><span class="">post&#39;</span><span class=""> </span><span class="">posta</span><span class=""> </span><span class="">esys</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8866; esspc sat<span class="hidden">&#8681;</span><sub>s</sub> [pre, rely, guar, post]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;prea &#8838; pre&#39;&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;relya &#8838; rely&#39;&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;guar&#39; &#8838; guara&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;post&#39; &#8838; posta&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8866; esys sat<span class="hidden">&#8681;</span><sub>s</sub> [pre&#39;, rely&#39;, guar&#39;, post&#39;]&quot;</span><span class="">
</span><span class="">      </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a6</span><span class="delimiter">[</span><span class="">rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;c pes s x cs pre1 rely1 Pre Rely Guar Post k cmd.
          Pre k &#8838; pre&#39; &#8743; Rely k &#8838; rely&#39; &#8743; guar&#39; &#8838; Guar k &#8743; post&#39; &#8838; Post k &#10230;
          c &#8712; cpts_of_pes pes s x &#8743; c &#8733; cs &#8743; c &#8712; assume_pes (pre1, rely1) &#10230;
          (&#8704;k. cs k &#8712; cpts_of_es (pes k) s x) &#10230;
          (&#8704;k. (cs k)&#8712;commit_es(Guar k, Post k)) &#10230;
          (&#8704;k. pre1 &#8838; Pre k) &#10230;
          (&#8704;k. rely1 &#8838; Rely k) &#10230;
          (&#8704;k j. j &#8800; k &#10230; Guar j &#8838; Rely k) &#10230;
          evtsys_spec esys = getspc_es (cs k ! 0) &#10230;
          (&#8704;e&#8712;all_evts_es esys. is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> e)) &#10230;
          (&#8704;e&#8712;all_evts_es esys. the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> e)) = snd e) &#10230;
          (&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. c ! j -pes-actk&#8594; c ! Suc j)) &#10230;
          (&#8704;i. Suc i &lt; length (cs k) &#8743; cs k ! i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc i &#10230;
               (gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k))))&quot;</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">pes</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">cs</span><span class=""> </span><span class="">pre1</span><span class=""> </span><span class="">rely1</span><span class=""> </span><span class="">Pre</span><span class=""> </span><span class="">Rely</span><span class=""> </span><span class="">Guar</span><span class=""> </span><span class="">Post</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">cmd</span><span class="">
</span><span class="">      </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Pre k &#8838; prea &#8743; Rely k &#8838; relya &#8743; guara &#8838; Guar k &#8743; posta &#8838; Post k&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;c &#8712; cpts_of_pes pes s x &#8743; c &#8733; cs &#8743; c &#8712; assume_pes (pre1, rely1)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;k. cs k &#8712; cpts_of_es (pes k) s x)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;k. (cs k)&#8712;commit_es(Guar k, Post k))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;k. pre1 &#8838; Pre k)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;k. rely1 &#8838; Rely k)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;k j. j &#8800; k &#10230; Guar j &#8838; Rely k)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;evtsys_spec esys = getspc_es (cs k ! 0)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;e&#8712;all_evts_es esys. is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> e))&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;e&#8712;all_evts_es esys. the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> e)) = snd e)&quot;</span><span class="">
</span><span class="">        </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b10</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. c ! j -pes-actk&#8594; c ! Suc j))&quot;</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;Pre k &#8838; pre&#39; &#8743; Rely k &#8838; rely&#39; &#8743; guar&#39; &#8838; Guar k &#8743; post&#39; &#8838; Post k&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">a1</span><span class=""> </span><span class="">a2</span><span class=""> </span><span class="">a3</span><span class=""> </span><span class="">a5</span><span class=""> </span><span class="">a6</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">Pre</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">Rely</span><span class=""> </span><span class="">Guar</span><span class=""> </span><span class="">Post</span><span class=""> </span><span class="">c</span><span class=""> </span><span class="">pes</span><span class=""> </span><span class="">s</span><span class=""> </span><span class="">x</span><span class=""> </span><span class="">cs</span><span class=""> </span><span class="">pre1</span><span class=""> </span><span class="">rely1</span><span class="delimiter">]</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="">b5</span><span class=""> </span><span class="">b6</span><span class=""> </span><span class="">b7</span><span class=""> </span><span class="">b8</span><span class=""> </span><span class="">b9</span><span class=""> </span><span class="">b10</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &lt; length (cs k) &#8743; cs k ! i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc i &#10230;
               (gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k)))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">force</span><span class="">
</span><span class="">    </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">    
</span><span class="">    </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;&#8704;c pes s x cs pre1 rely1 Pre Rely Guar Post k cmd.
          Pre k &#8838; prea &#8743; Rely k &#8838; relya &#8743; guara &#8838; Guar k &#8743; posta &#8838; Post k &#10230;
          c &#8712; cpts_of_pes pes s x &#8743; c &#8733; cs &#8743; c &#8712; assume_pes (pre1, rely1) &#10230;
          (&#8704;k. cs k &#8712; cpts_of_es (pes k) s x) &#10230;
          (&#8704;k. (cs k)&#8712;commit_es(Guar k, Post k)) &#10230;
          (&#8704;k. pre1 &#8838; Pre k) &#10230;
          (&#8704;k. rely1 &#8838; Rely k) &#10230;
          (&#8704;k j. j &#8800; k &#10230; Guar j &#8838; Rely k) &#10230;
          evtsys_spec esys = getspc_es (cs k ! 0) &#10230;
          (&#8704;e&#8712;all_evts_es esys. is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> e)) &#10230;
          (&#8704;e&#8712;all_evts_es esys. the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> e)) = snd e) &#10230;
          (&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. c ! j -pes-actk&#8594; c ! Suc j)) &#10230;
          (&#8704;i. Suc i &lt; length (cs k) &#8743; cs k ! i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc i &#10230;
               (gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k))))&quot;</span><span class=""> 
</span><span class="">       </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">fastforce</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword1"><span class="command">lemma</span></span><span class=""> </span><span class="">act_cptpes_sat_guar_curevt_new2</span><span class="delimiter">:</span><span class=""> 
</span><span class="">  </span><span class="string">&quot;&#10214;&#8866; (pesf::(&#39;l,&#39;k,&#39;s) rgformula_par) SAT [pre, {}, UNIV, post]&#10215; &#10233; 
      s0&#8712;pre &#10230;
      (&#8704;ef&#8712;all_evts pesf. is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> ef)) &#10230;
      (&#8704;erg&#8712;all_evts pesf. the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> erg)) = snd erg) &#10230;
      pesl&#8712;cpts_of_pes (paresys_spec pesf) s0 x0 &#10230;
      (&#8704;j. Suc j &lt; length pesl &#10230; (&#8707;actk. pesl!j-pes-actk&#8594;pesl!Suc j)) &#10230;
      (&#8704;k i. Suc i &lt;length pesl &#10230; (&#8707;c. (pesl!i -pes-((Cmd c)&#9839;k)&#8594; pesl!(Suc i)))
          &#10230; (gets (pesl!i),gets (pesl!Suc i))&#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx (pesl!i) k))))&quot;</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span class="">rule</span><span class=""> </span><span class="">rghoare_pes.induct</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">pesf</span><span class=""> </span><span class="">pre</span><span class=""> </span><span class="string">&quot;{}&quot;</span><span class=""> </span><span class="">UNIV</span><span class=""> </span><span class="">post</span><span class="delimiter">]</span><span class="delimiter">)</span><span class=""> 
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span><span class=""> </span><span class="">2</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">pesfa</span><span class=""> </span><span class="">prea</span><span class=""> </span><span class="">rely</span><span class=""> </span><span class="">guar</span><span class=""> </span><span class="">posta</span><span class="">
</span><span class="">    </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">a0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8866; pesf SAT [pre, {}, UNIV, post]&quot;</span><span class="">
</span><span class="">       </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. &#8866; fst ((pesfa::(&#39;l,&#39;k,&#39;s) rgformula_par) k) 
                        sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesfa k), Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesfa k), Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesfa k), Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesfa k)]&quot;</span><span class="">
</span><span class="">       </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. prea &#8838; Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesfa k)&quot;</span><span class="">
</span><span class="">       </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. rely &#8838; Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesfa k)&quot;</span><span class="">
</span><span class="">       </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k j. j &#8800; k &#10230; Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesfa j) &#8838; Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesfa k)&quot;</span><span class="">
</span><span class="">       </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesfa k) &#8838; guar&quot;</span><span class="">
</span><span class="">       </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">a9</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesfa k) &#8838; posta&quot;</span><span class="">
</span><span class="">    
</span><span class="">    </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="string">&quot;s0 &#8712; prea &#10230;
          (&#8704;ef&#8712;all_evts pesfa. is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> ef)) &#10230;
          (&#8704;erg&#8712;all_evts pesfa. the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> erg)) = snd erg) &#10230;
          pesl &#8712; cpts_of_pes (paresys_spec pesfa) s0 x0 &#10230;
       (&#8704;j. Suc j &lt; length pesl &#10230; (&#8707;actk. pesl ! j -pes-actk&#8594; pesl ! Suc j)) &#10230;
       (&#8704;k i. Suc i &lt; length pesl &#10230;
              (&#8707;c. pesl ! i -pes-Cmd c&#9839;k&#8594; pesl ! Suc i) &#10230;
              (gets (pesl ! i), gets (pesl ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx (pesl ! i) k))))&quot;</span><span class=""> 
</span><span class="">      </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">        </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">b0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;pesl &#8712; cpts_of_pes (paresys_spec pesfa) s0 x0&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;j. Suc j &lt; length pesl &#10230; (&#8707;actk. pesl ! j -pes-actk&#8594; pesl ! Suc j)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;ef&#8712;all_evts pesfa. is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> ef)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;erg&#8712;all_evts pesfa. the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> erg)) = snd erg&quot;</span><span class="">
</span><span class="">          </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">b4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;s0 &#8712; prea&quot;</span><span class="">
</span><span class="">        
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;pesl&#8712;cpts_pes &#8743; pesl!0 = (paresys_spec pesfa, s0, x0)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">cpts_of_pes_def</span><span class="delimiter">)</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">let</span></span><span class=""> </span><span class="var">?pes</span><span class=""> </span><span class="delimiter">=</span><span class=""> </span><span class="string">&quot;paresys_spec pesfa&quot;</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8707;cs. (&#8704;k. (cs k) &#8712; cpts_of_es (?pes k) s0 x0) &#8743; pesl &#8733; cs&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">par_evtsys_semantics_comp</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="var">?pes</span><span class=""> </span><span class="">s0</span><span class=""> </span><span class="">x0</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">cs</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">b6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(&#8704;k. (cs k) &#8712; cpts_of_es (?pes k) s0 x0) &#8743; pesl &#8733; cs&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. length (cs k) = length pesl&quot;</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">conjoin_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">pesl</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="">same_length_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">pesl</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">b8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;pesl&#8712;assume_pes(prea,rely)&quot;</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;gets (paresys_spec pesfa, s0, x0) &#8712; prea&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">gets_def</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">snd_conv</span><span class="delimiter">)</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;i. Suc i &lt; length pesl &#10230; &#172;(pesl ! i -pese&#8594; pesl ! Suc i)&quot;</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">pes_tran_not_etran1</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">ultimately</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">b5</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class="">assume_pes_def</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">{</span></span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">fix</span></span><span class=""> </span><span class="">k</span><span class=""> </span><span class="">i</span><span class="">
</span><span class="">          </span><span class="keyword3"><span class="command">assume</span></span><span class=""> </span><span class="">c0</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;Suc i &lt; length pesl&quot;</span><span class="">
</span><span class="">            </span><span class="keyword2"><span class="keyword">and</span></span><span class="">  </span><span class="">c1</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8707;c. pesl ! i -pes-Cmd c&#9839;k&#8594; pesl ! Suc i&quot;</span><span class="">
</span><span class="">          
</span><span class="">          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword3"><span class="command">obtain</span></span><span class=""> </span><span class="">c</span><span class=""> </span><span class="keyword2"><span class="keyword">where</span></span><span class=""> </span><span class="">c2</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;pesl ! i -pes-Cmd c&#9839;k&#8594; pesl ! Suc i&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c3</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#172;((pesl!i) -pese&#8594; (pesl!Suc i))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">pes_tran_not_etran1</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">blast</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">b6</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">c1</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(&#8704;k t. (pesl ! i -pes-t&#9839;k&#8594; pesl ! Suc i) &#10230;
                 (cs k ! i -es-t&#9839;k&#8594; cs k ! Suc i) &#8743; (&#8704;k&#39;. k&#39; &#8800; k &#10230; cs k&#39; ! i -ese&#8594; cs k&#39; ! Suc i))&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">conjoin_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">pesl</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="">compat_tran_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">pesl</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c4</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;(cs k!i -es-(Cmd c&#9839;k)&#8594; cs k! Suc i) &#8743;
                           (&#8704;k&#39;. k&#39; &#8800; k &#10230; (cs k&#39;!i -ese&#8594; cs k&#39;! Suc i))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">b6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c5</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;gets (pesl!i) = gets_es ((cs k)!i) &#8743; getx (pesl!i) = getx_es ((cs k)!i)&quot;</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">conjoin_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">pesl</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="">same_state_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">pesl</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">b6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c6</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;gets (pesl!Suc i) = gets_es ((cs k)!Suc i) 
                                &#8743; getx (pesl!Suc i) = getx_es ((cs k)!Suc i)&quot;</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">conjoin_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">pesl</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="">same_state_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">pesl</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          
</span><span class="">          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8866; fst (pesfa k) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesfa k), Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesfa k), Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesfa k), Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesfa k)]&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">a4</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c7</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;&#8704;k. &#8872; paresys_spec pesfa k sat<span class="hidden">&#8681;</span><sub>s</sub> [(Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> &#8728; pesfa) k, (Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> &#8728; pesfa) k, 
                          (Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> &#8728; pesfa) k, (Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> &#8728; pesfa) k]&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">simp</span><span class=""> </span><span class="">add</span><span class="delimiter">:</span><span class=""> </span><span class="">paresys_spec_def</span><span class=""> </span><span class="">rgsound_es</span><span class="delimiter">)</span><span class=""> 
</span><span class="">          </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b5</span><span class=""> </span><span class="">b6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="">c8</span><span class="delimiter">:</span><span class=""> </span><span class="string">&quot;evtsys_spec (fst (pesfa k)) = getspc_es (cs k ! 0)&quot;</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">conjoin_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">pesl</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="">same_spec_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">pesl</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="">paresys_spec_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">pesfa</span><span class="delimiter">]</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">metis</span><span class=""> </span><span class="delimiter">(</span><span class="">no_types</span><span class="delimiter">,</span><span class=""> </span><span class="">lifting</span><span class="delimiter">)</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">dual_order.strict_trans</span><span class=""> </span><span class="">fst_conv</span><span class=""> </span><span class="">getspc_def</span><span class=""> </span><span class="">zero_less_Suc</span><span class="delimiter">)</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b2</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;e. e &#8712; all_evts_es (fst (pesfa k)) &#10230; is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> e)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">all_evts_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">pesfa</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">from</span></span><span class=""> </span><span class="">b3</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;e. e &#8712; all_evts_es (fst (pesfa k)) &#10230; the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> e)) = snd e&quot;</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">all_evts_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">pesfa</span><span class="delimiter">]</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">moreover</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;k. cs k &#8712; commit_es ((Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> &#8728; pesfa) k, (Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> &#8728; pesfa) k)&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">proof</span></span><span class=""> </span><span class="">-</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;k. cs k &#8712; assume_es((Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> &#8728; pesfa) k, (Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> &#8728; pesfa) k)&quot;</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">conjoin_es_sat_assume</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;paresys_spec pesfa&quot;</span><span class=""> </span><span class="string">&quot;Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> &#8728; pesfa&quot;</span><span class=""> </span><span class="string">&quot;Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> &#8728; pesfa&quot;</span><span class="">
</span><span class="">                   </span><span class="string">&quot;Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> &#8728; pesfa&quot;</span><span class=""> </span><span class="string">&quot;Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> &#8728; pesfa&quot;</span><span class=""> </span><span class="">prea</span><span class=""> </span><span class="">rely</span><span class=""> </span><span class="">pesl</span><span class=""> </span><span class="">s0</span><span class=""> </span><span class="">x0</span><span class=""> </span><span class="">cs</span><span class="delimiter">]</span><span class=""> </span><span class="">c7</span><span class=""> </span><span class="">a5</span><span class=""> </span><span class="">a6</span><span class=""> </span><span class="">a7</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b6</span><span class=""> </span><span class="">b8</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">              </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c7</span><span class=""> </span><span class="">c8</span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">paresys_spec_def</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="">pesfa</span><span class="delimiter">]</span><span class="">
</span><span class="">                </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="delimiter">(</span><span class="">meson</span><span class=""> </span><span class="">IntI</span><span class=""> </span><span class="">b6</span><span class=""> </span><span class="">contra_subsetD</span><span class=""> </span><span class="">cpts_of_es_def</span><span class=""> </span><span class="">es_validity_def</span><span class="delimiter">)</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">          </span><span class="keyword1"><span class="command">ultimately</span></span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets_es ((cs k)!i), gets_es ((cs k)!(Suc i)))&#8712;Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es ((cs k)!i) k)))&quot;</span><span class="">
</span><span class="">            </span><span class="keyword1"><span class="command">using</span></span><span class=""> </span><span class="">act_cpts_es_sat_guar_curevt_new2</span><span class="delimiter">[</span><span class="">of</span><span class=""> </span><span class="string">&quot;fst (pesfa k)&quot;</span><span class=""> </span><span class="string">&quot;Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesfa k)&quot;</span><span class=""> 
</span><span class="">                  </span><span class="string">&quot;Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesfa k)&quot;</span><span class=""> </span><span class="string">&quot;Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesfa k)&quot;</span><span class=""> </span><span class="string">&quot;Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesfa k)&quot;</span><span class=""> </span><span class="string">&quot;Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> &#8728; pesfa&quot;</span><span class=""> </span><span class="">k</span><span class=""> </span><span class="string">&quot;Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> &#8728; pesfa&quot;</span><span class="">
</span><span class="">                  </span><span class="string">&quot;Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> &#8728; pesfa&quot;</span><span class=""> </span><span class="string">&quot;Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> &#8728; pesfa&quot;</span><span class=""> </span><span class="">pesl</span><span class=""> </span><span class="string">&quot;paresys_spec pesfa&quot;</span><span class=""> </span><span class="">s0</span><span class=""> </span><span class="">x0</span><span class=""> </span><span class="">cs</span><span class=""> </span><span class="">prea</span><span class=""> </span><span class="">rely</span><span class=""> </span><span class="">evtrgfs</span><span class=""> </span><span class="">i</span><span class=""> </span><span class="">c</span><span class="delimiter">]</span><span class="">
</span><span class="">                   </span><span class="">a5</span><span class=""> </span><span class="">a6</span><span class=""> </span><span class="">a7</span><span class=""> </span><span class="">a8</span><span class=""> </span><span class="">a9</span><span class=""> </span><span class="">b0</span><span class=""> </span><span class="">b1</span><span class=""> </span><span class="">b4</span><span class=""> </span><span class="">b6</span><span class=""> </span><span class="">b8</span><span class=""> </span><span class="">c4</span><span class=""> </span><span class="">c0</span><span class=""> </span><span class="">b7</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">            
</span><span class="">          </span><span class="keyword1"><span class="command">with</span></span><span class=""> </span><span class="">c5</span><span class=""> </span><span class="">c6</span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;(gets (pesl ! i), gets (pesl ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx (pesl ! i) k)))&quot;</span><span class=""> 
</span><span class="">            </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">simp</span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">        </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword1"><span class="command">have</span></span><span class=""> </span><span class="string">&quot;&#8704;k i. Suc i &lt; length pesl &#10230;
              (&#8707;c. pesl ! i -pes-Cmd c&#9839;k&#8594; pesl ! Suc i) &#10230;
              (gets (pesl ! i), gets (pesl ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx (pesl ! i) k)))&quot;</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">then</span></span><span class=""> </span><span class="keyword3"><span class="command">show</span></span><span class=""> </span><span class="var">?thesis</span><span class=""> </span><span class="keyword1"><span class="command">by</span></span><span class=""> </span><span class="">auto</span><span class="">
</span><span class="">      </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">}</span></span><span class="">
</span><span class="">  </span><span class="keyword1"><span class="command">qed</span></span><span class="">
</span><span class="">
</span><span class="keyword2"><span class="keyword">end</span></span></pre>

</div>
</body>
</html>
