<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Theory PiCore_RG_IFS (Isabelle2018: August 2018)</title>
<link media="all" rel="stylesheet" type="text/css" href="isabelle.css"/>
</head>

<body>
<div class="head"><h1>Theory PiCore_RG_IFS</h1>

<span class="command">theory</span> <span class="name">PiCore_RG_IFS</span><br/>
<span class="keyword">imports</span> <a href="PiCore_IFS.html"><span class="name">PiCore_IFS</span></a><br/>

</div>
<div class="source">
<pre class="source"><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*
Created by Yongwang Zhao (ywzhao@ntu.edu.sg, zhaoyw@buaa.edu.cn)
School of Computer Engineering, Nanyang Technological University, Singapore
and School of Computer Science &amp; Engineering, Beihang University, China
*)</span></span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">section</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;rely-guarantee unwinding condition for information flow security&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">theory</span></span><span> </span><span>PiCore_RG_IFS</span><span>
</span><span class="keyword2"><span class="keyword">imports</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;../picore/PiCore_Hoare&quot;</span></span></span><span> </span><span>PiCore_IFS</span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>  
</span><span class="keyword1"><span class="command">fun</span></span><span> </span><span>all_evts_es</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;l,&#39;k,&#39;s,&#39;prog) rgformula_ess &#8658; (&#39;l,&#39;k,&#39;s,&#39;prog) rgformula_e set&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>all_evts_es_seq</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;all_evts_es (rgf_EvtSeq e es) = insert e (all_evts_es (fst es))&quot;</span></span></span><span> </span><span class="delimiter">|</span><span>
</span><span>        </span><span>all_evts_es_esys</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;all_evts_es (rgf_EvtSys es) = es&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">fun</span></span><span> </span><span>all_evts_esspec</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;l,&#39;k,&#39;s,&#39;prog) esys &#8658; (&#39;l,&#39;k,&#39;s,&#39;prog) event set&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;all_evts_esspec (EvtSeq e es) = insert e (all_evts_esspec es)&quot;</span></span></span><span> </span><span class="delimiter">|</span><span>
</span><span>        </span><span class="string"><span class="delete"><span class="delete">&quot;all_evts_esspec (EvtSys es) = es&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">fun</span></span><span> </span><span>all_basicevts_es</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;l,&#39;k,&#39;s,&#39;prog) esys &#8658; (&#39;l,&#39;k,&#39;s,&#39;prog) event set&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;all_basicevts_es (EvtSeq e es) = (if is_basicevt e then 
                                            insert e (all_basicevts_es es) 
                                           else all_basicevts_es es) &quot;</span></span></span><span> </span><span class="delimiter">|</span><span>
</span><span>        </span><span class="string"><span class="delete"><span class="delete">&quot;all_basicevts_es (EvtSys es) = {x. x&#8712; es &#8743; is_basicevt x}&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>all_evts</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;l,&#39;k,&#39;s,&#39;prog) rgformula_par &#8658; (&#39;l,&#39;k,&#39;s,&#39;prog) rgformula_e set&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;all_evts parsys &#8801; &#8899;k. all_evts_es (fst (parsys k))&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>all_basicevts</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;l,&#39;k,&#39;s,&#39;prog) paresys &#8658; (&#39;l,&#39;k,&#39;s,&#39;prog) event set&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;all_basicevts parsys &#8801; &#8899;k. all_basicevts_es (parsys k)&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>all_evts_same</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Domain (all_evts_es rgfes) = all_evts_esspec (evtsys_spec rgfes)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>rgfes</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;all_evts_esspec.simps&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;all_evts_es.simps&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;evtsys_spec.simps&quot;</span></span></span><span>
</span><span>   </span><span>E<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>eq_fst_iff</span><span> </span><span>fsts.intros</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>fastforce</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;all_evts_esspec.simps&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;all_evts_es.simps&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;evtsys_spec.simps&quot;</span></span></span><span>
</span><span>   </span><span>E<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>fsts.intros</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>force</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>allbasicevts_es_blto_allevts</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;all_basicevts_es esys &#8838; all_evts_esspec esys&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>esys</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span class="delimiter">[</span><span>1</span><span class="delimiter">]</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>  
</span><span>  
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>allevts_es_blto_allevts</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. all_evts_esspec (evtsys_spec (fst (pesrgf k))) &#8838; Domain (all_evts pesrgf)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>k</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;all_evts_esspec (evtsys_spec (fst (pesrgf k))) = Domain (all_evts_es (fst (pesrgf k)))&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>all_evts_same</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;all_evts_es (fst (pesrgf k)) &#8838; all_evts pesrgf&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>all_evts_def</span><span> </span><span>UNIV_I</span><span> </span><span>UN_upper</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;all_evts_esspec (evtsys_spec (fst (pesrgf k))) &#8838; Domain (all_evts pesrgf)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>RG_Property</span><span> </span><span class="delimiter">=</span><span> 
</span><span>  </span><span>event_hoare</span><span> </span><span>ptran</span><span> </span><span>petran</span><span> </span><span>fin_com</span><span> </span><span>cpts_p</span><span> </span><span>cpts_of_p</span><span> 
</span><span>     </span><span>prog_validity</span><span> </span><span>assume_p</span><span> </span><span>commit_p</span><span> </span><span>rghoare_p</span><span>
</span><span class="delimiter">+</span><span> </span><span>InfoFlow</span><span> </span><span>ptran</span><span> </span><span>petran</span><span> </span><span>fin_com</span><span> </span><span>&#915;</span><span> </span><span>C0</span><span> </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*step*)</span></span></span></span></span><span> </span><span>interference</span><span> </span><span>vpeq</span><span> </span><span>dome</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>ptran</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; ((&#39;prog &#215; &#39;s) &#215; &#39;prog &#215; &#39;s) set&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>petran</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; (&#39;s,&#39;prog) pconf &#8658; (&#39;s,&#39;prog) pconf &#8658; bool&quot;</span></span></span><span>   </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">&quot;_ &#8866; _ -pe&#8594; _&quot;</span></span></span><span> </span><span class="delimiter">[</span><span>81</span><span class="delimiter">,</span><span>81</span><span class="delimiter">,</span><span>81</span><span class="delimiter">]</span><span> </span><span>80</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>fin_com</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;prog&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>cpts_p</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; (&#39;s,&#39;prog) pconfs set&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>cpts_of_p</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; &#39;prog &#8658; &#39;s &#8658; ((&#39;s,&#39;prog) pconfs) set&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>prog_validity</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; &#39;prog &#8658; &#39;s set &#8658; (&#39;s &#215; &#39;s) set &#8658; (&#39;s &#215; &#39;s) set &#8658; &#39;s set &#8658; bool&quot;</span></span></span><span> 
</span><span>                   </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">&quot;_ &#8872; _ sat<span class="hidden">&#8681;</span><sub>p</sub> [_, _, _, _]&quot;</span></span></span><span> </span><span class="delimiter">[</span><span>60</span><span class="delimiter">,</span><span>60</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">]</span><span> </span><span>45</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>assume_p</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; (&#39;s set &#215; (&#39;s &#215; &#39;s) set) &#8658; ((&#39;s,&#39;prog) pconfs) set&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>commit_p</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; ((&#39;s &#215; &#39;s) set &#215; &#39;s set) &#8658; ((&#39;s,&#39;prog) pconfs) set&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>rghoare_p</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; [&#39;prog, &#39;s set, (&#39;s &#215; &#39;s) set, (&#39;s &#215; &#39;s) set, &#39;s set] &#8658; bool&quot;</span></span></span><span>
</span><span>      </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">&quot;_ &#8866; _ sat<span class="hidden">&#8681;</span><sub>p</sub> [_, _, _, _]&quot;</span></span></span><span> </span><span class="delimiter">[</span><span>60</span><span class="delimiter">,</span><span>60</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">]</span><span> </span><span>45</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>&#915;</span><span> </span><span class="delimiter">::</span><span> </span><span class="tfree">&#39;Env</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>C0</span><span>  </span><span class="delimiter">::</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;l,&#39;k,&#39;s,&#39;prog) pesconf&quot;</span></span></span><span>
</span><span>  </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*and step :: &quot;(&#39;l,&#39;k,&#39;s,&#39;prog,&#39;d) action &#8658; ((&#39;l,&#39;k,&#39;s,&#39;prog) pesconf &#215; (&#39;l,&#39;k,&#39;s,&#39;prog) pesconf) set&quot;*)</span></span></span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>interference</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;d &#8658; &#39;d &#8658; bool&quot;</span></span></span><span> </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">&quot;(_ &#8605; _)&quot;</span></span></span><span> </span><span class="delimiter">[</span><span>70</span><span class="delimiter">,</span><span>71</span><span class="delimiter">]</span><span> </span><span>60</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>vpeq</span><span> </span><span class="delimiter">::</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;s &#8658; &#39;d &#8658; &#39;s &#8658; bool&quot;</span></span></span><span> </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">&quot;(_ &#8764;_&#8764; _)&quot;</span></span></span><span> </span><span class="delimiter">[</span><span>70</span><span class="delimiter">,</span><span>69</span><span class="delimiter">,</span><span>70</span><span class="delimiter">]</span><span> </span><span>60</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>dome</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;s &#8658; &#39;k &#8658; (&#39;l,&#39;k,&#39;s,&#39;prog) event &#8658; &#39;d&quot;</span></span></span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*
if executing an act (not evtent) on core k in a configuration, then the current event on core k is a event 
of parallel event system
*)</span></span></span></span></span><span>
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*in c and cs, if c is an act on i, and cs k is env trans, then current evt on k is not changed in this action*)</span></span></span></span></span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>etran_nchg_curevt</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; c &#8733; cs &#10233; &#8704;k i. Suc i &lt; length (cs k) &#8743; (&#8707;actk. &#915; &#8866; c!i-pes-actk&#8594;c!Suc i) 
                &#8743; (&#915; &#8866; cs k ! i -ese&#8594; cs k ! Suc i) 
                &#10230; getx_es (cs k ! i) k = getx_es (cs k ! Suc i) k&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; c &#8733; cs&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>k</span><span> </span><span>i</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length (cs k)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;actk. &#915; &#8866; c!i-pes-actk&#8594;c!Suc i&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; cs k ! i -ese&#8594; cs k ! Suc i&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. length c = length (cs k)&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>conjoin_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>c</span><span> </span><span>cs</span><span class="delimiter">]</span><span> </span><span>same_length_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>c</span><span> </span><span>cs</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#915; &#8866; c!i-pese&#8594;c!Suc i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>pes_tran_not_etran1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p0</span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;t k. (&#915; &#8866; c!i -pes-(t&#9839;k)&#8594; c!Suc i) &#8743;
                          (&#8704;k t. (&#915; &#8866; c!i -pes-(t&#9839;k)&#8594; c!Suc i) &#10230; (&#915; &#8866; cs k!i -es-(t&#9839;k)&#8594; cs k! Suc i) &#8743;
                                  (&#8704;k&#39;. k&#39; &#8800; k &#10230; (&#915; &#8866; cs k&#39;!i -ese&#8594; cs k&#39;! Suc i)))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>conjoin_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>c</span><span> </span><span>cs</span><span class="delimiter">]</span><span> </span><span>compat_tran_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>c</span><span> </span><span>cs</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>t1</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>k1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915; &#8866; c!i -pes-(t1&#9839;k1)&#8594; c!Suc i) &#8743;
                          (&#8704;k t. (&#915; &#8866; c!i -pes-(t&#9839;k)&#8594; c!Suc i) &#10230; (&#915; &#8866; cs k!i -es-(t&#9839;k)&#8594; cs k! Suc i) &#8743;
                                  (&#8704;k&#39;. k&#39; &#8800; k &#10230; (&#915; &#8866; cs k&#39;!i -ese&#8594; cs k&#39;! Suc i)))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span>a0</span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getx_es (cs k ! i) = getx_es (cs k1 ! i) 
                            &#8743; getx_es (cs k ! Suc i) = getx_es (cs k1 ! Suc i)&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>conjoin_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>c</span><span> </span><span>cs</span><span class="delimiter">]</span><span> </span><span>same_state_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>c</span><span> </span><span>cs</span><span class="delimiter">]</span><span> </span><span>same_spec_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>c</span><span> </span><span>cs</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a2</span><span> </span><span>a4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k &#8800; k1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>es_tran_not_etran1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getx_es (cs k ! i) k = getx_es (cs k ! Suc i) k&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>t1</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Cmd</span><span> </span><span>x</span><span class="delimiter">)</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cmd_ines_nchg_x2</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k1 ! i&quot;</span></span></span><span> </span><span>x</span><span> </span><span>k1</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k1 ! Suc i&quot;</span></span></span><span class="delimiter">]</span><span> </span><span>a5</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>EvtEnt</span><span> </span><span>x</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a5</span><span> </span><span>a6</span><span> </span><span>entevt_ines_notchg_otherx2</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k1 ! i&quot;</span></span></span><span> </span><span>x</span><span> </span><span>k1</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k1 ! Suc i&quot;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>            
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*in c and cs, if there is no env trans in c and if cs k is not event entry on i, then should be cmd or env trans*)</span></span></span></span></span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>compt_notevtent_iscmd</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; c &#8733; cs &#10233; &#8704;k i. Suc i &lt; length (cs k) &#8743; (&#8707;actk. &#915; &#8866; c!i-pes-actk&#8594;c!Suc i) 
                &#8743; (&#172; (&#8707;e. &#915; &#8866; cs k ! i -es-EvtEnt e&#9839;k&#8594; cs k ! Suc i)) 
                &#10230; (&#8707;cmd. &#915; &#8866; cs k ! i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc i) &#8744; &#915; &#8866; cs k ! i -ese&#8594; cs k ! Suc i&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; c &#8733; cs&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>k</span><span> </span><span>i</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length (cs k)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;actk. &#915; &#8866; c!i-pes-actk&#8594;c!Suc i&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (&#8707;e. &#915; &#8866; cs k ! i -es-EvtEnt e&#9839;k&#8594; cs k ! Suc i)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. length c = length (cs k)&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>conjoin_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>c</span><span> </span><span>cs</span><span class="delimiter">]</span><span> </span><span>same_length_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>c</span><span> </span><span>cs</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#915; &#8866; c!i-pese&#8594;c!Suc i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>pes_tran_not_etran1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p0</span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;t k. (&#915; &#8866; c!i -pes-(t&#9839;k)&#8594; c!Suc i) &#8743;
                          (&#8704;k t. (&#915; &#8866; c!i -pes-(t&#9839;k)&#8594; c!Suc i) &#10230; (&#915; &#8866; cs k!i -es-(t&#9839;k)&#8594; cs k! Suc i) &#8743;
                                  (&#8704;k&#39;. k&#39; &#8800; k &#10230; (&#915; &#8866; cs k&#39;!i -ese&#8594; cs k&#39;! Suc i)))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>conjoin_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>c</span><span> </span><span>cs</span><span class="delimiter">]</span><span> </span><span>compat_tran_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>c</span><span> </span><span>cs</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>t1</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>k1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915; &#8866; c!i -pes-(t1&#9839;k1)&#8594; c!Suc i) &#8743;
                          (&#8704;k t. (&#915; &#8866; c!i -pes-(t&#9839;k)&#8594; c!Suc i) &#10230; (&#915; &#8866; cs k!i -es-(t&#9839;k)&#8594; cs k! Suc i) &#8743;
                                  (&#8704;k&#39;. k&#39; &#8800; k &#10230; (&#915; &#8866; cs k&#39;!i -ese&#8594; cs k&#39;! Suc i)))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8707;cmd. &#915; &#8866; cs k ! i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc i) &#8744; &#915; &#8866; cs k ! i -ese&#8594; cs k ! Suc i&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k = k1&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k = k1&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a2</span><span> </span><span>a4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;cmd. &#915; &#8866; cs k ! i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc i&quot;</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>t1</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Cmd</span><span> </span><span>x</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>              </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>EvtEnt</span><span> </span><span>x</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k &#8800; k1&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; cs k ! i -ese&#8594; cs k ! Suc i&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*in c and cs, if there is no env trans in c and it is evtent on k at i, 
then the current event on k is the ent evt util a new evt ent*)</span></span></span></span></span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>evtent_impl_curevt_in_cpts_es</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;&#915; c &#8733; cs; &#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. &#915; &#8866; c!j-pes-actk&#8594;c!Suc j)&#10215; 
      &#10233; &#8704;k i. Suc i &lt; length (cs k) &#8743; (&#915; &#8866; (cs k)!i -es-((EvtEnt e)&#9839;k)&#8594; (cs k)!(Suc i)) 
                &#10230; (&#8704;j. j &gt; Suc i &#8743; Suc j &lt; length (cs k) 
                        &#8743; (&#8704;m. m &gt; i &#8743; m &lt; j &#10230; &#172;(&#8707;e. &#915; &#8866; (cs k)!m -es-((EvtEnt e)&#9839;k)&#8594; (cs k)!(Suc m)))
                        &#10230; (&#8704;m. m &gt; i &#8743; m &#8804; j &#10230; getx_es ((cs k)!m) k = e))&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; c &#8733; cs&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. &#915; &#8866; c!j-pes-actk&#8594;c!Suc j)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span>p3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i k. Suc i &lt; length (cs k) &#8743; (&#8707;actk. &#915; &#8866; c ! i -pes-actk&#8594; c ! Suc i) 
                          &#8743; &#172; (&#8707;e. &#915; &#8866; cs k ! i -es-EvtEnt e&#9839;k&#8594; cs k ! Suc i) 
                                &#10230; (&#8707;cmd. &#915; &#8866; cs k ! i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc i) &#8744; &#915; &#8866; cs k ! i -ese&#8594; cs k ! Suc i&quot;</span></span></span><span>
</span><span>                              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>compt_notevtent_iscmd</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span>c</span><span> </span><span>cs</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8896;i k. Suc i &lt; length (cs k) &#8743; (&#8707;actk. &#915; &#8866; c ! i -pes-actk&#8594; c ! Suc i) 
                        &#8743; &#172; (&#8707;e. &#915; &#8866; cs k ! i -es-EvtEnt e&#9839;k&#8594; cs k ! Suc i) 
                                &#10233; (&#8707;cmd. &#915; &#8866; cs k ! i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc i) 
                                    &#8744; &#915; &#8866; cs k ! i -ese&#8594; cs k ! Suc i&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k i. Suc i &lt; length (cs k) &#8743; (&#8707;actk. &#915; &#8866; c ! i -pes-actk&#8594; c ! Suc i) 
                        &#8743; &#915; &#8866; cs k ! i -ese&#8594; cs k ! Suc i &#10230;
                        getx_es (cs k ! i) k = getx_es (cs k ! Suc i) k&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>etran_nchg_curevt</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span>c</span><span> </span><span>cs</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8896;i k. Suc i &lt; length (cs k) &#8743; (&#8707;actk. &#915; &#8866; c ! i -pes-actk&#8594; c ! Suc i) 
                        &#8743; &#915; &#8866; cs k ! i -ese&#8594; cs k ! Suc i &#10233;
                        getx_es (cs k ! i) k = getx_es (cs k ! Suc i) k&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>k</span><span> </span><span>i</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length (cs k) &#8743; (&#915; &#8866; (cs k)!i -es-((EvtEnt e)&#9839;k)&#8594; (cs k)!(Suc i))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>es1</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>s1</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a01</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(cs k)!i = (es1,s1,x1)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>prod_cases3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>es2</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>s2</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x2</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a02</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(cs k)!Suc i = (es2,s2,x2)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>prod_cases3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>        </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*from p2 have a1: &quot;cs k &#8712; cpts_es &#8743; cs k!0 = (evtsys_spec (fst (pesrgf k)), s, x)&quot; 
          by (simp add:cpts_of_es_def)*)</span></span></span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. length c = length (cs k)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>conjoin_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>c</span><span> </span><span>cs</span><span class="delimiter">]</span><span> </span><span>same_length_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>c</span><span> </span><span>cs</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. j &gt; Suc i &#8743; Suc j &lt; length (cs k) 
                        &#8743; (&#8704;m. m &gt; i &#8743; m &lt; j &#10230; &#172;(&#8707;e. &#915; &#8866; (cs k)!m -es-((EvtEnt e)&#9839;k)&#8594; (cs k)!(Suc m)))
                        &#10230; (&#8704;m. m &gt; i &#8743; m &#8804; j &#10230; getx_es ((cs k)!m) k = e)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>          </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>j</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j &gt; Suc i &#8743; Suc j &lt; length (cs k)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;m. m &gt; i &#8743; m &lt; j &#10230; &#172;(&#8707;e. &#915; &#8866; (cs k)!m -es-((EvtEnt e)&#9839;k)&#8594; (cs k)!(Suc m))&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;m. m &gt; i &#8743; m &#8804; j &#10230; getx_es ((cs k)!m) k = e&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>j</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>              </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>sj</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; sj &#8743; Suc sj &lt; length (cs k) &#10233;
                                (&#8704;m. i &lt; m &#8743; m &lt; sj &#10230; &#172; (&#8707;e. &#915; &#8866; cs k ! m -es-EvtEnt e&#9839;k&#8594; cs k ! Suc m)) &#10233;
                                (&#8704;m. i &lt; m &#8743; m &#8804; sj &#10230; getx_es (cs k ! m) k = e)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; Suc sj &#8743; Suc (Suc sj) &lt; length (cs k)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;m. i &lt; m &#8743; m &lt; Suc sj &#10230; &#172; (&#8707;e. &#915; &#8866; cs k ! m -es-EvtEnt e&#9839;k&#8594; cs k ! Suc m)&quot;</span></span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i = sj&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i = sj&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>                      </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>                        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>m</span><span>
</span><span>                        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i &lt; m &#8743; m &#8804; Suc sj&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getx_es (cs k ! Suc i) k = e&quot;</span></span></span><span> 
</span><span>                          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>entevt_ines_chg_selfx2</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k ! i&quot;</span></span></span><span> </span><span>e</span><span> </span><span>k</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k ! Suc i&quot;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getx_es (cs k ! m) k = e&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m = Suc i&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>f0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m = Suc i&quot;</span></span></span><span>
</span><span>                            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>e1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                          </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &#8800; Suc i&quot;</span></span></span><span>
</span><span>                            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d0</span><span> </span><span>e0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m = Suc (Suc i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c2</span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (&#8707;e. &#915; &#8866; cs k ! Suc i -es-EvtEnt e&#9839;k&#8594; cs k ! Suc (Suc i))&quot;</span></span></span><span>
</span><span>                              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p3</span><span> </span><span>a2</span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;actk. &#915; &#8866; c ! Suc i -pes-actk&#8594; c ! Suc (Suc i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p3</span><span> </span><span>b0</span><span> </span><span>f1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8707;cmd. &#915; &#8866; cs k ! Suc i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc (Suc i)) &#8744;
                                      &#915; &#8866; cs k ! Suc i -ese&#8594; cs k ! Suc (Suc i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>p5</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&quot;</span></span></span><span> </span><span>k</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>                              </span><span class="keyword1"><span class="command">proof</span></span><span> 
</span><span>                                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;cmd. &#915; &#8866; cs k ! Suc i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc (Suc i)&quot;</span></span></span><span>
</span><span>                                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>cmd</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>g0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; cs k ! Suc i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc (Suc i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>e1</span><span> </span><span>f0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getx_es (cs k ! Suc (Suc i)) k = e&quot;</span></span></span><span> 
</span><span>                                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cmd_ines_nchg_x2</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k ! Suc i&quot;</span></span></span><span> </span><span>cmd</span><span> </span><span>k</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k ! Suc (Suc i)&quot;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>f0</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                              </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>g0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; cs k ! Suc i -ese&#8594; cs k ! Suc (Suc i)&quot;</span></span></span><span>
</span><span>                                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p3</span><span> </span><span>a2</span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>g1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;actk. &#915; &#8866; c ! Suc i -pes-actk&#8594; c ! Suc (Suc i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span>e1</span><span> </span><span>f0</span><span> </span><span>g0</span><span> </span><span>g1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>p6</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&quot;</span></span></span><span> </span><span>k</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &#8800; sj&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; sj&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c0</span><span> </span><span>c1</span><span> </span><span>c2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;m. i &lt; m &#8743; m &#8804; sj &#10230; getx_es (cs k ! m) k = e&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>                        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>m</span><span>
</span><span>                        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i &lt; m &#8743; m &#8804; Suc sj&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; getx_es (cs k ! m) k = e&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i &lt; m &#8743; m &lt; Suc sj&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>f0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i &lt; m &#8743; m &lt; Suc sj&quot;</span></span></span><span>
</span><span>                            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d2</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                          </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>f0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(i &lt; m &#8743; m &lt; Suc sj)&quot;</span></span></span><span>
</span><span>                            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>e0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m = Suc sj&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d1</span><span> </span><span>d2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getx_es (cs k ! sj) k = e&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>f1</span><span> </span><span>c1</span><span> </span><span>c2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (&#8707;e. &#915; &#8866; cs k ! sj -es-EvtEnt e&#9839;k&#8594; cs k ! Suc sj)&quot;</span></span></span><span>
</span><span>                              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c2</span><span> </span><span>d1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (&#8707;e. &#915; &#8866; cs k ! sj -es-EvtEnt e&#9839;k&#8594; cs k ! Suc sj)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p3</span><span> </span><span>a2</span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;actk. &#915; &#8866; c ! sj -pes-actk&#8594; c ! Suc sj&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p3</span><span> </span><span>b0</span><span> </span><span>c1</span><span> </span><span>f1</span><span> </span><span>f3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8707;cmd. &#915; &#8866; cs k ! sj -es-Cmd cmd&#9839;k&#8594; cs k ! Suc sj) &#8744;
                                      &#915; &#8866; cs k ! sj -ese&#8594; cs k ! Suc sj&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>p5</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span>sj</span><span> </span><span>k</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                              </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>                                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8707;cmd. &#915; &#8866; cs k ! sj -es-Cmd cmd&#9839;k&#8594; cs k ! Suc sj)&quot;</span></span></span><span>
</span><span>                                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>cmd</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>g0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; cs k !sj -es-Cmd cmd&#9839;k&#8594; cs k ! Suc sj&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>f2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getx_es (cs k ! Suc sj) k = e&quot;</span></span></span><span> 
</span><span>                                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cmd_ines_nchg_x2</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k ! sj&quot;</span></span></span><span> </span><span>cmd</span><span> </span><span>k</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k ! Suc sj&quot;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>f1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                              </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>g0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; cs k ! sj -ese&#8594; cs k ! Suc sj&quot;</span></span></span><span>
</span><span>                                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p3</span><span> </span><span>a2</span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>g1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;actk. &#915; &#8866; c ! sj -pes-actk&#8594; c ! Suc sj&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span>c1</span><span> </span><span>f1</span><span> </span><span>f2</span><span> </span><span>g0</span><span> </span><span>g1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>p6</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span>sj</span><span> </span><span>k</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">}</span></span><span> 
</span><span>                      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*in c and cs, if there is no env trans in c and it is evtent on k at i, 
then the current event on k is the ent evt util a new evt ent*)</span></span></span></span></span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>evtent_impl_curevt_in_cpts_es1</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;&#915; c &#8733; cs; &#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. &#915; &#8866; c!j-pes-actk&#8594;c!Suc j)&#10215; 
      &#10233; &#8704;k i. Suc i &lt; length (cs k) &#8743; (&#915; &#8866; (cs k)!i -es-((EvtEnt e)&#9839;k)&#8594; (cs k)!(Suc i)) 
                &#10230; (&#8704;j. j &#8805; Suc i &#8743; Suc j &#8804; length (cs k) 
                        &#8743; (&#8704;m. m &gt; i &#8743; m &lt; j &#10230; &#172;(&#8707;e. &#915; &#8866; (cs k)!m -es-((EvtEnt e)&#9839;k)&#8594; (cs k)!(Suc m)))
                        &#10230; (&#8704;m. m &gt; i &#8743; m &#8804; j &#10230; getx_es ((cs k)!m) k = e))&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; c &#8733; cs&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. &#915; &#8866; c!j-pes-actk&#8594;c!Suc j)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span>p3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i k. Suc i &lt; length (cs k) &#8743; (&#8707;actk. &#915; &#8866; c ! i -pes-actk&#8594; c ! Suc i) 
                          &#8743; &#172; (&#8707;e. &#915; &#8866; cs k ! i -es-EvtEnt e&#9839;k&#8594; cs k ! Suc i) 
                                &#10230; (&#8707;cmd. &#915; &#8866; cs k ! i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc i) &#8744; &#915; &#8866; cs k ! i -ese&#8594; cs k ! Suc i&quot;</span></span></span><span>
</span><span>                              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>compt_notevtent_iscmd</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span>c</span><span> </span><span>cs</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8896;i k. Suc i &lt; length (cs k) &#8743; (&#8707;actk. &#915; &#8866; c ! i -pes-actk&#8594; c ! Suc i) 
                        &#8743; &#172; (&#8707;e. &#915; &#8866; cs k ! i -es-EvtEnt e&#9839;k&#8594; cs k ! Suc i) 
                                &#10233; (&#8707;cmd. &#915; &#8866; cs k ! i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc i) 
                                    &#8744; &#915; &#8866; cs k ! i -ese&#8594; cs k ! Suc i&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k i. Suc i &lt; length (cs k) &#8743; (&#8707;actk. &#915; &#8866; c ! i -pes-actk&#8594; c ! Suc i) 
                        &#8743; &#915; &#8866; cs k ! i -ese&#8594; cs k ! Suc i &#10230;
                        getx_es (cs k ! i) k = getx_es (cs k ! Suc i) k&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>etran_nchg_curevt</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span>c</span><span> </span><span>cs</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8896;i k. Suc i &lt; length (cs k) &#8743; (&#8707;actk. &#915; &#8866; c ! i -pes-actk&#8594; c ! Suc i) 
                        &#8743; &#915; &#8866; cs k ! i -ese&#8594; cs k ! Suc i &#10233;
                        getx_es (cs k ! i) k = getx_es (cs k ! Suc i) k&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>k</span><span> </span><span>i</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length (cs k) &#8743; (&#915; &#8866; (cs k)!i -es-((EvtEnt e)&#9839;k)&#8594; (cs k)!(Suc i))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>es1</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>s1</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a01</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(cs k)!i = (es1,s1,x1)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>prod_cases3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>es2</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>s2</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x2</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a02</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(cs k)!Suc i = (es2,s2,x2)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>prod_cases3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>        </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*from p2 have a1: &quot;cs k &#8712; cpts_es &#8743; cs k!0 = (evtsys_spec (fst (pesrgf k)), s, x)&quot; 
          by (simp add:cpts_of_es_def)*)</span></span></span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. length c = length (cs k)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>conjoin_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>c</span><span> </span><span>cs</span><span class="delimiter">]</span><span> </span><span>same_length_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>c</span><span> </span><span>cs</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. j &#8805; Suc i &#8743; Suc j &#8804; length (cs k) 
                        &#8743; (&#8704;m. m &gt; i &#8743; m &lt; j &#10230; &#172;(&#8707;e. &#915; &#8866; (cs k)!m -es-((EvtEnt e)&#9839;k)&#8594; (cs k)!(Suc m)))
                        &#10230; (&#8704;m. m &gt; i &#8743; m &#8804; j &#10230; getx_es ((cs k)!m) k = e)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>          </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>j</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j &#8805; Suc i &#8743; Suc j &#8804; length (cs k)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;m. m &gt; i &#8743; m &lt; j &#10230; &#172;(&#8707;e. &#915; &#8866; (cs k)!m -es-((EvtEnt e)&#9839;k)&#8594; (cs k)!(Suc m))&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;m. m &gt; i &#8743; m &#8804; j &#10230; getx_es ((cs k)!m) k = e&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>j</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>              </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>sj</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &#8804; sj &#8743; Suc sj &#8804; length (cs k) &#10233;
                                (&#8704;m. i &lt; m &#8743; m &lt; sj &#10230; &#172; (&#8707;e. &#915; &#8866; cs k ! m -es-EvtEnt e&#9839;k&#8594; cs k ! Suc m)) &#10233;
                                (&#8704;m. i &lt; m &#8743; m &#8804; sj &#10230; getx_es (cs k ! m) k = e)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &#8804; Suc sj &#8743; Suc (Suc sj) &#8804; length (cs k)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;m. i &lt; m &#8743; m &lt; Suc sj &#10230; &#172; (&#8707;e. &#915; &#8866; cs k ! m -es-EvtEnt e&#9839;k&#8594; cs k ! Suc m)&quot;</span></span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i = Suc sj&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i = Suc sj&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>                      </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>                        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>m</span><span>
</span><span>                        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i &lt; m &#8743; m &#8804; Suc sj&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getx_es (cs k ! Suc i) k = e&quot;</span></span></span><span> 
</span><span>                          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>entevt_ines_chg_selfx2</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k ! i&quot;</span></span></span><span> </span><span>e</span><span> </span><span>k</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k ! Suc i&quot;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getx_es (cs k ! m) k = e&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m = Suc i&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>f0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m = Suc i&quot;</span></span></span><span>
</span><span>                            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>e1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                          </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &#8800; Suc i&quot;</span></span></span><span>
</span><span>                            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d0</span><span> </span><span>e0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m = Suc (Suc i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c2</span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (&#8707;e. &#915; &#8866; cs k ! Suc i -es-EvtEnt e&#9839;k&#8594; cs k ! Suc (Suc i))&quot;</span></span></span><span>
</span><span>                              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_n_not_le_n</span><span> </span><span>e0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p3</span><span> </span><span>a2</span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;actk. &#915; &#8866; c ! Suc i -pes-actk&#8594; c ! Suc (Suc i)&quot;</span></span></span><span>
</span><span>                              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_le_lessD</span><span> </span><span>c1</span><span> </span><span>d0</span><span> </span><span>Suc_n_not_le_n</span><span> </span><span>e0</span><span> </span><span>f0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p3</span><span> </span><span>b0</span><span> </span><span>f1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8707;cmd. &#915; &#8866; cs k ! Suc i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc (Suc i)) &#8744;
                                      &#915; &#8866; cs k ! Suc i -ese&#8594; cs k ! Suc (Suc i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>p5</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&quot;</span></span></span><span> </span><span>k</span><span class="delimiter">]</span><span>
</span><span>                                        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_le_eq</span><span> </span><span>c1</span><span> </span><span>d0</span><span> </span><span>Suc_n_not_le_n</span><span> </span><span>e0</span><span> </span><span>f0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>                              </span><span class="keyword1"><span class="command">proof</span></span><span> 
</span><span>                                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;cmd. &#915; &#8866; cs k ! Suc i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc (Suc i)&quot;</span></span></span><span>
</span><span>                                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>cmd</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>g0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; cs k ! Suc i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc (Suc i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>e1</span><span> </span><span>f0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getx_es (cs k ! Suc (Suc i)) k = e&quot;</span></span></span><span> 
</span><span>                                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cmd_ines_nchg_x2</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k ! Suc i&quot;</span></span></span><span> </span><span>cmd</span><span> </span><span>k</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k ! Suc (Suc i)&quot;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>f0</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                              </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>g0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; cs k ! Suc i -ese&#8594; cs k ! Suc (Suc i)&quot;</span></span></span><span>
</span><span>                                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p3</span><span> </span><span>a2</span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>g1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;actk. &#915; &#8866; c ! Suc i -pes-actk&#8594; c ! Suc (Suc i)&quot;</span></span></span><span>
</span><span>                                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;&#8707;actk. &#915; &#8866; c ! Suc i -pes-actk&#8594; c ! Suc (Suc i)&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span>e1</span><span> </span><span>f0</span><span> </span><span>g0</span><span> </span><span>g1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>p6</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&quot;</span></span></span><span> </span><span>k</span><span class="delimiter">]</span><span>
</span><span>                                  </span><span>Suc_n_not_le_n</span><span> </span><span>d0</span><span> </span><span>e0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &#8800; Suc sj&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; Suc sj&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c0</span><span> </span><span>c1</span><span> </span><span>c2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;m. i &lt; m &#8743; m &#8804; sj &#10230; getx_es (cs k ! m) k = e&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>                        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>m</span><span>
</span><span>                        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i &lt; m &#8743; m &#8804; Suc sj&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; getx_es (cs k ! m) k = e&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i &lt; m &#8743; m &lt; Suc sj&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>f0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i &lt; m &#8743; m &lt; Suc sj&quot;</span></span></span><span>
</span><span>                            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d2</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                          </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>f0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(i &lt; m &#8743; m &lt; Suc sj)&quot;</span></span></span><span>
</span><span>                            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>e0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m = Suc sj&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d1</span><span> </span><span>d2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getx_es (cs k ! sj) k = e&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>f1</span><span> </span><span>c1</span><span> </span><span>c2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (&#8707;e. &#915; &#8866; cs k ! sj -es-EvtEnt e&#9839;k&#8594; cs k ! Suc sj)&quot;</span></span></span><span>
</span><span>                              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_less_SucD</span><span> </span><span>d1</span><span> </span><span>lessI</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c2</span><span> </span><span>d1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (&#8707;e. &#915; &#8866; cs k ! sj -es-EvtEnt e&#9839;k&#8594; cs k ! Suc sj)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p3</span><span> </span><span>a2</span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;actk. &#915; &#8866; c ! sj -pes-actk&#8594; c ! Suc sj&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p3</span><span> </span><span>b0</span><span> </span><span>c1</span><span> </span><span>f1</span><span> </span><span>f3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8707;cmd. &#915; &#8866; cs k ! sj -es-Cmd cmd&#9839;k&#8594; cs k ! Suc sj) &#8744;
                                      &#915; &#8866; cs k ! sj -ese&#8594; cs k ! Suc sj&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>p5</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span>sj</span><span> </span><span>k</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                              </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>                                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8707;cmd. &#915; &#8866; cs k ! sj -es-Cmd cmd&#9839;k&#8594; cs k ! Suc sj)&quot;</span></span></span><span>
</span><span>                                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>cmd</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>g0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; cs k !sj -es-Cmd cmd&#9839;k&#8594; cs k ! Suc sj&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>f2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getx_es (cs k ! Suc sj) k = e&quot;</span></span></span><span> 
</span><span>                                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cmd_ines_nchg_x2</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k ! sj&quot;</span></span></span><span> </span><span>cmd</span><span> </span><span>k</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k ! Suc sj&quot;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>f1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                              </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>g0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; cs k ! sj -ese&#8594; cs k ! Suc sj&quot;</span></span></span><span>
</span><span>                                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p3</span><span> </span><span>a2</span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>g1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;actk. &#915; &#8866; c ! sj -pes-actk&#8594; c ! Suc sj&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span>c1</span><span> </span><span>f1</span><span> </span><span>f2</span><span> </span><span>g0</span><span> </span><span>g1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>p6</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span>sj</span><span> </span><span>k</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">}</span></span><span> 
</span><span>                      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>evtent_impl_curevt_in_cpts_es2</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;&#915; c &#8733; cs; &#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. &#915; &#8866; c!j-pes-actk&#8594;c!Suc j)&#10215; 
      &#10233; &#8704;k i. Suc i &lt; length (cs k) &#8743; (&#915; &#8866; (cs k)!i -es-((EvtEnt e)&#9839;k)&#8594; (cs k)!(Suc i)) 
                &#10230; (&#8704;j. j &gt; i &#8743; Suc j &lt; length (cs k) 
                        &#8743; (&#8704;m. m &gt; i &#8743; m &lt; j &#10230; &#172;(&#8707;e. &#915; &#8866; (cs k)!m -es-((EvtEnt e)&#9839;k)&#8594; (cs k)!(Suc m)))
                        &#10230; (&#8704;m. m &gt; i &#8743; m &#8804; j &#10230; getx_es ((cs k)!m) k = e))&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; c &#8733; cs&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. &#915; &#8866; c!j-pes-actk&#8594;c!Suc j)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>k</span><span> </span><span>i</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length (cs k) &#8743; (&#915; &#8866; (cs k)!i -es-((EvtEnt e)&#9839;k)&#8594; (cs k)!(Suc i))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. j &gt; i &#8743; Suc j &lt; length (cs k) 
                        &#8743; (&#8704;m. m &gt; i &#8743; m &lt; j &#10230; &#172;(&#8707;e. &#915; &#8866; (cs k)!m -es-((EvtEnt e)&#9839;k)&#8594; (cs k)!(Suc m)))
                        &#10230; (&#8704;m. m &gt; i &#8743; m &#8804; j &#10230; getx_es ((cs k)!m) k = e)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>          </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>j</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j &gt; i &#8743; Suc j &lt; length (cs k)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;m. m &gt; i &#8743; m &lt; j &#10230; &#172;(&#8707;e. &#915; &#8866; (cs k)!m -es-((EvtEnt e)&#9839;k)&#8594; (cs k)!(Suc m))&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;m. m &gt; i &#8743; m &#8804; j &#10230; getx_es ((cs k)!m) k = e&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j = Suc i&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j = Suc i&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>a0</span><span> </span><span>entevt_ines_chg_selfx2</span><span> </span><span>le_SucE</span><span> </span><span>not_less</span><span class="delimiter">)</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j &#8800; Suc i&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j &gt; Suc i&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span>p3</span><span> </span><span>a0</span><span> </span><span>b0</span><span> </span><span>b1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtent_impl_curevt_in_cpts_es</span><span class="delimiter">[</span><span>of</span><span> </span><span>c</span><span> </span><span>cs</span><span> </span><span>i</span><span> </span><span>k</span><span> </span><span>e</span><span> </span><span>j</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*for any evt sys computations, if it is a evtseq at m and there is no evtent before m, 
then it is a evtseq on all position before m*)</span></span></span></span></span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>anonyevtseq_and_noet_impl_allanonyevtseq_bef</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;esl &#8712; cpts_es &#915; &#10233;
    &#8704;m &lt; length esl. (&#8707;e es. getspc_es (esl!m) = EvtSeq e es &#8743; is_anonyevt e) 
                      &#10230; (&#8704;i &lt; m. &#172; (&#8707;e k. &#915; &#8866; esl ! i -es-EvtEnt e&#9839;k&#8594; esl ! Suc i)) 
                      &#10230; (&#8704;i &lt; m. &#8707;e es. getspc_es (esl!i) = EvtSeq e es &#8743; is_anonyevt e)&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl &#8712; cpts_es &#915; &quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>m</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &lt; length esl&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e es. getspc_es (esl!m) = EvtSeq e es &#8743; is_anonyevt e&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i &lt; m. &#172; (&#8707;e k. &#915; &#8866; esl ! i -es-EvtEnt e&#9839;k&#8594; esl ! Suc i)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i &lt; m. &#8707;e es. getspc_es (esl!i) = EvtSeq e es &#8743; is_anonyevt e&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>m</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>n</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;n &lt; length esl &#10233;
                      &#8707;e es. getspc_es (esl ! n) = EvtSeq e es &#8743; is_anonyevt e &#10233;
                      &#8704;i &lt; n. &#172; (&#8707;e k. &#915; &#8866; esl ! i -es-EvtEnt e&#9839;k&#8594; esl ! Suc i) &#10233;
                      &#8704;i &lt; n. &#8707;e es. getspc_es (esl ! i) = EvtSeq e es &#8743; is_anonyevt e&quot;</span></span></span><span>
</span><span>            </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc n &lt; length esl&quot;</span></span></span><span>
</span><span>            </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e es. getspc_es (esl ! Suc n) = EvtSeq e es &#8743; is_anonyevt e&quot;</span></span></span><span>
</span><span>            </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i &lt; Suc n. &#172; (&#8707;e k. &#915; &#8866; esl ! i -es-EvtEnt e&#9839;k&#8594; esl ! Suc i)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;n = 0&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;n = 0&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (&#8707;e k. &#915; &#8866; esl ! 0 -es-EvtEnt e&#9839;k&#8594; esl ! 1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p0</span><span> </span><span>b1</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; esl ! 0 -ese&#8594; esl ! 1 &#8744; (&#8707;c k. &#915; &#8866; esl ! 0 -es-Cmd c&#9839;k&#8594; esl ! 1)&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>notevtent_cptses_isenvorcmd</span><span class="delimiter">[</span><span>of</span><span> </span><span>esl</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e es. getspc_es (esl ! 0) = EvtSeq e es &#8743; is_anonyevt e&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>                  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; esl ! 0 -ese&#8594; esl ! 1&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b2</span><span> </span><span>c0</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>esetran_eqconf1</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl ! 0&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl ! 1&quot;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;c k. &#915; &#8866; esl ! 0 -es-Cmd c&#9839;k&#8594; esl ! 1&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>c</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>k</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; esl ! 0 -es-Cmd c&#9839;k&#8594; esl ! 1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cmd_enable_impl_anonyevt2</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl ! 0&quot;</span></span></span><span> </span><span>c</span><span> </span><span>k</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl ! 1&quot;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c0</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>              </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;n &#8800; 0&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;n &gt; 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b1</span><span> </span><span>b3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (&#8707;e k. &#915; &#8866; esl ! n -es-EvtEnt e&#9839;k&#8594; esl ! Suc n)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop n esl&#8712;cpts_es &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_es_dropi2</span><span class="delimiter">[</span><span>of</span><span> </span><span>esl</span><span> </span><span>&#915;</span><span> </span><span>n</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>              </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;2 &#8804; length (drop n esl)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>              </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop n esl ! 0 = esl ! n&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b1</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop n esl ! 1 = esl ! Suc n&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; esl ! n -ese&#8594; esl ! Suc n &#8744; (&#8707;c k. &#915; &#8866; esl ! n -es-Cmd c&#9839;k&#8594; esl ! Suc n)&quot;</span></span></span><span> 
</span><span>                </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>notevtent_cptses_isenvorcmd</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop n esl&quot;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>                </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>                  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; esl ! n -ese&#8594; esl ! Suc n&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b2</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e es. getspc_es (esl ! n) = EvtSeq e es &#8743; is_anonyevt e&quot;</span></span></span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>esetran_eqconf1</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;esl ! n&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl ! Suc n&quot;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b0</span><span> </span><span>b1</span><span> </span><span>b2</span><span> </span><span>b3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i &lt; n. &#8707;e es. getspc_es (esl ! i) = EvtSeq e es &#8743; is_anonyevt e&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>less_Suc_eq</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;c k. &#915; &#8866; esl ! n -es-Cmd c&#9839;k&#8594; esl ! Suc n&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>c1</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>k1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; esl ! n -es-Cmd c1&#9839;k1&#8594; esl ! Suc n&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e e&#39; es1. getspc_es (esl ! n) = EvtSeq e es1 &#8743; e = AnonyEvent e&#39;&quot;</span></span></span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cmd_enable_impl_anonyevt2</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(esl ! n)&quot;</span></span></span><span> </span><span>c1</span><span> </span><span>k1</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl ! Suc n&quot;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b0</span><span> </span><span>b1</span><span> </span><span>b2</span><span> </span><span>b3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i &lt; n. &#8707;e es. getspc_es (esl ! i) = EvtSeq e es &#8743; is_anonyevt e&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>is_anonyevt.simps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>less_Suc_eq</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*for any evt sys computations, if it is a evtseq at m and there is no evtent before m, 
then it is a evtseq on all position before m*)</span></span></span></span></span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>anonyevtseq_and_noet_impl_allanonyevtseq_bef3</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;&#915; c &#8733; cs; cs k &#8712; cpts_es &#915;; m &lt; length (cs k)&#10215; &#10233;
    (&#8707;e es. getspc_es ((cs k)!m) = EvtSeq e es &#8743; is_anonyevt e) 
                      &#10230; (&#8704;i &lt; m. &#172; (&#8707;e. &#915; &#8866; (cs k) ! i -es-EvtEnt e&#9839;k&#8594; (cs k) ! Suc i)) 
                      &#10230; (&#8704;i &lt; m. &#8707;e es. getspc_es ((cs k)!i) = EvtSeq e es &#8743; is_anonyevt e)&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(cs k) &#8712; cpts_es &#915;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; c &#8733; cs&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &lt; length (cs k)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e es. getspc_es ((cs k)!m) = EvtSeq e es &#8743; is_anonyevt e&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i &lt; m. &#172; (&#8707;e. &#915; &#8866; (cs k) ! i -es-EvtEnt e&#9839;k&#8594; (cs k) ! Suc i)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i &lt; m. &#8707;e es. getspc_es ((cs k)!i) = EvtSeq e es &#8743; is_anonyevt e&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>m</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>n</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;n &lt; length (cs k) &#10233;
                      &#8707;e es. getspc_es ((cs k) ! n) = EvtSeq e es &#8743; is_anonyevt e &#10233;
                      &#8704;i &lt; n. &#172; (&#8707;e. &#915; &#8866; (cs k) ! i -es-EvtEnt e&#9839;k&#8594; (cs k) ! Suc i) &#10233;
                      &#8704;i &lt; n. &#8707;e es. getspc_es ((cs k) ! i) = EvtSeq e es &#8743; is_anonyevt e&quot;</span></span></span><span>
</span><span>            </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc n &lt; length (cs k)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e es. getspc_es ((cs k) ! Suc n) = EvtSeq e es &#8743; is_anonyevt e&quot;</span></span></span><span>
</span><span>            </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i &lt; Suc n. &#172; (&#8707;e. &#915; &#8866; (cs k) ! i -es-EvtEnt e&#9839;k&#8594; (cs k) ! Suc i)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;n = 0&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;n = 0&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (&#8707;e. &#915; &#8866; (cs k) ! 0 -es-EvtEnt e&#9839;k&#8594; (cs k) ! 1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>b1</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (cs k) ! 0 -ese&#8594; (cs k) ! 1 &#8744; (&#8707;c. &#915; &#8866; (cs k) ! 0 -es-Cmd c&#9839;k&#8594; (cs k) ! 1)&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>acts_in_conjoin_cpts</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>One_nat_def</span><span class="delimiter">)</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e es. getspc_es ((cs k) ! 0) = EvtSeq e es &#8743; is_anonyevt e&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>                  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (cs k) ! 0 -ese&#8594; (cs k) ! 1&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b2</span><span> </span><span>c0</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>esetran_eqconf1</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(cs k) ! 0&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(cs k) ! 1&quot;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;c. &#915; &#8866; (cs k) ! 0 -es-Cmd c&#9839;k&#8594; (cs k) ! 1&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>c</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>k</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (cs k) ! 0 -es-Cmd c&#9839;k&#8594; (cs k) ! 1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cmd_enable_impl_anonyevt2</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(cs k) ! 0&quot;</span></span></span><span> </span><span>c</span><span> </span><span>k</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(cs k) ! 1&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>cmd_enable_impl_anonyevt2</span><span> </span><span>d0</span><span> </span><span>is_anonyevt.simps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c0</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>              </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;n &#8800; 0&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;n &gt; 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b1</span><span> </span><span>b3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (&#8707;e. &#915; &#8866; (cs k) ! n -es-EvtEnt e&#9839;k&#8594; (cs k) ! Suc n)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (cs k) ! n -ese&#8594; (cs k) ! Suc n &#8744; (&#8707;c. &#915; &#8866; (cs k) ! n -es-Cmd c&#9839;k&#8594; (cs k) ! Suc n)&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>acts_in_conjoin_cpts</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>                </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>                  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (cs k) ! n -ese&#8594; (cs k) ! Suc n&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b2</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e es. getspc_es ((cs k) ! n) = EvtSeq e es &#8743; is_anonyevt e&quot;</span></span></span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>esetran_eqconf1</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(cs k) ! n&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(cs k) ! Suc n&quot;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b0</span><span> </span><span>b1</span><span> </span><span>b2</span><span> </span><span>b3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i &lt; n. &#8707;e es. getspc_es ((cs k) ! i) = EvtSeq e es &#8743; is_anonyevt e&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>less_Suc_eq</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;c. &#915; &#8866; (cs k) ! n -es-Cmd c&#9839;k&#8594; (cs k) ! Suc n&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>c1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (cs k) ! n -es-Cmd c1&#9839;k&#8594; (cs k) ! Suc n&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e e&#39; es1. getspc_es ((cs k) ! n) = EvtSeq e es1 &#8743; e = AnonyEvent e&#39;&quot;</span></span></span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cmd_enable_impl_anonyevt2</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((cs k) ! n)&quot;</span></span></span><span> </span><span>c1</span><span> </span><span>k</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(cs k) ! Suc n&quot;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b0</span><span> </span><span>b1</span><span> </span><span>b2</span><span> </span><span>b3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i &lt; n. &#8707;e es. getspc_es ((cs k) ! i) = EvtSeq e es &#8743; is_anonyevt e&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>is_anonyevt.simps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>less_Suc_eq</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*in a computation of ``EvtSeq ev esys&#39;&#39;, if there is no esys at any position, 
then it should be EvtSeq e&#39; esys at any positino*)</span></span></span></span></span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>evtseq_noesys_allevtseq</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;esl&#8712;cpts_es &#915;; esl = (EvtSeq ev esys, s, x) # esl1; 
        (&#8704;i. Suc i &#8804; length esl &#10230; getspc_es (esl ! i) &#8800; esys)&#10215;
        &#10233; (&#8704;i &lt; length esl. &#8707;e&#39;. getspc_es (esl ! i) = EvtSeq e&#39; esys)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;cpts_es &#915;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl = (EvtSeq ev esys, s, x) # esl1&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &#8804; length esl &#10230; getspc_es (esl ! i) &#8800; esys&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i &lt; length esl&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e&#39;. getspc_es (esl ! i) = EvtSeq e&#39; esys&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>i</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>getspc_es_def</span><span> </span><span>fst_conv</span><span> </span><span>nth_Cons_0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>ii</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ii &lt; length esl &#10233; &#8707;e&#39;. getspc_es (esl ! ii) = EvtSeq e&#39; esys&quot;</span></span></span><span>
</span><span>            </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc ii &lt; length esl&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>e&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl ! ii) = EvtSeq e&#39; esys&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl!Suc ii) = esys &#8744; (&#8707;e. getspc_es (esl!Suc ii) = EvtSeq e esys)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtseq_next_in_cpts</span><span class="delimiter">[</span><span>of</span><span> </span><span>esl</span><span> </span><span>&#915;</span><span> </span><span>e&#39;</span><span> </span><span>esys</span><span class="delimiter">]</span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p2</span><span> </span><span>b1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>evtseq_noesys_allevtseq2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;esl&#8712;cpts_es &#915;; esl = (EvtSeq ev esys, s, x) # esl1; &#172; is_basicevt ev;
        (&#8704;i. Suc i &#8804; length esl &#10230; getspc_es (esl ! i) &#8800; esys)&#10215;
        &#10233; (&#8704;i &lt; length esl. &#8707;e&#39;. &#172; is_basicevt e&#39; &#8743; getspc_es (esl ! i) = EvtSeq e&#39; esys)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;cpts_es &#915;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl = (EvtSeq ev esys, s, x) # esl1&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; is_basicevt ev&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &#8804; length esl &#10230; getspc_es (esl ! i) &#8800; esys&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i &lt; length esl&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e&#39;. &#172; is_basicevt e&#39; &#8743; getspc_es (esl ! i) = EvtSeq e&#39; esys&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>i</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>getspc_es_def</span><span> </span><span>fst_conv</span><span> </span><span>nth_Cons_0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>ii</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ii &lt; length esl &#10233; &#8707;e&#39;. &#172; is_basicevt e&#39; &#8743; getspc_es (esl ! ii) = EvtSeq e&#39; esys&quot;</span></span></span><span>
</span><span>            </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc ii &lt; length esl&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e&#39;. &#172; is_basicevt e&#39; &#8743; getspc_es (esl ! ii) = EvtSeq e&#39; esys&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>e&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>b3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; is_basicevt e&#39; &#8743; getspc_es (esl ! ii) = EvtSeq e&#39; esys&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b1</span><span> </span><span>b2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl!Suc ii) = esys &#8744; (&#8707;e. getspc_es (esl!Suc ii) = EvtSeq e esys)&quot;</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtseq_next_in_cpts</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span>esl</span><span class="delimiter">]</span><span> </span><span>p0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p3</span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e. getspc_es (esl!Suc ii) = EvtSeq e esys&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>e</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>b4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl!Suc ii) = EvtSeq e esys&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p0</span><span> </span><span>b2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; is_basicevt e&quot;</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>            </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>              </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;is_basicevt e&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>be</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;e = BasicEvent be&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>event.exhaust</span><span> </span><span>is_basicevt.simps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">)</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p0</span><span> </span><span>b1</span><span> </span><span>b3</span><span> </span><span>b4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl ! ii) = EvtSeq (BasicEvent be) esys&quot;</span></span></span><span> 
</span><span>                </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>only_envtran_to_basicevt</span><span class="delimiter">[</span><span>of</span><span> </span><span>esl</span><span> </span><span>&#915;</span><span> </span><span>esys</span><span> </span><span>be</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>              </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b3</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;False&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>is_basicevt_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b4</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* if all conf are evtseq in a computation, then confs are same before the evtent, 
and confs are evtseq (with esys) after the evtent *)</span></span></span></span></span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>evtseq_evtent_befaft</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;esl&#8712;cpts_es &#915;; esl = (EvtSeq ev esys, s, x) # esl1; 
        (&#8704;i. Suc i &#8804; length esl &#10230; getspc_es (esl ! i) &#8800; esys);
        (&#8707;e k. m &lt;length esl - 1 &#8743; &#915; &#8866; esl ! m -es-EvtEnt e&#9839;k&#8594; esl ! Suc m)&#10215; &#10233; 
         is_basicevt ev &#8743; (&#8704;i. i &#8804; m &#10230; getspc_es (esl ! i) = EvtSeq ev esys) 
         &#8743; (&#8704;i. i &gt; m &#8743; i &lt; length esl &#10230; (&#8707;e&#39;. &#172; is_basicevt e&#39; &#8743; getspc_es (esl ! i) = EvtSeq e&#39; esys))&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;cpts_es &#915;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl = (EvtSeq ev esys, s, x) # esl1&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &#8804; length esl &#10230; getspc_es (esl ! i) &#8800; esys&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e k. m &lt;length esl - 1 &#8743; &#915; &#8866; esl ! m -es-EvtEnt e&#9839;k&#8594; esl ! Suc m&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i &lt; length esl. &#8707;e&#39;. getspc_es (esl ! i) = EvtSeq e&#39; esys&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtseq_noesys_allevtseq</span><span class="delimiter">[</span><span>of</span><span> </span><span>esl</span><span> </span><span>ev</span><span> </span><span>esys</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>esl1</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p3</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>e</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>k</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &lt;length esl - 1 &#8743; &#915; &#8866; esl ! m -es-EvtEnt e&#9839;k&#8594; esl ! Suc m&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a0</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>e&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl ! m) = EvtSeq e&#39; esys&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>length_Cons</span><span> </span><span>length_tl</span><span> </span><span>less_SucI</span><span> </span><span>list.sel</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>p1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;e = e&#39; &#8743; (&#8707;e&#39;&#39;. e&#39; = BasicEvent e&#39;&#39;)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtent_is_basicevt_inevtseq2</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl ! m&quot;</span></span></span><span> </span><span>e</span><span> </span><span>k</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl ! Suc m&quot;</span></span></span><span> </span><span>e&#39;</span><span> </span><span>esys</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>be</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;e&#39; = BasicEvent be&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. i &#8804; m &#10230; getspc_es ((drop (m - i) esl) ! 0) = EvtSeq e esys&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i &#8804; m&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es ((drop (m - i) esl) ! 0) = EvtSeq e esys&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>i</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>ii</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ii &#8804; m &#10233; getspc_es (drop (m - ii) esl ! 0) = EvtSeq e esys&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc ii &#8804; m&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length esl &#8743;
                  (&#8707;e. getspc_es (esl ! i) = EvtSeq e esys) &#8743; getspc_es (esl ! Suc i) = EvtSeq (BasicEvent be) esys &#10230;
                  getspc_es (esl ! i) = EvtSeq (BasicEvent be) esys&quot;</span></span></span><span> 
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>only_envtran_to_basicevt</span><span class="delimiter">[</span><span>of</span><span> </span><span>esl</span><span> </span><span>&#915;</span><span> </span><span>esys</span><span> </span><span>be</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c01</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8896;i. Suc i &lt; length esl &#8743;
                  (&#8707;e. getspc_es (esl ! i) = EvtSeq e esys) &#8743; getspc_es (esl ! Suc i) = EvtSeq (BasicEvent be) esys &#10230;
                  getspc_es (esl ! i) = EvtSeq (BasicEvent be) esys&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c0</span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (drop (m - ii) esl ! 0) = EvtSeq e esys&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a1</span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop (m - Suc ii) esl ! 0 = esl ! (m - Suc ii)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a1</span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop (m - ii) esl ! 0 = esl ! (m - ii)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8707;e. getspc_es (esl ! (m - Suc ii)) = EvtSeq e esys)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>p0</span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span>c0</span><span> </span><span>c1</span><span> </span><span>c01</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(m - Suc ii)&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>              </span><span>Suc_diff_Suc</span><span> </span><span>Suc_le_lessD</span><span> </span><span>length_Cons</span><span> </span><span>length_tl</span><span> </span><span>less_SucI</span><span> </span><span>less_imp_diff_less</span><span> 
</span><span>              </span><span>list.sel</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>p1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl ! 0) = EvtSeq e esys&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a51</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ev =  e&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>getspc_es_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>esys.inject</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>fst_conv</span><span> </span><span>nth_Cons_0</span><span class="delimiter">)</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. i &#8804; m &#10230; getspc_es (esl ! i) = EvtSeq ev esys&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Cons_nth_drop_Suc</span><span> </span><span>a1</span><span> </span><span>diff_diff_cancel</span><span> </span><span>diff_le_self</span><span> 
</span><span>        </span><span>le_less_trans</span><span> </span><span>length_Cons</span><span> </span><span>length_tl</span><span> </span><span>less_SucI</span><span> </span><span>list.sel</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>nth_Cons_0</span><span> </span><span>p1</span><span class="delimiter">)</span><span> 
</span><span>    
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?esl</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop (Suc m) esl&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl&#8712;cpts_es &#915;&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_mono</span><span> </span><span>cpts_es_dropi</span><span> </span><span>length_Cons</span><span> </span><span>length_tl</span><span> </span><span>list.sel</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a1</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>esc1</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>s1</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x1</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>esc2</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>s2</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x2</span><span> 
</span><span>      </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl ! m = (esc1,s1,x1) &#8743; esl ! Suc m = (esc2,s2,x2) &#8743; &#915; &#8866; (esc1,s1,x1) -es-EvtEnt e&#9839;k&#8594; (esc2,s2,x2)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>prod_cases3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a7</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e. &#172; is_basicevt e &#8743; getspc_es (?esl!0) = EvtSeq e esys&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>is_basicevt_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>estran.cases</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>a2</span><span> </span><span>esys.simps</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span>fst_conv</span><span> </span><span>getspc_es_def</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>get_actk_def</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>Cons_nth_drop_Suc</span><span> </span><span>Suc_mono</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>ent_spec2&#39;</span><span> 
</span><span>        </span><span>esys.inject</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>event.simps</span><span class="delimiter">(</span><span>7</span><span class="delimiter">)</span><span> </span><span>fst_conv</span><span> </span><span>getspc_es_def</span><span> </span><span>length_Cons</span><span> </span><span>length_tl</span><span> </span><span>list.sel</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>nth_Cons_0</span><span> </span><span>p1</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Suc_leI</span><span> </span><span>Suc_le_mono</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>esys.inject</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>fst_conv</span><span> 
</span><span>          </span><span>getspc_es_def</span><span> </span><span>length_Cons</span><span> </span><span>length_tl</span><span> </span><span>list.sel</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>p1</span><span> </span><span>p2</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>e1</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>s3</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x3</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; is_basicevt e1 &#8743; ?esl!0 = (EvtSeq e1 esys,s3,x3)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fst_conv</span><span> </span><span>getspc_es_def</span><span> </span><span>surj_pair</span><span class="delimiter">)</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &#8804; length ?esl &#10230; getspc_es (?esl ! i) &#8800; esys&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p2</span><span> </span><span>a6</span><span> </span><span>a7</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i &lt; length ?esl. &#8707;e&#39;. &#172; is_basicevt e&#39; &#8743; getspc_es (?esl ! i) = EvtSeq e&#39; esys&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtseq_noesys_allevtseq2</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?esl</span><span> </span><span>e1</span><span> </span><span>esys</span><span> </span><span>s3</span><span> </span><span>x3</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> 
</span><span>        </span><span>Cons_nth_drop_Suc</span><span> </span><span>Suc_mono</span><span> </span><span>a1</span><span> </span><span>length_Cons</span><span> </span><span>length_tl</span><span> </span><span>list.sel</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>nth_Cons_0</span><span> </span><span>p1</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. i &gt; m &#8743; i &lt; length esl &#10230; (&#8707;e&#39;. &#172; is_basicevt e&#39; &#8743; getspc_es (esl ! i) = EvtSeq e&#39; esys)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i &gt; m &#8743; i &lt; length esl&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl ! i = ?esl ! (i - Suc m)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i - Suc m &#8805; 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i - Suc m &lt; length ?esl&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e&#39;. &#172; is_basicevt e&#39; &#8743; getspc_es (?esl ! (i - Suc m)) = EvtSeq e&#39; esys&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a8</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a1</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span>a51</span><span> </span><span>r1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*if first is EvtSys es, then all confs are EvtSys es or EvtSeq e&#39; es (e&#39; is anony evt)*)</span></span></span></span></span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>evtsys_allevtseqorevtsys</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;esl&#8712;cpts_es &#915;; esl = (EvtSys es, s, x) # esl1&#10215;
        &#10233; (&#8704;i &lt; length esl. getspc_es (esl ! i) = EvtSys es 
                              &#8744; (&#8707;e&#39;. is_anonyevt e&#39; &#8743; getspc_es (esl ! i) = EvtSeq e&#39; (EvtSys es)))&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;cpts_es &#915;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl = (EvtSys es, s, x) # esl1&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i &lt; length esl&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl ! i) = EvtSys es &#8744; 
                (&#8707;e&#39;. is_anonyevt e&#39; &#8743; getspc_es (esl ! i) = EvtSeq e&#39; (EvtSys es))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>i</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>p1</span><span> </span><span>getspc_es_def</span><span> </span><span>fst_conv</span><span> </span><span>nth_Cons_0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>ii</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ii &lt; length esl &#10233; getspc_es (esl ! ii) = EvtSys es &#8744; 
            (&#8707;e&#39;. is_anonyevt e&#39; &#8743; getspc_es (esl ! ii) = EvtSeq e&#39; (EvtSys es))&quot;</span></span></span><span>
</span><span>            </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc ii &lt; length esl&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>esc1</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>s1</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>b2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl ! ii = (esc1,s1,x1)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>prod_cases3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>  
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>esc2</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>s2</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x2</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>b3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl ! Suc ii = (esc2,s2,x2)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>prod_cases3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>  
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span>b1</span><span> </span><span>b2</span><span> </span><span>b3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (esc1,s1,x1) -ese&#8594; (esc2,s2,x2) &#8744; (&#8707;et. &#915; &#8866; (esc1,s1,x1) -es-et&#8594; (esc2,s2,x2))&quot;</span></span></span><span> 
</span><span>                </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>incpts_es_impl_evnorcomptran</span><span class="delimiter">[</span><span>of</span><span> </span><span>esl</span><span> </span><span>&#915;</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl ! ii) = EvtSys es &#8744; 
            (&#8707;e&#39;. is_anonyevt e&#39; &#8743; getspc_es (esl ! ii) = EvtSeq e&#39; (EvtSys es))&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>            </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>              </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl ! ii) = EvtSys es&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esc1 = EvtSys es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>getspc_es_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fst_conv</span><span class="delimiter">)</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esc2 = EvtSys es &#8744; (&#8707;e&#39;. is_anonyevt e&#39; &#8743; esc2 = EvtSeq e&#39; (EvtSys es))&quot;</span></span></span><span> 
</span><span>                </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>                  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (esc1,s1,x1) -ese&#8594; (esc2,s2,x2)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esc1 = esc2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>esetran_eqconf</span><span class="delimiter">)</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;et. &#915; &#8866; (esc1,s1,x1) -es-et&#8594; (esc2,s2,x2)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>et</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (esc1,s1,x1) -es-et&#8594; (esc2,s2,x2)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e&#39;. is_anonyevt e&#39; &#8743; esc2 = EvtSeq e&#39; (EvtSys es)&quot;</span></span></span><span> 
</span><span>                    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>clarsimp</span><span> </span><span>simp</span><span class="delimiter">:</span><span>is_anonyevt_def</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>estran.cases</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>get_actk_def</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>                    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>etran.cases</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span class="delimiter">+</span><span>
</span><span>                    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b2</span><span> </span><span>b3</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>getspc_es_def</span><span> </span><span>fst_conv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>              </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e&#39;. is_anonyevt e&#39; &#8743; getspc_es (esl ! ii) = EvtSeq e&#39; (EvtSys es)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>e&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;is_anonyevt e&#39; &#8743; getspc_es (esl ! ii) = EvtSeq e&#39; (EvtSys es)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esc1 = EvtSeq e&#39; (EvtSys es)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>getspc_es_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fst_conv</span><span class="delimiter">)</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esc2 =EvtSys es &#8744; (&#8707;e&#39;. is_anonyevt e&#39; &#8743; esc2 = EvtSeq e&#39; (EvtSys es))&quot;</span></span></span><span> 
</span><span>                </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>                  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (esc1,s1,x1) -ese&#8594; (esc2,s2,x2)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esc1 = esc2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>esetran_eqconf</span><span class="delimiter">)</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c1</span><span> </span><span>c2</span><span> </span><span>d0</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;et. &#915; &#8866; (esc1,s1,x1) -es-et&#8594; (esc2,s2,x2)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>et</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (esc1,s1,x1) -es-et&#8594; (esc2,s2,x2)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c1</span><span> </span><span>c2</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>clarsimp</span><span> </span><span>simp</span><span class="delimiter">:</span><span>is_anonyevt_def</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>estran.cases</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>get_actk_def</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>                    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>etran.cases</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span class="delimiter">+</span><span>
</span><span>                    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b2</span><span> </span><span>b3</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>getspc_es_def</span><span> </span><span>fst_conv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*if first is EvtSys es, then before each evtent is the EvtSys es*)</span></span></span></span></span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>evtsys_befevtent_isevtsys</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;esl&#8712;cpts_es &#915;; esl = (EvtSys es, s, x) # esl1&#10215;
        &#10233; &#8704;i. Suc i &lt; length esl &#8743; (&#8707;e k. &#915; &#8866; esl ! i -es-EvtEnt e&#9839;k&#8594; esl ! Suc i) &#10230; getspc_es (esl!i) = EvtSys es&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;cpts_es &#915;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl = (EvtSys es, s, x) # esl1&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length esl&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8707;e k. &#915; &#8866; esl ! i -es-EvtEnt e&#9839;k&#8594; esl ! Suc i)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl ! i) = EvtSys es &#8744; (&#8707;e&#39;. is_anonyevt e&#39; &#8743; getspc_es (esl ! i) = EvtSeq e&#39; (EvtSys es))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtsys_allevtseqorevtsys</span><span class="delimiter">[</span><span>of</span><span> </span><span>esl</span><span> </span><span>es</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>esl1</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>esc1</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>s1</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl ! i = (esc1,s1,x1)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>prod_cases3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>  
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>esc2</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>s2</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x2</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl ! Suc i = (esc2,s2,x2)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>prod_cases3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>e</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>k</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (esc1,s1,x1)-es-EvtEnt e&#9839;k&#8594;(esc2,s2,x2)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a00</span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esc1 = EvtSys es &#8744; (&#8707;e&#39;. is_anonyevt e&#39; &#8743; esc1 = EvtSeq e&#39; (EvtSys es))&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>getspc_es_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fst_conv</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#8707;e&#39;. is_anonyevt e&#39; &#8743; esc1 = EvtSeq e&#39; (EvtSys es))&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>get_actk_def</span><span> </span><span>is_anonyevt_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>estran.cases</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span class="delimiter">+</span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>etran.cases</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>get_actk_def</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>etran.cases</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>get_actk_def</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esc1 = EvtSys es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl!i) = EvtSys es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>getspc_es_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fst_conv</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*for a computations of event system, all ent events are basic events of its first configuration*)</span></span></span></span></span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>allentev_isin_basicevts</span><span class="delimiter">:</span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;(esl) esc s x esl1 e k. esl&#8712;cpts_es &#915; &#8743; esl = (esc,s,x)#esl1 &#10230;
          (&#8704;m&lt;length esl - 1. (&#915; &#8866; esl ! m -es-EvtEnt e&#9839;k&#8594; esl ! Suc m) &#10230; e&#8712;all_basicevts_es esc)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>esc</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;(esl) s x esl1 e k. esl&#8712;cpts_es &#915; &#8743; esl = (esc,s,x)#esl1 &#10230;
          (&#8704;m&lt;length esl - 1. (&#915; &#8866; esl ! m -es-EvtEnt e&#9839;k&#8594; esl ! Suc m) &#10230; e&#8712;all_basicevts_es esc)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>esc</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>EvtSeq</span><span> </span><span>ev</span><span> </span><span>esys</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;esl s x esl1 e k.
                     esl &#8712; cpts_es &#915; &#8743; esl = (esys, s, x) # esl1 &#10230;
                     (&#8704;i&lt;length esl - 1. (&#915; &#8866; esl ! i -es-EvtEnt e&#9839;k&#8594; esl ! Suc i) &#10230; e &#8712; all_basicevts_es esys)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8896;esl s x esl1 e k.
                     esl &#8712; cpts_es &#915; &#8743; esl = (esys, s, x) # esl1 &#10233;
                     (&#8704;i&lt;length esl - 1. (&#915; &#8866; esl ! i -es-EvtEnt e&#9839;k&#8594; esl ! Suc i) &#10230; e &#8712; all_basicevts_es esys)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>esl</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>esl1</span><span> </span><span>e</span><span> </span><span>k</span><span>
</span><span>          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl &#8712; cpts_es &#915; &#8743; esl = (EvtSeq ev esys, s, x) # esl1&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>m</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m&lt;length esl - 1&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; esl ! m -es-EvtEnt e&#9839;k&#8594; esl ! Suc m&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;e &#8712; all_basicevts_es (EvtSeq ev esys)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &#8804; length esl &#10230; getspc_es (esl ! i) &#8800; esys&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &#8804; length esl &#10230; getspc_es (esl ! i) &#8800; esys&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b0</span><span> </span><span>c0</span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;is_basicevt ev &#8743; (&#8704;i. i &#8804; m &#10230; getspc_es (esl ! i) = EvtSeq ev esys)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtseq_evtent_befaft</span><span class="delimiter">[</span><span>of</span><span> </span><span>esl</span><span> </span><span>ev</span><span> </span><span>esys</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>esl1</span><span> </span><span>m</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl ! m) = EvtSeq ev esys&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;e = ev&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtent_is_basicevt_inevtseq2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>all_basicevts_es.simps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>insertI1</span><span class="delimiter">)</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#8704;i. Suc i &#8804; length esl &#10230; getspc_es (esl ! i) &#8800; esys)&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;m. Suc m &#8804; length esl &#8743; getspc_es (esl ! m) = esys&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>m1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc m1 &#8804; length esl &#8743; getspc_es (esl ! m1) = esys&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;i. i &#8804; m1 &#8743; getspc_es (esl ! i) = esys&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b0</span><span> </span><span>d1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;i. (i &#8804; m1 &#8743; getspc_es (esl ! i) = esys) 
                                    &#8743; (&#8704;j. j &lt; i &#10230; getspc_es (esl ! j) &#8800; esys)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtseq_fst_finish</span><span class="delimiter">[</span><span>of</span><span> </span><span>esl</span><span> </span><span>&#915;</span><span> </span><span>ev</span><span> </span><span>esys</span><span> </span><span>m1</span><span class="delimiter">]</span><span> </span><span>getspc_es_def</span><span> </span><span>fst_conv</span><span> </span><span>nth_Cons&#39;</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>n</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>d3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(n &#8804; m1 &#8743; getspc_es (esl ! n) = esys) 
                                          &#8743; (&#8704;j. j &lt; n &#10230; getspc_es (esl ! j) &#8800; esys)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span>d3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;n &#8800; 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Groups.add_ac</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> 
</span><span>                    </span><span>Suc_n_not_le_n</span><span> </span><span>add.right_neutral</span><span> </span><span>add_Suc_right</span><span> </span><span>esys.size</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>fst_conv</span><span> 
</span><span>                    </span><span>getspc_es_def</span><span> </span><span>le_add1</span><span> </span><span>nth_Cons&#39;</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d4</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;n &gt; 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                
</span><span>                </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &lt; n&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &lt; n&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?esl0</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;take n esl&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d1</span><span> </span><span>d3</span><span> </span><span>d4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl0 &#8712; cpts_es &#915;&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Suc_le_lessD</span><span> </span><span>Suc_pred&#39;</span><span> </span><span>b0</span><span> </span><span>cpts_es_take</span><span> </span><span>less_trans</span><span class="delimiter">)</span><span>
</span><span>                    
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span>d1</span><span> </span><span>d3</span><span> </span><span>d4</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>esl2</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>e2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl0 = (EvtSeq ev esys, s, x) # esl2&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>take_Cons&#39;</span><span class="delimiter">)</span><span> 
</span><span>                     
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d1</span><span> </span><span>d3</span><span> </span><span>d4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &#8804; length ?esl0 &#10230; getspc_es (?esl0 ! i) &#8800; esys&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>drop_take</span><span> </span><span>leD</span><span> </span><span>le_less_linear</span><span> </span><span>not_less_eq</span><span class="delimiter">)</span><span>
</span><span>                    
</span><span>                    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc m &#8800; n&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>                        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>f0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc m = n&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d1</span><span> </span><span>d3</span><span> </span><span>d4</span><span> </span><span>e0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &lt; length ?esl0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d1</span><span> </span><span>d3</span><span> </span><span>e0</span><span> </span><span>e1</span><span> </span><span>e2</span><span> </span><span>e3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e&#39;. getspc_es (?esl0 ! m) = EvtSeq e&#39; esys&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtseq_noesys_allevtseq</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?esl0</span><span> </span><span>ev</span><span> </span><span>esys</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>esl2</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>e&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (?esl0 ! m) = EvtSeq e&#39; esys&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s&#39;</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>f1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl0 ! m = (EvtSeq e&#39; esys, s&#39;,x&#39;)&quot;</span></span></span><span> 
</span><span>                          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>getspc_es_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fst_conv</span><span> </span><span>surj_pair</span><span class="delimiter">)</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d3</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s&#39;&#39;</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x&#39;&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>f2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;esl ! n = (esys,s&#39;&#39;,x&#39;&#39;)&quot;</span></span></span><span> 
</span><span>                          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>getspc_es_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fst_conv</span><span> </span><span>surj_pair</span><span class="delimiter">)</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d1</span><span> </span><span>d3</span><span> </span><span>e0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl0 ! m = esl ! m&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f4</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; ?esl0 ! m -es-EvtEnt e&#9839;k&#8594; esl ! Suc m&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (EvtSeq e&#39; esys, s&#39;,x&#39;)-es-EvtEnt e&#9839;k&#8594;(esys,s&#39;&#39;,x&#39;&#39;)&quot;</span></span></span><span> 
</span><span>                          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>False</span><span>
</span><span>                          </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>estran.cases</span><span class="delimiter">)</span><span>
</span><span>                          </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>get_actk_def</span><span class="delimiter">)</span><span>
</span><span>                          </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>etran.cases</span><span class="delimiter">)</span><span>
</span><span>                          </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>get_actk_def</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>                          </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>f3</span><span> </span><span>ent_spec2&#39;</span><span> </span><span>event.inject</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>evtseq_tran_0_exist_etran</span><span> 
</span><span>                            </span><span>noevtent_notran</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evt_ent_n_fin</span><span>
</span><span>                          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>evtent_is_basicevt</span><span> </span><span>f3</span><span class="delimiter">)</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>   
</span><span>                      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                    
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c1</span><span> </span><span>e0</span><span> </span><span>d1</span><span> </span><span>d3</span><span> </span><span>d4</span><span> </span><span>e4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; ?esl0 ! m -es-EvtEnt e&#9839;k&#8594; ?esl0 ! Suc m&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Suc_lessI</span><span class="delimiter">)</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d1</span><span> </span><span>d3</span><span> </span><span>d4</span><span> </span><span>e0</span><span> </span><span>e4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &lt; length ?esl0 - 1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b0</span><span> </span><span>c0</span><span> </span><span>c1</span><span> </span><span>e1</span><span> </span><span>e2</span><span> </span><span>e3</span><span> </span><span>e4</span><span> </span><span>e5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;is_basicevt ev &#8743; (&#8704;i. i &#8804; m &#10230; getspc_es (esl ! i) = EvtSeq ev esys)&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtseq_evtent_befaft</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?esl0</span><span> </span><span>ev</span><span> </span><span>esys</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>esl2</span><span> </span><span>m</span><span class="delimiter">]</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>diff_diff_cancel</span><span> </span><span>e0</span><span> </span><span>less_imp_diff_less</span><span> </span><span>nth_take</span><span class="delimiter">)</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl ! m) = EvtSeq ev esys&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;e = ev&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtent_is_basicevt_inevtseq2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>all_basicevts_es.simps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>insertI1</span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;m &lt; n&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &#8805; n&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?esl0</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop n esl&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c0</span><span> </span><span>e0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl0 &#8712; cpts_es &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>b0</span><span> </span><span>cpts_es_dropi2</span><span> </span><span>length_Cons</span><span> 
</span><span>                      </span><span>length_tl</span><span> </span><span>less_SucI</span><span> </span><span>list.sel</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d1</span><span> </span><span>d3</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s&#39;</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x&#39;</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>esl1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl0 = (esys,s&#39;,x&#39;)#esl1&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>hide_lams</span><span class="delimiter">)</span><span> </span><span>Cons_nth_drop_Suc</span><span> </span><span>getspc_es_def</span><span> 
</span><span>                        </span><span>less_le_trans</span><span> </span><span>not_less_eq</span><span> </span><span>old.prod.exhaust</span><span> </span><span>prod.sel</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">)</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d1</span><span> </span><span>d3</span><span> </span><span>d0</span><span> </span><span>c0</span><span> </span><span>e0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m - n &lt;length ?esl0 - 1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d1</span><span> </span><span>d3</span><span> </span><span>d0</span><span> </span><span>c0</span><span> </span><span>e0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl ! m = ?esl0 ! (m - n)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d1</span><span> </span><span>d3</span><span> </span><span>d0</span><span> </span><span>c0</span><span> </span><span>e0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl ! Suc m = ?esl0 ! Suc (m - n)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;e &#8712; all_basicevts_es esys&quot;</span></span></span><span> 
</span><span>                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c1</span><span> </span><span>d1</span><span> </span><span>d3</span><span> </span><span>e0</span><span> </span><span>a1</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?esl0</span><span> </span><span>s&#39;</span><span> </span><span>x&#39;</span><span> </span><span>esl1</span><span> </span><span>e</span><span> </span><span>k</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>all_basicevts_es.simps</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>EvtSys</span><span> </span><span>es</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>esl</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>esl1</span><span> </span><span>e</span><span> </span><span>k</span><span>
</span><span>          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl &#8712; cpts_es &#915; &#8743; esl = (EvtSys es, s, x) # esl1&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>m</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m&lt;length esl - 1&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; esl ! m -es-EvtEnt e&#9839;k&#8594; esl ! Suc m&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c00</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl!m) = EvtSys es&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtsys_befevtent_isevtsys</span><span class="delimiter">[</span><span>of</span><span> </span><span>esl</span><span> </span><span>es</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>esl1</span><span class="delimiter">]</span><span> 
</span><span>              </span><span>Suc_mono</span><span> </span><span>length_Cons</span><span> </span><span>length_tl</span><span> </span><span>list.sel</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c0</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>esc1</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>s1</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl ! m = (esc1,s1,x1)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>prod_cases3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>  
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c0</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>esc2</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>s2</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x2</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl ! Suc m = (esc2,s2,x2)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>prod_cases3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c1</span><span> </span><span>c2</span><span> </span><span>c3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (esc1,s1,x1)-es-EvtEnt e&#9839;k&#8594;(esc2,s2,x2)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c00</span><span> </span><span>c2</span><span> </span><span>c3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;e &#8712; es&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtsysent_evtent2</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>es</span><span> </span><span>s1</span><span> </span><span>x1</span><span> </span><span>e</span><span> </span><span>k</span><span> </span><span>esc2</span><span> </span><span>s2</span><span> </span><span>x2</span><span class="delimiter">]</span><span> </span><span>getspc_es_def</span><span>
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fst_conv</span><span class="delimiter">)</span><span>  
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;is_basicevt e&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtent_is_basicevt</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>esc1</span><span> </span><span>s1</span><span> </span><span>x1</span><span> </span><span>e</span><span> </span><span>k</span><span> </span><span>esc2</span><span> </span><span>s2</span><span> </span><span>x2</span><span class="delimiter">]</span><span> </span><span>is_basicevt.simps</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;e &#8712; all_basicevts_es (EvtSys es)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;all_basicevts_es.simps&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*if it is cmd in i, then there is an evtent on some m (m &lt; i) and  acts between m and i is not evtent*)</span></span></span></span></span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cmd_impl_evtent_before</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;&#915; c &#8733; cs; cs k&#8712;cpts_of_es &#915; esc s x; &#8704;ef&#8712;all_evts_esspec esc. is_basicevt ef&#10215;
    &#10233; &#8704;i. Suc i &lt; length (cs k) &#10230; (&#8707;cmd. &#915; &#8866; (cs k)!i -es-((Cmd cmd)&#9839;k)&#8594; (cs k)!(Suc i)) 
            &#10230; (&#8707;m. m &lt; i &#8743; (&#8707;e. &#915; &#8866; (cs k)!m -es-(EvtEnt e&#9839;k)&#8594; (cs k)!(Suc m)))&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; c &#8733; cs&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k&#8712;cpts_of_es &#915; esc s x&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;all_evts_esspec esc. is_basicevt ef&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?esl</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p01</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl &#8712; cpts_es &#915; &#8743; ?esl ! 0 = (esc,s,x)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>cpts_of_es_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length ?esl&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;cmd. &#915; &#8866; ?esl!i -es-((Cmd cmd)&#9839;k)&#8594; ?esl!(Suc i)&quot;</span></span></span><span>
</span><span>      
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>cmd</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; ?esl!i -es-((Cmd cmd)&#9839;k)&#8594; ?esl!(Suc i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>esc1</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>s1</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x1</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>esc2</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>s2</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x2</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span>
</span><span>        </span><span class="string"><span class="delete"><span class="delete">&quot;?esl!i = (esc1,s1,x1) &#8743; ?esl!Suc i = (esc2,s2,x2)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>prod_cases3</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e&#39; es. esc1 = EvtSeq e&#39; es &#8743; is_anonyevt e&#39;&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cmd_enable_impl_anonyevt</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>esc1</span><span> </span><span>s1</span><span> </span><span>x1</span><span> </span><span>cmd</span><span> </span><span>k</span><span> </span><span>esc2</span><span> </span><span>s2</span><span> </span><span>x2</span><span class="delimiter">]</span><span> </span><span>is_anonyevt.simps</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p01</span><span> </span><span>p2</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i &#8800; 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>all_evts_esspec.simps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>anonyevt_isnot_basic</span><span> </span><span>fst_conv</span><span> </span><span>insertI1</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;m. m &lt; i &#8743; (&#8707;e. &#915; &#8866; ?esl!m -es-(EvtEnt e&#9839;k)&#8594; ?esl!(Suc m))&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>        </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#8707;m. m &lt; i &#8743; (&#8707;e. &#915; &#8866; ?esl!m -es-(EvtEnt e&#9839;k)&#8594; ?esl!(Suc m)))&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. j &lt; i &#10230; &#172;(&#8707;e. &#915; &#8866; ?esl!j -es-(EvtEnt e&#9839;k)&#8594; ?esl!(Suc j))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p0</span><span> </span><span>p01</span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j &lt; i. &#8707;e es. getspc_es (?esl!j) = EvtSeq e es &#8743; is_anonyevt e&quot;</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>anonyevtseq_and_noet_impl_allanonyevtseq_bef3</span><span class="delimiter">[</span><span>of</span><span> </span><span>c</span><span> </span><span>cs</span><span> </span><span>k</span><span> </span><span>i</span><span class="delimiter">]</span><span> </span><span>getspc_es_def</span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_lessD</span><span> </span><span>fst_conv</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e es. getspc_es (?esl!0) = EvtSeq e es &#8743; is_anonyevt e&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p01</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>False</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>all_evts_esspec.simps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>anonyevt_isnot_basic</span><span> 
</span><span>              </span><span>getspc_es_def</span><span> </span><span>insertI1</span><span> </span><span>prod.sel</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*if it is cmd in i, then there is an evtent on some m (m &lt; i) and  acts between m and i is not evtent*)</span></span></span></span></span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cmd_impl_evtent_before_and_cmds</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;&#915; c &#8733; cs; cs k&#8712;cpts_of_es &#915; esc s x; &#8704;ef&#8712;all_evts_esspec esc. is_basicevt ef&#10215;
    &#10233; &#8704;i. Suc i &lt; length (cs k) &#10230; (&#8707;cmd. &#915; &#8866; (cs k)!i -es-((Cmd cmd)&#9839;k)&#8594; (cs k)!(Suc i)) 
            &#10230; (&#8707;m. m &lt; i &#8743; (&#8707;e. &#915; &#8866; (cs k)!m -es-(EvtEnt e&#9839;k)&#8594; (cs k)!(Suc m))
                      &#8743; (&#8704;j. j &gt; m &#8743; j &lt; i &#10230; &#172;(&#8707;e. &#915; &#8866; (cs k)!j -es-(EvtEnt e&#9839;k)&#8594; (cs k)!(Suc j))))&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; c &#8733; cs&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k&#8712;cpts_of_es &#915; esc s x&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;all_evts_esspec esc. is_basicevt ef&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?esl</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p01</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl &#8712; cpts_es &#915; &#8743; ?esl ! 0 = (esc,s,x)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>cpts_of_es_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length ?esl&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;cmd. &#915; &#8866; ?esl!i -es-((Cmd cmd)&#9839;k)&#8594; ?esl!(Suc i)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;m. m &lt; i &#8743; (&#8707;e. &#915; &#8866; ?esl!m -es-(EvtEnt e&#9839;k)&#8594; ?esl!(Suc m))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cmd_impl_evtent_before</span><span class="delimiter">[</span><span>of</span><span> </span><span>c</span><span> </span><span>cs</span><span> </span><span>k</span><span> </span><span>esc</span><span> </span><span>s</span><span> </span><span>x</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>m</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &lt; i &#8743; (&#8707;e. &#915; &#8866; ?esl!m -es-(EvtEnt e&#9839;k)&#8594; ?esl!(Suc m))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;m. m &lt; i &#8743; (&#8707;e. &#915; &#8866; ?esl!m -es-(EvtEnt e&#9839;k)&#8594; ?esl!(Suc m))
                    &#8743; (&#8704;j. j &gt; m &#8743; j &lt; i &#10230; &#172;(&#8707;e. &#915; &#8866; ?esl!j -es-(EvtEnt e&#9839;k)&#8594; ?esl!(Suc j)))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>i</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>ii</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc ii &lt; length ?esl &#10233;
                      m &lt; ii &#8743; (&#8707;e. &#915; &#8866; ?esl ! m -es-EvtEnt e&#9839;k&#8594; ?esl ! Suc m) &#10233;
                      &#8707;m&lt;ii. (&#8707;e. &#915; &#8866; ?esl ! m -es-EvtEnt e&#9839;k&#8594; ?esl ! Suc m) &#8743;
                             (&#8704;j. m &lt; j &#8743; j &lt; ii &#10230; &#172; (&#8707;e. &#915; &#8866; ?esl ! j -es-EvtEnt e&#9839;k&#8594; ?esl ! Suc j))&quot;</span></span></span><span>
</span><span>            </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc (Suc ii) &lt; length ?esl&quot;</span></span></span><span>
</span><span>            </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &lt; Suc ii &#8743; (&#8707;e. &#915; &#8866; ?esl ! m -es-EvtEnt e&#9839;k&#8594; ?esl ! Suc m)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>            </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m = ii&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m = ii&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b2</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>not_less_eq</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>              </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &#8800; ii&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &lt; ii&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>              </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b0</span><span> </span><span>b1</span><span> </span><span>b2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;m&lt;ii. (&#8707;e. &#915; &#8866; ?esl ! m -es-EvtEnt e&#9839;k&#8594; ?esl ! Suc m) &#8743;
                             (&#8704;j. m &lt; j &#8743; j &lt; ii &#10230; &#172; (&#8707;e. &#915; &#8866; ?esl ! j -es-EvtEnt e&#9839;k&#8594; ?esl ! Suc j))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>m1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m1&lt;ii &#8743; (&#8707;e. &#915; &#8866; ?esl ! m1 -es-EvtEnt e&#9839;k&#8594; ?esl ! Suc m1) &#8743;
                             (&#8704;j. m1 &lt; j &#8743; j &lt; ii &#10230; &#172; (&#8707;e. &#915; &#8866; ?esl ! j -es-EvtEnt e&#9839;k&#8594; ?esl ! Suc j))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>                </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e. &#915; &#8866; ?esl ! ii -es-EvtEnt e&#9839;k&#8594; ?esl ! Suc ii&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e. &#915; &#8866; ?esl ! ii -es-EvtEnt e&#9839;k&#8594; ?esl ! Suc ii&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>lessI</span><span> </span><span>not_less_eq</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (&#8707;e. &#915; &#8866; ?esl ! ii -es-EvtEnt e&#9839;k&#8594; ?esl ! Suc ii)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c2</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>less_Suc_eq</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*in c and cs, if there is no env trans in c and it is cmd on k at i, 
then the current event on k is a basic event of the program &quot;cs k&quot;*)</span></span></span></span></span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cur_evt_in_cpts_es</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;c&#8712;cpts_of_pes &#915; (paresys_spec pesrgf) s x; &#915; c &#8733; cs; 
    (&#8704;k. (cs k) &#8712; cpts_of_es &#915; (evtsys_spec (fst (pesrgf k))) s x); 
    &#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. &#915; &#8866; c!j-pes-actk&#8594;c!Suc j); 
    &#8704;ef&#8712;all_evts pesrgf. is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> ef)&#10215;
      &#10233; &#8704;k i. Suc i &lt; length (cs k) &#10230; (&#8707;cmd. &#915; &#8866; (cs k)!i -es-((Cmd cmd)&#9839;k)&#8594; (cs k)!(Suc i)) 
                &#10230; (&#8707;ef&#8712;all_evts_es (fst (pesrgf k)). getx_es ((cs k)!i) k = E<span class="hidden">&#8681;</span><sub>e</sub> ef)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;cpts_of_pes &#915; (paresys_spec pesrgf) s x&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; c &#8733; cs&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;k. (cs k) &#8712; cpts_of_es &#915; (evtsys_spec (fst (pesrgf k))) s x)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. &#915; &#8866; c!j-pes-actk&#8594;c!Suc j)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;all_evts pesrgf. is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> ef)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>k</span><span> </span><span>i</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length (cs k)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;cmd. &#915; &#8866; (cs k)!i -es-((Cmd cmd)&#9839;k)&#8594; (cs k)!(Suc i)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;all_evts_esspec (evtsys_spec (fst (pesrgf k))). is_basicevt ef&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>allevts_es_blto_allevts</span><span class="delimiter">[</span><span>of</span><span> </span><span>pesrgf</span><span class="delimiter">]</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>hide_lams</span><span class="delimiter">)</span><span> </span><span>DomainE</span><span> </span><span>E<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>prod.sel</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>subsetCE</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k &#8712; cpts_of_es &#915; (evtsys_spec (fst (pesrgf k))) s x&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8707;m. m &lt; i &#8743; (&#8707;e. &#915; &#8866; cs k!m -es-(EvtEnt e&#9839;k)&#8594; cs k!(Suc m))
                    &#8743; (&#8704;j. j &gt; m &#8743; j &lt; i &#10230; &#172;(&#8707;e. &#915; &#8866; cs k!j -es-(EvtEnt e&#9839;k)&#8594; cs k!(Suc j))))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cmd_impl_evtent_before_and_cmds</span><span class="delimiter">[</span><span>of</span><span> </span><span>c</span><span> </span><span>cs</span><span> </span><span>k</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;evtsys_spec (fst (pesrgf k))&quot;</span></span></span><span> </span><span>s</span><span> </span><span>x</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>m</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>e</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &lt; i &#8743; (&#915; &#8866; cs k!m -es-(EvtEnt e&#9839;k)&#8594; cs k!(Suc m))
                    &#8743; (&#8704;j. j &gt; m &#8743; j &lt; i &#10230; &#172;(&#8707;e. &#915; &#8866; cs k!j -es-(EvtEnt e&#9839;k)&#8594; cs k!(Suc j)))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span>p3</span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. j &gt; m &#8743; j &#8804; i &#10230; getx_es ((cs k)!j) k = e&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtent_impl_curevt_in_cpts_es</span><span class="delimiter">[</span><span>of</span><span> </span><span>c</span><span> </span><span>cs</span><span> </span><span>m</span><span> </span><span>k</span><span> </span><span>e</span><span> </span><span>i</span><span class="delimiter">]</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>Suc_lessD</span><span> </span><span>Suc_lessI</span><span> </span><span>entevt_ines_chg_selfx2</span><span> </span><span>less_trans_Suc</span><span> </span><span>not_less</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getx_es ((cs k)!i) k = e&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k &#8712; cpts_es &#915; &#8743; (&#8707;esl1. cs k = (evtsys_spec (fst (pesrgf k)), s, x)#esl1)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_of_es_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>a0</span><span> </span><span>hd_Cons_tl</span><span> </span><span>list.size</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>mem_Collect_eq</span><span> </span><span>not_less0</span><span> </span><span>nth_Cons_0</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a0</span><span> </span><span>a4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;e&#8712;all_basicevts_es (evtsys_spec (fst (pesrgf k)))&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>allentev_isin_basicevts</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k&quot;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>Suc_lessE</span><span> </span><span>diff_Suc_1</span><span> </span><span>le_less_trans</span><span> </span><span>less_imp_le_nat</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;ef&#8712;all_evts_es (fst (pesrgf k)). getx_es ((cs k)!i) k = E<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>allbasicevts_es_blto_allevts</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;evtsys_spec (fst (pesrgf k))&quot;</span></span></span><span class="delimiter">]</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>hide_lams</span><span class="delimiter">)</span><span> </span><span>DomainE</span><span> </span><span>E<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>all_evts_same</span><span> </span><span>fst_conv</span><span> </span><span>set_mp</span><span class="delimiter">)</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*
in each computation of par event system, 
if it is a cmd transition, current event is one of basic events of the par event system
*)</span></span></span></span></span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cur_evt_in_specevts</span><span class="delimiter">:</span><span> 
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;pesl&#8712;cpts_of_pes &#915; (paresys_spec pesf) s x; 
      &#8704;j. Suc j &lt; length pesl &#10230; (&#8707;actk. &#915; &#8866; pesl!j-pes-actk&#8594;pesl!Suc j);
      &#8704;ef&#8712;all_evts pesf. is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> ef)&#10215; &#10233;
        (&#8704;k i. Suc i &lt; length pesl &#10230; (&#8707;c. (&#915; &#8866; pesl!i -pes-((Cmd c)&#9839;k)&#8594; pesl!(Suc i)))
            &#10230; (&#8707;ef&#8712;all_evts pesf. getx (pesl!i) k = E<span class="hidden">&#8681;</span><sub>e</sub> ef) )&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;pesl&#8712;cpts_of_pes &#915; (paresys_spec pesf) s x&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. Suc j &lt; length pesl &#10230; (&#8707;actk. &#915; &#8866; pesl!j-pes-actk&#8594;pesl!Suc j)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;all_evts pesf. is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> ef)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;cs. (&#8704;k. (cs k) &#8712; cpts_of_es &#915; ((paresys_spec pesf) k) s x) &#8743; &#915; pesl &#8733; cs&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>par_evtsys_semantics_comp</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;paresys_spec pesf&quot;</span></span></span><span> </span><span>s</span><span> </span><span>x</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>cs</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;k. (cs k) &#8712; cpts_of_es &#915; ((paresys_spec pesf) k) s x) &#8743; &#915; pesl &#8733; cs&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. length pesl = length (cs k)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>conjoin_def</span><span> </span><span>same_length_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k j. j &lt; length pesl &#10230; getx (pesl!j) = getx_es ((cs k)!j)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>conjoin_def</span><span> </span><span>same_state_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>k</span><span> </span><span>i</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length pesl&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;c. (&#915; &#8866; pesl!i -pes-((Cmd c)&#9839;k)&#8594; pesl!(Suc i))&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>c</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>b2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; pesl!i -pes-((Cmd c)&#9839;k)&#8594; pesl!(Suc i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;compat_tran &#915; pesl cs&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>conjoin_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;t k. (&#915; &#8866; pesl!i -pes-(t&#9839;k)&#8594; pesl!Suc i) &#8743;
                          (&#8704;k t. (&#915; &#8866; pesl!i -pes-(t&#9839;k)&#8594; pesl!Suc i) &#10230; (&#915; &#8866; cs k!i -es-(t&#9839;k)&#8594; cs k! Suc i) &#8743;
                                  (&#8704;k&#39;. k&#39; &#8800; k &#10230; (&#915; &#8866; cs k&#39;!i -ese&#8594; cs k&#39;! Suc i)))
                          &#8744;
                          ((&#915; &#8866; (pesl!i) -pese&#8594; (pesl!Suc i)) &#8743; (&#8704;k. (&#915; &#8866; ((cs k)!i) -ese&#8594; ((cs k)! Suc i))))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>compat_tran_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>pesl</span><span> </span><span>cs</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;t k1. k1 = k &#8743; t = Cmd c &#8743; &#915; &#8866; pesl ! i -pes-t&#9839;k&#8594; pesl ! Suc i&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#915; &#8866; pesl ! i -pese&#8594; pesl ! Suc i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>pes_tran_not_etran1</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;t k. (&#915; &#8866; pesl!i -pes-(t&#9839;k)&#8594; pesl!Suc i) &#8743;
                          (&#8704;k t. (&#915; &#8866; pesl!i -pes-(t&#9839;k)&#8594; pesl!Suc i) &#10230; (&#915; &#8866; cs k!i -es-(t&#9839;k)&#8594; cs k! Suc i) &#8743;
                                  (&#8704;k&#39;. k&#39; &#8800; k &#10230; (&#915; &#8866; cs k&#39;!i -ese&#8594; cs k&#39;! Suc i)))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>t</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>k1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>b5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915; &#8866; pesl!i -pes-(t&#9839;k1)&#8594; pesl!Suc i) &#8743;
                          (&#8704;k t. (&#915; &#8866; pesl!i -pes-(t&#9839;k)&#8594; pesl!Suc i) &#10230; (&#915; &#8866; cs k!i -es-(t&#9839;k)&#8594; cs k! Suc i) &#8743;
                                  (&#8704;k&#39;. k&#39; &#8800; k &#10230; (&#915; &#8866; cs k&#39;!i -ese&#8594; cs k&#39;! Suc i)))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; cs k ! i -es-((Cmd c)&#9839;k)&#8594; cs k!(Suc i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>b2</span><span> </span><span>b5</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>b0</span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;ef&#8712;all_evts_es (fst (pesf k)). getx_es ((cs k)!i) k = E<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cur_evt_in_cpts_es</span><span class="delimiter">[</span><span>of</span><span> </span><span>pesl</span><span> </span><span>pesf</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>cs</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>paresys_spec_def</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>ef</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ef&#8712;all_evts_es (fst (pesf k)) &#8743; getx_es ((cs k)!i) k = E<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;all_evts_es (fst (pesf k)) &#8838; all_evts pesf&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>all_evts_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getx_es ((cs k)!i) k = getx (pesl!i) k&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;ef&#8712;all_evts pesf. getx (pesl!i) k = E<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>drop_take_ln</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;l1 = drop i (take j l); length l1 &gt; n&#10215; &#10233; j &gt; i + n&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>add.commute</span><span> </span><span>add_lessD1</span><span> </span><span>leI</span><span> </span><span>length_drop</span><span> </span><span>length_take</span><span> </span><span>less_diff_conv</span><span> 
</span><span>    </span><span>less_imp_add_positive</span><span> </span><span>min.absorb2</span><span> </span><span>nat_le_linear</span><span> </span><span>take_all</span><span class="delimiter">)</span><span> 
</span><span>   
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>drop_take_eq</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;l1 = drop i (take j l); j &#8804; length l; length l1 = n; n &gt; 0&#10215; &#10233; j = i + n&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span> 
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>drop_take_sametrace</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;l1 = drop i (take j l)&#10215; &#10233; &#8704;m &lt; length l1. l1 ! m = l ! (i + m)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>less_imp_le_nat</span><span class="delimiter">)</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>act_cpts_evtsys_sat_guar_curevt_gen0_new2</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;&#915; &#8866; (esspc::(&#39;l,&#39;k,&#39;s,&#39;prog) rgformula_ess) sat<span class="hidden">&#8681;</span><sub>s</sub> [pre, rely, guar, post]&#10215;
      &#10233; &#8704;c pes s x cs pre1 rely1 Pre Rely Guar Post k cmd. 
            Pre k &#8838; pre &#8743; Rely k &#8838; rely &#8743; guar &#8838; Guar k &#8743; post &#8838; Post k &#10230;
            c&#8712;cpts_of_pes &#915; pes s x &#8743; &#915; c &#8733; cs &#8743; c&#8712;assume_pes &#915; (pre1, rely1) &#10230;
           (&#8704;k. (cs k) &#8712; cpts_of_es &#915; (pes k) s x)  &#10230; 
           (&#8704;k. (cs k)&#8712;commit_es &#915; (Guar k, Post k)) &#10230;
           (&#8704;k. pre1 &#8838; Pre k) &#10230;
           (&#8704;k. rely1 &#8838; Rely k) &#10230;
           (&#8704;k j. j &#8800; k &#10230; Guar j &#8838; Rely k) &#10230;
           evtsys_spec esspc = EvtSys es &#8743;  EvtSys es = getspc_es (cs k!0) &#10230;
           (&#8704;e&#8712;all_evts_es esspc. is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> e)) &#10230;
           (&#8704;e&#8712;all_evts_es esspc. the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> e)) = snd e) &#10230;
           (&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. &#915; &#8866; c!j-pes-actk&#8594;c!Suc j)) &#10230;
          (&#8704;i. Suc i &lt; length (cs k) &#8743; (&#915; &#8866; (cs k)!i -es-((Cmd cmd)&#9839;k)&#8594; (cs k)!(Suc i)) 
                &#10230; (gets_es ((cs k)!i), gets_es ((cs k)!(Suc i)))&#8712;Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es ((cs k)!i) k))))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>rghoare_es.induct</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>esspc</span><span> </span><span>pre</span><span> </span><span>rely</span><span> </span><span>guar</span><span> </span><span>post</span><span class="delimiter">]</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>prea</span><span> </span><span>pre&#39;</span><span> </span><span>relya</span><span> </span><span>rely&#39;</span><span> </span><span>guar&#39;</span><span> </span><span>guara</span><span> </span><span>post&#39;</span><span> </span><span>posta</span><span> </span><span>esys</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866; (esspc::(&#39;l,&#39;k,&#39;s,&#39;prog) rgformula_ess) sat<span class="hidden">&#8681;</span><sub>s</sub> [pre, rely, guar, post]&quot;</span></span></span><span>
</span><span>       </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;prea &#8838; pre&#39;&quot;</span></span></span><span>
</span><span>       </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;relya &#8838; rely&#39;&quot;</span></span></span><span>
</span><span>       </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;guar&#39; &#8838; guara&quot;</span></span></span><span>
</span><span>       </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>p4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;post&#39; &#8838; posta&quot;</span></span></span><span>
</span><span>       </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>p5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915;&#8866; esys sat<span class="hidden">&#8681;</span><sub>s</sub> [pre&#39;, rely&#39;, guar&#39;, post&#39;]&quot;</span></span></span><span>
</span><span>       </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>p6</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; &#8704;c pes s x cs pre1 rely1 Pre Rely Guar Post k cmd.
          Pre k &#8838; pre&#39; &#8743; Rely k &#8838; rely&#39; &#8743; guar&#39; &#8838; Guar k &#8743; post&#39; &#8838; Post k &#10230;
          c &#8712; cpts_of_pes &#915; pes s x &#8743; &#915; c &#8733; cs &#8743; c &#8712; assume_pes &#915; (pre1, rely1) &#10230;
          (&#8704;k. cs k &#8712; cpts_of_es &#915; (pes k) s x) &#10230;
          (&#8704;k. cs k &#8712; commit_es &#915; (Guar k, Post k)) &#10230;
          (&#8704;k. pre1 &#8838; Pre k) &#10230;
          (&#8704;k. rely1 &#8838; Rely k) &#10230;
          (&#8704;k j. j &#8800; k &#10230; Guar j &#8838; Rely k) &#10230;
          evtsys_spec esys = EvtSys es &#8743; EvtSys es = getspc_es (cs k ! 0) &#10230;
          (&#8704;e&#8712;all_evts_es esys. is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> e)) &#10230;
          (&#8704;e&#8712;all_evts_es esys. the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> e)) = snd e) &#10230;
          (&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. &#915; &#8866; c ! j -pes-actk&#8594; c ! Suc j)) &#10230;
          (&#8704;i. Suc i &lt; length (cs k) &#8743; &#915; &#8866; cs k ! i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc i &#10230;
               (gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k))))&quot;</span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>       </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>c</span><span> </span><span>pes</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>cs</span><span> </span><span>pre1</span><span> </span><span>rely1</span><span> </span><span>Pre</span><span> </span><span>Rely</span><span> </span><span>Guar</span><span> </span><span>Post</span><span> </span><span>k</span><span> </span><span>cmd</span><span>
</span><span>       </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Pre k &#8838; prea &#8743; Rely k &#8838; relya &#8743; guara &#8838; Guar k &#8743; posta &#8838; Post k&quot;</span></span></span><span>
</span><span>         </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; cpts_of_pes &#915; pes s x &#8743; &#915; c &#8733; cs &#8743; c &#8712; assume_pes &#915; (pre1, rely1)&quot;</span></span></span><span>
</span><span>         </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;k. cs k &#8712; cpts_of_es &#915; (pes k) s x)&quot;</span></span></span><span>
</span><span>         </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. (cs k)&#8712;commit_es &#915;(Guar k, Post k)&quot;</span></span></span><span>
</span><span>         </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;k. pre1 &#8838; Pre k)&quot;</span></span></span><span>
</span><span>         </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>a6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;k. rely1 &#8838; Rely k)&quot;</span></span></span><span>
</span><span>         </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>a7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;k j. j &#8800; k &#10230; Guar j &#8838; Rely k)&quot;</span></span></span><span>
</span><span>         </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>a8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;evtsys_spec esys = EvtSys es &#8743; EvtSys es = getspc_es (cs k ! 0)&quot;</span></span></span><span>
</span><span>         </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>a9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;e&#8712;all_evts_es esys. is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> e))&quot;</span></span></span><span>
</span><span>         </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>a10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;e&#8712;all_evts_es esys. the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> e)) = snd e)&quot;</span></span></span><span>
</span><span>         </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>a11</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; (&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. &#915; &#8866; c ! j -pes-actk&#8594; c ! Suc j))&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>p3</span><span> </span><span>p4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Pre k &#8838; pre&#39; &#8743; Rely k &#8838; rely&#39; &#8743; guar&#39; &#8838; Guar k &#8743; post&#39; &#8838; Post k&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>       </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a5</span><span> </span><span>a6</span><span> </span><span>a7</span><span> </span><span>a8</span><span> </span><span>a9</span><span> </span><span>a10</span><span> </span><span>a11</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>p3</span><span> </span><span>p4</span><span> </span><span>p6</span><span class="delimiter">[</span><span>of</span><span> </span><span>Pre</span><span> </span><span>k</span><span> </span><span>Rely</span><span> </span><span>Guar</span><span> </span><span>Post</span><span> </span><span>c</span><span> </span><span>pes</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>cs</span><span> </span><span>pre1</span><span> </span><span>rely1</span><span class="delimiter">]</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length (cs k) &#8743; &#915; &#8866; cs k ! i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc i &#10230;
               (gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k)))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span> </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*by auto*)</span></span></span></span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>     </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;c pes s x cs pre1 rely1 Pre Rely Guar Post k cmd.
          Pre k &#8838; prea &#8743; Rely k &#8838; relya &#8743; guara &#8838; Guar k &#8743; posta &#8838; Post k &#10230;
          c &#8712; cpts_of_pes &#915; pes s x &#8743; &#915; c &#8733; cs &#8743; c &#8712; assume_pes &#915; (pre1, rely1) &#10230;
          (&#8704;k. cs k &#8712; cpts_of_es &#915; (pes k) s x) &#10230;
          (&#8704;k. cs k &#8712; commit_es &#915; (Guar k, Post k)) &#10230;
          (&#8704;k. pre1 &#8838; Pre k) &#10230;
          (&#8704;k. rely1 &#8838; Rely k) &#10230;
          (&#8704;k j. j &#8800; k &#10230; Guar j &#8838; Rely k) &#10230;
          evtsys_spec esys = EvtSys es &#8743; EvtSys es = getspc_es (cs k ! 0) &#10230;
          (&#8704;e&#8712;all_evts_es esys. is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> e)) &#10230;
          (&#8704;e&#8712;all_evts_es esys. the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> e)) = snd e) &#10230;
          (&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. &#915; &#8866; c ! j -pes-actk&#8594; c ! Suc j)) &#10230;
          (&#8704;i. Suc i &lt; length (cs k) &#8743; &#915; &#8866; cs k ! i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc i &#10230;
               (gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k))))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>     
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>esf</span><span> </span><span>prea</span><span> </span><span>relya</span><span> </span><span>guara</span><span> </span><span>posta</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; &#915; &#8866; (esspc::(&#39;l,&#39;k,&#39;s,&#39;prog) rgformula_ess) sat<span class="hidden">&#8681;</span><sub>s</sub> [pre, rely, guar, post]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;(esf :: (&#39;l,&#39;k,&#39;s,&#39;prog) rgformula_e set). &#915; &#8866; E<span class="hidden">&#8681;</span><sub>e</sub> ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre<span class="hidden">&#8681;</span><sub>e</sub> ef, Rely<span class="hidden">&#8681;</span><sub>e</sub> ef, Guar<span class="hidden">&#8681;</span><sub>e</sub> ef, Post<span class="hidden">&#8681;</span><sub>e</sub> ef]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;esf. prea &#8838; Pre<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;esf. relya &#8838; Rely<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;esf. Guar<span class="hidden">&#8681;</span><sub>e</sub> ef &#8838; guara&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;esf. Post<span class="hidden">&#8681;</span><sub>e</sub> ef &#8838; posta&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef1 ef2. ef1 &#8712; esf &#8743; ef2 &#8712; esf &#10230; Post<span class="hidden">&#8681;</span><sub>e</sub> ef1 &#8838; Pre<span class="hidden">&#8681;</span><sub>e</sub> ef2&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b11</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;stable_e prea relya&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b12</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s. (s, s) &#8712; guara&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; rgf_EvtSys esf sat<span class="hidden">&#8681;</span><sub>s</sub> [prea, relya, guara, posta]&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>EvtSys_h</span><span class="delimiter">[</span><span>of</span><span> </span><span>esf</span><span> </span><span>&#915;</span><span> </span><span>prea</span><span> </span><span>relya</span><span> </span><span>guara</span><span> </span><span>posta</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>   </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>c</span><span> </span><span>pes</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>cs</span><span> </span><span>pre1</span><span> </span><span>rely1</span><span> </span><span>Pre</span><span> </span><span>Rely</span><span> </span><span>Guar</span><span> </span><span>Post</span><span> </span><span>k</span><span> </span><span>cmd</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Pre k &#8838; prea&quot;</span></span></span><span>
</span><span>         </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>b2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Rely k &#8838; relya&quot;</span></span></span><span>
</span><span>         </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>b3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;guara &#8838; Guar k&quot;</span></span></span><span>
</span><span>         </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>b4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;posta &#8838; Post k&quot;</span></span></span><span>
</span><span>         </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; cpts_of_pes &#915; pes s x&quot;</span></span></span><span>
</span><span>         </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; c &#8733; cs&quot;</span></span></span><span>
</span><span>         </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>p8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; assume_pes &#915; (pre1, rely1)&quot;</span></span></span><span>
</span><span>         </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;k. cs k &#8712; cpts_of_es &#915; (pes k) s x)&quot;</span></span></span><span>
</span><span>         </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. (cs k)&#8712;commit_es &#915; (Guar k, Post k)&quot;</span></span></span><span>
</span><span>         </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;k. pre1 &#8838; Pre k)&quot;</span></span></span><span>
</span><span>         </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>a6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;k. rely1 &#8838; Rely k)&quot;</span></span></span><span>
</span><span>         </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>p4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;k j. j &#8800; k &#10230; Guar j &#8838; Rely k)&quot;</span></span></span><span>
</span><span>         </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;evtsys_spec (rgf_EvtSys esf) = EvtSys es &#8743; EvtSys es = getspc_es (cs k ! 0) 
                  &#8743; (&#8704;e&#8712;all_evts_es (rgf_EvtSys esf). is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> e))
                  &#8743; (&#8704;e&#8712;all_evts_es (rgf_EvtSys esf). the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> e)) = snd e)&quot;</span></span></span><span>
</span><span>         </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>p6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. &#915; &#8866; c ! j -pes-actk&#8594; c ! Suc j))&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p30</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;k. cs k &#8712; assume_es &#915; (Pre k, Rely k))&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>conjoin_comm_imp_rely</span><span class="delimiter">[</span><span>of</span><span> </span><span>pre1</span><span> </span><span>Pre</span><span> </span><span>rely1</span><span> </span><span>Rely</span><span> </span><span>Guar</span><span> </span><span>cs</span><span> </span><span>&#915;</span><span> </span><span>Post</span><span> </span><span>c</span><span> </span><span>pes</span><span> </span><span>s</span><span> </span><span>x</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p31</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;k. cs k &#8712; commit_es &#915; (Guar k, Post k))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>IntI</span><span> </span><span>contra_subsetD</span><span> </span><span>cpts_of_es_def</span><span> </span><span>es_validity_def</span><span> </span><span>p2</span><span class="delimiter">)</span><span> 
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p11</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. length (cs k) = length c&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>conjoin_def</span><span> </span><span>same_length_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p12</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. cs k &#8712; cpts_es &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_of_es_def</span><span> </span><span>mem_Collect_eq</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p11</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c &#8800; Nil&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_es_not_empty</span><span> </span><span>length_0_conv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p13</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length c &gt; 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    
</span><span>      </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?esl</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?esys</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;EvtSys es&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a0&#39;</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e es ess. ?esys = evtsys_spec (rgf_EvtSys esf)&#8743; EvtSys es = getspc_es (cs k ! 0)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>  
</span><span>      
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl &#8712; cpts_es &#915; &#8743; ?esl!0 = (EvtSys es,s,x)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cpts_of_es_def</span><span> </span><span>eq_fst_iff</span><span> </span><span>getspc_es_def</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>esll</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a81</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl = (EvtSys es,s,x)#esll&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>hd_Cons_tl</span><span> </span><span>length_greater_0_conv</span><span> </span><span>nth_Cons_0</span><span> </span><span>p11</span><span> </span><span>p13</span><span class="delimiter">)</span><span> 
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length (cs k)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; cs k ! i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc i&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k)))&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &#8804; length ?esl &#10230; getspc_es (?esl ! i) = EvtSys es&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &#8804; length ?esl &#10230; getspc_es (?esl ! i) = EvtSys es&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (?esl ! i) = EvtSys es &#8743; getspc_es (?esl ! Suc i) = EvtSys es&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a4</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtsys_not_eq_in_tran_aux1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>              </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#8704;i. Suc i &#8804; length ?esl &#10230; getspc_es (?esl ! i) = EvtSys es)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>m</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc m &#8804; length ?esl &#8743; getspc_es (?esl ! m) &#8800; EvtSys es&quot;</span></span></span><span> 
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a8</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (?esl!0) = EvtSys es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>getspc_es_def</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;i. i &#8804; m &#8743; getspc_es (?esl ! i) &#8800; EvtSys es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a8</span><span> </span><span>c1</span><span> </span><span>c2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;i. (i &lt; m &#8743; getspc_es (?esl ! i) = EvtSys es 
                        &#8743; getspc_es (?esl ! Suc i) &#8800; EvtSys es) 
                        &#8743; (&#8704;j. j &lt; i &#10230; getspc_es (?esl ! j) = EvtSys es)&quot;</span></span></span><span> 
</span><span>                </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtsys_fst_ent</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>n</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(n &lt; m &#8743; getspc_es (?esl ! n) = EvtSys es 
                        &#8743; getspc_es (?esl ! Suc n) &#8800; EvtSys es) 
                        &#8743; (&#8704;j. j &lt; n &#10230; getspc_es (?esl ! j) = EvtSys es)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i &#8805; n&quot;</span></span></span><span> 
</span><span>                </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>                  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i &lt; n&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (?esl ! i) = EvtSys es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c3</span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (?esl ! Suc i) = EvtSys es&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_lessI</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#8707;t. &#915; &#8866; ?esl!i -es-t&#8594; ?esl!Suc i)&quot;</span></span></span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtsys_not_eq_in_tran</span><span> </span><span>getspc_es_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>surjective_pairing</span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>False</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>leI</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>              
</span><span>              </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?esl1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop n ?esl&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?eslh</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;take (Suc n) ?esl&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c1</span><span> </span><span>c3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length ?esl1 &#8805; 2&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>One_nat_def</span><span> </span><span>Suc_eq_plus1_left</span><span> </span><span>Suc_le_eq</span><span> </span><span>length_drop</span><span> 
</span><span>                    </span><span>less_diff_conv</span><span> </span><span>less_trans_Suc</span><span> </span><span>numeral_2_eq_2</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c1</span><span> </span><span>c3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (?esl1!0) = EvtSys es &#8743; getspc_es (?esl1!1) &#8800; EvtSys es&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a3</span><span> </span><span>a8</span><span> </span><span>c1</span><span> </span><span>c3</span><span> </span><span>c4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl1 &#8712; cpts_es &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_es_dropi</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>drop_0</span><span> </span><span>dual_order.strict_trans</span><span> 
</span><span>                      </span><span>le_0_eq</span><span> </span><span>le_SucE</span><span> </span><span>le_imp_less_Suc</span><span> </span><span>zero_induct</span><span class="delimiter">)</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c5</span><span> </span><span>c6</span><span> </span><span>c7</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;s x ev s1 x1 xs. 
                ?esl1 = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fst_esys_snd_eseq_exist</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s0</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x0</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>e</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>s1</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x1</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>xs</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c8</span><span class="delimiter">:</span><span>
</span><span>                  </span><span class="string"><span class="delete"><span class="delete">&quot;?esl1 = (EvtSys es, s0, x0) # (EvtSeq e (EvtSys es), s1,x1) # xs&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c3_1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;j&#8804;n. getspc_es (cs k ! j) = EvtSys es)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>getspc_es_def</span><span>
</span><span>                </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>antisym_conv2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?elst</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;tl (parse_es_cpts_i2 ?esl1 es [[]])&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c8</span><span> </span><span>c7</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;concat ?elst = ?esl1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>parse_es_cpts_i2_concat3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span> 
</span><span>              
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c13</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;es = Domain esf&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtsys_spec_evtsys</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?RG</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#955;e. SOME rg. (e,rg)&#8712;esf&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a21</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;e&#8712;es. &#8707;ef&#8712;esf. e = E<span class="hidden">&#8681;</span><sub>e</sub> ef &#8743;?RG e = snd ef&quot;</span></span></span><span> 
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Domain.cases</span><span> </span><span>E<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>c13</span><span> </span><span>fst_conv</span><span> </span><span>snd_conv</span><span> </span><span>tfl_some</span><span class="delimiter">)</span><span>
</span><span>               </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?Pre</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;pre_rgf &#8728; ?RG&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?Rely</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rely_rgf &#8728; ?RG&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?Guar</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;guar_rgf &#8728; ?RG&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?Post</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;post_rgf &#8728; ?RG&quot;</span></span></span><span>
</span><span>
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c14</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;es&#8712; esf. &#915; &#8872; E<span class="hidden">&#8681;</span><sub>e</sub> es sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre<span class="hidden">&#8681;</span><sub>e</sub> es, 
                        Rely<span class="hidden">&#8681;</span><sub>e</sub> es, Guar<span class="hidden">&#8681;</span><sub>e</sub> es, Post<span class="hidden">&#8681;</span><sub>e</sub> es]&quot;</span></span></span><span>  
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>rgsound_e</span><span class="delimiter">)</span><span>  
</span><span>               </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c16</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ei&#8712; es. &#915; &#8872; ei sat<span class="hidden">&#8681;</span><sub>e</sub> [?Pre ei, ?Rely ei, ?Guar ei, ?Post ei]&quot;</span></span></span><span> 
</span><span>                 </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>mono_tags</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Domain.cases</span><span> </span><span>E<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Guar<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Post<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> 
</span><span>                     </span><span>Pre<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Rely<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>c14</span><span> </span><span>c13</span><span> </span><span>comp_apply</span><span> </span><span>fst_conv</span><span> </span><span>snd_conv</span><span> </span><span>someI_ex</span><span class="delimiter">)</span><span>
</span><span>              
</span><span>               </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b1</span><span> </span><span>b6</span><span> </span><span>a21</span><span> </span><span>c13</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c40</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;es. prea &#8838; ?Pre ef &quot;</span></span></span><span> 
</span><span>                 </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Pre<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>comp_apply</span><span> </span><span class="delimiter">)</span><span>
</span><span>               </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c41</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;es.  Rely k &#8838; ?Rely ef&quot;</span></span></span><span>
</span><span>                 </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Rely<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>a21</span><span> </span><span>b2</span><span> </span><span>b7</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>               </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c42</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;es. ?Guar ef &#8838; Guar k&quot;</span></span></span><span>
</span><span>                 </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Guar<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>a21</span><span> </span><span>b3</span><span> </span><span>b8</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>               </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c43</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;es. ?Post ef &#8838; Post k&quot;</span></span></span><span>
</span><span>                 </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Post<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>a21</span><span> </span><span>b4</span><span> </span><span>b9</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>               </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c44</span><span> </span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef1 ef2. ef1 &#8712; es &#8743; ef2 &#8712; es &#10230; ?Post ef1 &#8838; ?Pre ef2&quot;</span></span></span><span>
</span><span>                 </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Post<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Pre<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>a21</span><span> </span><span>b10</span><span> </span><span>comp_def</span><span class="delimiter">)</span><span>  
</span><span>               </span><span class="keyword1"><span class="command">moreover</span></span><span> 
</span><span>               </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c45</span><span> </span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;es. Pre k &#8838; ?Pre ef&quot;</span></span></span><span>
</span><span>                 </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>b1</span><span> </span><span>c40</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>               </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c46</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;e&#8712;es. &#8707;ef&#8712;esf. e =E<span class="hidden">&#8681;</span><sub>e</sub> ef &#10230;?Pre e &#8838; Pre<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span> 
</span><span>                 </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Pre<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>a21</span><span> </span><span>comp_apply</span><span> </span><span>subset_refl</span><span class="delimiter">)</span><span>
</span><span>               </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c47</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;e&#8712;es. &#8707;ef&#8712;esf. e =E<span class="hidden">&#8681;</span><sub>e</sub> ef &#10230;?Rely e &#8838; Rely<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span> 
</span><span>               
</span><span>                 </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Rely<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>a21</span><span> </span><span>comp_apply</span><span> </span><span>subset_refl</span><span class="delimiter">)</span><span>
</span><span>               </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c48</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;e&#8712;es. &#8707;ef&#8712;esf. e =E<span class="hidden">&#8681;</span><sub>e</sub> ef &#10230;?Guar e &#8838; Guar<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span>
</span><span>                 </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Guar<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>a21</span><span> </span><span>comp_apply</span><span> </span><span>subset_refl</span><span class="delimiter">)</span><span>
</span><span>               </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c49</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;e&#8712;es. &#8707;ef&#8712;esf. e =E<span class="hidden">&#8681;</span><sub>e</sub> ef &#10230;?Post e &#8838; Post<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span>
</span><span>                 </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Post<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>a21</span><span> </span><span>comp_apply</span><span> </span><span>subset_refl</span><span class="delimiter">)</span><span> 
</span><span>                 
</span><span>              </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b1</span><span> </span><span>b6</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c17</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;esf. Pre k &#8838; Pre<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b2</span><span> </span><span>b7</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c18</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;esf. Rely k &#8838; Rely<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b3</span><span> </span><span>b8</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c19</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;esf. Guar<span class="hidden">&#8681;</span><sub>e</sub> ef &#8838; Guar k&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b4</span><span> </span><span>b9</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c20</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;esf. Post<span class="hidden">&#8681;</span><sub>e</sub>  ef &#8838; Post k&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b5</span><span> </span><span>b10</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c21</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef1 ef2. ef1&#8712; esf &#8743;ef2 &#8712;esf &#10230;
                    Post<span class="hidden">&#8681;</span><sub>e</sub> ef1 &#8838;  Pre<span class="hidden">&#8681;</span><sub>e</sub> ef2&quot;</span></span></span><span>  
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>              </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>              
</span><span>              
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c1</span><span> </span><span>c3_1</span><span> </span><span>p30</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c24</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl1&#8712;assume_es &#915; (prea, Rely k)&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;n = 0&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;n = 0&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b1</span><span> </span><span>p30</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl&#8712;assume_es &#915;(prea,Rely k)&quot;</span></span></span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assume_es_imp</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Pre k&quot;</span></span></span><span> </span><span>prea</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Rely k&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Rely k&quot;</span></span></span><span> </span><span class="var">?esl</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d0</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;n &#8800; 0&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b1</span><span> </span><span>b2</span><span> </span><span>p30</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl&#8712;assume_es &#915;(prea,relya)&quot;</span></span></span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assume_es_imp</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Pre k&quot;</span></span></span><span> </span><span>prea</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Rely k&quot;</span></span></span><span> </span><span>relya</span><span> </span><span class="var">?esl</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?eslh &#8712; assume_es &#915;(prea,relya)&quot;</span></span></span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assume_es_take_n</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc n&quot;</span></span></span><span> </span><span class="var">?esl</span><span> </span><span>&#915;</span><span> </span><span>prea</span><span> </span><span>relya</span><span class="delimiter">]</span><span> </span><span>d0</span><span> </span><span>c1</span><span> </span><span>c3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length ?eslh. getspc_es (?eslh!i) = EvtSys es&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length ?eslh &#10230; getspc_es (?eslh!i) = EvtSys es&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_le_lessD</span><span> </span><span>length_take</span><span> </span><span>less_antisym</span><span> </span><span>less_imp_le_nat</span><span> 
</span><span>                        </span><span>min.bounded_iff</span><span> </span><span>nth_take</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                      </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (last ?eslh) = EvtSys es&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>a3</span><span> </span><span>c4</span><span> </span><span>dual_order.strict_trans</span><span> 
</span><span>                          </span><span>getspc_es_def</span><span> </span><span>last_snoc</span><span> </span><span>le_imp_less_Suc</span><span> </span><span>take_Suc_conv_app_nth</span><span class="delimiter">)</span><span> 
</span><span>                      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_lessI</span><span> </span><span>diff_Suc_1</span><span> </span><span>last_conv_nth</span><span> 
</span><span>                          </span><span>length_greater_0_conv</span><span> </span><span>nat.distinct</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>p11</span><span> </span><span>p13</span><span> </span><span>take_eq_Nil</span><span class="delimiter">)</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length ?eslh. gets_es (?eslh!i) &#8712; prea&quot;</span></span></span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>b11</span><span> </span><span>pre_trans</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?eslh</span><span> </span><span>&#915;</span><span> </span><span>prea</span><span> </span><span>relya</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;EvtSys es&quot;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c1</span><span> </span><span>c3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc n &#8804; length ?esl&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;n &lt; length ?eslh&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (?eslh ! n) &#8712; prea&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?eslh ! n = ?esl1 ! 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>c8</span><span> </span><span>nth_via_drop</span><span class="delimiter">)</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (?esl ! n) &#8712; prea&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p30</span><span> </span><span>d1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assume_es_drop_n</span><span class="delimiter">[</span><span>of</span><span> </span><span>n</span><span> </span><span class="var">?esl</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Pre k&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Rely k&quot;</span></span></span><span> </span><span>prea</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">qed</span></span><span>   
</span><span>
</span><span>             </span><span class="keyword1"><span class="command">from</span></span><span>  </span><span>c16</span><span> </span><span>c40</span><span> </span><span>c41</span><span> </span><span>c42</span><span> </span><span>c43</span><span> </span><span>c44</span><span>  </span><span>c7</span><span> </span><span>c8</span><span>  </span><span>c24</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>ri</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; &#8704;i. Suc i &lt; length ?elst &#10230; 
                  (&#8707;m&#8712;es. ?elst!i@[(?elst!Suc i)!0]&#8712;commit_es &#915; (?Guar m,?Post m) &#8743; gets_es ((?elst!Suc i)!0) &#8712; ?Post m
                       &#8743; (&#8707;k. &#915; &#8866; (?elst!i@[(?elst!Suc i)!0])!0-es-(EvtEnt m)&#9839;k&#8594;(?elst!i@[(?elst!Suc i)!0])!1))&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>EventSys_sound_aux_i</span><span class="delimiter">[</span><span>of</span><span> </span><span>es</span><span> </span><span>&#915;</span><span> </span><span class="var">?Pre</span><span>  </span><span class="var">?Rely</span><span> </span><span class="var">?Guar</span><span> </span><span class="var">?Post</span><span> 
</span><span>                      </span><span class="string"><span class="delete"><span class="delete">&quot;prea&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Rely k&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Guar k&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Post k&quot;</span></span></span><span> </span><span class="var">?esl1</span><span> </span><span>s0</span><span> </span><span>x0</span><span> </span><span>e</span><span> </span><span>s1</span><span> </span><span>x1</span><span> </span><span>xs</span><span> </span><span class="var">?elst</span><span class="delimiter">]</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>               
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span>   </span><span>c16</span><span> </span><span>c40</span><span> </span><span>c41</span><span> </span><span>c42</span><span> </span><span>c43</span><span> </span><span>c44</span><span> </span><span>c24</span><span> </span><span>c7</span><span> </span><span>c8</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>ri_forall</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span> 
</span><span>                </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length ?elst &#10230; 
                    (&#8704;ei &#8712; es. (&#8707;k. &#915; &#8866;(?elst!i@[(?elst!Suc i)!0])!0-es-(EvtEnt (ei))&#9839;k&#8594;(?elst!i@[(?elst!Suc i)!0])!1) 
                                  &#10230; ?elst!i@[(?elst!Suc i)!0]&#8712;commit_es &#915; (?Guar ei, ?Post ei)
                                    &#8743; gets_es ((?elst!Suc i)!0) &#8712;  ?Post ei)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>EventSys_sound_aux_i_forall</span><span class="delimiter">[</span><span>of</span><span> </span><span>es</span><span>  </span><span>&#915;</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot; ?Pre&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; ?Rely&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; ?Guar&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?Post&quot;</span></span></span><span>
</span><span>                      </span><span class="string"><span class="delete"><span class="delete">&quot;prea&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Rely k&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Guar k&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Post k&quot;</span></span></span><span> </span><span class="var">?esl1</span><span> </span><span>s0</span><span> </span><span>x0</span><span> </span><span>e</span><span> </span><span>s1</span><span> </span><span>x1</span><span> </span><span>xs</span><span> </span><span class="var">?elst</span><span class="delimiter">]</span><span>   
</span><span>                   </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                      
</span><span>
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b5</span><span>  </span><span>c16</span><span> </span><span>c40</span><span> </span><span>c41</span><span> </span><span>c42</span><span> </span><span>c43</span><span> </span><span>c44</span><span> </span><span>b10</span><span> </span><span>c7</span><span> </span><span>c8</span><span>  </span><span>c24</span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>rl_forall</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ei&#8712; es. (&#8707;k. &#915; &#8866;(last ?elst)!0-es-(EvtEnt ei)&#9839;k&#8594;(last ?elst)!1)
                            &#10230; last ?elst&#8712;commit_es &#915;( ?Guar ei, ?Post ei)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>EventSys_sound_aux_last_forall</span><span class="delimiter">[</span><span>of</span><span> </span><span>es</span><span> </span><span>&#915;</span><span>   </span><span class="var">?Pre</span><span>   </span><span class="var">?Rely</span><span>  </span><span class="var">?Guar</span><span> </span><span class="var">?Post</span><span>
</span><span>                      </span><span class="string"><span class="delete"><span class="delete">&quot;prea&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Rely k&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Guar k&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Post k&quot;</span></span></span><span> </span><span class="var">?esl1</span><span> </span><span>s0</span><span> </span><span>x0</span><span> </span><span>e</span><span> </span><span>s1</span><span> </span><span>x1</span><span> </span><span>xs</span><span> </span><span class="var">?elst</span><span class="delimiter">]</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                      
</span><span>
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c16</span><span> </span><span>c17</span><span> </span><span>c18</span><span> </span><span>c19</span><span> </span><span>c20</span><span> </span><span>b10</span><span> </span><span>c7</span><span> </span><span>c8</span><span>  </span><span>c24</span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>rl</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;ei&#8712; es. last ?elst&#8712;commit_es &#915;( ?Guar ei, ?Post ei) 
                        &#8743; (&#8707;k. &#915; &#8866;(last ?elst)!0-es-(EvtEnt ei)&#9839;k&#8594;(last ?elst)!1)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>EventSys_sound_aux_last</span><span class="delimiter">[</span><span>of</span><span> </span><span>es</span><span> </span><span>&#915;</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;?Pre&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?Rely&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?Guar&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; ?Post&quot;</span></span></span><span>
</span><span>                      </span><span class="string"><span class="delete"><span class="delete">&quot;prea&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Rely k&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Guar k&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Post k&quot;</span></span></span><span> </span><span class="var">?esl1</span><span> </span><span>s0</span><span> </span><span>x0</span><span> </span><span>e</span><span> </span><span>s1</span><span> </span><span>x1</span><span> </span><span>xs</span><span> </span><span class="var">?elst</span><span class="delimiter">]</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c40</span><span> </span><span>c41</span><span> </span><span>c42</span><span> </span><span>c43</span><span> </span><span>c44</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>              
</span><span>               </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c8</span><span> </span><span>c7</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>no_mident</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. i &lt; length ?elst &#10230; 
                             &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length (?elst!i) &#8743; 
                             getspc_es (?elst!i!j) = EvtSys es &#8743; getspc_es (?elst!i!Suc j) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>                 </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>parse_es_cpts_i2_noent_mid</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?esl1</span><span> </span><span>es</span><span> </span><span>s0</span><span> </span><span>x0</span><span> </span><span>e</span><span> </span><span>s1</span><span> </span><span>x1</span><span> </span><span>xs</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;parse_es_cpts_i2 ?esl1  es [[]]&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c8</span><span> </span><span>c7</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>no_mident_i</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length ?elst &#10230; 
                             &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length (?elst!i@[?elst!Suc i!0]) &#8743; 
                             getspc_es ((?elst!i@[?elst!Suc i!0])!j) = EvtSys es &#8743; getspc_es ((?elst!i@[?elst!Suc i!0])!Suc j) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>                 </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>parse_es_cpts_i2_noent_mid_i</span><span class="delimiter">)</span><span>
</span><span>              
</span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>in_cpts_i</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length ?elst &#10230; (?elst!i)@[?elst!Suc i!0] &#8712;cpts_es &#915;&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>parse_es_cpts_i2_in_cptes_i</span><span class="delimiter">[</span><span>of</span><span>  </span><span class="var">?esl1</span><span> </span><span>es</span><span> </span><span>s0</span><span> </span><span>x0</span><span> </span><span>e</span><span> </span><span>s1</span><span> </span><span>x1</span><span> </span><span>xs</span><span> </span><span>&#915;</span><span> </span><span class="var">?elst</span><span class="delimiter">]</span><span> </span><span>c7</span><span> </span><span>c8</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>              
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>in_cpts_last</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;last ?elst &#8712;cpts_es &#915;&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>parse_es_cpts_i2_in_cptes_last</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?esl1</span><span> </span><span>es</span><span> </span><span>s0</span><span> </span><span>x0</span><span> </span><span>e</span><span> </span><span>s1</span><span> </span><span>x1</span><span> </span><span>xs</span><span> </span><span>&#915;</span><span> </span><span class="var">?elst</span><span class="delimiter">]</span><span> </span><span>c7</span><span> </span><span>c8</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>in_cpts_last1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?elst ! (length ?elst - 1) &#8712; cpts_es &#915;&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>c7</span><span> </span><span>c9</span><span> </span><span>concat.simps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>cpts_es_not_empty</span><span> </span><span>last_conv_nth</span><span class="delimiter">)</span><span> 
</span><span>                
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c5</span><span> </span><span>c8</span><span> </span><span>c7</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>len_start_elst</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span> 
</span><span>                </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length ?elst. length (?elst!i) &#8805; 2 &#8743; getspc_es (?elst!i!0) = EvtSys es 
                                  &#8743; getspc_es (?elst!i!1) &#8800; EvtSys es&quot;</span></span></span><span> 
</span><span>                </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>parse_es_cpts_i2_start_aux</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?esl1</span><span> </span><span>es</span><span> </span><span>s0</span><span> </span><span>x0</span><span> </span><span>e</span><span> </span><span>s1</span><span> </span><span>x1</span><span> </span><span>xs</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;parse_es_cpts_i2 ?esl1 es [[]]&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c30</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length ?esl1 
                      &#10230; (&#8707;k j. (Suc k &lt; length ?elst &#8743; Suc j &lt; length (?elst!k@[(?elst!Suc k)!0]) &#8743; 
                                  ?esl1!i = (?elst!k@[(?elst!Suc k)!0])!j &#8743; ?esl1!Suc i = (?elst!k@[(?elst!Suc k)!0])!Suc j) 
                              &#8744; (Suc k = length ?elst &#8743; Suc j &lt; length (?elst!k) &#8743; 
                                  ?esl1!i = ?elst!k!j &#8743; ?esl1!Suc i = ?elst!k!Suc j))&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c9</span><span> </span><span>concat_list_lemma</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?esl1</span><span> </span><span class="var">?elst</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>              
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p12</span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c33</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. i &lt; length ?esl 
                &#10230; getspc_es (?esl!i) = EvtSys es &#8744; (&#8707;e. getspc_es (?esl!i) = EvtSeq e (EvtSys es) &#8743; is_anonyevt e)&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtsys_all_es_in_cpts_anony</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?esl</span><span> </span><span>&#915;</span><span> </span><span>es</span><span class="delimiter">]</span><span>
</span><span>                  </span><span>c2</span><span> </span><span>gr0I</span><span> </span><span>gr_implies_not0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a3</span><span> </span><span>c4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c34</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl!i = ?esl1!(i - n)&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_lessD</span><span> </span><span>add_diff_inverse_nat</span><span> </span><span>leD</span><span> </span><span>less_imp_le_nat</span><span> </span><span>nth_drop</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a3</span><span> </span><span>c4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c340</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl!Suc i = ?esl1!(Suc (i - n))&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_lessD</span><span> </span><span>add_diff_inverse_nat</span><span> </span><span>leD</span><span> </span><span>less_imp_le_nat</span><span> </span><span>nth_drop</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a3</span><span> </span><span>c4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc (i - n) &lt; length ?esl1&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Suc_diff_le</span><span> </span><span>diff_less_mono</span><span> </span><span>le_SucI</span><span class="delimiter">)</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c30</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;k j. (Suc k &lt; length ?elst &#8743; Suc j &lt; length (?elst!k@[(?elst!Suc k)!0]) &#8743; 
                                  ?esl1!(i - n) = (?elst!k@[(?elst!Suc k)!0])!j &#8743; ?esl1!Suc (i - n) = (?elst!k@[(?elst!Suc k)!0])!Suc j) 
                              &#8744; (Suc k = length ?elst &#8743; Suc j &lt; length (?elst!k) &#8743; 
                                  ?esl1!(i - n) = ?elst!k!j &#8743; ?esl1!Suc (i - n) = ?elst!k!Suc j)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>kk</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>j</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c35</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(Suc kk &lt; length ?elst &#8743; Suc j &lt; length (?elst!kk@[(?elst!Suc kk)!0]) &#8743; 
                                  ?esl1!(i - n) = (?elst!kk@[(?elst!Suc kk)!0])!j &#8743; ?esl1!Suc (i - n) = (?elst!kk@[(?elst!Suc kk)!0])!Suc j) 
                              &#8744; (Suc kk = length ?elst &#8743; Suc j &lt; length (?elst!kk) &#8743; 
                                  ?esl1!(i - n) = ?elst!kk!j &#8743; ?esl1!Suc (i - n) = ?elst!kk!Suc j)&quot;</span></span></span><span>
</span><span>                 </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?elstk</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?elst!kk@[(?elst!Suc kk)!0]&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c36</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length ?elstk &gt; 2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>len_start_elst</span><span class="delimiter">[</span><span>of</span><span> </span><span>kk</span><span class="delimiter">]</span><span> </span><span>c35</span><span>
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_lessD</span><span> </span><span>le_imp_less_Suc</span><span> </span><span>length_append_singleton</span><span> </span><span>lessI</span><span class="delimiter">)</span><span>
</span><span>
</span><span>              </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?elstl</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?elst!kk&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c37</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length ?elstl &#8805; 2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>len_start_elst</span><span class="delimiter">[</span><span>of</span><span> </span><span>kk</span><span class="delimiter">]</span><span> </span><span>c35</span><span>
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_lessD</span><span> </span><span>lessI</span><span class="delimiter">)</span><span>
</span><span>
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c35</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c38</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc kk &#8804; length ?elst&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>less_or_eq_imp_le</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c38</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length (?elst!kk) &#8743; 
                         getspc_es (?elst!kk!j) = EvtSys es &#8743; getspc_es (?elst!kk!Suc j) &#8800; EvtSys es)&quot;</span></span></span><span> 
</span><span>                 </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>no_mident</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. j &gt; 0 &#8743; Suc j &lt; length (?elst!kk) &#10230; getspc_es ((?elst!kk) ! j) = EvtSys es 
                      &#10230; getspc_es ((?elst!kk) ! Suc j) = EvtSys es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>noevtent_inmid_eq</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d43</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length ?esl = n + length ?esl1&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Suc (i - n) &lt; length (drop n (cs k))&#8250;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c35</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>                  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(Suc kk &lt; length ?elst &#8743; Suc j &lt; length ?elstk &#8743; 
                             ?esl1!(i - n) = ?elstk!j &#8743; ?esl1!Suc (i - n) = ?elstk!Suc j)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;m &#8712; es. ?elstk&#8712;commit_es &#915;(?Guar  m,?Post m)
                              &#8743; gets_es ((?elst!Suc kk)!0) &#8712; ?Post m
                            &#8743; (&#8707;k. &#915; &#8866; ?elstk!0-es-(EvtEnt (m))&#9839;k&#8594;?elstk!1)&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>ri</span><span class="delimiter">[</span><span>of</span><span> </span><span>kk</span><span class="delimiter">]</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rl</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                  
</span><span>                  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d01</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j &#8800; 0&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>                      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j = 0&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>len_start_elst</span><span class="delimiter">[</span><span>of</span><span> </span><span>kk</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (?elstk!j) = EvtSys es 
                            &#8743; getspc_es (?elstk!Suc j) &#8800; EvtSys es&quot;</span></span></span><span>
</span><span>                         </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>hide_lams</span><span class="delimiter">)</span><span> </span><span>One_nat_def</span><span> </span><span>Suc_1</span><span> </span><span>Suc_le_lessD</span><span> </span><span>c34</span><span> </span><span>d0</span><span> </span><span>less_imp_le_nat</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#8707;ess. getspc_es (?esl ! i) = EvtSys ess)&quot;</span></span></span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cmd_enable_impl_notesys2</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl ! i&quot;</span></span></span><span> </span><span>cmd</span><span> </span><span>k</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl ! Suc i&quot;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl!i = ?elstk!j&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>c34</span><span class="delimiter">)</span><span> 
</span><span>                      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span>False</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>                  
</span><span>                  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d1_1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ii. ii &gt; 0 &#8743; Suc ii &lt; length ?elstk 
                        &#10230; &#172;(&#8707;e. &#915; &#8866;(?elstk!ii) -es-((EvtEnt e)&#9839;k)&#8594; (?elstk!(Suc ii)))&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>                      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>ii</span><span>
</span><span>                      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ii &gt; 0 &#8743; Suc ii &lt; length ?elstk&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#8707;e. &#915; &#8866;(?elstk!ii) -es-((EvtEnt e)&#9839;k)&#8594; (?elstk!(Suc ii)))&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (?elstk!ii) = EvtSys es&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>f0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (?elstk!ii) = EvtSys es&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d1</span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (?elstk!(Suc ii)) = EvtSys es&quot;</span></span></span><span>
</span><span>                            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>Suc_lessI</span><span> </span><span>Suc_less_eq</span><span> </span><span>c7</span><span> </span><span>c8</span><span> </span><span>e0</span><span> </span><span>length_append_singleton</span><span> 
</span><span>                              </span><span>nth_append</span><span> </span><span>nth_append_length</span><span> </span><span>parse_es_cpts_i2_start_aux</span><span class="delimiter">)</span><span> 
</span><span>                          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>f0</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtsys_not_eq_in_tran_aux1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>f0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (?elstk!ii) &#8800; EvtSys es&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d0</span><span> </span><span>e0</span><span> </span><span>in_cpts_i</span><span class="delimiter">[</span><span>of</span><span> </span><span>kk</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?elstk &#8712; cpts_es &#915; &quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                          </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d0</span><span> </span><span>f1</span><span> </span><span>len_start_elst</span><span class="delimiter">[</span><span>of</span><span> </span><span>kk</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> 
</span><span>                            </span><span class="string"><span class="delete"><span class="delete">&quot;length ?elstk &gt; 0 &#8743; getspc_es (?elstk!0) = EvtSys es&quot;</span></span></span><span> 
</span><span>                            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Suc_lessD</span><span> </span><span>cpts_es_not_empty</span><span> </span><span>length_greater_0_conv</span><span> 
</span><span>                                </span><span>list.size</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>not_numeral_le_zero</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span>
</span><span>                          </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e. getspc_es (?elstk!ii) = EvtSeq e (EvtSys es) 
                                            &#8743; is_anonyevt e&quot;</span></span></span><span> 
</span><span>                            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtsys_all_es_in_cpts_anony</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?elstk</span><span> </span><span>&#915;</span><span> </span><span>es</span><span class="delimiter">]</span><span> </span><span>e0</span><span> </span><span>f0</span><span> </span><span>Suc_lessD</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>                          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>incpts_es_eseq_not_evtent</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?elstk</span><span> </span><span>&#915;</span><span>  </span><span>ii</span><span class="delimiter">]</span><span> 
</span><span>                            </span><span>in_cpts_i</span><span class="delimiter">[</span><span>of</span><span> </span><span>kk</span><span class="delimiter">]</span><span> </span><span>d0</span><span> </span><span>e0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (?elstk!0) = EvtSys es &#8743; getspc_es (?elstk!1) &#8800; EvtSys es&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>len_start_elst</span><span class="delimiter">[</span><span>of</span><span> </span><span>0</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>hide_lams</span><span class="delimiter">)</span><span> </span><span>One_nat_def</span><span> 
</span><span>                      </span><span>Suc_1</span><span> </span><span>Suc_le_lessD</span><span> </span><span>Suc_lessD</span><span> </span><span>d0</span><span> </span><span>len_start_elst</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span> 
</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c9</span><span> </span><span>d0</span><span> </span><span>len_start_elst</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;si ti. si = length (concat (take kk ?elst)) &#8743; ti = Suc (length (concat (take (Suc kk) ?elst))) &#8743;
                      si &#8804; length ?esl1 &#8743; ti &lt; length ?esl1 &#8743; si &lt; ti &#8743; drop si (take ti ?esl1) = ?elstk&quot;</span></span></span><span>
</span><span>                  </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*have &quot;&#8707;si ti. si &#8804; length ?esl1 &#8743; ti &#8804; length ?esl1 &#8743; si &lt; ti &#8743; ?elstk = drop si (take ti ?esl1)&quot; *)</span></span></span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>concat_list_lemma_withnextfst3</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?esl1</span><span> </span><span class="var">?elst</span><span> </span><span>kk</span><span class="delimiter">]</span><span>
</span><span>                      </span><span>Suc_1</span><span> </span><span>Suc_le_lessD</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>presburger</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>si</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>ti</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>d4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;si = length (concat (take kk ?elst)) 
                      &#8743; ti = Suc (length (concat (take (Suc kk) ?elst))) 
                      &#8743; si &#8804; length ?esl1 &#8743; ti &lt; length ?esl1 
                      &#8743; si &lt; ti &#8743; drop si (take ti ?esl1) = ?elstk&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d42</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;si + (length ?elstk) = ti&quot;</span></span></span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>drop_take_eq</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?elstk</span><span> </span><span>si</span><span> </span><span>ti</span><span> </span><span class="var">?esl1</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length ?elstk&quot;</span></span></span><span class="delimiter">]</span><span> </span><span>c36</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>cpts_es_not_empty</span><span> </span><span>d0</span><span> </span><span>in_cpts_i</span><span> </span><span>length_greater_0_conv</span><span> </span><span>less_imp_le_nat</span><span class="delimiter">)</span><span> 
</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ti &lt; length ?esl1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d43</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d41</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;n + ti &lt; length ?esl&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?elstk = drop (si+n) (take (ti+n) ?esl)&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>drop_drop</span><span> </span><span>take_drop</span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?elstk!0 = ?esl!(si+n)&quot;</span></span></span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Nat.add_0_right</span><span> 
</span><span>                        </span><span>append_is_Nil_conv</span><span> </span><span>append_take_drop_id</span><span> </span><span>drop_eq_Nil</span><span> 
</span><span>                        </span><span>leI</span><span> </span><span>nat_le_linear</span><span> </span><span>not_Cons_self2</span><span> </span><span>nth_append</span><span> </span><span>nth_drop</span><span class="delimiter">)</span><span>
</span><span>                  
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?elstk!1 = drop (si+n) (take (ti+n) ?esl) ! 1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d0</span><span> </span><span>d5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop (si+n) (take (ti+n) ?esl) ! 1 = ?esl!(Suc (si+n))&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>add.commute</span><span> </span><span>add_lessD1</span><span> </span><span>drop_take_sametrace</span><span> </span><span>plus_1_eq_Suc</span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?elstk!1 = ?esl!(Suc (si+n))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>                  
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c36</span><span> </span><span>d4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d71</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ti &gt; si + 2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>drop_take_ln</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?elstk</span><span> </span><span>si</span><span> </span><span>ti</span><span> </span><span class="var">?esl1</span><span> </span><span>2</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c1</span><span> </span><span>c3</span><span> </span><span>d4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d72</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc (si+n) &lt; length ?esl&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;si + 2 &lt; length (cs k) - n&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;ti &lt; length (drop n (cs k))&#8250;</span></span></span><span> </span><span>d71</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc (Suc (si + n)) &lt; length (cs k)&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>linarith</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_le_lessD</span><span> </span><span>order.strict_implies_order</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span>d2</span><span> </span><span>d6</span><span> </span><span>d7</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e. &#915; &#8866;?esl!(si+n) -es-((EvtEnt e)&#9839;k)&#8594; ?esl!(Suc (si+n))&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>entevt_in_conjoin_cpts</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>c</span><span> </span><span>cs</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;si+n&quot;</span></span></span><span> </span><span>k</span><span> </span><span>es</span><span> </span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>ente</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>d8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866;?esl!(si+n) -es-((EvtEnt ente)&#9839;k)&#8594; ?esl!(Suc (si+n))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d2</span><span> </span><span>d6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;ei &#8712; es. ente = ei&quot;</span></span></span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtsysent_evtent3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>ei</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>d9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ei&#8712;es &#8743; ente = ei&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>ef</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>d9&#39;</span><span> </span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ef&#8712; esf&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c13</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>  
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>ri_forall</span><span class="delimiter">[</span><span>of</span><span> </span><span>kk</span><span> </span><span>ei</span><span class="delimiter">]</span><span> </span><span>d0</span><span> </span><span>d6</span><span> </span><span>d7</span><span> </span><span>d8</span><span> </span><span>d9</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?elstk &#8712; commit_es &#915;( ?Guar ei, ?Post ei)&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d11</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k ! i = ?elstk ! j&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>c34</span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d12</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k ! Suc i = ?elstk ! Suc j&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>c340</span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d13</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866;?elstk ! j -es-Cmd cmd&#9839;k&#8594; ?elstk ! Suc j&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a4</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d14</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (?elstk ! j), gets_es (?elstk ! Suc j)) &#8712;  ?Guar ei &quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d10</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length ?elstk &#10230; 
                              (&#8707;t. &#915; &#8866;?elstk!i -es-t&#8594; ?elstk!(Suc i)) &#10230; 
                                  (gets_es (?elstk!i), gets_es (?elstk!Suc i)) &#8712;  ?Guar ei&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>commit_es_def</span><span class="delimiter">)</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d0</span><span> </span><span>d13</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>  
</span><span>                        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d11</span><span> </span><span>d12</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d15</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; ?Guar ei&quot;</span></span></span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d0</span><span> </span><span>no_mident_i</span><span class="delimiter">[</span><span>of</span><span> </span><span>kk</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#8707;m. m &gt; 0 &#8743; Suc m &lt; length ?elstk &#8743; 
                             getspc_es (?elstk!m) = EvtSys es &#8743; getspc_es (?elstk!Suc m) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d16</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;m. m &gt; 0 &#8743; Suc m &lt; length ?elstk 
                      &#10230; &#172;(getspc_es (?elstk!m) = EvtSys es &#8743; getspc_es (?elstk!Suc m) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d17</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;m. m &gt; (si + n) &#8743; m &lt; ti + n - 1 &#10230; 
                             &#172;(getspc_es (?esl!m) = EvtSys es &#8743; getspc_es (?esl!Suc m) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>                      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>m</span><span>
</span><span>                      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &gt; (si + n) &#8743; m &lt; ti + n - 1&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m - (n+si) &gt; 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc (m - (n+si)) &lt; length ?elstk&quot;</span></span></span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>e0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m - (n + si) &lt; ti - si - 1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc (m - (n + si)) &lt; ti - si&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d42</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(getspc_es (?elstk!(m-(n+si))) = EvtSys es 
                          &#8743; getspc_es (?elstk!Suc (m-(n+si))) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>d16</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m - (n+si)&quot;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>e1</span><span> </span><span>e2</span><span> </span><span>d5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl!m = ?elstk!(m - (n+si))&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>drop_take_sametrace</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?elstk</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;si+n&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ti+n&quot;</span></span></span><span> </span><span class="var">?esl</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m - (n+si)&quot;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>e1</span><span> </span><span>e2</span><span> </span><span>d5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl!Suc m = ?elstk!Suc (m - (n+si))&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>drop_take_sametrace</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?elstk</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;si+n&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ti+n&quot;</span></span></span><span> </span><span class="var">?esl</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc (m - (n+si))&quot;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(getspc_es (?esl!m) = EvtSys es &#8743; getspc_es (?esl!Suc m) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                  </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*from d0 have &quot;&#8704;i. Suc i &lt; length ?elstk &#10230; &#172;(&#8707;e. ?elstk!i -es-((EvtEnt e)&#9839;k)&#8594; ?elstk!(Suc i))&quot;
                    using no_mident_i[of kk] *)</span></span></span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d18</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;m. m &gt; (si + n) &#8743; m &lt; ti + n - 1 &#10230; 
                             &#172;(&#8707;e. &#915; &#8866;?esl!m -es-((EvtEnt e)&#9839;k)&#8594; ?esl!Suc m)&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>                      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>m</span><span>
</span><span>                      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &gt; (si + n) &#8743; m &lt; ti + n - 1&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d17</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(getspc_es (?esl!m) = EvtSys es &#8743; getspc_es (?esl!Suc m) &#8800; EvtSys es)&quot;</span></span></span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span>a8</span><span> </span><span>a81</span><span> </span><span>d41</span><span> </span><span>e0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#8707;e. &#915; &#8866;?esl!m -es-((EvtEnt e)&#9839;k)&#8594; ?esl!Suc m)&quot;</span></span></span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>notentevt_in_conjoin_cpts</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>c</span><span> </span><span>cs</span><span> </span><span>m</span><span> </span><span>k</span><span> </span><span>es</span><span class="delimiter">]</span><span> </span><span>evtsys_allevtseqorevtsys</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?esl</span><span> </span><span>es</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>esll</span><span class="delimiter">]</span><span>
</span><span>                          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                  
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d71</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc (si + n) &lt; ti + n - 1&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_eq_plus1</span><span> </span><span>add.assoc</span><span> </span><span>add_2_eq_Suc</span><span> </span><span>add_diff_cancel_right&#39;</span><span> </span><span>less_diff_conv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>linarith</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d41</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc (ti + n - 1) &lt; length (cs k)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>calculation</span><span> </span><span>d41</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>linarith</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">ultimately</span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d19</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;m. m &gt; (si + n) &#8743; m &#8804; (ti + n - 1) &#10230; getx_es ((cs k)!m) k = ente&quot;</span></span></span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtent_impl_curevt_in_cpts_es</span><span class="delimiter">[</span><span>of</span><span> </span><span>c</span><span> </span><span>cs</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;si + n&quot;</span></span></span><span> </span><span>k</span><span> </span><span>ente</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ti + n - 1&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>                       </span><span>d18</span><span> </span><span>p1</span><span> </span><span>p6</span><span> </span><span>d8</span><span> </span><span>d41</span><span> </span><span>d71</span><span> </span><span>d72</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d0</span><span> </span><span>d42</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;si + n + j &#8804; ti + n - 1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d19</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;si + n + j&quot;</span></span></span><span class="delimiter">]</span><span> </span><span>d01</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getx_es ((cs k)!(si + n + j)) k = ente&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d11</span><span> </span><span>d5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getx_es ((cs k)!i) k = ente&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_lessD</span><span> </span><span>d0</span><span> </span><span>drop_take_sametrace</span><span class="delimiter">)</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">moreover</span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> (ef))) = snd (ef)&quot;</span></span></span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>all_evts_es_esys</span><span>  </span><span>d9</span><span> </span><span>nth_mem</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>d9&#39;</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c13</span><span> </span><span>d9</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;ef&#8712;esf. E<span class="hidden">&#8681;</span><sub>e</sub> ef = ei&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>E<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>  
</span><span>                  </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d9</span><span> </span><span>c13</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;ef .?Guar ei = Guar<span class="hidden">&#8681;</span><sub>f</sub> (snd (ef))&quot;</span></span></span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Guar<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span>  </span><span>Guar<span class="hidden">&#8681;</span><sub>f</sub>_def</span><span>  
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>d15</span><span> </span><span>d9</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Guar<span class="hidden">&#8681;</span><sub>f</sub>_def</span><span> </span><span>a0</span><span> </span><span>a21</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>                </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc kk = length ?elst &#8743; Suc j &lt; length ?elstl &#8743; 
                              ?esl1!(i - n) = ?elstl!j &#8743; ?esl1!Suc (i - n) = ?elstl!Suc j&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d01</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j &#8800; 0&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>                      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j = 0&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>len_start_elst</span><span class="delimiter">[</span><span>of</span><span> </span><span>kk</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (?elstl!j) = EvtSys es 
                            &#8743; getspc_es (?elstl!Suc j) &#8800; EvtSys es&quot;</span></span></span><span>
</span><span>                         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>One_nat_def</span><span> </span><span>d0</span><span> </span><span>lessI</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#8707;ess. getspc_es (?esl ! i) = EvtSys ess)&quot;</span></span></span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cmd_enable_impl_notesys2</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl ! i&quot;</span></span></span><span> </span><span>cmd</span><span> </span><span>k</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;?esl ! Suc i&quot;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl!i = ?elstl!j&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>c34</span><span class="delimiter">)</span><span> 
</span><span>                      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span>False</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>                  
</span><span>                  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d1_1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ii. ii &gt; 0 &#8743; Suc ii &lt; length ?elstl 
                        &#10230; &#172;(&#8707;e. &#915; &#8866;(?elstl!ii) -es-((EvtEnt e)&#9839;k)&#8594; (?elstl!(Suc ii)))&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>                      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>ii</span><span>
</span><span>                      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ii &gt; 0 &#8743; Suc ii &lt; length ?elstl&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#8707;e. &#915; &#8866;(?elstl!ii) -es-((EvtEnt e)&#9839;k)&#8594; (?elstl!(Suc ii)))&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (?elstl!ii) = EvtSys es&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>f0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (?elstl!ii) = EvtSys es&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d1</span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (?elstl!(Suc ii)) = EvtSys es&quot;</span></span></span><span>
</span><span>                            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>Suc_lessI</span><span> </span><span>Suc_less_eq</span><span> </span><span>c7</span><span> </span><span>c8</span><span> </span><span>e0</span><span> </span><span>length_append_singleton</span><span> 
</span><span>                              </span><span>nth_append</span><span> </span><span>nth_append_length</span><span> </span><span>parse_es_cpts_i2_start_aux</span><span class="delimiter">)</span><span> 
</span><span>                          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>f0</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtsys_not_eq_in_tran_aux1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>f0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (?elstl!ii) &#8800; EvtSys es&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc kk = length ?elst&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>in_cpts_last1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?elstl &#8712; cpts_es &#915; &quot;</span></span></span><span>
</span><span>                            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>diff_Suc_1</span><span class="delimiter">)</span><span> 
</span><span>                          </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>f1</span><span> </span><span>len_start_elst</span><span class="delimiter">[</span><span>of</span><span> </span><span>kk</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> 
</span><span>                            </span><span class="string"><span class="delete"><span class="delete">&quot;length ?elstl &gt; 0 &#8743; getspc_es (?elstl!0) = EvtSys es&quot;</span></span></span><span>
</span><span>                              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_le_lessD</span><span> </span><span>c38</span><span> </span><span>d0</span><span> </span><span>gr_implies_not0</span><span> 
</span><span>                              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>linarith</span><span>
</span><span>                          </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e. getspc_es (?elstl!ii) = EvtSeq e (EvtSys es) 
                                            &#8743; is_anonyevt e&quot;</span></span></span><span> 
</span><span>                            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtsys_all_es_in_cpts_anony</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?elstl</span><span> </span><span>&#915;</span><span> </span><span>es</span><span class="delimiter">]</span><span> </span><span>e0</span><span> </span><span>f0</span><span> </span><span>Suc_lessD</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>                          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>incpts_es_eseq_not_evtent</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?elstl</span><span> </span><span>&#915;</span><span>  </span><span>ii</span><span class="delimiter">]</span><span> 
</span><span>                            </span><span>in_cpts_last1</span><span> </span><span>f2</span><span> </span><span>d0</span><span> </span><span>e0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (?elstl!0) = EvtSys es &#8743; getspc_es (?elstl!1) &#8800; EvtSys es&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>len_start_elst</span><span class="delimiter">[</span><span>of</span><span> </span><span>kk</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c9</span><span> </span><span>d0</span><span> </span><span>len_start_elst</span><span class="delimiter">[</span><span>of</span><span> </span><span>kk</span><span class="delimiter">]</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;si ti. si = length (concat (take kk ?elst)) &#8743; ti = length (concat (take (Suc kk) ?elst)) &#8743;
                      si &#8804; length ?esl1 &#8743; ti &#8804; length ?esl1 &#8743; si &lt; ti &#8743; drop si (take ti ?esl1) = ?elstl&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>concat_list_lemma3</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?esl1</span><span> </span><span class="var">?elst</span><span> </span><span>kk</span><span class="delimiter">]</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_1</span><span> </span><span>Suc_le_lessD</span><span> </span><span>c38</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>presburger</span><span>
</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>si</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>ti</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>d4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;si = length (concat (take kk ?elst)) 
                      &#8743; ti = length (concat (take (Suc kk) ?elst)) 
                      &#8743; si &#8804; length ?esl1 &#8743; ti &#8804; length ?esl1 &#8743; si &lt; ti 
                      &#8743; drop si (take ti ?esl1) = ?elstl&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d42</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;si + (length ?elstl) = ti&quot;</span></span></span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>drop_take_eq</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?elstl</span><span> </span><span>si</span><span> </span><span>ti</span><span> </span><span class="var">?esl1</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length ?elstl&quot;</span></span></span><span class="delimiter">]</span><span> </span><span>c37</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>d0</span><span> </span><span>gr0I</span><span> </span><span>less_nat_zero_code</span><span class="delimiter">)</span><span>
</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d0</span><span> </span><span>d4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ti = length ?esl1&quot;</span></span></span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>d0</span><span> </span><span>c9</span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d43</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d41</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;n + ti = length ?esl&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?elstl = drop (si+n) (take (ti+n) ?esl)&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>drop_drop</span><span> </span><span>take_drop</span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?elstl!0 = ?esl!(si+n)&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Cons_nth_drop_Suc</span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;ti = length (drop n (cs k))&#8250;</span></span></span><span> </span><span>d4</span><span> 
</span><span>                      </span><span>drop_drop</span><span> </span><span>drop_eq_Nil</span><span> </span><span>linorder_not_less</span><span> </span><span>nth_Cons_0</span><span> </span><span>take_all</span><span class="delimiter">)</span><span> 
</span><span>                                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?elstl!1 = drop (si+n) (take (ti+n) ?esl) ! 1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d0</span><span> </span><span>d5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop (si+n) (take (ti+n) ?esl) ! 1 = ?esl!(Suc (si+n))&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>add.commute</span><span> </span><span>add_lessD1</span><span> </span><span>drop_take_sametrace</span><span> </span><span>plus_1_eq_Suc</span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?elstl!1 = ?esl!(Suc (si+n))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c37</span><span> </span><span>d4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d71</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ti &gt; si + 2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>drop_take_ln</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?elstl</span><span> </span><span>si</span><span> </span><span>ti</span><span> </span><span class="var">?esl1</span><span> </span><span>2</span><span class="delimiter">]</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Suc_numeral</span><span> </span><span>d0</span><span> </span><span>d01</span><span> </span><span>diff_Suc_1</span><span> </span><span>diff_add_zero</span><span> </span><span>le_eq_less_or_eq</span><span> 
</span><span>                        </span><span>less_imp_Suc_add</span><span> </span><span>numeral_Bit0</span><span> </span><span>numeral_plus_numeral</span><span> </span><span>one_eq_numeral_iff</span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c1</span><span> </span><span>c3</span><span> </span><span>d4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d72</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc (si+n) &lt; length ?esl&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_leI</span><span> </span><span>Suc_n_not_le_n</span><span> </span><span>add.commute</span><span> </span><span>add_2_eq_Suc&#39;</span><span> </span><span>add_Suc_right</span><span>
</span><span>                      </span><span>d41</span><span> </span><span>leI</span><span> </span><span>le_antisym</span><span> </span><span>less_trans_Suc</span><span> </span><span>nat_add_left_cancel_less</span><span> 
</span><span>                      </span><span>nat_le_linear</span><span> </span><span>not_less</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>linarith</span><span>
</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span>d2</span><span> </span><span>d6</span><span> </span><span>d7</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e. &#915; &#8866;?esl!(si+n) -es-((EvtEnt e)&#9839;k)&#8594; ?esl!(Suc (si+n))&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>entevt_in_conjoin_cpts</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>c</span><span> </span><span>cs</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;si+n&quot;</span></span></span><span> </span><span>k</span><span> </span><span>es</span><span class="delimiter">]</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>ente</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>d8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866;?esl!(si+n) -es-((EvtEnt ente)&#9839;k)&#8594; ?esl!(Suc (si+n))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d2</span><span> </span><span>d6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;ei&#8712; es. ente = ei&quot;</span></span></span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtsysent_evtent3</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span class="string"><span class="delete"><span class="delete">&quot;?esl!(si+n)&quot;</span></span></span><span> </span><span>ente</span><span> </span><span>k</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl!(Suc (si+n))&quot;</span></span></span><span> </span><span>es</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>ei</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>d9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ei &#8712; es &#8743; ente = ei&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d0</span><span> </span><span>d6</span><span> </span><span>d7</span><span> </span><span>d8</span><span> </span><span>d9</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?elstl &#8712; commit_es &#915;(?Guar ei, ?Post ei)&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>c7</span><span> </span><span>c9</span><span> </span><span>concat.simps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>cpts_es_not_empty</span><span> </span><span>diff_Suc_1</span><span> </span><span>last_conv_nth</span><span> </span><span>rl_forall</span><span class="delimiter">)</span><span>
</span><span>                  
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d11</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k ! i = ?elstl ! j&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>c34</span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d12</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k ! Suc i = ?elstl ! Suc j&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>c340</span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d13</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866;?elstl ! j -es-Cmd cmd&#9839;k&#8594; ?elstl ! Suc j&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a4</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d14</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (?elstl ! j), gets_es (?elstl ! Suc j)) &#8712; ?Guar ei&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d10</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length ?elstl &#10230; 
                              (&#8707;t. &#915; &#8866;?elstl!i -es-t&#8594; ?elstl!(Suc i)) &#10230; 
                                  (gets_es (?elstl!i), gets_es (?elstl!Suc i)) &#8712; ?Guar ei&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>commit_es_def</span><span class="delimiter">)</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d0</span><span> </span><span>d13</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d11</span><span> </span><span>d12</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d15</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; ?Guar ei&quot;</span></span></span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d0</span><span> </span><span>no_mident</span><span class="delimiter">[</span><span>of</span><span> </span><span>kk</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#8707;m. m &gt; 0 &#8743; Suc m &lt; length ?elstl &#8743; 
                             getspc_es (?elstl!m) = EvtSys es &#8743; getspc_es (?elstl!Suc m) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d16</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;m. m &gt; 0 &#8743; Suc m &lt; length ?elstl 
                      &#10230; &#172;(getspc_es (?elstl!m) = EvtSys es &#8743; getspc_es (?elstl!Suc m) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d17</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;m. m &gt; (si + n) &#8743; m &lt; ti + n - 1 &#10230; 
                             &#172;(getspc_es (?esl!m) = EvtSys es &#8743; getspc_es (?esl!Suc m) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>                      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>m</span><span>
</span><span>                      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &gt; (si + n) &#8743; m &lt; ti + n - 1&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m - (n+si) &gt; 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc (m - (n+si)) &lt; length ?elstl&quot;</span></span></span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>e0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m - (n + si) &lt; ti - si - 1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc (m - (n + si)) &lt; ti - si&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d42</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(getspc_es (?elstl!(m-(n+si))) = EvtSys es 
                          &#8743; getspc_es (?elstl!Suc (m-(n+si))) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>d16</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m - (n+si)&quot;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>e1</span><span> </span><span>e2</span><span> </span><span>d5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl!m = ?elstl!(m - (n+si))&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>drop_take_sametrace</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?elstl</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;si+n&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ti+n&quot;</span></span></span><span> </span><span class="var">?esl</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m - (n+si)&quot;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>e1</span><span> </span><span>e2</span><span> </span><span>d5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl!Suc m = ?elstl!Suc (m - (n+si))&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>drop_take_sametrace</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?elstl</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;si+n&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ti+n&quot;</span></span></span><span> </span><span class="var">?esl</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc (m - (n+si))&quot;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(getspc_es (?esl!m) = EvtSys es &#8743; getspc_es (?esl!Suc m) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d18</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;m. m &gt; (si + n) &#8743; m &lt; ti + n - 1 &#10230; 
                             &#172;(&#8707;e. &#915; &#8866;?esl!m -es-((EvtEnt e)&#9839;k)&#8594; ?esl!Suc m)&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>                      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>m</span><span>
</span><span>                      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &gt; (si + n) &#8743; m &lt; ti + n - 1&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d17</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(getspc_es (?esl!m) = EvtSys es &#8743; getspc_es (?esl!Suc m) &#8800; EvtSys es)&quot;</span></span></span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span>a8</span><span> </span><span>a81</span><span> </span><span>d41</span><span> </span><span>e0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#8707;e. &#915; &#8866;?esl!m -es-((EvtEnt e)&#9839;k)&#8594; ?esl!Suc m)&quot;</span></span></span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>notentevt_in_conjoin_cpts</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span>  </span><span>c</span><span> </span><span>cs</span><span> </span><span>m</span><span> </span><span>k</span><span> </span><span>es</span><span class="delimiter">]</span><span> </span><span>evtsys_allevtseqorevtsys</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?esl</span><span> </span><span>es</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>esll</span><span class="delimiter">]</span><span>
</span><span>                          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                  
</span><span>                   </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d71</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc (si + n) &lt; ti + n - 1&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_eq_plus1</span><span> </span><span>add.assoc</span><span> </span><span>add_2_eq_Suc</span><span> </span><span>add_diff_cancel_right&#39;</span><span> </span><span>less_diff_conv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>linarith</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d41</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc (ti + n - 1) = length (cs k)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>calculation</span><span> </span><span>d41</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>linarith</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">ultimately</span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d19</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;m. m &gt; (si + n) &#8743; m &#8804; (ti + n - 1) &#10230; getx_es ((cs k)!m) k = ente&quot;</span></span></span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtent_impl_curevt_in_cpts_es1</span><span class="delimiter">[</span><span>of</span><span> </span><span>c</span><span> </span><span>cs</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;si + n&quot;</span></span></span><span> </span><span>k</span><span> </span><span>ente</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ti + n - 1&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>                       </span><span>d18</span><span> </span><span>p1</span><span> </span><span>p6</span><span> </span><span>d8</span><span> </span><span>d41</span><span> </span><span>d71</span><span> </span><span>d72</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d0</span><span> </span><span>d42</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;si + n + j &#8804; ti + n - 1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d19</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;si + n + j&quot;</span></span></span><span class="delimiter">]</span><span> </span><span>d01</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getx_es ((cs k)!(si + n + j)) k = ente&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d11</span><span> </span><span>d5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getx_es ((cs k)!i) k = ente&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_lessD</span><span> </span><span>d0</span><span> </span><span>drop_take_sametrace</span><span class="delimiter">)</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;esf .the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> (ef))) = snd (ef)&quot;</span></span></span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>all_evts_es_esys</span><span>  </span><span>d9</span><span> </span><span>nth_mem</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c13</span><span> </span><span>d9</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;ef&#8712;esf .E<span class="hidden">&#8681;</span><sub>e</sub> (ef) = ei&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>E<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d9</span><span> </span><span>c13</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;ef . ?Guar ei = Guar<span class="hidden">&#8681;</span><sub>f</sub> (snd (ef))&quot;</span></span></span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Guar<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Guar<span class="hidden">&#8681;</span><sub>f</sub>_def</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>d15</span><span> </span><span>d9</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Guar<span class="hidden">&#8681;</span><sub>f</sub>_def</span><span> </span><span>a21</span><span> </span><span>comp_apply</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>     
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length (cs k) &#8743; &#915; &#8866; cs k ! i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc i &#10230;
               (gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k)))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>       
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; &#8704;c pes s x cs pre1 rely1 Pre Rely Guar Post k cmd.
          Pre k &#8838; prea &#8743; Rely k &#8838; relya &#8743; guara &#8838; Guar k &#8743; posta &#8838; Post k &#10230;
          c &#8712; cpts_of_pes &#915; pes s x &#8743; &#915; c &#8733; cs &#8743; c &#8712; assume_pes &#915; (pre1, rely1) &#10230;
          (&#8704;k. cs k &#8712; cpts_of_es &#915; (pes k) s x) &#10230;
          (&#8704;k. cs k &#8712; commit_es &#915; (Guar k, Post k)) &#10230;
          (&#8704;k. pre1 &#8838; Pre k) &#10230;
          (&#8704;k. rely1 &#8838; Rely k) &#10230;
          (&#8704;k j. j &#8800; k &#10230; Guar j &#8838; Rely k) &#10230;
          evtsys_spec (rgf_EvtSys esf) = EvtSys es &#8743; EvtSys es = getspc_es (cs k ! 0) &#10230;
          (&#8704;e&#8712;all_evts_es (rgf_EvtSys esf). is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> e)) &#10230;
          (&#8704;e&#8712;all_evts_es (rgf_EvtSys esf). the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> e)) = snd e) &#10230;
          (&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. &#915; &#8866; c ! j -pes-actk&#8594; c ! Suc j)) &#10230;
          (&#8704;i. Suc i &lt; length (cs k) &#8743; &#915; &#8866; cs k ! i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc i &#10230;
               (gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k))))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>       
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>act_cpts_evtseq_sat_guar_curevt_fstseg_new2</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>   </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>b51</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (E<span class="hidden">&#8681;</span><sub>e</sub> ef) sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre<span class="hidden">&#8681;</span><sub>e</sub> ef, Rely<span class="hidden">&#8681;</span><sub>e</sub> ef, Guar<span class="hidden">&#8681;</span><sub>e</sub> ef, Post<span class="hidden">&#8681;</span><sub>e</sub> ef]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b52</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (fst esf) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre<span class="hidden">&#8681;</span><sub>f</sub> (snd esf), Rely<span class="hidden">&#8681;</span><sub>f</sub> (snd esf), Guar<span class="hidden">&#8681;</span><sub>f</sub> (snd esf), Post<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;pre = Pre<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;post = Post<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rely &#8838; Rely<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rely &#8838; Rely<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Guar<span class="hidden">&#8681;</span><sub>e</sub> ef &#8838; guar&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b11</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Guar<span class="hidden">&#8681;</span><sub>f</sub> (snd esf) &#8838; guar&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b12</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Post<span class="hidden">&#8681;</span><sub>e</sub> ef &#8838; Pre<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Pre k &#8838; pre&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Rely k &#8838; rely&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;guar &#8838; Guar k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;post &#8838; Post k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;cpts_of_pes &#915; pes s x&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; c &#8733; cs&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;assume_pes &#915; (pre1, rely1)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. (cs k) &#8712; cpts_of_es &#915; (pes k) s x&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p16</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. (cs k)&#8712;commit_es &#915; (Guar k, Post k)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. pre1 &#8838; Pre k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. rely1 &#8838; Rely k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k j. j &#8800; k &#10230; Guar j &#8838; Rely k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;evtsys_spec (rgf_EvtSeq ef esf) = getspc_es (cs k ! 0) &#8743; 
                (&#8704;i. Suc i &#8804; length (cs k) &#10230; getspc_es ((cs k) ! i) &#8800; evtsys_spec (fst esf))&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;e&#8712;all_evts_es (rgf_EvtSeq ef esf). is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> e)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a01</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;e&#8712;all_evts_es (rgf_EvtSeq ef esf). the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> e)) = snd e&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. (&#915; &#8866; (c ! j) -pes-actk&#8594; (c ! Suc j)))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length (cs k) &#8743; (&#915; &#8866; (cs k ! i) -es-(Cmd cmd)&#9839;k&#8594; (cs k ! Suc i)) &#10230;
               (gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k)))&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p11</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. length (cs k) = length c&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>conjoin_def</span><span> </span><span>same_length_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p12</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. cs k &#8712; cpts_es &#915; &quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_of_es_def</span><span> </span><span>mem_Collect_eq</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p11</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c &#8800; Nil&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_es_not_empty</span><span> </span><span>length_0_conv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p13</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length c &gt; 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>    
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p16</span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>p4</span><span> </span><span>p8</span><span> </span><span>p9</span><span> </span><span>p10</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p14</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. (cs k) &#8712; assume_es &#915; (Pre k, Rely k)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>conjoin_comm_imp_rely</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>mono_tags</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span class="delimiter">)</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>      </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?esys</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;evtsys_spec (rgf_EvtSeq ef esf)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?esl</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k&quot;</span></span></span><span>
</span><span>      
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length ?esl&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915; &#8866; ?esl!i -es-((Cmd cmd)&#9839;k)&#8594; ?esl!(Suc i))&quot;</span></span></span><span> 
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e es ess. ?esys = EvtSeq e es &#8743; getspc_es (cs k ! 0) = EvtSeq e es&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtsys_spec_evtseq</span><span class="delimiter">[</span><span>of</span><span> </span><span>ef</span><span> </span><span>esf</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>e</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>es</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esys = EvtSeq e es &#8743; getspc_es (cs k ! 0) = EvtSeq e es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p2</span><span> </span><span>a6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl &#8712; cpts_es &#915; &#8743; ?esl!0 = (EvtSeq e es,s,x)&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_of_es_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;pes k&quot;</span></span></span><span> </span><span>s</span><span> </span><span>x</span><span class="delimiter">]</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>mono_tags</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>fst_conv</span><span> </span><span>getspc_es_def</span><span> </span><span>mem_Collect_eq</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>esl1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl = (EvtSeq e es,s,x)#esl1&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_pred</span><span> </span><span>length_Suc_conv</span><span> </span><span>nth_Cons_0</span><span> </span><span>p11</span><span> </span><span>p13</span><span class="delimiter">)</span><span> 
</span><span>  
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b17</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;E<span class="hidden">&#8681;</span><sub>e</sub> ef = e&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtsys_spec_evtseq</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b18</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;evtsys_spec (fst esf) = es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtsys_spec_evtsys</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b19</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ef&#8712;all_evts_es (rgf_EvtSeq ef esf)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>all_evts_es_seq</span><span class="delimiter">[</span><span>of</span><span> </span><span>ef</span><span> </span><span>esf</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a5</span><span> </span><span>b18</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &#8804; length ?esl &#10230; getspc_es (?esl ! i) &#8800; es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a8</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;el. (el &#8712; cpts_of_ev &#915; e s x &#8743; length ?esl = length el &#8743; e_eqv_einevtseq ?esl el es)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>evtseq_nfin_samelower</span><span> </span><span>cpts_of_es_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>el</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el &#8712; cpts_of_ev &#915; e s x &#8743; length ?esl = length el &#8743; e_eqv_einevtseq ?esl el es&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p14</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl &#8712; assume_es &#915; (Pre k, Rely k)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b1</span><span> </span><span>b2</span><span> </span><span>b6</span><span> </span><span>b8</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl &#8712; assume_es &#915; (Pre<span class="hidden">&#8681;</span><sub>e</sub> ef, Rely<span class="hidden">&#8681;</span><sub>e</sub> ef)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>assume_es_imp</span><span> </span><span>equalityE</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el &#8712; assume_e &#915; (Pre<span class="hidden">&#8681;</span><sub>e</sub> ef, Rely<span class="hidden">&#8681;</span><sub>e</sub> ef)&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>e_eqv_einevtseq_def</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?esl</span><span> </span><span>el</span><span> </span><span>es</span><span class="delimiter">]</span><span> </span><span>assume_es_def</span><span> </span><span>assume_e_def</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>Suc_leI</span><span> </span><span>a3</span><span> </span><span>eetran_eqconf1</span><span> </span><span>eqconf_esetran</span><span> </span><span>less_or_eq_imp_le</span><span> 
</span><span>          </span><span>less_trans_Suc</span><span> </span><span>mem_Collect_eq</span><span> </span><span>old.prod.case</span><span> </span><span>zero_less_Suc</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b51</span><span> </span><span>b17</span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el &#8712; commit_e &#915; (Guar<span class="hidden">&#8681;</span><sub>e</sub> ef, Post<span class="hidden">&#8681;</span><sub>e</sub> ef)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>Int_iff</span><span> </span><span>contra_subsetD</span><span> </span><span>evt_validity_def</span><span> </span><span>rgsound_e</span><span class="delimiter">)</span><span> 
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a3</span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (?esl ! i) = EvtSeq (getspc_e (el ! i)) es&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>e_eqv_einevtseq_def</span><span class="delimiter">)</span><span> 
</span><span>      
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a3</span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (?esl ! Suc i) = EvtSeq (getspc_e (el ! Suc i)) es&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>e_eqv_einevtseq_def</span><span class="delimiter">)</span><span> 
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (?esl ! i) &#8800; getspc_es (?esl ! Suc i)&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtsys_not_eq_in_tran_aux</span><span> </span><span>getspc_es_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>surjective_pairing</span><span class="delimiter">)</span><span> 
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c4</span><span> </span><span>c5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (el ! i) &#8800; getspc_e (el ! Suc i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a3</span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;t. &#915; &#8866; (el ! i) -et-t&#8594; (el ! Suc i)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_of_ev_def</span><span> </span><span>notran_confeqi</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a3</span><span> </span><span>c1</span><span> </span><span>c3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_e (el!i), gets_e (el!Suc i))&#8712;Guar<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>commit_e_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p2</span><span> </span><span>a5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;evtsys_spec (rgf_EvtSeq ef esf) = pes k&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_of_es_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;pes k&quot;</span></span></span><span> </span><span>s</span><span> </span><span>x</span><span class="delimiter">]</span><span> </span><span>getspc_es_def</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k ! 0&quot;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;all_evts_esspec (evtsys_spec (rgf_EvtSeq ef esf)). is_basicevt ef&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtsys_spec_evtseq</span><span class="delimiter">[</span><span>of</span><span> </span><span>ef</span><span> </span><span>esf</span><span class="delimiter">]</span><span> </span><span>all_evts_same</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rgf_EvtSeq ef esf&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>DomainE</span><span> </span><span>E<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>prod.sel</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>a6</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;ie. ie &lt; i &#8743; (&#8707;e. &#915; &#8866; (cs k)!ie -es-(EvtEnt e&#9839;k)&#8594; (cs k)!(Suc ie))
              &#8743; (&#8704;j. j &gt; ie &#8743; j &lt; i &#10230; &#172;(&#8707;e. &#915; &#8866; (cs k)!j -es-(EvtEnt e&#9839;k)&#8594; (cs k)!(Suc j)))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cmd_impl_evtent_before_and_cmds</span><span class="delimiter">[</span><span>of</span><span> </span><span>c</span><span> </span><span>cs</span><span> </span><span>k</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;evtsys_spec (rgf_EvtSeq ef esf)&quot;</span></span></span><span> </span><span>s</span><span> </span><span>x</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>ie</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>ev</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ie &lt; i &#8743; (&#915; &#8866; (cs k)!ie -es-(EvtEnt ev&#9839;k)&#8594; (cs k)!(Suc ie))
              &#8743; (&#8704;j. j &gt; ie &#8743; j &lt; i &#10230; &#172;(&#8707;e. &#915; &#8866; (cs k)!j -es-(EvtEnt e&#9839;k)&#8594; (cs k)!(Suc j)))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span>p6</span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;m. m &gt; ie &#8743; m &#8804; i &#10230; getx_es ((cs k)!m) k = ev&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtent_impl_curevt_in_cpts_es2</span><span class="delimiter">[</span><span>of</span><span> </span><span>c</span><span> </span><span>cs</span><span> </span><span>ie</span><span> </span><span>k</span><span> </span><span>ev</span><span> </span><span>i</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getx_es ((cs k)!i) k = ev&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;is_basicevt e&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span>b0</span><span> </span><span>b17</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a3</span><span> </span><span>a8</span><span> </span><span>a9</span><span> </span><span>c0</span><span> </span><span>c4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. i &#8804; ie &#10230; getspc_es (?esl ! i) = EvtSeq e es&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtseq_evtent_befaft</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?esl</span><span> </span><span>e</span><span> </span><span>es</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>esl1</span><span> </span><span>ie</span><span class="delimiter">]</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>Suc_diff_1</span><span> </span><span>Suc_lessD</span><span> </span><span>Suc_less_eq</span><span> </span><span>less_trans_Suc</span><span> </span><span>p11</span><span> </span><span>p13</span><span class="delimiter">)</span><span> 
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ev = e&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>evtent_is_basicevt_inevtseq2</span><span> </span><span>leI</span><span class="delimiter">)</span><span> 
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a3</span><span> </span><span>c1</span><span> </span><span>c6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>e_eqv_einevtseq_def</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?esl</span><span> </span><span>el</span><span> </span><span>es</span><span class="delimiter">]</span><span> </span><span>Suc_leI</span><span> </span><span>less_imp_le_nat</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a01</span><span> </span><span>b17</span><span> </span><span>b19</span><span> </span><span>c7</span><span> </span><span>c8</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k))) = Guar<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Guar<span class="hidden">&#8681;</span><sub>f</sub>_def</span><span> </span><span>Guar<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k)))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>act_cpts_evtseq_sat_guar_curevt_fstseg_new2_withlst</span><span> </span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>   </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>b51</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (E<span class="hidden">&#8681;</span><sub>e</sub> ef) sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre<span class="hidden">&#8681;</span><sub>e</sub> ef, Rely<span class="hidden">&#8681;</span><sub>e</sub> ef, Guar<span class="hidden">&#8681;</span><sub>e</sub> ef, Post<span class="hidden">&#8681;</span><sub>e</sub> ef]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b52</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (fst esf) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre<span class="hidden">&#8681;</span><sub>f</sub> (snd esf), Rely<span class="hidden">&#8681;</span><sub>f</sub> (snd esf), Guar<span class="hidden">&#8681;</span><sub>f</sub> (snd esf), Post<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;pre = Pre<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;post = Post<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rely &#8838; Rely<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rely &#8838; Rely<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Guar<span class="hidden">&#8681;</span><sub>e</sub> ef &#8838; guar&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b11</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Guar<span class="hidden">&#8681;</span><sub>f</sub> (snd esf) &#8838; guar&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b12</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Post<span class="hidden">&#8681;</span><sub>e</sub> ef &#8838; Pre<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Pre k &#8838; pre&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Rely k &#8838; rely&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;guar &#8838; Guar k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;post &#8838; Post k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;cpts_of_pes &#915; pes s x&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; c &#8733; cs&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;assume_pes &#915; (pre1, rely1)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. (cs k) &#8712; cpts_of_es &#915; (pes k) s x&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p16</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. (cs k)&#8712;commit_es &#915; (Guar k, Post k)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. pre1 &#8838; Pre k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. rely1 &#8838; Rely k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k j. j &#8800; k &#10230; Guar j &#8838; Rely k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;evtsys_spec (rgf_EvtSeq ef esf) = getspc_es (cs k ! 0) &#8743; 
                (&#8704;i. Suc i &lt; length (cs k) &#10230; getspc_es ((cs k) ! i) &#8800; evtsys_spec (fst esf)) &#8743;
                getspc_es(last (cs k)) = evtsys_spec (fst esf)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;e&#8712;all_evts_es (rgf_EvtSeq ef esf). is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> e)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a01</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;e&#8712;all_evts_es (rgf_EvtSeq ef esf). the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> e)) = snd e&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. (&#915; &#8866; (c ! j) -pes-actk&#8594; (c ! Suc j)))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;i. Suc i &lt; length (cs k) &#8743; (&#915; &#8866; (cs k ! i) -es-(Cmd cmd)&#9839;k&#8594; (cs k ! Suc i)) &#10230;
               (gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k))))&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p11</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. length (cs k) = length c&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>conjoin_def</span><span> </span><span>same_length_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p12</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. cs k &#8712; cpts_es &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_of_es_def</span><span> </span><span>mem_Collect_eq</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p11</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c &#8800; Nil&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_es_not_empty</span><span> </span><span>length_0_conv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p13</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length c &gt; 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>    
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p16</span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>p4</span><span> </span><span>p8</span><span> </span><span>p9</span><span> </span><span>p10</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p14</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. (cs k) &#8712; assume_es &#915; (Pre k, Rely k)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>conjoin_comm_imp_rely</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>mono_tags</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span class="delimiter">)</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>      </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?esys</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;evtsys_spec (rgf_EvtSeq ef esf)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?esl</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?n</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length ?esl&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?eslh</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;take (?n - 1) ?esl&quot;</span></span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length ?esl&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915; &#8866; ?esl!i -es-((Cmd cmd)&#9839;k)&#8594; ?esl!(Suc i))&quot;</span></span></span><span> 
</span><span>
</span><span>      
</span><span>      
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e es ess. ?esys = EvtSeq e es &#8743; getspc_es (cs k ! 0) = EvtSeq e es&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtsys_spec_evtseq</span><span class="delimiter">[</span><span>of</span><span> </span><span>ef</span><span> </span><span>esf</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>e</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>es</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esys = EvtSeq e es &#8743; getspc_es (cs k ! 0) = EvtSeq e es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p2</span><span> </span><span>a6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl &#8712; cpts_es &#915; &#8743; ?esl!0 = (EvtSeq e es,s,x)&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_of_es_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;pes k&quot;</span></span></span><span> </span><span>s</span><span> </span><span>x</span><span class="delimiter">]</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>mono_tags</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>fst_conv</span><span> </span><span>getspc_es_def</span><span> </span><span>mem_Collect_eq</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>esl1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl = (EvtSeq e es,s,x)#esl1&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_pred</span><span> </span><span>length_Suc_conv</span><span> </span><span>nth_Cons_0</span><span> </span><span>p11</span><span> </span><span>p13</span><span class="delimiter">)</span><span> 
</span><span>  
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?n &gt; 1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>linarith</span><span> 
</span><span>        
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a8</span><span> </span><span>a10</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a81</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?eslh &#8712; cpts_es &#915; &quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Suc_diff_Suc</span><span> </span><span>butlast_conv_take</span><span> </span><span>cpts_es_take</span><span> </span><span>diff_less</span><span> </span><span>p11</span><span> </span><span>p13</span><span> </span><span>zero_less_Suc</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a10</span><span> </span><span>a8</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a82</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?eslh!0 = (EvtSeq e es,s,x)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>nth_butlast</span><span> </span><span>p11</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>esl2</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a83</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?eslh = (EvtSeq e es,s,x)#esl2&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_diff_Suc</span><span> </span><span>a10</span><span> </span><span>a9</span><span> </span><span>take_Suc_Cons</span><span class="delimiter">)</span><span> 
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b17</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;E<span class="hidden">&#8681;</span><sub>e</sub> ef = e&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtsys_spec_evtseq</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b18</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;evtsys_spec (fst esf) = es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtsys_spec_evtsys</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b19</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ef&#8712;all_evts_es (rgf_EvtSeq ef esf)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>all_evts_es_seq</span><span class="delimiter">[</span><span>of</span><span> </span><span>ef</span><span> </span><span>esf</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a5</span><span> </span><span>b18</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &#8804; length ?eslh &#10230; getspc_es (?eslh ! i) &#8800; es&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_diff_1</span><span> </span><span>Suc_le_lessD</span><span> </span><span>Suc_less_eq</span><span> </span><span>length_take</span><span> </span><span>min.bounded_iff</span><span> 
</span><span>          </span><span>nth_take</span><span> </span><span>p11</span><span> </span><span>p13</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a81</span><span> </span><span>a82</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;el. (el &#8712; cpts_of_ev &#915; e s x &#8743; length ?eslh = length el &#8743; e_eqv_einevtseq ?eslh el es)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtseq_nfin_samelower</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?eslh</span><span> </span><span>&#915;</span><span> </span><span>e</span><span> </span><span>es</span><span> </span><span>s</span><span> </span><span>x</span><span class="delimiter">]</span><span> </span><span>cpts_of_es_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;EvtSeq e es&quot;</span></span></span><span> </span><span>s</span><span> </span><span>x</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>el</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el &#8712; cpts_of_ev &#915; e s x &#8743; length ?eslh = length el &#8743; e_eqv_einevtseq ?eslh el es&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el &#8712; cpts_ev &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>cpts_of_ev_def</span><span class="delimiter">)</span><span>
</span><span>      
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a5</span><span> </span><span>b18</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;sn xn. last (cs k) = (es, sn, xn)&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>getspc_es_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fst_conv</span><span> </span><span>surj_pair</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>sn</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>xn</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>d2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;last (cs k) = (es, sn, xn)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?el1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el @ [(AnonyEvent fin_com,sn, xn)]&quot;</span></span></span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c23</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length ?el1 = ?n&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a9</span><span> </span><span>butlast_conv_take</span><span> </span><span>diff_Suc_1</span><span> </span><span>length_Cons</span><span> </span><span>length_append_singleton</span><span> </span><span>length_butlast</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (last ?eslh) = EvtSeq (getspc_e (last el)) es&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>e_eqv_einevtseq_def</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span class="var">?eslh</span><span> </span><span>el</span><span> </span><span>es</span><span class="delimiter">]</span><span> </span><span>a10</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Suc_diff_Suc</span><span> </span><span>butlast_conv_take</span><span> </span><span>diff_Suc_1</span><span> </span><span>diff_is_0_eq</span><span> 
</span><span>            </span><span>last_conv_nth</span><span> </span><span>length_butlast</span><span> </span><span>length_greater_0_conv</span><span> </span><span>not_le</span><span> </span><span>order_refl</span><span> </span><span>p11</span><span> </span><span>p13</span><span> </span><span>take_eq_Nil</span><span class="delimiter">)</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;sn1 xn1. last ?eslh = (EvtSeq (getspc_e (last el)) es, sn1, xn1)&quot;</span></span></span><span> 
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>getspc_es_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fst_conv</span><span> </span><span>surj_pair</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>sn1</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>xn1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>d4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;last ?eslh = (EvtSeq (getspc_e (last el)) es, sn1, xn1)&quot;</span></span></span><span>
</span><span>         </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d41</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_e (last el) = sn1 &#8743; getx_e (last el) = xn1&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>e_eqv_einevtseq_def</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?eslh</span><span> </span><span>el</span><span> </span><span>es</span><span class="delimiter">]</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>Suc_diff_Suc</span><span> </span><span>a10</span><span> </span><span>a9</span><span> </span><span>diff_Suc_1</span><span> </span><span>diff_is_0_eq</span><span> </span><span>fst_conv</span><span> </span><span>gets_es_def</span><span> 
</span><span>            </span><span>getx_es_def</span><span> </span><span>last_conv_nth</span><span> </span><span>le_refl</span><span> </span><span>length_0_conv</span><span> </span><span>list.distinct</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>not_le</span><span> </span><span>snd_conv</span><span> </span><span>take_eq_Nil</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d42</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;last el = (getspc_e (last el), sn1, xn1)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>gets_e_def</span><span> </span><span>getspc_e_def</span><span> </span><span>getx_e_def</span><span> </span><span>prod.collapse</span><span class="delimiter">)</span><span> 
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d51</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;last ?eslh = ?esl ! (?n - 2)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Suc_1</span><span> </span><span>Suc_diff_Suc</span><span> </span><span>a10</span><span> </span><span>butlast_conv_take</span><span> 
</span><span>          </span><span>diff_Suc_eq_diff_pred</span><span> </span><span>last_conv_nth</span><span> </span><span>length_butlast</span><span> </span><span>length_greater_0_conv</span><span> 
</span><span>          </span><span>lessI</span><span> </span><span>nth_butlast</span><span> </span><span>p11</span><span> </span><span>p13</span><span> </span><span>take_eq_Nil</span><span class="delimiter">)</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d52</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;last ?esl = ?esl ! (?n - 1)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>a9</span><span> </span><span>last_conv_nth</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a8</span><span> </span><span>a10</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop (?n-2) ?esl &#8712; cpts_es &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_es_dropi2</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?esl</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?n - 2&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_1</span><span> </span><span>diff_Suc_less</span><span> </span><span>p11</span><span> </span><span>p13</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>linarith</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d2</span><span> </span><span>d4</span><span> </span><span>b18</span><span> </span><span>d51</span><span> </span><span>d52</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;est. &#915; &#8866; ?esl ! (?n-2) -es-est&#8594; ?esl ! (?n-1)&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>exist_estran</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;EvtSeq (getspc_e (last el)) es&quot;</span></span></span><span> </span><span>sn1</span><span> </span><span>xn1</span><span> </span><span>es</span><span> </span><span>sn</span><span> </span><span>xn</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;[]&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Cons_nth_drop_Suc</span><span> </span><span>One_nat_def</span><span> </span><span>Suc_1</span><span> </span><span>Suc_diff_Suc</span><span> 
</span><span>            </span><span>a10</span><span> </span><span>a5</span><span> </span><span>d3</span><span> </span><span>diff_Suc_less</span><span> </span><span>exist_estran</span><span> </span><span>p11</span><span> </span><span>p13</span><span class="delimiter">)</span><span> 
</span><span>          
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>est</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; ?esl ! (?n-2) -es-est&#8594; ?esl ! (?n-1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d2</span><span> </span><span>d4</span><span> </span><span>d51</span><span> </span><span>d52</span><span> </span><span>b18</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;t. &#915; &#8866; (getspc_e (last el), sn1, xn1) -et-t&#8594;(AnonyEvent fin_com,sn, xn)&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtseq_tran_0_exist_etran</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (last el)&quot;</span></span></span><span> </span><span>es</span><span> </span><span>sn1</span><span> </span><span>xn1</span><span> </span><span>est</span><span> </span><span>sn</span><span> </span><span>xn</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a10</span><span> </span><span>c1</span><span> </span><span>c2</span><span> </span><span>d41</span><span> </span><span>d42</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d8</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;?el1 &#8712; cpts_ev &#915;&quot;</span></span></span><span> 
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_ev_onemore</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>diff_is_0_eq</span><span> </span><span>last_conv_nth</span><span> </span><span>length_greater_0_conv</span><span> </span><span>not_le</span><span> </span><span>p11</span><span> </span><span>p13</span><span> </span><span>take_eq_Nil</span><span class="delimiter">)</span><span> 
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d8</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el1 &#8712; cpts_of_ev &#915; e s x&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>a10</span><span> </span><span>butlast_conv_take</span><span> </span><span>c1</span><span> </span><span>cpts_of_ev_def</span><span> 
</span><span>          </span><span>length_butlast</span><span> </span><span>mem_Collect_eq</span><span> </span><span>nth_append</span><span> </span><span>zero_less_diff</span><span class="delimiter">)</span><span> 
</span><span>                         
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p14</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl &#8712; assume_es &#915; (Pre k, Rely k)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b1</span><span> </span><span>b2</span><span> </span><span>b6</span><span> </span><span>b8</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl &#8712; assume_es &#915; (Pre<span class="hidden">&#8681;</span><sub>e</sub> ef, Rely<span class="hidden">&#8681;</span><sub>e</sub> ef)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>assume_es_imp</span><span> </span><span>equalityE</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?eslh &#8712; assume_es &#915; (Pre<span class="hidden">&#8681;</span><sub>e</sub> ef, Rely<span class="hidden">&#8681;</span><sub>e</sub> ef)&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assume_es_take_n</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?n-1&quot;</span></span></span><span> </span><span class="var">?esl</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Pre<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Rely<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>a10</span><span> </span><span>butlast_conv_take</span><span> </span><span>diff_le_self</span><span> </span><span>zero_less_diff</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c21</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el &#8712; assume_e &#915; (Pre<span class="hidden">&#8681;</span><sub>e</sub> ef, Rely<span class="hidden">&#8681;</span><sub>e</sub> ef)&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>e_eqv_einevtseq_def</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?eslh</span><span> </span><span>el</span><span> </span><span>es</span><span class="delimiter">]</span><span> </span><span>assume_es_def</span><span> </span><span>assume_e_def</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>Suc_leI</span><span> </span><span>a10</span><span> </span><span>diff_is_0_eq</span><span> </span><span>eetran_eqconf1</span><span> </span><span>eqconf_esetran</span><span> </span><span>length_greater_0_conv</span><span> 
</span><span>            </span><span>less_imp_le_nat</span><span> </span><span>mem_Collect_eq</span><span> </span><span>not_le</span><span> </span><span>p11</span><span> </span><span>p13</span><span> </span><span>prod.simps</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>take_eq_Nil</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el1 &#8712; assume_e &#915; (Pre<span class="hidden">&#8681;</span><sub>e</sub> ef, Rely<span class="hidden">&#8681;</span><sub>e</sub> ef)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_e (?el1!0) &#8712; Pre<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c21</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_e (el!0) &#8712; Pre<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_e_def</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>a10</span><span> </span><span>butlast_conv_take</span><span> </span><span>c1</span><span> </span><span>length_butlast</span><span> </span><span>nth_append</span><span> </span><span>zero_less_diff</span><span class="delimiter">)</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length ?el1 &#10230;  &#915; &#8866; ?el1!i -ee&#8594; ?el1!(Suc i) &#10230; 
                (gets_e (?el1!i), gets_e (?el1!Suc i)) &#8712; Rely<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>            </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>              </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>              </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length ?el1&quot;</span></span></span><span>
</span><span>                </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>e1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; ?el1!i -ee&#8594; ?el1!(Suc i)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c21</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length el &#10230; &#915; &#8866; el!i -ee&#8594; el!(Suc i) &#10230; 
                (gets_e (el!i), gets_e (el!Suc i)) &#8712; Rely<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_e_def</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_e (?el1!i), gets_e (?el1!Suc i)) &#8712; Rely<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length ?el1 - 1&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>f0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length ?el1 - 1&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>e0</span><span> </span><span>e2</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Suc_diff_1</span><span> 
</span><span>                      </span><span>Suc_less_eq</span><span> </span><span>Suc_mono</span><span> </span><span>e1</span><span> </span><span>length_append_singleton</span><span> </span><span>nth_append</span><span> </span><span>zero_less_Suc</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (Suc i &lt; length ?el1 - 1)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &#8805; length ?el1 - 1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>e0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i = length ?el1 - 1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el1!(Suc i) = (AnonyEvent fin_com, sn, xn)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>f1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el1!i = (getspc_e (last el), sn1, xn1)&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>a10</span><span> </span><span>c1</span><span> </span><span>d42</span><span> </span><span>diff_Suc_1</span><span> </span><span>diff_is_0_eq</span><span> 
</span><span>                      </span><span>last_conv_nth</span><span> </span><span>length_append_singleton</span><span> </span><span>length_greater_0_conv</span><span> 
</span><span>                      </span><span>lessI</span><span> </span><span>not_le</span><span> </span><span>nth_append</span><span> </span><span>p11</span><span> </span><span>p13</span><span> </span><span>take_eq_Nil</span><span class="delimiter">)</span><span>
</span><span>                  
</span><span>                  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d7</span><span> </span><span>f2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (?el1!i) &#8800; getspc_e (?el1!(Suc i))&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evt_not_eq_in_tran_aux</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>e1</span><span> </span><span>eetran.cases</span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>e1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (?el1!i) = getspc_e (?el1!(Suc i))&quot;</span></span></span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>eetran_eqconf1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>            
</span><span>          </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_e_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>     
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d9</span><span> </span><span>b51</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el1 &#8712; commit_e &#915; (Guar<span class="hidden">&#8681;</span><sub>e</sub> ef, Post<span class="hidden">&#8681;</span><sub>e</sub> ef)&quot;</span></span></span><span> 
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evt_validity_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;E<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Pre<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Rely<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Guar<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Post<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>          </span><span>Int_iff</span><span> </span><span>b17</span><span> </span><span>contra_subsetD</span><span> </span><span>rgsound_e</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (last ?el1) = AnonyEvent fin_com&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>getspc_e_def</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;last ?el1&quot;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_e (last ?el1) = sn&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>gets_e_def</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;last ?el1&quot;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;sn&#8712;Post<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>d10</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>commit_e_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d101</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (last (cs k)) &#8712; Post<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>gets_es_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;all_evts_esspec (evtsys_spec (rgf_EvtSeq ef esf)). is_basicevt ef&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtsys_spec_evtseq</span><span class="delimiter">[</span><span>of</span><span> </span><span>ef</span><span> </span><span>esf</span><span class="delimiter">]</span><span> </span><span>all_evts_same</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rgf_EvtSeq ef esf&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>DomainE</span><span> </span><span>E<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>prod.sel</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>a6</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span>a8</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;ie. ie &lt; i &#8743; (&#8707;e. &#915; &#8866; (cs k)!ie -es-(EvtEnt e&#9839;k)&#8594; (cs k)!(Suc ie))
              &#8743; (&#8704;j. j &gt; ie &#8743; j &lt; i &#10230; &#172;(&#8707;e. &#915; &#8866; (cs k)!j -es-(EvtEnt e&#9839;k)&#8594; (cs k)!(Suc j)))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cmd_impl_evtent_before_and_cmds</span><span class="delimiter">[</span><span>of</span><span> </span><span>c</span><span> </span><span>cs</span><span> </span><span>k</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;evtsys_spec (rgf_EvtSeq ef esf)&quot;</span></span></span><span> </span><span>s</span><span> </span><span>x</span><span class="delimiter">]</span><span> 
</span><span>          </span><span>cpts_of_es_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;EvtSeq e es&quot;</span></span></span><span> </span><span>s</span><span> </span><span>x</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>ie</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>ev</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ie &lt; i &#8743; (&#915; &#8866; (cs k)!ie -es-(EvtEnt ev&#9839;k)&#8594; (cs k)!(Suc ie))
              &#8743; (&#8704;j. j &gt; ie &#8743; j &lt; i &#10230; &#172;(&#8707;e. &#915; &#8866; (cs k)!j -es-(EvtEnt e&#9839;k)&#8594; (cs k)!(Suc j)))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span>p6</span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;m. m &gt; ie &#8743; m &#8804; i &#10230; getx_es ((cs k)!m) k = ev&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtent_impl_curevt_in_cpts_es2</span><span class="delimiter">[</span><span>of</span><span> </span><span>c</span><span> </span><span>cs</span><span> </span><span>ie</span><span> </span><span>k</span><span> </span><span>ev</span><span> </span><span>i</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getx_es ((cs k)!i) k = ev&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a3</span><span> </span><span>c4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ie &lt; i &#8743; (&#915; &#8866; ?eslh!ie -es-(EvtEnt ev&#9839;k)&#8594; ?eslh!(Suc ie))
              &#8743; (&#8704;j. j &gt; ie &#8743; j &lt; i &#10230; &#172;(&#8707;e. &#915; &#8866; ?eslh!j -es-(EvtEnt e&#9839;k)&#8594; ?eslh!(Suc j)))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a3</span><span> </span><span>a81</span><span> </span><span>a82</span><span> </span><span>a83</span><span> </span><span>c8</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. i &#8804; ie &#10230; getspc_es (?eslh ! i) = EvtSeq e es&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtseq_evtent_befaft</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?eslh</span><span> </span><span>e</span><span> </span><span>es</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>esl2</span><span> </span><span>ie</span><span class="delimiter">]</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>Suc_diff_1</span><span> </span><span>Suc_diff_Suc</span><span> </span><span>Suc_less_eq</span><span> </span><span>a10</span><span> </span><span>butlast_conv_take</span><span> 
</span><span>            </span><span>diff_Suc_eq_diff_pred</span><span> </span><span>length_butlast</span><span> </span><span>less_trans_Suc</span><span> </span><span>p11</span><span> </span><span>p13</span><span class="delimiter">)</span><span> 
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c8</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ev = e&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>evtent_is_basicevt_inevtseq2</span><span> </span><span>order_refl</span><span class="delimiter">)</span><span> 
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c11</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k))) = Guar<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Guar<span class="hidden">&#8681;</span><sub>f</sub>_def</span><span> </span><span>Guar<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>a01</span><span> </span><span>b17</span><span> </span><span>b19</span><span> </span><span>c10</span><span> </span><span>c7</span><span class="delimiter">)</span><span> 
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k)))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; ?n - 1&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; ?n - 1&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (?eslh ! i) = EvtSeq (getspc_e (el ! i)) es&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>a3</span><span> </span><span>c1</span><span> </span><span>e0</span><span> </span><span>e_eqv_einevtseq_def</span><span> </span><span>length_take</span><span> </span><span>less_imp_le_nat</span><span> </span><span>min.bounded_iff</span><span class="delimiter">)</span><span>  
</span><span>           
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (?eslh ! Suc i) = EvtSeq (getspc_e (el ! Suc i)) es&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_leI</span><span> </span><span>a3</span><span> </span><span>c1</span><span> </span><span>e0</span><span> </span><span>e_eqv_einevtseq_def</span><span> </span><span>length_take</span><span> </span><span>min.bounded_iff</span><span class="delimiter">)</span><span> 
</span><span>    
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (?eslh ! i) &#8800; getspc_es (?eslh ! Suc i)&quot;</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_lessD</span><span> </span><span>e0</span><span> </span><span>evtsys_not_eq_in_tran_aux1</span><span> </span><span>nth_take</span><span class="delimiter">)</span><span>  
</span><span>    
</span><span>          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>e1</span><span> </span><span>e2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (el ! i) &#8800; getspc_e (el ! Suc i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c1</span><span> </span><span>c2</span><span> </span><span>e0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;t. &#915; &#8866; (el ! i) -et-t&#8594; (el ! Suc i)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_of_ev_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>e</span><span> </span><span>s</span><span> </span><span>x</span><span class="delimiter">]</span><span> </span><span>notran_confeqi</span><span class="delimiter">[</span><span>of</span><span> </span><span>el</span><span> </span><span>&#915;</span><span> </span><span>i</span><span class="delimiter">]</span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span>length_take</span><span> </span><span>less_eq_Suc_le</span><span> </span><span>min.bounded_iff</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>    
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>e0</span><span> </span><span>a3</span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length ?el1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>e0</span><span> </span><span>a3</span><span> </span><span>c23</span><span> </span><span>e4</span><span> </span><span>e5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;t. &#915; &#8866; ?el1 ! i -et-t&#8594; ?el1 ! Suc i&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Suc_lessD</span><span> </span><span>butlast_snoc</span><span> </span><span>length_butlast</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_e (?el1!i), gets_e (?el1!Suc i))&#8712;Guar<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>d10</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>commit_e_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (?eslh ! i), gets_es (?eslh ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>e_eqv_einevtseq_def</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?eslh</span><span> </span><span>el</span><span> </span><span>es</span><span class="delimiter">]</span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Suc_leI</span><span> </span><span>Suc_lessE</span><span> </span><span>a3</span><span> </span><span>c1</span><span> </span><span>c23</span><span> </span><span>diff_Suc_1</span><span> 
</span><span>                </span><span>e0</span><span> </span><span>length_append_singleton</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span>  
</span><span>          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c11</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_lessD</span><span> </span><span>e0</span><span> </span><span>nth_take</span><span class="delimiter">)</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (Suc i &lt; ?n - 1)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i = ?n - 1&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_pred&#39;</span><span> </span><span>a3</span><span> </span><span>less_antisym</span><span> </span><span>p11</span><span> </span><span>p13</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>linarith</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length ?el1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span>c23</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>linarith</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;t. &#915; &#8866; (?el1 ! i) -et-t&#8594;(?el1 ! Suc i)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i = length (butlast (el @ [(AnonyEvent fin_com, sn, xn)]))&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>c23</span><span> </span><span>e0</span><span> </span><span>length_butlast</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length el = length (cs k) - 1&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c23</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(el @ [(AnonyEvent fin_com, sn, xn)]) ! i = el ! i&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(el @ [(AnonyEvent fin_com, sn, xn)]) ! i = last el&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>a83</span><span> </span><span>c1</span><span> </span><span>diff_Suc_1</span><span> </span><span>e0</span><span> </span><span>last_conv_nth</span><span> </span><span>length_greater_0_conv</span><span> </span><span>list.simps</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f1</span><span> </span><span>d42</span><span> </span><span>d7</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>          
</span><span>          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d10</span><span> </span><span>e1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_e (?el1 ! i), gets_e (?el1 ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>commit_e_def</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>e0</span><span> </span><span>c23</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el1 !i = last el&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>a10</span><span> </span><span>butlast_snoc</span><span> </span><span>diff_Suc_1</span><span> </span><span>diff_is_0_eq</span><span> 
</span><span>              </span><span>last_conv_nth</span><span> </span><span>length_0_conv</span><span> </span><span>length_butlast</span><span> </span><span>lessI</span><span> </span><span>not_le</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>e0</span><span> </span><span>c23</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el1 ! Suc i = (AnonyEvent fin_com, sn, xn)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>butlast_snoc</span><span> </span><span>length_butlast</span><span> </span><span>nth_append_length</span><span class="delimiter">)</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(sn1,sn)&#8712;Guar<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>d42</span><span> </span><span>gets_e_def</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(getspc_e (last el), sn1, xn1)&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>            </span><span>gets_e_def</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(AnonyEvent fin_com, sn, xn)&quot;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fst_conv</span><span> </span><span>snd_conv</span><span class="delimiter">)</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d2</span><span> </span><span>d52</span><span> </span><span>e0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (cs k ! Suc i) = sn&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>gets_es_def</span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fst_conv</span><span> </span><span>snd_conv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>          </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>e0</span><span> </span><span>e1</span><span> </span><span>c1</span><span> </span><span>d42</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (cs k ! i) = sn1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>e_eqv_einevtseq_def</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?eslh</span><span> </span><span>el</span><span> </span><span>es</span><span class="delimiter">]</span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_1</span><span> </span><span>d4</span><span> </span><span>d51</span><span> </span><span>diff_Suc_1</span><span> </span><span>diff_Suc_eq_diff_pred</span><span> </span><span>fst_conv</span><span> </span><span>gets_es_def</span><span> </span><span>snd_conv</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c11</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>act_cpts_evtseq_sat_guar_curevt_fstseg_new2_withlst_pst</span><span> </span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>   </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>b51</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (E<span class="hidden">&#8681;</span><sub>e</sub> ef) sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre<span class="hidden">&#8681;</span><sub>e</sub> ef, Rely<span class="hidden">&#8681;</span><sub>e</sub> ef, Guar<span class="hidden">&#8681;</span><sub>e</sub> ef, Post<span class="hidden">&#8681;</span><sub>e</sub> ef]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b52</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (fst esf) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre<span class="hidden">&#8681;</span><sub>f</sub> (snd esf), Rely<span class="hidden">&#8681;</span><sub>f</sub> (snd esf), Guar<span class="hidden">&#8681;</span><sub>f</sub> (snd esf), Post<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;pre = Pre<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;post = Post<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rely &#8838; Rely<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rely &#8838; Rely<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Guar<span class="hidden">&#8681;</span><sub>e</sub> ef &#8838; guar&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b11</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Guar<span class="hidden">&#8681;</span><sub>f</sub> (snd esf) &#8838; guar&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b12</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Post<span class="hidden">&#8681;</span><sub>e</sub> ef &#8838; Pre<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Pre k &#8838; pre&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Rely k &#8838; rely&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;guar &#8838; Guar k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;post &#8838; Post k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;cpts_of_pes &#915; pes s x&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; c &#8733; cs&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;assume_pes &#915; (pre1, rely1)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. (cs k) &#8712; cpts_of_es &#915; (pes k) s x&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p16</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. (cs k)&#8712;commit_es &#915; (Guar k, Post k)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. pre1 &#8838; Pre k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. rely1 &#8838; Rely k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k j. j &#8800; k &#10230; Guar j &#8838; Rely k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;evtsys_spec (rgf_EvtSeq ef esf) = getspc_es (cs k ! 0) &#8743; 
                (&#8704;i. Suc i &lt; length (cs k) &#10230; getspc_es ((cs k) ! i) &#8800; evtsys_spec (fst esf)) &#8743;
                getspc_es(last (cs k)) = evtsys_spec (fst esf)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;e&#8712;all_evts_es (rgf_EvtSeq ef esf). is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> e)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a01</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;e&#8712;all_evts_es (rgf_EvtSeq ef esf). the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> e)) = snd e&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. (&#915; &#8866; (c ! j) -pes-actk&#8594; (c ! Suc j)))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;i. Suc i &lt; length (cs k) &#8743; (&#915; &#8866; (cs k ! i) -es-(Cmd cmd)&#9839;k&#8594; (cs k ! Suc i)) &#10230;
               (gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k))))
            &#8743; gets_es (last (cs k))&#8712;Post<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p11</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. length (cs k) = length c&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>conjoin_def</span><span> </span><span>same_length_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p12</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. cs k &#8712; cpts_es &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_of_es_def</span><span> </span><span>mem_Collect_eq</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p11</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c &#8800; Nil&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_es_not_empty</span><span> </span><span>length_0_conv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p13</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length c &gt; 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?esys</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;evtsys_spec (rgf_EvtSeq ef esf)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?esl</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?n</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length ?esl&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?eslh</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;take (?n - 1) ?esl&quot;</span></span></span><span>
</span><span>    
</span><span>    
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e es ess. ?esys = EvtSeq e es &#8743; getspc_es (cs k ! 0) = EvtSeq e es&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtsys_spec_evtseq</span><span class="delimiter">[</span><span>of</span><span> </span><span>ef</span><span> </span><span>esf</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>e</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>es</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esys = EvtSeq e es &#8743; getspc_es (cs k ! 0) = EvtSeq e es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b17</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;E<span class="hidden">&#8681;</span><sub>e</sub> ef = e&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtsys_spec_evtseq</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b18</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;evtsys_spec (fst esf) = es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtsys_spec_evtsys</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p2</span><span> </span><span>a6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl &#8712; cpts_es &#915; &#8743; ?esl!0 = (EvtSeq e es,s,x)&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_of_es_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;pes k&quot;</span></span></span><span> </span><span>s</span><span> </span><span>x</span><span class="delimiter">]</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>mono_tags</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>fst_conv</span><span> </span><span>getspc_es_def</span><span> </span><span>mem_Collect_eq</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>esl1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl = (EvtSeq e es,s,x)#esl1&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_pred</span><span> </span><span>length_Suc_conv</span><span> </span><span>nth_Cons_0</span><span> </span><span>p11</span><span> </span><span>p13</span><span class="delimiter">)</span><span> 
</span><span>  
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a5</span><span> </span><span>a6</span><span> </span><span>b18</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?n &gt; 1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtseq_ne_es</span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a9</span><span> </span><span>diff_is_0_eq</span><span> </span><span>last_conv_nth</span><span> </span><span>leI</span><span> </span><span>list.simps</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span> 
</span><span>      
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a8</span><span> </span><span>a10</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a81</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?eslh &#8712; cpts_es &#915;&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Suc_diff_Suc</span><span> </span><span>butlast_conv_take</span><span> </span><span>cpts_es_take</span><span> </span><span>diff_less</span><span> </span><span>p11</span><span> </span><span>p13</span><span> </span><span>zero_less_Suc</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a10</span><span> </span><span>a8</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a82</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?eslh!0 = (EvtSeq e es,s,x)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>nth_butlast</span><span> </span><span>p11</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>esl2</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a83</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?eslh = (EvtSeq e es,s,x)#esl2&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_diff_Suc</span><span> </span><span>a10</span><span> </span><span>a9</span><span> </span><span>take_Suc_Cons</span><span class="delimiter">)</span><span> 
</span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p16</span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>p4</span><span> </span><span>p8</span><span> </span><span>p9</span><span> </span><span>p10</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p14</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. (cs k) &#8712; assume_es &#915; (Pre k, Rely k)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>conjoin_comm_imp_rely</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>mono_tags</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span class="delimiter">)</span><span> 
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b19</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ef&#8712;all_evts_es (rgf_EvtSeq ef esf)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>all_evts_es_seq</span><span class="delimiter">[</span><span>of</span><span> </span><span>ef</span><span> </span><span>esf</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a5</span><span> </span><span>b18</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &#8804; length ?eslh &#10230; getspc_es (?eslh ! i) &#8800; es&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_diff_1</span><span> </span><span>Suc_le_lessD</span><span> </span><span>Suc_less_eq</span><span> </span><span>length_take</span><span> </span><span>min.bounded_iff</span><span> 
</span><span>          </span><span>nth_take</span><span> </span><span>p11</span><span> </span><span>p13</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a81</span><span> </span><span>a82</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;el. (el &#8712; cpts_of_ev &#915; e s x &#8743; length ?eslh = length el &#8743; e_eqv_einevtseq ?eslh el es)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtseq_nfin_samelower</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?eslh</span><span> </span><span>&#915;</span><span> </span><span>e</span><span> </span><span>es</span><span> </span><span>s</span><span> </span><span>x</span><span class="delimiter">]</span><span> </span><span>cpts_of_es_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;EvtSeq e es&quot;</span></span></span><span> </span><span>s</span><span> </span><span>x</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>el</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el &#8712; cpts_of_ev &#915; e s x &#8743; length ?eslh = length el &#8743; e_eqv_einevtseq ?eslh el es&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el &#8712; cpts_ev &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>cpts_of_ev_def</span><span class="delimiter">)</span><span>
</span><span>      
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a5</span><span> </span><span>b18</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;sn xn. last (cs k) = (es, sn, xn)&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>getspc_es_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fst_conv</span><span> </span><span>surj_pair</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>sn</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>xn</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>d2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;last (cs k) = (es, sn, xn)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?el1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el @ [(AnonyEvent (fin_com),sn, xn)]&quot;</span></span></span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c23</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length ?el1 = ?n&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a9</span><span> </span><span>butlast_conv_take</span><span> </span><span>diff_Suc_1</span><span> </span><span>length_Cons</span><span> </span><span>length_append_singleton</span><span> </span><span>length_butlast</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (last ?eslh) = EvtSeq (getspc_e (last el)) es&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>e_eqv_einevtseq_def</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span class="var">?eslh</span><span> </span><span>el</span><span> </span><span>es</span><span class="delimiter">]</span><span> </span><span>a10</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Suc_diff_Suc</span><span> </span><span>butlast_conv_take</span><span> </span><span>diff_Suc_1</span><span> </span><span>diff_is_0_eq</span><span> 
</span><span>            </span><span>last_conv_nth</span><span> </span><span>length_butlast</span><span> </span><span>length_greater_0_conv</span><span> </span><span>not_le</span><span> </span><span>order_refl</span><span> </span><span>p11</span><span> </span><span>p13</span><span> </span><span>take_eq_Nil</span><span class="delimiter">)</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;sn1 xn1. last ?eslh = (EvtSeq (getspc_e (last el)) es, sn1, xn1)&quot;</span></span></span><span> 
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>getspc_es_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fst_conv</span><span> </span><span>surj_pair</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>sn1</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>xn1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>d4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;last ?eslh = (EvtSeq (getspc_e (last el)) es, sn1, xn1)&quot;</span></span></span><span>
</span><span>         </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d41</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_e (last el) = sn1 &#8743; getx_e (last el) = xn1&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>e_eqv_einevtseq_def</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?eslh</span><span> </span><span>el</span><span> </span><span>es</span><span class="delimiter">]</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>Suc_diff_Suc</span><span> </span><span>a10</span><span> </span><span>a9</span><span> </span><span>diff_Suc_1</span><span> </span><span>diff_is_0_eq</span><span> </span><span>fst_conv</span><span> </span><span>gets_es_def</span><span> 
</span><span>            </span><span>getx_es_def</span><span> </span><span>last_conv_nth</span><span> </span><span>le_refl</span><span> </span><span>length_0_conv</span><span> </span><span>list.distinct</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>not_le</span><span> </span><span>snd_conv</span><span> </span><span>take_eq_Nil</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d42</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;last el = (getspc_e (last el), sn1, xn1)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>gets_e_def</span><span> </span><span>getspc_e_def</span><span> </span><span>getx_e_def</span><span> </span><span>prod.collapse</span><span class="delimiter">)</span><span> 
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d51</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;last ?eslh = ?esl ! (?n - 2)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Suc_1</span><span> </span><span>Suc_diff_Suc</span><span> </span><span>a10</span><span> </span><span>butlast_conv_take</span><span> 
</span><span>          </span><span>diff_Suc_eq_diff_pred</span><span> </span><span>last_conv_nth</span><span> </span><span>length_butlast</span><span> </span><span>length_greater_0_conv</span><span> 
</span><span>          </span><span>lessI</span><span> </span><span>nth_butlast</span><span> </span><span>p11</span><span> </span><span>p13</span><span> </span><span>take_eq_Nil</span><span class="delimiter">)</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d52</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;last ?esl = ?esl ! (?n - 1)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>a9</span><span> </span><span>last_conv_nth</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a8</span><span> </span><span>a10</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop (?n-2) ?esl &#8712; cpts_es &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_es_dropi2</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?esl</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?n - 2&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_1</span><span> </span><span>diff_Suc_less</span><span> </span><span>p11</span><span> </span><span>p13</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>linarith</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d2</span><span> </span><span>d4</span><span> </span><span>b18</span><span> </span><span>d51</span><span> </span><span>d52</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;est. &#915; &#8866; ?esl ! (?n-2) -es-est&#8594; ?esl ! (?n-1)&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>exist_estran</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;EvtSeq (getspc_e (last el)) es&quot;</span></span></span><span> </span><span>sn1</span><span> </span><span>xn1</span><span> </span><span>es</span><span> </span><span>sn</span><span> </span><span>xn</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;[]&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Cons_nth_drop_Suc</span><span> </span><span>One_nat_def</span><span> </span><span>Suc_1</span><span> </span><span>Suc_diff_Suc</span><span> 
</span><span>            </span><span>a10</span><span> </span><span>a5</span><span> </span><span>d3</span><span> </span><span>diff_Suc_less</span><span> </span><span>exist_estran</span><span> </span><span>p11</span><span> </span><span>p13</span><span class="delimiter">)</span><span> 
</span><span>          
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>est</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; ?esl ! (?n-2) -es-est&#8594; ?esl ! (?n-1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d2</span><span> </span><span>d4</span><span> </span><span>d51</span><span> </span><span>d52</span><span> </span><span>b18</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;t. &#915; &#8866; (getspc_e (last el), sn1, xn1) -et-t&#8594;(AnonyEvent (fin_com),sn, xn)&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtseq_tran_0_exist_etran</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (last el)&quot;</span></span></span><span> </span><span>es</span><span> </span><span>sn1</span><span> </span><span>xn1</span><span> </span><span>est</span><span> </span><span>sn</span><span> </span><span>xn</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a10</span><span> </span><span>c1</span><span> </span><span>c2</span><span> </span><span>d41</span><span> </span><span>d42</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d8</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;?el1 &#8712; cpts_ev &#915;&quot;</span></span></span><span> 
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_ev_onemore</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>diff_is_0_eq</span><span> </span><span>last_conv_nth</span><span> </span><span>length_greater_0_conv</span><span> </span><span>not_le</span><span> </span><span>p11</span><span> </span><span>p13</span><span> </span><span>take_eq_Nil</span><span class="delimiter">)</span><span> 
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d8</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el1 &#8712; cpts_of_ev &#915; e s x&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>a10</span><span> </span><span>butlast_conv_take</span><span> </span><span>c1</span><span> </span><span>cpts_of_ev_def</span><span> 
</span><span>          </span><span>length_butlast</span><span> </span><span>mem_Collect_eq</span><span> </span><span>nth_append</span><span> </span><span>zero_less_diff</span><span class="delimiter">)</span><span> 
</span><span>                         
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p14</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl &#8712; assume_es &#915; (Pre k, Rely k)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b1</span><span> </span><span>b2</span><span> </span><span>b6</span><span> </span><span>b8</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl &#8712; assume_es &#915; (Pre<span class="hidden">&#8681;</span><sub>e</sub> ef, Rely<span class="hidden">&#8681;</span><sub>e</sub> ef)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>assume_es_imp</span><span> </span><span>equalityE</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?eslh &#8712; assume_es &#915; (Pre<span class="hidden">&#8681;</span><sub>e</sub> ef, Rely<span class="hidden">&#8681;</span><sub>e</sub> ef)&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assume_es_take_n</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?n-1&quot;</span></span></span><span> </span><span class="var">?esl</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Pre<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Rely<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>a10</span><span> </span><span>butlast_conv_take</span><span> </span><span>diff_le_self</span><span> </span><span>zero_less_diff</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c21</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el &#8712; assume_e &#915; (Pre<span class="hidden">&#8681;</span><sub>e</sub> ef, Rely<span class="hidden">&#8681;</span><sub>e</sub> ef)&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>e_eqv_einevtseq_def</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?eslh</span><span> </span><span>el</span><span> </span><span>es</span><span class="delimiter">]</span><span> </span><span>assume_es_def</span><span> </span><span>assume_e_def</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>Suc_leI</span><span> </span><span>a10</span><span> </span><span>diff_is_0_eq</span><span> </span><span>eetran_eqconf1</span><span> </span><span>eqconf_esetran</span><span> </span><span>length_greater_0_conv</span><span> 
</span><span>            </span><span>less_imp_le_nat</span><span> </span><span>mem_Collect_eq</span><span> </span><span>not_le</span><span> </span><span>p11</span><span> </span><span>p13</span><span> </span><span>prod.simps</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>take_eq_Nil</span><span class="delimiter">)</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el1 &#8712; assume_e &#915; (Pre<span class="hidden">&#8681;</span><sub>e</sub> ef, Rely<span class="hidden">&#8681;</span><sub>e</sub> ef)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_e (?el1!0) &#8712; Pre<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c21</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_e (el!0) &#8712; Pre<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_e_def</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>a10</span><span> </span><span>butlast_conv_take</span><span> </span><span>c1</span><span> </span><span>length_butlast</span><span> </span><span>nth_append</span><span> </span><span>zero_less_diff</span><span class="delimiter">)</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length ?el1 &#10230; &#915; &#8866; ?el1!i -ee&#8594; ?el1!(Suc i) &#10230; 
                (gets_e (?el1!i), gets_e (?el1!Suc i)) &#8712; Rely<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>            </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>              </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>              </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length ?el1&quot;</span></span></span><span>
</span><span>                </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>e1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; ?el1!i -ee&#8594; ?el1!(Suc i)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c21</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length el &#10230;  &#915; &#8866; el!i -ee&#8594; el!(Suc i) &#10230; 
                (gets_e (el!i), gets_e (el!Suc i)) &#8712; Rely<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_e_def</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_e (?el1!i), gets_e (?el1!Suc i)) &#8712; Rely<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length ?el1 - 1&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>f0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length ?el1 - 1&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>e0</span><span> </span><span>e2</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Suc_diff_1</span><span> 
</span><span>                      </span><span>Suc_less_eq</span><span> </span><span>Suc_mono</span><span> </span><span>e1</span><span> </span><span>length_append_singleton</span><span> </span><span>nth_append</span><span> </span><span>zero_less_Suc</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (Suc i &lt; length ?el1 - 1)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &#8805; length ?el1 - 1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>e0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i = length ?el1 - 1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el1!(Suc i) = (AnonyEvent fin_com, sn, xn)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>f1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el1!i = (getspc_e (last el), sn1, xn1)&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>a10</span><span> </span><span>c1</span><span> </span><span>d42</span><span> </span><span>diff_Suc_1</span><span> </span><span>diff_is_0_eq</span><span> 
</span><span>                      </span><span>last_conv_nth</span><span> </span><span>length_append_singleton</span><span> </span><span>length_greater_0_conv</span><span> 
</span><span>                      </span><span>lessI</span><span> </span><span>not_le</span><span> </span><span>nth_append</span><span> </span><span>p11</span><span> </span><span>p13</span><span> </span><span>take_eq_Nil</span><span class="delimiter">)</span><span>
</span><span>                  
</span><span>                  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d7</span><span> </span><span>f2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (?el1!i) &#8800; getspc_e (?el1!(Suc i))&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evt_not_eq_in_tran_aux</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>e1</span><span> </span><span>eetran.cases</span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>e1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (?el1!i) = getspc_e (?el1!(Suc i))&quot;</span></span></span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>eetran_eqconf1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>            
</span><span>          </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_e_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>     
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d9</span><span> </span><span>b51</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el1 &#8712; commit_e &#915; (Guar<span class="hidden">&#8681;</span><sub>e</sub> ef, Post<span class="hidden">&#8681;</span><sub>e</sub> ef)&quot;</span></span></span><span> 
</span><span>         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evt_validity_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;E<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Pre<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Rely<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Guar<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Post<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>          </span><span>Int_iff</span><span> </span><span>b17</span><span> </span><span>contra_subsetD</span><span> </span><span>rgsound_e</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>      
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (last ?el1) = AnonyEvent fin_com&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>getspc_e_def</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;last ?el1&quot;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_e (last ?el1) = sn&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>gets_e_def</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;last ?el1&quot;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;sn&#8712;Post<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>d10</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>commit_e_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d101</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (last (cs k)) &#8712; Post<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>gets_es_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>      
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length ?esl&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915; &#8866; ?esl!i -es-((Cmd cmd)&#9839;k)&#8594; ?esl!(Suc i))&quot;</span></span></span><span> 
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;all_evts_esspec (evtsys_spec (rgf_EvtSeq ef esf)). is_basicevt ef&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtsys_spec_evtseq</span><span class="delimiter">[</span><span>of</span><span> </span><span>ef</span><span> </span><span>esf</span><span class="delimiter">]</span><span> </span><span>all_evts_same</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rgf_EvtSeq ef esf&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>DomainE</span><span> </span><span>E<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>prod.sel</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>a6</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span>a8</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;ie. ie &lt; i &#8743; (&#8707;e. &#915; &#8866; (cs k)!ie -es-(EvtEnt e&#9839;k)&#8594; (cs k)!(Suc ie))
              &#8743; (&#8704;j. j &gt; ie &#8743; j &lt; i &#10230; &#172;(&#8707;e. &#915; &#8866; (cs k)!j -es-(EvtEnt e&#9839;k)&#8594; (cs k)!(Suc j)))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cmd_impl_evtent_before_and_cmds</span><span class="delimiter">[</span><span>of</span><span> </span><span>c</span><span> </span><span>cs</span><span> </span><span>k</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;evtsys_spec (rgf_EvtSeq ef esf)&quot;</span></span></span><span> </span><span>s</span><span> </span><span>x</span><span class="delimiter">]</span><span> 
</span><span>          </span><span>cpts_of_es_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;EvtSeq e es&quot;</span></span></span><span> </span><span>s</span><span> </span><span>x</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>ie</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>ev</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ie &lt; i &#8743; (&#915; &#8866; (cs k)!ie -es-(EvtEnt ev&#9839;k)&#8594; (cs k)!(Suc ie))
              &#8743; (&#8704;j. j &gt; ie &#8743; j &lt; i &#10230; &#172;(&#8707;e. &#915; &#8866; (cs k)!j -es-(EvtEnt e&#9839;k)&#8594; (cs k)!(Suc j)))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span>p6</span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;m. m &gt; ie &#8743; m &#8804; i &#10230; getx_es ((cs k)!m) k = ev&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtent_impl_curevt_in_cpts_es2</span><span class="delimiter">[</span><span>of</span><span> </span><span>c</span><span> </span><span>cs</span><span> </span><span>ie</span><span> </span><span>k</span><span> </span><span>ev</span><span> </span><span>i</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getx_es ((cs k)!i) k = ev&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a3</span><span> </span><span>c4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ie &lt; i &#8743; (&#915; &#8866; ?eslh!ie -es-(EvtEnt ev&#9839;k)&#8594; ?eslh!(Suc ie))
              &#8743; (&#8704;j. j &gt; ie &#8743; j &lt; i &#10230; &#172;(&#8707;e. &#915; &#8866; ?eslh!j -es-(EvtEnt e&#9839;k)&#8594; ?eslh!(Suc j)))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a3</span><span> </span><span>a81</span><span> </span><span>a82</span><span> </span><span>a83</span><span> </span><span>c8</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. i &#8804; ie &#10230; getspc_es (?eslh ! i) = EvtSeq e es&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtseq_evtent_befaft</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?eslh</span><span> </span><span>e</span><span> </span><span>es</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>esl2</span><span> </span><span>ie</span><span class="delimiter">]</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>Suc_diff_1</span><span> </span><span>Suc_diff_Suc</span><span> </span><span>Suc_less_eq</span><span> </span><span>a10</span><span> </span><span>butlast_conv_take</span><span> 
</span><span>            </span><span>diff_Suc_eq_diff_pred</span><span> </span><span>length_butlast</span><span> </span><span>less_trans_Suc</span><span> </span><span>p11</span><span> </span><span>p13</span><span class="delimiter">)</span><span> 
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c8</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ev = e&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>evtent_is_basicevt_inevtseq2</span><span> </span><span>order_refl</span><span class="delimiter">)</span><span> 
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c11</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k))) = Guar<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Guar<span class="hidden">&#8681;</span><sub>f</sub>_def</span><span> </span><span>Guar<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>a01</span><span> </span><span>b17</span><span> </span><span>b19</span><span> </span><span>c10</span><span> </span><span>c7</span><span class="delimiter">)</span><span> 
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k)))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; ?n - 1&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; ?n - 1&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (?eslh ! i) = EvtSeq (getspc_e (el ! i)) es&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>a3</span><span> </span><span>c1</span><span> </span><span>e0</span><span> </span><span>e_eqv_einevtseq_def</span><span> </span><span>length_take</span><span> </span><span>less_imp_le_nat</span><span> </span><span>min.bounded_iff</span><span class="delimiter">)</span><span>  
</span><span>           
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (?eslh ! Suc i) = EvtSeq (getspc_e (el ! Suc i)) es&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_leI</span><span> </span><span>a3</span><span> </span><span>c1</span><span> </span><span>e0</span><span> </span><span>e_eqv_einevtseq_def</span><span> </span><span>length_take</span><span> </span><span>min.bounded_iff</span><span class="delimiter">)</span><span> 
</span><span>    
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (?eslh ! i) &#8800; getspc_es (?eslh ! Suc i)&quot;</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_lessD</span><span> </span><span>e0</span><span> </span><span>evtsys_not_eq_in_tran_aux1</span><span> </span><span>nth_take</span><span class="delimiter">)</span><span>  
</span><span>    
</span><span>          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>e1</span><span> </span><span>e2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (el ! i) &#8800; getspc_e (el ! Suc i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c1</span><span> </span><span>c2</span><span> </span><span>e0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;t. &#915; &#8866; (el ! i) -et-t&#8594; (el ! Suc i)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_of_ev_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>e</span><span> </span><span>s</span><span> </span><span>x</span><span class="delimiter">]</span><span> </span><span>notran_confeqi</span><span class="delimiter">[</span><span>of</span><span> </span><span>el</span><span> </span><span>&#915;</span><span> </span><span>i</span><span class="delimiter">]</span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span>length_take</span><span> </span><span>less_eq_Suc_le</span><span> </span><span>min.bounded_iff</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>    
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>e0</span><span> </span><span>a3</span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length ?el1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>e0</span><span> </span><span>a3</span><span> </span><span>c23</span><span> </span><span>e4</span><span> </span><span>e5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;t. &#915; &#8866; ?el1 ! i -et-t&#8594; ?el1 ! Suc i&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Suc_lessD</span><span> </span><span>butlast_snoc</span><span> </span><span>length_butlast</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_e (?el1!i), gets_e (?el1!Suc i))&#8712;Guar<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>d10</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>commit_e_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (?eslh ! i), gets_es (?eslh ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>e_eqv_einevtseq_def</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?eslh</span><span> </span><span>el</span><span> </span><span>es</span><span class="delimiter">]</span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Suc_leI</span><span> </span><span>Suc_lessE</span><span> </span><span>a3</span><span> </span><span>c1</span><span> </span><span>c23</span><span> </span><span>diff_Suc_1</span><span> 
</span><span>                </span><span>e0</span><span> </span><span>length_append_singleton</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span>  
</span><span>          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c11</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_lessD</span><span> </span><span>e0</span><span> </span><span>nth_take</span><span class="delimiter">)</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (Suc i &lt; ?n - 1)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i = ?n - 1&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_pred&#39;</span><span> </span><span>a3</span><span> </span><span>less_antisym</span><span> </span><span>p11</span><span> </span><span>p13</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>linarith</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length ?el1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span>c23</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>linarith</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;t. &#915; &#8866; (?el1 ! i) -et-t&#8594;(?el1 ! Suc i)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i = length (butlast (el @ [(AnonyEvent fin_com, sn, xn)]))&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>c23</span><span> </span><span>e0</span><span> </span><span>length_butlast</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length el = length (cs k) - 1&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c23</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(el @ [(AnonyEvent fin_com, sn, xn)]) ! i = el ! i&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(el @ [(AnonyEvent fin_com, sn, xn)]) ! i = last el&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>a83</span><span> </span><span>c1</span><span> </span><span>diff_Suc_1</span><span> </span><span>e0</span><span> </span><span>last_conv_nth</span><span> </span><span>length_greater_0_conv</span><span> </span><span>list.simps</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f1</span><span> </span><span>d42</span><span> </span><span>d7</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>          
</span><span>          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d10</span><span> </span><span>e1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_e (?el1 ! i), gets_e (?el1 ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>commit_e_def</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>e0</span><span> </span><span>c23</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el1 !i = last el&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>a10</span><span> </span><span>butlast_snoc</span><span> </span><span>diff_Suc_1</span><span> </span><span>diff_is_0_eq</span><span> 
</span><span>              </span><span>last_conv_nth</span><span> </span><span>length_0_conv</span><span> </span><span>length_butlast</span><span> </span><span>lessI</span><span> </span><span>not_le</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>e0</span><span> </span><span>c23</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el1 ! Suc i = (AnonyEvent fin_com, sn, xn)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>butlast_snoc</span><span> </span><span>length_butlast</span><span> </span><span>nth_append_length</span><span class="delimiter">)</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(sn1,sn)&#8712;Guar<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>d42</span><span> </span><span>gets_e_def</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(getspc_e (last el), sn1, xn1)&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>            </span><span>gets_e_def</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(AnonyEvent fin_com, sn, xn)&quot;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fst_conv</span><span> </span><span>snd_conv</span><span class="delimiter">)</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d2</span><span> </span><span>d52</span><span> </span><span>e0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (cs k ! Suc i) = sn&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>gets_es_def</span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fst_conv</span><span> </span><span>snd_conv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>          </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>e0</span><span> </span><span>e1</span><span> </span><span>c1</span><span> </span><span>d42</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (cs k ! i) = sn1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>e_eqv_einevtseq_def</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?eslh</span><span> </span><span>el</span><span> </span><span>es</span><span class="delimiter">]</span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_1</span><span> </span><span>d4</span><span> </span><span>d51</span><span> </span><span>diff_Suc_1</span><span> </span><span>diff_Suc_eq_diff_pred</span><span> </span><span>fst_conv</span><span> </span><span>gets_es_def</span><span> </span><span>snd_conv</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c11</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>d101</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>act_cpts_evtseq_sat_guar_curevt_new2</span><span class="delimiter">:</span><span>
</span><span>   </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>b51</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (E<span class="hidden">&#8681;</span><sub>e</sub> ef) sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre<span class="hidden">&#8681;</span><sub>e</sub> ef, Rely<span class="hidden">&#8681;</span><sub>e</sub> ef, Guar<span class="hidden">&#8681;</span><sub>e</sub> ef, Post<span class="hidden">&#8681;</span><sub>e</sub> ef]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b52</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (fst esf) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre<span class="hidden">&#8681;</span><sub>f</sub> (snd esf), Rely<span class="hidden">&#8681;</span><sub>f</sub> (snd esf), Guar<span class="hidden">&#8681;</span><sub>f</sub> (snd esf), Post<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;prea = Pre<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;posta = Post<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;relya &#8838; Rely<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;relya &#8838; Rely<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Guar<span class="hidden">&#8681;</span><sub>e</sub> ef &#8838; guara&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b11</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Guar<span class="hidden">&#8681;</span><sub>f</sub> (snd esf) &#8838; guara&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b12</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Post<span class="hidden">&#8681;</span><sub>e</sub> ef &#8838; Pre<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Pre k &#8838; prea&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Rely k &#8838; relya&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;guara &#8838; Guar k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;posta &#8838; Post k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;cpts_of_pes &#915; pes s x&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; c &#8733; cs&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;assume_pes &#915; (pre1, rely1)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. (cs k) &#8712; cpts_of_es &#915; (pes k) s x&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p16</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. cs k&#8712; commit_es &#915; (Guar k, Post k)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. pre1 &#8838; Pre k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. rely1 &#8838; Rely k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k j. j &#8800; k &#10230; Guar j &#8838; Rely k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;evtsys_spec (rgf_EvtSeq ef esf) = getspc_es (cs k ! 0)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;e&#8712;all_evts_es (rgf_EvtSeq ef esf). is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> e)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a02</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;e&#8712;all_evts_es (rgf_EvtSeq ef esf). the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> e)) = snd e&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. (&#915; &#8866; (c ! j) -pes-actk&#8594; (c ! Suc j)))&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>pp</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;c pes s x cs pre1 rely1 Pre Rely Guar Post k cmd.
          Pre k &#8838; Pre<span class="hidden">&#8681;</span><sub>f</sub> (snd esf) &#8743; Rely k &#8838; Rely<span class="hidden">&#8681;</span><sub>f</sub> (snd esf) 
            &#8743; Guar<span class="hidden">&#8681;</span><sub>f</sub> (snd esf) &#8838; Guar k &#8743; Post<span class="hidden">&#8681;</span><sub>f</sub> (snd esf) &#8838; Post k &#10230;
          c &#8712; cpts_of_pes &#915; pes s x &#8743; &#915; c &#8733; cs &#8743; c &#8712; assume_pes &#915; (pre1, rely1) &#10230;
          (&#8704;k. (cs k) &#8712; cpts_of_es &#915; (pes k) s x) &#10230;
          (&#8704;k. cs k&#8712; commit_es &#915; (Guar k, Post k)) &#10230;
          (&#8704;k. pre1 &#8838; Pre k) &#10230;
          (&#8704;k. rely1 &#8838; Rely k) &#10230;
          (&#8704;k j. j &#8800; k &#10230; Guar j &#8838; Rely k) &#10230;
          evtsys_spec (fst esf) = getspc_es (cs k ! 0) &#10230;
          (&#8704;e&#8712;all_evts_es (fst esf). is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> e)) &#10230;
          (&#8704;e&#8712;all_evts_es (fst esf). the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> e)) = snd e) &#10230;
          (&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. (&#915; &#8866; (c ! j) -pes-actk&#8594; (c ! Suc j)))) &#10230;
          (&#8704;i. Suc i &lt; length (cs k) &#8743; (&#915; &#8866; (cs k ! i) -es-(Cmd cmd)&#9839;k&#8594; (cs k ! Suc i)) &#10230;
               (gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k))))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length (cs k) &#8743; (&#915; &#8866; (cs k ! i) -es-(Cmd cmd)&#9839;k&#8594; (cs k ! Suc i)) &#10230;
               (gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k)))&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p11</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. length (cs k) = length c&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>conjoin_def</span><span> </span><span>same_length_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p12</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. cs k &#8712; cpts_es &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_of_es_def</span><span> </span><span>mem_Collect_eq</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p11</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c &#8800; Nil&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_es_not_empty</span><span> </span><span>length_0_conv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p13</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length c &gt; 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>    
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>p4</span><span> </span><span>p8</span><span> </span><span>p9</span><span> </span><span>p10</span><span> </span><span>p16</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p14</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. (cs k) &#8712; assume_es &#915; (Pre k, Rely k)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>conjoin_comm_imp_rely</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>mono_tags</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span class="delimiter">)</span><span> 
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p15</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;cpts_pes &#915; &#8743; c!0=(pes,s,x)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>cpts_of_pes_def</span><span class="delimiter">)</span><span>
</span><span>    
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?esys</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;evtsys_spec (rgf_EvtSeq ef esf)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?esl</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k&quot;</span></span></span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e es ess. ?esys = EvtSeq e es &#8743; getspc_es (cs k ! 0) = EvtSeq e es&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtsys_spec_evtseq</span><span class="delimiter">[</span><span>of</span><span> </span><span>ef</span><span> </span><span>esf</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>e</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>es</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esys = EvtSeq e es &#8743; getspc_es (cs k ! 0) = EvtSeq e es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p2</span><span> </span><span>a6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl &#8712; cpts_es &#915; &#8743; ?esl!0 = (EvtSeq e es,s,x)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_of_es_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;pes k&quot;</span></span></span><span> </span><span>s</span><span> </span><span>x</span><span class="delimiter">]</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>mono_tags</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>fst_conv</span><span> </span><span>getspc_es_def</span><span> </span><span>mem_Collect_eq</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>esl1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl = (EvtSeq e es,s,x)#esl1&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_pred</span><span> </span><span>length_Suc_conv</span><span> </span><span>nth_Cons_0</span><span> </span><span>p11</span><span> </span><span>p13</span><span class="delimiter">)</span><span> 
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b17</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;E<span class="hidden">&#8681;</span><sub>e</sub> ef = e&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtsys_spec_evtseq</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b18</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;evtsys_spec (fst esf) = es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtsys_spec_evtsys</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length ?esl&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915; &#8866; ?esl!i -es-((Cmd cmd)&#9839;k)&#8594; ?esl!(Suc i))&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k)))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &#8804; length ?esl &#10230; getspc_es (?esl ! i) &#8800; es&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &#8804; length ?esl &#10230; getspc_es (?esl ! i) &#8800; es&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>p8</span><span> </span><span>p2</span><span> </span><span>p9</span><span> </span><span>p10</span><span> </span><span>p4</span><span> </span><span>p6</span><span> </span><span>p16</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>act_cpts_evtseq_sat_guar_curevt_fstseg_new2</span><span class="delimiter">[</span><span>of</span><span> </span><span>ef</span><span> </span><span>esf</span><span> </span><span>prea</span><span> 
</span><span>              </span><span>posta</span><span> </span><span>relya</span><span> </span><span>guara</span><span> </span><span>Pre</span><span> </span><span>k</span><span> </span><span>Rely</span><span> </span><span>Guar</span><span> </span><span>Post</span><span> </span><span>c</span><span> </span><span>pes</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>cs</span><span> </span><span>pre1</span><span> </span><span>rely1</span><span> </span><span>evtrgfs</span><span> </span><span>i</span><span> </span><span>cmd</span><span class="delimiter">]</span><span>
</span><span>               </span><span>a02</span><span> </span><span>a2</span><span> </span><span>b18</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span>b1</span><span> </span><span>b2</span><span> </span><span>b3</span><span> </span><span>b4</span><span> </span><span>b6</span><span> </span><span>b7</span><span> </span><span>b8</span><span> </span><span>b9</span><span> </span><span>b10</span><span> </span><span>b11</span><span> </span><span>b12</span><span> </span><span>b51</span><span> </span><span>b52</span><span> </span><span>c0</span><span> </span><span>b18</span><span> </span><span>a6</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#8704;i. Suc i &#8804; length ?esl &#10230; getspc_es (?esl ! i) &#8800; es)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;m. Suc m &#8804; length ?esl &#8743; getspc_es (?esl ! m) = es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>m</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc m &#8804; length ?esl &#8743; getspc_es (?esl ! m) = es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;i. i &#8804; m &#8743; getspc_es (?esl ! i) = es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a8</span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;i. (i &#8804; m &#8743; getspc_es (?esl ! i) = es) 
                                  &#8743; (&#8704;j. j &lt; i &#10230; getspc_es (?esl ! j) &#8800; es)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtseq_fst_finish</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?esl</span><span> </span><span>&#915;</span><span> </span><span>e</span><span> </span><span>es</span><span> </span><span>m</span><span class="delimiter">]</span><span> </span><span>getspc_es_def</span><span> </span><span>fst_conv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>n</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(n &#8804; m &#8743; getspc_es (?esl ! n) = es) 
                                  &#8743; (&#8704;j. j &lt; n &#10230; getspc_es (?esl ! j) &#8800; es)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a8</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;n &#8800; 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>getspc_es_def</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k ! 0&quot;</span></span></span><span class="delimiter">]</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>hide_lams</span><span class="delimiter">)</span><span> </span><span>add.commute</span><span> </span><span>add.right_neutral</span><span> </span><span>fst_conv</span><span>
</span><span>                  </span><span>add_Suc</span><span> </span><span>dual_order.irrefl</span><span> </span><span>esys.size</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>le_add1</span><span> </span><span>le_imp_less_Suc</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c1</span><span> </span><span>c3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;n &lt; length ?esl&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>          </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?c1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;take n c&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?cs1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#955;k. take n (cs k)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?c2</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop n c&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?cs2</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#955;k. drop n (cs k)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?cs1k</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?cs1 k&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?cs2k</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?cs2 k&quot;</span></span></span><span>
</span><span>
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c1</span><span> </span><span>c3</span><span> </span><span>p11</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c5_1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length ?c1 = n&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>less_le_trans</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?c1 @ ?c2 = c&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl = ?cs1k @ ?cs2k&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?cs1k ! 0 = (EvtSeq e es, s, x)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a9</span><span> </span><span>c4</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>  
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (?cs2k ! 0) = es&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>c3</span><span> </span><span>c5</span><span> </span><span>less_or_eq_imp_le</span><span class="delimiter">)</span><span>  
</span><span>
</span><span>
</span><span>
</span><span>          </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?c12</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;take (Suc n) c&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?cs12</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#955;k. take (Suc n) (cs k)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p15</span><span> </span><span>p11</span><span> </span><span>c1</span><span> </span><span>c3</span><span> </span><span>c4</span><span> </span><span>c5_1</span><span> </span><span>c5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?c12&#8712;cpts_pes &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_pes_take</span><span class="delimiter">[</span><span>of</span><span> </span><span>c</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;n&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span class="delimiter">)</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p15</span><span> </span><span>c4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?c12&#8712;cpts_of_pes &#915; pes s x&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_of_pes_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>pes</span><span> </span><span>s</span><span> </span><span>x</span><span class="delimiter">]</span><span>
</span><span>                  </span><span>append_take_drop_id</span><span> </span><span>length_greater_0_conv</span><span> </span><span>mem_Collect_eq</span><span> 
</span><span>                  </span><span>nth_append</span><span> </span><span>take_eq_Nil</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span>p11</span><span> </span><span>c1</span><span> </span><span>c3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; ?c12 &#8733; ?cs12&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>take_n_conjoin</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>c</span><span> </span><span>cs</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc n&quot;</span></span></span><span> </span><span class="var">?c12</span><span> </span><span class="var">?cs12</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p8</span><span> </span><span>c1</span><span> </span><span>c3</span><span> </span><span>p11</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?c12 &#8712; assume_pes &#915; (pre1, rely1)&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assume_pes_take_n</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc n&quot;</span></span></span><span> </span><span>c</span><span> </span><span>&#915;</span><span> </span><span>pre1</span><span> </span><span>rely1</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p2</span><span> </span><span>c1</span><span> </span><span>c3</span><span> </span><span>p11</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. (?cs12 k) &#8712; cpts_of_es &#915; (pes k) s x&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>              </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>k&#39;</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p2</span><span> </span><span>c1</span><span> </span><span>c3</span><span> </span><span>p11</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(?cs12 k&#39;)!0 = (pes k&#39;, s, x)&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_of_es_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;pes k&#39;&quot;</span></span></span><span> </span><span>s</span><span> </span><span>x</span><span class="delimiter">]</span><span>
</span><span>                    </span><span>Suc_leI</span><span> </span><span>less_le_trans</span><span> </span><span>mem_Collect_eq</span><span> </span><span>nth_take</span><span> </span><span>zero_less_Suc</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k&#39;&#8712;cpts_es &#915;&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_of_es_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;pes k&#39;&quot;</span></span></span><span> </span><span>s</span><span> </span><span>x</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">moreover</span></span><span> 
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c1</span><span> </span><span>c3</span><span> </span><span>p11</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(?cs12 k&#39;)&#8712;cpts_es &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_es_take</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k&#39;&quot;</span></span></span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;n&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>                  </span><span>Suc_diff_1</span><span> </span><span>Suc_le_lessD</span><span> </span><span>c4</span><span> </span><span>c5_1</span><span> </span><span>dual_order.trans</span><span> </span><span>le_SucI</span><span> 
</span><span>                  </span><span>length_0_conv</span><span> </span><span>length_greater_0_conv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(?cs12 k&#39;) &#8712; cpts_of_es &#915; (pes k&#39;) s x&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>cpts_of_es_def</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. Suc j &lt; length ?c12 &#10230; (&#8707;actk. &#915; &#8866; ?c12!j-pes-actk&#8594;?c12!Suc j)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_lessD</span><span> </span><span>length_take</span><span> </span><span>min_less_iff_conj</span><span> </span><span>nth_take</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c3</span><span> </span><span>b18</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;i. Suc i &lt; length (?cs12 k) &#10230; 
                        getspc_es ((?cs12 k) ! i) &#8800; evtsys_spec (fst esf))&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Suc_le_lessD</span><span> </span><span>Suc_lessD</span><span> </span><span>Suc_lessI</span><span> 
</span><span>                </span><span>append_take_drop_id</span><span> </span><span>ex_least_nat_le</span><span> </span><span>gr_implies_not0</span><span> </span><span>length_take</span><span> 
</span><span>                </span><span>lessI</span><span> </span><span>less_antisym</span><span> </span><span>min.bounded_iff</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c3</span><span> </span><span>c4</span><span> </span><span>c5</span><span> </span><span>b18</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es(last (?cs12 k)) = evtsys_spec (fst esf)&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c4</span><span> </span><span>c5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;last (?cs12 k) = cs k ! n&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>take_Suc_conv_app_nth</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c3</span><span> </span><span>b18</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p16</span><span> </span><span>c5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. ?cs12 k &#8712; commit_es &#915; (Guar k, Post k)&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>commit_es_take_n</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc n&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_leI</span><span> </span><span>p11</span><span> </span><span>zero_less_Suc</span><span class="delimiter">)</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">ultimately</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r1</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;i. Suc i &lt; length (?cs12 k) &#8743; (&#915; &#8866; (?cs12 k ! i) -es-(Cmd cmd)&#9839;k&#8594; (?cs12 k ! Suc i)) &#10230;
                     (gets_es (?cs12 k ! i), gets_es (?cs12 k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (?cs12 k ! i) k))))
                  &#8743; gets_es (last (?cs12 k))&#8712;Post<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>act_cpts_evtseq_sat_guar_curevt_fstseg_new2_withlst_pst</span><span class="delimiter">[</span><span>of</span><span> </span><span>ef</span><span> </span><span>esf</span><span> </span><span>prea</span><span> 
</span><span>                    </span><span>posta</span><span> </span><span>relya</span><span> </span><span>guara</span><span> </span><span>Pre</span><span> </span><span>k</span><span> </span><span>Rely</span><span> </span><span>Guar</span><span> </span><span>Post</span><span> </span><span class="var">?c12</span><span> </span><span>pes</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span class="var">?cs12</span><span> </span><span>pre1</span><span> </span><span>rely1</span><span> </span><span>evtrgfs</span><span class="delimiter">]</span><span>
</span><span>                    </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*p0 p1 p8 p2*)</span></span></span></span></span><span> </span><span>p9</span><span> </span><span>p10</span><span> </span><span>p4</span><span> </span><span>p6</span><span> </span><span>p16</span><span> </span><span>a02</span><span> </span><span>a2</span><span> </span><span>b18</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span>b1</span><span> </span><span>b2</span><span> </span><span>b3</span><span> </span><span>b4</span><span> 
</span><span>                      </span><span>b6</span><span> </span><span>b7</span><span> </span><span>b8</span><span> </span><span>b9</span><span> </span><span>b10</span><span> </span><span>b11</span><span> </span><span>b12</span><span> </span><span>b51</span><span> </span><span>b52</span><span> </span><span>c0</span><span> </span><span>b18</span><span> </span><span>a6</span><span> </span><span>c4</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length (?cs12 k) &#8743; (&#915; &#8866; (?cs12 k ! i) -es-(Cmd cmd)&#9839;k&#8594; (?cs12 k ! Suc i)) &#10230;
                     (gets_es (?cs12 k ! i), gets_es (?cs12 k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (?cs12 k ! i) k)))&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>          </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &#8804; n&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &#8804; n&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>r2</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">,</span><span>of</span><span> </span><span>i</span><span class="delimiter">]</span><span> </span><span>a3</span><span> </span><span>a4</span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es ((?cs12 k)!i), gets_es ((?cs12 k)!(Suc i)))&#8712;Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es ((?cs12 k)!i) k)))&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(Suc i &#8804; n)&quot;</span></span></span><span>
</span><span>
</span><span>            </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?c2</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop n c&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?cs2</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#955;k. drop n (cs k)&quot;</span></span></span><span>
</span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &gt; n&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            
</span><span>            
</span><span>            </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?pes</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#955;k. getspc_es (?cs2 k!0)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?s</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets (?c2!0)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?x</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getx (?c2!0)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?pre1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;{?s}&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?Pre</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#955;k. {?s}&quot;</span></span></span><span>
</span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span>p11</span><span> </span><span>c5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; ?c2 &#8733; ?cs2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>drop_n_conjoin</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>c</span><span> </span><span>cs</span><span> </span><span>n</span><span> </span><span class="var">?c2</span><span> </span><span class="var">?cs2</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p15</span><span> </span><span>p11</span><span> </span><span>c1</span><span> </span><span>c3</span><span> </span><span>c4</span><span> </span><span>c5_1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?c2&#8712;cpts_pes &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_pes_dropi</span><span class="delimiter">[</span><span>of</span><span> </span><span>c</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;n-1&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>              </span><span>a3</span><span> </span><span>e0</span><span> </span><span>less_Suc_eq_0_disj</span><span> </span><span>less_trans</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?c2!0 = (?pes, ?s, ?x)&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c5</span><span> </span><span>e1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. getspc (drop n c ! 0) k = getspc_es (drop n (cs k) ! 0)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>conjoin_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="var">?c2</span><span> </span><span class="var">?cs2</span><span class="delimiter">]</span><span> </span><span>same_spec_def</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?c2</span><span> </span><span class="var">?cs2</span><span class="delimiter">]</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>length_drop</span><span> </span><span>p11</span><span> </span><span>zero_less_diff</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc (?c2!0) = ?pes&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>pesconf_trip</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?c2!0&quot;</span></span></span><span> </span><span class="var">?s</span><span> </span><span class="var">?pes</span><span> </span><span class="var">?x</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?c2&#8712;cpts_of_pes &#915; ?pes ?s ?x&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_of_pes_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?pes&quot;</span></span></span><span> </span><span class="var">?s</span><span> </span><span class="var">?x</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p8</span><span> </span><span>p11</span><span> </span><span>c5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?c2&#8712;assume_pes &#915; (?pre1, rely1)&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assume_pes_drop_n</span><span class="delimiter">[</span><span>of</span><span> </span><span>n</span><span> </span><span>c</span><span> </span><span>&#915;</span><span> </span><span>pre1</span><span> </span><span>rely1</span><span> </span><span class="var">?pre1</span><span class="delimiter">]</span><span>
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>hd_conv_nth</span><span> </span><span>hd_drop_conv_nth</span><span> </span><span>not_le</span><span> </span><span>singleton_iff</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k1. (?cs2 k1) &#8712; cpts_of_es &#915; (?pes k1) ?s ?x&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>              </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>k1</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p11</span><span> </span><span>p12</span><span> </span><span>c5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?cs2 k1 &#8712; cpts_es &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cpts_es_dropi2</span><span class="delimiter">)</span><span> 
</span><span>                
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es ((?cs2 k1)!0) = ?pes k1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es ((?cs2 k1)!0) = ?s&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>conjoin_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="var">?c2</span><span> </span><span class="var">?cs2</span><span class="delimiter">]</span><span> </span><span>same_state_def</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?c2</span><span> </span><span class="var">?cs2</span><span class="delimiter">]</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>c5</span><span> </span><span>e1</span><span> </span><span>length_drop</span><span> </span><span>p11</span><span> </span><span>zero_less_diff</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getx_es ((?cs2 k1)!0) = ?x&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>conjoin_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="var">?c2</span><span> </span><span class="var">?cs2</span><span class="delimiter">]</span><span> </span><span>same_state_def</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?c2</span><span> </span><span class="var">?cs2</span><span class="delimiter">]</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>c5</span><span> </span><span>e1</span><span> </span><span>length_drop</span><span> </span><span>p11</span><span> </span><span>zero_less_diff</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(?cs2 k1)!0 = (?pes k1, ?s, ?x)&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>esconf_trip</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(?cs2 k1)!0&quot;</span></span></span><span> </span><span class="var">?s</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?pes k1&quot;</span></span></span><span> </span><span class="var">?x</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?cs2 k1&#8712;cpts_of_es &#915; (?pes k1) ?s ?x&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_of_es_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?pes k1&quot;</span></span></span><span> </span><span class="var">?s</span><span> </span><span class="var">?x</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>              </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;n k. n &#8804; length (cs k) &#8743; n &gt; 0 
                                    &#10230; take n (cs k)&#8712;assume_es &#915; (Pre k, Rely k)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>conjoin_comm_imp_rely_n</span><span class="delimiter">[</span><span>of</span><span> </span><span>pre1</span><span> </span><span>Pre</span><span> </span><span>rely1</span><span> </span><span>Rely</span><span> </span><span>Guar</span><span> </span><span>cs</span><span> </span><span>&#915;</span><span> </span><span>Post</span><span> </span><span>c</span><span> </span><span>pes</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span class="delimiter">]</span><span>
</span><span>                </span><span>p16</span><span> </span><span>p9</span><span> </span><span>p10</span><span> </span><span>p4</span><span> </span><span>p0</span><span> </span><span>p8</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p11</span><span> </span><span>p12</span><span> </span><span>p13</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. cs k&#8712;assume_es &#915; (Pre k, Rely k)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>order_refl</span><span> </span><span>take_all</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. cs k&#8712;commit_es &#915; (Guar k, Post k)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>IntI</span><span> </span><span>contra_subsetD</span><span> </span><span>es_validity_def</span><span> </span><span>p16</span><span> </span><span>p2</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>e6</span><span> </span><span>p11</span><span> </span><span>c5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. (?cs2 k)&#8712;assume_es &#915; (?Pre k, Rely k)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assume_es_drop_n</span><span class="delimiter">[</span><span>of</span><span> </span><span>n</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>Un_insert_right</span><span> </span><span>conjoin_def</span><span> </span><span>drop_0</span><span> 
</span><span>                  </span><span>hd_drop_conv_nth</span><span> </span><span>insertI1</span><span> </span><span>length_drop</span><span> </span><span>p1</span><span> </span><span>same_state_def</span><span> </span><span>zero_less_diff</span><span class="delimiter">)</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>e7</span><span> </span><span>p11</span><span> </span><span>c5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. ?cs2 k&#8712;commit_es &#915; (Guar k, Post k)&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>commit_es_drop_n</span><span class="delimiter">[</span><span>of</span><span> </span><span>n</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>smt</span><span>
</span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. ?pre1 &#8838; ?Pre k&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p6</span><span> </span><span>c5</span><span> </span><span>p11</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e11</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. Suc j &lt; length ?c2 &#10230; (&#8707;actk. &#915; &#8866; ?c2!j-pes-actk&#8594;?c2!Suc j)&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>              </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>j</span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>f0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc j &lt; length ?c2&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p11</span><span> </span><span>c5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc (n + j) &lt; length c&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_diff_Suc</span><span> </span><span>Suc_eq_plus1</span><span> </span><span>Suc_neq_Zero</span><span> </span><span>add_diff_inverse_nat</span><span> 
</span><span>                    </span><span>diff_add_0</span><span> </span><span>diff_diff_add</span><span> </span><span>length_drop</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;actk. &#915; &#8866; c!(n+j)-pes-actk&#8594;c!Suc (n+j)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p11</span><span> </span><span>c5</span><span> </span><span>f0</span><span> </span><span>f1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c ! (n + j) = drop n c ! j&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>less_imp_le_nat</span><span> </span><span>nth_drop</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p11</span><span> </span><span>c5</span><span> </span><span>f0</span><span> </span><span>f1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c ! Suc (n + j) = drop n c ! Suc j&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>less_or_eq_imp_le</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;actk. &#915; &#8866; ?c2!j-pes-actk&#8594;?c2!Suc j&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>              </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets (c!n) = gets_es (cs k ! n)&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>conjoin_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>c</span><span> </span><span>cs</span><span class="delimiter">]</span><span> </span><span>same_state_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>c</span><span> </span><span>cs</span><span class="delimiter">]</span><span> </span><span>c5</span><span> </span><span>p11</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (last (take (Suc n) (cs k))) = gets_es (cs k ! n)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>take_Suc_conv_app_nth</span><span class="delimiter">)</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets (drop n c ! 0) = gets (c!n)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c5_1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e12</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?s&#8712;Pre<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>r1</span><span> </span><span>b12</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b18</span><span> </span><span>c3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e13</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;evtsys_spec (fst esf) = getspc_es (?cs2 k ! 0)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c5</span><span> </span><span>drop_eq_Nil</span><span> </span><span>hd_conv_nth</span><span> </span><span>hd_drop_conv_nth</span><span> </span><span>not_less</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e14</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;e &#8712; all_evts_es (fst esf). is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> e)&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>all_evts_es_seq</span><span class="delimiter">[</span><span>of</span><span> </span><span>ef</span><span> </span><span>esf</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a02</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e15</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;e &#8712; all_evts_es (fst esf). the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> e)) = snd e&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>all_evts_es_seq</span><span class="delimiter">[</span><span>of</span><span> </span><span>ef</span><span> </span><span>esf</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>            </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>              </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>ii</span><span>
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>e2</span><span> </span><span>e1</span><span> </span><span>e3</span><span> </span><span>e4</span><span> </span><span>e8</span><span> </span><span>e9</span><span> </span><span>e10</span><span> </span><span>p10</span><span> </span><span>p4</span><span> </span><span>e11</span><span> </span><span>e12</span><span> </span><span>b1</span><span> </span><span>b2</span><span> </span><span>b3</span><span> </span><span>b4</span><span> </span><span>b6</span><span> </span><span>b7</span><span> </span><span>b8</span><span> </span><span>b9</span><span> </span><span>b10</span><span> </span><span>b11</span><span> </span><span>b12</span><span> </span><span>p9</span><span> </span><span>p10</span><span> </span><span>p4</span><span>
</span><span>                </span><span>e13</span><span> </span><span>e14</span><span> </span><span>e15</span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc ii &lt; length (?cs2 k) &#8743; (&#915; &#8866; (?cs2 k)!ii -es-((Cmd cmd)&#9839;k)&#8594; (?cs2 k)!(Suc ii)) 
                      &#10230; (gets_es ((?cs2 k)!ii), gets_es ((?cs2 k)!(Suc ii)))&#8712;Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es ((?cs2 k)!ii) k)))&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>pp</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?Pre</span><span> </span><span>k</span><span> </span><span>Rely</span><span> </span><span>Guar</span><span> </span><span>Post</span><span> </span><span class="var">?c2</span><span> </span><span class="var">?pes</span><span> </span><span class="var">?s</span><span> </span><span class="var">?x</span><span> </span><span class="var">?cs2</span><span> </span><span class="var">?pre1</span><span> </span><span>rely1</span><span> </span><span>ii</span><span> </span><span>cmd</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>            </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length (?cs2 k) &#8743; (&#915; &#8866; (?cs2 k)!i -es-((Cmd cmd)&#9839;k)&#8594; (?cs2 k)!(Suc i)) 
                      &#10230; (gets_es ((?cs2 k)!i), gets_es ((?cs2 k)!(Suc i)))&#8712;Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es ((?cs2 k)!i) k)))&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a3</span><span> </span><span>e0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k ! i = (?cs2 k)!(i - n)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_lessD</span><span> </span><span>add_diff_inverse_nat</span><span> </span><span>less_imp_le_nat</span><span> </span><span>not_less_eq</span><span> </span><span>nth_drop</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a3</span><span> </span><span>e0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k ! Suc i = (?cs2 k)!Suc (i - n)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Suc_diff_le</span><span> </span><span>add_diff_inverse_nat</span><span> </span><span>d0</span><span> </span><span>less_Suc_eq_le</span><span> </span><span>less_or_eq_imp_le</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span>e0</span><span> </span><span>a4</span><span> </span><span>c5</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Suc_diff_Suc</span><span> 
</span><span>                </span><span>diff_Suc_Suc</span><span> </span><span>length_drop</span><span> </span><span>less_diff_iff</span><span> </span><span>less_imp_le_nat</span><span class="delimiter">)</span><span> 
</span><span>            
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>act_cpts_es_sat_guar_curevt_new2</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;&#915; &#8866;  esspc sat<span class="hidden">&#8681;</span><sub>s</sub> [pre, rely, guar, post]&#10215;
      &#10233; &#8704;c pes s x cs pre1 rely1 Pre Rely Guar Post k cmd. 
            Pre k &#8838; pre &#8743; Rely k &#8838; rely &#8743; guar &#8838; Guar k &#8743; post &#8838; Post k &#10230;
            c&#8712;cpts_of_pes &#915; pes s x &#8743; &#915; c &#8733; cs &#8743; c&#8712;assume_pes &#915; (pre1, rely1) &#10230;
           (&#8704;k. (cs k) &#8712; cpts_of_es &#915; (pes k) s x)  &#10230; 
           (&#8704;k. cs k &#8712; commit_es &#915; (Guar k, Post k)) &#10230;
           (&#8704;k. pre1 &#8838; Pre k) &#10230;
           (&#8704;k. rely1 &#8838; Rely k) &#10230;
           (&#8704;k j. j &#8800; k &#10230; Guar j &#8838; Rely k) &#10230;
           evtsys_spec esspc = getspc_es (cs k!0) &#10230;
           (&#8704;e&#8712;all_evts_es esspc. is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> e)) &#10230;
           (&#8704;e&#8712;all_evts_es esspc. the ((evtrgfs::(&#39;l,&#39;k,&#39;s,&#39;prog) event &#8658; &#39;s rgformula option) (E<span class="hidden">&#8681;</span><sub>e</sub> e)) = snd e) &#10230;
           (&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. &#915; &#8866; c!j-pes-actk&#8594;c!Suc j)) &#10230;
          (&#8704;i. Suc i &lt; length (cs k) &#8743; (&#915; &#8866; (cs k)!i -es-((Cmd cmd)&#9839;k)&#8594; (cs k)!(Suc i)) 
                &#10230; (gets_es ((cs k)!i), gets_es ((cs k)!(Suc i)))&#8712;Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es ((cs k)!i) k))))&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>rghoare_es.induct</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>esspc</span><span> </span><span>pre</span><span> </span><span>rely</span><span> </span><span>guar</span><span> </span><span>post</span><span class="delimiter">]</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span> </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*proof of EvtSeq e es*)</span></span></span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>ef</span><span> </span><span>esf</span><span> </span><span>prea</span><span> </span><span>posta</span><span> </span><span>relya</span><span> </span><span>guara</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; esspc sat<span class="hidden">&#8681;</span><sub>s</sub> [pre, rely, guar, post]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; E<span class="hidden">&#8681;</span><sub>e</sub> (ef::(&#39;l,&#39;k,&#39;s,&#39;prog) rgformula_e) sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre<span class="hidden">&#8681;</span><sub>e</sub> ef, Rely<span class="hidden">&#8681;</span><sub>e</sub> ef, Guar<span class="hidden">&#8681;</span><sub>e</sub> ef, Post<span class="hidden">&#8681;</span><sub>e</sub> ef]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; fst (esf::(&#39;l,&#39;k,&#39;s,&#39;prog) rgformula_es) sat<span class="hidden">&#8681;</span><sub>s</sub> 
                  [Pre<span class="hidden">&#8681;</span><sub>f</sub> (snd esf), Rely<span class="hidden">&#8681;</span><sub>f</sub> (snd esf), Guar<span class="hidden">&#8681;</span><sub>f</sub> (snd esf), Post<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;c pes s x cs pre1 rely1 Pre Rely Guar Post k cmd.
          Pre k &#8838; Pre<span class="hidden">&#8681;</span><sub>f</sub> (snd esf) &#8743; Rely k &#8838; Rely<span class="hidden">&#8681;</span><sub>f</sub> (snd esf) 
            &#8743; Guar<span class="hidden">&#8681;</span><sub>f</sub> (snd esf) &#8838; Guar k &#8743; Post<span class="hidden">&#8681;</span><sub>f</sub> (snd esf) &#8838; Post k &#10230;
          c &#8712; cpts_of_pes &#915; pes s x &#8743; &#915; c &#8733; cs &#8743; c &#8712; assume_pes &#915; (pre1, rely1) &#10230;
          (&#8704;k. cs k &#8712; cpts_of_es &#915; (pes k) s x) &#10230;
          (&#8704;k. cs k &#8712; commit_es &#915; (Guar k, Post k)) &#10230;
          (&#8704;k. pre1 &#8838; Pre k) &#10230;
          (&#8704;k. rely1 &#8838; Rely k) &#10230;
          (&#8704;k j. j &#8800; k &#10230; Guar j &#8838; Rely k) &#10230;
          evtsys_spec (fst esf) = getspc_es (cs k ! 0) &#10230;
          (&#8704;e&#8712;all_evts_es (fst esf). is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> e)) &#10230;
          (&#8704;e&#8712;all_evts_es (fst esf). the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> e)) = snd e) &#10230;
          (&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. &#915; &#8866; c ! j -pes-actk&#8594; c ! Suc j)) &#10230;
          (&#8704;i. Suc i &lt; length (cs k) &#8743; &#915; &#8866; cs k ! i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc i &#10230;
               (gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k))))&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;prea = Pre<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;posta = Post<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;relya &#8838; Rely<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;relya &#8838; Rely<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Guar<span class="hidden">&#8681;</span><sub>e</sub> ef &#8838; guara&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Guar<span class="hidden">&#8681;</span><sub>f</sub> (snd esf) &#8838; guara&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Post<span class="hidden">&#8681;</span><sub>e</sub> ef &#8838; Pre<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p11</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (rgf_EvtSeq ef esf) sat<span class="hidden">&#8681;</span><sub>s</sub> [prea, relya, guara, posta]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>EvtSeq_h</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>ef</span><span> </span><span>esf</span><span> </span><span>prea</span><span> </span><span>posta</span><span> </span><span>relya</span><span> </span><span>guara</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>c</span><span> </span><span>pes</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>cs</span><span> </span><span>pre1</span><span> </span><span>rely1</span><span> </span><span>Pre</span><span> </span><span>Rely</span><span> </span><span>Guar</span><span> </span><span>Post</span><span> </span><span>k</span><span> </span><span>cmd</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Pre k &#8838; prea &#8743; Rely k &#8838; relya &#8743; guara &#8838; Guar k &#8743; posta &#8838; Post k&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; cpts_of_pes &#915; pes s x &#8743; &#915; c &#8733; cs &#8743; c &#8712; assume_pes &#915; (pre1, rely1)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;k. cs k &#8712; cpts_of_es &#915; (pes k) s x)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;k. cs k &#8712; commit_es &#915; (Guar k, Post k))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;k. pre1 &#8838; Pre k)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;k. rely1 &#8838; Rely k)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;k j. j &#8800; k &#10230; Guar j &#8838; Rely k)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;evtsys_spec (rgf_EvtSeq ef esf) = getspc_es (cs k ! 0)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;e&#8712;all_evts_es (rgf_EvtSeq ef esf). is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> e))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;e&#8712;all_evts_es (rgf_EvtSeq ef esf). the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> e)) = snd e)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. &#915; &#8866; c ! j -pes-actk&#8594; c ! Suc j))&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length (cs k) &#8743; &#915; &#8866; cs k ! i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc i &#10230;
               (gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k)))&quot;</span></span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>p3</span><span> </span><span>p4</span><span> </span><span>p5</span><span> </span><span>p6</span><span> </span><span>p7</span><span> </span><span>p8</span><span> </span><span>p9</span><span> </span><span>p10</span><span> </span><span>act_cpts_evtseq_sat_guar_curevt_new2</span><span>
</span><span>          </span><span class="delimiter">[</span><span>of</span><span> </span><span>ef</span><span> </span><span>esf</span><span> </span><span>prea</span><span> </span><span>posta</span><span> </span><span>relya</span><span> </span><span>guara</span><span> </span><span>Pre</span><span> </span><span>k</span><span> </span><span>Rely</span><span> </span><span>Guar</span><span> 
</span><span>              </span><span>Post</span><span> </span><span>c</span><span> </span><span>pes</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>cs</span><span> </span><span>pre1</span><span> </span><span>rely1</span><span> </span><span>evtrgfs</span><span> </span><span>cmd</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;c pes s x cs pre1 rely1 Pre Rely Guar Post k cmd.
          Pre k &#8838; prea &#8743; Rely k &#8838; relya &#8743; guara &#8838; Guar k &#8743; posta &#8838; Post k &#10230;
          c &#8712; cpts_of_pes &#915; pes s x &#8743; &#915; c &#8733; cs &#8743; c &#8712; assume_pes &#915; (pre1, rely1) &#10230;
          (&#8704;k. cs k &#8712; cpts_of_es &#915; (pes k) s x) &#10230;
          (&#8704;k. cs k &#8712; commit_es &#915; (Guar k, Post k)) &#10230;
          (&#8704;k. pre1 &#8838; Pre k) &#10230;
          (&#8704;k. rely1 &#8838; Rely k) &#10230;
          (&#8704;k j. j &#8800; k &#10230; Guar j &#8838; Rely k) &#10230;
          evtsys_spec (rgf_EvtSeq ef esf) = getspc_es (cs k ! 0) &#10230;
          (&#8704;e&#8712;all_evts_es (rgf_EvtSeq ef esf). is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> e)) &#10230;
          (&#8704;e&#8712;all_evts_es (rgf_EvtSeq ef esf). the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> e)) = snd e) &#10230;
          (&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. &#915; &#8866; c ! j -pes-actk&#8594; c ! Suc j)) &#10230;
          (&#8704;i. Suc i &lt; length (cs k) &#8743; &#915; &#8866; cs k ! i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc i &#10230;
               (gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k))))&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span class="keyword1"><span class="command">next</span></span><span> </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*proof of EvtSys es*)</span></span></span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>esf</span><span> </span><span>prea</span><span> </span><span>relya</span><span> </span><span>guara</span><span> </span><span>posta</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; esspc sat<span class="hidden">&#8681;</span><sub>s</sub> [pre, rely, guar, post]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;(esf::(&#39;l,&#39;k,&#39;s,&#39;prog) rgformula_e set). &#915; &#8866; E<span class="hidden">&#8681;</span><sub>e</sub> ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre<span class="hidden">&#8681;</span><sub>e</sub> ef, Rely<span class="hidden">&#8681;</span><sub>e</sub> ef, Guar<span class="hidden">&#8681;</span><sub>e</sub> ef, Post<span class="hidden">&#8681;</span><sub>e</sub> ef]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;esf. prea &#8838; Pre<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;esf. relya &#8838; Rely<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;esf. Guar<span class="hidden">&#8681;</span><sub>e</sub> ef &#8838; guara&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;esf. Post<span class="hidden">&#8681;</span><sub>e</sub> ef &#8838; posta&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef1 ef2. ef1 &#8712; esf &#8743; ef2 &#8712; esf &#10230; Post<span class="hidden">&#8681;</span><sub>e</sub> ef1 &#8838; Pre<span class="hidden">&#8681;</span><sub>e</sub> ef2&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;stable_e prea relya&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s. (s, s) &#8712; guara&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; rgf_EvtSys esf sat<span class="hidden">&#8681;</span><sub>s</sub> [prea, relya, guara, posta]&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>EvtSys_h</span><span class="delimiter">[</span><span>of</span><span> </span><span>esf</span><span> </span><span>&#915;</span><span> </span><span>prea</span><span> </span><span>relya</span><span> </span><span>guara</span><span> </span><span>posta</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>c</span><span> </span><span>pes</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>cs</span><span> </span><span>pre1</span><span> </span><span>rely1</span><span> </span><span>Pre</span><span> </span><span>Rely</span><span> </span><span>Guar</span><span> </span><span>Post</span><span> </span><span>k</span><span> </span><span>cmd</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Pre k &#8838; prea &#8743; Rely k &#8838; relya &#8743; guara &#8838; Guar k &#8743; posta &#8838; Post k&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; cpts_of_pes &#915; pes s x &#8743; &#915; c &#8733; cs &#8743; c &#8712; assume_pes &#915; (pre1, rely1)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;k. cs k &#8712; cpts_of_es &#915; (pes k) s x)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;k. (cs k)&#8712;commit_es &#915; (Guar k, Post k))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;k. pre1 &#8838; Pre k)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;k. rely1 &#8838; Rely k)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;k j. j &#8800; k &#10230; Guar j &#8838; Rely k)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;evtsys_spec (rgf_EvtSys esf) = getspc_es (cs k ! 0)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;e&#8712;all_evts_es (rgf_EvtSys esf). is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> e))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;e&#8712;all_evts_es (rgf_EvtSys esf). the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> e)) = snd e)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. &#915; &#8866; c ! j -pes-actk&#8594; c ! Suc j))&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b7</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;es. evtsys_spec (rgf_EvtSys esf) = EvtSys es&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtsys_spec_evtsys</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>es</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>b11</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;evtsys_spec (rgf_EvtSys esf) = EvtSys es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a9</span><span> </span><span>b0</span><span> </span><span>b1</span><span> </span><span>b2</span><span> </span><span>b3</span><span> </span><span>b4</span><span> </span><span>b5</span><span> </span><span>b6</span><span> </span><span>b7</span><span> </span><span>b8</span><span> </span><span>b9</span><span> </span><span>b10</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length (cs k) &#8743; &#915; &#8866; cs k ! i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc i &#10230;
               (gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k)))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>act_cpts_evtsys_sat_guar_curevt_gen0_new2</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rgf_EvtSys esf&quot;</span></span></span><span> </span><span>prea</span><span> 
</span><span>            </span><span>relya</span><span> </span><span>guara</span><span> </span><span>posta</span><span> </span><span>Pre</span><span> </span><span>k</span><span> </span><span>Rely</span><span> </span><span>Guar</span><span> </span><span>Post</span><span> </span><span>c</span><span> </span><span>pes</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>cs</span><span> </span><span>pre1</span><span> </span><span>rely1</span><span> </span><span>es</span><span> </span><span>evtrgfs</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;c pes s x cs pre1 rely1 Pre Rely Guar Post k cmd.
          Pre k &#8838; prea &#8743; Rely k &#8838; relya &#8743; guara &#8838; Guar k &#8743; posta &#8838; Post k &#10230;
          c &#8712; cpts_of_pes &#915; pes s x &#8743; &#915; c &#8733; cs &#8743; c &#8712; assume_pes &#915; (pre1, rely1) &#10230;
          (&#8704;k. cs k &#8712; cpts_of_es &#915; (pes k) s x) &#10230;
          (&#8704;k. (cs k)&#8712;commit_es &#915; (Guar k, Post k)) &#10230;
          (&#8704;k. pre1 &#8838; Pre k) &#10230;
          (&#8704;k. rely1 &#8838; Rely k) &#10230;
          (&#8704;k j. j &#8800; k &#10230; Guar j &#8838; Rely k) &#10230;
          evtsys_spec (rgf_EvtSys esf) = getspc_es (cs k ! 0) &#10230;
          (&#8704;e&#8712;all_evts_es (rgf_EvtSys esf). is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> e)) &#10230;
          (&#8704;e&#8712;all_evts_es (rgf_EvtSys esf). the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> e)) = snd e) &#10230;
          (&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. &#915; &#8866; c ! j -pes-actk&#8594; c ! Suc j)) &#10230;
          (&#8704;i. Suc i &lt; length (cs k) &#8743; &#915; &#8866; cs k ! i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc i &#10230;
               (gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k))))&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span> </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*proof of conseq*)</span></span></span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>prea</span><span> </span><span>pre&#39;</span><span> </span><span>relya</span><span> </span><span>rely&#39;</span><span> </span><span>guar&#39;</span><span> </span><span>guara</span><span> </span><span>post&#39;</span><span> </span><span>posta</span><span> </span><span>esys</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; esspc sat<span class="hidden">&#8681;</span><sub>s</sub> [pre, rely, guar, post]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;prea &#8838; pre&#39;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;relya &#8838; rely&#39;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;guar&#39; &#8838; guara&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;post&#39; &#8838; posta&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; esys sat<span class="hidden">&#8681;</span><sub>s</sub> [pre&#39;, rely&#39;, guar&#39;, post&#39;]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a6</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;c pes s x cs pre1 rely1 Pre Rely Guar Post k cmd.
          Pre k &#8838; pre&#39; &#8743; Rely k &#8838; rely&#39; &#8743; guar&#39; &#8838; Guar k &#8743; post&#39; &#8838; Post k &#10230;
          c &#8712; cpts_of_pes &#915; pes s x &#8743; &#915; c &#8733; cs &#8743; c &#8712; assume_pes &#915; (pre1, rely1) &#10230;
          (&#8704;k. cs k &#8712; cpts_of_es &#915; (pes k) s x) &#10230;
          (&#8704;k. (cs k)&#8712;commit_es &#915; (Guar k, Post k)) &#10230;
          (&#8704;k. pre1 &#8838; Pre k) &#10230;
          (&#8704;k. rely1 &#8838; Rely k) &#10230;
          (&#8704;k j. j &#8800; k &#10230; Guar j &#8838; Rely k) &#10230;
          evtsys_spec esys = getspc_es (cs k ! 0) &#10230;
          (&#8704;e&#8712;all_evts_es esys. is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> e)) &#10230;
          (&#8704;e&#8712;all_evts_es esys. the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> e)) = snd e) &#10230;
          (&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. &#915; &#8866; c ! j -pes-actk&#8594; c ! Suc j)) &#10230;
          (&#8704;i. Suc i &lt; length (cs k) &#8743; &#915; &#8866; cs k ! i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc i &#10230;
               (gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k))))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>c</span><span> </span><span>pes</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>cs</span><span> </span><span>pre1</span><span> </span><span>rely1</span><span> </span><span>Pre</span><span> </span><span>Rely</span><span> </span><span>Guar</span><span> </span><span>Post</span><span> </span><span>k</span><span> </span><span>cmd</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Pre k &#8838; prea &#8743; Rely k &#8838; relya &#8743; guara &#8838; Guar k &#8743; posta &#8838; Post k&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; cpts_of_pes &#915; pes s x &#8743; &#915; c &#8733; cs &#8743; c &#8712; assume_pes &#915; (pre1, rely1)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;k. cs k &#8712; cpts_of_es &#915; (pes k) s x)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;k. (cs k)&#8712;commit_es &#915; (Guar k, Post k))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;k. pre1 &#8838; Pre k)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;k. rely1 &#8838; Rely k)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;k j. j &#8800; k &#10230; Guar j &#8838; Rely k)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;evtsys_spec esys = getspc_es (cs k ! 0)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;e&#8712;all_evts_es esys. is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> e))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;e&#8712;all_evts_es esys. the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> e)) = snd e)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. &#915; &#8866; c ! j -pes-actk&#8594; c ! Suc j))&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Pre k &#8838; pre&#39; &#8743; Rely k &#8838; rely&#39; &#8743; guar&#39; &#8838; Guar k &#8743; post&#39; &#8838; Post k&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a5</span><span> </span><span>a6</span><span class="delimiter">[</span><span>of</span><span> </span><span>Pre</span><span> </span><span>k</span><span> </span><span>Rely</span><span> </span><span>Guar</span><span> </span><span>Post</span><span> </span><span>c</span><span> </span><span>pes</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>cs</span><span> </span><span>pre1</span><span> </span><span>rely1</span><span class="delimiter">]</span><span> </span><span>b0</span><span> </span><span>b1</span><span> </span><span>b2</span><span> </span><span>b3</span><span> </span><span>b4</span><span> </span><span>b5</span><span> </span><span>b6</span><span> </span><span>b7</span><span> </span><span>b8</span><span> </span><span>b9</span><span> </span><span>b10</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length (cs k) &#8743; &#915; &#8866; cs k ! i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc i &#10230;
               (gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k)))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;c pes s x cs pre1 rely1 Pre Rely Guar Post k cmd.
          Pre k &#8838; prea &#8743; Rely k &#8838; relya &#8743; guara &#8838; Guar k &#8743; posta &#8838; Post k &#10230;
          c &#8712; cpts_of_pes &#915; pes s x &#8743; &#915; c &#8733; cs &#8743; c &#8712; assume_pes &#915; (pre1, rely1) &#10230;
          (&#8704;k. cs k &#8712; cpts_of_es &#915; (pes k) s x) &#10230;
          (&#8704;k. (cs k)&#8712;commit_es &#915; (Guar k, Post k)) &#10230;
          (&#8704;k. pre1 &#8838; Pre k) &#10230;
          (&#8704;k. rely1 &#8838; Rely k) &#10230;
          (&#8704;k j. j &#8800; k &#10230; Guar j &#8838; Rely k) &#10230;
          evtsys_spec esys = getspc_es (cs k ! 0) &#10230;
          (&#8704;e&#8712;all_evts_es esys. is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> e)) &#10230;
          (&#8704;e&#8712;all_evts_es esys. the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> e)) = snd e) &#10230;
          (&#8704;j. Suc j &lt; length c &#10230; (&#8707;actk. &#915; &#8866; c ! j -pes-actk&#8594; c ! Suc j)) &#10230;
          (&#8704;i. Suc i &lt; length (cs k) &#8743; &#915; &#8866; cs k ! i -es-Cmd cmd&#9839;k&#8594; cs k ! Suc i &#10230;
               (gets_es (cs k ! i), gets_es (cs k ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es (cs k ! i) k))))&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>act_cptpes_sat_guar_curevt_new2</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;&#915; &#8866; (pesf::(&#39;l,&#39;k,&#39;s,&#39;prog) rgformula_par) SAT [pre, {}, UNIV, post]&#10215; &#10233; 
      s0&#8712;pre &#10230;
      (&#8704;ef&#8712;all_evts pesf. is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> ef)) &#10230;
      (&#8704;erg&#8712;all_evts pesf. the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> erg)) = snd erg) &#10230;
      pesl&#8712;cpts_of_pes &#915; (paresys_spec pesf) s0 x0 &#10230;
      (&#8704;j. Suc j &lt; length pesl &#10230; (&#8707;actk. &#915; &#8866; pesl!j-pes-actk&#8594;pesl!Suc j)) &#10230;
      (&#8704;k i. Suc i &lt;length pesl &#10230; (&#8707;c. (&#915; &#8866; pesl!i -pes-((Cmd c)&#9839;k)&#8594; pesl!(Suc i)))
          &#10230; (gets (pesl!i),gets (pesl!Suc i))&#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx (pesl!i) k))))&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>rghoare_pes.induct</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>pesf</span><span> </span><span>pre</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;{}&quot;</span></span></span><span> </span><span>UNIV</span><span> </span><span>post</span><span class="delimiter">]</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span><span> </span><span>2</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>pesfa</span><span> </span><span>prea</span><span> </span><span>rely</span><span> </span><span>guar</span><span> </span><span>posta</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; pesf SAT [pre, {}, UNIV, post]&quot;</span></span></span><span>
</span><span>       </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. &#915; &#8866; fst ((pesfa::(&#39;l,&#39;k,&#39;s,&#39;prog) rgformula_par) k) 
                        sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesfa k), Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesfa k), Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesfa k), Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesfa k)]&quot;</span></span></span><span>
</span><span>       </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. prea &#8838; Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesfa k)&quot;</span></span></span><span>
</span><span>       </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. rely &#8838; Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesfa k)&quot;</span></span></span><span>
</span><span>       </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k j. j &#8800; k &#10230; Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesfa j) &#8838; Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesfa k)&quot;</span></span></span><span>
</span><span>       </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesfa k) &#8838; guar&quot;</span></span></span><span>
</span><span>       </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesfa k) &#8838; posta&quot;</span></span></span><span>
</span><span>    
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;s0 &#8712; prea &#10230;
          (&#8704;ef&#8712;all_evts pesfa. is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> ef)) &#10230;
          (&#8704;erg&#8712;all_evts pesfa. the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> erg)) = snd erg) &#10230;
          pesl &#8712; cpts_of_pes &#915; (paresys_spec pesfa) s0 x0 &#10230;
       (&#8704;j. Suc j &lt; length pesl &#10230; (&#8707;actk. &#915; &#8866; pesl ! j -pes-actk&#8594; pesl ! Suc j)) &#10230;
       (&#8704;k i. Suc i &lt; length pesl &#10230;
              (&#8707;c. &#915; &#8866; pesl ! i -pes-Cmd c&#9839;k&#8594; pesl ! Suc i) &#10230;
              (gets (pesl ! i), gets (pesl ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx (pesl ! i) k))))&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;pesl &#8712; cpts_of_pes &#915; (paresys_spec pesfa) s0 x0&quot;</span></span></span><span>
</span><span>          </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. Suc j &lt; length pesl &#10230; (&#8707;actk. &#915; &#8866; pesl ! j -pes-actk&#8594; pesl ! Suc j)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;all_evts pesfa. is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> ef)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;erg&#8712;all_evts pesfa. the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> erg)) = snd erg&quot;</span></span></span><span>
</span><span>          </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;s0 &#8712; prea&quot;</span></span></span><span>
</span><span>        
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;pesl&#8712;cpts_pes &#915; &#8743; pesl!0 = (paresys_spec pesfa, s0, x0)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>cpts_of_pes_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?pes</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;paresys_spec pesfa&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;cs. (&#8704;k. (cs k) &#8712; cpts_of_es &#915; (?pes k) s0 x0) &#8743; &#915; pesl &#8733; cs&quot;</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>par_evtsys_semantics_comp</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="var">?pes</span><span> </span><span>s0</span><span> </span><span>x0</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>cs</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>b6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;k. (cs k) &#8712; cpts_of_es &#915; (?pes k) s0 x0) &#8743; &#915; pesl &#8733; cs&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. length (cs k) = length pesl&quot;</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>conjoin_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>pesl</span><span> </span><span>cs</span><span class="delimiter">]</span><span> </span><span>same_length_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>pesl</span><span> </span><span>cs</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;pesl&#8712;assume_pes &#915; (prea,rely)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets (paresys_spec pesfa, s0, x0) &#8712; prea&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>gets_def</span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fst_conv</span><span> </span><span>snd_conv</span><span class="delimiter">)</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length pesl &#10230; &#172;(&#915; &#8866; pesl ! i -pese&#8594; pesl ! Suc i)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>pes_tran_not_etran1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>            </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>b5</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_pes_def</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>        </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>k</span><span> </span><span>i</span><span>
</span><span>          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length pesl&quot;</span></span></span><span>
</span><span>            </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;c. &#915; &#8866; pesl ! i -pes-Cmd c&#9839;k&#8594; pesl ! Suc i&quot;</span></span></span><span>
</span><span>          
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c1</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>c</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; pesl ! i -pes-Cmd c&#9839;k&#8594; pesl ! Suc i&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#915; &#8866; (pesl!i) -pese&#8594; (pesl!Suc i))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>pes_tran_not_etran1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b6</span><span> </span><span>c0</span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;k t. (&#915; &#8866; pesl ! i -pes-t&#9839;k&#8594; pesl ! Suc i) &#10230;
                 (&#915; &#8866; cs k ! i -es-t&#9839;k&#8594; cs k ! Suc i) &#8743; (&#8704;k&#39;. k&#39; &#8800; k &#10230; &#915; &#8866; cs k&#39; ! i -ese&#8594; cs k&#39; ! Suc i))&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>conjoin_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>pesl</span><span> </span><span>cs</span><span class="delimiter">]</span><span> </span><span>compat_tran_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>pesl</span><span> </span><span>cs</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915; &#8866; cs k!i -es-(Cmd c&#9839;k)&#8594; cs k! Suc i) &#8743;
                           (&#8704;k&#39;. k&#39; &#8800; k &#10230; (&#915; &#8866; cs k&#39;!i -ese&#8594; cs k&#39;! Suc i))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c0</span><span> </span><span>b6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets (pesl!i) = gets_es ((cs k)!i) &#8743; getx (pesl!i) = getx_es ((cs k)!i)&quot;</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>conjoin_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>pesl</span><span> </span><span>cs</span><span class="delimiter">]</span><span> </span><span>same_state_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>pesl</span><span> </span><span>cs</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c0</span><span> </span><span>b6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets (pesl!Suc i) = gets_es ((cs k)!Suc i) 
                                &#8743; getx (pesl!Suc i) = getx_es ((cs k)!Suc i)&quot;</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>conjoin_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>pesl</span><span> </span><span>cs</span><span class="delimiter">]</span><span> </span><span>same_state_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>pesl</span><span> </span><span>cs</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; fst (pesfa k) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesfa k), Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesfa k), Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesfa k), Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesfa k)]&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. &#915; &#8872; paresys_spec pesfa k sat<span class="hidden">&#8681;</span><sub>s</sub> [(Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> &#8728; pesfa) k, (Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> &#8728; pesfa) k, 
                          (Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> &#8728; pesfa) k, (Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> &#8728; pesfa) k]&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>paresys_spec_def</span><span> </span><span>rgsound_es</span><span class="delimiter">)</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b5</span><span> </span><span>b6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;evtsys_spec (fst (pesfa k)) = getspc_es (cs k ! 0)&quot;</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>conjoin_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>pesl</span><span> </span><span>cs</span><span class="delimiter">]</span><span> </span><span>same_spec_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>pesl</span><span> </span><span>cs</span><span class="delimiter">]</span><span> </span><span>paresys_spec_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>pesfa</span><span class="delimiter">]</span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>c0</span><span> </span><span>dual_order.strict_trans</span><span> </span><span>fst_conv</span><span> </span><span>getspc_def</span><span> </span><span>zero_less_Suc</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;e. e &#8712; all_evts_es (fst (pesfa k)) &#10230; is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> e)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>all_evts_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>pesfa</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;e. e &#8712; all_evts_es (fst (pesfa k)) &#10230; the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> e)) = snd e&quot;</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>all_evts_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>pesfa</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. cs k &#8712; commit_es &#915; ((Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> &#8728; pesfa) k, (Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> &#8728; pesfa) k)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. cs k &#8712; assume_es &#915; ((Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> &#8728; pesfa) k, (Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> &#8728; pesfa) k)&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>conjoin_es_sat_assume</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;paresys_spec pesfa&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> &#8728; pesfa&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> &#8728; pesfa&quot;</span></span></span><span>
</span><span>                   </span><span class="string"><span class="delete"><span class="delete">&quot;Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> &#8728; pesfa&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> &#8728; pesfa&quot;</span></span></span><span> </span><span>prea</span><span> </span><span>rely</span><span> </span><span>pesl</span><span> </span><span>s0</span><span> </span><span>x0</span><span> </span><span>cs</span><span class="delimiter">]</span><span> </span><span>c7</span><span> </span><span>a5</span><span> </span><span>a6</span><span> </span><span>a7</span><span> </span><span>b0</span><span> </span><span>b6</span><span> </span><span>b8</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c7</span><span> </span><span>c8</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>paresys_spec_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>pesfa</span><span class="delimiter">]</span><span>
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>IntI</span><span> </span><span>b6</span><span> </span><span>contra_subsetD</span><span> </span><span>cpts_of_es_def</span><span> </span><span>es_validity_def</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">ultimately</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es ((cs k)!i), gets_es ((cs k)!(Suc i)))&#8712;Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx_es ((cs k)!i) k)))&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>act_cpts_es_sat_guar_curevt_new2</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (pesfa k)&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesfa k)&quot;</span></span></span><span> 
</span><span>                  </span><span class="string"><span class="delete"><span class="delete">&quot;Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesfa k)&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesfa k)&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesfa k)&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> &#8728; pesfa&quot;</span></span></span><span> </span><span>k</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> &#8728; pesfa&quot;</span></span></span><span>
</span><span>                  </span><span class="string"><span class="delete"><span class="delete">&quot;Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> &#8728; pesfa&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> &#8728; pesfa&quot;</span></span></span><span> </span><span>pesl</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;paresys_spec pesfa&quot;</span></span></span><span> </span><span>s0</span><span> </span><span>x0</span><span> </span><span>cs</span><span> </span><span>prea</span><span> </span><span>rely</span><span> </span><span>evtrgfs</span><span> </span><span>i</span><span> </span><span>c</span><span class="delimiter">]</span><span>
</span><span>                   </span><span>a5</span><span> </span><span>a6</span><span> </span><span>a7</span><span> </span><span>a8</span><span> </span><span>a9</span><span> </span><span>b0</span><span> </span><span>b1</span><span> </span><span>b4</span><span> </span><span>b6</span><span> </span><span>b8</span><span> </span><span>c4</span><span> </span><span>c0</span><span> </span><span>b7</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            
</span><span>          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c5</span><span> </span><span>c6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets (pesl ! i), gets (pesl ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx (pesl ! i) k)))&quot;</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k i. Suc i &lt; length pesl &#10230;
              (&#8707;c. &#915; &#8866; pesl ! i -pes-Cmd c&#9839;k&#8594; pesl ! Suc i) &#10230;
              (gets (pesl ! i), gets (pesl ! Suc i)) &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx (pesl ! i) k)))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*declare [[show_types]]*)</span></span></span></span></span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*
locale RG_Property = 
  event_hoare ptran petran fin_com cpts_p cpts_of_p 
     prog_validity assume_p commit_p rghoare_p
+ InfoFlow  ptran petran fin_com &#915; C0 step interference vpeq obs dome
  for ptran :: &quot;&#39;Env &#8658; ((&#39;prog &#215; &#39;s) &#215; &#39;prog &#215; &#39;s) set&quot; 
  and petran :: &quot;&#39;Env &#8658; (&#39;s,&#39;prog) pconf &#8658; (&#39;s,&#39;prog) pconf &#8658; bool&quot;   (&quot;_ &#8866; _ -pe&#8594; _&quot; [81,81,81] 80)
  and fin_com :: &quot;&#39;prog&quot;
  and cpts_p :: &quot;&#39;Env &#8658; (&#39;s,&#39;prog) pconfs set&quot;
  and cpts_of_p :: &quot;&#39;Env &#8658; &#39;prog &#8658; &#39;s &#8658; ((&#39;s,&#39;prog) pconfs) set&quot;
  and prog_validity :: &quot;&#39;Env &#8658; &#39;prog &#8658; &#39;s set &#8658; (&#39;s &#215; &#39;s) set &#8658; (&#39;s &#215; &#39;s) set &#8658; &#39;s set &#8658; bool&quot; 
                   (&quot;_ &#8872; _ sat<span class="hidden">&#8681;</span><sub>p</sub> [_, _, _, _]&quot; [60,60,0,0,0,0] 45)
  and assume_p :: &quot;&#39;Env &#8658; (&#39;s set &#215; (&#39;s &#215; &#39;s) set) &#8658; ((&#39;s,&#39;prog) pconfs) set&quot;
  and commit_p :: &quot;&#39;Env &#8658; ((&#39;s &#215; &#39;s) set &#215; &#39;s set) &#8658; ((&#39;s,&#39;prog) pconfs) set&quot;
  and rghoare_p :: &quot;&#39;Env &#8658; [&#39;prog, &#39;s set, (&#39;s &#215; &#39;s) set, (&#39;s &#215; &#39;s) set, &#39;s set] &#8658; bool&quot;
      (&quot;_ &#8866; _ sat<span class="hidden">&#8681;</span><sub>p</sub> [_, _, _, _]&quot; [60,60,0,0,0,0] 45)
  and &#915; :: &#39;Env
  and C0  ::  &quot;(&#39;l,&#39;k,&#39;s,&#39;prog) pesconf&quot;
  and step :: &quot;(&#39;l,&#39;k,&#39;s,&#39;prog,&#39;d) action &#8658; ((&#39;l,&#39;k,&#39;s,&#39;prog) pesconf &#215; (&#39;l,&#39;k,&#39;s,&#39;prog) pesconf) set&quot;
  and interference :: &quot;&#39;d &#8658; &#39;d &#8658; bool&quot; (&quot;(_ &#8605; _)&quot; [70,71] 60)
  and vpeq ::  &quot;&#39;s &#8658; &#39;d &#8658; &#39;s &#8658; bool&quot; (&quot;(_ &#8764;_&#8764; _)&quot; [70,69,70] 60)
  and obs ::  &quot;&#39;s &#8658; &#39;d &#8658; &#39;o&quot; (infixl &quot;&#187;&quot;  55)
  and dome :: &quot;&#39;s &#8658; &#39;k &#8658; (&#39;l,&#39;k,&#39;s,&#39;prog) event &#8658; &#39;d&quot;
*)</span></span></span></span></span><span>
</span><span class="keyword1"><span class="command">print_locale</span></span><span> </span><span>RG_Property</span><span>
</span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>RG_InfoFlow</span><span> </span><span class="delimiter">=</span><span> </span><span>RG_Property</span><span> </span><span>ptran</span><span> </span><span>petran</span><span> </span><span>fin_com</span><span> </span><span>cpts_p</span><span> </span><span>cpts_of_p</span><span> 
</span><span>    </span><span>prog_validity</span><span> </span><span>assume_p</span><span> </span><span>commit_p</span><span> </span><span>rghoare_p</span><span> </span><span>&#915;</span><span> </span><span>C0</span><span> </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*step*)</span></span></span></span></span><span> </span><span>interference</span><span> </span><span>vpeq</span><span> </span><span>dome</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>ptran</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; ((&#39;prog &#215; &#39;s) &#215; &#39;prog &#215; &#39;s) set&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>petran</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; (&#39;s,&#39;prog) pconf &#8658; (&#39;s,&#39;prog) pconf &#8658; bool&quot;</span></span></span><span>   </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">&quot;_ &#8866; _ -pe&#8594; _&quot;</span></span></span><span> </span><span class="delimiter">[</span><span>81</span><span class="delimiter">,</span><span>81</span><span class="delimiter">,</span><span>81</span><span class="delimiter">]</span><span> </span><span>80</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>fin_com</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;prog&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>cpts_p</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; (&#39;s,&#39;prog) pconfs set&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>cpts_of_p</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; &#39;prog &#8658; &#39;s &#8658; ((&#39;s,&#39;prog) pconfs) set&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>prog_validity</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; &#39;prog &#8658; &#39;s set &#8658; (&#39;s &#215; &#39;s) set &#8658; (&#39;s &#215; &#39;s) set &#8658; &#39;s set &#8658; bool&quot;</span></span></span><span> 
</span><span>                   </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">&quot;_ &#8872; _ sat<span class="hidden">&#8681;</span><sub>p</sub> [_, _, _, _]&quot;</span></span></span><span> </span><span class="delimiter">[</span><span>60</span><span class="delimiter">,</span><span>60</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">]</span><span> </span><span>45</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>assume_p</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; (&#39;s set &#215; (&#39;s &#215; &#39;s) set) &#8658; ((&#39;s,&#39;prog) pconfs) set&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>commit_p</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; ((&#39;s &#215; &#39;s) set &#215; &#39;s set) &#8658; ((&#39;s,&#39;prog) pconfs) set&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>rghoare_p</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; [&#39;prog, &#39;s set, (&#39;s &#215; &#39;s) set, (&#39;s &#215; &#39;s) set, &#39;s set] &#8658; bool&quot;</span></span></span><span>
</span><span>      </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">&quot;_ &#8866; _ sat<span class="hidden">&#8681;</span><sub>p</sub> [_, _, _, _]&quot;</span></span></span><span> </span><span class="delimiter">[</span><span>60</span><span class="delimiter">,</span><span>60</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">]</span><span> </span><span>45</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>&#915;</span><span> </span><span class="delimiter">::</span><span> </span><span class="tfree">&#39;Env</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>C0</span><span>  </span><span class="delimiter">::</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;l,&#39;k,&#39;s,&#39;prog) pesconf&quot;</span></span></span><span>
</span><span>  </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*and step :: &quot;(&#39;l,&#39;k,&#39;s,&#39;prog,&#39;d) action &#8658; ((&#39;l,&#39;k,&#39;s,&#39;prog) pesconf &#215; (&#39;l,&#39;k,&#39;s,&#39;prog) pesconf) set&quot;*)</span></span></span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>interference</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;d &#8658; &#39;d &#8658; bool&quot;</span></span></span><span> </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">&quot;(_ &#8605; _)&quot;</span></span></span><span> </span><span class="delimiter">[</span><span>70</span><span class="delimiter">,</span><span>71</span><span class="delimiter">]</span><span> </span><span>60</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>vpeq</span><span> </span><span class="delimiter">::</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;s &#8658; &#39;d &#8658; &#39;s &#8658; bool&quot;</span></span></span><span> </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">&quot;(_ &#8764;_&#8764; _)&quot;</span></span></span><span> </span><span class="delimiter">[</span><span>70</span><span class="delimiter">,</span><span>69</span><span class="delimiter">,</span><span>70</span><span class="delimiter">]</span><span> </span><span>60</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>dome</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;s &#8658; &#39;k &#8658; (&#39;l,&#39;k,&#39;s,&#39;prog) event &#8658; &#39;d&quot;</span></span></span><span>
</span><span>  </span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>pesf</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;l,&#39;k,&#39;s,&#39;prog) rgformula_par&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>s0</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;s&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>x0</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;l,&#39;k,&#39;s,&#39;prog) x&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>evtrgfs</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;l,&#39;k,&#39;s,&#39;prog) event &#8658; &#39;s rgformula option&quot;</span></span></span><span> </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*a set of events and their rg conditions*)</span></span></span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>spec_of_parsys</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;l,&#39;k,&#39;s,&#39;prog) paresys&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>C0_ParSys</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;C0 = (paresys_spec pesf, s0, x0)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span>   </span><span>spec_of_parsys</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;spec_of_parsys = paresys_spec pesf&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span>   </span><span>all_evts_are_basic</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;all_evts pesf. is_basicevt (E<span class="hidden">&#8681;</span><sub>e</sub> ef)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span>   </span><span>parsys_sat_rg</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; pesf SAT [{s0}, {}, UNIV, UNIV]&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span>   </span><span>evt_in_parsys_in_evtrgfs</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;erg&#8712;all_evts pesf. the (evtrgfs (E<span class="hidden">&#8681;</span><sub>e</sub> erg)) = snd erg&quot;</span></span></span><span> 
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>locally_respect_event</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bool&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;locally_respect_event &#8801; &#8704;ef u s1 s2 k. ef&#8712;all_evts pesf &#8743; (s1,s2) &#8712; Guar<span class="hidden">&#8681;</span><sub>e</sub> ef &#10230; 
                                    ((dome s1 k (E<span class="hidden">&#8681;</span><sub>e</sub> ef)) &#8726;&#8605; u &#10230; s1 &#8764;u&#8764; s2)&quot;</span></span></span><span>
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*
definition step_consistent_event :: &quot;bool&quot; where
  &quot;step_consistent_event &#8801; &#8704;ef u s1 s1&#39; s2 s2&#39; k. ef&#8712;all_evts pesf &#8743; (s1,s2) &#8712; Guar<span class="hidden">&#8681;</span><sub>e</sub> ef &#8743; (s1&#39;,s2&#39;) &#8712; Guar<span class="hidden">&#8681;</span><sub>e</sub> ef
                              &#10230; s1 &#8764;u&#8764; s2 &#8743; ((dome s1 k (E<span class="hidden">&#8681;</span><sub>e</sub> ef)) &#8605; u &#10230; s1 &#8764;(dome s1 k (E<span class="hidden">&#8681;</span><sub>e</sub> ef))&#8764; s2)
                              &#10230; s1&#39; &#8764;u&#8764; s2&#39;&quot;
*)</span></span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>step_consistent_event</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bool&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;step_consistent_event &#8801; &#8704;ef u s1 s2 k. ef&#8712;all_evts pesf  
                              &#10230; s1 &#8764;u&#8764; s2 &#8743; ((dome s1 k (E<span class="hidden">&#8681;</span><sub>e</sub> ef)) &#8605; u &#10230; s1 &#8764;(dome s1 k (E<span class="hidden">&#8681;</span><sub>e</sub> ef))&#8764; s2)
                              &#10230; (&#8704;s1&#39; s2&#39;. (s1,s1&#39;) &#8712; Guar<span class="hidden">&#8681;</span><sub>e</sub> ef &#8743; (s2,s2&#39;) &#8712; Guar<span class="hidden">&#8681;</span><sub>e</sub> ef &#10230; s1&#39; &#8764;u&#8764; s2&#39;)&quot;</span></span></span><span>
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*
definition locally_respect :: &quot;bool&quot; where
  &quot;locally_respect &#8801; &#8704;a u C. (reachable0 C) &#10230; ((domain a) &#8726;&#8605; u) &#10230; 
                              (&#8704; C&#39;. (C&#39;&#8712;nextc C a) &#10230; (C &#8764;.u.&#8764; C&#39;))&quot;

definition step_consistent :: &quot;bool&quot; where
  &quot;step_consistent &#8801; &#8704;a u C1 C2. (reachable0 C1) &#8743; (reachable0 C2) &#10230;  (C1 &#8764;.u.&#8764; C2) 
                         &#8743; ( ((domain a) &#8605; u) &#10230; (C1 &#8764;.(domain a).&#8764; C2) ) &#10230; 
                         (&#8704; C1&#39; C2&#39;. (C1&#39;&#8712;nextc C1 a) &#8743; (C2&#39;&#8712;nextc C2 a) &#10230; (C1&#39; &#8764;.u.&#8764; C2&#39;))&quot;
*)</span></span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cpt_is_run</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;c C1 C2. c&#8712;cpts_pes &#915; &#8743; c!0 = C1 &#8743; last c = C2 &#8743; (&#8704;j. Suc j &lt; length c &#10230; &#172;(&#915; &#8866; c!j-pese&#8594;c!Suc j)) 
            &#10230; (&#8707;as.  (C1,C2) &#8712; run as &#8743; Suc (length as) = length c &#8743;
                       (&#8704;j. Suc j &lt; length c &#10230; (&#915; &#8866; c!j-pes-(actk (as!j))&#8594;c!Suc j)) )&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>C2</span><span> </span><span>c</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(c::(&#39;l,&#39;k,&#39;s,&#39;prog) pesconfs)&#8712;cpts_pes &#915;&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;C1. c!0 = C1 &#8743; last c = C2 &#8743; (&#8704;j. Suc j &lt; length c &#10230; &#172;(&#915; &#8866; c!j-pese&#8594;c!Suc j)) 
            &#10230; (&#8707;as.  (C1,C2) &#8712; run as &#8743; Suc (length as) = length c &#8743;
                       (&#8704;j. Suc j &lt; length c &#10230; (&#915; &#8866; c!j-pes-(actk (as!j))&#8594;c!Suc j)) )&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>c</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptsPesOne</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptsPesEnv</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>nth_Cons_Suc</span><span> </span><span>pesetran.intros</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptsPesComp</span><span> </span><span>pes1</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>ct</span><span> </span><span>pes2</span><span> </span><span>t</span><span> </span><span>y</span><span> </span><span>xs</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (pes1, s, x) -pes-ct&#8594; (pes2, t, y)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(pes2, t, y) # xs &#8712; cpts_pes &#915;&quot;</span></span></span><span>
</span><span>          </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b2</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;C1. ((pes2, t, y) # xs) ! 0 = C1 &#8743;
                       last ((pes2, t, y) # xs) = C2 &#8743;
                       (&#8704;j. Suc j &lt; length ((pes2, t, y) # xs) &#10230;
                            &#172; &#915; &#8866; ((pes2, t, y) # xs) ! j -pese&#8594; ((pes2, t, y) # xs) ! Suc j) &#10230;
                       (&#8707;as. (C1, C2) &#8712; run as &#8743;                                        
                             Suc (length as) = length ((pes2, t, y) # xs) &#8743;
                             (&#8704;j. Suc j &lt; length ((pes2, t, y) # xs) &#10230;
                                  &#915; &#8866; ((pes2, t, y) # xs) ! j -pes-actk (as ! j)&#8594; ((pes2, t, y) # xs) ! Suc j))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>          </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>C1</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((pes1, s, x) # (pes2, t, y) # xs) ! 0 = C1&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;last ((pes1, s, x) # (pes2, t, y) # xs) = C2&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;j. Suc j &lt; length ((pes1, s, x) # (pes2, t, y) # xs) &#10230;
              &#172; &#915; &#8866; ((pes1, s, x) # (pes2, t, y) # xs) ! j -pese&#8594; ((pes1, s, x) # (pes2, t, y) # xs) ! Suc j)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;C1 = (pes1, s, x)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?C1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(pes2, t, y)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((pes2, t, y) # xs) ! 0 = ?C1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;last ((pes2, t, y) # xs) = C2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. Suc j &lt; length ((pes2, t, y) # xs) &#10230;
                            &#172; &#915; &#8866; ((pes2, t, y) # xs) ! j -pese&#8594; ((pes2, t, y) # xs) ! Suc j&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_mono</span><span> </span><span>length_Cons</span><span> </span><span>nth_Cons_Suc</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;as. (?C1, C2) &#8712; run as &#8743;
                             Suc (length as) = length ((pes2, t, y) # xs) &#8743;
                             (&#8704;j. Suc j &lt; length ((pes2, t, y) # xs) &#10230;
                                  &#915; &#8866; ((pes2, t, y) # xs) ! j -pes-actk (as ! j)&#8594; ((pes2, t, y) # xs) ! Suc j)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>b2</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?C1</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>as</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(?C1, C2) &#8712; run as &#8743;
                             Suc (length as) = length ((pes2, t, y) # xs) &#8743;
                             (&#8704;j. Suc j &lt; length ((pes2, t, y) # xs) &#10230;
                                  &#915; &#8866; ((pes2, t, y) # xs) ! j -pes-actk (as ! j)&#8594; ((pes2, t, y) # xs) ! Suc j)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>tr</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>k</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ct = tr&#9839;k&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>get_actk_def</span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>actk.cases</span><span class="delimiter">)</span><span> 
</span><span>            
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;as. (C1, C2) &#8712; run as &#8743;
               Suc (length as) = length ((pes1, s, x) # (pes2, t, y) # xs) &#8743;
               (&#8704;j. Suc j &lt; length ((pes1, s, x) # (pes2, t, y) # xs) &#10230;
                    &#915; &#8866; ((pes1, s, x) # (pes2, t, y) # xs) !
                    j -pes-actk (as ! j)&#8594; ((pes1, s, x) # (pes2, t, y) # xs) ! Suc j)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>tr</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Cmd</span><span> </span><span>cmd</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ct = Cmd cmd&#9839;k&quot;</span></span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>a1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;actk (a1::(&#39;l, &#39;k, &#39;s, &#39;prog,&#39;d) action) = ((Cmd cmd)&#9839;k) &#8743; eventof a1 = (getx C1) k 
                                          &#8743; dome (gets C1) k (eventof a1) = domain a1&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>action.select_convs</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>as1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>d2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;as1 = a1#as&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d0</span><span> </span><span>d1</span><span> </span><span>b0</span><span> </span><span>c3</span><span> </span><span>c4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(C1, C2) &#8712; run as1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>run_def</span><span> </span><span>step_def</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>case_prod_conv</span><span> </span><span>mem_Collect_eq</span><span> </span><span>run_Cons</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>                </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d2</span><span> </span><span>c4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc (length as1) = length ((pes1, s, x) # (pes2, t, y) # xs)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c4</span><span> </span><span>b0</span><span> </span><span>d0</span><span> </span><span>d1</span><span> </span><span>d2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. Suc j &lt; length ((pes1, s, x) # (pes2, t, y) # xs) &#10230;
                    &#915; &#8866; ((pes1, s, x) # (pes2, t, y) # xs) !
                    j -pes-actk (as1 ! j)&#8594; ((pes1, s, x) # (pes2, t, y) # xs) ! Suc j&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c3</span><span> </span><span>calculation</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>diff_Suc_1</span><span> </span><span>length_Suc_conv</span><span> </span><span>less_Suc_eq_0_disj</span><span> 
</span><span>                    </span><span>nat.discI</span><span> </span><span>not0_implies_Suc</span><span> </span><span>nth_Cons&#39;</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>EvtEnt</span><span> </span><span>ev</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ct = EvtEnt ev&#9839;k&quot;</span></span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>a1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;actk (a1::(&#39;l, &#39;k, &#39;s, &#39;prog,&#39;d) action) = ((EvtEnt ev)&#9839;k) &#8743; eventof a1 = ev 
                                          &#8743; dome (gets C1) k ev = domain a1&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>action.select_convs</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>as1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>d2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;as1 = a1#as&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d0</span><span> </span><span>d1</span><span> </span><span>b0</span><span> </span><span>c3</span><span> </span><span>c4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(C1, C2) &#8712; run as1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>run_def</span><span> </span><span>step_def</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>case_prod_conv</span><span> </span><span>mem_Collect_eq</span><span> </span><span>run_Cons</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>                </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d2</span><span> </span><span>c4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc (length as1) = length ((pes1, s, x) # (pes2, t, y) # xs)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c4</span><span> </span><span>b0</span><span> </span><span>d0</span><span> </span><span>d1</span><span> </span><span>d2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. Suc j &lt; length ((pes1, s, x) # (pes2, t, y) # xs) &#10230;
                    &#915; &#8866; ((pes1, s, x) # (pes2, t, y) # xs) !
                    j -pes-actk (as1 ! j)&#8594; ((pes1, s, x) # (pes2, t, y) # xs) ! Suc j&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c3</span><span> </span><span>calculation</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>diff_Suc_1</span><span> </span><span>length_Suc_conv</span><span> </span><span>less_Suc_eq_0_disj</span><span> 
</span><span>                    </span><span>nat.discI</span><span> </span><span>not0_implies_Suc</span><span> </span><span>nth_Cons&#39;</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>run_is_cpt</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;C1 C2 as. (C1,C2) &#8712; run as &#10230; 
            (&#8707;c. c&#8712;cpts_pes &#915; &#8743; c!0 = C1 &#8743; last c = C2 &#8743; Suc (length as) = length c &#8743;
                 (&#8704;j. Suc j &lt; length c &#10230; (&#915; &#8866; c!j-pes-(actk (as!j))&#8594;c!Suc j)) )&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>C2</span><span> </span><span>as</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;C1. (C1,C2) &#8712; run as &#10230; (&#8707;c. c&#8712;cpts_pes &#915; &#8743; c!0 = C1 &#8743; last c = C2 &#8743; Suc (length as) = length c &#8743;
                           (&#8704;j. Suc j &lt; length c &#10230; (&#915; &#8866; c!j-pes-(actk (as!j))&#8594;c!Suc j)))&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>as</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>Nil</span><span>
</span><span>        </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>          </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>C1</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(C1, C2) &#8712; run []&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;C1 = C2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>run_def</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;[C1]&#8712;cpts_pes &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>cpts_pes.CptsPesOne</span><span> </span><span>prod_cases3</span><span class="delimiter">)</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;[C1]!0 = C1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;last [C1] = C2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8707;c. c &#8712; cpts_pes &#915; &#8743; c ! 0 = C1 &#8743; last c = C2 &#8743; Suc (length []) = length c &#8743;
                           (&#8704;j. Suc j &lt; length c &#10230; (&#915; &#8866; c!j-pes-(actk ([]!j))&#8594;c!Suc j)))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Cons</span><span> </span><span>b</span><span> </span><span>bs</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;C1. (C1, C2) &#8712; run bs &#10230; (&#8707;c. c &#8712; cpts_pes &#915; &#8743; c ! 0 = C1 &#8743; last c = C2 &#8743; Suc (length bs) = length c &#8743;
                           (&#8704;j. Suc j &lt; length c &#10230; (&#915; &#8866; c!j-pes-(actk (bs!j))&#8594;c!Suc j)))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>          </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>C1</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(C1, C2) &#8712; run (b # bs)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;R. (C1,R) &#8712; step b &#8743; (R,C2) &#8712; run bs&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>run_def</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>R</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(C1,R) &#8712; step b &#8743; (R,C2) &#8712; run bs&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;c. c &#8712; cpts_pes &#915; &#8743; c ! 0 = R &#8743; last c = C2 &#8743; Suc (length bs) = length c &#8743;
                           (&#8704;j. Suc j &lt; length c &#10230; (&#915; &#8866; c!j-pes-(actk (bs!j))&#8594;c!Suc j))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>c</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>b2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; cpts_pes &#915; &#8743; c ! 0 = R &#8743; last c = C2 &#8743; Suc (length bs) = length c &#8743;
                           (&#8704;j. Suc j &lt; length c &#10230; (&#915; &#8866; c!j-pes-(actk (bs!j))&#8594;c!Suc j))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>c&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>b3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c=R#c&#39;&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>cpts_pes_not_empty</span><span> </span><span>hd_conv_nth</span><span> </span><span>list.exhaust</span><span> </span><span>list.sel</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span class="delimiter">)</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; C1 -pes-(actk b)&#8594; R&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>step_def</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b2</span><span> </span><span>b3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(C1#c) &#8712; cpts_pes &#915;&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>pestran_cpts_pes</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>meson</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(C1#c)!0 = C1 &#8743; last (C1#c) = C2 &#8743; Suc (length (b#bs)) = length (C1#c)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b2</span><span> </span><span>b4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. Suc j &lt; length (C1#c) &#10230; (&#915; &#8866; (C1#c)!j-pes-(actk ((b # bs)!j))&#8594;(C1#c)!Suc j)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>Suc_inject</span><span> </span><span>Suc_length_conv</span><span> </span><span>less_Suc_eq_0_disj</span><span> </span><span>nth_Cons_0</span><span> </span><span>nth_Cons_Suc</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b5</span><span> </span><span>b6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;c. c &#8712; cpts_pes &#915; &#8743; Suc (length (b # bs)) = length c &#8743;
              c ! 0 = C1 &#8743; last c = C2 &#8743; (&#8704;j. Suc j &lt; length c &#10230; &#915; &#8866; c ! j -pes-actk ((b # bs) ! j)&#8594; c ! Suc j)&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>reachable_impl_cpts</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;reachable C1 C2 &#10233; &#8707;c. c&#8712;cpts_pes &#915; &#8743; c!0 = C1 &#8743; last c = C2&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;reachable C1 C2&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;as. (C1,C2) &#8712; run as&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>reachable_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>as</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(C1,C2) &#8712; run as&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>run_is_cpt</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>reachable0_impl_cpts</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;reachable0 C &#10233; &#8707;c. c&#8712;cpts_pes &#915; &#8743; c!0 = C0 &#8743; last c = C&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>reachable_impl_cpts</span><span> </span><span>reachable0_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rg_lr_imp_lr</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;locally_respect_event &#10233; locally_respect&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;locally_respect_event&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; &#8704;ef u s1 s2 k. ef&#8712;all_evts pesf &#8743; (s1,s2) &#8712; Guar<span class="hidden">&#8681;</span><sub>e</sub> ef &#10230; 
                                    ((dome s1 k (E<span class="hidden">&#8681;</span><sub>e</sub> ef)) &#8726;&#8605; u &#10230; s1 &#8764;u&#8764; s2)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>locally_respect_event_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>a</span><span> </span><span>u</span><span> </span><span>C</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;reachable0 C&quot;</span></span></span><span>
</span><span>          </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(domain (a::(&#39;l,&#39;k,&#39;s,&#39;prog,&#39;d) action)) &#8726;&#8605; u&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704; C&#39;. (C&#39;&#8712;nextc C a) &#10230; (C &#8764;.u.&#8764; C&#39;)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>          </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>C&#39;</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;C&#39;&#8712;nextc C a&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(C,C&#39;)&#8712;step a&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>nextc_def</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915; &#8866; C -pes-(actk a)&#8594; C&#39;) &#8743;
                            ((&#8707;e k. actk a = ((EvtEnt e)&#9839;k) &#8743; eventof a = e &#8743; dome (gets C) k e = domain a) &#8744;
                             (&#8707;c k. actk a = ((Cmd c)&#9839;k) &#8743; eventof a = (getx C) k &#8743; dome (gets C) k (eventof a) = domain a))&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>step_def</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>act_k</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>e</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>d</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>b3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;a = &#10631;actk = act_k,eventof = e, domain=d&#10632;&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>action.cases</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915; &#8866; C -pes-act_k&#8594; C&#39;) &#8743; 
                              ((&#8707;e k. act_k = ((EvtEnt e)&#9839;k) &#8743; eventof a = e &#8743; dome (gets C) k e = domain a) &#8744;
                             (&#8707;c k. act_k = ((Cmd c)&#9839;k) &#8743; eventof a = (getx C) k &#8743; dome (gets C) k (eventof a) = domain a))&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>act</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>k</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>b5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;act_k = act&#9839;k&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>actk.cases</span><span> </span><span>get_actk_def</span><span class="delimiter">)</span><span> 
</span><span>            </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>pes1</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>s1</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>b6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;C = (pes1,s1,x1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>prod_cases3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>            </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>pes2</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>s2</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x2</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>b7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;C&#39; = (pes2,s2,x2)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>prod_cases3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b4</span><span> </span><span>b5</span><span> </span><span>b6</span><span> </span><span>b7</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;es&#39;. (&#915; &#8866; (pes1 k, s1, x1) -es-(act&#9839;k)&#8594; (es&#39;, s2, x2)) &#8743; pes2 = pes1(k:=es&#39;)&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>pestran_estran</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>es&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>b8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915; &#8866; (pes1 k, s1, x1) -es-(act&#9839;k)&#8594; (es&#39;, s2, x2)) &#8743; pes2 = pes1(k:=es&#39;)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;C &#8764;.u.&#8764; C&#39;&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>act</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Cmd</span><span> </span><span>x</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;act_k = Cmd x&#9839;k&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;as. (C0,C) &#8712; run as&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>reachable0_def</span><span> </span><span>reachable_def</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>as</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(C0,C) &#8712; run as&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8707;c. c&#8712;cpts_pes &#915; &#8743; c!0 = C0 &#8743; last c = C &#8743; Suc (length as) = length c &#8743;
                              (&#8704;j. Suc j &lt; length c &#10230; (&#915; &#8866; c!j-pes-(actk (as!j))&#8594;c!Suc j)) )&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>run_is_cpt</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>c</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;cpts_pes &#915; &#8743; c!0 = C0 &#8743; last c = C &#8743; Suc (length as) = length c &#8743;
                              (&#8704;j. Suc j &lt; length c &#10230; (&#915; &#8866; c!j-pes-(actk (as!j))&#8594;c!Suc j))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c@[C&#39;]&#8712;cpts_pes &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_pes_onemore</span><span> </span><span>step_def</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>b4</span><span> </span><span>cpts_pes_not_empty</span><span> </span><span>last_conv_nth</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c @ [C&#39;] &#8712; cpts_of_pes &#915; (paresys_spec pesf) s0 x0&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_of_pes_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;paresys_spec pesf&quot;</span></span></span><span> </span><span>s0</span><span> </span><span>x0</span><span class="delimiter">]</span><span> </span><span>C0_ParSys</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>cpts_pes_not_empty</span><span> </span><span>length_greater_0_conv</span><span> </span><span>mem_Collect_eq</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(c @ [C&#39;]) ! (length (c @ [C&#39;]) - 2) = C&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>hide_lams</span><span class="delimiter">)</span><span> </span><span>Suc_1</span><span> </span><span>cpts_pes_not_empty</span><span> </span><span>diff_Suc_Suc</span><span> 
</span><span>                      </span><span>hd_Cons_tl</span><span> </span><span>last_conv_nth</span><span> </span><span>length_Cons</span><span> </span><span>length_append_singleton</span><span> </span><span>length_tl</span><span> </span><span>lessI</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(c @ [C&#39;]) ! (length (c @ [C&#39;]) - 1) = C&#39;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b1</span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c50</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. Suc j &lt; length (c @ [C&#39;]) &#10230; 
                        (&#915; &#8866; (c @ [C&#39;])!j-pes-(actk ((as@[a])!j))&#8594;(c @ [C&#39;])!Suc j)&quot;</span></span></span><span>
</span><span>                   </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>Suc_1</span><span> </span><span>Suc_lessI</span><span> </span><span>Suc_less_eq</span><span> </span><span>action.simps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>b3</span><span> </span><span>b4</span><span> </span><span>c4</span><span> 
</span><span>                     </span><span>diff_Suc_1</span><span> </span><span>diff_Suc_Suc</span><span> </span><span>length_append_singleton</span><span> </span><span>nth_append</span><span> </span><span>nth_append_length</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets C, gets C&#39;)&#8712;Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx C k)))&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>b1</span><span> </span><span>b3</span><span> </span><span>b4</span><span> </span><span>c0</span><span> </span><span>c1</span><span> </span><span>act_cptpes_sat_guar_curevt_new2</span><span> </span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span>pesf</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;{s0}&quot;</span></span></span><span> </span><span>UNIV</span><span> </span><span>s0</span><span> </span><span>evtrgfs</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c@[C&#39;]&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>                     </span><span>step_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>a</span><span class="delimiter">]</span><span> </span><span>parsys_sat_rg</span><span> </span><span>all_evts_are_basic</span><span> </span><span>evt_in_parsys_in_evtrgfs</span><span>
</span><span>                     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>One_nat_def</span><span> </span><span>Suc_1</span><span> </span><span>append_is_Nil_conv</span><span> </span><span>butlast_snoc</span><span> </span><span>diff_Suc_1</span><span> 
</span><span>                       </span><span>diff_Suc_eq_diff_pred</span><span> </span><span>diff_Suc_less</span><span> </span><span>insertI1</span><span> </span><span>length_butlast</span><span> 
</span><span>                       </span><span>length_greater_0_conv</span><span> </span><span>not_Cons_self2</span><span class="delimiter">)</span><span>
</span><span>                
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c3</span><span> </span><span>c50</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c51</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k i. Suc i &lt; length (c @ [C&#39;]) &#10230;
                          (&#8707;ca. &#915; &#8866; (c @ [C&#39;]) ! i -pes-Cmd ca&#9839;k&#8594; (c @ [C&#39;]) ! Suc i) &#10230;
                          (&#8707;ef&#8712;all_evts pesf. getx ((c @ [C&#39;]) ! i) k = fst ef) &quot;</span></span></span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>all_evts_are_basic</span><span> </span><span>cur_evt_in_specevts</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c@[C&#39;]&quot;</span></span></span><span> </span><span>pesf</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>E<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b1</span><span> </span><span>b3</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c52</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; C-pes-Cmd x&#9839;k&#8594;C&#39;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>step_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8707;ef&#8712;all_evts pesf. getx C k = fst ef)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c1</span><span> </span><span>c4</span><span> </span><span>c5</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k n. &#172; Suc n &lt; length (c @ [C&#39;]) &#8744;
                        (&#8704;ca. &#172; (&#915; &#8866; (c @ [C&#39;]) ! n -pes-Cmd ca&#9839;k&#8594; (c @ [C&#39;]) ! Suc n)) &#8744; 
                        (&#8707;p. p &#8712; all_evts pesf &#8743; fst p = getx ((c @ [C&#39;]) ! n) k)&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>c51</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ps. c ! length as = (c @ ps) ! length as&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>c1</span><span> </span><span>lessI</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c ! length as = C&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Zero_not_Suc</span><span> </span><span>diff_Suc_1</span><span> </span><span>last_conv_nth</span><span> </span><span>length_0_conv</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f2</span><span> </span><span>f1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>c52</span><span> </span><span>c1</span><span> </span><span>c5</span><span> </span><span>diff_Suc_1</span><span> </span><span>length_append_singleton</span><span> </span><span>lessI</span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>ef</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ef&#8712;all_evts pesf &#8743; getx C k = fst ef&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#8707;e k. act_k = EvtEnt e&#9839;k)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>get_actk_def</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b3</span><span> </span><span>b4</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c70</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;x k. act_k = Cmd x&#9839;k &#8743; eventof a = getx C k &#8743; dome (gets C) k (eventof a) = domain a&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a1</span><span> </span><span>b3</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;eventof a = getx C k &#8743; dome (gets C) k (eventof a) = domain a&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>get_actk_def</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Cmd x&quot;</span></span></span><span> </span><span>k</span><span class="delimiter">]</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                    </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>cc</span><span> </span><span class="delimiter">::</span><span> </span><span>cmd</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>kk</span><span> </span><span class="delimiter">::</span><span> </span><span class="tfree">&#39;k</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>                      </span><span>f1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;act_k = Cmd cc&#9839;kk &#8743; eventof a = getx C kk &#8743; dome (gets C) kk (eventof a) = domain a&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c70</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(Cmd cc::(&#39;l, &#39;p, &#39;k, &#39;s) act) = Cmd x &#8743; kk = k&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>c0</span><span> </span><span>get_actk_def</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>meson</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a1</span><span> </span><span>b3</span><span> </span><span>b6</span><span> </span><span>c7</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(dome s1 k (E<span class="hidden">&#8681;</span><sub>e</sub> ef)) &#8726;&#8605; u&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>gets_def</span><span> </span><span>E<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fst_conv</span><span> </span><span>snd_conv</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span>b6</span><span> </span><span>b7</span><span> </span><span>c7</span><span> </span><span>r1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets C, gets C&#39;)&#8712;Guar<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evt_in_parsys_in_evtrgfs</span><span> </span><span>Guar<span class="hidden">&#8681;</span><sub>f</sub>_def</span><span> </span><span>E<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Guar<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>                </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>p1</span><span> </span><span>b6</span><span> </span><span>b7</span><span> </span><span>c7</span><span> </span><span>vpeqc_def</span><span> </span><span>E<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>c8</span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>              </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>EvtEnt</span><span> </span><span>x</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b5</span><span> </span><span>b8</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;s1 = s2&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>entevt_notchgstate</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>EvtEnt.prems</span><span> </span><span>evtent_is_basicevt</span><span class="delimiter">)</span><span>  
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b6</span><span> </span><span>b7</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>gets_def</span><span> </span><span>vpeqc_def</span><span> </span><span>vpeq_reflexive</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>locally_respect_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rg_sc_imp_sc</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;step_consistent_event &#10233; step_consistent&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;step_consistent_event&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; &#8704;ef u s1 s2 k. ef&#8712;all_evts pesf  
                              &#10230; s1 &#8764;u&#8764; s2 &#8743; ((dome s1 k (E<span class="hidden">&#8681;</span><sub>e</sub> ef)) &#8605; u &#10230; s1 &#8764;(dome s1 k (E<span class="hidden">&#8681;</span><sub>e</sub> ef))&#8764; s2)
                              &#10230; (&#8704;s1&#39; s2&#39;. (s1,s1&#39;) &#8712; Guar<span class="hidden">&#8681;</span><sub>e</sub> ef &#8743; (s2,s2&#39;) &#8712; Guar<span class="hidden">&#8681;</span><sub>e</sub> ef &#10230; s1&#39; &#8764;u&#8764; s2&#39;)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>step_consistent_event_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>a</span><span> </span><span>u</span><span> </span><span>C1</span><span> </span><span>C2</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(reachable0 C1) &#8743; (reachable0 C2)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(C1 &#8764;.u.&#8764; C2) &#8743; (((domain (a::(&#39;l,&#39;k,&#39;s,&#39;prog,&#39;d) action)) &#8605; u) &#10230; (C1 &#8764;.(domain a).&#8764; C2))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;C1&#39; C2&#39;. (C1&#39;&#8712;nextc C1 a) &#8743; (C2&#39;&#8712;nextc C2 a) &#10230; (C1&#39; &#8764;.u.&#8764; C2&#39;)&quot;</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>          </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>C1&#39;</span><span> </span><span>C2&#39;</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(C1&#39;&#8712;nextc C1 a) &#8743; (C2&#39;&#8712;nextc C2 a)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>act_k</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>e</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>d</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>b3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;a = &#10631;actk = act_k,eventof = e, domain=d&#10632;&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>action.cases</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>            </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>act</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>k</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>b5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;act_k = act&#9839;k&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>actk.cases</span><span> </span><span>get_actk_def</span><span class="delimiter">)</span><span> 
</span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(C1,C1&#39;)&#8712;step a&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>nextc_def</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915; &#8866; C1 -pes-(actk a)&#8594; C1&#39;) &#8743;
                            ((&#8707;e k. actk a = ((EvtEnt e)&#9839;k) &#8743; eventof a = e &#8743; dome (gets C1) k e = domain a) &#8744;
                             (&#8707;c k. actk a = ((Cmd c)&#9839;k) &#8743; eventof a = (getx C1) k &#8743; dome (gets C1) k (eventof a) = domain a))&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>step_def</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915; &#8866; C1 -pes-act_k&#8594; C1&#39;) &#8743; 
                              ((&#8707;e k. act_k = ((EvtEnt e)&#9839;k) &#8743; eventof a = e &#8743; dome (gets C1) k e = domain a) &#8744;
                             (&#8707;c k. act_k = ((Cmd c)&#9839;k) &#8743; eventof a = (getx C1) k &#8743; dome (gets C1) k (eventof a) = domain a))&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(C2,C2&#39;)&#8712;step a&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>nextc_def</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915; &#8866; C2 -pes-(actk a)&#8594; C2&#39;) &#8743;
                            ((&#8707;e k. actk a = ((EvtEnt e)&#9839;k) &#8743; eventof a = e &#8743; dome (gets C2) k e = domain a) &#8744;
                             (&#8707;c k. actk a = ((Cmd c)&#9839;k) &#8743; eventof a = (getx C2) k &#8743; dome (gets C2) k (eventof a) = domain a))&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>step_def</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915; &#8866; C2 -pes-act_k&#8594; C2&#39;) &#8743; 
                              ((&#8707;e k. act_k = ((EvtEnt e)&#9839;k) &#8743; eventof a = e &#8743; dome (gets C2) k e = domain a) &#8744;
                             (&#8707;c k. act_k = ((Cmd c)&#9839;k) &#8743; eventof a = (getx C2) k &#8743; dome (gets C2) k (eventof a) = domain a))&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>pes1</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>s1</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>b8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;C1 = (pes1,s1,x1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>prod_cases3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>            </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>pes1&#39;</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>s1&#39;</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x1&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>b9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;C1&#39; = (pes1&#39;,s1&#39;,x1&#39;)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>prod_cases3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>            </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>pes2</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>s2</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x2</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>b10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;C2 = (pes2,s2,x2)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>prod_cases3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>            </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>pes2&#39;</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>s2&#39;</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x2&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>b11</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;C2&#39; = (pes2&#39;,s2&#39;,x2&#39;)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>prod_cases3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b4</span><span> </span><span>b5</span><span> </span><span>b8</span><span> </span><span>b9</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;es&#39;. (&#915; &#8866; (pes1 k, s1, x1) -es-(act&#9839;k)&#8594; (es&#39;, s1&#39;, x1&#39;)) &#8743; pes1&#39; = pes1(k:=es&#39;)&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>pestran_estran</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>pes1</span><span> </span><span>s1</span><span> </span><span>x1</span><span> </span><span>act</span><span> </span><span>k</span><span> </span><span>pes1&#39;</span><span> </span><span>s1&#39;</span><span> </span><span>x1&#39;</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>es1&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>b12</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915; &#8866; (pes1 k, s1, x1) -es-(act&#9839;k)&#8594; (es1&#39;, s1&#39;, x1&#39;)) &#8743; pes1&#39; = pes1(k:=es1&#39;)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b5</span><span> </span><span>b7</span><span> </span><span>b10</span><span> </span><span>b11</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;es&#39;. (&#915; &#8866; (pes2 k, s2, x2) -es-(act&#9839;k)&#8594; (es&#39;, s2&#39;, x2&#39;)) &#8743; pes2&#39; = pes2(k:=es&#39;)&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>pestran_estran</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>pes2</span><span> </span><span>s2</span><span> </span><span>x2</span><span> </span><span>act</span><span> </span><span>k</span><span> </span><span>pes2&#39;</span><span> </span><span>s2&#39;</span><span> </span><span>x2&#39;</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>es2&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>b13</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915; &#8866; (pes2 k, s2, x2) -es-(act&#9839;k)&#8594; (es2&#39;, s2&#39;, x2&#39;)) &#8743; pes2&#39; = pes2(k:=es2&#39;)&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;C1&#39; &#8764;.u.&#8764; C2&#39;&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>act</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Cmd</span><span> </span><span>x</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;act_k = Cmd x&#9839;k&quot;</span></span></span><span>
</span><span>                
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;as. (C0,C1) &#8712; run as&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>reachable0_def</span><span> </span><span>reachable_def</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>as1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(C0,C1) &#8712; run as1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8707;c. c&#8712;cpts_pes &#915; &#8743; c!0 = C0 &#8743; last c = C1 &#8743; Suc (length as1) = length c &#8743;
                              (&#8704;j. Suc j &lt; length c &#10230; (&#915; &#8866; c!j-pes-(actk (as1!j))&#8594;c!Suc j)) )&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>run_is_cpt</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>c1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c1&#8712;cpts_pes &#915; &#8743; c1!0 = C0 &#8743; last c1 = C1 &#8743; Suc (length as1) = length c1 &#8743;
                              (&#8704;j. Suc j &lt; length c1 &#10230; (&#915; &#8866; c1!j-pes-(actk (as1!j))&#8594;c1!Suc j))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c1@[C1&#39;]&#8712;cpts_pes &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_pes_onemore</span><span> </span><span>step_def</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>b4</span><span> </span><span>cpts_pes_not_empty</span><span> </span><span>last_conv_nth</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c1 @ [C1&#39;] &#8712; cpts_of_pes &#915; (paresys_spec pesf) s0 x0&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_of_pes_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;paresys_spec pesf&quot;</span></span></span><span> </span><span>s0</span><span> </span><span>x0</span><span class="delimiter">]</span><span> </span><span>C0_ParSys</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>cpts_pes_not_empty</span><span> </span><span>length_greater_0_conv</span><span> </span><span>mem_Collect_eq</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(c1 @ [C1&#39;]) ! (length (c1 @ [C1&#39;]) - 2) = C1&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>hide_lams</span><span class="delimiter">)</span><span> </span><span>Suc_1</span><span> </span><span>cpts_pes_not_empty</span><span> </span><span>diff_Suc_Suc</span><span> 
</span><span>                      </span><span>hd_Cons_tl</span><span> </span><span>last_conv_nth</span><span> </span><span>length_Cons</span><span> </span><span>length_append_singleton</span><span> </span><span>length_tl</span><span> </span><span>lessI</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(c1 @ [C1&#39;]) ! (length (c1 @ [C1&#39;]) - 1) = C1&#39;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b1</span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c50</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. Suc j &lt; length (c1 @ [C1&#39;]) &#10230; 
                        (&#915; &#8866; (c1 @ [C1&#39;])!j-pes-(actk ((as1@[a])!j))&#8594;(c1 @ [C1&#39;])!Suc j)&quot;</span></span></span><span>
</span><span>                   </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>Suc_1</span><span> </span><span>Suc_lessI</span><span> </span><span>Suc_less_eq</span><span> </span><span>action.simps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>b3</span><span> </span><span>b4</span><span> </span><span>c4</span><span> 
</span><span>                     </span><span>diff_Suc_1</span><span> </span><span>diff_Suc_Suc</span><span> </span><span>length_append_singleton</span><span> </span><span>nth_append</span><span> </span><span>nth_append_length</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets C1, gets C1&#39;)&#8712;Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx C1 k)))&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>b1</span><span> </span><span>b3</span><span> </span><span>b4</span><span> </span><span>c0</span><span> </span><span>c1</span><span> </span><span>act_cptpes_sat_guar_curevt_new2</span><span> </span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span>pesf</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;{s0}&quot;</span></span></span><span> </span><span>UNIV</span><span> </span><span>s0</span><span> </span><span>evtrgfs</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c1@[C1&#39;]&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>                     </span><span>step_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>a</span><span class="delimiter">]</span><span> </span><span>parsys_sat_rg</span><span> </span><span>all_evts_are_basic</span><span> </span><span>evt_in_parsys_in_evtrgfs</span><span>
</span><span>                     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>One_nat_def</span><span> </span><span>Suc_1</span><span> </span><span>append_is_Nil_conv</span><span> </span><span>butlast_snoc</span><span> </span><span>diff_Suc_1</span><span> 
</span><span>                       </span><span>diff_Suc_eq_diff_pred</span><span> </span><span>diff_Suc_less</span><span> </span><span>insertI1</span><span> </span><span>length_butlast</span><span> 
</span><span>                       </span><span>length_greater_0_conv</span><span> </span><span>not_Cons_self2</span><span class="delimiter">)</span><span>
</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;as. (C0,C2) &#8712; run as&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>reachable0_def</span><span> </span><span>reachable_def</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>as2</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(C0,C2) &#8712; run as2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8707;c. c&#8712;cpts_pes &#915; &#8743; c!0 = C0 &#8743; last c = C2 &#8743; Suc (length as2) = length c &#8743;
                              (&#8704;j. Suc j &lt; length c &#10230; (&#915; &#8866; c!j-pes-(actk (as2!j))&#8594;c!Suc j)) )&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>run_is_cpt</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>c2</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c2&#8712;cpts_pes &#915; &#8743; c2!0 = C0 &#8743; last c2 = C2 &#8743; Suc (length as2) = length c2 &#8743;
                              (&#8704;j. Suc j &lt; length c2 &#10230; (&#915; &#8866; c2!j-pes-(actk (as2!j))&#8594;c2!Suc j))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c2@[C2&#39;]&#8712;cpts_pes &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_pes_onemore</span><span> </span><span>step_def</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>b7</span><span> </span><span>cpts_pes_not_empty</span><span> </span><span>last_conv_nth</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c7</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c2 @ [C2&#39;] &#8712; cpts_of_pes &#915; (paresys_spec pesf) s0 x0&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_of_pes_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;paresys_spec pesf&quot;</span></span></span><span> </span><span>s0</span><span> </span><span>x0</span><span class="delimiter">]</span><span> </span><span>C0_ParSys</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>cpts_pes_not_empty</span><span> </span><span>length_greater_0_conv</span><span> </span><span>mem_Collect_eq</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c7</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(c2 @ [C2&#39;]) ! (length (c2 @ [C2&#39;]) - 2) = C2&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>hide_lams</span><span class="delimiter">)</span><span> </span><span>Suc_1</span><span> </span><span>cpts_pes_not_empty</span><span> </span><span>diff_Suc_Suc</span><span> 
</span><span>                      </span><span>hd_Cons_tl</span><span> </span><span>last_conv_nth</span><span> </span><span>length_Cons</span><span> </span><span>length_append_singleton</span><span> </span><span>length_tl</span><span> </span><span>lessI</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c11</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(c2 @ [C2&#39;]) ! (length (c2 @ [C2&#39;]) - 1) = C2&#39;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b1</span><span> </span><span>c7</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c12</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. Suc j &lt; length (c2 @ [C2&#39;]) &#10230; 
                        (&#915; &#8866; (c2 @ [C2&#39;])!j-pes-(actk ((as2@[a])!j))&#8594;(c2 @ [C2&#39;])!Suc j)&quot;</span></span></span><span>
</span><span>                   </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>Suc_1</span><span> </span><span>Suc_lessI</span><span> </span><span>Suc_less_eq</span><span> </span><span>action.simps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>b3</span><span> </span><span>b7</span><span> </span><span>c10</span><span> 
</span><span>                     </span><span>diff_Suc_1</span><span> </span><span>diff_Suc_Suc</span><span> </span><span>length_append_singleton</span><span> </span><span>nth_append</span><span> </span><span>nth_append_length</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets C2, gets C2&#39;)&#8712;Guar<span class="hidden">&#8681;</span><sub>f</sub> (the (evtrgfs (getx C2 k)))&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>b1</span><span> </span><span>b3</span><span> </span><span>b7</span><span> </span><span>c0</span><span> </span><span>c7</span><span> </span><span>act_cptpes_sat_guar_curevt_new2</span><span> </span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">,</span><span> </span><span>of</span><span> </span><span>pesf</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;{s0}&quot;</span></span></span><span> </span><span>UNIV</span><span> </span><span>s0</span><span> </span><span>evtrgfs</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c2@[C2&#39;]&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>                     </span><span>step_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>a</span><span class="delimiter">]</span><span> </span><span>parsys_sat_rg</span><span> </span><span>all_evts_are_basic</span><span> </span><span>evt_in_parsys_in_evtrgfs</span><span>
</span><span>                     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>One_nat_def</span><span> </span><span>Suc_1</span><span> </span><span>append_is_Nil_conv</span><span> </span><span>butlast_snoc</span><span> </span><span>diff_Suc_1</span><span> 
</span><span>                       </span><span>diff_Suc_eq_diff_pred</span><span> </span><span>diff_Suc_less</span><span> </span><span>insertI1</span><span> </span><span>length_butlast</span><span> 
</span><span>                       </span><span>length_greater_0_conv</span><span> </span><span>not_Cons_self2</span><span class="delimiter">)</span><span>
</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c3</span><span> </span><span>c50</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c51</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k i. Suc i &lt; length (c1 @ [C1&#39;]) &#10230;
                          (&#8707;ca. &#915; &#8866; (c1 @ [C1&#39;]) ! i -pes-Cmd ca&#9839;k&#8594; (c1 @ [C1&#39;]) ! Suc i) &#10230;
                          (&#8707;ef&#8712;all_evts pesf. getx ((c1 @ [C1&#39;]) ! i) k = fst ef) &quot;</span></span></span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>all_evts_are_basic</span><span> </span><span>cur_evt_in_specevts</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c1@[C1&#39;]&quot;</span></span></span><span> </span><span>pesf</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>E<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b1</span><span> </span><span>b3</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c52</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; C1-pes-Cmd x&#9839;k&#8594;C1&#39;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>step_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8707;ef&#8712;all_evts pesf. getx C1 k = fst ef)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c1</span><span> </span><span>c4</span><span> </span><span>c5</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k n. &#172; Suc n &lt; length (c1 @ [C1&#39;]) &#8744;
                        (&#8704;ca. &#172; (&#915; &#8866; (c1 @ [C1&#39;]) ! n -pes-Cmd ca&#9839;k&#8594; (c1 @ [C1&#39;]) ! Suc n)) &#8744; 
                        (&#8707;p. p &#8712; all_evts pesf &#8743; fst p = getx ((c1 @ [C1&#39;]) ! n) k)&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>c51</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ps. c1 ! length as1 = (c1 @ ps) ! length as1&quot;</span></span></span><span> 
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">)</span><span> </span><span>c1</span><span> </span><span>lessI</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c1 ! length as1 = C1&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Zero_not_Suc</span><span> </span><span>diff_Suc_1</span><span> </span><span>last_conv_nth</span><span> </span><span>length_0_conv</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f2</span><span> </span><span>f1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>c52</span><span> </span><span>c1</span><span> </span><span>c5</span><span> </span><span>diff_Suc_1</span><span> </span><span>length_append_singleton</span><span> </span><span>lessI</span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>ef</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c12</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ef&#8712;all_evts pesf &#8743; getx C1 k = fst ef&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c12_1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#8707;e k. act_k = EvtEnt e&#9839;k)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>get_actk_def</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b3</span><span> </span><span>b4</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c13</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;x k. act_k = Cmd x&#9839;k &#8743; eventof a = getx C1 k &#8743; dome (gets C1) k (eventof a) = domain a&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a1</span><span> </span><span>b3</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c14</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;eventof a = getx C1 k &#8743; dome (gets C1) k (eventof a) = domain a&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>get_actk_def</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Cmd x&quot;</span></span></span><span> </span><span>k</span><span class="delimiter">]</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                    </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>cc</span><span> </span><span class="delimiter">::</span><span> </span><span>cmd</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>kk</span><span> </span><span class="delimiter">::</span><span> </span><span class="tfree">&#39;k</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>                      </span><span>f1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;act_k = Cmd cc&#9839;kk &#8743; eventof a = getx C1 kk &#8743; dome (gets C1) kk (eventof a) = domain a&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c13</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(Cmd cc::(&#39;l, &#39;p, &#39;k, &#39;s) act) = Cmd x &#8743; kk = k&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>c0</span><span> </span><span>get_actk_def</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>f1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>meson</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c15</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;eventof a = (getx C2) k &#8743; dome (gets C2) k (eventof a) = domain a&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b7</span><span> </span><span>c12_1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;c k. act_k = Cmd c&#9839;k &#8743; eventof a = getx C2 k 
                          &#8743; dome (gets C2) k (eventof a) = domain a&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>c&#39;</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>k&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;act_k = Cmd c&#39;&#9839;k&#39; &#8743; eventof a = getx C2 k&#39; 
                          &#8743; dome (gets C2) k&#39; (eventof a) = domain a&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c0</span><span> </span><span>c14</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>actk.iffs</span><span> </span><span>get_actk_def</span><span class="delimiter">)</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c14</span><span> </span><span>a1</span><span> </span><span>b3</span><span> </span><span>b8</span><span> </span><span>b10</span><span> </span><span>c12</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(dome s1 k (E<span class="hidden">&#8681;</span><sub>e</sub> ef)) &#8605; u &#10230; s1 &#8764;(dome s1 k (E<span class="hidden">&#8681;</span><sub>e</sub> ef))&#8764; s2&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>gets_def</span><span> </span><span>E<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>vpeqc_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fst_conv</span><span> </span><span>snd_conv</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c12</span><span> </span><span>r1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets C1, gets C1&#39;)&#8712;Guar<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evt_in_parsys_in_evtrgfs</span><span> </span><span>Guar<span class="hidden">&#8681;</span><sub>f</sub>_def</span><span> </span><span>E<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Guar<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>                </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c12</span><span> </span><span>c14</span><span> </span><span>c15</span><span> </span><span>r2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets C2, gets C2&#39;)&#8712;Guar<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evt_in_parsys_in_evtrgfs</span><span> </span><span>Guar<span class="hidden">&#8681;</span><sub>f</sub>_def</span><span> </span><span>E<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Guar<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>                </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>p1</span><span> </span><span>c12</span><span> </span><span>a1</span><span> </span><span>vpeqc_def</span><span> </span><span>E<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>b10</span><span> </span><span>b8</span><span> </span><span>fst_conv</span><span> </span><span>gets_def</span><span> </span><span>snd_conv</span><span class="delimiter">)</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>EvtEnt</span><span> </span><span>x</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b12</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;s1 = s1&#39;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>entevt_notchgstate</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>EvtEnt.prems</span><span> </span><span>b5</span><span> </span><span>evtent_is_basicevt</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b13</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;s2 = s2&#39;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>entevt_notchgstate</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>EvtEnt.prems</span><span> </span><span>b5</span><span> </span><span>evtent_is_basicevt</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a1</span><span> </span><span>b8</span><span> </span><span>b9</span><span> </span><span>b10</span><span> </span><span>b11</span><span> </span><span>r1</span><span> </span><span>r2</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>gets_def</span><span> </span><span>vpeqc_def</span><span> </span><span>vpeq_reflexive</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fst_conv</span><span> </span><span>snd_conv</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>step_consistent_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">theorem</span></span><span> </span><span>UnwindingTheoremE_noninfluence0</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>p2</span><span class="delimiter">:</span><span> </span><span>locally_respect_event</span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span>   </span><span>p3</span><span class="delimiter">:</span><span> </span><span>step_consistent_event</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span>g</span><span class="delimiter">:</span><span>noninfluence0</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>UnwindingTheorem_noninfluence0</span><span> </span><span>p2</span><span> </span><span>p3</span><span> </span><span>rg_lr_imp_lr</span><span> </span><span>rg_sc_imp_sc</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">theorem</span></span><span> </span><span>UnwindingTheoremE_nonleakage</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>SCE</span><span class="delimiter">:</span><span> </span><span>step_consistent_event</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span>nonleakage</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>SC_eq_nonleakage</span><span> </span><span>assms</span><span> </span><span>rg_sc_imp_sc</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span></pre>

</div>
</body>
</html>
