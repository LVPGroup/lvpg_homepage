<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Theory PiCore_Hoare (Isabelle2018: August 2018)</title>
<link media="all" rel="stylesheet" type="text/css" href="isabelle.css"/>
</head>

<body>
<div class="head"><h1>Theory PiCore_Hoare</h1>

<span class="command">theory</span> <span class="name">PiCore_Hoare</span><br/>
<span class="keyword">imports</span> <a href="PiCore_Validity.html"><span class="name">PiCore_Validity</span></a><br/>

</div>
<div class="source">
<pre class="source"><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*
Created by Yongwang Zhao (zhaoyw@buaa.edu.cn)
School of Computer Science &amp; Engineering, Beihang University, China
*)</span></span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">section</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;The Rely-guarantee Proof System and its Soundness of PiCore&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">theory</span></span><span> </span><span>PiCore_Hoare</span><span>
</span><span class="keyword2"><span class="keyword">imports</span></span><span> </span><span>PiCore_Validity</span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">declare</span></span><span> </span><span class="delimiter">[</span><span class="delimiter">[</span><span>smt_timeout</span><span> </span><span class="delimiter">=</span><span> </span><span>300</span><span class="delimiter">]</span><span class="delimiter">]</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Proof System for Programs&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">declare</span></span><span> </span><span>Un_subset_iff</span><span> </span><span class="delimiter">[</span><span>simp</span><span> </span><span>del</span><span class="delimiter">]</span><span> </span><span>sup.bounded_iff</span><span> </span><span class="delimiter">[</span><span>simp</span><span> </span><span>del</span><span class="delimiter">]</span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>stable_e</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;a set &#8658; (&#39;a &#215; &#39;a) set &#8658; bool&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;stable_e &#8801; &#955;f g. (&#8704;x y. x &#8712; f &#10230; (x, y) &#8712; g &#10230; y &#8712; f)&quot;</span></span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Id = {(s, t). s = t}&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>stable_e_id</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;stable_e P Id&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>stable_e_def</span><span> </span><span>Id_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>stable_e_id2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;stable_e P {(s,t). s = t}&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>stable_e_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>stable_e_int2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;stable_e s r &#10233; stable_e t r &#10233; stable_e (s &#8745; t) r&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>full_types</span><span class="delimiter">)</span><span> </span><span>IntD1</span><span> </span><span>IntD2</span><span> </span><span>IntI</span><span> </span><span>stable_e_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>stable_e_int3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;stable_e k r &#10233; stable_e s r &#10233; stable_e t r &#10233; stable_e (k &#8745; s &#8745; t) r&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>full_types</span><span class="delimiter">)</span><span> </span><span>IntD1</span><span> </span><span>IntD2</span><span> </span><span>IntI</span><span> </span><span>stable_e_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>stable_e_un2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;stable_e s r &#10233; stable_e t r &#10233; stable_e (s &#8746; t) r&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>stable_e_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Rely-guarantee Condition&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">record</span></span><span> </span><span class="tfree">&#39;s</span><span> </span><span>rgformula</span><span> </span><span class="delimiter">=</span><span>
</span><span>    </span><span>pre_rgf</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;s set&quot;</span></span></span><span>
</span><span>    </span><span>rely_rgf</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;s &#215; &#39;s) set&quot;</span></span></span><span>
</span><span>    </span><span>guar_rgf</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;s &#215; &#39;s) set&quot;</span></span></span><span>
</span><span>    </span><span>post_rgf</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;s set&quot;</span></span></span><span>    
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>getrgformula</span><span> </span><span class="delimiter">::</span><span> 
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;s set &#8658; (&#39;s &#215; &#39;s) set &#8658; (&#39;s &#215; &#39;s) set &#8658; &#39;s set &#8658; &#39;s rgformula&quot;</span></span></span><span> </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">&quot;RG[_,_,_,_]&quot;</span></span></span><span> </span><span class="delimiter">[</span><span>91</span><span class="delimiter">,</span><span>91</span><span class="delimiter">,</span><span>91</span><span class="delimiter">,</span><span>91</span><span class="delimiter">]</span><span> </span><span>90</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getrgformula pre r g pst &#8801; &#10631;pre_rgf = pre, rely_rgf = r, guar_rgf = g, post_rgf = pst&#10632;&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>Pre<span class="hidden">&#8681;</span><sub>f</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;s rgformula &#8658; &#39;s set&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Pre<span class="hidden">&#8681;</span><sub>f</sub> rg = pre_rgf rg&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>Rely<span class="hidden">&#8681;</span><sub>f</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;s rgformula &#8658; (&#39;s &#215; &#39;s) set&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Rely<span class="hidden">&#8681;</span><sub>f</sub> rg = rely_rgf rg&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>Guar<span class="hidden">&#8681;</span><sub>f</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;s rgformula &#8658; (&#39;s &#215; &#39;s) set&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Guar<span class="hidden">&#8681;</span><sub>f</sub> rg = guar_rgf rg&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>Post<span class="hidden">&#8681;</span><sub>f</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;s rgformula &#8658; &#39;s set&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Post<span class="hidden">&#8681;</span><sub>f</sub> rg = post_rgf rg&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">type_synonym</span></span><span> </span><span class="delimiter">(</span><span class="tfree">&#39;l</span><span class="delimiter">,</span><span class="tfree">&#39;k</span><span class="delimiter">,</span><span class="tfree">&#39;s</span><span class="delimiter">,</span><span class="tfree">&#39;prog</span><span class="delimiter">)</span><span> </span><span>rgformula_e</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;l,&#39;k,&#39;s,&#39;prog) event &#215; &#39;s rgformula&quot;</span></span></span><span>
</span><span>
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* get Intersect of preconditions *)</span></span></span></span></span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>get_int_pre</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;l,&#39;k,&#39;s,&#39;prog) rgformula_e set &#8658; &#39;s set&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;get_int_pre S &#8801; {s. &#8704;f&#8712;S. s &#8712; Pre<span class="hidden">&#8681;</span><sub>f</sub> (snd f)}&quot;</span></span></span><span>
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* get Intersect of rely conditions *)</span></span></span></span></span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>get_int_rely</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;l,&#39;k,&#39;s,&#39;prog) rgformula_e set &#8658; (&#39;s &#215; &#39;s) set&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;get_int_rely S &#8801; {s. &#8704;f&#8712;S. s &#8712; Rely<span class="hidden">&#8681;</span><sub>f</sub> (snd f)}&quot;</span></span></span><span>
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* get Union of guar conditions *)</span></span></span></span></span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>get_un_guar</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;l,&#39;k,&#39;s,&#39;prog) rgformula_e set &#8658; (&#39;s &#215; &#39;s) set&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;get_un_guar S &#8801; {s. &#8707;f&#8712;S. s &#8712; Guar<span class="hidden">&#8681;</span><sub>f</sub> (snd f)}&quot;</span></span></span><span>
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* get Union of postconditions *)</span></span></span></span></span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>get_un_post</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;l,&#39;k,&#39;s,&#39;prog) rgformula_e set &#8658; &#39;s set&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;get_un_post S &#8801; {s. &#8707;f&#8712;S. s &#8712; Post<span class="hidden">&#8681;</span><sub>f</sub> (snd f)}&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">datatype</span></span><span> </span><span class="delimiter">(</span><span class="tfree">&#39;l</span><span class="delimiter">,</span><span class="tfree">&#39;k</span><span class="delimiter">,</span><span class="tfree">&#39;s</span><span class="delimiter">,</span><span class="tfree">&#39;prog</span><span class="delimiter">)</span><span> </span><span>rgformula_ess</span><span> </span><span class="delimiter">=</span><span> 
</span><span>      </span><span>rgf_EvtSeq</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;l,&#39;k,&#39;s,&#39;prog) rgformula_e&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;l,&#39;k,&#39;s,&#39;prog) rgformula_ess &#215; &#39;s rgformula&quot;</span></span></span><span>
</span><span>    </span><span class="delimiter">|</span><span> </span><span>rgf_EvtSys</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;l,&#39;k,&#39;s,&#39;prog) rgformula_e set&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">type_synonym</span></span><span> </span><span class="delimiter">(</span><span class="tfree">&#39;l</span><span class="delimiter">,</span><span class="tfree">&#39;k</span><span class="delimiter">,</span><span class="tfree">&#39;s</span><span class="delimiter">,</span><span class="tfree">&#39;prog</span><span class="delimiter">)</span><span> </span><span>rgformula_es</span><span> </span><span class="delimiter">=</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;l,&#39;k,&#39;s,&#39;prog) rgformula_ess &#215; &#39;s rgformula&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">type_synonym</span></span><span> </span><span class="delimiter">(</span><span class="tfree">&#39;l</span><span class="delimiter">,</span><span class="tfree">&#39;k</span><span class="delimiter">,</span><span class="tfree">&#39;s</span><span class="delimiter">,</span><span class="tfree">&#39;prog</span><span class="delimiter">)</span><span> </span><span>rgformula_par</span><span> </span><span class="delimiter">=</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;k &#8658; (&#39;l,&#39;k,&#39;s,&#39;prog) rgformula_es&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>E<span class="hidden">&#8681;</span><sub>e</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;l,&#39;k,&#39;s,&#39;prog) rgformula_e &#8658; (&#39;l,&#39;k,&#39;s,&#39;prog) event&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;E<span class="hidden">&#8681;</span><sub>e</sub> rg = fst rg&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>Pre<span class="hidden">&#8681;</span><sub>e</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;l,&#39;k,&#39;s,&#39;prog) rgformula_e &#8658; &#39;s set&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Pre<span class="hidden">&#8681;</span><sub>e</sub> rg = pre_rgf (snd rg)&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>Rely<span class="hidden">&#8681;</span><sub>e</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;l,&#39;k,&#39;s,&#39;prog) rgformula_e &#8658; (&#39;s &#215; &#39;s) set&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Rely<span class="hidden">&#8681;</span><sub>e</sub> rg = rely_rgf (snd rg)&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>Guar<span class="hidden">&#8681;</span><sub>e</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;l,&#39;k,&#39;s,&#39;prog) rgformula_e &#8658; (&#39;s &#215; &#39;s) set&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Guar<span class="hidden">&#8681;</span><sub>e</sub> rg = guar_rgf (snd rg)&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>Post<span class="hidden">&#8681;</span><sub>e</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;l,&#39;k,&#39;s,&#39;prog) rgformula_e &#8658; &#39;s set&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Post<span class="hidden">&#8681;</span><sub>e</sub>  rg = post_rgf (snd rg)&quot;</span></span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;l,&#39;k,&#39;s,&#39;prog) rgformula_es &#8658; &#39;s set&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> rg = pre_rgf (snd rg)&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;l,&#39;k,&#39;s,&#39;prog) rgformula_es &#8658; (&#39;s &#215; &#39;s) set&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> rg = rely_rgf (snd rg)&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;l,&#39;k,&#39;s,&#39;prog) rgformula_es &#8658; (&#39;s &#215; &#39;s) set&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> rg = guar_rgf (snd rg)&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub></span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;l,&#39;k,&#39;s,&#39;prog) rgformula_es &#8658; &#39;s set&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>  rg = post_rgf (snd rg)&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">fun</span></span><span> </span><span>evtsys_spec</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;l,&#39;k,&#39;s,&#39;prog) rgformula_ess &#8658; (&#39;l,&#39;k,&#39;s,&#39;prog) esys&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span>evtsys_spec_evtseq</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;evtsys_spec (rgf_EvtSeq ef esf) = EvtSeq (E<span class="hidden">&#8681;</span><sub>e</sub> ef) (evtsys_spec (fst esf))&quot;</span></span></span><span> </span><span class="delimiter">|</span><span>
</span><span>  </span><span>evtsys_spec_evtsys</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;evtsys_spec (rgf_EvtSys esf) = EvtSys (Domain esf)&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>paresys_spec</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;l,&#39;k,&#39;s,&#39;prog) rgformula_par &#8658; (&#39;l,&#39;k,&#39;s,&#39;prog) paresys&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;paresys_spec pesf &#8801; &#955;k. evtsys_spec (fst (pesf k))&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>event_hoare</span><span> </span><span class="delimiter">=</span><span> </span><span>event_validity</span><span> </span><span>ptran</span><span> </span><span>petran</span><span> </span><span>fin_com</span><span> </span><span>cpts_p</span><span> </span><span>cpts_of_p</span><span> </span><span>prog_validity</span><span> </span><span>assume_p</span><span> </span><span>commit_p</span><span> 
</span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>ptran</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; ((&#39;prog &#215; &#39;s) &#215; &#39;prog &#215; &#39;s) set&quot;</span></span></span><span> 
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>petran</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; (&#39;s,&#39;prog) pconf &#8658; (&#39;s,&#39;prog) pconf &#8658; bool&quot;</span></span></span><span>   </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">&quot;_ &#8866; _ -pe&#8594; _&quot;</span></span></span><span> </span><span class="delimiter">[</span><span>81</span><span class="delimiter">,</span><span>81</span><span class="delimiter">,</span><span>81</span><span class="delimiter">]</span><span> </span><span>80</span><span class="delimiter">)</span><span>
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>fin_com</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;prog&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>cpts_p</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; (&#39;s,&#39;prog) pconfs set&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>cpts_of_p</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; &#39;prog &#8658; &#39;s &#8658; ((&#39;s,&#39;prog) pconfs) set&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>prog_validity</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; &#39;prog &#8658; &#39;s set &#8658; (&#39;s &#215; &#39;s) set &#8658; (&#39;s &#215; &#39;s) set &#8658; &#39;s set &#8658; bool&quot;</span></span></span><span> 
</span><span>                 </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">&quot;_ &#8872; _ sat<span class="hidden">&#8681;</span><sub>p</sub> [_, _, _, _]&quot;</span></span></span><span> </span><span class="delimiter">[</span><span>60</span><span class="delimiter">,</span><span>60</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">]</span><span> </span><span>45</span><span class="delimiter">)</span><span>
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>assume_p</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; (&#39;s set &#215; (&#39;s &#215; &#39;s) set) &#8658; ((&#39;s,&#39;prog) pconfs) set&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>commit_p</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; ((&#39;s &#215; &#39;s) set &#215; &#39;s set) &#8658; ((&#39;s,&#39;prog) pconfs) set&quot;</span></span></span><span>
</span><span class="delimiter">+</span><span>
</span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>rghoare_p</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; [&#39;prog, &#39;s set, (&#39;s &#215; &#39;s) set, (&#39;s &#215; &#39;s) set, &#39;s set] &#8658; bool&quot;</span></span></span><span>
</span><span>    </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">&quot;_ &#8866; _ sat<span class="hidden">&#8681;</span><sub>p</sub> [_, _, _, _]&quot;</span></span></span><span> </span><span class="delimiter">[</span><span>60</span><span class="delimiter">,</span><span>60</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">]</span><span> </span><span>45</span><span class="delimiter">)</span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>rgsound_p</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; P sat<span class="hidden">&#8681;</span><sub>p</sub> [pre, rely, guar, post] &#10230; &#915; &#8872; P sat<span class="hidden">&#8681;</span><sub>p</sub> [pre, rely, guar, post]&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Proof System for Events&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">inductive</span></span><span> </span><span>rghoare_e</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; [(&#39;l,&#39;k,&#39;s,&#39;prog) event, &#39;s set, (&#39;s &#215; &#39;s) set, (&#39;s &#215; &#39;s) set, &#39;s set] &#8658; bool&quot;</span></span></span><span>
</span><span>    </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">&quot;_ &#8866; _ sat<span class="hidden">&#8681;</span><sub>e</sub> [_, _, _, _]&quot;</span></span></span><span> </span><span class="delimiter">[</span><span>60</span><span class="delimiter">,</span><span>60</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">]</span><span> </span><span>45</span><span class="delimiter">)</span><span>
</span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span>AnonyEvt</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; P sat<span class="hidden">&#8681;</span><sub>p</sub> [pre, rely, guar, post] &#10233; &#915; &#8866; AnonyEvent P sat<span class="hidden">&#8681;</span><sub>e</sub> [pre, rely, guar, post]&quot;</span></span></span><span>
</span><span>
</span><span class="delimiter">|</span><span> </span><span>BasicEvt</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214; &#915; &#8866; body ev sat<span class="hidden">&#8681;</span><sub>p</sub> [pre &#8745; (guard ev), rely, guar, post]; 
          stable_e pre rely; &#8704;s. (s, s)&#8712;guar&#10215; &#10233; &#915; &#8866; BasicEvent ev sat<span class="hidden">&#8681;</span><sub>e</sub> [pre, rely, guar, post]&quot;</span></span></span><span>
</span><span>
</span><span class="delimiter">|</span><span> </span><span>Evt_conseq</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214; pre &#8838; pre&#39;; rely &#8838; rely&#39;; guar&#39; &#8838; guar; post&#39; &#8838; post;
                       &#915; &#8866; ev sat<span class="hidden">&#8681;</span><sub>e</sub> [pre&#39;, rely&#39;, guar&#39;, post&#39;] &#10215;
                      &#10233; &#915; &#8866; ev sat<span class="hidden">&#8681;</span><sub>e</sub> [pre, rely, guar, post]&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>Evt_sat_RG</span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; (&#39;l,&#39;k,&#39;s,&#39;prog) event &#8658; &#39;s rgformula &#8658; bool&quot;</span></span></span><span> </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">&quot;(_ _&#8866;_)&quot;</span></span></span><span> </span><span class="delimiter">[</span><span>60</span><span class="delimiter">,</span><span>60</span><span class="delimiter">,</span><span>60</span><span class="delimiter">]</span><span> </span><span>61</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Evt_sat_RG &#915; e rg &#8801; &#915; &#8866; e sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre<span class="hidden">&#8681;</span><sub>f</sub> rg, Rely<span class="hidden">&#8681;</span><sub>f</sub> rg, Guar<span class="hidden">&#8681;</span><sub>f</sub> rg, Post<span class="hidden">&#8681;</span><sub>f</sub> rg]&quot;</span></span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Proof System for Event Systems&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">inductive</span></span><span> </span><span>rghoare_es</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; [(&#39;l,&#39;k,&#39;s,&#39;prog) rgformula_ess, &#39;s set, (&#39;s &#215; &#39;s) set, (&#39;s &#215; &#39;s) set, &#39;s set] &#8658; bool&quot;</span></span></span><span>
</span><span>    </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">&quot;_ &#8866; _ sat<span class="hidden">&#8681;</span><sub>s</sub> [_, _, _, _]&quot;</span></span></span><span> </span><span class="delimiter">[</span><span>60</span><span class="delimiter">,</span><span>60</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">]</span><span> </span><span>45</span><span class="delimiter">)</span><span>
</span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>&#915;</span><span> </span><span class="delimiter">::</span><span> </span><span class="tfree">&#39;Env</span><span>
</span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span>EvtSeq_h</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214; &#915; &#8866; E<span class="hidden">&#8681;</span><sub>e</sub> ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre<span class="hidden">&#8681;</span><sub>e</sub> ef, Rely<span class="hidden">&#8681;</span><sub>e</sub> ef, Guar<span class="hidden">&#8681;</span><sub>e</sub> ef, Post<span class="hidden">&#8681;</span><sub>e</sub> ef]; 
              &#915; &#8866; fst esf sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre<span class="hidden">&#8681;</span><sub>f</sub> (snd esf), Rely<span class="hidden">&#8681;</span><sub>f</sub> (snd esf), Guar<span class="hidden">&#8681;</span><sub>f</sub> (snd esf), Post<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)]; 
              pre = Pre<span class="hidden">&#8681;</span><sub>e</sub> ef; post = Post<span class="hidden">&#8681;</span><sub>f</sub> (snd esf);
              rely &#8838; Rely<span class="hidden">&#8681;</span><sub>e</sub> ef; rely &#8838; Rely<span class="hidden">&#8681;</span><sub>f</sub> (snd esf); 
              Guar<span class="hidden">&#8681;</span><sub>e</sub> ef &#8838; guar; Guar<span class="hidden">&#8681;</span><sub>f</sub> (snd esf) &#8838; guar; 
              Post<span class="hidden">&#8681;</span><sub>e</sub> ef &#8838; Pre<span class="hidden">&#8681;</span><sub>f</sub> (snd esf)&#10215; 
              &#10233; &#915; &#8866; (rgf_EvtSeq ef esf) sat<span class="hidden">&#8681;</span><sub>s</sub> [pre, rely, guar, post]&quot;</span></span></span><span>
</span><span>
</span><span class="delimiter">|</span><span> </span><span>EvtSys_h</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;&#8704;ef&#8712; esf. &#915; &#8866; E<span class="hidden">&#8681;</span><sub>e</sub> ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre<span class="hidden">&#8681;</span><sub>e</sub> ef, Rely<span class="hidden">&#8681;</span><sub>e</sub> ef, Guar<span class="hidden">&#8681;</span><sub>e</sub> ef, Post<span class="hidden">&#8681;</span><sub>e</sub> ef];
             &#8704;ef&#8712; esf. pre &#8838; Pre<span class="hidden">&#8681;</span><sub>e</sub> ef;  &#8704;ef &#8712; esf. rely &#8838; Rely<span class="hidden">&#8681;</span><sub>e</sub> ef;
             &#8704;ef&#8712; esf. Guar<span class="hidden">&#8681;</span><sub>e</sub> ef &#8838; guar; &#8704;ef &#8712; esf. Post<span class="hidden">&#8681;</span><sub>e</sub> ef &#8838; post;
             &#8704;ef1 ef2. ef1 &#8712; esf &#8743; ef2 &#8712; esf &#10230; Post<span class="hidden">&#8681;</span><sub>e</sub> ef1 &#8838; Pre<span class="hidden">&#8681;</span><sub>e</sub> ef2;
             stable_e pre rely; &#8704;s. (s, s)&#8712;guar&#10215;
             &#10233; &#915; &#8866; rgf_EvtSys esf sat<span class="hidden">&#8681;</span><sub>s</sub> [pre, rely, guar, post]&quot;</span></span></span><span>
</span><span>
</span><span class="delimiter">|</span><span> </span><span>EvtSys_conseq</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214; pre &#8838; pre&#39;; rely &#8838; rely&#39;; guar&#39; &#8838; guar; post&#39; &#8838; post;
                       &#915; &#8866; esys sat<span class="hidden">&#8681;</span><sub>s</sub> [pre&#39;, rely&#39;, guar&#39;, post&#39;] &#10215;
                      &#10233; &#915; &#8866; esys sat<span class="hidden">&#8681;</span><sub>s</sub> [pre, rely, guar, post]&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>Esys_sat_RG</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; (&#39;l,&#39;k,&#39;s,&#39;prog) rgformula_ess &#8658; &#39;s rgformula &#8658; bool&quot;</span></span></span><span> </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">&quot;(_ _&#8866;<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_)&quot;</span></span></span><span> </span><span class="delimiter">[</span><span>60</span><span class="delimiter">,</span><span>60</span><span class="delimiter">,</span><span>60</span><span class="delimiter">]</span><span> </span><span>61</span><span class="delimiter">)</span><span>
</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Esys_sat_RG &#915; es rg &#8801; &#915; &#8866; es sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre<span class="hidden">&#8681;</span><sub>f</sub> rg, Rely<span class="hidden">&#8681;</span><sub>f</sub> rg, Guar<span class="hidden">&#8681;</span><sub>f</sub> rg, Post<span class="hidden">&#8681;</span><sub>f</sub> rg]&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Proof System for Parallel Event Systems&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">inductive</span></span><span> </span><span>rghoare_pes</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; [(&#39;l,&#39;k,&#39;s,&#39;prog) rgformula_par, &#39;s set, (&#39;s &#215; &#39;s) set, (&#39;s &#215; &#39;s) set, &#39;s set] &#8658; bool&quot;</span></span></span><span>
</span><span>          </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">&quot;_ &#8866; _ SAT [_, _, _, _]&quot;</span></span></span><span> </span><span class="delimiter">[</span><span>60</span><span class="delimiter">,</span><span>60</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">]</span><span> </span><span>45</span><span class="delimiter">)</span><span> 
</span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>&#915;</span><span> </span><span class="delimiter">::</span><span> </span><span class="tfree">&#39;Env</span><span>
</span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span>ParallelESys</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;&#8704;k. &#915; &#8866; fst (pesf k) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesf k), Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesf k), Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesf k), Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesf k)]; 
                  &#8704;k. pre &#8838; Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesf k); 
                  &#8704;k. rely &#8838; Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesf k); 
                  &#8704;k j. j&#8800;k &#10230;  Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesf j) &#8838; Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesf k);
                  &#8704;k. Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesf k) &#8838; guar;
                  &#8704;k. Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesf k) &#8838; post&#10215; 
              &#10233; &#915; &#8866; pesf SAT [pre, rely, guar, post]&quot;</span></span></span><span>
</span><span>
</span><span class="delimiter">|</span><span> </span><span>ParallelESys_conseq</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214; pre &#8838; pre&#39;; rely &#8838; rely&#39;; guar&#39; &#8838; guar; post&#39; &#8838; post;
                       &#915; &#8866; pesf SAT [pre&#39;, rely&#39;, guar&#39;, post&#39;] &#10215;
                      &#10233; &#915; &#8866; pesf SAT [pre, rely, guar, post]&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>es_sat_eq</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915; &#8866; fst (pesf k) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesf k), Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesf k), Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesf k), Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pesf k)]) 
  = &#915; (fst (pesf k)) &#8866;<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (snd (pesf k))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Esys_sat_RG_def</span><span> </span><span>Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>Pre<span class="hidden">&#8681;</span><sub>f</sub>_def</span><span> </span><span>Rely<span class="hidden">&#8681;</span><sub>f</sub>_def</span><span> </span><span>Guar<span class="hidden">&#8681;</span><sub>f</sub>_def</span><span> </span><span>Post<span class="hidden">&#8681;</span><sub>f</sub>_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">section</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Soundness&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Some previous lemmas&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;event&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>assume_e_imp</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;pre1&#8838;pre; rely1&#8838;rely; c&#8712;assume_e &#915; (pre1,rely1)&#10215; &#10233; c&#8712;assume_e &#915; (pre,rely)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;pre1&#8838;pre&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rely1&#8838;rely&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;assume_e &#915; (pre1,rely1)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_e (c!0) &#8712; pre1 &#8743; (&#8704;i. Suc i&lt;length c &#10230; 
               &#915; &#8866; c!i -ee&#8594; c!(Suc i) &#10230; (gets_e (c!i), gets_e (c!Suc i)) &#8712; rely1)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_e_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_e_def</span><span class="delimiter">,</span><span>rule</span><span> </span><span>conjI</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span>a0</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_e (c ! 0) &#8712; pre&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span>a0</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length c &#10230; &#915; &#8866; c ! i -ee&#8594; c ! Suc i 
                            &#10230; (gets_e (c ! i), gets_e (c ! Suc i)) &#8712; rely&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>commit_e_imp</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;guar1&#8838;guar; post1&#8838;post; c&#8712;commit_e &#915; (guar1,post1)&#10215; &#10233; c&#8712;commit_e &#915; (guar,post)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;guar1&#8838;guar&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;post1&#8838;post&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;commit_e &#915; (guar1,post1)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;i. Suc i&lt;length c &#10230; 
               (&#8707;t. &#915; &#8866; c!i -et-t&#8594; c!(Suc i)) &#10230; (gets_e (c!i), gets_e (c!Suc i)) &#8712; guar1) &#8743; 
               (getspc_e (last c) = AnonyEvent fin_com &#10230; gets_e (last c) &#8712; post1)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>commit_e_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>commit_e_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>a0</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;i. Suc i &lt; length c &#10230; (&#8707;t. &#915; &#8866; c ! i -et-t&#8594; c ! Suc i) 
                            &#10230; (gets_e (c ! i), gets_e (c ! Suc i)) &#8712; guar) &#8743; 
               (getspc_e (last c) = AnonyEvent fin_com &#10230; gets_e (last c) &#8712; post)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;event system&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>concat_i_lm</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ls l. concat ls = l &#8743; (&#8704;i&lt;length ls. ls!i &#8800; [])&#10230; (&#8704;i. Suc i &lt; length ls &#10230; 
                      (&#8707;m n. m &#8804; length l &#8743; n &#8804; length l &#8743; m &#8804; n &#8743; ls!i@[(ls!Suc i)!0] = take (n - m) (drop m l)))&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>ls</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;l. concat ls = l &#8743; (&#8704;i&lt;length ls. ls!i &#8800; [])&#10230; (&#8704;i. Suc i &lt; length ls &#10230; 
                      (&#8707;m n. m &#8804; length l &#8743; n &#8804; length l &#8743; m &#8804; n &#8743; ls!i@[(ls!Suc i)!0] = take (n - m) (drop m l)))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>ls</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>Nil</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Cons</span><span> </span><span>x</span><span> </span><span>xs</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;l. concat xs = l &#8743; (&#8704;i&lt;length xs. xs ! i &#8800; []) &#10230;
                        (&#8704;i. Suc i &lt; length xs &#10230; (&#8707;m n. m &#8804; length l &#8743; n &#8804; length l &#8743; 
                                m &#8804; n &#8743; xs ! i @ [xs ! Suc i ! 0] = take (n - m) (drop m l)))&quot;</span></span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>        </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>l</span><span>
</span><span>          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;concat (x # xs) = l&quot;</span></span></span><span>
</span><span>            </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length (x # xs). (x # xs) ! i &#8800; []&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?l&#39;</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;concat xs&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l = x@?l&#39;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>          </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length (x # xs) &#10230; (&#8707;m n. m &#8804; length l &#8743; n &#8804; length l &#8743; 
                        m &#8804; n &#8743; (x # xs) ! i @ [(x # xs) ! Suc i ! 0] = take (n - m) (drop m l))&quot;</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>            </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>              </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>              </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length (x # xs)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length xs &gt; 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;m n. m &#8804; length l &#8743; n &#8804; length l &#8743; m &#8804; n &#8743; 
                        (x # xs) ! i @ [(x # xs) ! Suc i ! 0] = take (n - m) (drop m l)&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i = 0&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i = 0&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b1</span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(x # xs) ! 1 &#8800; []&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>One_nat_def</span><span> </span><span>c0</span><span> </span><span>d0</span><span class="delimiter">)</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;x @ [xs!0 ! 0] = take (length x + 1) (drop 0 l)&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>Cons_nth_drop_Suc</span><span> </span><span>Nil_is_append_conv</span><span> </span><span>One_nat_def</span><span> </span><span>append_eq_conv_conj</span><span> 
</span><span>                      </span><span>c0</span><span> </span><span>concat.simps</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>d0</span><span> </span><span>drop_0</span><span> </span><span>drop_Suc_Cons</span><span> </span><span>length_greater_0_conv</span><span> 
</span><span>                      </span><span>nth_Cons_Suc</span><span> </span><span>nth_append</span><span> </span><span>self_append_conv2</span><span> </span><span>take_0</span><span> </span><span>take_Suc_conv_app_nth</span><span> </span><span>take_add</span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(x # xs) ! 0 @ [(x # xs) ! 1 ! 0] = take (length x + 1) (drop 0 l)&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;0 &#8804; length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>calculation</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span>d1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length x + 1 &#8804; length l&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_eq_plus1</span><span> </span><span>d2</span><span> </span><span>drop_0</span><span> </span><span>length_append_singleton</span><span> </span><span>linear</span><span> </span><span>take_all</span><span class="delimiter">)</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i &#8800; 0&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length xs. xs ! i &#8800; []&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc (i - 1) &lt; length xs&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;m n. m &#8804; length ?l&#39; &#8743; n &#8804; length ?l&#39; &#8743; 
                                m &#8804; n &#8743; xs ! (i - 1) @ [xs ! Suc (i - 1) ! 0] = take (n - m) (drop m ?l&#39;)&quot;</span></span></span><span> 
</span><span>                     </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>m</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>n</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>d2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &#8804; length ?l&#39; &#8743; n &#8804; length ?l&#39; &#8743; 
                                m &#8804; n &#8743; xs ! (i - 1) @ [xs ! Suc (i - 1) ! 0] = take (n - m) (drop m ?l&#39;)&quot;</span></span></span><span>
</span><span>                     </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?m&#39;</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m + length x&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?n&#39;</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;n + length x&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span>d2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?m&#39; &#8804; length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span>d2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?n&#39; &#8804; length l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">moreover</span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?m&#39; &#8804; ?n&#39;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(x # xs) ! i @ [(x # xs) ! Suc i ! 0] = take (?n&#39; - ?m&#39;) (drop ?m&#39; l)&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>b2</span><span> </span><span>d0</span><span> </span><span>d2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?m&#39; &#8804; length l &#8743; ?n&#39; &#8804; length l &#8743; ?m&#39; &#8804; ?n&#39; &#8743; 
                          (x # xs) ! i @ [(x # xs) ! Suc i ! 0] = take (?n&#39; - ?m&#39;) (drop ?m&#39; l)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>concat_last_lm</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ls l. concat ls = l &#8743; length ls &gt; 0 &#10230; 
                      (&#8707;m . m &#8804; length l &#8743; last ls = drop m l)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> 
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>ls</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;l. concat ls = l &#8743; length ls &gt; 0 &#10230; 
                      (&#8707;m . m &#8804; length l &#8743; last ls = drop m l)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>ls</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>Nil</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Cons</span><span> </span><span>x</span><span> </span><span>xs</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;l. concat xs = l &#8743; 0 &lt; length xs &#10230; (&#8707;m&#8804;length l. last xs = drop m l)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>          </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>l</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;concat (x # xs) = l&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;0 &lt; length (x # xs)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?l&#39;</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;concat xs&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;m&#8804;length l. last (x # xs) = drop m l&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;xs = []&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;xs = []&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;xs &#8800; []&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length xs &gt; 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;m&#8804;length ?l&#39;. last xs = drop m ?l&#39;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>m</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m&#8804;length ?l&#39; &#8743; last xs = drop m ?l&#39;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b0</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>append_eq_conv_conj</span><span> </span><span>c0</span><span> </span><span>concat.simps</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> 
</span><span>                      </span><span>drop_all</span><span> </span><span>drop_drop</span><span> </span><span>last.simps</span><span> </span><span>nat_le_linear</span><span class="delimiter">)</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>concat_equiv</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;l &#8800; []; l = concat lt; &#8704;i&lt;length lt. length (lt!i) &#8805; 2&#10215; &#10233; 
          &#8704;i. i &#8804; length l &#10230; (&#8707;k j. k &lt; length lt &#8743; j &#8804; length (lt!k) &#8743; 
                  drop i l = (drop j (lt!k)) @ concat (drop (Suc k) lt) )&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l = concat lt&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length lt. length (lt!i) &#8805; 2&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l &#8800; []&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lt &#8800; []&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>concat.simps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i &#8804; length l&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;k j. k &lt; length lt &#8743; j &#8804; length (lt!k) &#8743; 
                  drop i l = (drop j (lt!k)) @ concat (drop (Suc k) lt)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>i</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;0 &#8804; length l&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop 0 l = drop 0 (lt ! 0) @ concat (drop (Suc 0) lt)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>concat.simps</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>drop_0</span><span> </span><span>drop_Suc_Cons</span><span> </span><span>list.exhaust</span><span> </span><span>nth_Cons_0</span><span> </span><span>p0</span><span> </span><span>p4</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>p4</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>m</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &#8804; length l &#10233; &#8707;k j. k &lt; length lt &#8743; j &#8804; length (lt ! k) &#8743; 
                          drop m l = drop j (lt ! k) @ concat (drop (Suc k) lt)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc m &#8804; length l&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;k j. k &lt; length lt &#8743; j &#8804; length (lt ! k) &#8743; 
                          drop m l = drop j (lt ! k) @ concat (drop (Suc k) lt)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>k</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>j</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>b2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k &lt; length lt &#8743; j &#8804; length (lt ! k) &#8743; 
                          drop m l = drop j (lt ! k) @ concat (drop (Suc k) lt)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j = length (lt!k)&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j = length (lt!k)&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop m l = concat (drop (Suc k) lt)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop m l &#8800; []&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop (Suc k) lt &#8800; []&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>lt1</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>lts</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop (Suc k) lt = lt1#lts&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>neq_Nil_conv</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop (Suc (Suc k)) lt = lts&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>drop_Suc</span><span> </span><span>list.sel</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>tl_drop</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lt!Suc k = lt1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>nth_via_drop</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop (Suc m) l = drop 1 lt1 @ concat lts&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c1</span><span> </span><span>c3</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>One_nat_def</span><span> </span><span>Suc_leI</span><span> </span><span>Suc_lessI</span><span> </span><span>b2</span><span> </span><span>concat.simps</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> 
</span><span>                    </span><span>drop_0</span><span> </span><span>drop_Suc</span><span> </span><span>drop_all</span><span> </span><span>list.distinct</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>list.size</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> 
</span><span>                    </span><span>not_less_eq_eq</span><span> </span><span>numeral_2_eq_2</span><span> </span><span>p1</span><span> </span><span>tl_append2</span><span> </span><span>tl_drop</span><span> </span><span>zero_less_Suc</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c4</span><span> </span><span>c5</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop (Suc m) l = drop 1 (lt!Suc k) @ concat (drop (Suc (Suc k)) lt)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>One_nat_def</span><span> </span><span>Suc_leD</span><span> </span><span>Suc_leI</span><span> </span><span>Suc_lessI</span><span> </span><span>c2</span><span> </span><span>b2</span><span> </span><span>drop_all</span><span> </span><span>numeral_2_eq_2</span><span> </span><span>p1</span><span class="delimiter">)</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j &#8800; length (lt!k)&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j &lt; length (lt!k)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop (Suc m) l = drop (Suc j) (lt ! k) @ concat (drop (Suc k) lt)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>c0</span><span> </span><span>drop_Suc</span><span> </span><span>drop_eq_Nil</span><span> </span><span>le_antisym</span><span> </span><span>tl_append2</span><span> </span><span>tl_drop</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_leI</span><span> </span><span>c1</span><span> </span><span>b2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rely_take_rely</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length l &#10230; &#915; &#8866; l!i -ese&#8594; l!(Suc i) 
        &#10230; (gets_es (l!i), gets_es (l!Suc i)) &#8712; rely &#10233; 
        &#8704;m subl. m &#8804; length l &#8743; subl = take m l &#10230; (&#8704;i. Suc i&lt;length subl &#10230; &#915; &#8866; subl!i -ese&#8594; subl!(Suc i) 
        &#10230; (gets_es (subl!i), gets_es (subl!Suc i)) &#8712; rely)&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length l &#10230; &#915; &#8866; l!i -ese&#8594; l!(Suc i) 
        &#10230; (gets_es (l!i), gets_es (l!Suc i)) &#8712; rely&quot;</span></span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>m</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;subl. m &#8804; length l &#8743; subl = take m l &#10230; (&#8704;i. Suc i&lt;length subl &#10230; &#915; &#8866; subl!i -ese&#8594; subl!(Suc i) 
        &#10230; (gets_es (subl!i), gets_es (subl!Suc i)) &#8712; rely)&quot;</span></span></span><span>        
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>m</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>          </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>n</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;subl. n &#8804; length l &#8743; subl = take n l &#10230;
                          (&#8704;i. Suc i &lt; length subl &#10230; &#915; &#8866; subl ! i -ese&#8594; subl ! Suc i &#10230; 
                              (gets_es (subl ! i), gets_es (subl ! Suc i)) &#8712; rely)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>              </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>subl</span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc n &#8804; length l&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;subl = take (Suc n) l&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length subl &#10230; &#915; &#8866; subl ! i -ese&#8594; subl ! Suc i &#10230; 
                              (gets_es (subl ! i), gets_es (subl ! Suc i)) &#8712; rely&quot;</span></span></span><span>
</span><span>                   </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>p0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rely_drop_rely</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length l &#10230; &#915; &#8866; l!i -ese&#8594; l!(Suc i) 
        &#10230; (gets_es (l!i), gets_es (l!Suc i)) &#8712; rely &#10233; 
        &#8704;m subl. m &#8804; length l &#8743; subl = drop m l &#10230; (&#8704;i. Suc i&lt;length subl &#10230; &#915; &#8866; subl!i -ese&#8594; subl!(Suc i) 
        &#10230; (gets_es (subl!i), gets_es (subl!Suc i)) &#8712; rely)&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length l &#10230; &#915; &#8866; l!i -ese&#8594; l!(Suc i) 
        &#10230; (gets_es (l!i), gets_es (l!Suc i)) &#8712; rely&quot;</span></span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>m</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;subl. m &#8804; length l &#8743; subl = drop m l &#10230; (&#8704;i. Suc i&lt;length subl &#10230; &#915; &#8866; subl!i -ese&#8594; subl!(Suc i) 
        &#10230; (gets_es (subl!i), gets_es (subl!Suc i)) &#8712; rely)&quot;</span></span></span><span>        
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>m</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>p0</span><span class="delimiter">)</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>n</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;subl. n &#8804; length l &#8743; subl = drop n l &#10230;
                          (&#8704;i. Suc i &lt; length subl &#10230; &#915; &#8866; subl ! i -ese&#8594; subl ! Suc i &#10230; 
                              (gets_es (subl ! i), gets_es (subl ! Suc i)) &#8712; rely)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>              </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>subl</span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc n &#8804; length l&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;subl = drop (Suc n) l&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length subl &#10230; &#915; &#8866; subl ! i -ese&#8594; subl ! Suc i &#10230; 
                              (gets_es (subl ! i), gets_es (subl ! Suc i)) &#8712; rely&quot;</span></span></span><span>
</span><span>                   </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>p0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rely_takedrop_rely</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;&#8704;i. Suc i&lt;length l &#10230; &#915; &#8866; l!i -ese&#8594; l!(Suc i) 
        &#10230; (gets_es (l!i), gets_es (l!Suc i)) &#8712; rely; 
        &#8707;m n. m &#8804; length l &#8743; n &#8804; length l &#8743; m &#8804; n &#8743; subl = take (n - m) (drop m l)&#10215; &#10233; 
        &#8704;i. Suc i&lt;length subl &#10230; &#915; &#8866; subl!i -ese&#8594; subl!(Suc i) 
        &#10230; (gets_es (subl!i), gets_es (subl!Suc i)) &#8712; rely&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length l &#10230; &#915; &#8866; l!i -ese&#8594; l!(Suc i) 
        &#10230; (gets_es (l!i), gets_es (l!Suc i)) &#8712; rely&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;m n. m &#8804; length l &#8743; n &#8804; length l &#8743; m &#8804; n &#8743; subl = take (n - m) (drop m l)&quot;</span></span></span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p3</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>m</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>n</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &#8804; length l &#8743; n &#8804; length l &#8743; m &#8804; n &#8743; subl = take (n - m) (drop m l)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?subl1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop m l&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length ?subl1 &#10230; &#915; &#8866; ?subl1!i -ese&#8594; ?subl1!(Suc i) 
        &#10230; (gets_es (?subl1!i), gets_es (?subl1!Suc i)) &#8712; rely&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>p1</span><span> </span><span>rely_drop_rely</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>pre_trans</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;esl &#8712; assume_es &#915; (pre, rely); &#8704;i&lt;length esl. getspc_es (esl!i) = es; stable_e pre rely&#10215;
        &#10233; &#8704;i&lt;length esl. gets_es (esl!i) &#8712; pre&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl &#8712; assume_es &#915; (pre, rely)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length esl. getspc_es (esl!i) = es&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;stable_e pre rely&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i&lt;length esl&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (esl!i) &#8712; pre&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>i</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span> </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_es_def</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>j</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j &lt; length esl &#10233; gets_es (esl ! j) &#8712; pre&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc j &lt; length esl&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (esl ! j) &#8712; pre&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p2</span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl ! j) = es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p2</span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl ! Suc j) = es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; esl ! j -ese&#8594; esl ! Suc j&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>eqconf_esetran</span><span class="delimiter">)</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p0</span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (esl!j), gets_es (esl!Suc j)) &#8712; rely&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_es_def</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p3</span><span> </span><span>b2</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>stable_e_def</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>pre_trans_assume_es</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;esl &#8712; assume_es &#915; (pre, rely); n &lt; length esl; 
    &#8704;j. j &#8804; n &#10230; getspc_es (esl ! j) = es; stable_e pre rely&#10215;
        &#10233; drop n esl &#8712; assume_es &#915; (pre, rely)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl &#8712; assume_es &#915; (pre, rely)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. j &#8804; n &#10230; getspc_es (esl ! j) = es&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;stable_e pre rely&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;n &lt; length esl&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;n = 0&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;n = 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p0</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;n &#8800; 0&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;n &gt; 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?esl</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop n esl&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?esl1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;take (Suc n) esl&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span>a0</span><span> </span><span>p4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl1&#8712;assume_es &#915; (pre, rely)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assume_es_take_n</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc n&quot;</span></span></span><span> </span><span>esl</span><span> </span><span>&#915;</span><span> </span><span>pre</span><span> </span><span>rely</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p2</span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length ?esl1. getspc_es (?esl1 ! i) = es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">ultimately</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length ?esl1. gets_es (?esl1!i) &#8712; pre&quot;</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>pre_trans</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;take (Suc n) esl&quot;</span></span></span><span> </span><span>&#915;</span><span> </span><span>pre</span><span> </span><span>rely</span><span> </span><span>es</span><span class="delimiter">]</span><span> </span><span>p3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a0</span><span> </span><span>p4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (?esl!0)&#8712;pre&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Cons_nth_drop_Suc</span><span> </span><span>Suc_leI</span><span> </span><span>length_take</span><span> </span><span>lessI</span><span> </span><span>less_or_eq_imp_le</span><span> 
</span><span>          </span><span>min.absorb2</span><span> </span><span>nth_Cons_0</span><span> </span><span>nth_append_length</span><span> </span><span>take_Suc_conv_app_nth</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length ?esl &#10230; 
               &#915; &#8866; ?esl!i -ese&#8594; ?esl!(Suc i) &#10230; (gets_es (?esl!i), gets_es (?esl!Suc i)) &#8712; rely&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>          </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length ?esl&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; ?esl!i -ese&#8594; ?esl!(Suc i)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length esl &#10230; 
               &#915; &#8866; esl!i -ese&#8594; esl!(Suc i) &#10230; (gets_es (esl!i), gets_es (esl!Suc i)) &#8712; rely&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_es_def</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p4</span><span> </span><span>a0</span><span> </span><span>b0</span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (?esl!i), gets_es (?esl!Suc i)) &#8712; rely&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>less_imp_le_nat</span><span> </span><span>rely_drop_rely</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_es_def</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;parallel event system&#8250;</span></span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;State trace equivalence&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trace equivalence of program and anonymous event&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">primrec</span></span><span> </span><span>lower_anonyevt0</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;l,&#39;k,&#39;s,&#39;prog) event &#8658; &#39;s &#8658; (&#39;s,&#39;prog) pconf&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>AnonyEv</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lower_anonyevt0 (AnonyEvent p) s = (p, s)&quot;</span></span></span><span> </span><span class="delimiter">|</span><span>
</span><span>        </span><span>BasicEv</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lower_anonyevt0 (BasicEvent p) s = (fin_com, s)&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>lower_anonyevt1</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;l,&#39;k,&#39;s,&#39;prog) econf  &#8658; (&#39;s,&#39;prog) pconf&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lower_anonyevt1 ec &#8801; lower_anonyevt0 (getspc_e ec) (gets_e ec) &quot;</span></span></span><span> 
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>lower_evts</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;l,&#39;k,&#39;s,&#39;prog) econfs &#8658; ((&#39;s,&#39;prog) pconfs)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lower_evts ecfs &#8801; map lower_anonyevt1 ecfs&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>lower_anonyevt_s</span><span> </span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e e = AnonyEvent P &#10233; gets_p (lower_anonyevt1 e) = gets_e e&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>gets_p_def</span><span> </span><span>lower_anonyevt1_def</span><span class="delimiter">)</span><span>
</span><span>  
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>lower_evts_same_len</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ps = lower_evts es &#10233; length ps = length es&quot;</span></span></span><span> 
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>ps</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>lower_evts_def</span><span> </span><span>lower_anonyevt1_def</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>lower_evts_same_s</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ps = lower_evts (es::(&#39;l,&#39;k,&#39;s,&#39;prog) econfs) &#10233; &#8704;i&lt;length ps. gets_p (ps!i) = gets_e (es!i)&quot;</span></span></span><span> 
</span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>ps</span><span> </span><span>arbitrary</span><span class="delimiter">:</span><span>es</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>Nil</span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>lower_evts_def</span><span> </span><span>lower_anonyevt1_def</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Cons</span><span> </span><span>a</span><span> </span><span>ps</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8896;es. ps = lower_evts (es::(&#39;l,&#39;k,&#39;s,&#39;prog) econfs) &#10233; &#8704;i&lt;length ps. gets_p (ps ! i) = gets_e (es ! i))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;a # ps = lower_evts es&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>i</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i&lt;length (a # ps)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_p ((a # ps) ! i) = gets_e (es ! i)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>i</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>gets_p_def</span><span> </span><span>gets_e_def</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>p1</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>case_tac</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (es!0)&quot;</span></span></span><span class="delimiter">)</span><span> 
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>lower_evts_def</span><span> </span><span>lower_anonyevt1_def</span><span> </span><span>getspc_e_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>AnonyEv</span><span> </span><span>gets_e_def</span><span> </span><span>getspc_e_def</span><span> </span><span>lower_anonyevt1_def</span><span> </span><span>map_eq_Cons_D</span><span> </span><span>nth_Cons_0</span><span> </span><span>sndI</span><span class="delimiter">)</span><span> 
</span><span>        </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>lower_evts_def</span><span> </span><span>lower_anonyevt1_def</span><span> </span><span>getspc_e_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>BasicEv</span><span> </span><span>gets_e_def</span><span> </span><span>getspc_e_def</span><span> </span><span>lower_anonyevt1_def</span><span> </span><span>map_eq_Cons_D</span><span> </span><span>nth_Cons_0</span><span> </span><span>sndI</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>j</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc j &lt; length (a # ps)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j &lt; length ps&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ps = lower_evts (tl es)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>lower_evts_def</span><span> </span><span>lower_anonyevt1_def</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_p ((a # ps) ! Suc j) = gets_p (ps ! j)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>gets_p_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_e (es ! Suc j) = gets_e (tl es ! j)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>lower_evts_same_len</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;a # ps&quot;</span></span></span><span> </span><span>es</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>gets_e_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>length_0_conv</span><span> </span><span>list.simps</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>local.nth_tl</span><span> </span><span>nth_Cons_Suc</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>lower_evts_same_len</span><span class="delimiter">[</span><span>of</span><span> </span><span>ps</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;tl es&quot;</span></span></span><span class="delimiter">]</span><span> </span><span>p</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">,</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;tl es&quot;</span></span></span><span> </span><span>j</span><span class="delimiter">]</span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>equiv_lower_evts0</span><span> </span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;&#8707;P. getspc_e (es ! 0) = AnonyEvent P; es &#8712; cpts_ev &#915;&#10215; &#10233; lower_evts es &#8712;cpts_p &#915;&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;es &#8712; cpts_ev &#915;&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;P. getspc_e (es ! 0) = AnonyEvent P&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;es P. getspc_e (es ! 0) = AnonyEvent P &#8743; es &#8712; cpts_ev &#915; &#10230; lower_evts es &#8712;cpts_p &#915;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>es</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;P. getspc_e (es ! 0) = AnonyEvent P&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>               </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;es &#8712; cpts_ev &#915;&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b1</span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lower_evts es &#8712;cpts_p &#915;&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>es</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptsEvOne</span><span> </span><span>e&#39;</span><span> </span><span>s&#39;</span><span> </span><span>x&#39;</span><span class="delimiter">)</span><span> 
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;P. getspc_e ([(e&#39;, s&#39;, x&#39;)] ! 0) = AnonyEvent P&quot;</span></span></span><span>  
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>P</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e ([(e&#39;, s&#39;, x&#39;)] ! 0) = AnonyEvent P&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;e&#39; = AnonyEvent P&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>getspc_e_def</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lower_anonyevt1 (e&#39;, s&#39;, x&#39;) = (P, s&#39;)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>gets_e_def</span><span> </span><span>getspc_e_def</span><span> </span><span>lower_anonyevt1_def</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lower_evts [(e&#39;, s&#39;, x&#39;)] = [(P, s&#39;)]&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>lower_evts_def</span><span class="delimiter">)</span><span>  
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>CptsPOne</span><span class="delimiter">)</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptsEvEnv</span><span> </span><span>e&#39;</span><span> </span><span>t&#39;</span><span> </span><span>x&#39;</span><span> </span><span>xs&#39;</span><span> </span><span>s&#39;</span><span> </span><span>y&#39;</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; (e&#39;, t&#39;, x&#39;) # xs&#39; &#8712; cpts_ev &#915;&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>                   </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;P. getspc_e (((e&#39;, t&#39;, x&#39;) # xs&#39;) ! 0) = AnonyEvent P &#10233; lower_evts ((e&#39;, t&#39;, x&#39;) # xs&#39;) &#8712; cpts_p &#915;&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>                   </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;P. getspc_e (((e&#39;, s&#39;, y&#39;) # (e&#39;, t&#39;, x&#39;) # xs&#39;) ! 0) = AnonyEvent P&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?ob</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lower_evts ((e&#39;, s&#39;, y&#39;) # (e&#39;, t&#39;, x&#39;) # xs&#39;)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c2</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>P</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c_</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (((e&#39;, s&#39;, y&#39;) # (e&#39;, t&#39;, x&#39;) # xs&#39;) ! 0) = AnonyEvent P&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?ob ! 0 = (P, s&#39;)&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>lower_evts_def</span><span> </span><span>lower_anonyevt1_def</span><span> </span><span>lower_anonyevt0_def</span><span> </span><span>gets_e_def</span><span> </span><span>getspc_e_def</span><span class="delimiter">)</span><span> 
</span><span>            
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c_</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(e&#39;, s&#39;, y&#39;) = (AnonyEvent P, s&#39;, y&#39;)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>getspc_e_def</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;e&#39; = AnonyEvent P&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lower_evts ((e&#39;, t&#39;, x&#39;) # xs&#39;) &#8712; cpts_p &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>getspc_e_def</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?ob = (P, s&#39;) # lower_evts ((e&#39;, t&#39;, x&#39;) # xs&#39;)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>c3</span><span> </span><span>list.simps</span><span class="delimiter">(</span><span>9</span><span class="delimiter">)</span><span> </span><span>lower_evts_def</span><span> </span><span>nth_Cons_0</span><span class="delimiter">)</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lower_evts ((e&#39;, t&#39;, x&#39;) # xs&#39;) = (P, t&#39;) # lower_evts xs&#39;&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>lower_evts_def</span><span> </span><span>lower_anonyevt1_def</span><span> </span><span>lower_anonyevt0_def</span><span> </span><span>gets_e_def</span><span> </span><span>getspc_e_def</span><span class="delimiter">)</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c6</span><span> </span><span>c7</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>CptsPEnv</span><span class="delimiter">)</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptsEvComp</span><span> </span><span>e1</span><span> </span><span>s1</span><span> </span><span>x1</span><span> </span><span>et</span><span> </span><span>e2</span><span> </span><span>t1</span><span> </span><span>y1</span><span> </span><span>xs1</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (e1, s1, x1) -et-et&#8594; (e2, t1, y1)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>                   </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(e2, t1, y1) # xs1 &#8712; cpts_ev &#915;&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>                   </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;P. getspc_e (((e2, t1, y1) # xs1) ! 0) = AnonyEvent P 
                        &#10233; lower_evts ((e2, t1, y1) # xs1) &#8712; cpts_p &#915;&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>                   </span><span>c3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;P. getspc_e (((e1, s1, x1) # (e2, t1, y1) # xs1) ! 0) = AnonyEvent P&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c3</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>P</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c_</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (((e1, s1, x1) # (e2, t1, y1) # xs1) ! 0) = AnonyEvent P&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;e1 = AnonyEvent P&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>getspc_e_def</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;Q. e2 = AnonyEvent Q&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>clarify</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>etran.cases</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp_all</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>              </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>Q</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;e2 = AnonyEvent Q&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c6</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;lower_evts ((e2, t1, y1) # xs1) &#8712; cpts_p &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>getspc_e_def</span><span class="delimiter">)</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lower_evts ((e1, s1, x1) # (e2, t1, y1) # xs1) = 
                  (lower_anonyevt1 (e1, s1, x1)) # lower_evts ((e2, t1, y1) # xs1)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>lower_evts_def</span><span class="delimiter">)</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c7_</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lower_evts ((e2, t1, y1) # xs1) = lower_anonyevt1 (e2, t1, y1) # lower_evts xs1&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>lower_evts_def</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lower_anonyevt1 (e2, t1, y1) # lower_evts xs1 &#8712; cpts_p &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lower_anonyevt1 (e1, s1, x1) = (P, s1)&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>gets_e_def</span><span> </span><span>getspc_e_def</span><span> </span><span>lower_anonyevt1_def</span><span class="delimiter">)</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lower_anonyevt1 (e2, t1, y1) = (Q, t1)&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>gets_e_def</span><span> </span><span>getspc_e_def</span><span> </span><span>lower_anonyevt1_def</span><span class="delimiter">)</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c0</span><span> </span><span>c4</span><span> </span><span>c5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c11</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (AnonyEvent P, s1, x1) -et-et&#8594; (AnonyEvent Q, t1, y1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (P, s1) -c&#8594; (Q, t1)&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>etran.cases</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp_all</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c8</span><span> </span><span>c9</span><span> </span><span>c10</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lower_anonyevt1 (e1, s1, x1) # lower_anonyevt1 (e2, t1, y1) # lower_evts xs1 &#8712; cpts_p &#915;&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>CptsPComp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c7</span><span> </span><span>c7_</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>equiv_lower_evts2</span><span> </span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;es &#8712; cpts_of_ev &#915; (AnonyEvent P) s x &#10233; lower_evts es &#8712; cpts_p &#915; &#8743; (lower_evts es) ! 0 = (P,s)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;es &#8712; cpts_of_ev &#915; (AnonyEvent P) s x&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;es!0=(AnonyEvent P,(s,x)) &#8743; es &#8712; cpts_ev &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cpts_of_ev_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (es ! 0) = AnonyEvent P&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>getspc_e_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lower_evts es &#8712;cpts_p &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>equiv_lower_evts0</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>equiv_lower_evts0</span><span class="delimiter">)</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lower_evts es ! 0 = lower_anonyevt1 (es ! 0)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>a3</span><span> </span><span>cptn_not_empty</span><span> </span><span>list.simps</span><span class="delimiter">(</span><span>8</span><span class="delimiter">)</span><span> </span><span>list.size</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>lower_evts_def</span><span> </span><span>neq0_conv</span><span> </span><span>not_less0</span><span> </span><span>nth_equalityI</span><span> </span><span>nth_map</span><span class="delimiter">)</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lower_anonyevt1 (es ! 0) = (P,s)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>gets_e_def</span><span> </span><span>getspc_e_def</span><span> </span><span>lower_anonyevt1_def</span><span class="delimiter">)</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lower_evts es ! 0 = (P,s)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a3</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>equiv_lower_evts</span><span> </span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;es &#8712; cpts_of_ev &#915; (AnonyEvent P) s x &#10233; lower_evts es &#8712; cpts_of_p &#915; P s&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>equiv_lower_evts2</span><span class="delimiter">[</span><span>of</span><span> </span><span>es</span><span> </span><span>&#915;</span><span> </span><span>P</span><span> </span><span>s</span><span> </span><span>x</span><span class="delimiter">]</span><span> </span><span>cpts_of_p_def</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lower_evts es&quot;</span></span></span><span> </span><span>P</span><span> </span><span>s</span><span> </span><span>&#915;</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trace between of basic and anonymous events&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>evtent_in_cpts1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el &#8712; cpts_ev &#915; &#8743; el ! 0 = (BasicEvent ev, s, x) &#10233; 
      Suc i &lt; length el &#8743; &#915; &#8866; el ! i -et-(EvtEnt (BasicEvent ev))&#9839;k&#8594; el ! (Suc i) &#10233; 
      (&#8704;j. Suc j &#8804; i &#10230; getspc_e (el ! j) = BasicEvent ev &#8743; &#915; &#8866; el ! j -ee&#8594; el ! (Suc j))&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el &#8712; cpts_ev &#915; &#8743; el ! 0 = (BasicEvent ev, s, x)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length el &#8743; &#915; &#8866; el ! i -et-(EvtEnt (BasicEvent ev))&#9839;k&#8594; el ! (Suc i)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p01</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el &#8712; cpts_ev &#915;&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>                 </span><span>p02</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el ! 0 = (BasicEvent ev, s, x)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (el ! i) = BasicEvent ev&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>ent_spec</span><span class="delimiter">)</span><span> 
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. Suc j &#8804; i &#10230; getspc_e (el ! j) = BasicEvent ev &#8743; &#915; &#8866; el ! j -ee&#8594; el ! (Suc j)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>j</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc j &#8804; i&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. k &lt; i &#10230; getspc_e (el ! (i -k -1)) = BasicEvent ev &#8743; &#915; &#8866; el ! (i -k -1)-ee&#8594; el ! (i - k)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>          </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>k</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k &lt; i&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (el ! (i -k -1)) = BasicEvent ev &#8743; &#915; &#8866; el ! (i -k -1)-ee&#8594; el ! (i - k)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>k</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#8707;t ec1. &#915; &#8866; ec1-et-t&#8594;(el ! i))&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>no_tran2basic</span><span> </span><span>getspc_e_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>prod.collapse</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span>p01</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (el ! (i - 1)) = getspc_e (el ! i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>notran_confeqi</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;0.prems&quot;</span></span></span><span> </span><span>Suc_diff_1</span><span> </span><span>Suc_lessD</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p3</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>eqconf_eetran</span><span class="delimiter">)</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>m</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &lt; i &#10233; getspc_e (el ! (i - m - 1)) = BasicEvent ev 
                                    &#8743; &#915; &#8866; el ! (i - m - 1) -ee&#8594; el ! (i - m)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>                       </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc m &lt; i&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (el ! (i - m - 1)) = BasicEvent ev&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>                          </span><span>b3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; el ! (i - m - 1) -ee&#8594; el ! (i - m)&quot;</span></span></span><span>
</span><span>                            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_lessD</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>blast</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_lessD</span><span> </span><span>b0</span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc m = m + 1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#8707;t ec1. &#915; &#8866; ec1-et-t&#8594;(el ! (i - Suc m))) &quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>no_tran2basic</span><span> </span><span>getspc_e_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>diff_diff_left</span><span> </span><span>prod.collapse</span><span class="delimiter">)</span><span>  
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span>p02</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (el ! ((i - Suc m - 1))) = getspc_e (el ! (i - Suc m))&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>notran_confeqi</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>Suc_diff_1</span><span> </span><span>Suc_lessD</span><span> </span><span>b1</span><span> </span><span>diff_less</span><span> </span><span>less_trans</span><span> </span><span>p01</span><span> 
</span><span>                                          </span><span>zero_less_Suc</span><span> </span><span>zero_less_diff</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b2</span><span> </span><span>b4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (el ! ((i - Suc m - 1))) = BasicEvent ev&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>diff_diff_left</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; el ! (i - Suc m - 1) -ee&#8594; el ! (i - Suc m)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>eqconf_eetran</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b6</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>            
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Suc_le_lessD</span><span> </span><span>diff_Suc_1</span><span> </span><span>diff_Suc_less</span><span> 
</span><span>                            </span><span>diff_diff_cancel</span><span> </span><span>gr_implies_not0</span><span> </span><span>less_antisym</span><span> </span><span>zero_less_Suc</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>evtent_in_cpts2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el &#8712; cpts_ev &#915; &#8743; el ! 0 = (BasicEvent ev, s, x) &#10233; 
      Suc i &lt; length el &#8743; &#915; &#8866; el ! i -et-(EvtEnt (BasicEvent ev))&#9839;k&#8594; el ! (Suc i) &#10233; 
      (gets_e (el ! i) &#8712; guard ev &#8743; drop (Suc i) el &#8712; 
          cpts_of_ev &#915; (AnonyEvent (body ev)) (gets_e (el ! (Suc i))) ((getx_e (el ! i)) (k := BasicEvent ev)) )&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el &#8712; cpts_ev &#915; &#8743; el ! 0 = (BasicEvent ev, s, x)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length el &#8743; &#915; &#8866; el ! i -et-(EvtEnt (BasicEvent ev))&#9839;k&#8594; el ! (Suc i)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_e (el ! i) &#8712; guard ev &#8743; gets_e (el ! i) = gets_e (el ! (Suc i))
                            &#8743; getspc_e (el ! (Suc i)) = AnonyEvent (body ev)
                            &#8743; getx_e (el ! (Suc i)) = (getx_e (el ! i)) (k := BasicEvent ev)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>ent_spec2</span><span class="delimiter">)</span><span> 
</span><span>    
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(drop (Suc i) el)!0 = el ! (Suc i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(drop (Suc i) el)!0 = (AnonyEvent (body ev),(gets_e (el ! (Suc i)), 
                                          (getx_e (el ! i)) (k := BasicEvent ev) ))&quot;</span></span></span><span> 
</span><span>       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>gets_e_def</span><span> </span><span>getspc_e_def</span><span> </span><span>getx_e_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>prod.collapse</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop (Suc i) el &#8712; cpts_ev &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cpts_ev_subi</span><span> </span><span>p0</span><span> </span><span>p1</span><span class="delimiter">)</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_e (el ! i) &#8712; guard ev &#8743; drop (Suc i) el &#8712; 
          cpts_of_ev &#915; (AnonyEvent (body ev)) (gets_e (el ! (Suc i))) ((getx_e (el ! i)) (k := BasicEvent ev))&quot;</span></span></span><span>
</span><span>       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>mono_tags</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>CollectI</span><span> </span><span>cpts_of_ev_def</span><span class="delimiter">)</span><span> 
</span><span>      
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>no_evtent_in_cpts</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el &#8712; cpts_ev &#915; &#10233; el ! 0 = (BasicEvent ev, s, x) &#10233; 
      (&#172; (&#8707;i k. Suc i &lt; length el &#8743; &#915; &#8866; el ! i -et-(EvtEnt (BasicEvent ev))&#9839;k&#8594; el ! (Suc i)) ) &#10233; 
      (&#8704;j. Suc j &lt; length el &#10230; getspc_e (el ! j) = BasicEvent ev 
                                &#8743; &#915; &#8866; el ! j -ee&#8594; el ! (Suc j)
                                &#8743; getspc_e (el ! (Suc j)) = BasicEvent ev)&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>  
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el &#8712; cpts_ev &#915;&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>           </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el ! 0 = (BasicEvent ev, s, x)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>           </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (&#8707;i k. Suc i &lt; length el &#8743; &#915; &#8866; el ! i -et-(EvtEnt (BasicEvent ev))&#9839;k&#8594; el ! (Suc i))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>j</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc j &lt; length el&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (el ! j) = BasicEvent ev &#8743; &#915; &#8866; el ! j -ee&#8594; el ! (Suc j) 
                  &#8743; getspc_e (el ! (Suc j)) = BasicEvent ev&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>j</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc 0 &lt; length el&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a00</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (el ! 0) = BasicEvent ev&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>getspc_e_def</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span>p2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (&#8707;k. &#915; &#8866; el ! 0 -et-(EvtEnt (BasicEvent ev))&#9839;k&#8594; el ! (Suc 0))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (&#8707;t. &#915; &#8866; el ! 0 -et-t&#8594; el ! (Suc 0))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>noevtent_notran</span><span class="delimiter">)</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p0</span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (el ! 0) = getspc_e (el ! (Suc 0))&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>notran_confeqi</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a00</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (el ! (Suc 0)) = BasicEvent ev&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; el ! 0 -ee&#8594; el ! Suc 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>getspc_e_def</span><span> </span><span>eetran.EnvE</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>eq_fst_iff</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>a00</span><span> </span><span>a2</span><span class="delimiter">)</span><span>  
</span><span>          </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>m</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc m &lt; length el &#10233; getspc_e (el ! m) = BasicEvent ev &#8743; &#915; &#8866; el ! m -ee&#8594; el ! Suc m
                        &#8743; getspc_e (el ! Suc m) = BasicEvent ev&quot;</span></span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc (Suc m) &lt; length el&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (el ! m) = BasicEvent ev &#8743; &#915; &#8866; el ! m -ee&#8594; el ! Suc m&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (el ! Suc m) = BasicEvent ev&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>getspc_e_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>eetranE</span><span> </span><span>fstI</span><span class="delimiter">)</span><span>
</span><span>            
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;s x. el ! Suc m = (BasicEvent ev, s, x)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>getspc_e_def</span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fst_conv</span><span> </span><span>surj_pair</span><span class="delimiter">)</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>p2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (&#8707;k. &#915; &#8866; el ! (Suc m) -et-(EvtEnt (BasicEvent ev))&#9839;k&#8594; el ! (Suc (Suc m) ))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (&#8707;t. &#915; &#8866; el ! (Suc m) -et-t&#8594; el ! (Suc (Suc m)))&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>noevtent_notran</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>
</span><span>            
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p0</span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (el ! (Suc m)) = getspc_e (el ! (Suc (Suc m)))&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>notran_confeqi</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (el ! (Suc (Suc m))) = BasicEvent ev&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; el ! Suc m -ee&#8594; el ! Suc (Suc m)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>getspc_e_def</span><span> </span><span>eetran.EnvE</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>eq_fst_iff</span><span class="delimiter">)</span><span>
</span><span>
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a3</span><span> </span><span>a7</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  
</span><span class="keyword1"><span class="command">subsubsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;trace between of event and event system&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">primrec</span></span><span> </span><span>rm_evtsys0</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;l,&#39;k,&#39;s,&#39;prog) esys &#8658; &#39;s &#8658; (&#39;l,&#39;k,&#39;s,&#39;prog) x &#8658; (&#39;l,&#39;k,&#39;s,&#39;prog) econf&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>EvtSeqrm</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys0 (EvtSeq e es) s x= (e, s, x)&quot;</span></span></span><span> </span><span class="delimiter">|</span><span>
</span><span>        </span><span>EvtSysrm</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys0 (EvtSys es) s x= (AnonyEvent fin_com, s, x)&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>rm_evtsys1</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;l,&#39;k,&#39;s,&#39;prog) esconf &#8658; (&#39;l,&#39;k,&#39;s,&#39;prog) econf&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys1 esc &#8801; rm_evtsys0 (getspc_es esc) (gets_es esc) (getx_es esc)&quot;</span></span></span><span> 
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>rm_evtsys</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;l,&#39;k,&#39;s,&#39;prog) esconfs &#8658; (&#39;l,&#39;k,&#39;s,&#39;prog) econfs&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys escfs &#8801; map rm_evtsys1 escfs&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>e_eqv_einevtseq</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;l,&#39;k,&#39;s,&#39;prog) esconfs &#8658; (&#39;l,&#39;k,&#39;s,&#39;prog) econfs &#8658; (&#39;l,&#39;k,&#39;s,&#39;prog) esys &#8658; bool&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;e_eqv_einevtseq esl el es &#8801; length esl = length el &#8743; 
            (&#8704;i. Suc i &#8804; length el &#10230; gets_e (el ! i) = gets_es (esl ! i) &#8743;
                                       getx_e (el ! i) = getx_es (esl ! i) &#8743;
                                       getspc_es (esl ! i) = EvtSeq (getspc_e (el ! i)) es)&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>e_eqv_einevtseq_s</span><span> </span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;e_eqv_einevtseq esl el es; gets_e e1 = gets_es es1; getx_e e1 = getx_es es1;
                            getspc_es es1 = EvtSeq (getspc_e e1) es&#10215; &#10233; e_eqv_einevtseq (es1 # esl) (e1 # el) es&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;e_eqv_einevtseq esl el es&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_e e1 = gets_es es1&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getx_e e1 = getx_es es1&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es es1 = EvtSeq (getspc_e e1) es&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?el&#39;</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;e1 # el&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?esl&#39;</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;es1 # esl&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length esl = length el&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>e_eqv_einevtseq_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &#8804; length el &#10230; gets_e (el ! i) = gets_es (esl ! i) &#8743;
                                                 getx_e (el ! i) = getx_es (esl ! i) &#8743;
                                                 getspc_es (esl ! i) = EvtSeq (getspc_e (el ! i)) es&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>e_eqv_einevtseq_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length (es1 # esl) = length (e1 # el)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &#8804; length ?el&#39; &#10230; gets_e (?el&#39; ! i) = gets_es (?esl&#39; ! i) &#8743;
                                       getx_e (?el&#39; ! i) = getx_es (?esl&#39; ! i) &#8743;
                                       getspc_es (?esl&#39; ! i) = EvtSeq (getspc_e (?el&#39; ! i)) es&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>a2</span><span> </span><span>nth_Cons&#39;</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>p3</span><span class="delimiter">)</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;e_eqv_einevtseq ?esl&#39; ?el&#39; es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>e_eqv_einevtseq_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>       
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>same_s_x</span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;l,&#39;k,&#39;s,&#39;prog) esconfs &#8658; (&#39;l,&#39;k,&#39;s,&#39;prog) econfs &#8658; bool&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;same_s_x esl el &#8801; length esl = length el &#8743; 
            (&#8704;i. Suc i &#8804; length el &#10230; gets_e (el ! i) = gets_es (esl ! i) &#8743;
                                       getx_e (el ! i) = getx_es (esl ! i))&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rm_evtsys_same_sx</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;same_s_x esl (rm_evtsys esl)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>esl</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>Nil</span><span> 
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>rm_evtsys_def</span><span> </span><span>same_s_x_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Cons</span><span> </span><span>ec1</span><span> </span><span>esl1</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;same_s_x esl1 (rm_evtsys esl1)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys (ec1 # esl1) = rm_evtsys1 ec1 # rm_evtsys esl1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>rm_evtsys_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>es</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>s</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ec1 = (es, s, x)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>prod_cases3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>es</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>EvtSeq</span><span> </span><span>x1</span><span> </span><span>es1</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ec1 = (EvtSeq x1 es1, s, x)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys1 ec1 # rm_evtsys esl1 = (x1, s, x) # rm_evtsys esl1&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>rm_evtsys1_def</span><span> </span><span>getspc_es_def</span><span> </span><span>gets_es_def</span><span> </span><span>getx_es_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length (ec1 # esl1) = length (rm_evtsys (ec1 # esl1))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>rm_evtsys_def</span><span class="delimiter">)</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &#8804; length (rm_evtsys (ec1 # esl1)) &#10230; 
                            gets_e ((rm_evtsys (ec1 # esl1)) ! i) = gets_es ((ec1 # esl1) ! i) 
                          &#8743; getx_e ((rm_evtsys (ec1 # esl1)) ! i) = getx_es ((ec1 # esl1) ! i)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>          </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &#8804; length (rm_evtsys (ec1 # esl1))&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_e ((rm_evtsys (ec1 # esl1)) ! i) = gets_es ((ec1 # esl1) ! i) 
                          &#8743; getx_e ((rm_evtsys (ec1 # esl1)) ! i) = getx_es ((ec1 # esl1) ! i)&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i = 0&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i = 0&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>b0</span><span> </span><span>b1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>gets_e_def</span><span> </span><span>gets_es_def</span><span> </span><span>getx_e_def</span><span> </span><span>getx_es_def</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>nth_Cons_0</span><span> </span><span>snd_conv</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i &#8800; 0&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(rm_evtsys (ec1 # esl1)) ! i = (rm_evtsys esl1) ! (i - 1)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>a1</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(ec1 # esl1) ! i = esl1 ! (i - 1)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>d0</span><span> </span><span>nth_Cons&#39;</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>c0</span><span> </span><span>d0</span><span> </span><span>same_s_x_def</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Suc_diff_1</span><span> </span><span>Suc_leI</span><span> </span><span>Suc_le_lessD</span><span> 
</span><span>                      </span><span>Suc_less_eq</span><span> </span><span>a1</span><span> </span><span>length_Cons</span><span> </span><span>neq0_conv</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>        </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>same_s_x_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>EvtSys</span><span> </span><span>xa</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ec1 = (EvtSys xa, s, x)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys1 ec1 # rm_evtsys esl1 = (AnonyEvent fin_com, s, x) # rm_evtsys esl1&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>rm_evtsys1_def</span><span> </span><span>getspc_es_def</span><span> </span><span>gets_es_def</span><span> </span><span>getx_es_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length (ec1 # esl1) = length (rm_evtsys (ec1 # esl1))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>rm_evtsys_def</span><span class="delimiter">)</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &#8804; length (rm_evtsys (ec1 # esl1)) &#10230; 
                            gets_e ((rm_evtsys (ec1 # esl1)) ! i) = gets_es ((ec1 # esl1) ! i) 
                          &#8743; getx_e ((rm_evtsys (ec1 # esl1)) ! i) = getx_es ((ec1 # esl1) ! i)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>          </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &#8804; length (rm_evtsys (ec1 # esl1))&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_e ((rm_evtsys (ec1 # esl1)) ! i) = gets_es ((ec1 # esl1) ! i) 
                          &#8743; getx_e ((rm_evtsys (ec1 # esl1)) ! i) = getx_es ((ec1 # esl1) ! i)&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i = 0&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i = 0&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>b0</span><span> </span><span>b1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>gets_e_def</span><span> </span><span>gets_es_def</span><span> </span><span>getx_e_def</span><span> </span><span>getx_es_def</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>nth_Cons_0</span><span> </span><span>snd_conv</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i &#8800; 0&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(rm_evtsys (ec1 # esl1)) ! i = (rm_evtsys esl1) ! (i - 1)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>a1</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(ec1 # esl1) ! i = esl1 ! (i - 1)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>d0</span><span> </span><span>nth_Cons&#39;</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>c0</span><span> </span><span>d0</span><span> </span><span>same_s_x_def</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Suc_diff_1</span><span> </span><span>Suc_leI</span><span> </span><span>Suc_le_lessD</span><span> 
</span><span>                      </span><span>Suc_less_eq</span><span> </span><span>a1</span><span> </span><span>length_Cons</span><span> </span><span>neq0_conv</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>same_s_x_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>e_sim_es</span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;l,&#39;k,&#39;s,&#39;prog) esconfs &#8658; (&#39;l,&#39;k,&#39;s,&#39;prog) econfs 
                          &#8658; (&#39;l,&#39;k,&#39;s,&#39;prog) event set &#8658; (&#39;l,&#39;s,&#39;prog) event&#39; &#8658; bool&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;e_sim_es esl el es e &#8801; length esl = length el &#8743; getspc_es (esl!0) = EvtSys es &#8743;
                                getspc_e (el!0) = BasicEvent e &#8743;
                                (&#8704;i. i &lt; length el &#10230; gets_e (el ! i) = gets_es (esl ! i) &#8743;
                                                        getx_e (el ! i) = getx_es (esl ! i)) &#8743;
                                (&#8704;i. i &gt; 0 &#8743; i &lt; length el &#10230; 
                                    (getspc_es (esl!i) = EvtSys es &#8743; getspc_e (el!i) = AnonyEvent fin_com) 
                                      &#8744; (getspc_es (esl!i) = EvtSeq (getspc_e (el!i)) (EvtSys es))
                                 )&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Soundness of Events&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>anony_cfgs0</span><span> </span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;&#8707;P. getspc_e (es ! 0) = AnonyEvent P; es &#8712; cpts_ev &#915;&#10215; 
                      &#10233; &#8704;i. (i &lt; length es &#10230; (&#8707;Q. getspc_e (es!i) = AnonyEvent Q) )&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;es &#8712; cpts_ev &#915;&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;P. getspc_e (es ! 0) = AnonyEvent P&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. (i &lt; length es &#10230; (&#8707;Q. getspc_e (es!i) = AnonyEvent Q) )&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>es</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptsEvOne</span><span> </span><span>e</span><span> </span><span>s</span><span> </span><span>x</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;P. getspc_e ([(e, s, x)] ! 0) = AnonyEvent P&quot;</span></span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptsEvEnv</span><span> </span><span>e&#39;</span><span> </span><span>t&#39;</span><span> </span><span>x&#39;</span><span> </span><span>xs&#39;</span><span> </span><span>s&#39;</span><span> </span><span>y&#39;</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(e&#39;, t&#39;, x&#39;) # xs&#39; &#8712; cpts_ev &#915;&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>               </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;P. getspc_e (((e&#39;, t&#39;, x&#39;) # xs&#39;) ! 0) = AnonyEvent P &#10233;
                    &#8704;i&lt;length ((e&#39;, t&#39;, x&#39;) # xs&#39;). &#8707;Q. getspc_e (((e&#39;, t&#39;, x&#39;) # xs&#39;) ! i) = AnonyEvent Q&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>               </span><span>b2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;P. getspc_e (((e&#39;, s&#39;, y&#39;) # (e&#39;, t&#39;, x&#39;) # xs&#39;) ! 0) = AnonyEvent P&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b2</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>P1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>b3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (((e&#39;, s&#39;, y&#39;) # (e&#39;, t&#39;, x&#39;) # xs&#39;) ! 0) = AnonyEvent P1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;e&#39; = AnonyEvent P1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>getspc_e_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length ((e&#39;, t&#39;, x&#39;) # xs&#39;). &#8707;Q. getspc_e (((e&#39;, t&#39;, x&#39;) # xs&#39;) ! i) = AnonyEvent Q&quot;</span></span></span><span>  
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>getspc_e_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b4</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>hide_lams</span><span class="delimiter">)</span><span> </span><span>Ex_list_of_length</span><span> </span><span>b3</span><span> </span><span>gr0_conv_Suc</span><span> 
</span><span>                        </span><span>length_Cons</span><span> </span><span>length_tl</span><span> </span><span>list.sel</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>not_less_eq</span><span> </span><span>nth_non_equal_first_eq</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptsEvComp</span><span> </span><span>e1</span><span> </span><span>s1</span><span> </span><span>x1</span><span> </span><span>et</span><span> </span><span>e2</span><span> </span><span>t1</span><span> </span><span>y1</span><span> </span><span>xs1</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (e1, s1, x1) -et-et&#8594; (e2, t1, y1)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>               </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(e2, t1, y1) # xs1 &#8712; cpts_ev &#915;&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>               </span><span>b2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;P. getspc_e (((e2, t1, y1) # xs1) ! 0) = AnonyEvent P &#10233;
                    &#8704;i&lt;length ((e2, t1, y1) # xs1). &#8707;Q. getspc_e (((e2, t1, y1) # xs1) ! i) = AnonyEvent Q&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>               </span><span>b3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;P. getspc_e (((e1, s1, x1) # (e2, t1, y1) # xs1) ! 0) = AnonyEvent P&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b3</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>P1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>b4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (((e1, s1, x1) # (e2, t1, y1) # xs1) ! 0) = AnonyEvent P1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;e1 = AnonyEvent P1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>getspc_e_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;Q. e2 = AnonyEvent Q&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>clarify</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>etran.cases</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp_all</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>              </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;P. getspc_e (((e2, t1, y1) # xs1) ! 0) = AnonyEvent P&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>getspc_e_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length ((e2, t1, y1) # xs1). &#8707;Q. getspc_e (((e2, t1, y1) # xs1) ! i) = AnonyEvent Q&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b5</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>hide_lams</span><span class="delimiter">)</span><span> </span><span>Ex_list_of_length</span><span> </span><span>b3</span><span> </span><span>gr0_conv_Suc</span><span> 
</span><span>                        </span><span>length_Cons</span><span> </span><span>length_tl</span><span> </span><span>list.sel</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>not_less_eq</span><span> </span><span>nth_non_equal_first_eq</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>anony_cfgs</span><span> </span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;es &#8712; cpts_of_ev &#915; (AnonyEvent P) s x  &#10233; &#8704;i. (i &lt; length es &#10230; (&#8707;Q. getspc_e (es!i) = AnonyEvent Q) )&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;es &#8712; cpts_of_ev &#915; (AnonyEvent P) s x&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;es!0=(AnonyEvent P,(s,x)) &#8743; es &#8712; cpts_ev &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>cpts_of_ev_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;P. getspc_e (es ! 0) = AnonyEvent P&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>getspc_e_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>anony_cfgs0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>AnonyEvt_sound</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8872; P sat<span class="hidden">&#8681;</span><sub>p</sub> [pre, rely, guar, post] &#10233; &#915; &#8872; AnonyEvent P sat<span class="hidden">&#8681;</span><sub>e</sub> [pre, rely, guar, post]&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8872; P sat<span class="hidden">&#8681;</span><sub>p</sub> [pre, rely, guar, post]&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s. cpts_of_p &#915; P s &#8745; assume_p &#915; (pre, rely) &#8838; commit_p &#915; (guar, post)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>prog_validity_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s x. (cpts_of_ev &#915; (AnonyEvent P) s x) &#8745; assume_e &#915; (pre, rely) 
                      &#8838; commit_e &#915; (guar, post)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>s</span><span> </span><span>x</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;el. el&#8712;(cpts_of_ev &#915; (AnonyEvent P) s x) &#8745; assume_e &#915; (pre, rely) &#10230; el&#8712; commit_e &#915; (guar, post)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>          </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>el</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el&#8712;(cpts_of_ev &#915; (AnonyEvent P) s x) &#8745; assume_e &#915; (pre, rely)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>pl</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;pl = lower_evts el&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;pl &#8712; cpts_of_p &#915; P s&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>equiv_lower_evts</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b21</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;pl &#8712; cpts_p &#915; &#8743; pl!0 = (P,s)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>equiv_lower_evts2</span><span class="delimiter">[</span><span>of</span><span> </span><span>el</span><span> </span><span>&#915;</span><span> </span><span>P</span><span> </span><span>s</span><span> </span><span>x</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el!0=(AnonyEvent P,(s,x))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>b4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el &#8712; cpts_ev &#915;&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>cpts_of_ev_def</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el &#8712; assume_e &#915; (pre, rely)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            </span><span class="keyword1"><span class="command">hence</span></span><span> </span><span>b51</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_e (el!0) &#8712; pre&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_e_def</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b1</span><span> </span><span>b21</span><span> </span><span>b3</span><span> </span><span>b51</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_p (pl!0) &#8712; pre&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>gets_p_def</span><span> </span><span>gets_e_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length pl &#10230; 
               &#915; &#8866; pl!i -pe&#8594; pl!(Suc i) &#10230; (gets_p (pl!i), gets_p (pl!Suc i)) &#8712; rely&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>              </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length pl&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; pl!i -pe&#8594; pl!(Suc i)&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b1</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length el&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>lower_evts_def</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_p (pl!i) = getspc_p (pl!(Suc i))&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>getspc_p_def</span><span> </span><span>fst_conv</span><span> </span><span>petran_simps</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>prod.collapse</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lower_anonyevt1 (el!i) = pl!i&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Suc_lessD</span><span> </span><span>c2</span><span> </span><span>lower_evts_def</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lower_anonyevt1 (el!Suc i) = pl!Suc i&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Suc_lessD</span><span> </span><span>c2</span><span> </span><span>lower_evts_def</span><span class="delimiter">)</span><span> 
</span><span>                
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span>c2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;Q. getspc_e (el!i) = AnonyEvent Q&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>Int_iff</span><span> </span><span>Suc_lessD</span><span> </span><span>anony_cfgs</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>Q1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c71</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (el!i) = AnonyEvent Q1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span>c2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;Q. getspc_e (el ! (Suc i)) = AnonyEvent Q&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>Int_iff</span><span> </span><span>anony_cfgs</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>Q2</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c81</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (el ! (Suc i)) = AnonyEvent Q2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c4</span><span> </span><span>c71</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_p (pl ! i) = Q1&quot;</span></span></span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>lower_anonyevt1_def</span><span> </span><span>AnonyEv</span><span> </span><span>getspc_p_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fst_conv</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c5</span><span> </span><span>c81</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_p (pl ! (Suc i)) = Q2&quot;</span></span></span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>lower_anonyevt1_def</span><span> </span><span>AnonyEv</span><span> </span><span>getspc_p_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fst_conv</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c3</span><span> </span><span>c9</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c11</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Q1 = Q2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c4</span><span> </span><span>c71</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c61</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_p (pl!i) = gets_e (el!i)&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>lower_anonyevt1_def</span><span> </span><span>AnonyEv</span><span> </span><span>gets_p_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>snd_conv</span><span class="delimiter">)</span><span>
</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c5</span><span> </span><span>c81</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c62</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_p (pl! (Suc i)) = gets_e (el! (Suc i))&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>lower_anonyevt1_def</span><span> </span><span>AnonyEv</span><span> </span><span>gets_p_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>snd_conv</span><span class="delimiter">)</span><span>
</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c71</span><span> </span><span>c81</span><span> </span><span>c11</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c12</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (el!i) = getspc_e (el!(Suc i))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c13</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; el!i -ee&#8594; el!(Suc i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>eetran.EnvE</span><span> </span><span>getspc_e_def</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>prod.collapse</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b5</span><span> </span><span>c2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;i. Suc i &lt; length el &#10230; &#915; &#8866; el ! i -ee&#8594; el ! Suc i 
                      &#10230; (gets_e (el ! i), gets_e (el ! Suc i)) &#8712; rely)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_e_def</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c2</span><span> </span><span>c13</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_e (el!i), gets_e (el!Suc i)) &#8712; rely&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c61</span><span> </span><span>c62</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_p (pl!i), gets_p (pl!Suc i)) &#8712; rely&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>              </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;pl &#8712; assume_p &#915; (pre, rely)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_p_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a1</span><span> </span><span>b2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;pl &#8712; commit_p &#915; (guar, post)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;i. Suc i&lt;length el &#10230; 
               (&#8707;t. &#915; &#8866; el!i -et-t&#8594; el!(Suc i)) &#10230; (gets_e (el!i), gets_e (el!Suc i)) &#8712; guar)&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>               </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>                 </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>                 </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length el&quot;</span></span></span><span>
</span><span>                 </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;t. &#915; &#8866; el!i -et-t&#8594; el!(Suc i)&quot;</span></span></span><span>
</span><span>                 </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b1</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length pl&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>lower_evts_def</span><span class="delimiter">)</span><span>
</span><span>                 
</span><span>                 </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lower_anonyevt1 (el!i) = pl!i&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Suc_lessD</span><span> </span><span>c0</span><span> </span><span>lower_evts_def</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lower_anonyevt1 (el!Suc i) = pl!Suc i&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Suc_lessD</span><span> </span><span>c0</span><span> </span><span>lower_evts_def</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;Q. getspc_e (el!i) = AnonyEvent Q&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>Int_iff</span><span> </span><span>Suc_lessD</span><span> </span><span>anony_cfgs</span><span class="delimiter">)</span><span> 
</span><span>                 </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>Q1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c71</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (el!i) = AnonyEvent Q1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;Q. getspc_e (el ! (Suc i)) = AnonyEvent Q&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>Int_iff</span><span> </span><span>anony_cfgs</span><span class="delimiter">)</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>Q2</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c81</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (el! (Suc i)) = AnonyEvent Q2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; pl!i -c&#8594; pl!(Suc i)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c1</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>t</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; el!i -et-t&#8594; el!(Suc i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s1</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;s1 = gets_e (el ! i) &#8743; x1 = getx_e (el ! i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s2</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x2</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>d2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;s2 = gets_e (el ! (Suc i)) &#8743; x2 = getx_e (el ! (Suc i))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d1</span><span> </span><span>c71</span><span> </span><span>c81</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d21</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el ! i = (AnonyEvent Q1, s1, x1) 
                                           &#8743; el ! (Suc i) = (AnonyEvent Q2, s2, x2)&quot;</span></span></span><span> 
</span><span>                         </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>gets_e_def</span><span> </span><span>getx_e_def</span><span> </span><span>getspc_e_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>prod.collapse</span><span class="delimiter">)</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (AnonyEvent Q1, s1, x1) -et-t&#8594; (AnonyEvent Q2, s2, x2)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;k. t = ((Cmd CMP)&#9839;k)&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>etran.cases</span><span class="delimiter">)</span><span>
</span><span>                      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp_all</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>k</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;t = ((Cmd CMP)&#9839;k)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (Q1,s1) -c&#8594; (Q2, s2)&quot;</span></span></span><span> 
</span><span>                      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>clarify</span><span class="delimiter">)</span><span>
</span><span>                      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>etran.cases</span><span class="delimiter">)</span><span>
</span><span>                      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp_all</span><span class="delimiter">+</span><span>
</span><span>                      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c3</span><span> </span><span>d21</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;pl!i = (Q1,s1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>lower_anonyevt1_def</span><span> </span><span>getspc_e_def</span><span> </span><span>gets_e_def</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c4</span><span> </span><span>d21</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;pl! (Suc i) = (Q2,s2)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>lower_anonyevt1_def</span><span> </span><span>getspc_e_def</span><span> </span><span>gets_e_def</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d4</span><span> </span><span>d5</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                 </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b9</span><span> </span><span>c2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_p (pl!i), gets_p (pl!Suc i)) &#8712; guar&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>commit_p_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span>                 
</span><span>                 </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c3</span><span> </span><span>c71</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_e (el!i) = gets_p (pl!i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>lower_anonyevt_s</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c4</span><span> </span><span>c81</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_e (el!Suc i) = gets_p (pl!Suc i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>lower_anonyevt_s</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>                 </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c6</span><span> </span><span>c9</span><span> </span><span>c10</span><span> </span><span class="keyword1"><span class="command">have</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_e (el!i), gets_e (el!Suc i)) &#8712; guar&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>               </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>               </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b11</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(getspc_e (last el) = AnonyEvent fin_com &#10230; gets_e (last el) &#8712; post)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span> 
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (last el) = AnonyEvent fin_com&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;last pl = lower_anonyevt1 (last el)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>b4</span><span> </span><span>cpts_e_not_empty</span><span> </span><span>last_map</span><span> </span><span>lower_evts_def</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b9</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_p (last pl) = fin_com &#10230; gets_p (last pl) &#8712; post&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>commit_p_def</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c0</span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_p (last pl) = fin_com&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>getspc_p_def</span><span> </span><span>lower_anonyevt1_def</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_p (last pl) &#8712; post&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c0</span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_p (last pl) = gets_e (last el)&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>getspc_p_def</span><span> </span><span>lower_anonyevt1_def</span><span> </span><span>gets_p_def</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c4</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_e (last el) &#8712; post&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>            
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b10</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el &#8712; commit_e &#915; (guar, post)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>commit_e_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span>          </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(cpts_of_ev &#915; (AnonyEvent P) s x) &#8745; assume_e &#915; (pre, rely) &#8838; commit_e &#915; (guar, post)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>evt_validity_def</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>BasicEvt_sound</span><span class="delimiter">:</span><span> 
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214; &#915; &#8872; (body ev) sat<span class="hidden">&#8681;</span><sub>p</sub> [pre &#8745; (guard ev), rely, guar, post]; 
        stable_e pre rely; &#8704;s. (s, s)&#8712;guar&#10215; 
     &#10233; &#915; &#8872; ((BasicEvent ev)::(&#39;l,&#39;k,&#39;s,&#39;prog) event) sat<span class="hidden">&#8681;</span><sub>e</sub> [pre, rely, guar, post]&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8872; (body ev) sat<span class="hidden">&#8681;</span><sub>p</sub> [pre &#8745; (guard ev), rely, guar, post]&quot;</span></span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s. (s, s)&#8712;guar&quot;</span></span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;stable_e pre rely&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s x. (cpts_of_ev &#915; ((BasicEvent ev)::(&#39;l,&#39;k,&#39;s,&#39;prog) event) s x) &#8745; assume_e &#915; (pre, rely) 
                      &#8838; commit_e &#915; (guar, post)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>s</span><span> </span><span>x</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;el. el&#8712;(cpts_of_ev &#915; (BasicEvent ev) s x) &#8745; assume_e &#915; (pre, rely) &#10230; el&#8712; commit_e &#915; (guar, post)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>          </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>el</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el&#8712;(cpts_of_ev &#915; (BasicEvent ev) s x) &#8745; assume_e &#915; (pre, rely)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b0_1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el&#8712;(cpts_of_ev &#915; (BasicEvent ev) s x)&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>                      </span><span>b0_2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el &#8712; assume_e &#915; (pre, rely)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0_1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el ! 0 = (BasicEvent ev, (s, x))&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>                           </span><span>b2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el &#8712; cpts_ev &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>cpts_of_ev_def</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0_2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_e (el!0) &#8712; pre&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>                           </span><span>b4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;i. Suc i&lt;length el &#10230; &#915; &#8866; el!i -ee&#8594; el!(Suc i) &#10230; 
                                (gets_e (el!i), gets_e (el!Suc i)) &#8712; rely)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>assume_e_def</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el&#8712; commit_e &#915; (guar, post)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;i k. Suc i &lt; length el &#8743; &#915; &#8866; el ! i -et-(EvtEnt (BasicEvent ev))&#9839;k&#8594; el ! (Suc i)&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;i k. Suc i &lt; length el &#8743; &#915; &#8866; el ! i -et-(EvtEnt (BasicEvent ev))&#9839;k&#8594; el ! (Suc i)&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>m</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>k</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc m &lt; length el &#8743; &#915; &#8866; el ! m -et-(EvtEnt (BasicEvent ev))&#9839;k&#8594; el ! (Suc m)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b1</span><span> </span><span>b2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. Suc j &#8804; m &#10230; getspc_e (el ! j) = BasicEvent ev &#8743; &#915; &#8866; el ! j -ee&#8594; el ! (Suc j)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>evtent_in_cpts1</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b1</span><span> </span><span>b2</span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_e (el ! m) &#8712; guard ev&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>                        </span><span>c6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop (Suc m) el &#8712; cpts_of_ev &#915; (AnonyEvent (body ev)) (gets_e (el ! (Suc m))) ((getx_e (el ! m)) (k := BasicEvent ev))&quot;</span></span></span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtent_in_cpts2</span><span class="delimiter">[</span><span>of</span><span> </span><span>el</span><span> </span><span>&#915;</span><span> </span><span>ev</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>m</span><span> </span><span>k</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span> </span><span>c4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8872; ((AnonyEvent (body ev))::(&#39;l,&#39;k,&#39;s,&#39;prog) event) 
                                sat<span class="hidden">&#8681;</span><sub>e</sub> [pre &#8745; (guard ev), rely, guar, post]&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>AnonyEvt_sound</span><span class="delimiter">)</span><span> 
</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b4</span><span> </span><span>c1</span><span> </span><span>c2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c8</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. Suc j &#8804; m &#10230; (gets_e (el ! j), gets_e (el ! (Suc j))) &#8712; rely&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p2</span><span> </span><span>b3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. j &#8804; m &#10230; gets_e (el ! j) &#8712; pre&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>                    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>j</span><span>
</span><span>                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j &#8804; m&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_e (el ! j) &#8712; pre&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>j</span><span class="delimiter">)</span><span>
</span><span>                        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>b3</span><span class="delimiter">)</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>jj</span><span class="delimiter">)</span><span>
</span><span>                        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc jj &#8804; m&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>e1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;jj &#8804; m &#10233; gets_e (el ! jj) &#8712; pre&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>e0</span><span> </span><span>c8</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_e (el ! jj), gets_e (el ! (Suc jj))) &#8712; rely&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p2</span><span> </span><span>e0</span><span> </span><span>e1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>Suc_leD</span><span> </span><span>stable_e_def</span><span class="delimiter">)</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_e (el ! m) = gets_e (el ! (Suc m))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>ent_spec2</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c9</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c11</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_e (el ! (Suc m)) &#8712; pre&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c7</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c12</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s x. (cpts_of_ev &#915; ((AnonyEvent (body ev))::(&#39;l,&#39;k,&#39;s,&#39;prog) event) s x) &#8745; 
                    assume_e &#915; (pre &#8745; (guard ev), rely) &#8838; commit_e &#915; (guar, post)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>evt_validity_def</span><span class="delimiter">)</span><span>
</span><span>                
</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop (Suc m) el &#8712; assume_e &#915; (pre &#8745; (guard ev), rely)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c11</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_e (drop (Suc m) el ! 0) &#8712; pre&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c4</span><span> </span><span>c10</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_e (drop (Suc m) el ! 0) &#8712; guard ev&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length el - Suc m &#10230;
                             &#915; &#8866; el ! Suc (m + i) -ee&#8594; el ! Suc (Suc (m + i)) &#10230; 
                             (gets_e (el ! Suc (m + i)), gets_e (el ! Suc (Suc (m + i)))) &#8712; rely&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d1</span><span> </span><span>d2</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_e_def</span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c6</span><span> </span><span>c12</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c13</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop (Suc m) el &#8712; commit_e &#915; (guar, post)&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>AnonyEvt_sound</span><span> </span><span>IntI</span><span> </span><span>contra_subsetD</span><span> </span><span>evt_validity_def</span><span> </span><span>p0</span><span class="delimiter">)</span><span>
</span><span>               
</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c14</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length el &#10230; (&#8707;t. &#915; &#8866; el ! i -et-t&#8594; el ! Suc i) 
                    &#10230; (gets_e (el ! i), gets_e (el ! Suc i)) &#8712; guar&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>                    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span> 
</span><span>                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length el&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>                           </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8707;t. &#915; &#8866; el ! i -et-t&#8594; el ! Suc i)&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_e (el ! i), gets_e (el ! Suc i)) &#8712; guar&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &#8804; m&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &#8804; m&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; el ! i -ee&#8594; el ! (Suc i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#8707;t. &#915; &#8866; el ! i -et-t&#8594; el ! Suc i)&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>eetranE</span><span> </span><span>evt_not_eq_in_tran</span><span> </span><span>prod.collapse</span><span class="delimiter">)</span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; Suc i &#8804; m&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &gt; m&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                        </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i = m + 1&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>f0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i = m + 1&quot;</span></span></span><span>
</span><span>                            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i = m&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; el ! i -et-(EvtEnt (BasicEvent ev))&#9839;k&#8594; el ! (Suc i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_e (el ! i) = gets_e (el ! (Suc i))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>ent_spec2</span><span class="delimiter">)</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                          </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>f0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; Suc i = m + 1&quot;</span></span></span><span>
</span><span>                            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>e1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &gt; Suc m&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c13</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length (drop (Suc m) el) &#10230; 
                                    (&#8707;t. &#915; &#8866; (drop (Suc m) el) ! i -et-t&#8594; (drop (Suc m) el) ! Suc i) &#10230; 
                                    (gets_e ((drop (Suc m) el) ! i), gets_e ((drop (Suc m) el) ! Suc i)) &#8712; guar&quot;</span></span></span><span>
</span><span>                                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>commit_e_def</span><span class="delimiter">)</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d0</span><span> </span><span>d1</span><span> </span><span>f1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_e (drop (Suc m) el ! (i - Suc m)), gets_e (drop (Suc m) el ! Suc (i - Suc m))) &#8712; guar&quot;</span></span></span><span>
</span><span>                              </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d0</span><span> </span><span>f1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>g0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc (i - Suc m) &lt; length (drop (Suc m) el)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d1</span><span> </span><span>f1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8707;t. &#915; &#8866; drop (Suc m) el ! (i - Suc m) -et-t&#8594; drop (Suc m) el ! Suc (i - Suc m))&quot;</span></span></span><span>
</span><span>                                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>g0</span><span> </span><span>f2</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c1</span><span> </span><span>f1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                   </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c13</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c15</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; getspc_e (last el) = AnonyEvent fin_com &#10230; gets_e (last el) &#8712; post&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;last (drop (Suc m) el) = last el&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c13</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>commit_e_def</span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c14</span><span> </span><span>c15</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>commit_e_def</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (&#8707;i k. Suc i &lt; length el &#8743; &#915; &#8866; el ! i -et-(EvtEnt (BasicEvent ev))&#9839;k&#8594; el ! (Suc i) )&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b1</span><span> </span><span>b2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. Suc j &lt; length el &#10230; getspc_e (el ! j) = BasicEvent ev 
                              &#8743; &#915; &#8866; el ! j -ee&#8594; el ! (Suc j)
                              &#8743; getspc_e (el ! (Suc j)) = BasicEvent ev&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>no_evtent_in_cpts</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;i. Suc i&lt;length el &#10230; (&#8707;t. &#915; &#8866; el!i -et-t&#8594; el!(Suc i)) 
                          &#10230; (gets_e (el!i), gets_e (el!Suc i)) &#8712; guar)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>                    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length el&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;t. &#915; &#8866; el!i -et-t&#8594; el!(Suc i)&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; el ! i -ee&#8594; el ! Suc i&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (&#8707;t. &#915; &#8866; el!i -et-t&#8594; el!(Suc i))&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>eetranE</span><span> </span><span>evt_not_eq_in_tran2</span><span> </span><span>prod.collapse</span><span class="delimiter">)</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>False</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b1</span><span> </span><span>b2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el &#8800; []&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_e_not_empty</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b1</span><span> </span><span>b2</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>els</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el = (BasicEvent ev, s, x) # els&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>hd_Cons_tl</span><span> </span><span>hd_conv_nth</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (last el) = BasicEvent ev&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>els</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>Nil</span><span>
</span><span>                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el = [(BasicEvent ev, s, x)]&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;last el = (BasicEvent ev, s, x)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>getspc_e_def</span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                    </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Cons</span><span> </span><span>els1</span><span> </span><span>elsr</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el = (BasicEvent ev, s, x) # els1 # elsr&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length el &gt; 1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d0</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>mm</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>d2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc mm = length el&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d1</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>jj</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>d3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc jj = mm&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;last el = el ! mm&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Cons_nth_drop_Suc</span><span> </span><span>drop_eq_Nil</span><span> </span><span>last_ConsL</span><span> </span><span>last_drop</span><span> </span><span>le_eq_less_or_eq</span><span> </span><span>lessI</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (el ! (Suc jj)) = BasicEvent ev&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>d2</span><span> </span><span>d3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d3</span><span> </span><span>d4</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (last el) = AnonyEvent fin_com &#10230; gets_e (last el) &#8712; post&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                  
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c2</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>commit_e_def</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>evt_validity_def</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>ev_seq_sound</span><span class="delimiter">:</span><span> 
</span><span>      </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;pre &#8838; pre&#39;; rely &#8838; rely&#39;; guar&#39; &#8838; guar; post&#39; &#8838; post;
        &#915; &#8872; ev sat<span class="hidden">&#8681;</span><sub>e</sub> [pre&#39;, rely&#39;, guar&#39;, post&#39;]&#10215; 
    &#10233; &#915; &#8872; ev sat<span class="hidden">&#8681;</span><sub>e</sub> [pre, rely, guar, post]&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;pre &#8838; pre&#39;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rely &#8838; rely&#39;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;guar&#39; &#8838; guar&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;post&#39; &#8838; post&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8872; ev sat<span class="hidden">&#8681;</span><sub>e</sub> [pre&#39;, rely&#39;, guar&#39;, post&#39;]&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s x. (cpts_of_ev &#915; ev s x) &#8745; assume_e &#915; (pre&#39;, rely&#39;) &#8838; commit_e &#915; (guar&#39;, post&#39;)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>evt_validity_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s x. (cpts_of_ev &#915; ev s x) &#8745; assume_e &#915; (pre, rely) &#8838; commit_e &#915; (guar, post)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>c</span><span> </span><span>s</span><span> </span><span>x</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;(cpts_of_ev &#915; ev s x) &#8745; assume_e &#915; (pre, rely)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;(cpts_of_ev &#915; ev s x) &#8743; c&#8712;assume_e &#915; (pre, rely)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;(cpts_of_ev &#915; ev s x) &#8743; c&#8712;assume_e &#915; (pre&#39;, rely&#39;)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assume_e_imp</span><span class="delimiter">[</span><span>of</span><span> </span><span>pre</span><span> </span><span>pre&#39;</span><span> </span><span>rely</span><span> </span><span>rely&#39;</span><span> </span><span>c</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;commit_e &#915; (guar&#39;, post&#39;)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p2</span><span> </span><span>p3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;commit_e &#915; (guar, post)&quot;</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>commit_e_imp</span><span class="delimiter">[</span><span>of</span><span> </span><span>guar&#39;</span><span> </span><span>guar</span><span> </span><span>post&#39;</span><span> </span><span>post</span><span> </span><span>c</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>evt_validity_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">theorem</span></span><span> </span><span>rgsound_e</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; Evt sat<span class="hidden">&#8681;</span><sub>e</sub> [pre, rely, guar, post] &#10233; &#915; &#8872; Evt sat<span class="hidden">&#8681;</span><sub>e</sub> [pre, rely, guar, post]&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>erule</span><span> </span><span>rghoare_e.induct</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>AnonyEvt_sound</span><span> </span><span>rgsound_p</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>BasicEvt_sound</span><span> </span><span>rgsound_p</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>ev_seq_sound</span><span> </span><span>rgsound_p</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>  
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Soundness of Event Systems&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>evtseq_nfin_samelower</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;esl &#8712; cpts_of_es &#915; (EvtSeq e es) s x; &#8704;i. Suc i &#8804; length esl &#10230; getspc_es (esl ! i) &#8800; es&#10215; 
        &#10233; (&#8707;el. (el &#8712; cpts_of_ev &#915; e s x &#8743; length esl = length el &#8743; e_eqv_einevtseq esl el es))&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl &#8712; cpts_of_es &#915; (EvtSeq e es) s x&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &#8804; length esl &#10230; getspc_es (esl ! i) &#8800; es&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p01</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl ! 0 = (EvtSeq e es, s, x) &#8743; esl &#8712; cpts_es &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cpts_of_es_def</span><span class="delimiter">)</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p01_1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl ! 0 = (EvtSeq e es, s, x)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e. getspc_es (esl ! 0) = EvtSeq e es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>getspc_es_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p01</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p01_2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl &#8712; cpts_es &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?el</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys esl&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length esl = length ?el&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>rm_evtsys_def</span><span class="delimiter">)</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el &#8712; cpts_of_ev &#915; e s x&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p01_2</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el &#8712; cpts_ev &#915;&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>esl</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptsEsOne</span><span> </span><span>es1</span><span> </span><span>s1</span><span> </span><span>x1</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e. getspc_es ([(es1, s1, x1)] ! 0) = EvtSeq e es&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>e1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es ([(es1, s1, x1)] ! 0) = EvtSeq e1 es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;es1 = EvtSeq e1 es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>getspc_es_def</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys1 (es1, s1, x1) = (e1, s1, x1)&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>gets_es_def</span><span> </span><span>getspc_es_def</span><span> </span><span>rm_evtsys1_def</span><span> </span><span>getx_es_def</span><span class="delimiter">)</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys [(es1, s1, x1)] = [(e1, s1, x1)]&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>rm_evtsys_def</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cpts_ev.CptsEvOne</span><span class="delimiter">)</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptsEsEnv</span><span> </span><span>es1</span><span> </span><span>t1</span><span> </span><span>x1</span><span> </span><span>xs1</span><span> </span><span>s1</span><span> </span><span>y1</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(es1, t1, x1) # xs1 &#8712; cpts_es &#915;&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &#8804; length ((es1, t1, x1) # xs1) &#10230; getspc_es (((es1, t1, x1) # xs1) ! i) &#8800; es
                            &#10233;&#8707;e. getspc_es (((es1, t1, x1) # xs1) ! 0) = EvtSeq e es 
                            &#10233; rm_evtsys ((es1, t1, x1) # xs1) &#8712; cpts_ev &#915;&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>c11</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &#8804; length ((es1, s1, y1) # (es1, t1, x1) # xs1) 
                                  &#10230; getspc_es (((es1, s1, y1) # (es1, t1, x1) # xs1) ! i) &#8800; es&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e. getspc_es (((es1, s1, y1) # (es1, t1, x1) # xs1) ! 0) = EvtSeq e es&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c2</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>e1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (((es1, s1, y1) # (es1, t1, x1) # xs1) ! 0) = EvtSeq e1 es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;es1 = EvtSeq e1 es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>getspc_es_def</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c11</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &#8804; length ((es1, t1, x1) # xs1) &#10230; getspc_es (((es1, t1, x1) # xs1) ! i) &#8800; es&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c1</span><span> </span><span>c4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys ((es1, t1, x1) # xs1) &#8712; cpts_ev &#915;&quot;</span></span></span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>getspc_es_def</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys ((es1, t1, x1) # xs1) = (rm_evtsys1 (es1, t1, x1)) # (rm_evtsys xs1)&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>rm_evtsys_def</span><span class="delimiter">)</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys ((es1, s1, y1) # (es1, t1, x1) # xs1) = 
                  (rm_evtsys1 (es1, s1, y1)) # (rm_evtsys1 (es1, t1, x1)) # (rm_evtsys xs1)&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>rm_evtsys_def</span><span class="delimiter">)</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys1 (es1, s1, y1) = (e1, s1, y1)&quot;</span></span></span><span> 
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>gets_es_def</span><span> </span><span>getspc_es_def</span><span> </span><span>rm_evtsys1_def</span><span> </span><span>getx_es_def</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys1 (es1, t1, x1) = (e1, t1, x1)&quot;</span></span></span><span> 
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>gets_es_def</span><span> </span><span>getspc_es_def</span><span> </span><span>rm_evtsys1_def</span><span> </span><span>getx_es_def</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys ((es1, s1, y1) # (es1, t1, x1) # xs1) = (e1, s1, y1) # (e1, t1, x1) # rm_evtsys xs1&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>c7</span><span> </span><span>c8</span><span> </span><span>c9</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys ((es1, t1, x1) # xs1) = (e1, t1, x1) # rm_evtsys xs1&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>c6</span><span> </span><span>c9</span><span class="delimiter">)</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c5</span><span> </span><span>c10</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cpts_ev.CptsEvEnv</span><span class="delimiter">)</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptsEsComp</span><span> </span><span>es1</span><span> </span><span>s1</span><span> </span><span>x1</span><span> </span><span>et</span><span> </span><span>es2</span><span> </span><span>t1</span><span> </span><span>y1</span><span> </span><span>xs1</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (es1, s1, x1) -es-et&#8594; (es2, t1, y1)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(es2, t1, y1) # xs1 &#8712; cpts_es &#915;&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &#8804; length ((es2, t1, y1) # xs1) &#10230; getspc_es (((es2, t1, y1) # xs1) ! i) &#8800; es
                            &#10233; &#8707;e. getspc_es (((es2, t1, y1) # xs1) ! 0) = EvtSeq e es 
                            &#10233; rm_evtsys ((es2, t1, y1) # xs1) &#8712; cpts_ev &#915;&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>c3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &#8804; length ((es1, s1, x1) # (es2, t1, y1) # xs1)
                              &#10230; getspc_es (((es1, s1, x1) # (es2, t1, y1) # xs1) ! i) &#8800; es&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>c4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e. getspc_es (((es1, s1, x1) # (es2, t1, y1) # xs1) ! 0) = EvtSeq e es&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c4</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>e1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c41</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (((es1, s1, x1) # (es2, t1, y1) # xs1) ! 0) = EvtSeq e1 es&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;es1 = EvtSeq e1 es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>getspc_es_def</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (es2, t1, y1) &#8800; es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;es2 &#8800; es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>getspc_es_def</span><span class="delimiter">)</span><span>
</span><span>              
</span><span>              </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c0</span><span> </span><span>c5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e2. es2 = EvtSeq e2 es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>evtseq_tran_evtsys</span><span class="delimiter">)</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>e2</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;es2 = EvtSeq e2 es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c0</span><span> </span><span>c5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;t. &#915; &#8866; (e1,s1,x1) -et-t&#8594; (e2,t1,y1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>evtseq_tran_exist_etran</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>t</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c71</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (e1,s1,x1) -et-t&#8594; (e2,t1,y1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys ((es1, s1, x1) # (es2, t1, y1) # xs1) = 
                  (rm_evtsys1 (es1, s1, x1)) # (rm_evtsys1 (es2, t1, y1)) # (rm_evtsys xs1)&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>rm_evtsys_def</span><span class="delimiter">)</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys ((es2, t1, y1) # xs1) = rm_evtsys1 (es2, t1, y1) # (rm_evtsys xs1)&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>rm_evtsys_def</span><span class="delimiter">)</span><span> 
</span><span>
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &#8804; length ((es2, t1, y1) # xs1) &#10230; getspc_es (((es2, t1, y1) # xs1) ! i) &#8800; es&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c7</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e. getspc_es (((es2, t1, y1) # xs1) ! 0) = EvtSeq e es&quot;</span></span></span><span> 
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>getspc_es_def</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c2</span><span> </span><span>c10</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c11</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys ((es2, t1, y1) # xs1) &#8712; cpts_ev &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c12</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys1 (es1, s1, x1) = (e1, s1, x1)&quot;</span></span></span><span> 
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>gets_es_def</span><span> </span><span>getspc_es_def</span><span> </span><span>rm_evtsys1_def</span><span> </span><span>getx_es_def</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c7</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c13</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys1 (es2, t1, y1) = (e2, t1, y1)&quot;</span></span></span><span> 
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>gets_es_def</span><span> </span><span>getspc_es_def</span><span> </span><span>rm_evtsys1_def</span><span> </span><span>getx_es_def</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c71</span><span> </span><span>c8</span><span> </span><span>c9</span><span> </span><span>c11</span><span> </span><span>c12</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_ev.CptsEvComp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el ! 0=(e,(s,x))&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p01</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys1 (esl ! 0) = (e, s, x)&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>gets_es_def</span><span> </span><span>getspc_es_def</span><span> </span><span>getx_es_def</span><span> </span><span>rm_evtsys1_def</span><span class="delimiter">)</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a1</span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el ! 0 = rm_evtsys1 (esl ! 0)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rm_evtsys_def</span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>cpts_e_not_empty</span><span> </span><span>length_greater_0_conv</span><span> </span><span>nth_map</span><span class="delimiter">)</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el ! 0=(e,(s,x)) &#8743; ?el &#8712; cpts_ev &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cpts_of_ev_def</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p01_2</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;e_eqv_einevtseq esl ?el es&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>esl</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptsEsOne</span><span> </span><span>es1</span><span> </span><span>s1</span><span> </span><span>x1</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e. getspc_es ([(es1, s1, x1)] ! 0) = EvtSeq e es&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>e1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es ([(es1, s1, x1)] ! 0) = EvtSeq e1 es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;es1 = EvtSeq e1 es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>getspc_es_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys1 (es1, s1, x1) = (e1, s1, x1)&quot;</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>gets_es_def</span><span> </span><span>getspc_es_def</span><span> </span><span>rm_evtsys1_def</span><span> </span><span>getx_es_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys [(es1, s1, x1)] = [(e1, s1, x1)]&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>rm_evtsys_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>e_eqv_einevtseq_def</span><span class="delimiter">,</span><span> </span><span>rule</span><span> </span><span>conjI</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">show</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc 0 = length (rm_evtsys [(es1, s1, x1)])&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>a2</span><span class="delimiter">)</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_e (rm_evtsys [(es1, s1, x1)] ! 0) = gets_es ([(es1, s1, x1)] ! 0)&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>gets_es_def</span><span> </span><span>rm_evtsys1_def</span><span> </span><span>gets_e_def</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getx_e (rm_evtsys [(es1, s1, x1)] ! 0) = getx_es ([(es1, s1, x1)] ! 0)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>getx_es_def</span><span> </span><span>rm_evtsys1_def</span><span> </span><span>getx_e_def</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es ([(es1, s1, x1)] ! 0) = EvtSeq (getspc_e (rm_evtsys [(es1, s1, x1)] ! 0)) es&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>getspc_es_def</span><span> </span><span>getspc_e_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>a1</span><span> </span><span>fst_conv</span><span> </span><span>nth_Cons_0</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &#8804; length (rm_evtsys [(es1, s1, x1)]) &#10230;
                      gets_e (rm_evtsys [(es1, s1, x1)] ! i) = gets_es ([(es1, s1, x1)] ! i) &#8743;
                      getx_e (rm_evtsys [(es1, s1, x1)] ! i) = getx_es ([(es1, s1, x1)] ! i) &#8743;
                      getspc_es ([(es1, s1, x1)] ! i) = EvtSeq (getspc_e (rm_evtsys [(es1, s1, x1)] ! i)) es&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>One_nat_def</span><span> </span><span>Suc_le_lessD</span><span> </span><span>less_one</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptsEsEnv</span><span> </span><span>es1</span><span> </span><span>t1</span><span> </span><span>x1</span><span> </span><span>xs1</span><span> </span><span>s1</span><span> </span><span>y1</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(es1, t1, x1) # xs1 &#8712; cpts_es &#915;&quot;</span></span></span><span>
</span><span>          </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &#8804; length ((es1, t1, x1) # xs1) &#10230; getspc_es (((es1, t1, x1) # xs1) ! i) &#8800; es &#10233;
                    &#8707;e. getspc_es (((es1, t1, x1) # xs1) ! 0) = EvtSeq e es &#10233;
                    e_eqv_einevtseq ((es1, t1, x1) # xs1) (rm_evtsys ((es1, t1, x1) # xs1)) es&quot;</span></span></span><span>
</span><span>          </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &#8804; length ((es1, s1, y1) # (es1, t1, x1) # xs1) 
                      &#10230; getspc_es (((es1, s1, y1) # (es1, t1, x1) # xs1) ! i) &#8800; es&quot;</span></span></span><span>
</span><span>          </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e. getspc_es (((es1, s1, y1) # (es1, t1, x1) # xs1) ! 0) = EvtSeq e es&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &#8804; length ((es1, t1, x1) # xs1) &#10230; getspc_es (((es1, t1, x1) # xs1) ! i) &#8800; es&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a3</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>e1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;es1 = EvtSeq e1 es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>getspc_es_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fst_conv</span><span> </span><span>nth_Cons_0</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e. getspc_es (((es1, t1, x1) # xs1) ! 0) = EvtSeq e es&quot;</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>getspc_es_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>getspc_es_def</span><span class="delimiter">)</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a1</span><span> </span><span>a4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;e_eqv_einevtseq ((es1, t1, x1) # xs1) (rm_evtsys ((es1, t1, x1) # xs1)) es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys1 (es1, s1, y1) = (e1, s1, y1)&quot;</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>gets_es_def</span><span> </span><span>getspc_es_def</span><span> </span><span>rm_evtsys1_def</span><span> </span><span>getx_es_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys ((es1, s1, y1) # (es1, t1, x1) # xs1) = 
          rm_evtsys1 (es1, s1, y1) # rm_evtsys ((es1, t1, x1) # xs1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>rm_evtsys_def</span><span class="delimiter">)</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a6</span><span> </span><span>a7</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>gets_e_def</span><span> </span><span>gets_es_def</span><span> </span><span>getx_e_def</span><span> </span><span>getx_es_def</span><span> 
</span><span>          </span><span>getspc_es_def</span><span> </span><span>getspc_e_def</span><span> </span><span>e_eqv_einevtseq_s</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>a5</span><span> </span><span>fst_conv</span><span> </span><span>snd_conv</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptsEsComp</span><span> </span><span>es1</span><span> </span><span>s1</span><span> </span><span>x1</span><span> </span><span>et</span><span> </span><span>es2</span><span> </span><span>t1</span><span> </span><span>y1</span><span> </span><span>xs1</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (es1, s1, x1) -es-et&#8594; (es2, t1, y1)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(es2, t1, y1) # xs1 &#8712; cpts_es &#915;&quot;</span></span></span><span>
</span><span>          </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &#8804; length ((es2, t1, y1) # xs1) &#10230; getspc_es (((es2, t1, y1) # xs1) ! i) &#8800; es &#10233;
                      &#8707;e. getspc_es (((es2, t1, y1) # xs1) ! 0) = EvtSeq e es &#10233;
                      e_eqv_einevtseq ((es2, t1, y1) # xs1) (rm_evtsys ((es2, t1, y1) # xs1)) es&quot;</span></span></span><span>
</span><span>          </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &#8804; length ((es1, s1, x1) # (es2, t1, y1) # xs1) 
                      &#10230; getspc_es (((es1, s1, x1) # (es2, t1, y1) # xs1) ! i) &#8800; es&quot;</span></span></span><span>
</span><span>          </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e. getspc_es (((es1, s1, x1) # (es2, t1, y1) # xs1) ! 0) = EvtSeq e es&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &#8804; length ((es2, t1, y1) # xs1) &#10230; getspc_es (((es2, t1, y1) # xs1) ! i) &#8800; es&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a4</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>e1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;es1 = EvtSeq e1 es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>getspc_es_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fst_conv</span><span> </span><span>nth_Cons_0</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (es2, t1, y1) &#8800; es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;es2 &#8800; es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>getspc_es_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a0</span><span> </span><span>a6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e2. es2 = EvtSeq e2 es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>evtseq_tran_evtsys</span><span class="delimiter">)</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>e2</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;es2 = EvtSeq e2 es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e. getspc_es (((es2, t1, y1) # xs1) ! 0) = EvtSeq e es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>getspc_es_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a2</span><span> </span><span>a5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;e_eqv_einevtseq ((es2, t1, y1) # xs1) (rm_evtsys ((es2, t1, y1) # xs1)) es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a11</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys ((es1, s1, x1) # (es2, t1, y1) # xs1) = rm_evtsys1 (es1, s1, x1) # rm_evtsys ((es2, t1, y1) # xs1)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>rm_evtsys_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a12</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys1 (es1, s1, x1) = (e1, s1, x1)&quot;</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>gets_es_def</span><span> </span><span>getspc_es_def</span><span> </span><span>rm_evtsys1_def</span><span> </span><span>getx_es_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a6</span><span> </span><span>a11</span><span> </span><span>a10</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>gets_e_def</span><span> </span><span>gets_es_def</span><span> </span><span>getx_e_def</span><span> </span><span>getx_es_def</span><span> 
</span><span>          </span><span>getspc_es_def</span><span> </span><span>getspc_e_def</span><span> </span><span>e_eqv_einevtseq_s</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fst_conv</span><span> </span><span>snd_conv</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el &#8712; cpts_of_ev &#915; e s x &#8743; length esl = length ?el &#8743; e_eqv_einevtseq esl ?el es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>evtseq_fst_finish</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;esl &#8712; cpts_es &#915;; getspc_es (esl ! 0) = EvtSeq e es; Suc m &#8804; length esl; 
     &#8707;i. i &#8804; m &#8743; getspc_es (esl ! i) = es&#10215; &#10233; 
      &#8707;i. (i &#8804; m &#8743; getspc_es (esl ! i) = es) &#8743; (&#8704;j. j &lt; i &#10230; getspc_es (esl ! j) &#8800; es)&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl &#8712; cpts_es &#915;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl ! 0) = EvtSeq e es&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc m &#8804; length esl&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;i. i &#8804; m &#8743; getspc_es (esl ! i) = es&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;m. esl &#8712; cpts_es &#915; &#8743; getspc_es (esl ! 0) = EvtSeq e es &#8743; Suc m &#8804; length esl &#8743; 
              (&#8707;i. i &#8804; m &#8743; getspc_es (esl ! i) = es) &#10230;
          (&#8707;i. (i &#8804; m &#8743; getspc_es (esl ! i) = es) &#8743; (&#8704;j. j &lt; i &#10230; getspc_es (esl ! j) &#8800; es) )&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>m</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl &#8712; cpts_es &#915;&quot;</span></span></span><span>
</span><span>          </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl ! 0) = EvtSeq e es&quot;</span></span></span><span>
</span><span>          </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc m &#8804; length esl&quot;</span></span></span><span>
</span><span>          </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8707;i. i &#8804; m &#8743; getspc_es (esl ! i) = es)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;i. (i &#8804; m &#8743; getspc_es (esl ! i) = es) &#8743; (&#8704;j. j &lt; i &#10230; getspc_es (esl ! j) &#8800; es)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>m</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;0.prems&quot;</span></span></span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>n</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl &#8712; cpts_es &#915; &#10233;
                        getspc_es (esl ! 0) = EvtSeq e es &#10233;
                        Suc n &#8804; length esl &#10233;
                        &#8707;i&#8804;n. getspc_es (esl ! i) = es &#10233; 
                        &#8707;i. (i &#8804; n &#8743; getspc_es (esl ! i) = es) &#8743; (&#8704;j. j &lt; i &#10230; getspc_es (esl ! j) &#8800; es)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl &#8712; cpts_es &#915;&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl ! 0) = EvtSeq e es&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc (Suc n) &#8804; length esl&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;i&#8804;Suc n. getspc_es (esl ! i) = es&quot;</span></span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;i&#8804;n. getspc_es (esl ! i) = es&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;i&#8804;n. getspc_es (esl ! i) = es&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b0</span><span> </span><span>b1</span><span> </span><span>b2</span><span> </span><span>b3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;i. (i &#8804; n &#8743; getspc_es (esl ! i) = es) &#8743; (&#8704;j. j &lt; i &#10230; getspc_es (esl ! j) &#8800; es)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_leD</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>le_Suc_eq</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>              </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (&#8707;i&#8804;n. getspc_es (esl ! i) = es)&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl ! (Suc n)) = es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>le_SucE</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. j &lt; Suc n &#10230; getspc_es (esl ! j) &#8800; es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>p3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>EventSeq_sound</span><span> </span><span class="delimiter">:</span><span> 
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214; &#915; &#8872; e sat<span class="hidden">&#8681;</span><sub>e</sub> [pre, rely1, guar1, post1]; &#915; &#8872; es sat<span class="hidden">&#8681;</span><sub>s</sub> [pre2, rely2, guar2, post]; 
      rely &#8838; rely1; rely &#8838; rely2; guar1 &#8838; guar; guar2 &#8838; guar; post1 &#8838; pre2&#10215; 
      &#10233; &#915; &#8872; EvtSeq e es sat<span class="hidden">&#8681;</span><sub>s</sub> [pre, rely, guar, post]&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8872; e sat<span class="hidden">&#8681;</span><sub>e</sub> [pre, rely1, guar1, post1]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8872; es sat<span class="hidden">&#8681;</span><sub>s</sub> [pre2, rely2, guar2, post]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rely &#8838; rely1&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rely &#8838; rely2&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;guar1 &#8838; guar&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;guar2 &#8838; guar&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;post1 &#8838; pre2&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s x. (cpts_of_es &#915; (EvtSeq e es) s x) &#8745; assume_es &#915; (pre, rely) &#8838; commit_es &#915; (guar, post)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>s</span><span> </span><span>x</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;esl. esl&#8712;(cpts_of_es &#915; (EvtSeq e es) s x) &#8745; assume_es &#915; (pre, rely) &#10230; esl&#8712; commit_es &#915; (guar, post)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>          </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>esl</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl &#8712; (cpts_of_es &#915; (EvtSeq e es) s x) &#8745; assume_es &#915; (pre, rely)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a01</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl &#8712; cpts_of_es &#915; (EvtSeq e es) s x&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a02</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl &#8712; assume_es &#915; (pre, rely)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a01</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a01_1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl ! 0 = (EvtSeq e es, s, x)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cpts_of_es_def</span><span class="delimiter">)</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a01</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a01_2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl &#8712; cpts_es &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cpts_of_es_def</span><span class="delimiter">)</span><span> 
</span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712; commit_es &#915; (guar, post)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &#8804; length esl &#10230; getspc_es (esl ! i) &#8800; es&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &#8804; length esl &#10230; getspc_es (esl ! i) &#8800; es&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a01</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;el. (el &#8712; cpts_of_ev &#915; e s x &#8743; length esl = length el &#8743; e_eqv_einevtseq esl el es)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>evtseq_nfin_samelower</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>el</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el &#8712; cpts_of_ev &#915; e s x &#8743; length esl = length el &#8743; e_eqv_einevtseq esl el es&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el &#8712; assume_e &#915; (pre, rely1)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_e_def</span><span class="delimiter">,</span><span> </span><span>rule</span><span> </span><span>conjI</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a02</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (esl ! 0) &#8712; pre&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_es_def</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_e (el ! 0) = s&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>cpts_of_ev_def</span><span> </span><span>gets_e_def</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a01_1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (esl ! 0) = s&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>cpts_of_ev_def</span><span> </span><span>gets_es_def</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_e (el ! 0) &#8712; pre&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length el &#10230; &#915; &#8866; el ! i -ee&#8594; el ! Suc i &#10230; 
                            (gets_e (el ! i), gets_e (el ! Suc i)) &#8712; rely1 &quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>                        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>                        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length el&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; el ! i -ee&#8594; el ! Suc i&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (el ! i) = getspc_e (el ! Suc i)&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>eetran_eqconf1</span><span class="delimiter">)</span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b1</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl ! i) = EvtSeq (getspc_e (el ! i)) es&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>e_eqv_einevtseq_def</span><span class="delimiter">)</span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b1</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl ! Suc i) = EvtSeq (getspc_e (el ! Suc i)) es&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>e_eqv_einevtseq_def</span><span class="delimiter">)</span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl ! i) = getspc_es (esl ! Suc i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; esl ! i -ese&#8594; esl ! Suc i&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>eqconf_esetran</span><span class="delimiter">)</span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a02</span><span> </span><span>b1</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (esl!i), gets_es (esl!Suc i)) &#8712; rely&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>assume_es_def</span><span class="delimiter">)</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (esl!i) = gets_e (el ! i)&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>b1</span><span> </span><span>c0</span><span> </span><span>e_eqv_einevtseq_def</span><span> </span><span>less_imp_le_nat</span><span class="delimiter">)</span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (esl!Suc i) = gets_e (el ! Suc i)&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_le_eq</span><span> </span><span>b1</span><span> </span><span>c0</span><span> </span><span>e_eqv_einevtseq_def</span><span class="delimiter">)</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_e (el ! i), gets_e (el ! Suc i)) &#8712; rely&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_e (el ! i), gets_e (el ! Suc i)) &#8712; rely1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p0</span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el &#8712; commit_e &#915; (guar1, post1)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>IntI</span><span> </span><span>contra_subsetD</span><span> </span><span>evt_validity_def</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length el &#10230; (&#8707;t. &#915; &#8866; el!i -et-t&#8594; el!(Suc i)) 
                        &#10230; (gets_e (el!i), gets_e (el!Suc i)) &#8712; guar1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>commit_e_def</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length el &#10230; (&#8707;t. &#915; &#8866; el!i -et-t&#8594; el!(Suc i)) 
                        &#10230; (gets_e (el!i), gets_e (el!Suc i)) &#8712; guar&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>commit_es_def</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length esl &#10230; (&#8707;t. &#915; &#8866; esl ! i -es-t&#8594; esl ! Suc i) 
                              &#10230; (gets_es (esl ! i), gets_es (esl ! Suc i)) &#8712; guar&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>                        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>                        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length esl&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8707;t. &#915; &#8866; esl ! i -es-t&#8594; esl ! Suc i)&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl ! i) = EvtSeq (getspc_e (el ! i)) es&quot;</span></span></span><span> 
</span><span>                          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>e_eqv_einevtseq_def</span><span class="delimiter">)</span><span> 
</span><span>                        
</span><span>                        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b1</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl ! Suc i) = EvtSeq (getspc_e (el ! Suc i)) es&quot;</span></span></span><span> 
</span><span>                          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>e_eqv_einevtseq_def</span><span class="delimiter">)</span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl ! i) &#8800; getspc_es (esl ! Suc i)&quot;</span></span></span><span> 
</span><span>                          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtsys_not_eq_in_tran_aux</span><span> </span><span>getspc_es_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>surjective_pairing</span><span class="delimiter">)</span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c2</span><span> </span><span>c3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (el ! i) &#8800; getspc_e (el ! Suc i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;t. &#915; &#8866; (el ! i) -et-t&#8594; (el ! Suc i)&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>b1</span><span> </span><span>c0</span><span> </span><span>cpts_of_ev_def</span><span> </span><span>notran_confeqi</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_e (el!i), gets_e (el!Suc i)) &#8712; guar&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>b1</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_e (el!i) = gets_es (esl ! i)&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>b1</span><span> </span><span>c0</span><span> </span><span>e_eqv_einevtseq_def</span><span> </span><span>less_imp_le</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_e (el!Suc i) = gets_es (esl ! Suc i)&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_leI</span><span> </span><span>b1</span><span> </span><span>c0</span><span> </span><span>e_eqv_einevtseq_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (esl ! i), gets_es (esl ! Suc i)) &#8712; guar&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (&#8704;i. Suc i &#8804; length esl &#10230; getspc_es (esl ! i) &#8800; es)&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a01_1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b00</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl ! 0) = EvtSeq e es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>getspc_es_def</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;m. Suc m &#8804; length esl &#8743; getspc_es (esl ! m) = es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>m</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc m &#8804; length esl &#8743; getspc_es (esl ! m) = es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;i. i &#8804; m &#8743; getspc_es (esl ! i) = es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a01_1</span><span> </span><span>a01_2</span><span> </span><span>b00</span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;i. (i &#8804; m &#8743; getspc_es (esl ! i) = es) &#8743; (&#8704;j. j &lt; i &#10230; getspc_es (esl ! j) &#8800; es)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtseq_fst_finish</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>n</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>b3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(n &#8804; m &#8743; getspc_es (esl ! n) = es) &#8743; (&#8704;j. j &lt; n &#10230; getspc_es (esl ! j) &#8800; es)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b00</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b41</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;n &#8800; 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>hide_lams</span><span class="delimiter">)</span><span> </span><span>add.commute</span><span> </span><span>add.right_neutral</span><span> 
</span><span>                                                </span><span>add_Suc</span><span> </span><span>dual_order.irrefl</span><span> </span><span>esys.size</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>le_add1</span><span> </span><span>le_imp_less_Suc</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;n &gt; 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>esl0</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>b5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl0 = take n esl&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b5_1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length esl0 = n&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>b1</span><span> </span><span>b3</span><span> </span><span>less_le_trans</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>esl1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>b6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl1 = drop n esl&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl0 @ esl1 = esl&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a01_2</span><span> </span><span>b1</span><span> </span><span>b3</span><span> </span><span>b4</span><span> </span><span>b5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl0 &#8712; cpts_es &#915;&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Suc_diff_1</span><span> </span><span>Suc_le_lessD</span><span> </span><span>cpts_es_take</span><span> </span><span>less_trans</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a01_2</span><span> </span><span>b1</span><span> </span><span>b3</span><span> </span><span>b4</span><span> </span><span>b5</span><span> </span><span>b6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl1 &#8712; cpts_es &#915;&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Suc_diff_1</span><span> </span><span>Suc_le_lessD</span><span> </span><span>cpts_es_dropi</span><span> </span><span>le_neq_implies_less</span><span> </span><span>less_trans</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl0 ! 0 = (EvtSeq e es, s, x)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>a01_1</span><span> </span><span>b4</span><span> </span><span>b5</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b11</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl1 ! 0) = es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>b1</span><span> </span><span>b3</span><span> </span><span>b6</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b3</span><span> </span><span>b5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b11_1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. i &lt; length esl0 &#10230; getspc_es (esl0 ! i) &#8800; es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b8</span><span> </span><span>b10</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl0 &#8712; cpts_of_es &#915; (EvtSeq e es) s x&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>cpts_of_es_def</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b12</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;el. (el &#8712; cpts_of_ev &#915; e s x &#8743; length esl0 = length el &#8743; e_eqv_einevtseq esl0 el es)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>evtseq_nfin_samelower</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>el</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>b12_1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el &#8712; cpts_of_ev &#915; e s x &#8743; length esl0 = length el &#8743; e_eqv_einevtseq esl0 el es&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b12_2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el &#8712; cpts_ev &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>cpts_of_ev_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a02</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b13</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (esl!0) &#8712; pre &#8743; (&#8704;i. Suc i&lt;length esl &#10230; 
                                    &#915; &#8866; esl!i -ese&#8594; esl!(Suc i) &#10230; (gets_es (esl!i), gets_es (esl!Suc i)) &#8712; rely)&quot;</span></span></span><span>
</span><span>                       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_es_def</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b14</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl0 &#8712; assume_es &#915; (pre, rely)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_es_def</span><span class="delimiter">,</span><span> </span><span>rule</span><span> </span><span>conjI</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (esl0 ! 0) &#8712; pre&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a01_1</span><span> </span><span>b10</span><span> </span><span>b13</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b5</span><span> </span><span>b13</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length esl0 &#10230; &#915; &#8866; esl0 ! i -ese&#8594; esl0 ! Suc i 
                            &#10230; (gets_es (esl0 ! i), gets_es (esl0 ! Suc i)) &#8712; rely&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b15</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl0 &#8712; assume_es &#915; (pre, rely1)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>assume_es_def</span><span> </span><span>subset_iff</span><span class="delimiter">)</span><span>
</span><span>                
</span><span>                
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b16</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el &#8712; assume_e &#915; (pre, rely1)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_e_def</span><span class="delimiter">,</span><span> </span><span>rule</span><span> </span><span>conjI</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a02</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (esl ! 0) &#8712; pre&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_es_def</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b12_1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_e (el ! 0) = s&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>cpts_of_ev_def</span><span> </span><span>gets_e_def</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a01_1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (esl ! 0) = s&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>cpts_of_ev_def</span><span> </span><span>gets_es_def</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_e (el ! 0) &#8712; pre&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length el &#10230; &#915; &#8866; el ! i -ee&#8594; el ! Suc i &#10230; 
                            (gets_e (el ! i), gets_e (el ! Suc i)) &#8712; rely1 &quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>                        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>                        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length el&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; el ! i -ee&#8594; el ! Suc i&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (el ! i) = getspc_e (el ! Suc i)&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>eetran_eqconf1</span><span class="delimiter">)</span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b12_1</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl0 ! i) = EvtSeq (getspc_e (el ! i)) es&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>e_eqv_einevtseq_def</span><span class="delimiter">)</span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b12_1</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl0 ! Suc i) = EvtSeq (getspc_e (el ! Suc i)) es&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>e_eqv_einevtseq_def</span><span class="delimiter">)</span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl0 ! i) = getspc_es (esl0 ! Suc i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; esl0 ! i -ese&#8594; esl0 ! Suc i&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>eqconf_esetran</span><span class="delimiter">)</span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b14</span><span> </span><span>b12_1</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (esl0!i), gets_es (esl0!Suc i)) &#8712; rely&quot;</span></span></span><span> 
</span><span>                          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b14</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length esl0 &#10230; &#915; &#8866; esl0!i -ese&#8594; esl0!(Suc i) 
                                      &#10230; (gets_es (esl0!i), gets_es (esl0!Suc i)) &#8712; rely&quot;</span></span></span><span> 
</span><span>                               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_es_def</span><span class="delimiter">)</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b12_1</span><span> </span><span>c0</span><span> </span><span>c4</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (esl0!i) = gets_e (el ! i)&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>b12_1</span><span> </span><span>c0</span><span> </span><span>e_eqv_einevtseq_def</span><span> </span><span>less_imp_le_nat</span><span class="delimiter">)</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (esl0!Suc i) = gets_e (el ! Suc i)&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>b12_1</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>b12_1</span><span> </span><span>c0</span><span> </span><span>e_eqv_einevtseq_def</span><span> </span><span>Suc_leI</span><span class="delimiter">)</span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_e (el ! i), gets_e (el ! Suc i)) &#8712; rely&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_e (el ! i), gets_e (el ! Suc i)) &#8712; rely1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b17</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el &#8712; commit_e &#915; (guar1, post1)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>b12_1</span><span> </span><span>b16</span><span> </span><span>evt_validity_def</span><span> </span><span>p0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b18</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length el &#10230; (&#8707;t. &#915; &#8866; el!i -et-t&#8594; el!(Suc i)) 
                        &#10230; (gets_e (el!i), gets_e (el!Suc i)) &#8712; guar1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>commit_e_def</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b19</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length el &#10230; (&#8707;t. &#915; &#8866; el!i -et-t&#8594; el!(Suc i)) 
                        &#10230; (gets_e (el!i), gets_e (el!Suc i)) &#8712; guar&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b11</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;sn xn. esl1 ! 0 = (es, sn, xn)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>getspc_es_def</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fst_conv</span><span> </span><span>surj_pair</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>sn</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>xn</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>b13</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl1 ! 0 = (es, sn, xn)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b9</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl1 &#8712; cpts_of_es &#915; es sn xn&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>cpts_of_es_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length esl &#10230; (&#8707;t. &#915; &#8866; esl!i -es-t&#8594; esl!(Suc i)) 
                          &#10230; (gets_es (esl!i), gets_es (esl!Suc i)) &#8712; guar&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>                    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length esl&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;t. &#915; &#8866; esl!i -es-t&#8594; esl!(Suc i)&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (esl!i), gets_es (esl!Suc i)) &#8712; guar&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; n&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; n&quot;</span></span></span><span>
</span><span>                        
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b5</span><span> </span><span>b5_1</span><span> </span><span>b12_1</span><span> </span><span>c0</span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl0 ! i) = EvtSeq (getspc_e (el ! i)) es&quot;</span></span></span><span> 
</span><span>                          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>e_eqv_einevtseq_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>less_imp_le_nat</span><span class="delimiter">)</span><span> 
</span><span>                        
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b5</span><span> </span><span>b5_1</span><span> </span><span>b12_1</span><span> </span><span>c0</span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl0 ! Suc i) = EvtSeq (getspc_e (el ! Suc i)) es&quot;</span></span></span><span> 
</span><span>                          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>e_eqv_einevtseq_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_le_eq</span><span> </span><span>d0</span><span class="delimiter">)</span><span> 
</span><span>                        
</span><span>                        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl ! i) &#8800; getspc_es (esl ! Suc i)&quot;</span></span></span><span> 
</span><span>                          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtsys_not_eq_in_tran_aux</span><span> </span><span>getspc_es_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>surjective_pairing</span><span class="delimiter">)</span><span> 
</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d1</span><span> </span><span>d2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (el ! i) &#8800; getspc_e (el ! Suc i)&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Suc_lessD</span><span> </span><span>b5</span><span> </span><span>d0</span><span class="delimiter">)</span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;t. &#915; &#8866; (el ! i) -et-t&#8594; (el ! Suc i)&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>b12_1</span><span> </span><span>b5_1</span><span> </span><span>cpts_of_ev_def</span><span> </span><span>d0</span><span> </span><span>notran_confeqi</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b19</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_e (el!i), gets_e (el!Suc i)) &#8712; guar&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>b12_1</span><span> </span><span>b5_1</span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_e (el!i) = gets_es (esl0 ! i)&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>b12_1</span><span> </span><span>b5_1</span><span> </span><span>d0</span><span> </span><span>e_eqv_einevtseq_def</span><span> </span><span>less_imp_le_nat</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_e (el!Suc i) = gets_es (esl0 ! Suc i)&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_leI</span><span> </span><span>b12_1</span><span> </span><span>b5_1</span><span> </span><span>d0</span><span> </span><span>e_eqv_einevtseq_def</span><span> </span><span>less_imp_le_nat</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (esl0 ! i), gets_es (esl0 ! Suc i)) &#8712; guar&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Suc_lessD</span><span> </span><span>b5</span><span> </span><span>d0</span><span class="delimiter">)</span><span> 
</span><span>                      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (Suc i &lt; n)&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b5_1</span><span> </span><span>b12_1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl0 ! (n-1)) = EvtSeq (getspc_e (el ! (n-1))) es&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>b12_1</span><span> </span><span>e_eqv_einevtseq_def</span><span> </span><span>b4</span><span class="delimiter">)</span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d1_1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl ! (n-1)) = EvtSeq (getspc_e (el ! (n-1))) es&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>b4</span><span class="delimiter">)</span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;sn1 xn1. esl ! (n-1) = (EvtSeq (getspc_e (el ! (n-1))) es, sn1, xn1)&quot;</span></span></span><span> 
</span><span>                          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>getspc_es_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fst_conv</span><span> </span><span>surj_pair</span><span class="delimiter">)</span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>sn1</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>xn1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>d2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl ! (n-1) = (EvtSeq (getspc_e (el ! (n-1))) es, sn1, xn1)&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b4</span><span> </span><span>b5</span><span> </span><span>b5_1</span><span> </span><span>b12_1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_e (el ! (n -1) ) = gets_es (esl0 ! (n -1)) &#8743;
                                       getx_e (el ! (n -1)) = getx_es (esl0 ! (n -1))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>e_eqv_einevtseq_def</span><span class="delimiter">)</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b5</span><span> </span><span>d2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el ! (n -1) = (getspc_e (el ! (n-1)), sn1, xn1)&quot;</span></span></span><span> 
</span><span>                          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>gets_e_def</span><span> </span><span>gets_es_def</span><span> </span><span>getx_e_def</span><span> </span><span>getx_es_def</span><span> </span><span>getspc_e_def</span><span> 
</span><span>                          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_diff_1</span><span> </span><span>b4</span><span> </span><span>lessI</span><span> </span><span>nth_take</span><span> </span><span>prod.collapse</span><span> </span><span>snd_conv</span><span class="delimiter">)</span><span>
</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b13</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl ! n = (es, sn, xn)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>b6</span><span> </span><span>c0</span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a01_2</span><span> </span><span>b1</span><span> </span><span>b3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop (n-1) esl &#8712; cpts_es &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_es_dropi</span><span>
</span><span>                          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>hide_lams</span><span class="delimiter">)</span><span> </span><span>Suc_diff_1</span><span> </span><span>Suc_le_lessD</span><span> </span><span>b5</span><span> </span><span>b5_1</span><span> 
</span><span>                              </span><span>drop_0</span><span> </span><span>less_or_eq_imp_le</span><span> </span><span>neq0_conv</span><span> </span><span>not_le</span><span> </span><span>take_all</span><span> </span><span>zero_less_diff</span><span class="delimiter">)</span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b1</span><span> </span><span>b3</span><span> </span><span>b4</span><span> </span><span>b6</span><span> </span><span>b9</span><span> </span><span>d2</span><span> </span><span>d4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;est. &#915; &#8866; esl ! (n-1) -es-est&#8594; esl ! n&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>incpts_es_impl_evnorcomptran</span><span> </span><span>cpts_es_not_empty</span><span> </span><span>evtseq_ne_es</span><span>
</span><span>                          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>Suc_diff_1</span><span> </span><span>Suc_le_lessD</span><span> </span><span>a01_2</span><span> </span><span>d1_1</span><span> </span><span>esetran_eqconf1</span><span> </span><span>le_neq_implies_less</span><span> </span><span>less_trans</span><span class="delimiter">)</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;t. &#915; &#8866; (getspc_e (el ! (n-1)), sn1, xn1) -et-t&#8594;(AnonyEvent fin_com,sn, xn)&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtseq_tran_0_exist_etran</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>d4</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b4</span><span> </span><span>b5_1</span><span> </span><span>b12_1</span><span> </span><span>b12_2</span><span> </span><span>d3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d8</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;el @ [(AnonyEvent fin_com,sn, xn)] &#8712; cpts_ev &#915;&quot;</span></span></span><span> 
</span><span>                          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_ev_onemore</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?el1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el @ [(AnonyEvent fin_com,sn, xn)]&quot;</span></span></span><span>
</span><span>                        
</span><span>                        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d8</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el1 &#8712; cpts_of_ev &#915; e s x&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>append_Cons</span><span> </span><span>b12_1</span><span> </span><span>b3</span><span> </span><span>b4</span><span> </span><span>b5_1</span><span> 
</span><span>                              </span><span>cpts_of_ev_def</span><span> </span><span>list.size</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>mem_Collect_eq</span><span> </span><span>neq_Nil_conv</span><span> </span><span>nth_Cons_0</span><span class="delimiter">)</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b16</span><span> </span><span>d7</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el1 &#8712; assume_e &#915; (pre, rely1)&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_e (?el1!0) &#8712; pre&quot;</span></span></span><span>
</span><span>                              </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b16</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_e (el!0) &#8712; pre&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_e_def</span><span class="delimiter">)</span><span>
</span><span>                                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>b12_1</span><span> </span><span>b4</span><span> </span><span>b5_1</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span> 
</span><span>                              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                            </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length ?el1 &#10230; &#915; &#8866; ?el1!i -ee&#8594; ?el1!(Suc i) &#10230; 
                                  (gets_e (?el1!i), gets_e (?el1!Suc i)) &#8712; rely1&quot;</span></span></span><span>
</span><span>                              </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                              </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>                                </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>                                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length ?el1&quot;</span></span></span><span>
</span><span>                                  </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>e1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866;?el1!i -ee&#8594; ?el1!(Suc i)&quot;</span></span></span><span>
</span><span>                                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b16</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length el &#10230; &#915; &#8866; el!i -ee&#8594; el!(Suc i) &#10230; 
                                  (gets_e (el!i), gets_e (el!Suc i)) &#8712; rely1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_e_def</span><span class="delimiter">)</span><span>
</span><span>                                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_e (?el1!i), gets_e (?el1!Suc i)) &#8712; rely1&quot;</span></span></span><span>
</span><span>                                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length ?el1 - 1&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>f0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length ?el1 - 1&quot;</span></span></span><span>
</span><span>                                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>e0</span><span> </span><span>e2</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Suc_diff_1</span><span> 
</span><span>                                        </span><span>Suc_less_eq</span><span> </span><span>Suc_mono</span><span> </span><span>e1</span><span> </span><span>length_append_singleton</span><span> </span><span>nth_append</span><span> </span><span>zero_less_Suc</span><span class="delimiter">)</span><span> 
</span><span>                                  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (Suc i &lt; length ?el1 - 1)&quot;</span></span></span><span>
</span><span>                                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &#8805; length ?el1 - 1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>e0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i = length ?el1 - 1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el1!(Suc i) = (AnonyEvent fin_com, sn, xn)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>f1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el1!i = (getspc_e (el ! (n-1)), sn1, xn1)&quot;</span></span></span><span>
</span><span>                                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>b12_1</span><span> </span><span>b5_1</span><span> </span><span>d3</span><span> </span><span>diff_Suc_1</span><span> </span><span>length_append_singleton</span><span> </span><span>lessI</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span> 
</span><span>                                    
</span><span>                                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d7</span><span> </span><span>f2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (?el1!i) &#8800; getspc_e (?el1!(Suc i))&quot;</span></span></span><span>
</span><span>                                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evt_not_eq_in_tran_aux</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>e1</span><span> </span><span>eetran.cases</span><span class="delimiter">)</span><span>
</span><span>                                    </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>e1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (?el1!i) = getspc_e (?el1!(Suc i))&quot;</span></span></span><span> 
</span><span>                                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>eetran_eqconf1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                                    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                                  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                              </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>                              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                              
</span><span>                            </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_e_def</span><span class="delimiter">)</span><span>
</span><span>                          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el1 &#8712; commit_e &#915; (guar1, post1)&quot;</span></span></span><span> 
</span><span>                          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evt_validity_def</span><span> </span><span>p0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>                          
</span><span>                        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d11</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (last ?el1) = AnonyEvent fin_com&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>getspc_e_def</span><span class="delimiter">)</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d10</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d12</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_e (last ?el1) &#8712; post1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>commit_e_def</span><span class="delimiter">)</span><span>
</span><span>                        
</span><span>                        </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i = n&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>g0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i = n&quot;</span></span></span><span>
</span><span>                            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d10</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;i. Suc i&lt;length ?el1 &#10230; (&#8707;t. &#915; &#8866;?el1!i -et-t&#8594; ?el1!(Suc i)) 
                                &#10230; (gets_e (?el1!i), gets_e (?el1!Suc i)) &#8712; guar1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>commit_e_def</span><span class="delimiter">)</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d7</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>g1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_e (?el1!i), gets_e (?el1!Suc i)) &#8712; guar1&quot;</span></span></span><span>
</span><span>                              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>b12_1</span><span> </span><span>b5_1</span><span> </span><span>d3</span><span> </span><span>diff_Suc_1</span><span> 
</span><span>                                </span><span>g0</span><span> </span><span>length_append_singleton</span><span> </span><span>lessI</span><span> </span><span>nth_append</span><span> </span><span>nth_append_length</span><span class="delimiter">)</span><span> 
</span><span>                            </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el1!(Suc i) = (AnonyEvent fin_com, sn, xn)&quot;</span></span></span><span>
</span><span>                              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>b12_1</span><span> </span><span>b5_1</span><span> </span><span>g0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                            </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>g0</span><span> </span><span>b5_1</span><span> </span><span>b12_1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el1!i = (getspc_e (el ! (n-1)), sn1, xn1)&quot;</span></span></span><span>
</span><span>                              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>b12_1</span><span> </span><span>b5_1</span><span> </span><span>d3</span><span> </span><span>diff_Suc_1</span><span> </span><span>lessI</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span> 
</span><span>                            </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(sn1,sn) &#8712; guar1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>gets_e_def</span><span class="delimiter">)</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(sn1,sn) &#8712; guar&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d4</span><span> </span><span>d2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (esl ! (n - 1)), gets_es (esl ! Suc (n - 1))) &#8712; guar&quot;</span></span></span><span> 
</span><span>                              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>gets_es_def</span><span> </span><span>b4</span><span class="delimiter">)</span><span> 
</span><span>                            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>g0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                          </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &#8800; n&quot;</span></span></span><span>
</span><span>                            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>g1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &gt; n&quot;</span></span></span><span>
</span><span>                              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>d0</span><span> </span><span>linorder_neqE_nat</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>                            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>g2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl1 ! 0 = (es, sn, xn)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>b13</span><span class="delimiter">)</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b9</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>g3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl1 &#8712; cpts_of_es &#915; es sn xn&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>cpts_of_es_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl1 &#8712; assume_es &#915; (pre2, rely2)&quot;</span></span></span><span>
</span><span>                              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_es_def</span><span class="delimiter">,</span><span> </span><span>rule</span><span> </span><span>conjI</span><span class="delimiter">)</span><span>
</span><span>                                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d12</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;sn &#8712; post1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>gets_e_def</span><span class="delimiter">)</span><span>
</span><span>                                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>g2</span><span> </span><span>p6</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (esl1 ! 0) &#8712; pre2&quot;</span></span></span><span> 
</span><span>                                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>gets_es_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fst_conv</span><span> </span><span>rev_subsetD</span><span> </span><span>snd_conv</span><span class="delimiter">)</span><span> 
</span><span>                                </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length esl1 &#10230; &#915; &#8866; esl1 ! i -ese&#8594; esl1 ! Suc i 
                                  &#10230; (gets_es (esl1 ! i), gets_es (esl1 ! Suc i)) &#8712; rely2&quot;</span></span></span><span>
</span><span>                                  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                                  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>                                    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>                                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>h0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length esl1&quot;</span></span></span><span>
</span><span>                                      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>h1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; esl1 ! i -ese&#8594; esl1 ! Suc i&quot;</span></span></span><span>
</span><span>                                    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>h2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl1 ! i = esl ! (n + i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>b5_1</span><span> </span><span>b7</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                                    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>h3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl1 ! Suc i = esl ! (n + Suc i)&quot;</span></span></span><span>
</span><span>                                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>b5_1</span><span> </span><span>b7</span><span> </span><span>nth_append_length_plus</span><span class="delimiter">)</span><span> 
</span><span>                                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>h1</span><span> </span><span>h2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>h4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; esl ! (n + i) -ese&#8594; esl ! (n + Suc i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                                    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc (n + i) &lt; length esl&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>b5_1</span><span> </span><span>b7</span><span> </span><span>h0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a02</span><span> </span><span>h4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (esl ! (n + i)), gets_es (esl ! (n + Suc i))) &#8712; rely&quot;</span></span></span><span>
</span><span>                                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_es_def</span><span class="delimiter">)</span><span>
</span><span>                                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>h2</span><span> </span><span>h3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (esl1 ! i), gets_es (esl1 ! Suc i)) &#8712; rely&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                                      
</span><span>                                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (esl1 ! i), gets_es (esl1 ! Suc i)) &#8712; rely2&quot;</span></span></span><span>
</span><span>                                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>p3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                                  </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>                                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                                  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>                              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span>g3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>g4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl1 &#8712; commit_es &#915; (guar2,post)&quot;</span></span></span><span>
</span><span>                              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>Int_iff</span><span> </span><span>es_validity_def</span><span> </span><span>subsetCE</span><span class="delimiter">)</span><span> 
</span><span>                            
</span><span>                            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>g5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl ! i = esl1 ! (i - n)&quot;</span></span></span><span>
</span><span>                              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>b5_1</span><span> </span><span>b7</span><span> </span><span>g1</span><span> </span><span>not_less_eq</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span> 
</span><span>                            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>g6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl ! Suc i = esl1 ! (Suc i - n)&quot;</span></span></span><span>
</span><span>                              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>b5_1</span><span> </span><span>b7</span><span> </span><span>d0</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span>
</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>g7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc (i - n) &lt; length esl1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>b6</span><span> </span><span>c0</span><span> </span><span>g1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>g4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length esl1 &#10230; (&#8707;t. &#915; &#8866; esl1!i -es-t&#8594; esl1!(Suc i)) 
                                &#10230; (gets_es (esl1!i), gets_es (esl1!Suc i)) &#8712; guar2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>commit_es_def</span><span class="delimiter">)</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>g7</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (esl1!(i - n)), gets_es (esl1!(Suc i - n))) &#8712; guar2&quot;</span></span></span><span>
</span><span>                              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_diff_le</span><span> </span><span>c1</span><span> </span><span>g1</span><span> </span><span>g5</span><span> </span><span>g6</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>g5</span><span> </span><span>g6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (esl ! i), gets_es (esl ! Suc i)) &#8712; guar2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>p5</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>commit_es_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>        
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>es_validity_def</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">primrec</span></span><span> </span><span>parse_es_cpts_i2</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#39;l,&#39;k,&#39;s,&#39;prog) esconfs &#8658;(&#39;l,&#39;k,&#39;s,&#39;prog) event set &#8658; 
                             ((&#39;l,&#39;k,&#39;s,&#39;prog) esconfs) list &#8658; ((&#39;l,&#39;k,&#39;s,&#39;prog) esconfs) list&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;parse_es_cpts_i2 [] es rlst = rlst&quot;</span></span></span><span> </span><span class="delimiter">|</span><span>
</span><span>        </span><span class="string"><span class="delete"><span class="delete">&quot;parse_es_cpts_i2 (x#xs) es rlst = 
            (if getspc_es x = EvtSys es &#8743; length xs &gt; 0 
                &#8743; (getspc_es (xs!0) &#8800; EvtSys es) then
               parse_es_cpts_i2 xs es (rlst@[[x]])
             else
               parse_es_cpts_i2 xs es (list_update rlst (length rlst - 1) (last rlst @ [x])) )&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>concat_list_lemma_take_n</span><span> </span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;esl = concat lst; i &#8804; length lst&#10215; &#10233; 
      &#8707;k. k &#8804; length esl &#8743; take k esl = concat (take i lst)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl = concat lst&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i &#8804; length lst&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>i</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;concat (take 0 lst) = take 0 esl&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>ii</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl = concat lst &#10233; ii &#8804; length lst 
                    &#10233; &#8707;k&#8804;length esl. take k esl = concat (take ii lst)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl = concat lst&quot;</span></span></span><span>
</span><span>          </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc ii &#8804; length lst&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;k&#8804;length esl. take k esl = concat (take ii lst)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_leD</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>k</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k&#8804;length esl &#8743; take k esl = concat (take ii lst)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;concat (take (Suc ii) lst) = concat (take ii lst) @ lst!ii&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>take_Suc_conv_app_nth</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;concat (take (Suc ii) lst) = take (k + length (lst!ii)) esl&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Cons_nth_drop_Suc</span><span> </span><span>Suc_le_lessD</span><span> </span><span>a2</span><span> </span><span>append_eq_conv_conj</span><span> 
</span><span>            </span><span>append_take_drop_id</span><span> </span><span>concat.simps</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>concat_append</span><span> </span><span>p0</span><span> </span><span>take_add</span><span class="delimiter">)</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>nat_le_linear</span><span> </span><span>take_all</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>concat_list_lemma_take_n2</span><span> </span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;esl = concat lst; i &#8804; length lst&#10215; &#10233; 
      &#8707;k. k &#8804; length esl &#8743; k = length (concat (take i lst)) &#8743; take k esl = concat (take i lst)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl = concat lst&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i &#8804; length lst&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>i</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;concat (take 0 lst) = take 0 esl&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>ii</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl = concat lst &#10233; ii &#8804; length lst 
                    &#10233; &#8707;k&#8804;length esl. k = length (concat (take ii lst)) 
                        &#8743; take k esl = concat (take ii lst)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl = concat lst&quot;</span></span></span><span>
</span><span>          </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc ii &#8804; length lst&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;k&#8804;length esl. k = length (concat (take ii lst)) 
                      &#8743; take k esl = concat (take ii lst)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_leD</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>k</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k&#8804;length esl &#8743; k = length (concat (take ii lst)) 
                                &#8743; take k esl = concat (take ii lst)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;concat (take (Suc ii) lst) = concat (take ii lst) @ lst!ii&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>take_Suc_conv_app_nth</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;concat (take (Suc ii) lst) = take (k + length (lst!ii)) esl&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Cons_nth_drop_Suc</span><span> </span><span>Suc_le_lessD</span><span> </span><span>a2</span><span> </span><span>append_eq_conv_conj</span><span> 
</span><span>            </span><span>append_take_drop_id</span><span> </span><span>concat.simps</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>concat_append</span><span> </span><span>p0</span><span> </span><span>take_add</span><span class="delimiter">)</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>a2</span><span> </span><span>concat_list_lemma_take_n</span><span> </span><span>length_take</span><span> </span><span>min.absorb2</span><span> </span><span>p0</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>concat_list_lemma</span><span> </span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;esl lst. esl = concat lst &#8743; (&#8704;i&lt;length lst. length (lst!i) &gt; 0)&#10230; 
        (&#8704;i. Suc i &lt; length esl 
          &#10230; (&#8707;k j. Suc k &lt; length lst &#8743; Suc j &lt; length (lst!k@[lst!(Suc k)!0]) 
                      &#8743; esl!i = (lst!k@[lst!(Suc k)!0])!j &#8743; esl!Suc i = (lst!k@[lst!(Suc k)!0])!Suc j
                  &#8744; Suc k = length lst &#8743; Suc j &lt; length (lst!k) &#8743; esl!i = lst!k!j &#8743; esl!Suc i = lst!k!Suc j))&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>lst</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;esl. esl = concat lst &#8743; (&#8704;i&lt;length lst. length (lst!i) &gt; 0)&#10230; 
        (&#8704;i. Suc i &lt; length esl 
          &#10230; (&#8707;k j. Suc k &lt; length lst &#8743; Suc j &lt; length (lst!k@[lst!(Suc k)!0]) 
                      &#8743; esl!i = (lst!k@[lst!(Suc k)!0])!j &#8743; esl!Suc i = (lst!k@[lst!(Suc k)!0])!Suc j
                  &#8744; Suc k = length lst &#8743; Suc j &lt; length (lst!k) &#8743; esl!i = lst!k!j &#8743; esl!Suc i = lst!k!Suc j))&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>lst</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>Nil</span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Cons</span><span> </span><span>l</span><span> </span><span>lt</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;esl. esl = concat lt &#8743; (&#8704;i&lt;length lt. 0 &lt; length (lt ! i)) &#10230;
        (&#8704;i. Suc i &lt; length esl &#10230;
             (&#8707;k j. Suc k &lt; length lt &#8743;
                    Suc j &lt; length (lt ! k @ [lt ! Suc k ! 0]) &#8743;
                    esl ! i = (lt ! k @ [lt ! Suc k ! 0]) ! j &#8743; esl ! Suc i = (lt ! k @ [lt ! Suc k ! 0]) ! Suc j &#8744;
                    Suc k = length lt &#8743; Suc j &lt; length (lt ! k) &#8743; esl ! i = lt ! k ! j &#8743; esl ! Suc i = lt ! k ! Suc j))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>esl</span><span>
</span><span>          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl = concat (l # lt)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length (l # lt). 0 &lt; length ((l # lt) ! i)&quot;</span></span></span><span>
</span><span>
</span><span>          </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length esl&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;k j. Suc k &lt; length (l # lt) &#8743;
                    Suc j &lt; length ((l # lt) ! k @ [(l # lt) ! Suc k ! 0]) &#8743;
                    esl ! i = ((l # lt) ! k @ [(l # lt) ! Suc k ! 0]) ! j &#8743;
                    esl ! Suc i = ((l # lt) ! k @ [(l # lt) ! Suc k ! 0]) ! Suc j &#8744;
                    Suc k = length (l # lt) &#8743;
                    Suc j &lt; length ((l # lt) ! k) &#8743; esl ! i = (l # lt) ! k ! j &#8743; esl ! Suc i = (l # lt) ! k ! Suc j&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lt = []&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lt = []&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl = l&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b0</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc 0 = length (l # []) &#8743;
                    Suc i &lt; length ((l # []) ! 0) &#8743; esl ! i = (l # []) ! 0 ! i &#8743; esl ! Suc i = (l # []) ! 0 ! Suc i&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d0</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lt &#8800; []&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length (l@[(l # lt) ! Suc 0!0])&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length (l@[(l # lt) ! Suc 0!0])&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b0</span><span> </span><span>b1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>Cons_nth_drop_Suc</span><span> </span><span>Suc_lessE</span><span> </span><span>Suc_lessI</span><span> </span><span>Suc_mono</span><span> 
</span><span>                        </span><span>cancel_comm_monoid_add_class.diff_cancel</span><span> </span><span>concat.simps</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> 
</span><span>                        </span><span>d0</span><span> </span><span>diff_Suc_1</span><span> </span><span>drop_0</span><span> </span><span>drop_Suc_Cons</span><span> </span><span>length_Cons</span><span> </span><span>length_append_singleton</span><span> 
</span><span>                        </span><span>length_greater_0_conv</span><span> </span><span>nth_Cons_0</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>e00</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(Suc i &lt; length (l@[(l # lt) ! Suc 0!0]))&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &#8805; length (l@[(l # lt) ! Suc 0!0])&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;esl1. esl = l@esl1 &#8743; esl1 = concat lt&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>esl1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>e1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl = l@esl1 &#8743; esl1 = concat lt&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a0</span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length esl1 &#10230;
                       (&#8707;k j. Suc k &lt; length lt &#8743;
                              Suc j &lt; length (lt ! k @ [lt ! Suc k ! 0]) &#8743;
                              esl1 ! i = (lt ! k @ [lt ! Suc k ! 0]) ! j &#8743; esl1 ! Suc i = (lt ! k @ [lt ! Suc k ! 0]) ! Suc j &#8744;
                              Suc k = length lt &#8743; Suc j &lt; length (lt ! k) &#8743; esl1 ! i = lt ! k ! j &#8743; esl1 ! Suc i = lt ! k ! Suc j)&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c0</span><span> </span><span>e0</span><span> </span><span>e00</span><span> </span><span>e1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl!i = esl1!(i-length l)&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>length_append_singleton</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c0</span><span> </span><span>e0</span><span> </span><span>e00</span><span> </span><span>e1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl!Suc i = esl1!(Suc i - length l)&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>length_append_singleton</span><span> </span><span>less_Suc_eq</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c0</span><span> </span><span>e0</span><span> </span><span>e00</span><span> </span><span>e1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc (i-length l) &lt; length esl1&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_le_mono</span><span> </span><span>add.commute</span><span> </span><span>le_SucI</span><span> </span><span>length_append</span><span> 
</span><span>                      </span><span>length_append_singleton</span><span> </span><span>less_diff_conv2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>e2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;k j. Suc k &lt; length lt &#8743;
                              Suc j &lt; length (lt ! k @ [lt ! Suc k ! 0]) &#8743;
                              esl1 ! (i-length l) = (lt ! k @ [lt ! Suc k ! 0]) ! j &#8743; esl1 ! Suc (i-length l) = (lt ! k @ [lt ! Suc k ! 0]) ! Suc j &#8744;
                              Suc k = length lt &#8743; Suc j &lt; length (lt ! k) &#8743; esl1 ! (i-length l) = lt ! k ! j &#8743; esl1 ! Suc (i-length l) = lt ! k ! Suc j&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>k</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>j</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc k &lt; length lt &#8743;
                              Suc j &lt; length (lt ! k @ [lt ! Suc k ! 0]) &#8743;
                              esl1 ! (i-length l) = (lt ! k @ [lt ! Suc k ! 0]) ! j &#8743; esl1 ! Suc (i-length l) = (lt ! k @ [lt ! Suc k ! 0]) ! Suc j &#8744;
                              Suc k = length lt &#8743; Suc j &lt; length (lt ! k) &#8743; esl1 ! (i-length l) = lt ! k ! j &#8743; esl1 ! Suc (i-length l) = lt ! k ! Suc j&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c0</span><span> </span><span>e0</span><span> </span><span>e1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>Suc_diff_le</span><span> </span><span>Suc_le_mono</span><span> </span><span>Suc_mono</span><span> </span><span>e3</span><span> </span><span>e4</span><span> </span><span>length_Cons</span><span> 
</span><span>                        </span><span>length_append_singleton</span><span> </span><span>nat_neq_iff</span><span> </span><span>nth_Cons_Suc</span><span class="delimiter">)</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>concat_list_lemma2</span><span> </span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;esl lst. esl = concat lst &#10230;
        (&#8704;i &lt; length lst. (take (length (lst!i)) (drop (length (concat (take i lst))) esl) = lst ! i))&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>lst</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;esl. esl = concat lst &#10230;
        (&#8704;i &lt; length lst. (take (length (lst!i)) (drop (length (concat (take i lst))) esl) = lst ! i))&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>lst</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>Nil</span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Cons</span><span> </span><span>l</span><span> </span><span>lt</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; &#8704;esl. esl = concat lt &#10230; 
                            (&#8704;i&lt;length lt. take (length (lt ! i)) (drop (length (concat (take i lt))) esl) = lt ! i)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>esl</span><span>
</span><span>          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl = concat (l # lt)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?esl</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;concat lt&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl = l @ ?esl&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i&lt;length (l # lt)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;take (length ((l # lt) ! i)) (drop (length (concat (take i (l # lt)))) esl) = (l # lt) ! i&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i = 0&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i = 0&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>b0</span><span> </span><span>d0</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i &#8800; 0&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;take (length (lt ! (i-1))) (drop (length (concat (take (i-1) lt))) ?esl) = lt ! (i-1)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?esl</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i-1&quot;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>One_nat_def</span><span> </span><span>leI</span><span> </span><span>less_Suc0</span><span> </span><span>less_diff_conv2</span><span> </span><span>list.size</span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d0</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;lt ! (i - 1) = (l # lt) ! i&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>nth_Cons&#39;</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span>b1</span><span> </span><span>d0</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop (length (concat (take (i-1) lt))) ?esl 
                                = drop (length (concat (take i (l # lt)))) esl&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>append_eq_conv_conj</span><span> </span><span>append_take_drop_id</span><span> </span><span>concat_append</span><span> </span><span>drop_Cons&#39;</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>        
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>concat_list_lemma3</span><span> </span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;esl = concat lst; i &lt; length lst; length (lst!i) &gt; 1&#10215; &#10233; 
      &#8707;k j. k = length (concat (take i lst)) &#8743; j = length (concat (take (Suc i) lst)) &#8743; 
            k &#8804; length esl &#8743; j &#8804; length esl &#8743; k &lt; j &#8743; drop k (take j esl) = lst ! i&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl = concat lst&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i &lt; length lst&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length (lst!i) &gt; 1&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;take (length (lst!i)) (drop (length (concat (take i lst))) esl) = lst ! i&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>concat_list_lemma2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?k</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length (concat (take i lst))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?j</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length (concat (take (Suc i) lst))&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop ?k (take ?j esl) = lst ! i&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length (lst ! i) + length (concat (take i lst)) = length (concat (take (Suc i) lst))&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>p1</span><span> </span><span>take_Suc_conv_app_nth</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>full_types</span><span class="delimiter">)</span><span> </span><span>a1</span><span> </span><span>take_drop</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?j - ?k = length (lst!i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>p1</span><span> </span><span>take_Suc_conv_app_nth</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?j = ?k + length (lst!i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>p1</span><span> </span><span>take_Suc_conv_app_nth</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?k &#8804; length esl&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>append_eq_conv_conj</span><span> </span><span>append_take_drop_id</span><span> </span><span>concat_append</span><span> </span><span>nat_le_linear</span><span> </span><span>take_all</span><span class="delimiter">)</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?j &#8804; length esl&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>append_eq_conv_conj</span><span> </span><span>append_take_drop_id</span><span> </span><span>concat_append</span><span> </span><span>nat_le_linear</span><span> </span><span>take_all</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a3</span><span> </span><span>p2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?k &lt; ?j&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span>diff_is_0_eq</span><span> </span><span>leI</span><span> </span><span>not_less0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>linarith</span><span>
</span><span>    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?k &#8804; length esl &#8743; ?j &#8804; length esl &#8743; ?k &lt; ?j &#8743; drop ?k (take ?j esl) = lst ! i&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a10</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>concat_list_lemma_withnextfst</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;esl = concat lst; Suc i &lt; length lst; length (lst!Suc i) &gt; 0&#10215; &#10233; 
      &#8707;k j. k &#8804; length esl &#8743; j &#8804; length esl &#8743; k &lt; j &#8743; drop k (take j esl) = lst!i @ [lst!Suc i!0]&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl = concat lst&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length lst&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length (lst!Suc i) &gt; 0&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;k. k &#8804; length esl &#8743; take k esl = concat (take (Suc (Suc i)) lst)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>concat_list_lemma_take_n</span><span class="delimiter">[</span><span>of</span><span> </span><span>esl</span><span> </span><span>lst</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc (Suc i)&quot;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>k</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k &#8804; length esl &#8743; take k esl = concat (take (Suc (Suc i)) lst)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;k. k &#8804; length esl &#8743; take k esl = concat (take (Suc i) lst)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>concat_list_lemma_take_n</span><span class="delimiter">[</span><span>of</span><span> </span><span>esl</span><span> </span><span>lst</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&quot;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>k2</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k2 &#8804; length esl &#8743; take k2 esl = concat (take (Suc i) lst)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;concat (take (Suc i) lst) @ [lst!Suc i!0] = take (Suc k2) esl&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Cons_nth_drop_Suc</span><span> </span><span>append_eq_conv_conj</span><span> 
</span><span>        </span><span>append_take_drop_id</span><span> </span><span>concat_list_lemma2</span><span> </span><span>drop_eq_Nil</span><span> </span><span>length_greater_0_conv</span><span> 
</span><span>        </span><span>less_eq_Suc_le</span><span> </span><span>not_less_eq_eq</span><span> </span><span>nth_Cons_0</span><span> </span><span>nth_take</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>take_Suc_conv_app_nth</span><span> </span><span>take_eq_Nil</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;concat (take i lst)@lst!i@[lst!Suc i!0] = take (Suc k2) esl&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Suc_lessD</span><span> </span><span>append_Nil2</span><span> </span><span>append_eq_appendI</span><span> 
</span><span>        </span><span>concat.simps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>concat.simps</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>concat_append</span><span> </span><span>p1</span><span> </span><span>take_Suc_conv_app_nth</span><span class="delimiter">)</span><span> 
</span><span>    
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;k. k &#8804; length esl &#8743; take k esl = concat (take i lst)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>concat_list_lemma_take_n</span><span class="delimiter">[</span><span>of</span><span> </span><span>esl</span><span> </span><span>lst</span><span> </span><span>i</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>k1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k1 &#8804; length esl &#8743; take k1 esl = concat (take i lst)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop k1 (take (Suc k2) esl) = lst!i@[lst!Suc i!0]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>append_eq_conv_conj</span><span> </span><span>length_take</span><span> </span><span>min.absorb2</span><span class="delimiter">)</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a2</span><span> </span><span>a4</span><span> </span><span>a5</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Nil_is_append_conv</span><span> </span><span>drop_eq_Nil</span><span> </span><span>leI</span><span> </span><span>length_take</span><span> 
</span><span>        </span><span>min.absorb2</span><span> </span><span>nat_le_linear</span><span> </span><span>not_Cons_self2</span><span> </span><span>take_all</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>concat_list_lemma_withnextfst2</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;esl = concat lst; Suc i &lt; length lst; length (lst!Suc i) &gt; 0&#10215; &#10233; 
      &#8707;k j. k = length (concat (take i lst)) &#8743; j = Suc (length (concat (take (Suc i) lst))) &#8743;
      k &#8804; length esl &#8743; j &#8804; length esl &#8743; k &lt; j &#8743; drop k (take j esl) = lst!i @ [lst!Suc i!0]&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl = concat lst&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length lst&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length (lst!Suc i) &gt; 0&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;k. k &#8804; length esl &#8743; k = length (concat (take (Suc (Suc i)) lst)) 
      &#8743; take k esl = concat (take (Suc (Suc i)) lst)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>concat_list_lemma_take_n2</span><span class="delimiter">[</span><span>of</span><span> </span><span>esl</span><span> </span><span>lst</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc (Suc i)&quot;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>k</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k &#8804; length esl &#8743; k = length (concat (take (Suc (Suc i)) lst)) 
         &#8743; take k esl = concat (take (Suc (Suc i)) lst)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;k. k &#8804; length esl &#8743; k = length (concat (take (Suc i) lst)) 
      &#8743; take k esl = concat (take (Suc i) lst)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>concat_list_lemma_take_n2</span><span class="delimiter">[</span><span>of</span><span> </span><span>esl</span><span> </span><span>lst</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&quot;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>k2</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k2 &#8804; length esl &#8743; k2 = length (concat (take (Suc i) lst)) 
      &#8743; take k2 esl = concat (take (Suc i) lst)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;concat (take (Suc i) lst) @ [lst!Suc i!0] = take (Suc k2) esl&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Cons_nth_drop_Suc</span><span> </span><span>append_eq_conv_conj</span><span> 
</span><span>        </span><span>append_take_drop_id</span><span> </span><span>concat_list_lemma2</span><span> </span><span>drop_eq_Nil</span><span> </span><span>length_greater_0_conv</span><span> 
</span><span>        </span><span>less_eq_Suc_le</span><span> </span><span>not_less_eq_eq</span><span> </span><span>nth_Cons_0</span><span> </span><span>nth_take</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>take_Suc_conv_app_nth</span><span> </span><span>take_eq_Nil</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;concat (take i lst)@lst!i@[lst!Suc i!0] = take (Suc k2) esl&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Suc_lessD</span><span> </span><span>append_Nil2</span><span> </span><span>append_eq_appendI</span><span> 
</span><span>        </span><span>concat.simps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>concat.simps</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>concat_append</span><span> </span><span>p1</span><span> </span><span>take_Suc_conv_app_nth</span><span class="delimiter">)</span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;k. k &#8804; length esl &#8743; k = length (concat (take i lst)) 
      &#8743; take k esl = concat (take i lst)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>concat_list_lemma_take_n2</span><span class="delimiter">[</span><span>of</span><span> </span><span>esl</span><span> </span><span>lst</span><span> </span><span>i</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>k1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k1 &#8804; length esl &#8743; k1 = length (concat (take i lst)) 
      &#8743; take k1 esl = concat (take i lst)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop k1 (take (Suc k2) esl) = lst!i@[lst!Suc i!0]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>append_eq_conv_conj</span><span> </span><span>length_take</span><span class="delimiter">)</span><span> 
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a2</span><span> </span><span>a4</span><span> </span><span>a5</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Nil_is_append_conv</span><span> 
</span><span>        </span><span>drop_eq_Nil</span><span> </span><span>leI</span><span> </span><span>length_append_singleton</span><span> </span><span>less_or_eq_imp_le</span><span> </span><span>not_Cons_self2</span><span> </span><span>take_all</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>concat_list_lemma_withnextfst3</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;esl = concat lst; Suc i &lt; length lst; length (lst!Suc i) &gt; 1&#10215; &#10233; 
      &#8707;k j. k = length (concat (take i lst)) &#8743; j = Suc (length (concat (take (Suc i) lst))) &#8743;
      k &#8804; length esl &#8743; j &lt; length esl &#8743; k &lt; j &#8743; drop k (take j esl) = lst!i @ [lst!Suc i!0]&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl = concat lst&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length lst&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length (lst!Suc i) &gt; 1&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;k. k &#8804; length esl &#8743; k = length (concat (take (Suc (Suc i)) lst)) 
      &#8743; take k esl = concat (take (Suc (Suc i)) lst)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>concat_list_lemma_take_n2</span><span class="delimiter">[</span><span>of</span><span> </span><span>esl</span><span> </span><span>lst</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc (Suc i)&quot;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>k</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k &#8804; length esl &#8743; k = length (concat (take (Suc (Suc i)) lst)) 
         &#8743; take k esl = concat (take (Suc (Suc i)) lst)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;k. k &#8804; length esl &#8743; k = length (concat (take (Suc i) lst)) 
      &#8743; take k esl = concat (take (Suc i) lst)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>concat_list_lemma_take_n2</span><span class="delimiter">[</span><span>of</span><span> </span><span>esl</span><span> </span><span>lst</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&quot;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>k2</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k2 &#8804; length esl &#8743; k2 = length (concat (take (Suc i) lst)) 
      &#8743; take k2 esl = concat (take (Suc i) lst)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;concat (take (Suc i) lst) @ [lst!Suc i!0] = take (Suc k2) esl&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>One_nat_def</span><span> </span><span>Suc_lessD</span><span> </span><span>Suc_n_not_le_n</span><span> </span><span>append_Nil2</span><span> </span><span>append_take_drop_id</span><span> 
</span><span>        </span><span>concat_list_lemma2</span><span> </span><span>concat_list_lemma_withnextfst2</span><span> </span><span>hd_conv_nth</span><span> 
</span><span>        </span><span>le_neq_implies_less</span><span> </span><span>nth_take</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>take_hd_drop</span><span class="delimiter">)</span><span>
</span><span>      
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;concat (take i lst)@lst!i@[lst!Suc i!0] = take (Suc k2) esl&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Suc_lessD</span><span> </span><span>append_Nil2</span><span> </span><span>append_eq_appendI</span><span> 
</span><span>        </span><span>concat.simps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>concat.simps</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>concat_append</span><span> </span><span>p1</span><span> </span><span>take_Suc_conv_app_nth</span><span class="delimiter">)</span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;k. k &#8804; length esl &#8743; k = length (concat (take i lst)) 
      &#8743; take k esl = concat (take i lst)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>concat_list_lemma_take_n2</span><span class="delimiter">[</span><span>of</span><span> </span><span>esl</span><span> </span><span>lst</span><span> </span><span>i</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>k1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k1 &#8804; length esl &#8743; k1 = length (concat (take i lst)) 
      &#8743; take k1 esl = concat (take i lst)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop k1 (take (Suc k2) esl) = lst!i@[lst!Suc i!0]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>append_eq_conv_conj</span><span> </span><span>length_take</span><span class="delimiter">)</span><span> 
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a2</span><span> </span><span>a4</span><span> </span><span>a5</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>One_nat_def</span><span> </span><span>append_eq_conv_conj</span><span> </span><span>concat_list_lemma2</span><span> </span><span>concat_list_lemma_withnextfst2</span><span> 
</span><span>        </span><span>leI</span><span> </span><span>length_Cons</span><span> </span><span>less_trans</span><span> </span><span>list.size</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>nat_neq_iff</span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>take_all</span><span> </span><span>zero_less_one</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>parse_es_cpts_i2_concat</span><span class="delimiter">:</span><span> 
</span><span>      </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;esl rlst es. esl&#8712;cpts_es &#915; &#8743; (rlst::((&#39;l,&#39;k,&#39;s,&#39;prog) esconfs) list) &#8800; [] 
                      &#10230; concat (parse_es_cpts_i2 esl es rlst) = concat rlst @ esl&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>esl</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;rlst es. esl&#8712;cpts_es &#915; &#8743; (rlst::((&#39;l,&#39;k,&#39;s,&#39;prog) esconfs) list) &#8800; [] &#10230; concat (parse_es_cpts_i2 esl es rlst) = concat rlst @ esl&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>esl</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>Nil</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Cons</span><span> </span><span>esc</span><span> </span><span>esl1</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;rlst es. esl1 &#8712; cpts_es &#915; &#8743; rlst &#8800; [] &#10230; concat (parse_es_cpts_i2 esl1 es rlst) = concat rlst @ esl1&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>          </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>rlst</span><span> </span><span>es</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esc # esl1 &#8712; cpts_es &#915; &#8743; (rlst::((&#39;l,&#39;k,&#39;s,&#39;prog) esconfs) list) &#8800; []&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;concat (parse_es_cpts_i2 (esc # esl1) es rlst) = concat rlst @ (esc # esl1)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es esc = EvtSys es &#8743; length esl1 &gt; 0 &#8743; getspc_es (esl1!0) &#8800; EvtSys es&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es esc = EvtSys es &#8743; length esl1 &gt; 0 &#8743; getspc_es (esl1!0) &#8800; EvtSys es&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;parse_es_cpts_i2 (esc # esl1) es rlst = parse_es_cpts_i2 esl1 es (rlst@[[esc]])&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rlst@[[esc]] &#8800; []&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl1 &#8712; cpts_es &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_es_dropi</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a0</span><span> </span><span>c2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;concat (parse_es_cpts_i2 esl1 es (rlst@[[esc]])) =  concat (rlst@[[esc]]) @ esl1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;concat rlst @ (esc # esl1) = concat (rlst@[[esc]]) @ esl1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c1</span><span> </span><span>c3</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>presburger</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(getspc_es esc = EvtSys es &#8743; length esl1 &gt; 0 &#8743; getspc_es (esl1!0) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;parse_es_cpts_i2 (esc # esl1) es rlst = 
                                parse_es_cpts_i2 esl1 es (list_update rlst (length rlst - 1) (last rlst @ [esc]))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl1 = []&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl1 = []&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;parse_es_cpts_i2 (esc # []) es rlst = 
                                parse_es_cpts_i2 [] es (list_update rlst (length rlst - 1) (last rlst @ [esc]))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;parse_es_cpts_i2 [] es (list_update rlst (length rlst - 1) (last rlst @ [esc])) = 
                            list_update rlst (length rlst - 1) (last rlst @ [esc])&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;concat (list_update rlst (length rlst - 1) (last rlst @ [esc])) = concat rlst @ esc # []&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>append_assoc</span><span> </span><span>append_butlast_last_id</span><span> 
</span><span>                            </span><span>append_self_conv</span><span> </span><span>concat.simps</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>concat_append</span><span> </span><span>length_butlast</span><span> </span><span>list_update_length</span><span class="delimiter">)</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d0</span><span> </span><span>d1</span><span> </span><span>d2</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(esl1 = [])&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length esl1 &gt; 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl1 &#8712; cpts_es &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_es_dropi</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;list_update rlst (length rlst - 1) (last rlst @ [esc]) &#8800; []&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a0</span><span> </span><span>d1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;concat (parse_es_cpts_i2 esl1 es (list_update rlst (length rlst - 1) (last rlst @ [esc]))) =
                                    concat (list_update rlst (length rlst - 1) (last rlst @ [esc])) @ esl1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;concat rlst @ (esc # esl1) = concat (list_update rlst (length rlst - 1) (last rlst @ [esc])) @ esl1&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Cons_eq_appendI</span><span> </span><span>append_assoc</span><span> </span><span>append_butlast_last_id</span><span> 
</span><span>                            </span><span>concat.simps</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>concat_append</span><span> </span><span>length_butlast</span><span> </span><span>list_update_length</span><span> </span><span>self_append_conv2</span><span class="delimiter">)</span><span>
</span><span>                    
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c1</span><span> </span><span>d2</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>parse_es_cpts_i2_concat1</span><span class="delimiter">:</span><span> 
</span><span>      </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;cpts_es &#915; &#10233; concat (parse_es_cpts_i2 esl es [[]]) = esl&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>parse_es_cpts_i2_concat</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>parse_es_cpts_i2_lst0</span><span class="delimiter">:</span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;esl l1 l2 es. esl&#8712;cpts_es &#915; &#8743; (l2::((&#39;l,&#39;k,&#39;s,&#39;prog) esconfs) list) &#8800; [] 
                    &#10230; parse_es_cpts_i2 esl es (l1@l2) = l1@(parse_es_cpts_i2 esl es l2)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>esl</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;l1 l2 es. esl&#8712;cpts_es &#915; &#8743; (l2::((&#39;l,&#39;k,&#39;s,&#39;prog) esconfs) list) &#8800; [] 
                      &#10230; parse_es_cpts_i2 esl es (l1@l2) = l1@(parse_es_cpts_i2 esl es l2)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>esl</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>Nil</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Cons</span><span> </span><span>esc</span><span> </span><span>esl1</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;l1 l2 es. esl1 &#8712; cpts_es &#915; &#8743; (l2::((&#39;l,&#39;k,&#39;s,&#39;prog) esconfs) list) &#8800; [] 
                                &#10230; parse_es_cpts_i2 esl1 es (l1 @l2) = l1 @ parse_es_cpts_i2 esl1 es l2&quot;</span></span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>          </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>l1</span><span> </span><span>l2</span><span> </span><span>es</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esc # esl1 &#8712; cpts_es &#915;&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(l2::((&#39;l,&#39;k,&#39;s,&#39;prog) esconfs) list) &#8800; []&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;parse_es_cpts_i2 (esc # esl1) es (l1 @ l2) = l1 @ parse_es_cpts_i2 (esc # esl1) es l2&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl1 = []&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl1 = []&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;parse_es_cpts_i2 (esc # []) es (l1 @ l2) =
                            parse_es_cpts_i2 [] es (list_update (l1 @ l2) (length (l1 @ l2) - 1) (last (l1 @ l2) @ [esc]))&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;parse_es_cpts_i2 (esc # []) es (l1 @ l2) = 
                            list_update (l1 @ l2) (length (l1 @ l2) - 1) (last (l1 @ l2) @ [esc])&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;parse_es_cpts_i2 (esc # []) es (l1 @ l2) = 
                                l1 @ (list_update l2 (length l2 - 1) (last l2 @ [esc]))&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>append_butlast_last_id</span><span> </span><span>append_is_Nil_conv</span><span> </span><span>butlast_append</span><span> 
</span><span>                        </span><span>butlast_list_update</span><span> </span><span>last_appendR</span><span> </span><span>last_list_update</span><span> </span><span>list_update_nonempty</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l1 @ parse_es_cpts_i2 (esc # []) es l2 = 
                        l1 @ parse_es_cpts_i2 [] es (list_update l2 (length l2 - 1) (last l2 @ [esc]))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l1 @ parse_es_cpts_i2 (esc # []) es l2 = 
                            l1 @ (list_update l2 (length l2 - 1) (last l2 @ [esc]))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c0</span><span> </span><span>c2</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>              </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(esl1 = [])&quot;</span></span></span><span> 
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl1 &#8712; cpts_es &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_es_dropi</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>                </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es esc = EvtSys es &#8743; length esl1 &gt; 0 &#8743; getspc_es (esl1!0) &#8800; EvtSys es&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es esc = EvtSys es &#8743; length esl1 &gt; 0 &#8743; getspc_es (esl1!0) &#8800; EvtSys es&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;parse_es_cpts_i2 (esc # esl1) es (l1 @ l2) =
                                    parse_es_cpts_i2 esl1 es (l1 @ l2@[[esc]])&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;parse_es_cpts_i2 esl1 es (l1 @ l2@[[esc]]) =
                                    l1 @ parse_es_cpts_i2 esl1 es (l2@[[esc]])&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l1 @ parse_es_cpts_i2 (esc # esl1) es l2 =
                                    l1 @ parse_es_cpts_i2 esl1 es (l2@[[esc]])&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d1</span><span> </span><span>d2</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(getspc_es esc = EvtSys es &#8743; length esl1 &gt; 0 &#8743; getspc_es (esl1!0) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;parse_es_cpts_i2 (esc # esl1) es (l1 @ l2) =
                                    parse_es_cpts_i2 esl1 es (list_update (l1 @ l2) (length (l1 @ l2) - 1) 
                                                                (last (l1 @ l2) @ [esc]))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;parse_es_cpts_i2 (esc # esl1) es (l1 @ l2) =
                                    parse_es_cpts_i2 esl1 es (l1 @ list_update l2 (length l2 - 1) (last l2 @ [esc]) )&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>append1_eq_conv</span><span> </span><span>append_assoc</span><span> </span><span>append_butlast_last_id</span><span> 
</span><span>                              </span><span>append_is_Nil_conv</span><span> </span><span>length_butlast</span><span> </span><span>list_update_length</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a0</span><span> </span><span>b1</span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;parse_es_cpts_i2 (esc # esl1) es (l1 @ l2) =
                                    l1 @ parse_es_cpts_i2 esl1 es (list_update l2 (length l2 - 1) (last l2 @ [esc]) )&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;l1 @ parse_es_cpts_i2 (esc # esl1) es l2 = 
                                  l1 @ parse_es_cpts_i2 esl1 es (list_update l2 (length l2 - 1) (last l2 @ [esc]))&quot;</span></span></span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d3</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>parse_es_cpts_i2_lst</span><span class="delimiter">:</span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;esl l1 l2 es. esl&#8712;cpts_es &#915; &#8743; (l2::((&#39;l,&#39;k,&#39;s,&#39;prog) esconfs) list) &#8800; [] 
                    &#10230; parse_es_cpts_i2 esl es ([l1]@l2) = [l1]@(parse_es_cpts_i2 esl es l2)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>parse_es_cpts_i2_lst0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>parse_es_cpts_i2_fst</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;esl elst rlst es l. esl&#8712;cpts_es &#915; &#8743; rlst = [l] &#8743; elst = parse_es_cpts_i2 esl es rlst 
                                                  &#10230; (&#8707;i&#8804;length (elst!0). take i (elst!0) = l)&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>esl</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;elst rlst es l. esl&#8712;cpts_es &#915; &#8743; rlst = [l] &#8743; elst = parse_es_cpts_i2 esl es rlst 
                            &#10230; (&#8707;i&#8804;length (elst!0). take i (elst!0) = l)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>esl</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>Nil</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Cons</span><span> </span><span>esc</span><span> </span><span>esl1</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;elst rlst es l. esl1 &#8712; cpts_es &#915; &#8743; rlst = [l] &#8743; elst = parse_es_cpts_i2 esl1 es rlst 
                                    &#10230; (&#8707;i&#8804;length (elst ! 0). take i (elst ! 0) = l)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>          </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>elst</span><span> </span><span>rlst</span><span> </span><span>es</span><span> </span><span>l</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esc # esl1 &#8712; cpts_es &#915;&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rlst = [l]&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst = parse_es_cpts_i2 (esc # esl1) es rlst&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;i&#8804;length (elst ! 0). take i (elst ! 0) = l&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl1 = []&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl1 = []&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst = parse_es_cpts_i2 [] es (list_update rlst (length rlst - 1) (last rlst @ [esc]))&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst = list_update rlst (length rlst - 1) (last rlst @ [esc])&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst = [l@[esc]]&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>butlast_conv_take</span><span> </span><span>butlast_snoc</span><span> </span><span>linear</span><span> </span><span>nth_Cons_0</span><span> </span><span>take_all</span><span class="delimiter">)</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(esl1 = [])&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl1 &#8712; cpts_es &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_es_dropi</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c0</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>esl2</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>ec1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl1 = ec1 # esl2&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>neq_Nil_conv</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es esc = EvtSys es &#8743; length esl1 &gt; 0 &#8743; getspc_es (esl1!0) &#8800; EvtSys es&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es esc = EvtSys es &#8743; length esl1 &gt; 0 &#8743; getspc_es (esl1!0) &#8800; EvtSys es&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d01</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es ec1 &#8800; EvtSys es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;parse_es_cpts_i2 (esc # esl1) es rlst = parse_es_cpts_i2 esl1 es (rlst@[[esc]])&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b1</span><span> </span><span>b2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst = parse_es_cpts_i2 esl1 es ([l]@[[esc]])&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;parse_es_cpts_i2 esl1 es ([l]@[[esc]]) = [l]@parse_es_cpts_i2 esl1 es ([[esc]])&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>parse_es_cpts_i2_lst</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst = [l] @ parse_es_cpts_i2 esl1 es ([[esc]])&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(getspc_es esc = EvtSys es &#8743; length esl1 &gt; 0 &#8743; getspc_es (esl1!0) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;parse_es_cpts_i2 (esc # esl1) es rlst = 
                                parse_es_cpts_i2 esl1 es (list_update rlst (length rlst - 1) (last rlst @ [esc]))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst = parse_es_cpts_i2 esl1 es (list_update rlst (length rlst - 1) (last rlst @ [esc]))&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst = parse_es_cpts_i2 esl1 es ([l @ [esc]])&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a0</span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;i&#8804;length (elst ! 0). take i (elst ! 0) = l @ [esc]&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>i</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i&#8804;length (elst ! 0) &#8743; take i (elst ! 0) = l @ [esc]&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>butlast_snoc</span><span> </span><span>butlast_take</span><span> </span><span>diff_le_self</span><span> </span><span>dual_order.trans</span><span class="delimiter">)</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>parse_es_cpts_i2_start_withlen</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;esl elst rlst es l. esl&#8712;cpts_es &#915; &#8743; rlst &#8800; [] &#8743; elst = parse_es_cpts_i2 esl es rlst &#10230;
                        (&#8704;i. i &#8805; length rlst &#8743; i &lt; length elst &#10230; 
                            length (elst!i) &#8805; 2 &#8743; getspc_es (elst!i!0) = EvtSys es &#8743; getspc_es (elst!i!1) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>esl</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;elst rlst es l. esl&#8712;cpts_es &#915; &#8743; rlst &#8800; [] &#8743; elst = parse_es_cpts_i2 esl es rlst &#10230;
                        (&#8704;i. i &#8805; length rlst &#8743; i &lt; length elst &#10230; 
                            length (elst!i) &#8805; 2 &#8743; getspc_es (elst!i!0) = EvtSys es &#8743; getspc_es (elst!i!1) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>esl</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>Nil</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Cons</span><span> </span><span>esc</span><span> </span><span>esl1</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;elst rlst es l. esl1 &#8712; cpts_es &#915; &#8743; rlst &#8800; [] &#8743; elst = parse_es_cpts_i2 esl1 es rlst &#10230;
                                    (&#8704;i. i &#8805; length rlst &#8743; i &lt; length elst &#10230; 
                                         length (elst!i) &#8805; 2 &#8743; getspc_es (elst ! i ! 0) = EvtSys es 
                                          &#8743; getspc_es (elst ! i ! 1) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>          </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>elst</span><span> </span><span>rlst</span><span> </span><span>es</span><span> </span><span>l</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esc # esl1 &#8712; cpts_es &#915;&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rlst &#8800; []&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst = parse_es_cpts_i2 (esc # esl1) es rlst&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. i &#8805; length rlst &#8743; i &lt; length elst &#10230; length (elst!i) &#8805; 2 &#8743; getspc_es (elst ! i ! 0) = EvtSys es 
                                                &#8743; getspc_es (elst ! i ! 1) &#8800; EvtSys es&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl1 = []&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl1 = []&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;parse_es_cpts_i2 (esc # []) es rlst = 
                            parse_es_cpts_i2 [] es (list_update rlst (length rlst - 1) (last rlst @ [esc]))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;parse_es_cpts_i2 [] es (list_update rlst (length rlst - 1) (last rlst @ [esc]))
                      = list_update rlst (length rlst - 1) (last rlst @ [esc])&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b2</span><span> </span><span>c0</span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst = list_update rlst (length rlst - 1) (last rlst @ [esc])&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(esl1 = [])&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl1 &#8712; cpts_es &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_es_dropi</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c0</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>esl2</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>ec1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl1 = ec1 # esl2&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>neq_Nil_conv</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es esc = EvtSys es &#8743; length esl1 &gt; 0 &#8743; getspc_es (esl1!0) &#8800; EvtSys es&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es esc = EvtSys es &#8743; length esl1 &gt; 0 &#8743; getspc_es (esl1!0) &#8800; EvtSys es&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d01</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es ec1 &#8800; EvtSys es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;parse_es_cpts_i2 (esc # esl1) es rlst = parse_es_cpts_i2 esl1 es (rlst@[[esc]])&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b1</span><span> </span><span>b2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst = parse_es_cpts_i2 esl1 es (rlst@[[esc]])&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;parse_es_cpts_i2 esl1 es (rlst@[[esc]]) = rlst@parse_es_cpts_i2 esl1 es ([[esc]])&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>parse_es_cpts_i2_lst0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst = rlst @ parse_es_cpts_i2 esl1 es ([[esc]])&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl2 = []&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl2 = []&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst = rlst @ parse_es_cpts_i2 [] es 
                                        (list_update [[esc]] (length [[esc]] - 1) (last [[esc]] @ [ec1]))&quot;</span></span></span><span>
</span><span>                           </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>b2</span><span> </span><span>d1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst = rlst @ (list_update [[esc]] (length [[esc]] - 1) (last [[esc]] @ [ec1]))&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst = rlst @ ([[esc] @ [ec1]])&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d0</span><span> </span><span>d01</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>leD</span><span> </span><span>le_eq_less_or_eq</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(esl2 = [])&quot;</span></span></span><span>
</span><span>                        
</span><span>                        </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?elst2</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;parse_es_cpts_i2 esl1 es ([[esc]])&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. i &#8805; 1 &#8743; i &lt; length ?elst2 &#10230; 
                                             length (?elst2!i) &#8805; 2 &#8743; getspc_es (?elst2 ! i ! 0) = EvtSys es 
                                             &#8743; getspc_es (?elst2 ! i ! 1) &#8800; EvtSys es&quot;</span></span></span><span>
</span><span>                           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>One_nat_def</span><span> </span><span>length_Cons</span><span> </span><span>list.distinct</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>list.size</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span class="delimiter">)</span><span> 
</span><span>                           
</span><span>                        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c2</span><span> </span><span>d01</span><span> </span><span>d3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst = rlst @ parse_es_cpts_i2 esl2 es 
                                                      (list_update [[esc]] (length [[esc]] - 1) (last [[esc]] @ [ec1]))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst = rlst @ parse_es_cpts_i2 esl2 es [[esc]@[ec1]]&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?elst2 = parse_es_cpts_i2 esl2 es [[esc]@[ec1]]&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c1</span><span> </span><span>c2</span><span> </span><span>e0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl2&#8712;cpts_es &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_es_dropi</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>e3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;i&#8804;length (?elst2!0). take i (?elst2!0) = [esc]@[ec1]&quot;</span></span></span><span> 
</span><span>                          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>parse_es_cpts_i2_fst</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d0</span><span> </span><span>d01</span><span> </span><span>e1</span><span> </span><span>e2</span><span> </span><span>e3</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                          </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>                            </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>                            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>f0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length rlst &#8804; i &#8743; i &lt; length elst&quot;</span></span></span><span>
</span><span>                            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length (elst ! i) &#8805; 2 &#8743; getspc_es (elst ! i ! 0) = EvtSys es 
                                    &#8743; getspc_es (elst ! i ! 1) &#8800; EvtSys es&quot;</span></span></span><span>
</span><span>                              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length rlst = i&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>g0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length rlst = i&quot;</span></span></span><span>
</span><span>                                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst ! i = ?elst2!0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>e2</span><span> </span><span>e3</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span> 
</span><span>                                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>e4</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>One_nat_def</span><span> </span><span>Suc_1</span><span> </span><span>butlast_snoc</span><span> 
</span><span>                                      </span><span>butlast_take</span><span> </span><span>c2</span><span> </span><span>d0</span><span> </span><span>diff_Suc_1</span><span> </span><span>length_Cons</span><span> </span><span>length_append_singleton</span><span> 
</span><span>                                      </span><span>length_take</span><span> </span><span>lessI</span><span> </span><span>list.size</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>min.absorb2</span><span> </span><span>nth_Cons_0</span><span> 
</span><span>                                      </span><span>nth_append_length</span><span> </span><span>nth_take</span><span class="delimiter">)</span><span>  
</span><span>                              </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>g0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (length rlst = i)&quot;</span></span></span><span>
</span><span>                                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>f0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length rlst &lt; i &#8743; i &lt; length elst&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>e1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Nil_is_append_conv</span><span> </span><span>Suc_leI</span><span> </span><span>a0</span><span> </span><span>b1</span><span> 
</span><span>                                    </span><span>c1</span><span> </span><span>d4</span><span> </span><span>e2</span><span> </span><span>e3</span><span> </span><span>length_append_singleton</span><span class="delimiter">)</span><span> 
</span><span>                              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(getspc_es esc = EvtSys es &#8743; length esl1 &gt; 0 &#8743; getspc_es (esl1!0) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;parse_es_cpts_i2 (esc # esl1) es rlst = 
                                parse_es_cpts_i2 esl1 es (list_update rlst (length rlst - 1) (last rlst @ [esc]))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst = parse_es_cpts_i2 esl1 es (list_update rlst (length rlst - 1) (last rlst @ [esc]))&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a0</span><span> </span><span>c1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>length_list_update</span><span> </span><span>list_update_nonempty</span><span class="delimiter">)</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>parse_es_cpts_i2_start_withlen0</span><span> </span><span class="delimiter">[</span><span>simp</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;esl&#8712;cpts_es &#915;; rlst &#8800; []; elst = parse_es_cpts_i2 esl es rlst&#10215; &#10233;
          &#8704;i. i &#8805; length rlst &#8743; i &lt; length elst &#10230; length (elst!i) &#8805; 2 
            &#8743; getspc_es (elst!i!0) = EvtSys es &#8743; getspc_es (elst!i!1) &#8800; EvtSys es&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>parse_es_cpts_i2_start_withlen</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>parse_es_cpts_i2_fstempty</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs; esl&#8712;cpts_es &#915;;
        rlst = parse_es_cpts_i2 esl es [[]]&#10215; &#10233; rlst!0 =[]&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;cpts_es &#915;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rlst = parse_es_cpts_i2 esl es [[]]&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rlst = parse_es_cpts_i2 ((EvtSeq e (EvtSys es), s1,x1) # xs) es ([[]]@[[(EvtSys es, s, x)]])&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>getspc_es_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(EvtSeq e (EvtSys es), s1,x1) # xs &#8712; cpts_es &#915;&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_es_dropi</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rlst = [[]]@ parse_es_cpts_i2 ((EvtSeq e (EvtSys es), s1,x1) # xs) es ([[(EvtSys es, s, x)]])&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>parse_es_cpts_i2_lst0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>parse_es_cpts_i2_concat3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs; esl&#8712;cpts_es &#915;;
        rlst = parse_es_cpts_i2 esl es [[]]&#10215; &#10233; concat (tl rlst) = esl&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>parse_es_cpts_i2_concat1</span><span> </span><span>parse_es_cpts_i2_fstempty</span><span> 
</span><span>   </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>append_Nil</span><span> </span><span>concat.simps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>concat.simps</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>hd_Cons_tl</span><span> </span><span>list.distinct</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>nth_Cons_0</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>parse_es_cpts_i2_noent_mid0</span><span class="delimiter">:</span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;esl elst l es. esl&#8712;cpts_es &#915; &#8743; elst = parse_es_cpts_i2 esl es [l] &#10230;
                        &#172;(length l &gt; 1 &#8743; getspc_es (last l) = EvtSys es &#8743; getspc_es (esl!0) &#8800; EvtSys es) &#10230;
                        &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length l &#8743; 
                             getspc_es (l!j) = EvtSys es &#8743; getspc_es (l!Suc j) &#8800; EvtSys es) &#10230;
                        (&#8704;i. i &lt; length elst &#10230; &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length (elst!i) &#8743; 
                             getspc_es (elst!i!j) = EvtSys es &#8743; getspc_es (elst!i!Suc j) &#8800; EvtSys es))&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>esl</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;elst l es. esl&#8712;cpts_es &#915; &#8743; elst = parse_es_cpts_i2 esl es [l] &#10230;
                        &#172;(length l &gt; 1 &#8743; getspc_es (last l) = EvtSys es &#8743; getspc_es (esl!0) &#8800; EvtSys es) &#10230;
                        &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length l &#8743; 
                             getspc_es (l!j) = EvtSys es &#8743; getspc_es (l!Suc j) &#8800; EvtSys es) &#10230;
                        (&#8704;i. i &lt; length elst &#10230; &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length (elst!i) &#8743; 
                             getspc_es (elst!i!j) = EvtSys es &#8743; getspc_es (elst!i!Suc j) &#8800; EvtSys es))&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>esl</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>Nil</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Cons</span><span> </span><span>esc</span><span> </span><span>esl1</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;elst l es. esl1&#8712;cpts_es &#915; &#8743; elst = parse_es_cpts_i2 esl1 es [l] &#10230;
                        &#172;(length l &gt; 1 &#8743; getspc_es (last l) = EvtSys es &#8743; getspc_es (esl1!0) &#8800; EvtSys es) &#10230;
                        &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length l &#8743; 
                             getspc_es (l!j) = EvtSys es &#8743; getspc_es (l!Suc j) &#8800; EvtSys es) &#10230;
                        (&#8704;i. i &lt; length elst &#10230; &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length (elst!i) &#8743; 
                             getspc_es (elst!i!j) = EvtSys es &#8743; getspc_es (elst!i!Suc j) &#8800; EvtSys es))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>          </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>elst</span><span> </span><span>l</span><span> </span><span>es</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esc # esl1 &#8712; cpts_es &#915;&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst = parse_es_cpts_i2 (esc # esl1) es [l]&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (length l &gt; 1 &#8743; getspc_es (last l) = EvtSys es &#8743; getspc_es ((esc # esl1) ! 0) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (&#8707;j&gt;0. Suc j &lt; length l &#8743; getspc_es (l ! j) = EvtSys es &#8743; getspc_es (l ! Suc j) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;i. i &lt; length elst &#10230; &#172; (&#8707;j&gt;0. Suc j &lt; length (elst ! i) &#8743;
                    getspc_es (elst ! i ! j) = EvtSys es &#8743; getspc_es (elst ! i ! Suc j) &#8800; EvtSys es))&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl1 = []&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl1 = []&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;parse_es_cpts_i2 (esc # []) es [l] = 
                            parse_es_cpts_i2 [] es (list_update [l] (length [l] - 1) (last [l] @ [esc]))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;parse_es_cpts_i2 [] es (list_update [l] (length [l] - 1) (last [l] @ [esc]))
                      = list_update [l] (length [l] - 1) (last [l] @ [esc])&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b1</span><span> </span><span>c0</span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst = list_update [l] (length [l] - 1) (last [l] @ [esc])&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst = [l @ [esc]]&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b2</span><span> </span><span>b3</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>Suc_eq_plus1_left</span><span> </span><span>Suc_lessD</span><span> </span><span>Suc_lessI</span><span> </span><span>diff_Suc_1</span><span> 
</span><span>                  </span><span>dual_order.strict_trans</span><span> </span><span>last_conv_nth</span><span> </span><span>length_Cons</span><span> </span><span>length_append_singleton</span><span> 
</span><span>                  </span><span>less_antisym</span><span> </span><span>less_one</span><span> </span><span>list.size</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>nat_neq_iff</span><span> </span><span>nth_Cons_0</span><span> </span><span>nth_append</span><span> </span><span>nth_append_length</span><span class="delimiter">)</span><span>
</span><span>                  
</span><span>              </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(esl1 = [])&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl1 &#8712; cpts_es &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_es_dropi</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c0</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>esl2</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>ec1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl1 = ec1 # esl2&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>neq_Nil_conv</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es esc = EvtSys es &#8743; length esl1 &gt; 0 &#8743; getspc_es (esl1!0) &#8800; EvtSys es&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es esc = EvtSys es &#8743; length esl1 &gt; 0 &#8743; getspc_es (esl1!0) &#8800; EvtSys es&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d01</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es ec1 &#8800; EvtSys es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;parse_es_cpts_i2 (esc # esl1) es [l] = parse_es_cpts_i2 esl1 es ([l]@[[esc]])&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b1</span><span> </span><span>b2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst = parse_es_cpts_i2 esl1 es ([l]@[[esc]])&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;parse_es_cpts_i2 esl1 es ([l]@[[esc]]) = [l]@parse_es_cpts_i2 esl1 es ([[esc]])&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>parse_es_cpts_i2_lst0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst = [l] @ parse_es_cpts_i2 esl1 es ([[esc]])&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?elst1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;parse_es_cpts_i2 esl1 es ([[esc]])&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(length [esc] &gt; 1 &#8743; getspc_es (last [esc]) = EvtSys es &#8743; getspc_es (esl1!0) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length [esc] &#8743; 
                             getspc_es ([esc]!j) = EvtSys es &#8743; getspc_es ([esc]!Suc j) &#8800; EvtSys es)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>                    
</span><span>                    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. i &lt; length ?elst1 &#10230; &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length (?elst1!i) &#8743; 
                             getspc_es (?elst1!i!j) = EvtSys es &#8743; getspc_es (?elst1!i!Suc j) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>                       </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b3</span><span> </span><span>d3</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>Nil_is_append_conv</span><span> </span><span>Nitpick.size_list_simp</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> 
</span><span>                        </span><span>One_nat_def</span><span> </span><span>Suc_diff_Suc</span><span> </span><span>Suc_less_eq</span><span> </span><span>append_Cons</span><span> </span><span>append_Nil</span><span> 
</span><span>                        </span><span>diff_Suc_1</span><span> </span><span>diff_Suc_Suc</span><span> </span><span>list.sel</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>not_gr0</span><span> </span><span>nth_Cons&#39;</span><span class="delimiter">)</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(getspc_es esc = EvtSys es &#8743; length esl1 &gt; 0 &#8743; getspc_es (esl1!0) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;parse_es_cpts_i2 (esc # esl1) es [l] = 
                                parse_es_cpts_i2 esl1 es (list_update [l] (length [l] - 1) (last [l] @ [esc])) &quot;</span></span></span><span>
</span><span>                                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst = parse_es_cpts_i2 esl1 es ([l@[esc]])&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length esl1 = 0&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length esl1 = 0&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl1 = []&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst = [l@[esc]]&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b2</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>e1</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>linarith</span><span> 
</span><span>                      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(length esl1 = 0)&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length esl1 &gt; 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(getspc_es esc = EvtSys es &#8743; getspc_es (esl1!0) &#8800; EvtSys es)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (1 &lt; length (l@[esc]) &#8743; getspc_es (last (l@[esc])) = EvtSys es 
                                    &#8743; getspc_es (esl1 ! 0) &#8800; EvtSys es)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b2</span><span> </span><span>b3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (&#8707;j&gt;0. Suc j &lt; length (l@[esc]) &#8743; getspc_es ((l@[esc]) ! j) = EvtSys es &#8743; 
                                getspc_es ((l@[esc]) ! Suc j) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>hide_lams</span><span class="delimiter">)</span><span> </span><span>Suc_neq_Zero</span><span> </span><span>diff_Suc_1</span><span> </span><span>last_conv_nth</span><span> 
</span><span>                            </span><span>length_append_singleton</span><span> </span><span>less_antisym</span><span> </span><span>list.size</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>not_gr0</span><span> </span><span>not_less_eq</span><span> 
</span><span>                            </span><span>nth_Cons_0</span><span> </span><span>nth_append</span><span> </span><span>zero_less_diff</span><span class="delimiter">)</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span> </span><span>d1</span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>parse_es_cpts_i2_noent_mid</span><span class="delimiter">:</span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs; esl&#8712;cpts_es &#915;; 
      elst = parse_es_cpts_i2 esl es [[]]&#10215; &#10233;  &#8704;i. i &lt; length (tl elst) &#10230; 
                             &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length ((tl elst)!i) &#8743; 
                             getspc_es ((tl elst)!i!j) = EvtSys es &#8743; getspc_es ((tl elst)!i!Suc j) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;cpts_es &#915;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst = parse_es_cpts_i2 esl es [[]]&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(length [] &gt; 1 &#8743; getspc_es (last []) = EvtSys es &#8743; getspc_es (esl!0) &#8800; EvtSys es)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length [] &#8743; 
                      getspc_es ([]!j) = EvtSys es &#8743; getspc_es ([]!Suc j) &#8800; EvtSys es)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. i &lt; length elst &#10230; &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length (elst!i) &#8743; 
                             getspc_es (elst!i!j) = EvtSys es &#8743; getspc_es (elst!i!Suc j) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>parse_es_cpts_i2_noent_mid0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>List.nth_tl</span><span> </span><span>Nitpick.size_list_simp</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>Suc_mono</span><span> </span><span>list.sel</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>parse_es_cpts_i2_start_aux</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs; esl&#8712;cpts_es &#915;;
        elst = parse_es_cpts_i2 esl es [[]]&#10215; &#10233; 
        &#8704;i. i &lt; length (tl elst) &#10230; length ((tl elst)!i) &#8805; 2  &#8743; 
            getspc_es ((tl elst)!i!0) = EvtSys es &#8743; getspc_es ((tl elst)!i!1) &#8800; EvtSys es&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;cpts_es &#915;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst = parse_es_cpts_i2 esl es [[]]&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. i &#8805; length [[]] &#8743; i &lt; length elst &#10230; length (elst!i) &#8805; 2  &#8743; 
            getspc_es (elst!i!0) = EvtSys es &#8743; getspc_es (elst!i!1) &#8800; EvtSys es&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>length_Cons</span><span> </span><span>list.distinct</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>list.size</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>parse_es_cpts_i2_start_withlen0</span><span class="delimiter">)</span><span> 
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i &lt; length (tl elst)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length (tl elst ! i) &#8805; 2&quot;</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>List.nth_tl</span><span> </span><span>Nil_tl</span><span> </span><span>Nitpick.size_list_simp</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>One_nat_def</span><span> 
</span><span>              </span><span>Suc_eq_plus1_left</span><span> </span><span>Suc_less_eq</span><span> </span><span>le_add1</span><span> </span><span>length_Cons</span><span> </span><span>less_nat_zero_code</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (elst!Suc i!0) = EvtSys es &#8743; getspc_es (elst!Suc i!1) &#8800; EvtSys es&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(tl elst)!i = elst!Suc i&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>List.nth_tl</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length (tl elst ! i) &#8805; 2 &#8743; getspc_es ((tl elst)!i!0) = EvtSys es 
          &#8743; getspc_es ((tl elst)!i!1) &#8800; EvtSys es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>    
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>parse_es_cpts_i2_noent_mid_i</span><span class="delimiter">:</span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs; esl&#8712;cpts_es &#915;; 
      elst = tl (parse_es_cpts_i2 esl es [[]]); Suc i &lt; length elst; esl1 = elst!i@[elst!Suc i!0]&#10215; &#10233;  
        &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl1 &#8743; 
              getspc_es (esl1!j) = EvtSys es &#8743; getspc_es (esl1!Suc j) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;cpts_es &#915;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst = tl (parse_es_cpts_i2 esl es [[]])&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length elst&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl1 = elst!i@[elst!Suc i!0]&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?esl2</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst!i&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>p3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length ?esl2 &#8743; 
              getspc_es (?esl2!j) = EvtSys es &#8743; getspc_es (?esl2!Suc j) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>parse_es_cpts_i2_noent_mid</span><span class="delimiter">[</span><span>of</span><span> </span><span>esl</span><span> </span><span>es</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>e</span><span> </span><span>s1</span><span> </span><span>x1</span><span> </span><span>xs</span><span> </span><span>&#915;</span><span> </span><span>elst</span><span class="delimiter">]</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>Suc_lessD</span><span> </span><span>parse_es_cpts_i2_noent_mid</span><span class="delimiter">)</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>p3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (elst!Suc i!0) = EvtSys es&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>parse_es_cpts_i2_start_aux</span><span class="delimiter">[</span><span>of</span><span> </span><span>esl</span><span> </span><span>es</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>e</span><span> </span><span>s1</span><span> </span><span>x1</span><span> </span><span>xs</span><span>  </span><span>&#915;</span><span>
</span><span>          </span><span class="string"><span class="delete"><span class="delete">&quot;parse_es_cpts_i2 esl es [[]]&quot;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>nth_append</span><span> </span><span>p4</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>parse_es_cpts_i2_drop_cptes</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs; esl&#8712;cpts_es &#915;;
        elst = tl (parse_es_cpts_i2 esl es [[]])&#10215; &#10233; 
        &#8704;i. i &lt; length elst &#10230; concat (drop i elst)&#8712;cpts_es &#915;&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;cpts_es &#915;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst = tl (parse_es_cpts_i2 esl es [[]])&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;concat elst = esl&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>parse_es_cpts_i2_concat3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i &lt; length elst&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;concat (drop i elst)&#8712;cpts_es &#915;&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>i</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span> </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span>a1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>j</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j &lt; length elst &#10233; concat (drop j elst) &#8712; cpts_es &#915;&quot;</span></span></span><span>
</span><span>            </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc j &lt; length elst&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;concat (drop (Suc j) elst) = drop (length (elst!j)) (concat (drop j elst))&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Cons_nth_drop_Suc</span><span> </span><span>Suc_lessD</span><span> </span><span>append_eq_conv_conj</span><span> </span><span>concat.simps</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c0</span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;concat (drop j elst) &#8712; cpts_es &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c1</span><span> </span><span>c2</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_es_dropi2</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;concat (drop j elst)&quot;</span></span></span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length (elst ! j)&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>List.nth_tl</span><span> </span><span>Suc_leI</span><span> </span><span>Suc_lessE</span><span> </span><span>concat_last_lm</span><span> </span><span>diff_Suc_1</span><span> </span><span>drop.simps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> 
</span><span>              </span><span>last_conv_nth</span><span> </span><span>last_drop</span><span> </span><span>le_less_trans</span><span> </span><span>length_0_conv</span><span> </span><span>length_Cons</span><span> </span><span>length_drop</span><span> 
</span><span>              </span><span>length_greater_0_conv</span><span> </span><span>length_tl</span><span> </span><span>lessI</span><span> </span><span>numeral_2_eq_2</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>parse_es_cpts_i2_start_withlen0</span><span> 
</span><span>              </span><span>zero_less_diff</span><span class="delimiter">)</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>parse_es_cpts_i2_in_cptes_i</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs; esl&#8712;cpts_es &#915;;
        elst = tl (parse_es_cpts_i2 esl es [[]])&#10215; &#10233; 
        &#8704;i. Suc i &lt; length elst &#10230; (elst!i)@[elst!Suc i!0] &#8712;cpts_es &#915;&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;cpts_es &#915;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst = tl (parse_es_cpts_i2 esl es [[]])&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;concat elst = esl&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>parse_es_cpts_i2_concat3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. i &lt; length elst &#10230; length (elst!i) &#8805; 2&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>parse_es_cpts_i2_start_aux</span><span class="delimiter">[</span><span>of</span><span> </span><span>esl</span><span> </span><span>es</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>e</span><span> </span><span>s1</span><span> </span><span>x1</span><span> </span><span>xs</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;parse_es_cpts_i2 esl es [[]]&quot;</span></span></span><span class="delimiter">]</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length elst&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(elst!i)@[elst!Suc i!0] &#8712;cpts_es &#915;&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i = 0&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i = 0&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a0</span><span> </span><span>p4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length (elst!1) &#8805; 2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p3</span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl = (elst!0) @ concat (drop 1 elst)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Cons_nth_drop_Suc</span><span> </span><span>One_nat_def</span><span> </span><span>Suc_lessD</span><span> </span><span>b0</span><span> </span><span>concat.simps</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>drop_0</span><span class="delimiter">)</span><span>  
</span><span>          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl = (elst!0) @ ((elst!1) @ concat (drop 2 elst))&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Cons_nth_drop_Suc</span><span> </span><span>One_nat_def</span><span> </span><span>Suc_1</span><span> </span><span>b0</span><span> </span><span>concat.simps</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span class="delimiter">)</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a0</span><span> </span><span>b0</span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;take ((length (elst ! 0)) + 1) esl = (elst ! 0) @ [elst!Suc 0!0]&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>Cons_nth_drop_Suc</span><span> </span><span>Nil_is_append_conv</span><span> </span><span>One_nat_def</span><span> </span><span>Suc_1</span><span> </span><span>Suc_le_lessD</span><span> 
</span><span>                </span><span>append.simps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>append.simps</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>append_eq_conv_conj</span><span> </span><span>drop_0</span><span> </span><span>length_greater_0_conv</span><span> 
</span><span>                </span><span>list.size</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>not_less0</span><span> </span><span>nth_Cons_0</span><span> </span><span>take_0</span><span> </span><span>take_Suc_conv_app_nth</span><span> </span><span>take_add</span><span class="delimiter">)</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span>b0</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_es_take</span><span class="delimiter">[</span><span>of</span><span> </span><span>esl</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length (elst ! 0)&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>One_nat_def</span><span> </span><span>Suc_lessD</span><span> </span><span>add.right_neutral</span><span> </span><span>add_Suc_right</span><span> </span><span>le_less_linear</span><span> </span><span>take_all</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i&#8800;0&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i &gt; 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>          </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?elst</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop (i - 1) elst&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?esl</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;concat ?elst&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b01</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length ?elst &gt; 2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span>p4</span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length (?elst!1) &#8805; 2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>a0</span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl&#8712;cpts_es &#915;&quot;</span></span></span><span> 
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>parse_es_cpts_i2_drop_cptes</span><span class="delimiter">[</span><span>of</span><span> </span><span>esl</span><span> </span><span>es</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>e</span><span> </span><span>s1</span><span> </span><span>x1</span><span> </span><span>xs</span><span> </span><span>&#915;</span><span> </span><span>elst</span><span class="delimiter">]</span><span>
</span><span>              </span><span>One_nat_def</span><span> </span><span>Suc_lessD</span><span> </span><span>Suc_pred</span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>presburger</span><span>
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p3</span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl = (?elst!0) @ concat (drop 1 ?elst)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Cons_nth_drop_Suc</span><span> </span><span>One_nat_def</span><span> </span><span>Suc_lessD</span><span> </span><span>Suc_pred</span><span> </span><span>b0</span><span> 
</span><span>                </span><span>concat.simps</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>drop_0</span><span> </span><span>length_drop</span><span> </span><span>zero_less_diff</span><span class="delimiter">)</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl = (?elst!0) @ ((?elst!1) @ concat (drop 2 ?elst))&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Cons_nth_drop_Suc</span><span> </span><span>One_nat_def</span><span> </span><span>Suc_1</span><span> 
</span><span>                </span><span>Suc_leI</span><span> </span><span>Suc_lessD</span><span> </span><span>b0</span><span> </span><span>concat.simps</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>diff_diff_cancel</span><span> </span><span>diff_le_self</span><span> 
</span><span>                </span><span>diff_less_mono</span><span> </span><span>length_drop</span><span class="delimiter">)</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b0</span><span> </span><span>b01</span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;take ((length (?elst ! 0)) + 1) ?esl = (?elst ! 0) @ [?elst!1!0]&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>Cons_nth_drop_Suc</span><span> </span><span>Nil_is_append_conv</span><span> </span><span>One_nat_def</span><span> </span><span>append.simps</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> 
</span><span>                </span><span>append_eq_conv_conj</span><span> </span><span>drop_0</span><span> </span><span>length_greater_0_conv</span><span> </span><span>list.size</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>not_numeral_le_zero</span><span> 
</span><span>                </span><span>nth_Cons_0</span><span> </span><span>take_0</span><span> </span><span>take_Suc_conv_app_nth</span><span> </span><span>take_add</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b2</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_es_take</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?esl</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length (?elst ! 0)&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>Nil_is_append_conv</span><span> </span><span>a0</span><span> </span><span>concat_i_lm</span><span> </span><span>cpts_es_seg2</span><span> </span><span>list.size</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>not_Cons_self2</span><span> 
</span><span>              </span><span>not_numeral_le_zero</span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>p3</span><span> </span><span>parse_es_cpts_i2_start_aux</span><span class="delimiter">)</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>parse_es_cpts_i2_in_cptes_last</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs; esl&#8712;cpts_es &#915;;
        elst = tl (parse_es_cpts_i2 esl es [[]])&#10215; &#10233; 
        last elst &#8712;cpts_es &#915;&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;cpts_es &#915;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst = tl (parse_es_cpts_i2 esl es [[]])&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. i &lt; length elst &#10230; concat (drop i elst)&#8712;cpts_es &#915;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>parse_es_cpts_i2_drop_cptes</span><span class="delimiter">[</span><span>of</span><span> </span><span>esl</span><span> </span><span>es</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>e</span><span> </span><span>s1</span><span> </span><span>x1</span><span> </span><span>xs</span><span> </span><span>&#915;</span><span> </span><span>elst</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>append_butlast_last_id</span><span> </span><span>append_eq_conv_conj</span><span> 
</span><span>          </span><span>concat.simps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>concat.simps</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>diff_less</span><span> </span><span>length_butlast</span><span> </span><span>length_greater_0_conv</span><span> 
</span><span>          </span><span>less_one</span><span> </span><span>list.simps</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>parse_es_cpts_i2_concat3</span><span> </span><span>self_append_conv</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>evtsys_fst_ent</span><span class="delimiter">:</span><span> 
</span><span>      </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;esl &#8712; cpts_es &#915;; getspc_es (esl ! 0) = EvtSys es; Suc m &#8804; length esl; &#8707;i. i &#8804; m &#8743; getspc_es (esl ! i) &#8800; EvtSys es&#10215; 
        &#10233; &#8707;i. (i &lt; m &#8743; getspc_es (esl ! i) = EvtSys es &#8743; getspc_es (esl ! Suc i) &#8800; EvtSys es) 
                &#8743; (&#8704;j. j &lt; i &#10230; getspc_es (esl ! j) = EvtSys es)&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl &#8712; cpts_es &#915;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl ! 0) = EvtSys es&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc m &#8804; length esl&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;i. i &#8804; m &#8743; getspc_es (esl ! i) &#8800; EvtSys es&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;m. esl &#8712; cpts_es &#915; &#8743; getspc_es (esl ! 0) = EvtSys es &#8743; Suc m &#8804; length esl 
                   &#8743; (&#8707;i. i &#8804; m &#8743; getspc_es (esl ! i) &#8800; EvtSys es)  
             &#10230; (&#8707;i. (i &lt; m &#8743; getspc_es (esl ! i) = EvtSys es &#8743; getspc_es (esl ! Suc i) &#8800; EvtSys es) 
                &#8743; (&#8704;j. j &lt; i &#10230; getspc_es (esl ! j) = EvtSys es))&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>m</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl &#8712; cpts_es &#915;&quot;</span></span></span><span>
</span><span>          </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl ! 0) = EvtSys es&quot;</span></span></span><span>
</span><span>          </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc m &#8804; length esl&quot;</span></span></span><span>
</span><span>          </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;i. i &#8804; m &#8743; getspc_es (esl ! i) &#8800; EvtSys es&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;i. (i &lt; m &#8743; getspc_es (esl ! i) = EvtSys es 
                        &#8743; getspc_es (esl ! Suc i) &#8800; EvtSys es) 
                        &#8743; (&#8704;j. j &lt; i &#10230; getspc_es (esl ! j) = EvtSys es)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>m</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;0.prems&quot;</span></span></span><span class="delimiter">(</span><span>4</span><span class="delimiter">)</span><span> </span><span>p1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>n</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl &#8712; cpts_es &#915; &#10233;
                        getspc_es (esl ! 0) = EvtSys es &#10233;
                        Suc n &#8804; length esl &#10233;
                        &#8707;i&#8804;n. getspc_es (esl ! i) &#8800; EvtSys es &#10233;
                        &#8707;i. (i &lt; n &#8743; getspc_es (esl ! i) = EvtSys es 
                            &#8743; getspc_es (esl ! Suc i) &#8800; EvtSys es) 
                            &#8743; (&#8704;j&lt;i. getspc_es (esl ! j) = EvtSys es)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl &#8712; cpts_es &#915;&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl ! 0) = EvtSys es&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc (Suc n) &#8804; length esl&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;i&#8804;Suc n. getspc_es (esl ! i) &#8800; EvtSys es&quot;</span></span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;i&#8804;n. getspc_es (esl ! i) &#8800; EvtSys es&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;i&#8804;n. getspc_es (esl ! i) &#8800; EvtSys es&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b0</span><span> </span><span>b1</span><span> </span><span>b2</span><span> </span><span>b3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;i. (i &lt; n &#8743; getspc_es (esl ! i) = EvtSys es 
                            &#8743; getspc_es (esl ! Suc i) &#8800; EvtSys es) 
                            &#8743; (&#8704;j&lt;i. getspc_es (esl ! j) = EvtSys es)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>less_Suc_eq</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#8707;i&#8804;n. getspc_es (esl ! i) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl ! Suc n) &#8800; EvtSys es&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>le_SucE</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j&lt;n. getspc_es (esl ! j) = EvtSys es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl ! n) = EvtSys es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>p3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rm_evtsys_in_cptse0</span><span class="delimiter">:</span><span> 
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;esl&#8712;cpts_es &#915;; length esl &gt; 0; &#8707;e. getspc_es (esl!0) = EvtSeq e (EvtSys es);
      &#172;(&#8707;j. Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es) &#10215;
       &#10233; rm_evtsys esl &#8712; cpts_ev &#915;&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;cpts_es &#915;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length esl &gt; 0&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e. getspc_es (esl!0) = EvtSeq e (EvtSys es)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#8707;j. Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;esl e es .esl&#8712;cpts_es &#915; &#8743; length esl &gt; 0 &#8743; (&#8707;e. getspc_es (esl!0) = EvtSeq e (EvtSys es)) &#8743;
      &#172;(&#8707;j. Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es) 
       &#10230; rm_evtsys esl &#8712; cpts_ev &#915;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>esl</span><span> </span><span>e</span><span> </span><span>es</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;cpts_es &#915;&quot;</span></span></span><span>
</span><span>          </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length esl &gt; 0&quot;</span></span></span><span>
</span><span>          </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e. getspc_es (esl!0) = EvtSeq e (EvtSys es)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#8707;j. Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys esl &#8712; cpts_ev &#915;&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>esl</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptsEsOne</span><span> </span><span>es1</span><span> </span><span>s</span><span> </span><span>x</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>es1</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>EvtSeq</span><span> </span><span>x1</span><span> </span><span>es1</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys [(EvtSeq x1 es1, s, x)] = [(x1, s, x)]&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>rm_evtsys_def</span><span> </span><span>rm_evtsys1_def</span><span> </span><span>getspc_es_def</span><span> </span><span>gets_es_def</span><span> </span><span>getx_es_def</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cpts_ev.CptsEvOne</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>EvtSys</span><span> </span><span>xa</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys [(EvtSys xa, s, x)] = [(AnonyEvent fin_com, s, x)]&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>rm_evtsys_def</span><span> </span><span>rm_evtsys1_def</span><span> </span><span>getspc_es_def</span><span> </span><span>gets_es_def</span><span> </span><span>getx_es_def</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cpts_ev.CptsEvOne</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptsEsEnv</span><span> </span><span>es1</span><span> </span><span>t</span><span> </span><span>x</span><span> </span><span>xs</span><span> </span><span>s</span><span> </span><span>y</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(es1, t, x) # xs &#8712; cpts_es &#915;&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;0 &lt; length ((es1, t, x) # xs) &#10233;
                          &#8707;e. getspc_es (((es1, t, x) # xs) ! 0) = EvtSeq e (EvtSys es) &#10233;
                          &#172; (&#8707;j. Suc j &lt; length ((es1, t, x) # xs) &#8743;
                          getspc_es (((es1, t, x) # xs) ! j) = EvtSys es &#8743; 
                          getspc_es (((es1, t, x) # xs) ! Suc j) &#8800; EvtSys es) &#10233;
                            rm_evtsys ((es1, t, x) # xs) &#8712; cpts_ev &#915;&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;0 &lt; length ((es1, s, y) # (es1, t, x) # xs)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e. getspc_es (((es1, s, y) # (es1, t, x) # xs) ! 0) = EvtSeq e (EvtSys es)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (&#8707;j. Suc j &lt; length ((es1, s, y) # (es1, t, x) # xs) &#8743;
                                getspc_es (((es1, s, y) # (es1, t, x) # xs) ! j) = EvtSys es &#8743;
                                getspc_es (((es1, s, y) # (es1, t, x) # xs) ! Suc j) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (&#8707;j. Suc j &lt; length ((es1, t, x) # xs) &#8743;
                                getspc_es (((es1, t, x) # xs) ! j) = EvtSys es &#8743; 
                                getspc_es (((es1, t, x) # xs) ! Suc j) &#8800; EvtSys es)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e. getspc_es (((es1, t, x) # xs) ! 0) = EvtSeq e (EvtSys es)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b3</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>e</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (((es1, s, y) # (es1, t, x) # xs) ! 0) = EvtSeq e (EvtSys es)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;es1 = EvtSeq e (EvtSys es)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>getspc_es_def</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>getspc_es_def</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys ((es1, t, x) # xs) &#8712; cpts_ev &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>b1</span><span> </span><span>b3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys1 (es1, t, x) # rm_evtsys xs &#8712; cpts_ev &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>rm_evtsys_def</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys ((es1, s, y) # (es1, t, x) # xs) = 
                    rm_evtsys1 (es1, s, y) # rm_evtsys1 (es1, t, x) # rm_evtsys xs&quot;</span></span></span><span> 
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>rm_evtsys_def</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b4</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>es1</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">case</span></span><span class="delimiter">(</span><span>EvtSeq</span><span> </span><span>x1</span><span> </span><span>es2</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys1 (EvtSeq x1 es2, t, x) # rm_evtsys xs &#8712; cpts_ev &#915;&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys ((EvtSeq x1 es2, s, y) # (EvtSeq x1 es2, t, x) # xs) = 
                        (x1,s,y) # (x1, t, x) # rm_evtsys xs&quot;</span></span></span><span> 
</span><span>                   </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>rm_evtsys_def</span><span> </span><span>rm_evtsys1_def</span><span> </span><span>getspc_es_def</span><span> </span><span>gets_es_def</span><span> </span><span>getx_es_def</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(x1, t, x) # rm_evtsys xs &#8712; cpts_ev &#915;&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>rm_evtsys_def</span><span> </span><span>rm_evtsys1_def</span><span> </span><span>getspc_es_def</span><span> </span><span>gets_es_def</span><span> </span><span>getx_es_def</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cpts_ev.CptsEvEnv</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>EvtSys</span><span> </span><span>xa</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys1 (EvtSys xa, t, x) # rm_evtsys xs &#8712; cpts_ev &#915;&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys ((EvtSys xa, s, y) # (EvtSys xa, t, x) # xs) = 
                        (AnonyEvent fin_com, s, y) # (AnonyEvent fin_com, t, x) # rm_evtsys xs&quot;</span></span></span><span> 
</span><span>                   </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>rm_evtsys_def</span><span> </span><span>rm_evtsys1_def</span><span> </span><span>getspc_es_def</span><span> </span><span>gets_es_def</span><span> </span><span>getx_es_def</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(AnonyEvent fin_com,t, x) # rm_evtsys xs &#8712; cpts_ev &#915;&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>rm_evtsys_def</span><span> </span><span>rm_evtsys1_def</span><span> </span><span>getspc_es_def</span><span> </span><span>gets_es_def</span><span> </span><span>getx_es_def</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cpts_ev.CptsEvEnv</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>CptsEsComp</span><span> </span><span>e1</span><span> </span><span>s1</span><span> </span><span>x1</span><span> </span><span>et</span><span> </span><span>e2</span><span> </span><span>t1</span><span> </span><span>y1</span><span> </span><span>xs1</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (e1, s1, x1) -es-et&#8594; (e2, t1, y1)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(e2, t1, y1) # xs1 &#8712; cpts_es &#915;&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;0 &lt; length ((e2, t1, y1) # xs1) &#10233;
                          &#8707;e. getspc_es (((e2, t1, y1) # xs1) ! 0) = EvtSeq e (EvtSys es) &#10233;
                          &#172; (&#8707;j. Suc j &lt; length ((e2, t1, y1) # xs1) &#8743;
                                  getspc_es (((e2, t1, y1) # xs1) ! j) = EvtSys es &#8743; 
                                  getspc_es (((e2, t1, y1) # xs1) ! Suc j) &#8800; EvtSys es) &#10233;
                                    rm_evtsys ((e2, t1, y1) # xs1) &#8712; cpts_ev &#915;&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;0 &lt; length ((e1, s1, x1) # (e2, t1, y1) # xs1)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e. getspc_es (((e1, s1, x1) # (e2, t1, y1) # xs1) ! 0) = EvtSeq e (EvtSys es)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (&#8707;j. Suc j &lt; length ((e1, s1, x1) # (e2, t1, y1) # xs1) &#8743;
                                getspc_es (((e1, s1, x1) # (e2, t1, y1) # xs1) ! j) = EvtSys es &#8743;
                                getspc_es (((e1, s1, x1) # (e2, t1, y1) # xs1) ! Suc j) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys ((e1, s1, x1) # (e2, t1, y1) # xs1) = 
                        rm_evtsys1 (e1, s1, x1) # rm_evtsys1 (e2, t1, y1) # rm_evtsys xs1&quot;</span></span></span><span> 
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>rm_evtsys_def</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b4</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>e&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (((e1, s1, x1) # (e2, t1, y1) # xs1) ! 0) = EvtSeq e&#39; (EvtSys es)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;e1 = EvtSeq e&#39; (EvtSys es)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>getspc_es_def</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e. e2 = EvtSeq e (EvtSys es)&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e. e2 = EvtSeq e (EvtSys es)&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>e</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;e2 = EvtSeq e (EvtSys es)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e. getspc_es (((e2, t1, y1) # xs1) ! 0) = EvtSeq e (EvtSys es)&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>getspc_es_def</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (&#8707;j. Suc j &lt; length ((e2, t1, y1) # xs1) &#8743;
                                  getspc_es (((e2, t1, y1) # xs1) ! j) = EvtSys es &#8743; 
                                  getspc_es (((e2, t1, y1) # xs1) ! Suc j) &#8800; EvtSys es)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>                </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys ((e2, t1, y1) # xs1) &#8712; cpts_ev &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>b2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys1 (e2, t1, y1) # rm_evtsys xs1 &#8712; cpts_ev &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>rm_evtsys_def</span><span class="delimiter">)</span><span>
</span><span>                
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span>c1</span><span> </span><span>b7</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;t. &#915; &#8866; (e&#39;, s1, x1) -et-t&#8594; (e, t1, y1)&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtseq_tran_exist_etran</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>t</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (e&#39;, s1, x1) -et-t&#8594; (e, t1, y1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b7</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys1 (e1, s1, x1) = (e&#39;, s1, x1)&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>rm_evtsys_def</span><span> </span><span>rm_evtsys1_def</span><span> </span><span>getspc_es_def</span><span> </span><span>gets_es_def</span><span> </span><span>getx_es_def</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys1 (e2, t1, y1) = (e, t1, y1)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>rm_evtsys_def</span><span> </span><span>rm_evtsys1_def</span><span> </span><span>getspc_es_def</span><span> </span><span>gets_es_def</span><span> </span><span>getx_es_def</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>b6</span><span> </span><span>c8</span><span> </span><span>c5</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_ev.CptsEvComp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#8707;e. e2 = EvtSeq e (EvtSys es))&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b0</span><span> </span><span>b7</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;e2 = EvtSys es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>evtseq_tran_evtseq</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c11</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys1 (e2, t1, y1) # rm_evtsys xs1 &#8712; cpts_ev &#915;&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (&#8707;j. Suc j &lt; length ((e2, t1, y1) # xs1) &#8743;
                            getspc_es (((e2, t1, y1) # xs1) ! j) = EvtSys es &#8743;
                            getspc_es (((e2, t1, y1) # xs1) ! Suc j) &#8800; EvtSys es)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d00</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. j &lt; length xs1 &#10230; getspc_es (xs1!j) = EvtSys es&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>                        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>j</span><span>
</span><span>                        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j &lt; length xs1&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (xs1!j) = EvtSys es&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>j</span><span class="delimiter">)</span><span>
</span><span>                            </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span> </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b1</span><span> </span><span>c1</span><span> </span><span>d0</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> 
</span><span>                              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>getspc_es_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>One_nat_def</span><span> </span><span>e0</span><span> </span><span>fst_conv</span><span> </span><span>length_Cons</span><span> 
</span><span>                                          </span><span>less_one</span><span> </span><span>not_less_eq</span><span> </span><span>nth_Cons_0</span><span> </span><span>nth_Cons_Suc</span><span class="delimiter">)</span><span> 
</span><span>                          </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                            </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>m</span><span class="delimiter">)</span><span>
</span><span>                            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>f0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &lt; length xs1 &#10233; getspc_es (xs1 ! m) = EvtSys es&quot;</span></span></span><span>
</span><span>                              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>f1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc m &lt; length xs1&quot;</span></span></span><span>
</span><span>                            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d0</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. j &lt; length (rm_evtsys xs1) &#10230; getspc_e ((rm_evtsys xs1)!j) = AnonyEvent fin_com&quot;</span></span></span><span> 
</span><span>                       </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>rm_evtsys_def</span><span> </span><span>rm_evtsys1_def</span><span> </span><span>getspc_es_def</span><span> </span><span>gets_es_def</span><span> </span><span>getx_es_def</span><span> </span><span>getspc_e_def</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys1 (e2, t1, y1) = (AnonyEvent fin_com, t1, y1)&quot;</span></span></span><span> 
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>rm_evtsys1_def</span><span> </span><span>getspc_es_def</span><span> </span><span>gets_es_def</span><span> </span><span>getx_es_def</span><span> </span><span>getspc_e_def</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. i &lt; length (rm_evtsys1 (e2, t1, y1) # rm_evtsys xs1) &#10230;
                                      getspc_e ((rm_evtsys1 (e2, t1, y1) # rm_evtsys xs1)!i) = AnonyEvent fin_com&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>getspc_e_def</span><span> </span><span>less_Suc_eq_0_disj</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length (rm_evtsys1 (e2, t1, y1) # rm_evtsys xs1) &gt; 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_ev_same</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b7</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys1 (e1, s1, x1) = (e&#39;, s1, x1)&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>rm_evtsys_def</span><span> </span><span>rm_evtsys1_def</span><span> </span><span>getspc_es_def</span><span> </span><span>gets_es_def</span><span> </span><span>getx_es_def</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys1 (e2, t1, y1) = (AnonyEvent fin_com, t1, y1)&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>rm_evtsys_def</span><span> </span><span>rm_evtsys1_def</span><span> </span><span>getspc_es_def</span><span> </span><span>gets_es_def</span><span> </span><span>getx_es_def</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span>b7</span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;t. &#915; &#8866; (e&#39;, s1, x1) -et-t&#8594; (AnonyEvent fin_com, t1, y1)&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtseq_tran_0_exist_etran</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>t</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (e&#39;, s1, x1) -et-t&#8594; (AnonyEvent fin_com, t1, y1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b6</span><span> </span><span>c2</span><span> </span><span>c3</span><span> </span><span>c11</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_ev.CptsEvComp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>p3</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>                  
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rm_evtsys_in_cptse</span><span class="delimiter">:</span><span> 
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;esl&#8712;cpts_es &#915;; esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs;
      &#915; &#8866; (EvtSys es, s, x) -es-(EvtEnt (BasicEvent e))&#9839;k&#8594; (EvtSeq ev (EvtSys es), s1,x1);
      &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es);
      el = (BasicEvent e, s, x) # rm_evtsys ((EvtSeq ev (EvtSys es), s1,x1) # xs) &#10215; &#10233; 
      el &#8712; cpts_ev &#915;&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;cpts_es &#915;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (EvtSys es, s, x) -es-(EvtEnt (BasicEvent e))&#9839;k&#8594; (EvtSeq ev (EvtSys es), s1,x1)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es 
                      &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el = (BasicEvent e, s, x) # rm_evtsys ((EvtSeq ev (EvtSys es), s1,x1) # xs)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?esl1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl1 &#8712; cpts_es &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_es_dropi</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length ?esl1 &gt; 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e. getspc_es (?esl1 ! 0) = EvtSeq e (EvtSys es)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>getspc_es_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span>p3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (&#8707;j. Suc j &lt; length ?esl1 &#8743; getspc_es (?esl1 ! j) = EvtSys es 
            &#8743; getspc_es (?esl1 ! Suc j) &#8800; EvtSys es)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl1 &#8712; cpts_es &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rm_evtsys_in_cptse0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    
</span><span>    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys ?esl1 &#8712; cpts_ev &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rm_evtsys_in_cptse0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys ?esl1 = rm_evtsys1 (EvtSeq ev (EvtSys es), s1,x1) # rm_evtsys xs&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>rm_evtsys_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys ?esl1 = (ev,s1,x1) # rm_evtsys xs&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>rm_evtsys1_def</span><span> </span><span>getspc_es_def</span><span> </span><span>gets_es_def</span><span> </span><span>getx_es_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (BasicEvent e, s, x) -et-(EvtEnt (BasicEvent e))&#9839;k&#8594; (ev, s1, x1)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtsysent_evtent</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>es</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>e</span><span> </span><span>k</span><span> </span><span>ev</span><span> </span><span>s1</span><span> </span><span>x1</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p4</span><span> </span><span>a6</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a5</span><span> </span><span>cpts_ev.CptsEvComp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>fstent_nomident_e_sim_es_aux</span><span class="delimiter">:</span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;esl&#8712;cpts_es &#915;; esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs;
      &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es);
      el = (BasicEvent e, s, x) # rm_evtsys ((EvtSeq ev (EvtSys es), s1,x1) # xs); el&#8712;cpts_ev &#915;&#10215; &#10233;
        &#8704;i. i &gt; 0 &#8743; i &lt; length el &#10230; 
              (getspc_es (esl!i) = EvtSys es &#8743; getspc_e (el!i) = AnonyEvent fin_com) 
                &#8744; (getspc_es (esl!i) = EvtSeq (getspc_e (el!i)) (EvtSys es))&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;cpts_es &#915;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es 
                  &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el = (BasicEvent e, s, x) # rm_evtsys ((EvtSeq ev (EvtSys es), s1,x1) # xs)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el&#8712;cpts_ev &#915;&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?el1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys ((EvtSeq ev (EvtSys es), s1,x1) # xs)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?esl1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length ?esl1 = length ?el1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rm_evtsys_same_sx</span><span> </span><span>same_s_x_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl1&#8712;cpts_es &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_es_dropi</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p2_1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. j &gt; 0 &#8743; Suc j &lt; length esl &#10230; 
          getspc_es (esl ! j) = EvtSys es &#10230; getspc_es (esl ! Suc j) = EvtSys es&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>noevtent_inmid_eq</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. i &lt; length ?el1 &#10230; 
          (getspc_es (?esl1!i) = EvtSys es &#8743; getspc_e (?el1!i) = AnonyEvent fin_com) 
                &#8744; (getspc_es (?esl1!i) = EvtSeq (getspc_e (?el1!i)) (EvtSys es))&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i &lt; length ?el1&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(getspc_es (?esl1!i) = EvtSys es &#8743; getspc_e (?el1!i) = AnonyEvent fin_com) 
                &#8744; (getspc_es (?esl1!i) = EvtSeq (getspc_e (?el1!i)) (EvtSys es))&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>i</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (?esl1!0) = EvtSeq (getspc_e (?el1!0)) (EvtSys es)&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>getspc_es_def</span><span> </span><span>getspc_e_def</span><span> </span><span>rm_evtsys_def</span><span> </span><span>rm_evtsys1_def</span><span> </span><span>gets_es_def</span><span> </span><span>getx_es_def</span><span> </span><span>EvtSeqrm</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>fstI</span><span> </span><span>length_greater_0_conv</span><span> </span><span>list.distinct</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>nth_Cons_0</span><span> </span><span>nth_map</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>          </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>j</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j &lt; length ?el1 &#10233; getspc_es (?esl1 ! j) = EvtSys es &#8743;
                        getspc_e (?el1 ! j) = AnonyEvent fin_com &#8744;
                        getspc_es (?esl1 ! j) =
                        EvtSeq (getspc_e (?el1 ! j)) (EvtSys es)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc j &lt; length ?el1&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (?esl1 ! j) = EvtSys es &#8743;
                        getspc_e (?el1 ! j) = AnonyEvent fin_com &#8744;
                        getspc_es (?esl1 ! j) =
                        EvtSeq (getspc_e (?el1 ! j)) (EvtSys es)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (?esl1 ! j) = EvtSys es &#8743;
                        getspc_e (?el1 ! j) = AnonyEvent fin_com&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (?esl1 ! j) = EvtSys es &#8743;
                        getspc_e (?el1 ! j) = AnonyEvent fin_com&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span>p2_1</span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (?esl1 ! Suc j) = EvtSys es&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl ! Suc j) = EvtSys es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">moreover</span></span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;0 &lt; Suc j &#8743; Suc (Suc j) &lt; length esl&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl ! Suc (Suc j)) = EvtSys es&quot;</span></span></span><span> 
</span><span>                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>p2_1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a1</span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (?el1 ! Suc j) = AnonyEvent fin_com&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>getspc_es_def</span><span> </span><span>getspc_e_def</span><span> </span><span>rm_evtsys_def</span><span> </span><span>rm_evtsys1_def</span><span> 
</span><span>                    </span><span>gets_es_def</span><span> </span><span>getx_es_def</span><span> </span><span>EvtSysrm</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>fst_conv</span><span> </span><span>nth_map</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>              </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(getspc_es (?esl1 ! j) = EvtSys es &#8743;
                        getspc_e (?el1 ! j) = AnonyEvent fin_com)&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (?esl1 ! j) =
                        EvtSeq (getspc_e (?el1 ! j)) (EvtSys es)&quot;</span></span></span><span>
</span><span>                   </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>e</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>s1</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el1 ! j = (e,s1,x1)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>prod_cases3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl1 ! j = (EvtSeq e (EvtSys es),s1,x1)&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;same_s_x ?esl1 ?el1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rm_evtsys_same_sx</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d0</span><span> </span><span>d1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (?esl1 ! j) = EvtSeq e (EvtSys es)&quot;</span></span></span><span> 
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>getspc_es_def</span><span> </span><span>getspc_e_def</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>e1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_e (?el1 ! j) = gets_es (?esl1 ! j)&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Suc.prems</span><span> </span><span>less_or_eq_imp_le</span><span> </span><span>same_s_x_def</span><span class="delimiter">)</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>e1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getx_e (?el1 ! j) = getx_es (?esl1 ! j)&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Suc.prems</span><span> </span><span>less_or_eq_imp_le</span><span> </span><span>same_s_x_def</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>d1</span><span> </span><span>getspc_es_def</span><span> </span><span>gets_es_def</span><span> </span><span>getx_es_def</span><span> </span><span>gets_e_def</span><span> </span><span>getx_e_def</span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>prod.collapse</span><span> </span><span>snd_conv</span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (?esl1 ! Suc j) = EvtSys es&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (?esl1 ! Suc j) = EvtSys es&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s2</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x2</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>e1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl1 ! Suc j = (EvtSys es, s2,x2)&quot;</span></span></span><span> 
</span><span>                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>getspc_es_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fst_conv</span><span> </span><span>surj_pair</span><span class="delimiter">)</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el1 ! Suc j = (AnonyEvent fin_com, s2,x2)&quot;</span></span></span><span> 
</span><span>                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>getspc_es_def</span><span> </span><span>rm_evtsys_def</span><span> </span><span>rm_evtsys1_def</span><span> 
</span><span>                        </span><span>gets_es_def</span><span> </span><span>getx_es_def</span><span> </span><span>EvtSysrm</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc.prems</span><span> </span><span>a1</span><span> </span><span>fst_conv</span><span> </span><span>nth_map</span><span> </span><span>snd_conv</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>e1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (?esl1 ! Suc j) = EvtSys es &#8743;
                        getspc_e (?el1 ! Suc j) = AnonyEvent fin_com&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>getspc_es_def</span><span> </span><span>getspc_e_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fst_conv</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (?esl1 ! Suc j) &#8800; EvtSys es&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>c1</span><span> </span><span>d2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e1. getspc_es (?esl1 ! Suc j) = EvtSeq e1 (EvtSys es)&quot;</span></span></span><span> 
</span><span>                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtseq_next_in_cpts</span><span> </span><span>getspc_es_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>e1</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>e1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (?esl1 ! Suc j) = EvtSeq e1 (EvtSys es)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a1</span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (?el1 ! Suc j) = e1&quot;</span></span></span><span> 
</span><span>                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>getspc_es_def</span><span> </span><span>getspc_e_def</span><span> </span><span>rm_evtsys_def</span><span> </span><span>rm_evtsys1_def</span><span> 
</span><span>                        </span><span>gets_es_def</span><span> </span><span>getx_es_def</span><span> </span><span>EvtSeqrm</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>fstI</span><span> </span><span>nth_map</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>e1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (?esl1 ! Suc j) =
                                EvtSeq (getspc_e (?el1 ! Suc j)) (EvtSys es)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>p3</span><span> </span><span>p4</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Suc_diff_1</span><span> 
</span><span>              </span><span>Suc_less_SucD</span><span> </span><span>length_Cons</span><span> </span><span>nth_Cons_pos</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>fstent_nomident_e_sim_es</span><span class="delimiter">:</span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;esl&#8712;cpts_es &#915;; esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs;
      &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es)&#10215; &#10233;
      &#8707;el e s x. el&#8712;cpts_of_ev  &#915; (BasicEvent e) s x &#8743; e_sim_es esl el es e&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;cpts_es &#915;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es 
                    &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;t. &#915; &#8866; (EvtSys es, s, x) -es-t&#8594; (EvtSeq ev (EvtSys es), s1,x1)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>esl</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>esys.distinct</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>exist_estran</span><span> </span><span>p0</span><span> </span><span>p1</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>t</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (EvtSys es, s, x) -es-t&#8594; (EvtSeq ev (EvtSys es), s1,x1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;evt e. evt &#8712; es &#8743; evt = BasicEvent e &#8743; Act t = EvtEnt (BasicEvent e) &#8743;
            &#915; &#8866; (BasicEvent e, s, x) -et-t&#8594; (ev, s1, x1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtsysent_evtent0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>evt</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>e</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;evt &#8712; es &#8743; evt = BasicEvent e &#8743; Act t = EvtEnt (BasicEvent e) &#8743;
            &#915; &#8866; (BasicEvent e, s, x) -et-t&#8594; (ev, s1, x1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?esl1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?el</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(BasicEvent e, s, x) # rm_evtsys ?esl1&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?el1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys ?esl1&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el = (BasicEvent e, s, x) # ?el1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl = (EvtSys es, s, x) # ?esl1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a2</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>at</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>ak</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (BasicEvent e, s, x) -et-(at&#9839;ak)&#8594; (ev, s1, x1)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>get_actk_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>actk.cases</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>p3</span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el &#8712; cpts_ev &#915;&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rm_evtsys_in_cptse</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span>esl</span><span> </span><span>&#915;</span><span> </span><span>es</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>ev</span><span> </span><span>s1</span><span> </span><span>x1</span><span> </span><span>xs</span><span class="delimiter">]</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>estran.EvtOccur</span><span> </span><span>evtsysent_evtent0</span><span> </span><span>noevtent_notran0</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;e_sim_es esl ?el es e&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length esl = length ?el&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>rm_evtsys_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">moreover</span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl ! 0) = EvtSys es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>getspc_es_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">moreover</span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (?el ! 0) = BasicEvent e&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>getspc_e_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">moreover</span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a3</span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. i &lt; length ?el &#10230; 
                  gets_e (?el ! i) = gets_es (esl ! i) &#8743;
                  getx_e (?el ! i) = getx_es (esl ! i)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;same_s_x ?esl1 (rm_evtsys ?esl1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rm_evtsys_same_sx</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>              </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i &lt; length ?el &#10230; 
                  gets_e (?el ! i) = gets_es (esl ! i) &#8743;
                  getx_e (?el ! i) = getx_es (esl ! i)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i = 0&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i = 0&quot;</span></span></span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>gets_e_def</span><span> </span><span>getx_e_def</span><span> </span><span>gets_es_def</span><span> 
</span><span>                        </span><span>getx_es_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>nth_Cons_0</span><span> </span><span>snd_conv</span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i&#8800;0&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span>p3</span><span> </span><span>a3</span><span> </span><span>c1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>same_s_x_def</span><span class="delimiter">)</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">moreover</span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. i &gt; 0 &#8743; i &lt; length ?el &#10230; 
                  (getspc_es (esl!i) = EvtSys es &#8743; getspc_e (?el!i) = AnonyEvent fin_com) 
                    &#8744; (getspc_es (esl!i) = EvtSeq (getspc_e (?el!i)) (EvtSys es))&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>p3</span><span> </span><span>a4</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>fstent_nomident_e_sim_es_aux</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>e_sim_es_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_of_ev_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>mem_Collect_eq</span><span> </span><span>nth_Cons&#39;</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>fstent_nomident_e_sim_es2</span><span class="delimiter">:</span><span>
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;esl&#8712;cpts_es &#915;; esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs;
      &#915; &#8866; (EvtSys es, s, x) -es-(EvtEnt (BasicEvent e))&#9839;k&#8594; (EvtSeq ev (EvtSys es), s1,x1);
      &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es);
      el = (BasicEvent e, s, x) # rm_evtsys ((EvtSeq ev (EvtSys es), s1,x1) # xs); el&#8712;cpts_ev &#915;&#10215; &#10233;
      e_sim_es esl el es e&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;cpts_es &#915;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (EvtSys es, s, x) -es-(EvtEnt (BasicEvent e))&#9839;k&#8594; (EvtSeq ev (EvtSys es), s1,x1)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es 
                    &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el = (BasicEvent e, s, x) # rm_evtsys ((EvtSeq ev (EvtSys es), s1,x1) # xs)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el&#8712;cpts_ev &#915;&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (BasicEvent e, s, x) -et-(EvtEnt (BasicEvent e))&#9839;k&#8594; (ev, s1, x1)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtsysent_evtent</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>es</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>e</span><span> </span><span>k</span><span> </span><span>ev</span><span> </span><span>s1</span><span> </span><span>x1</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?esl1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?el</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(BasicEvent e, s, x) # rm_evtsys ?esl1&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?el1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys ?esl1&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el = (BasicEvent e, s, x) # ?el1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl = (EvtSys es, s, x) # ?esl1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>p3</span><span> </span><span>p4</span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el &#8712; cpts_ev &#915;&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rm_evtsys_in_cptse</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length esl = length ?el&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>rm_evtsys_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">moreover</span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl ! 0) = EvtSys es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>getspc_es_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">moreover</span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (?el ! 0) = BasicEvent e&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>getspc_e_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">moreover</span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a3</span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. i &lt; length ?el &#10230; 
                  gets_e (?el ! i) = gets_es (esl ! i) &#8743;
                  getx_e (?el ! i) = getx_es (esl ! i)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;same_s_x ?esl1 (rm_evtsys ?esl1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rm_evtsys_same_sx</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>              </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i &lt; length ?el &#10230; 
                  gets_e (?el ! i) = gets_es (esl ! i) &#8743;
                  getx_e (?el ! i) = getx_es (esl ! i)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i = 0&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i = 0&quot;</span></span></span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>gets_e_def</span><span> </span><span>getx_e_def</span><span> </span><span>gets_es_def</span><span> 
</span><span>                        </span><span>getx_es_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>nth_Cons_0</span><span> </span><span>snd_conv</span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i&#8800;0&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span>p3</span><span> </span><span>a3</span><span> </span><span>c1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>same_s_x_def</span><span class="delimiter">)</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">moreover</span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. i &gt; 0 &#8743; i &lt; length ?el &#10230; 
                  (getspc_es (esl!i) = EvtSys es &#8743; getspc_e (?el!i) = AnonyEvent fin_com) 
                    &#8744; (getspc_es (esl!i) = EvtSeq (getspc_e (?el!i)) (EvtSys es))&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>p3</span><span> </span><span>a4</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>fstent_nomident_e_sim_es_aux</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>e_sim_es_def</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>p4</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>e_sim_es_same_assume</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;esl&#8712;cpts_es &#915;; esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs;
      &#915; &#8866; (EvtSys es, s, x) -es-(EvtEnt (BasicEvent e))&#9839;k&#8594; (EvtSeq ev (EvtSys es), s1,x1);
      &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es);
      el = (BasicEvent e, s, x) # rm_evtsys ((EvtSeq ev (EvtSys es), s1,x1) # xs); 
      e_sim_es esl el es e; esl&#8712;assume_es &#915; (pre,rely)&#10215;
      &#10233; el&#8712;assume_e &#915; (pre,rely)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;cpts_es &#915;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (EvtSys es, s, x) -es-(EvtEnt (BasicEvent e))&#9839;k&#8594; (EvtSeq ev (EvtSys es), s1,x1)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es 
                    &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el = (BasicEvent e, s, x) # rm_evtsys ((EvtSeq ev (EvtSys es), s1,x1) # xs)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;e_sim_es esl el es e&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;assume_es &#915; (pre,rely)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p3_1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. j &gt; 0 &#8743; Suc j &lt; length esl &#10230; getspc_es (esl ! j) = EvtSys es 
          &#10230; getspc_es (esl ! Suc j) = EvtSys es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>noevtent_inmid_eq</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?esl1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?el1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys ((EvtSeq ev (EvtSys es), s1,x1) # xs)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el = (BasicEvent e, s, x) # (ev,s1,x1) # rm_evtsys xs&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>gets_es_def</span><span> </span><span>getspc_es_def</span><span> </span><span>getx_es_def</span><span> </span><span>rm_evtsys1_def</span><span> </span><span>rm_evtsys_def</span><span class="delimiter">)</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length esl = length el&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>rm_evtsys_def</span><span class="delimiter">)</span><span>
</span><span>    
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (esl!0) &#8712; pre &#8743; (&#8704;i. Suc i&lt;length esl &#10230; 
           &#915; &#8866; esl!i -ese&#8594; esl!(Suc i) &#10230; (gets_es (esl!i), gets_es (esl!Suc i)) &#8712; rely)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_es_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span>p4</span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_e (el!0) &#8712; pre&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>gets_es_def</span><span> </span><span>gets_e_def</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>nth_Cons_0</span><span> </span><span>snd_conv</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length el &#10230; &#915; &#8866; el!i -ee&#8594; el!(Suc i) 
                &#10230; (gets_e (el!i), gets_e (el!Suc i)) &#8712; rely&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>          </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length el&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; el!i -ee&#8594; el!(Suc i)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#915; &#8866; el!0 -ee&#8594; el!1)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>One_nat_def</span><span> </span><span>eetran_eqconf</span><span> </span><span>evtsysent_evtent0</span><span> 
</span><span>                    </span><span>no_tran2basic</span><span> </span><span>nth_Cons_0</span><span> </span><span>nth_Cons_Suc</span><span> </span><span>p2</span><span class="delimiter">)</span><span>
</span><span>              
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i &#8800; 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>One_nat_def</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(getspc_es (esl!i) = EvtSys es &#8743; getspc_e (el!i) = AnonyEvent fin_com) 
                                  &#8744; (getspc_es (esl!i) = EvtSeq (getspc_e (el!i)) (EvtSys es))&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>e_sim_es_def</span><span> </span><span>Suc_lessD</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (el!i) = getspc_e (el!Suc i)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>eetran_eqconf1</span><span class="delimiter">)</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a1</span><span> </span><span>c0</span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (esl!i) = gets_e (el!i) 
                              &#8743; gets_es (esl!Suc i) = gets_e (el!Suc i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>e_sim_es_def</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a1</span><span> </span><span>c0</span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c6</span><span class="delimiter">:</span><span> 
</span><span>                        </span><span class="string"><span class="delete"><span class="delete">&quot;(getspc_es (esl!Suc i) = EvtSys es &#8743; getspc_e (el!Suc i) = AnonyEvent fin_com) 
                         &#8744; (getspc_es (esl!Suc i) = EvtSeq (getspc_e (el!Suc i)) (EvtSys es))&quot;</span></span></span><span>
</span><span>               </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>e_sim_es_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_e (el!i), gets_e (el!Suc i)) &#8712; rely&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl!i) = EvtSys es &#8743; getspc_e (el!i) = AnonyEvent fin_com&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl!i) = EvtSys es &#8743; getspc_e (el!i) = AnonyEvent fin_com&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c2</span><span> </span><span>p3_1</span><span> </span><span>c0</span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl!Suc i) = EvtSys es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; esl!i -ese&#8594; esl!Suc i&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>eqconf_esetran</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b1</span><span> </span><span>c0</span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (esl!i), gets_es (esl!Suc i)) &#8712; rely&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c5</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>              </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(getspc_es (esl!i) = EvtSys es &#8743; getspc_e (el!i) = AnonyEvent fin_com)&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl!i) = EvtSeq (getspc_e (el!i)) (EvtSys es)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?ei</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (el!i)&quot;</span></span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?ei = AnonyEvent fin_com&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?ei = AnonyEvent fin_com&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (el!Suc i) = AnonyEvent fin_com&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>eetran_eqconf1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>                    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl!Suc i) = EvtSys es &#8743; getspc_e (el!Suc i) = AnonyEvent fin_com&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>f0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl!Suc i) = EvtSys es &#8743; getspc_e (el!Suc i) = AnonyEvent fin_com&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (el!i) &#8800; AnonyEvent fin_com&quot;</span></span></span><span> 
</span><span>                          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?esl&#39;</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop i esl&quot;</span></span></span><span>
</span><span>                            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl&#39;&#8712;cpts_es &#915;&quot;</span></span></span><span>
</span><span>                              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_lessD</span><span> </span><span>a3</span><span> </span><span>c0</span><span> </span><span>c2</span><span> </span><span>cpts_es_dropi</span><span> </span><span>old.nat.exhaust</span><span class="delimiter">)</span><span> 
</span><span>                            </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c0</span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length ?esl&#39; &gt; 1&quot;</span></span></span><span>
</span><span>                              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (?esl&#39;!0) = EvtSeq (getspc_e (el!i)) (EvtSys es)&quot;</span></span></span><span>
</span><span>                              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>f0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (?esl&#39;!1) = EvtSys es&quot;</span></span></span><span>
</span><span>                              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>                            </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>not_anonyevt_none_in_evtseq1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>e0</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(getspc_es (esl!Suc i) = EvtSys es &#8743; getspc_e (el!Suc i) = AnonyEvent fin_com)&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl!Suc i) = EvtSeq (getspc_e (el!Suc i)) (EvtSys es)&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl!Suc i) = EvtSeq (getspc_e (el!i)) (EvtSys es)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl!Suc i) = getspc_es (esl!i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; esl!i -ese&#8594; esl!Suc i&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>eqconf_esetran</span><span class="delimiter">)</span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (esl!i), gets_es (esl!Suc i)) &#8712; rely&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>a3</span><span> </span><span>c0</span><span class="delimiter">)</span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c5</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?ei &#8800; AnonyEvent fin_com&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c4</span><span> </span><span>c6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl!Suc i) = EvtSeq (getspc_e (el!Suc i)) (EvtSys es)&quot;</span></span></span><span> 
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c4</span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl!Suc i) = getspc_es (esl!i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; esl!i -ese&#8594; esl!Suc i&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>eqconf_esetran</span><span class="delimiter">)</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (esl!i), gets_es (esl!Suc i)) &#8712; rely&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>a3</span><span> </span><span>c0</span><span class="delimiter">)</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c5</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_e_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>e_sim_es_same_commit</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;esl&#8712;cpts_es &#915;; esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs;
      &#915; &#8866; (EvtSys es, s, x) -es-(EvtEnt (BasicEvent e))&#9839;k&#8594; (EvtSeq ev (EvtSys es), s1,x1);
      &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es);
      el = (BasicEvent e, s, x) # rm_evtsys ((EvtSeq ev (EvtSys es), s1,x1) # xs); 
      e_sim_es esl el es e; el&#8712;commit_e &#915; (guar,post)&#10215;
      &#10233; esl&#8712;commit_es &#915; (guar,post)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;cpts_es &#915;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (EvtSys es, s, x) -es-(EvtEnt (BasicEvent e))&#9839;k&#8594; (EvtSeq ev (EvtSys es), s1,x1)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es 
                    &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el = (BasicEvent e, s, x) # rm_evtsys ((EvtSeq ev (EvtSys es), s1,x1) # xs)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;e_sim_es esl el es e&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el&#8712;commit_e &#915; (guar,post)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p3_1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. j &gt; 0 &#8743; Suc j &lt; length esl &#10230; getspc_es (esl ! j) = EvtSys es 
          &#10230; getspc_es (esl ! Suc j) = EvtSys es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>noevtent_inmid_eq</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>p3</span><span> </span><span>p4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el &#8712; cpts_ev &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rm_evtsys_in_cptse</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?esl1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?el1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys ((EvtSeq ev (EvtSys es), s1,x1) # xs)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el = (BasicEvent e, s, x) # (ev,s1,x1) # rm_evtsys xs&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>gets_es_def</span><span> </span><span>getspc_es_def</span><span> </span><span>getx_es_def</span><span> </span><span>rm_evtsys1_def</span><span> </span><span>rm_evtsys_def</span><span class="delimiter">)</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length esl = length el&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>rm_evtsys_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length el &#10230; 
               (&#8707;t. &#915; &#8866; el!i -et-t&#8594; el!(Suc i)) &#10230; (gets_e (el!i), gets_e (el!Suc i)) &#8712; guar&quot;</span></span></span><span> 
</span><span>               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>commit_e_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;commit_es &#915; (guar,post)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length esl &#10230; (&#8707;t. &#915; &#8866; esl!i -es-t&#8594; esl!(Suc i)) 
              &#10230; (gets_es (esl!i), gets_es (esl!Suc i)) &#8712; guar&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>          </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length esl&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;t. &#915; &#8866; esl!i -es-t&#8594; esl!(Suc i)&quot;</span></span></span><span>
</span><span>            
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (esl!i), gets_es (esl!Suc i)) &#8712; guar&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i = 0&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i = 0&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (BasicEvent e, s, x) -et-(EvtEnt (BasicEvent e))&#9839;k&#8594; (ev, s1, x1)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtsysent_evtent</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a2</span><span> </span><span>b4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(s, s1) &#8712; guar&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>gets_e_def</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>a3</span><span> </span><span>c0</span><span> </span><span>d0</span><span> </span><span>fst_conv</span><span> </span><span>nth_Cons_0</span><span> </span><span>nth_Cons_Suc</span><span> </span><span>snd_conv</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>gets_es_def</span><span> </span><span>d0</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i &#8800; 0&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl!i) = EvtSys es&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl!i) = EvtSys es&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p3_1</span><span> </span><span>c0</span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl!Suc i) = EvtSys es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c1</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>t</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; esl ! i -es-t&#8594; esl ! Suc i&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl!i) &#8800; getspc_es (esl!Suc i)&quot;</span></span></span><span> 
</span><span>                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtsys_not_eq_in_tran_aux1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>e0</span><span> </span><span>e1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl!i) &#8800; EvtSys es&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl!i) = EvtSys es &#8744; 
                        (&#8707;e. getspc_es (esl!i) = EvtSeq e (EvtSys es))&quot;</span></span></span><span> 
</span><span>                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtsys_all_es_in_cpts</span><span> </span><span>getspc_es_def</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_lessD</span><span> </span><span>fst_conv</span><span> </span><span>length_Cons</span><span> </span><span>nth_Cons_0</span><span> </span><span>zero_less_Suc</span><span class="delimiter">)</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>e0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e. getspc_es (esl!i) = EvtSeq e (EvtSys es)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>e</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>e1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl!i) = EvtSeq e (EvtSys es)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e0_1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl!Suc i) = EvtSys es &#8744; 
                        (&#8707;e. getspc_es (esl!Suc i) = EvtSeq e (EvtSys es))&quot;</span></span></span><span> 
</span><span>                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtsys_all_es_in_cpts</span><span> </span><span>getspc_es_def</span><span> 
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fst_conv</span><span> </span><span>length_greater_0_conv</span><span> </span><span>list.distinct</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>nth_Cons_0</span><span class="delimiter">)</span><span>
</span><span>
</span><span>                    </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>esi</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>si</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>xi</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>esi&#39;</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>si&#39;</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>xi&#39;</span><span> 
</span><span>                      </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>e2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl!i = (esi,si,xi) &#8743; esl!(Suc i) = (esi&#39;,si&#39;,xi&#39;)&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>prod.collapse</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c1</span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>t</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>e3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (esi,si,xi) -es-t&#8594; (esi&#39;,si&#39;,xi&#39;)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>e0_1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>                        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>f0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl!Suc i) = EvtSys es&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>e1</span><span> </span><span>e2</span><span> </span><span>e3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;t. &#915; &#8866; (e, si, xi) -et-t&#8594; (AnonyEvent fin_com, si&#39;,xi&#39;)&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>evtseq_tran_0_exist_etran</span><span> </span><span>getspc_es_def</span><span class="delimiter">)</span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>et</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>f1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (e, si, xi) -et-et&#8594; (AnonyEvent fin_com, si&#39;,xi&#39;)&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span>p4</span><span> </span><span>a3</span><span> </span><span>c0</span><span> </span><span>d0</span><span> </span><span>e1</span><span> </span><span>e2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;el!i = (e, si, xi)&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>getspc_es_def</span><span> </span><span>getspc_e_def</span><span> </span><span>rm_evtsys_def</span><span> </span><span>rm_evtsys1_def</span><span> 
</span><span>                            </span><span>gets_es_def</span><span> </span><span>getx_es_def</span><span> </span><span>EvtSeqrm</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>Suc_lessD</span><span> </span><span>fst_conv</span><span> </span><span>list.simps</span><span class="delimiter">(</span><span>9</span><span class="delimiter">)</span><span> </span><span>nth_Cons_Suc</span><span> </span><span>nth_map</span><span> </span><span>old.nat.exhaust</span><span> </span><span>snd_conv</span><span class="delimiter">)</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span>p4</span><span> </span><span>a3</span><span> </span><span>c0</span><span> </span><span>d0</span><span> </span><span>e2</span><span> </span><span>f0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;el!Suc i = (AnonyEvent fin_com, si&#39;,xi&#39;)&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>getspc_es_def</span><span> </span><span>getspc_e_def</span><span> </span><span>rm_evtsys_def</span><span> </span><span>rm_evtsys1_def</span><span> 
</span><span>                            </span><span>gets_es_def</span><span> </span><span>getx_es_def</span><span> </span><span>EvtSysrm</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>List.nth_tl</span><span> </span><span>Suc_lessE</span><span> </span><span>diff_Suc_1</span><span> </span><span>fst_conv</span><span> 
</span><span>                              </span><span>length_tl</span><span> </span><span>list.sel</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>nth_map</span><span> </span><span>snd_conv</span><span class="delimiter">)</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(si,si&#39;)&#8712;guar&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>b4</span><span> </span><span>f1</span><span> </span><span>a3</span><span> </span><span>c0</span><span> </span><span>gets_e_def</span><span>
</span><span>                          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fst_conv</span><span> </span><span>snd_conv</span><span class="delimiter">)</span><span>
</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>e2</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>gets_es_def</span><span class="delimiter">)</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>f0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e. getspc_es (esl!Suc i) = EvtSeq e (EvtSys es)&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>e&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>f1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl!Suc i) = EvtSeq e&#39; (EvtSys es)&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>e1</span><span> </span><span>e2</span><span> </span><span>e3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;t. &#915; &#8866; (e, si, xi) -et-t&#8594; (e&#39;, si&#39;, xi&#39;)&quot;</span></span></span><span> 
</span><span>                          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>evtseq_tran_exist_etran</span><span> </span><span>getspc_es_def</span><span class="delimiter">)</span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span>p4</span><span> </span><span>a3</span><span> </span><span>c0</span><span> </span><span>d0</span><span> </span><span>e1</span><span> </span><span>e2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f2</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;el!i = (e, si, xi)&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>getspc_es_def</span><span> </span><span>getspc_e_def</span><span> </span><span>rm_evtsys_def</span><span> </span><span>rm_evtsys1_def</span><span> 
</span><span>                            </span><span>gets_es_def</span><span> </span><span>getx_es_def</span><span> </span><span>EvtSeqrm</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>Suc_lessD</span><span> </span><span>fst_conv</span><span> </span><span>list.simps</span><span class="delimiter">(</span><span>9</span><span class="delimiter">)</span><span> </span><span>nth_Cons_Suc</span><span> </span><span>nth_map</span><span> </span><span>old.nat.exhaust</span><span> </span><span>snd_conv</span><span class="delimiter">)</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span>p4</span><span> </span><span>a3</span><span> </span><span>c0</span><span> </span><span>d0</span><span> </span><span>e2</span><span> </span><span>f1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f3</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;el!Suc i = (e&#39;, si&#39;,xi&#39;)&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>getspc_es_def</span><span> </span><span>getspc_e_def</span><span> </span><span>rm_evtsys_def</span><span> </span><span>rm_evtsys1_def</span><span> 
</span><span>                            </span><span>gets_es_def</span><span> </span><span>getx_es_def</span><span> </span><span>EvtSeqrm</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>Suc_lessD</span><span> </span><span>fst_conv</span><span> </span><span>less_Suc_eq_0_disj</span><span> </span><span>list.simps</span><span class="delimiter">(</span><span>9</span><span class="delimiter">)</span><span> </span><span>nth_Cons_Suc</span><span> </span><span>nth_map</span><span> </span><span>snd_conv</span><span class="delimiter">)</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(si,si&#39;)&#8712;guar&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>b4</span><span> </span><span>f1</span><span> </span><span>a3</span><span> </span><span>c0</span><span> </span><span>gets_e_def</span><span>
</span><span>                          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>fst_conv</span><span> </span><span>snd_conv</span><span class="delimiter">)</span><span>
</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>e2</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>gets_es_def</span><span class="delimiter">)</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>commit_es_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>rm_evtsys_assum_comm</span><span class="delimiter">:</span><span> 
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;esl&#8712;cpts_es &#915;; esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs;
      &#915; &#8866; (EvtSys es, s, x) -es-(EvtEnt (BasicEvent e))&#9839;k&#8594; (EvtSeq ev (EvtSys es), s1,x1);
      &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es);
      el = (BasicEvent e, s, x) # rm_evtsys ((EvtSeq ev (EvtSys es), s1,x1) # xs); 
      el&#8712;assume_e &#915; (pre,rely) &#10230; el&#8712;commit_e &#915; (guar,post) &#10215;
      &#10233; esl&#8712;assume_es &#915; (pre,rely) &#10230; esl&#8712;commit_es &#915; (guar,post)&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;cpts_es &#915;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (EvtSys es, s, x) -es-(EvtEnt (BasicEvent e))&#9839;k&#8594; (EvtSeq ev (EvtSys es), s1,x1)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es 
                    &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el = (BasicEvent e, s, x) # rm_evtsys ((EvtSeq ev (EvtSys es), s1,x1) # xs)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el&#8712;assume_e &#915; (pre,rely) &#10230; el&#8712;commit_e &#915; (guar,post)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p3_1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;j. j &gt; 0 &#8743; Suc j &lt; length esl &#10230; getspc_es (esl ! j) = EvtSys es 
          &#10230; getspc_es (esl ! Suc j) = EvtSys es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>noevtent_inmid_eq</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>p3</span><span> </span><span>p4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el &#8712; cpts_ev &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rm_evtsys_in_cptse</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?esl1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?el1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rm_evtsys ((EvtSeq ev (EvtSys es), s1,x1) # xs)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>p3</span><span> </span><span>p4</span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;e_sim_es esl el es e&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fstent_nomident_e_sim_es2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el = (BasicEvent e, s, x) # (ev,s1,x1) # rm_evtsys xs&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>gets_es_def</span><span> </span><span>getspc_es_def</span><span> </span><span>getx_es_def</span><span> </span><span>rm_evtsys1_def</span><span> </span><span>rm_evtsys_def</span><span class="delimiter">)</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length esl = length el&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>rm_evtsys_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> 
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;assume_es &#915; (pre,rely)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>p3</span><span> </span><span>p4</span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el&#8712;assume_e &#915; (pre,rely)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>e_sim_es_same_assume</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;el&#8712;commit_e &#915; (guar,post)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>p3</span><span> </span><span>p4</span><span> </span><span>a1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;commit_es &#915; (guar,post)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>e_sim_es_same_commit</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>EventSys_sound_aux1</span><span class="delimiter">:</span><span> 
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;&#8704;ef&#8712;es. &#915; &#8872; ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre ef, Rely ef, Guar ef, Post ef];
     esl&#8712;cpts_es &#915;;length esl &#8805; 2 &#8743; getspc_es (esl!0) = EvtSys es &#8743; getspc_es (esl!1) &#8800; EvtSys es;
     &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es)&#10215;
      &#10233; &#8707;m&#8712;es. (esl&#8712;assume_es &#915; (Pre m,Rely m) &#10230; esl&#8712;commit_es &#915; (Guar m,Post m)) 
                          &#8743; (&#8707;k. &#915; &#8866; esl!0-es-(EvtEnt m)&#9839;k&#8594;esl!1)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;es. &#915; &#8872; ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre ef, Rely ef, Guar ef, Post ef]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length esl &#8805; 2 &#8743; getspc_es (esl!0) = EvtSys es &#8743; getspc_es (esl!1) &#8800; EvtSys es&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>c41</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;cpts_es &#915;&quot;</span></span></span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;s x ev s1 x1 xs. esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>fst_esys_snd_eseq_exist</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>ev</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>s1</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x1</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>xs</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c3</span><span class="delimiter">:</span><span>
</span><span>      </span><span class="string"><span class="delete"><span class="delete">&quot;esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e k. &#915; &#8866; (EvtSys es, s, x) -es-(EvtEnt (BasicEvent e))&#9839;k&#8594; (EvtSeq ev (EvtSys es), s1,x1)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fst_esys_snd_eseq_exist_evtent2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>e</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>k</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c4</span><span class="delimiter">:</span><span> 
</span><span>      </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (EvtSys es, s, x) -es-(EvtEnt (BasicEvent e))&#9839;k&#8594; (EvtSeq ev (EvtSys es), s1,x1)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?el</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(BasicEvent e, s, x) # rm_evtsys ((EvtSeq ev (EvtSys es), s1,x1) # xs)&quot;</span></span></span><span>
</span><span>    
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c1</span><span> </span><span>c3</span><span> </span><span>c4</span><span> </span><span>c41</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el &#8712; cpts_ev &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rm_evtsys_in_cptse</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;ei&#8712;es. ei = BasicEvent e&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtsysent_evtent</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>ei</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ei&#8712;es &#8743; ei = BasicEvent e&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c3</span><span> </span><span>c4</span><span> </span><span>c6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c61</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; esl!0-es-(EvtEnt ei)&#9839;k&#8594;esl!1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el&#8712;assume_e &#915; (Pre ei, Rely ei) &#10230; ?el&#8712;commit_e &#915; (Guar ei,Post ei)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> 
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el&#8712;assume_e &#915; (Pre ei, Rely ei)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span>c6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; &#915; &#8872; ei sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre ei, Rely ei, Guar ei, Post ei]&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el&#8712;cpts_of_ev &#915; (BasicEvent e) s x&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>cpts_of_ev_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el&#8712;commit_e &#915; (Guar ei,Post ei)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evt_validity_def</span><span> </span><span>c6</span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c1</span><span> </span><span>c3</span><span> </span><span>c4</span><span> </span><span>c41</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;assume_es &#915; (Pre ei, Rely ei) &#10230; esl&#8712;commit_es &#915; (Guar ei,Post ei)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rm_evtsys_assum_comm</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c6</span><span> </span><span>c61</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>EventSys_sound_aux1_forall</span><span class="delimiter">:</span><span> 
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;&#8704;ef&#8712;es. &#915; &#8872; ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre ef, Rely ef, Guar ef, Post ef];
     esl&#8712;cpts_es &#915;;length esl &#8805; 2 &#8743; getspc_es (esl!0) = EvtSys es &#8743; getspc_es (esl!1) &#8800; EvtSys es;
     &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es)&#10215;
      &#10233; &#8704;m&#8712;es. (&#8707;k. &#915; &#8866; esl!0-es-(EvtEnt m)&#9839;k&#8594;esl!1) 
                          &#10230; (esl&#8712;assume_es &#915; (Pre m,Rely m) &#10230; esl&#8712;commit_es &#915; (Guar m,Post m))&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;es. &#915; &#8872; ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre ef, Rely ef, Guar ef, Post ef]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length esl &#8805; 2 &#8743; getspc_es (esl!0) = EvtSys es &#8743; getspc_es (esl!1) &#8800; EvtSys es&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>c41</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;cpts_es &#915;&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>m</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c01</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m&#8712;es&quot;</span></span></span><span>
</span><span>          </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>c02</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;k. &#915; &#8866; esl!0-es-(EvtEnt m)&#9839;k&#8594;esl!1&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;s x ev s1 x1 xs. esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>fst_esys_snd_eseq_exist</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>ev</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>s1</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x1</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>xs</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c3</span><span class="delimiter">:</span><span>
</span><span>          </span><span class="string"><span class="delete"><span class="delete">&quot;esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c02</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;k. &#915; &#8866; (EvtSys es, s, x) -es-(EvtEnt m)&#9839;k&#8594; (EvtSeq ev (EvtSys es), s1,x1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>k</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (EvtSys es, s, x) -es-(EvtEnt m)&#9839;k&#8594; (EvtSeq ev (EvtSys es), s1,x1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e. m = BasicEvent e&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>evtent_is_basicevt</span><span class="delimiter">)</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>e</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c40</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m = BasicEvent e&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?el</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(m, s, x) # rm_evtsys ((EvtSeq ev (EvtSys es), s1,x1) # xs)&quot;</span></span></span><span>    
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c1</span><span> </span><span>c3</span><span> </span><span>c4</span><span> </span><span>c40</span><span> </span><span>c41</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el &#8712; cpts_ev &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rm_evtsys_in_cptse</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c3</span><span> </span><span>c4</span><span> </span><span>c40</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c61</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; esl!0-es-(EvtEnt m)&#9839;k&#8594;esl!1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el&#8712;assume_e &#915; (Pre m, Rely m) &#10230; ?el&#8712;commit_e &#915; (Guar m,Post m)&quot;</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> 
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el&#8712;assume_e &#915; (Pre m, Rely m)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span>c01</span><span> </span><span>c40</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; &#915; &#8872; m sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre m, Rely m, Guar m, Post m]&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c5</span><span> </span><span>c40</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el&#8712;cpts_of_ev &#915; (BasicEvent e) s x&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>cpts_of_ev_def</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el&#8712;commit_e &#915; (Guar m,Post m)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evt_validity_def</span><span> </span><span>c40</span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c1</span><span> </span><span>c3</span><span> </span><span>c4</span><span> </span><span>c40</span><span> </span><span>c41</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;assume_es &#915; (Pre m, Rely m) &#10230; esl&#8712;commit_es &#915; (Guar m,Post m)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rm_evtsys_assum_comm</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>EventSys_sound_seg_aux0_exist</span><span class="delimiter">:</span><span> 
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;esl&#8712;cpts_es &#915;;length esl &#8805; 2; getspc_es (esl!0) = EvtSys es; getspc_es (esl!1) &#8800; EvtSys es&#10215;
      &#10233; &#8707;m&#8712;es. (&#8707;k. &#915; &#8866; esl!0-es-(EvtEnt m)&#9839;k&#8594;esl!1)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;cpts_es &#915;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length esl &#8805; 2&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl!0) = EvtSys es&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl!1) &#8800; EvtSys es&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;s x ev s1 x1 xs. esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>fst_esys_snd_eseq_exist</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>ev</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>s1</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x1</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>xs</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span>
</span><span>      </span><span class="string"><span class="delete"><span class="delete">&quot;esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p0</span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e k. &#915; &#8866; (EvtSys es, s, x) -es-(EvtEnt (BasicEvent e))&#9839;k&#8594; (EvtSeq ev (EvtSys es), s1,x1)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fst_esys_snd_eseq_exist_evtent2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>e</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>k</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span> 
</span><span>      </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (EvtSys es, s, x) -es-(EvtEnt (BasicEvent e))&#9839;k&#8594; (EvtSeq ev (EvtSys es), s1,x1)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;i&#8712;es. i = BasicEvent e&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtsysent_evtent</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>ei</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ei&#8712; es &#8743; ei = BasicEvent e&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>One_nat_def</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>nth_Cons_0</span><span> </span><span>nth_Cons_Suc</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>EventSys_sound_seg_aux0_forall</span><span class="delimiter">:</span><span> 
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;&#8704;ef&#8712;es. &#915; &#8872; ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre ef, Rely ef, Guar ef, Post ef];
     esl&#8712;cpts_es &#915;;length esl &#8805; 2 &#8743; getspc_es (esl!0) = EvtSys es &#8743; getspc_es (esl!1) &#8800; EvtSys es;
     getspc_es (last esl) = EvtSys es;
     &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es)&#10215;
      &#10233; &#8704;ei&#8712;es. (&#8707;k. &#915; &#8866; esl!0-es-(EvtEnt ei)&#9839;k&#8594;esl!1) 
                              &#10230; (esl&#8712;assume_es &#915; (Pre ei,Rely ei) &#10230; esl&#8712;commit_es &#915; (Guar ei,Post ei)
                                    &#8743; gets_es (last esl) &#8712; Post ei)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;es. &#915; &#8872; ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre ef, Rely ef, Guar ef, Post ef]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length esl &#8805; 2 &#8743; getspc_es (esl!0) = EvtSys es &#8743; getspc_es (esl!1) &#8800; EvtSys es&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (last esl) = EvtSys es&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>c41</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;cpts_es &#915;&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>ei</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c01</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ei&#8712;es&quot;</span></span></span><span>
</span><span>          </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>c02</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;k. &#915; &#8866; esl!0-es-(EvtEnt ei)&#9839;k&#8594;esl!1&quot;</span></span></span><span>        
</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;s x ev s1 x1 xs. esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>fst_esys_snd_eseq_exist</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>ev</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>s1</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x1</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>xs</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c3</span><span class="delimiter">:</span><span>
</span><span>          </span><span class="string"><span class="delete"><span class="delete">&quot;esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c02</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;k. &#915; &#8866; (EvtSys es, s, x) -es-(EvtEnt ei)&#9839;k&#8594; (EvtSeq ev (EvtSys es), s1,x1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>k</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (EvtSys es, s, x) -es-(EvtEnt ei)&#9839;k&#8594; (EvtSeq ev (EvtSys es), s1,x1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;e. ei = BasicEvent e&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>evtent_is_basicevt</span><span class="delimiter">)</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>e</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ei = BasicEvent e&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?el</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(ei, s, x) # rm_evtsys ((EvtSeq ev (EvtSys es), s1,x1) # xs)&quot;</span></span></span><span>    
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c1</span><span> </span><span>c3</span><span> </span><span>c4</span><span> </span><span>c6</span><span> </span><span>c41</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el &#8712; cpts_ev &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rm_evtsys_in_cptse</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>
</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c3</span><span> </span><span>c4</span><span> </span><span>c6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c61</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; esl!0-es-(EvtEnt ei)&#9839;k&#8594;esl!1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el&#8712;assume_e &#915; (Pre ei, Rely ei) &#10230; ?el&#8712;commit_e &#915; (Guar ei,Post ei)&quot;</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> 
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el&#8712;assume_e &#915; (Pre ei, Rely ei)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span>c01</span><span> </span><span>c6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; &#915; &#8872; ei sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre ei, Rely ei, Guar ei, Post ei]&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c5</span><span> </span><span>c6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el&#8712;cpts_of_ev &#915; (BasicEvent e) s x&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>cpts_of_ev_def</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el&#8712;commit_e &#915; (Guar ei,Post ei)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evt_validity_def</span><span> </span><span>c6</span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c1</span><span> </span><span>c3</span><span> </span><span>c4</span><span> </span><span>c41</span><span> </span><span>c6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;assume_es &#915; (Pre ei, Rely ei) &#10230; esl&#8712;commit_es &#915; (Guar ei,Post ei)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rm_evtsys_assum_comm</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>        </span><span class="keyword1"><span class="command">moreover</span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;assume_es &#915; (Pre ei, Rely ei) &#10230; gets_es (last esl) &#8712; Post ei&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> 
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;assume_es &#915; (Pre ei, Rely ei)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c1</span><span> </span><span>c3</span><span> </span><span>c4</span><span> </span><span>c41</span><span> </span><span>c5</span><span> </span><span>c6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;e_sim_es esl ?el es e&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fstent_nomident_e_sim_es2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c1</span><span> </span><span>c3</span><span> </span><span>c4</span><span> </span><span>c41</span><span> </span><span>c5</span><span> </span><span>c6</span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el&#8712;assume_e &#915; (Pre ei, Rely ei)&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>e_sim_es_same_assume</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c8</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?el&#8712;commit_e &#915; (Guar ei,Post ei)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_e (last ?el) = AnonyEvent fin_com&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span>d2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length ?el = length esl&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>e_sim_es_def</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. i &gt; 0 &#8743; i &lt; length ?el &#10230; 
                                        (getspc_es (esl!i) = EvtSys es &#8743; getspc_e (?el!i) = AnonyEvent fin_com) 
                                          &#8744; (getspc_es (esl!i) = EvtSeq (getspc_e (?el!i)) (EvtSys es))&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>e_sim_es_def</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a0</span><span> </span><span>e1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(getspc_es (last esl) = EvtSys es &#8743; getspc_e (last ?el) = AnonyEvent fin_com) 
                                          &#8744; (getspc_es (last esl) = EvtSeq (getspc_e (last ?el)) (EvtSys es))&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>c3</span><span> </span><span>diff_less</span><span> </span><span>last_conv_nth</span><span> </span><span>length_greater_0_conv</span><span> </span><span>length_tl</span><span> 
</span><span>                        </span><span>list.sel</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>list.simps</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>zero_less_one</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p6</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_e (last ?el) &#8712; Post ei&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>commit_e_def</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span>d2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_e (last ?el) = gets_es (last esl)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>e_sim_es_def</span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span>d2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length ?el = length esl&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>e_sim_es_def</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. i &lt; length ?el &#10230; gets_e (?el ! i) = gets_es (esl ! i) &#8743;
                                                            getx_e (?el ! i) = getx_es (esl ! i)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>e_sim_es_def</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a0</span><span> </span><span>e1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>c3</span><span> </span><span>diff_less</span><span> </span><span>last_conv_nth</span><span> </span><span>length_greater_0_conv</span><span> </span><span>length_tl</span><span> 
</span><span>                        </span><span>list.sel</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>list.simps</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>zero_less_one</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (last esl) &#8712; Post ei&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>        </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(esl&#8712;assume_es &#915; (Pre ei,Rely ei) &#10230; esl&#8712;commit_es &#915; (Guar ei,Post ei)
                                    &#8743; gets_es (last esl) &#8712; Post ei)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>EventSys_sound_seg_aux0</span><span class="delimiter">:</span><span> 
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;&#8704;ef&#8712;es. &#915; &#8872; ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre ef, Rely ef, Guar ef, Post ef];
     esl&#8712;cpts_es &#915;;length esl &#8805; 2 &#8743; getspc_es (esl!0) = EvtSys es &#8743; getspc_es (esl!1) &#8800; EvtSys es;
     getspc_es (last esl) = EvtSys es;
     &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es)&#10215;
      &#10233; &#8707;m&#8712;es. (esl&#8712;assume_es &#915; (Pre m,Rely m) &#10230; esl&#8712;commit_es &#915; (Guar m,Post m)
                                &#8743; gets_es (last esl) &#8712; Post m)
                        &#8743; (&#8707;k. &#915; &#8866; esl!0-es-(EvtEnt m)&#9839;k&#8594;esl!1)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;es. &#915; &#8872; ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre ef, Rely ef, Guar ef, Post ef]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length esl &#8805; 2 &#8743; getspc_es (esl!0) = EvtSys es &#8743; getspc_es (esl!1) &#8800; EvtSys es&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (last esl) = EvtSys es&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length esl &#8743; getspc_es (esl!j) = EvtSys es &#8743; getspc_es (esl!Suc j) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;cpts_es &#915;&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;m&#8712;es. (&#8707;k. &#915; &#8866; esl!0-es-(EvtEnt m)&#9839;k&#8594;esl!1)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>EventSys_sound_seg_aux0_exist</span><span class="delimiter">[</span><span>of</span><span> </span><span>esl</span><span> </span><span>&#915;</span><span> </span><span>es</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>m</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m&#8712; es &#8743; (&#8707;k. &#915; &#8866; esl!0-es-(EvtEnt m)&#9839;k&#8594;esl!1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>p3</span><span> </span><span>p4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(esl&#8712;assume_es &#915; (Pre m,Rely m) &#10230; esl&#8712;commit_es &#915; (Guar m,Post m)
                                &#8743; gets_es (last esl) &#8712; Post m)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>EventSys_sound_seg_aux0_forall</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span>es</span><span> </span><span>&#915;</span><span> </span><span>Pre</span><span> </span><span>Rely</span><span> </span><span>Guar</span><span> </span><span>Post</span><span> </span><span>esl</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>EventSys_sound_aux_i_forall</span><span class="delimiter">:</span><span> 
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;&#8704;ef&#8712;es. &#915; &#8872; ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre ef, Rely ef, Guar ef, Post ef];
     &#8704;ef&#8712;es. pre &#8838; Pre ef;  &#8704;ef&#8712;es. rely &#8838; Rely ef;
     &#8704;ef&#8712;es. Guar ef &#8838; guar; &#8704;ef&#8712;es. Post ef &#8838; post;
     &#8704;ef1 ef2. ef1&#8712;es &#8743; ef2&#8712;es &#10230; Post ef1 &#8838; Pre ef2;
     esl&#8712;cpts_es &#915;; esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs;
     esl&#8712;assume_es &#915; (pre,rely);
     elst = tl (parse_es_cpts_i2 esl es [[]])&#10215;
      &#10233; &#8704;i. Suc i &lt; length elst &#10230; 
                (&#8704;ei&#8712;es. (&#8707;k. &#915; &#8866; (elst!i@[(elst!Suc i)!0])!0-es-(EvtEnt ei)&#9839;k&#8594;(elst!i@[(elst!Suc i)!0])!1) 
                                  &#10230; elst!i@[(elst!Suc i)!0]&#8712;commit_es &#915; (Guar ei,Post ei)
                                      &#8743; gets_es ((elst!Suc i)!0) &#8712; Post ei)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;es. &#915; &#8872; ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre ef, Rely ef, Guar ef, Post ef]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;es. pre &#8838; Pre ef&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;es. rely &#8838; Rely ef&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;es. Guar ef &#8838; guar&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;es. Post ef &#8838; post&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p5</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef1 ef2. ef1&#8712;es &#8743; ef2&#8712;es &#10230; Post ef1 &#8838; Pre ef2&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;cpts_es &#915;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;assume_es &#915; (pre,rely)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p11</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst = tl (parse_es_cpts_i2 esl es [[]])&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p9</span><span> </span><span>p8</span><span> </span><span>p11</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a0</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. i &lt; length elst &#10230; length (elst!i) &#8805; 2 &#8743;
                  getspc_es (elst!i!0) = EvtSys es &#8743; getspc_es (elst!i!1) &#8800; EvtSys es&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>parse_es_cpts_i2_start_aux</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p9</span><span> </span><span>p8</span><span> </span><span>p11</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. i &lt; length elst &#10230; 
                 &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length (elst!i) &#8743; 
                 getspc_es (elst!i!j) = EvtSys es &#8743; getspc_es (elst!i!Suc j) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>parse_es_cpts_i2_noent_mid</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p9</span><span> </span><span>p8</span><span> </span><span>p11</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;concat elst = esl&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>parse_es_cpts_i2_concat3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length elst&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ei&#8712;es. (&#8707;k. &#915; &#8866; (elst!i@[(elst!Suc i)!0])!0-es-(EvtEnt ei)&#9839;k&#8594;(elst!i@[(elst!Suc i)!0])!1) 
                                  &#10230; elst!i@[(elst!Suc i)!0]&#8712;commit_es &#915; (Guar ei,Post ei)
                                      &#8743; gets_es ((elst!Suc i)!0) &#8712; Post ei&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>i</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc 0 &lt; length elst&quot;</span></span></span><span> 
</span><span>                </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?els</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst ! 0 @ [elst ! Suc 0 ! 0]&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?els &#8712; cpts_es &#915;&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c11</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length elst. elst ! i &#8800; []&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>list.size</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>not_numeral_le_zero</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a2</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;m n. m &#8804; length esl &#8743; n &#8804; length esl &#8743; m &#8804; n &#8743; ?els = take (n - m) (drop m esl)&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>concat_i_lm</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>m</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>n</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &#8804; length esl &#8743; n &#8804; length esl &#8743; m &#8804; n 
                          &#8743; ?els = take (n - m) (drop m esl)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?els &#8800; []&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p8</span><span> </span><span>d1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cpts_es_seg2</span><span class="delimiter">)</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (last ?els) = EvtSys es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>a0</span><span> </span><span>c0</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length ?els &#8743; getspc_es (?els!j) = EvtSys es 
                  &#8743; getspc_es (?els!Suc j) &#8800; EvtSys es)&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (elst ! Suc 0 ! 0) = EvtSys es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Suc_leI</span><span> </span><span>Suc_lessD</span><span> 
</span><span>                      </span><span>Suc_lessE</span><span> </span><span>c0</span><span> </span><span>diff_Suc_1</span><span> </span><span>diff_is_0_eq&#39;</span><span> </span><span>length_append_singleton</span><span> </span><span>nth_Cons_0</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;2 &#8804; length ?els &#8743; getspc_es (?els ! 0) = EvtSys es &#8743; getspc_es (?els ! 1) &#8800; EvtSys es&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>hide_lams</span><span class="delimiter">)</span><span> </span><span>Suc_1</span><span> </span><span>Suc_eq_plus1_left</span><span> </span><span>Suc_le_lessD</span><span> 
</span><span>                      </span><span>Suc_lessD</span><span> </span><span>add.right_neutral</span><span> </span><span>c0</span><span> </span><span>length_append_singleton</span><span> </span><span>not_less</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p0</span><span> </span><span>c1</span><span> </span><span>c2</span><span> </span><span>c3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ei&#8712;es. (&#8707;k. &#915; &#8866; ?els!0-es-(EvtEnt ei)&#9839;k&#8594;?els!1) 
                              &#10230; (?els&#8712;assume_es &#915; (Pre ei,Rely ei) &#10230; ?els&#8712;commit_es &#915; (Guar ei,Post ei)
                                    &#8743; gets_es (last ?els) &#8712; Post ei)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>EventSys_sound_seg_aux0_forall</span><span class="delimiter">[</span><span>of</span><span> </span><span>es</span><span> </span><span>&#915;</span><span> </span><span>Pre</span><span> </span><span>Rely</span><span> </span><span>Guar</span><span> </span><span>Post</span><span> </span><span class="var">?els</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p10</span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?els&#8712;assume_es &#915; (pre,rely)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length elst. elst ! i &#8800; []&quot;</span></span></span><span> 
</span><span>                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>list.size</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>not_numeral_le_zero</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a2</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;m n. m &#8804; length esl &#8743; n &#8804; length esl &#8743; m &#8804; n &#8743; ?els = take (n - m) (drop m esl)&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>concat_i_lm</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p10</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length esl &#10230; &#915; &#8866; esl!i -ese&#8594; esl!(Suc i) &#10230; 
                        (gets_es (esl!i), gets_es (esl!Suc i)) &#8712; rely&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_es_def</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length ?els &#10230; &#915; &#8866; ?els!i -ese&#8594; ?els!(Suc i) &#10230; 
                        (gets_es (?els!i), gets_es (?els!Suc i)) &#8712; rely&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rely_takedrop_rely</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (?els!0) &#8712; pre&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?els!0 = esl!0&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Suc_lessD</span><span> </span><span>d1</span><span> 
</span><span>                              </span><span>c0</span><span> </span><span>concat.simps</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>cpts_es_not_empty</span><span> </span><span>hd_append2</span><span> 
</span><span>                              </span><span>length_greater_0_conv</span><span> </span><span>list.collapse</span><span> </span><span>nth_Cons_0</span><span> </span><span>p8</span><span> </span><span>snoc_eq_iff_butlast</span><span class="delimiter">)</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p10</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (esl!0) &#8712; pre&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_es_def</span><span class="delimiter">)</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_es_def</span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>c5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ei&#8712;es. ?els&#8712;assume_es &#915; (Pre ei, Rely ei)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assume_es_imp</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c5</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>j</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?elstjj</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst ! j @ [elst ! Suc j ! 0]&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?els</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst ! Suc j @ [elst ! Suc (Suc j) ! 0]&quot;</span></span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c01</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc j &lt; length elst 
                            &#10233; &#8704;ei&#8712;es. (&#8707;k. &#915; &#8866; ?elstjj ! 0 -es-EvtEnt ei&#9839;k&#8594; ?elstjj ! 1) &#10230;
                             ?elstjj &#8712; commit_es &#915; (Guar ei, Post ei) &#8743; gets_es (elst ! Suc j ! 0) &#8712; Post ei&quot;</span></span></span><span>
</span><span>                 </span><span class="keyword2"><span class="keyword">and</span></span><span>   </span><span>c02</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc (Suc j) &lt; length elst&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>                    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>ei</span><span>
</span><span>                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ei&#8712;es&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;k. &#915; &#8866; ?els ! 0 -es-EvtEnt ei&#9839;k&#8594; ?els ! 1&quot;</span></span></span><span>
</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c02</span><span> </span><span>a0</span><span class="delimiter">[</span><span>of</span><span> </span><span>j</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;m&#8712;es. (&#8707;k. &#915; &#8866; ?elstjj!0-es-(EvtEnt m)&#9839;k&#8594;?elstjj!1)&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>EventSys_sound_seg_aux0_exist</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?elstjj</span><span> </span><span>&#915;</span><span> </span><span>es</span><span class="delimiter">]</span><span> </span><span>p8</span><span> </span><span>p9</span><span> </span><span>p11</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>One_nat_def</span><span> </span><span>Suc_1</span><span> </span><span>Suc_le_lessD</span><span> </span><span>Suc_lessD</span><span> </span><span>le_SucI</span><span> </span><span>length_append_singleton</span><span> 
</span><span>                          </span><span>nth_append</span><span> </span><span>parse_es_cpts_i2_in_cptes_i</span><span class="delimiter">)</span><span> 
</span><span>    
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>ei&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c03</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ei&#39;&#8712;es &#8743; (&#8707;k. &#915; &#8866; ?elstjj!0-es-(EvtEnt ei&#39;)&#9839;k&#8594;?elstjj!1)&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c01</span><span> </span><span>c02</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c04</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?elstjj &#8712; commit_es &#915; (Guar ei&#39;, Post ei&#39;) 
                                        &#8743; gets_es (elst ! Suc j ! 0) &#8712; Post ei&#39;&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    
</span><span>                    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?els &#8712; cpts_es &#915;&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c11</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length elst. elst ! i &#8800; []&quot;</span></span></span><span> 
</span><span>                          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>list.size</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>not_numeral_le_zero</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a2</span><span> </span><span>c02</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;m n. m &#8804; length esl &#8743; n &#8804; length esl &#8743; m &#8804; n &#8743; ?els = take (n - m) (drop m esl)&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>concat_i_lm</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>m</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>n</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &#8804; length esl &#8743; n &#8804; length esl &#8743; m &#8804; n 
                              &#8743; ?els = take (n - m) (drop m esl)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?els &#8800; []&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p8</span><span> </span><span>d1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cpts_es_seg2</span><span class="delimiter">)</span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                    
</span><span>                    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (last ?els) = EvtSys es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>a0</span><span> </span><span>c02</span><span class="delimiter">)</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length ?els &#8743; getspc_es (?els!j) = EvtSys es 
                      &#8743; getspc_es (?els!Suc j) &#8800; EvtSys es)&quot;</span></span></span><span> 
</span><span>                      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (elst ! Suc (Suc j) ! 0) = EvtSys es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c02</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Suc_leI</span><span> </span><span>Suc_lessD</span><span> 
</span><span>                          </span><span>Suc_lessE</span><span> </span><span>c02</span><span> </span><span>diff_Suc_1</span><span> </span><span>diff_is_0_eq&#39;</span><span> </span><span>length_append_singleton</span><span> </span><span>nth_Cons_0</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span> 
</span><span>                      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;2 &#8804; length ?els &#8743; getspc_es (?els ! 0) = EvtSys es &#8743; getspc_es (?els ! 1) &#8800; EvtSys es&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>hide_lams</span><span class="delimiter">)</span><span> </span><span>Suc_1</span><span> </span><span>Suc_eq_plus1_left</span><span> </span><span>Suc_le_lessD</span><span> 
</span><span>                          </span><span>Suc_lessD</span><span> </span><span>add.right_neutral</span><span> </span><span>c02</span><span> </span><span>length_append_singleton</span><span> </span><span>not_less</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span>
</span><span>        
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p0</span><span> </span><span>c1</span><span> </span><span>c2</span><span> </span><span>c3</span><span> </span><span>d0</span><span> </span><span>d1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(?els&#8712;assume_es &#915; (Pre ei,Rely ei) &#10230; ?els&#8712;commit_es &#915; (Guar ei,Post ei)
                                &#8743; gets_es (last ?els) &#8712; Post ei)&quot;</span></span></span><span> 
</span><span>                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>EventSys_sound_seg_aux0_forall</span><span class="delimiter">[</span><span>of</span><span> </span><span>es</span><span> </span><span>&#915;</span><span> </span><span>Pre</span><span> </span><span>Rely</span><span> </span><span>Guar</span><span> </span><span>Post</span><span> </span><span class="var">?els</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p10</span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?els&#8712;assume_es &#915; (Pre ei,rely)&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length elst. elst ! i &#8800; []&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>list.size</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>not_numeral_le_zero</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a2</span><span> </span><span>c02</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;m n. m &#8804; length esl &#8743; n &#8804; length esl &#8743; m &#8804; n &#8743; ?els = take (n - m) (drop m esl)&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>concat_i_lm</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p10</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length esl &#10230; &#915; &#8866; esl!i -ese&#8594; esl!(Suc i) &#10230; 
                            (gets_es (esl!i), gets_es (esl!Suc i)) &#8712; rely&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_es_def</span><span class="delimiter">)</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length ?els &#10230; &#915; &#8866; ?els!i -ese&#8594; ?els!(Suc i) &#10230; 
                            (gets_es (?els!i), gets_es (?els!Suc i)) &#8712; rely&quot;</span></span></span><span>
</span><span>                            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rely_takedrop_rely</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (?els!0) &#8712; Pre ei&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p5</span><span class="delimiter">[</span><span>of</span><span> </span><span>ei&#39;</span><span> </span><span>ei</span><span class="delimiter">]</span><span> </span><span>d0</span><span> </span><span>c03</span><span> </span><span>c04</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (elst ! Suc j ! 0) &#8712; Pre ei&quot;</span></span></span><span>
</span><span>                               </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>                            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Suc_lessD</span><span> </span><span>c02</span><span> </span><span>d1</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span> 
</span><span>                          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_es_def</span><span class="delimiter">)</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>        
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?els&#8712;assume_es &#915; (Pre ei, Rely ei)&quot;</span></span></span><span> 
</span><span>                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assume_es_imp</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Pre ei&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Pre ei&quot;</span></span></span><span> </span><span>rely</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Rely ei&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>                       </span><span>d0</span><span> </span><span>order_refl</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                      
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?els&#8712;commit_es &#915; (Guar ei,Post ei) &#8743; gets_es (last ?els) &#8712; Post ei&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>EventSys_sound_aux_i</span><span class="delimiter">:</span><span> 
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;&#8704;ef&#8712;es. &#915; &#8872; ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre ef, Rely ef, Guar ef, Post ef];
     &#8704;ef&#8712;es. pre &#8838; Pre ef;  &#8704;ef&#8712;es. rely &#8838; Rely ef;
     &#8704;ef&#8712;es. Guar ef &#8838; guar; &#8704;ef&#8712;es. Post ef &#8838; post;
     &#8704;ef1 ef2. ef1&#8712;es &#8743; ef2&#8712;es &#10230; Post ef1 &#8838; Pre ef2;
     esl&#8712;cpts_es &#915;; esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs;
     esl&#8712;assume_es &#915; (pre,rely);
     elst = tl (parse_es_cpts_i2 esl es [[]])&#10215;
      &#10233; &#8704;i. Suc i &lt; length elst &#10230; 
                (&#8707;m&#8712;es. elst!i@[(elst!Suc i)!0]&#8712;commit_es &#915; (Guar m,Post m)
                                &#8743; gets_es ((elst!Suc i)!0) &#8712; Post m
                &#8743; (&#8707;k. &#915; &#8866; (elst!i@[(elst!Suc i)!0])!0-es-(EvtEnt m)&#9839;k&#8594;(elst!i@[(elst!Suc i)!0])!1))&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;es. &#915; &#8872; ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre ef, Rely ef, Guar ef, Post ef]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;es. pre &#8838; Pre ef&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;es. rely &#8838; Rely ef&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;es. Guar ef &#8838; guar&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;es. Post ef &#8838; post&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef1 ef2. ef1&#8712;es &#8743; ef2&#8712;es &#10230; Post ef1 &#8838; Pre ef2&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;cpts_es &#915;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;assume_es &#915; (pre,rely)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p11</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst = tl (parse_es_cpts_i2 esl es [[]])&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p9</span><span> </span><span>p8</span><span> </span><span>p11</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a0</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. i &lt; length elst &#10230; length (elst!i) &#8805; 2 &#8743;
                  getspc_es (elst!i!0) = EvtSys es &#8743; getspc_es (elst!i!1) &#8800; EvtSys es&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>parse_es_cpts_i2_start_aux</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p9</span><span> </span><span>p8</span><span> </span><span>p11</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. i &lt; length elst &#10230; 
                 &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length (elst!i) &#8743; 
                 getspc_es (elst!i!j) = EvtSys es &#8743; getspc_es (elst!i!Suc j) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>parse_es_cpts_i2_noent_mid</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p9</span><span> </span><span>p8</span><span> </span><span>p11</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;concat elst = esl&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>parse_es_cpts_i2_concat3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length elst&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a0</span><span class="delimiter">[</span><span>of</span><span> </span><span>i</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;m&#8712;es. (&#8707;k. &#915; &#8866; elst!i!0-es-(EvtEnt m)&#9839;k&#8594;elst!i!1)&quot;</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>EventSys_sound_seg_aux0_exist</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst!i@[(elst!Suc i)!0]&quot;</span></span></span><span> </span><span>&#915;</span><span> </span><span>es</span><span class="delimiter">]</span><span> 
</span><span>            </span><span>parse_es_cpts_i2_in_cptes_i</span><span class="delimiter">[</span><span>of</span><span> </span><span>esl</span><span> </span><span>es</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>e</span><span> </span><span>s1</span><span> </span><span>x1</span><span> </span><span>xs</span><span> </span><span>&#915;</span><span> </span><span>elst</span><span class="delimiter">]</span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>Suc_1</span><span> </span><span>Suc_le_lessD</span><span> </span><span>Suc_lessD</span><span> </span><span>le_SucI</span><span> </span><span>length_append_singleton</span><span> 
</span><span>              </span><span>length_greater_0_conv</span><span> </span><span>list.size</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>not_numeral_le_zero</span><span> </span><span>nth_append</span><span> </span><span>p11</span><span> </span><span>p8</span><span> </span><span>p9</span><span class="delimiter">)</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>m</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m&#8712;es &#8743; (&#8707;k. &#915; &#8866; elst!i!0-es-(EvtEnt m)&#9839;k&#8594;elst!i!1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>p3</span><span> </span><span>p4</span><span> </span><span>p5</span><span> </span><span>p8</span><span> </span><span>p9</span><span> </span><span>p10</span><span> </span><span>p11</span><span> </span><span>b0</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b2</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length elst &#10230; (&#8704;ei&#8712;es.
            (&#8707;k. &#915; &#8866; (elst ! i @ [elst ! Suc i ! 0]) ! 0 -es-EvtEnt ei&#9839;k&#8594; (elst ! i @ [elst ! Suc i ! 0]) ! 1) &#10230;
            elst ! i @ [elst ! Suc i ! 0] &#8712; commit_es &#915; (Guar ei, Post ei) &#8743; gets_es (elst ! Suc i ! 0) &#8712; Post ei)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>EventSys_sound_aux_i_forall</span><span class="delimiter">[</span><span>of</span><span> </span><span>es</span><span> </span><span>&#915;</span><span> </span><span>Pre</span><span> </span><span>Rely</span><span> </span><span>Guar</span><span> </span><span>Post</span><span> </span><span>pre</span><span> </span><span>rely</span><span> </span><span>guar</span><span> </span><span>post</span><span> </span><span>esl</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>e</span><span> </span><span>s1</span><span> </span><span>x1</span><span> </span><span>xs</span><span> </span><span>elst</span><span class="delimiter">]</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span>b1</span><span> </span><span>b2</span><span class="delimiter">[</span><span>of</span><span> </span><span>i</span><span> </span><span>m</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst!i@[(elst!Suc i)!0]&#8712;commit_es &#915; (Guar m,Post m)
                 &#8743; gets_es ((elst!Suc i)!0) &#8712; Post m&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Suc_1</span><span> </span><span>Suc_le_lessD</span><span> </span><span>Suc_lessD</span><span> </span><span>a0</span><span> </span><span>length_greater_0_conv</span><span> 
</span><span>              </span><span>list.size</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>not_numeral_le_zero</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;m&#8712;es. elst!i@[(elst!Suc i)!0]&#8712;commit_es &#915; (Guar m,Post m)
                  &#8743; gets_es ((elst!Suc i)!0) &#8712; Post m 
                  &#8743; (&#8707;k. &#915; &#8866; (elst!i@[(elst!Suc i)!0])!0-es-(EvtEnt m)&#9839;k&#8594;(elst!i@[(elst!Suc i)!0])!1)&quot;</span></span></span><span>
</span><span>           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>One_nat_def</span><span> </span><span>Suc_lessD</span><span> </span><span>a0</span><span> </span><span>b0</span><span> </span><span>lessI</span><span> </span><span>less_le_trans</span><span> </span><span>nth_append</span><span> </span><span>numeral_2_eq_2</span><span class="delimiter">)</span><span> 
</span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>EventSys_sound_aux_last_forall</span><span class="delimiter">:</span><span> 
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;&#8704;ef&#8712;es. &#915; &#8872; ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre ef, Rely ef, Guar ef, Post ef];
     &#8704;ef&#8712;es. pre &#8838; Pre ef;  &#8704;ef&#8712;es. rely &#8838; Rely ef;
     &#8704;ef&#8712;es. Guar ef &#8838; guar; &#8704;ef&#8712;es. Post ef &#8838; post;
     &#8704;ef1 ef2. ef1&#8712;es &#8743; ef2&#8712;es &#10230; Post ef1 &#8838; Pre ef2;
     esl&#8712;cpts_es &#915;; esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs;
     esl&#8712;assume_es &#915; (pre,rely);
     elst = tl (parse_es_cpts_i2 esl es [[]])&#10215;
      &#10233; &#8704;ei&#8712;es. (&#8707;k. &#915; &#8866; (last elst)!0-es-(EvtEnt ei)&#9839;k&#8594;(last elst)!1) 
                           &#10230; last elst&#8712;commit_es &#915; (Guar ei,Post ei)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;es. &#915; &#8872; ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre ef, Rely ef, Guar ef, Post ef]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;es. pre &#8838; Pre ef&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;es. rely &#8838; Rely ef&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;es. Guar ef &#8838; guar&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;es. Post ef &#8838; post&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef1 ef2. ef1&#8712;es &#8743; ef2&#8712;es &#10230; Post ef1 &#8838; Pre ef2&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;cpts_es &#915;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;assume_es &#915; (pre,rely)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p11</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst = tl (parse_es_cpts_i2 esl es [[]])&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p9</span><span> </span><span>p8</span><span> </span><span>p11</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a0</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. i &lt; length elst &#10230; length (elst!i) &#8805; 2 &#8743;
                  getspc_es (elst!i!0) = EvtSys es &#8743; getspc_es (elst!i!1) &#8800; EvtSys es&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>parse_es_cpts_i2_start_aux</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p9</span><span> </span><span>p8</span><span> </span><span>p11</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. i &lt; length elst &#10230; 
                 &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length (elst!i) &#8743; 
                 getspc_es (elst!i!j) = EvtSys es &#8743; getspc_es (elst!i!Suc j) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>parse_es_cpts_i2_noent_mid</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p9</span><span> </span><span>p8</span><span> </span><span>p11</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;concat elst = esl&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>parse_es_cpts_i2_concat3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p9</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst &#8800; []&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>ei</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a01</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;ei&#8712;es&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a02</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;k. &#915; &#8866; (last elst)!0-es-(EvtEnt ei)&#9839;k&#8594;(last elst)!1&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;last elst&#8712;commit_es &#915; (Guar ei,Post ei)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length elst = 1&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length elst = 1&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a2</span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;last elst = esl&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>One_nat_def</span><span> </span><span>a3</span><span> </span><span>append_butlast_last_id</span><span> </span><span>append_self_conv2</span><span> </span><span>concat.simps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>concat.simps</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>diff_Suc_1</span><span> </span><span>length_0_conv</span><span> </span><span>length_butlast</span><span> </span><span>self_append_conv</span><span class="delimiter">)</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?els</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst ! 0&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p8</span><span> </span><span>a2</span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?els &#8712; cpts_es &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>b1</span><span> </span><span>a3</span><span> </span><span>last_conv_nth</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>        
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a1</span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length ?els &#8743; getspc_es (?els!j) = EvtSys es 
          &#8743; getspc_es (?els!Suc j) &#8800; EvtSys es)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;2 &#8804; length ?els &#8743; getspc_es (?els ! 0) = EvtSys es &#8743; getspc_es (?els ! 1) &#8800; EvtSys es&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p0</span><span> </span><span>c1</span><span> </span><span>c3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;m&#8712;es. (&#8707;k. &#915; &#8866; ?els!0-es-(EvtEnt m)&#9839;k&#8594;?els!1) 
                          &#10230; (?els&#8712;assume_es &#915; (Pre m,Rely m) &#10230; ?els&#8712;commit_es &#915; (Guar m,Post m))&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>EventSys_sound_aux1_forall</span><span class="delimiter">[</span><span>of</span><span> </span><span>es</span><span> </span><span>&#915;</span><span> </span><span>Pre</span><span> </span><span>Rely</span><span> </span><span>Guar</span><span> </span><span>Post</span><span> </span><span class="var">?els</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p10</span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?els&#8712;assume_es &#915; (pre,rely)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>            
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a2</span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;m n. m &#8804; length esl &#8743; last elst = (drop m esl)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>concat_last_lm</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p10</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length esl &#10230; &#915; &#8866; esl!i -ese&#8594; esl!(Suc i) &#10230; 
                (gets_es (esl!i), gets_es (esl!Suc i)) &#8712; rely&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_es_def</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length ?els &#10230; &#915; &#8866; ?els!i -ese&#8594; ?els!(Suc i) &#10230; 
                (gets_es (?els!i), gets_es (?els!Suc i)) &#8712; rely&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span>b0</span><span> </span><span>b1</span><span> </span><span>last_conv_nth</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (?els!0) &#8712; pre&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?els!0 = esl!0&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span>b0</span><span> </span><span>b1</span><span> </span><span>last_conv_nth</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>                </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p10</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (esl!0) &#8712; pre&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_es_def</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_es_def</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>a01</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?els&#8712;assume_es &#915; (Pre ei, Rely ei)&quot;</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assume_es_imp</span><span class="delimiter">[</span><span>of</span><span> </span><span>pre</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Pre ei&quot;</span></span></span><span> </span><span>rely</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Rely ei&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst ! 0&quot;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a01</span><span> </span><span>a02</span><span> </span><span>c5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?els&#8712;commit_es &#915; (Guar ei,Post ei)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>a3</span><span> </span><span>b0</span><span> </span><span>last_conv_nth</span><span class="delimiter">)</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c5</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span>b0</span><span> </span><span>last_conv_nth</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>One_nat_def</span><span> </span><span>diff_Suc_1</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length elst &#8800; 1&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length elst &gt; 1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Suc_lessI</span><span class="delimiter">)</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?els</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;last elst&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p8</span><span> </span><span>a2</span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?els &#8712; cpts_es &#915;&quot;</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a2</span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;m . m &#8804; length esl &#8743; ?els = drop m esl&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>concat_last_lm</span><span> </span><span>a3</span><span class="delimiter">)</span><span> 
</span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>m</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &#8804; length esl &#8743; ?els = drop m esl&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &lt; length esl&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>One_nat_def</span><span> </span><span>a3</span><span> </span><span>diff_less</span><span> </span><span>drop_all</span><span> </span><span>last_conv_nth</span><span> </span><span>le_less_linear</span><span> 
</span><span>                  </span><span>length_greater_0_conv</span><span> </span><span>list.size</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>not_less_eq</span><span> </span><span>not_numeral_le_zero</span><span class="delimiter">)</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p8</span><span> </span><span>d1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_es_dropi</span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>drop_0</span><span> </span><span>le_0_eq</span><span> </span><span>le_SucE</span><span> </span><span>zero_induct</span><span class="delimiter">)</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a1</span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length ?els &#8743; getspc_es (?els!j) = EvtSys es 
          &#8743; getspc_es (?els!Suc j) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>One_nat_def</span><span> </span><span>Suc_lessD</span><span> </span><span>a3</span><span> </span><span>diff_less</span><span> </span><span>last_conv_nth</span><span> </span><span>zero_less_one</span><span class="delimiter">)</span><span>  
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;2 &#8804; length ?els &#8743; getspc_es (?els ! 0) = EvtSys es &#8743; getspc_es (?els ! 1) &#8800; EvtSys es&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>a3</span><span> </span><span>last_conv_nth</span><span class="delimiter">)</span><span>
</span><span>          
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p0</span><span> </span><span>c1</span><span> </span><span>c3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;m&#8712;es. (&#8707;k. &#915; &#8866; ?els!0-es-(EvtEnt m)&#9839;k&#8594;?els!1) 
                          &#10230; (?els&#8712;assume_es &#915; (Pre m,Rely m) &#10230; ?els&#8712;commit_es &#915; (Guar m,Post m))&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>EventSys_sound_aux1_forall</span><span class="delimiter">[</span><span>of</span><span> </span><span>es</span><span> </span><span>&#915;</span><span> </span><span>Pre</span><span> </span><span>Rely</span><span> </span><span>Guar</span><span> </span><span>Post</span><span> </span><span class="var">?els</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p10</span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?els&#8712;assume_es &#915; (Pre ei,rely)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a2</span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;m . m &#8804; length esl &#8743; ?els = drop m esl&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>concat_last_lm</span><span> </span><span>a3</span><span class="delimiter">)</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p10</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length esl &#10230; &#915; &#8866; esl!i -ese&#8594; esl!(Suc i) &#10230; 
                (gets_es (esl!i), gets_es (esl!Suc i)) &#8712; rely&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_es_def</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length ?els &#10230; &#915; &#8866; ?els!i -ese&#8594; ?els!(Suc i) &#10230; 
                (gets_es (?els!i), gets_es (?els!Suc i)) &#8712; rely&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span>b0</span><span> </span><span>last_conv_nth</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>            </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (?els!0) &#8712; Pre ei&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>p3</span><span> </span><span>p4</span><span> </span><span>p5</span><span> </span><span>p8</span><span> </span><span>p9</span><span> </span><span>p10</span><span> </span><span>p11</span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c1</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length elst &#10230; 
                (&#8704;ei&#8712;es. (&#8707;k. &#915; &#8866; (elst!i@[(elst!Suc i)!0])!0-es-(EvtEnt ei)&#9839;k&#8594;(elst!i@[(elst!Suc i)!0])!1) 
                                  &#10230; elst!i@[(elst!Suc i)!0]&#8712;commit_es &#915; (Guar ei,Post ei)
                                      &#8743; gets_es ((elst!Suc i)!0) &#8712; Post ei)&quot;</span></span></span><span> 
</span><span>                   </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>EventSys_sound_aux_i_forall</span><span class="delimiter">[</span><span>of</span><span> </span><span>es</span><span> </span><span>&#915;</span><span> </span><span>Pre</span><span> </span><span>Rely</span><span> </span><span>Guar</span><span> </span><span>Post</span><span> </span><span>pre</span><span> </span><span>rely</span><span> </span><span>guar</span><span> 
</span><span>                          </span><span>post</span><span> </span><span>esl</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>e</span><span> </span><span>s1</span><span> </span><span>x1</span><span> </span><span>xs</span><span> </span><span>elst</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?els1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst!(length elst - 2)@[(elst!(length elst - 1))!0]&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?els1 &#8712; cpts_es &#915;&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c11</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length elst. elst ! i &#8800; []&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>list.size</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>not_numeral_le_zero</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a2</span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;m n. m &#8804; length esl &#8743; n &#8804; length esl &#8743; m &#8804; n &#8743; ?els1 = take (n - m) (drop m esl)&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>concat_i_lm</span><span class="delimiter">[</span><span>of</span><span> </span><span>elst</span><span> </span><span>esl</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length elst - 2&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Suc_1</span><span> </span><span>Suc_diff_1</span><span> 
</span><span>                            </span><span>Suc_diff_Suc</span><span> </span><span>a3</span><span> </span><span>length_greater_0_conv</span><span> </span><span>lessI</span><span class="delimiter">)</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>m</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>n</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &#8804; length esl &#8743; n &#8804; length esl &#8743; m &#8804; n 
                          &#8743; ?els1 = take (n - m) (drop m esl)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?els1 &#8800; []&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p8</span><span> </span><span>d1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cpts_es_seg2</span><span class="delimiter">)</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length ?els1 &gt; 2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length elst - 2&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>a3</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (?els1 ! 0) = EvtSys es &#8743; getspc_es (?els1 ! 1) &#8800; EvtSys es&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a0</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length elst - 2&quot;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>One_nat_def</span><span> 
</span><span>                      </span><span>Suc_lessD</span><span> </span><span>Suc_less_SucD</span><span> </span><span>b0</span><span> </span><span>calculation</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>diff_less</span><span> 
</span><span>                      </span><span>length_append_singleton</span><span> </span><span>nth_append</span><span> </span><span>numeral_2_eq_2</span><span> </span><span>zero_less_numeral</span><span class="delimiter">)</span><span>  
</span><span>                </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;m&#8712;es. (&#8707;k. &#915; &#8866; ?els1!0-es-(EvtEnt m)&#9839;k&#8594;?els1!1)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>EventSys_sound_seg_aux0_exist</span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?els1</span><span> </span><span>&#915;</span><span> </span><span>es</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>m</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>d2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m&#8712;es &#8743; (&#8707;k. &#915; &#8866; ?els1!0-es-(EvtEnt m)&#9839;k&#8594;?els1!1)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (elst ! (length elst - 1) ! 0) &#8712; Post m&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c1</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length elst - 2&quot;</span></span></span><span> </span><span>m</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>One_nat_def</span><span> 
</span><span>                    </span><span>Suc_diff_Suc</span><span> </span><span>Suc_lessD</span><span> </span><span>b0</span><span> </span><span>diff_less</span><span> </span><span>le_imp_less_Suc</span><span> </span><span>le_numeral_extra</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>numeral_2_eq_2</span><span class="delimiter">)</span><span>
</span><span>              
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (last elst ! 0) &#8712; Post m&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>a3</span><span> </span><span>last_conv_nth</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p5</span><span> </span><span>a01</span><span> </span><span>d2</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_es_def</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">moreover</span></span><span> 
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rely &#8838; Rely ei&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>a01</span><span class="delimiter">)</span><span>  
</span><span>        </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?els&#8712;assume_es &#915; (Pre ei, Rely ei)&quot;</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assume_es_imp</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?els&#8712;commit_es &#915; (Guar ei,Post ei)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a01</span><span> </span><span>a02</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>        
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c5</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a3</span><span> </span><span>b0</span><span> </span><span>last_conv_nth</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>EventSys_sound_aux_last</span><span class="delimiter">:</span><span> 
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;&#8704;ef&#8712;es. &#915; &#8872; ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre ef, Rely ef, Guar ef, Post ef];
     &#8704;ef&#8712;es. pre &#8838; Pre ef;  &#8704;ef&#8712;es. rely &#8838; Rely ef;
     &#8704;ef&#8712;es. Guar ef &#8838; guar; &#8704;ef&#8712;es. Post ef &#8838; post;
     &#8704;ef1 ef2. ef1&#8712;es &#8743; ef2&#8712;es &#10230; Post ef1 &#8838; Pre ef2;
     esl&#8712;cpts_es &#915;; esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs;
     esl&#8712;assume_es &#915; (pre,rely);
     elst = tl (parse_es_cpts_i2 esl es [[]])&#10215;
      &#10233; &#8707;m&#8712;es. last elst&#8712;commit_es &#915; (Guar m,Post m) 
                        &#8743; (&#8707;k. &#915; &#8866; (last elst)!0-es-(EvtEnt m)&#9839;k&#8594;(last elst)!1)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span>  </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;es. &#915; &#8872; ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre ef, Rely ef, Guar ef, Post ef]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;es. pre &#8838; Pre ef&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;es. rely &#8838; Rely ef&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;es. Guar ef &#8838; guar&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;es. Post ef &#8838; post&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef1 ef2. ef1&#8712;es &#8743; ef2&#8712;es &#10230; Post ef1 &#8838; Pre ef2&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;cpts_es &#915;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;assume_es &#915; (pre,rely)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p11</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst = tl (parse_es_cpts_i2 esl es [[]])&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p9</span><span> </span><span>p8</span><span> </span><span>p11</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a0</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. i &lt; length elst &#10230; length (elst!i) &#8805; 2 &#8743;
                  getspc_es (elst!i!0) = EvtSys es &#8743; getspc_es (elst!i!1) &#8800; EvtSys es&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>parse_es_cpts_i2_start_aux</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p9</span><span> </span><span>p8</span><span> </span><span>p11</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. i &lt; length elst &#10230; 
                 &#172;(&#8707;j. j &gt; 0 &#8743; Suc j &lt; length (elst!i) &#8743; 
                 getspc_es (elst!i!j) = EvtSys es &#8743; getspc_es (elst!i!Suc j) &#8800; EvtSys es)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>parse_es_cpts_i2_noent_mid</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p9</span><span> </span><span>p8</span><span> </span><span>p11</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;concat elst = esl&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>parse_es_cpts_i2_concat3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p9</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;elst &#8800; []&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p8</span><span> </span><span>p9</span><span> </span><span>p11</span><span> </span><span>a0</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length elst - 1&quot;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;m&#8712;es. (&#8707;k. &#915; &#8866; last elst!0-es-(EvtEnt m)&#9839;k&#8594;last elst!1)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>EventSys_sound_seg_aux0_exist</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;last elst&quot;</span></span></span><span> </span><span>&#915;</span><span> </span><span>es</span><span class="delimiter">]</span><span> 
</span><span>        </span><span>parse_es_cpts_i2_in_cptes_last</span><span class="delimiter">[</span><span>of</span><span> </span><span>esl</span><span> </span><span>es</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>e</span><span> </span><span>s1</span><span> </span><span>x1</span><span> </span><span>xs</span><span> </span><span>&#915;</span><span> </span><span>elst</span><span class="delimiter">]</span><span>
</span><span>        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>a3</span><span> </span><span>diff_less</span><span> </span><span>last_conv_nth</span><span> </span><span>length_greater_0_conv</span><span> </span><span>less_one</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>m</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m&#8712;es &#8743; (&#8707;k. &#915; &#8866; last elst!0-es-(EvtEnt m)&#9839;k&#8594;last elst!1)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>p3</span><span> </span><span>p4</span><span> </span><span>p5</span><span> </span><span>p8</span><span> </span><span>p9</span><span> </span><span>p10</span><span> </span><span>p11</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;last elst&#8712;commit_es &#915; (Guar m,Post m)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>EventSys_sound_aux_last_forall</span><span class="delimiter">[</span><span>of</span><span> </span><span>es</span><span> </span><span>&#915;</span><span> </span><span>Pre</span><span> </span><span>Rely</span><span> </span><span>Guar</span><span> </span><span>Post</span><span> </span><span>pre</span><span> 
</span><span>        </span><span>rely</span><span> </span><span>guar</span><span> </span><span>post</span><span> </span><span>esl</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>e</span><span> </span><span>s1</span><span> </span><span>x1</span><span> </span><span>xs</span><span> </span><span>elst</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>EventSys_sound_0</span><span class="delimiter">:</span><span> 
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;&#8704;ef&#8712;es. &#915; &#8872; ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre ef, Rely ef, Guar ef, Post ef];
     &#8704;ef&#8712;es. pre &#8838; Pre ef;  &#8704;ef&#8712;es. rely &#8838; Rely ef;
     &#8704;ef&#8712;es. Guar ef &#8838; guar; &#8704;ef&#8712;es. Post ef &#8838; post;
     &#8704;ef1 ef2. ef1&#8712;es &#8743; ef2&#8712;es &#10230; Post ef1 &#8838; Pre ef2;
     stable_e pre rely; &#8704;s. (s, s)&#8712;guar;
     esl&#8712;cpts_es &#915;; esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs;
     esl&#8712;assume_es &#915; (pre,rely)&#10215;
      &#10233; &#8704;i. Suc i&lt;length esl &#10230; (&#8707;t. &#915; &#8866; esl!i -es-t&#8594; esl!(Suc i)) &#10230; 
                          (gets_es (esl!i), gets_es (esl!Suc i)) &#8712; guar&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;es. &#915; &#8872; ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre ef, Rely ef, Guar ef, Post ef]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;es. pre &#8838; Pre ef&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;es. rely &#8838; Rely ef&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;es. Guar ef &#8838; guar&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;es. Post ef &#8838; post&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef1 ef2. ef1&#8712;es &#8743; ef2&#8712;es &#10230; Post ef1 &#8838; Pre ef2&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;stable_e pre rely&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s. (s, s)&#8712;guar&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;cpts_es &#915;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;assume_es &#915; (pre,rely)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?elst</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;tl (parse_es_cpts_i2 esl es [[]])&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p9</span><span> </span><span>p8</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;concat ?elst = esl&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>parse_es_cpts_i2_concat3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>  
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p9</span><span> </span><span>p8</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. i &lt; length ?elst &#10230; length (?elst!i) &#8805; 2 &#8743;
                  getspc_es (?elst!i!0) = EvtSys es &#8743; getspc_es (?elst!i!1) &#8800; EvtSys es&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>parse_es_cpts_i2_start_aux</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>p3</span><span> </span><span>p4</span><span> </span><span>p5</span><span> </span><span>p6</span><span> </span><span>p7</span><span> </span><span>p8</span><span> </span><span>p9</span><span> </span><span>p10</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length ?elst &#10230; 
                (&#8707;m&#8712;es. ?elst!i@[(?elst!Suc i)!0]&#8712;commit_es &#915; (Guar m,Post m)
                                &#8743; gets_es ((?elst!Suc i)!0) &#8712; Post m)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>EventSys_sound_aux_i</span><span> 
</span><span>        </span><span class="delimiter">[</span><span>of</span><span> </span><span>es</span><span> </span><span>&#915;</span><span> </span><span>Pre</span><span> </span><span>Rely</span><span> </span><span>Guar</span><span> </span><span>Post</span><span> </span><span>pre</span><span> </span><span>rely</span><span> </span><span>guar</span><span> </span><span>post</span><span> </span><span>esl</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>e</span><span> </span><span>s1</span><span> </span><span>x1</span><span> </span><span>xs</span><span> </span><span class="var">?elst</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length ?elst &#10230; 
                (&#8707;m&#8712;es. ?elst!i@[(?elst!Suc i)!0]&#8712;commit_es &#915; (Guar m,Post m))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>p3</span><span> </span><span>p4</span><span> </span><span>p5</span><span> </span><span>p6</span><span> </span><span>p7</span><span> </span><span>p8</span><span> </span><span>p9</span><span> </span><span>p10</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;m&#8712;es. last ?elst&#8712;commit_es &#915; (Guar m,Post m)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>EventSys_sound_aux_last</span><span>
</span><span>        </span><span class="delimiter">[</span><span>of</span><span> </span><span>es</span><span> </span><span>&#915;</span><span> </span><span>Pre</span><span> </span><span>Rely</span><span> </span><span>Guar</span><span> </span><span>Post</span><span> </span><span>pre</span><span> </span><span>rely</span><span> </span><span>guar</span><span> </span><span>post</span><span> </span><span>esl</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>e</span><span> </span><span>s1</span><span> </span><span>x1</span><span> </span><span>xs</span><span> </span><span class="var">?elst</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>m</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m&#8712;es &#8743; last ?elst&#8712;commit_es &#915; (Guar m,Post m)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length esl&quot;</span></span></span><span>
</span><span>          </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;t. &#915; &#8866; esl ! i -es-t&#8594; esl ! Suc i&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p9</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b01</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl &#8800; []&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length ?elst. length (?elst!i) &#8805; 2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;k j. k &lt; length ?elst &#8743; j &#8804; length (?elst!k) &#8743; 
                  drop i esl = (drop j (?elst!k)) @ concat (drop (Suc k) ?elst)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>concat_equiv</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span>esl</span><span> </span><span class="var">?elst</span><span class="delimiter">]</span><span> </span><span>a0</span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>k</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>j</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>b2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k &lt; length ?elst &#8743; j &#8804; length (?elst!k) &#8743; 
                  drop i esl = (drop j (?elst!k)) @ concat (drop (Suc k) ?elst)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (esl!i), gets_es (esl!Suc i)) &#8712; guar&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k = length ?elst - 1&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k = length ?elst - 1&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop i esl = drop j (last ?elst)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Nitpick.size_list_simp</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>Suc_leI</span><span> </span><span>b01</span><span> 
</span><span>                  </span><span>a0</span><span> </span><span>concat.simps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>drop_all</span><span> </span><span>last_conv_nth</span><span> </span><span>length_tl</span><span> </span><span>self_append_conv</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b0</span><span> </span><span>b01</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop j (last ?elst) &#8800; []&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b2</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j &lt; length (last ?elst)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl ! i = (last ?elst) ! j&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_lessD</span><span> </span><span>b0</span><span> </span><span>hd_drop_conv_nth</span><span class="delimiter">)</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c1</span><span> </span><span>c3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl ! Suc i = (last ?elst) ! Suc j&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Cons_nth_drop_Suc</span><span> </span><span>Suc_lessD</span><span> </span><span>b0</span><span> </span><span>list.sel</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>nth_via_drop</span><span class="delimiter">)</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length (last ?elst) &#10230; (&#8707;t. &#915; &#8866; (last ?elst)!i -es-t&#8594; (last ?elst)!(Suc i)) 
                  &#10230; (gets_es ((last ?elst)!i), gets_es ((last ?elst)!Suc i)) &#8712; Guar m&quot;</span></span></span><span> 
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>commit_es_def</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b1</span><span> </span><span>c3</span><span> </span><span>c4</span><span> </span><span>c5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (esl ! i), gets_es (esl ! Suc i)) &#8712; Guar m&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Cons_nth_drop_Suc</span><span> </span><span>b0</span><span> </span><span>c1</span><span> </span><span>length_drop</span><span> </span><span>list.sel</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span> </span><span>zero_less_diff</span><span class="delimiter">)</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p3</span><span> </span><span>a4</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c00</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k &#8800; length ?elst - 1&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k &lt; length ?elst - 1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j = length (?elst!k)&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j = length (?elst!k)&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop i esl = concat (drop (Suc k) ?elst)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b3</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length (?elst ! (Suc k)) &#8805; 2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;concat (drop (Suc k) ?elst) = ?elst ! (Suc k) @ concat (drop (Suc (Suc k)) ?elst)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>hide_lams</span><span class="delimiter">)</span><span> </span><span>Cons_nth_drop_Suc</span><span> </span><span>List.nth_tl</span><span> </span><span>concat.simps</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>drop_Suc</span><span> </span><span>length_tl</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop i esl = ?elst ! (Suc k) @ concat (drop (Suc (Suc k)) ?elst)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b0</span><span> </span><span>c0</span><span> </span><span>d2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl ! i = ?elst ! (Suc k) ! 0&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>hide_lams</span><span class="delimiter">)</span><span> </span><span>Cons_nth_drop_Suc</span><span> </span><span>One_nat_def</span><span> </span><span>Suc_1</span><span> 
</span><span>                      </span><span>less_or_eq_imp_le</span><span> </span><span>not_less</span><span> </span><span>not_less_eq_eq</span><span> </span><span>nth_Cons_0</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span>
</span><span>                  
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span>c0</span><span> </span><span>d2</span><span> </span><span>d3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl ! Suc i = ?elst ! (Suc k) ! 1&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>hide_lams</span><span class="delimiter">)</span><span> </span><span>Cons_nth_drop_Suc</span><span> </span><span>One_nat_def</span><span> 
</span><span>                    </span><span>Suc_1</span><span> </span><span>Suc_le_lessD</span><span> </span><span>Suc_lessD</span><span> </span><span>nth_Cons_0</span><span> </span><span>nth_Cons_Suc</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc k &lt; length ?elst&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc k = length ?elst - 1&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc k = length ?elst - 1&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl ! i = (last ?elst) ! 0&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>a0</span><span> </span><span>b01</span><span> </span><span>concat.simps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>last_conv_nth</span><span class="delimiter">)</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>e0</span><span> </span><span>d4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl ! Suc i = (last ?elst) ! 1&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>a0</span><span> </span><span>b01</span><span> </span><span>concat.simps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>d5</span><span> </span><span>last_conv_nth</span><span class="delimiter">)</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length (last ?elst) &#10230; (&#8707;t. &#915; &#8866; (last ?elst)!i -es-t&#8594; (last ?elst)!(Suc i)) 
                          &#10230; (gets_es ((last ?elst)!i), gets_es ((last ?elst)!Suc i)) &#8712; Guar m&quot;</span></span></span><span> 
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>commit_es_def</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b1</span><span> </span><span>e1</span><span> </span><span>e2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (esl ! i), gets_es (esl ! Suc i)) &#8712; Guar m&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>One_nat_def</span><span> </span><span>Suc_1</span><span> </span><span>Suc_le_lessD</span><span> </span><span>a0</span><span> </span><span>b01</span><span> </span><span>concat.simps</span><span class="delimiter">(</span><span>1</span><span class="delimiter">)</span><span> </span><span>d2</span><span> </span><span>e0</span><span> </span><span>last_conv_nth</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p3</span><span> </span><span>a4</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc k &#8800; length ?elst - 1&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc k &lt; length ?elst - 1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?els&#39;</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?elst!(Suc k)@[(?elst!Suc (Suc k))!0]&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>e0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc (Suc k) &lt; length ?elst&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;m&#8712;es. ?els&#39;&#8712;commit_es &#915; (Guar m,Post m)&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>m</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>e1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m&#8712;es &#8743; ?els&#39;&#8712;commit_es &#915; (Guar m,Post m)&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length ?els&#39; &#10230; (&#8707;t. &#915; &#8866; ?els&#39;!i -es-t&#8594; ?els&#39;!(Suc i)) 
                                  &#10230; (gets_es (?els&#39;!i), gets_es (?els&#39;!Suc i)) &#8712; Guar m&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>commit_es_def</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl ! i = ?els&#39; ! 0&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Suc_le_eq</span><span> </span><span>d2</span><span> </span><span>dual_order.strict_trans</span><span> </span><span>lessI</span><span> </span><span>nth_append</span><span> </span><span>numeral_2_eq_2</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl ! Suc i = ?els&#39; ! 1&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Suc_1</span><span> </span><span>Suc_le_lessD</span><span> </span><span>d2</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b1</span><span> </span><span>e3</span><span> </span><span>e4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;t. &#915; &#8866; ?els&#39;!0 -es-t&#8594; ?els&#39;!1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length ?els&#39; &gt; 1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>d2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>e2</span><span> </span><span>e5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (?els&#39;!0), gets_es (?els&#39;!1)) &#8712; Guar m&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>e3</span><span> </span><span>e4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (esl ! i), gets_es (esl ! Suc i)) &#8712; Guar m&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p3</span><span> </span><span>e1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d00</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j &#8800; length (?elst!k)&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j &lt; length (?elst!k)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl ! i = (?elst!k) ! j&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Cons_nth_drop_Suc</span><span> </span><span>Suc_lessD</span><span> </span><span>append_Cons</span><span> </span><span>b0</span><span> </span><span>list.inject</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span>b2</span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop (Suc i) esl = (drop (Suc j) (?elst!k)) @ concat (drop (Suc k) ?elst)&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>d00</span><span> </span><span>drop_Suc</span><span> </span><span>drop_eq_Nil</span><span> </span><span>le_antisym</span><span> </span><span>tl_append2</span><span> </span><span>tl_drop</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j = length (?elst!k) - 1&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j = length (?elst!k) - 1&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?els&#39;</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?elst!k@[(?elst!(Suc k))!0]&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d1</span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl ! i = last (?elst!k)&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>e0</span><span> </span><span>gr_implies_not0</span><span> </span><span>last_conv_nth</span><span> </span><span>length_0_conv</span><span class="delimiter">)</span><span> 
</span><span>                    
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b2</span><span> </span><span>e0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop (Suc i) esl = concat (drop (Suc k) ?elst)&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>d2</span><span class="delimiter">)</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop (Suc i) esl = ?elst!Suc k @ concat (drop (Suc (Suc k)) ?elst)&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Cons_nth_drop_Suc</span><span> </span><span>Suc_lessI</span><span> </span><span>c00</span><span> </span><span>b2</span><span> </span><span>concat.simps</span><span class="delimiter">(</span><span>2</span><span class="delimiter">)</span><span> </span><span>diff_Suc_1</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b3</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length (?elst ! (Suc k)) &#8805; 2&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>e3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl ! Suc i = ?elst!(Suc k)!0&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>One_nat_def</span><span> </span><span>Suc_1</span><span> </span><span>Suc_leD</span><span> 
</span><span>                        </span><span>Suc_n_not_le_n</span><span> </span><span>b0</span><span> </span><span>hd_append2</span><span> </span><span>hd_conv_nth</span><span> </span><span>hd_drop_conv_nth</span><span> </span><span>list.size</span><span class="delimiter">(</span><span>3</span><span class="delimiter">)</span><span class="delimiter">)</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>e0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl ! Suc i = ?els&#39; ! Suc j&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_pred&#39;</span><span> </span><span>d0</span><span> </span><span>gr_implies_not0</span><span> </span><span>linorder_neqE_nat</span><span> </span><span>nth_append_length</span><span class="delimiter">)</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>e0</span><span> </span><span>e1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl ! i = ?els&#39; ! j&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>d0</span><span> </span><span>d1</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span> 
</span><span>                    
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c0</span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;m&#8712;es. ?els&#39;&#8712;commit_es &#915; (Guar m,Post m)&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>m</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>e7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m&#8712;es &#8743; 
                          ?els&#39;&#8712;commit_es &#915; (Guar m,Post m)&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length ?els&#39; &#10230; (&#8707;t. &#915; &#8866; ?els&#39;!i -es-t&#8594; ?els&#39;!(Suc i)) 
                                  &#10230; (gets_es (?els&#39;!i), gets_es (?els&#39;!Suc i)) &#8712; Guar m&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>commit_es_def</span><span class="delimiter">)</span><span>
</span><span>                    
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b1</span><span> </span><span>e5</span><span> </span><span>e6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;t. &#915; &#8866; ?els&#39;!j -es-t&#8594; ?els&#39;!Suc j&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc j &lt; length ?els&#39;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>e0</span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>e8</span><span> </span><span>e9</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (?els&#39;!j), gets_es (?els&#39;!Suc j)) &#8712; Guar m&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>e5</span><span> </span><span>e6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (esl ! i), gets_es (esl ! Suc i)) &#8712; Guar m&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p3</span><span> </span><span>e7</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j &#8800; length (?elst!k) - 1&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e00</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;j &lt; length (?elst!k) - 1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b0</span><span> </span><span>d2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl ! Suc i = (?elst!k) ! Suc j&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>List.nth_tl</span><span> </span><span>Suc_diff_Suc</span><span> </span><span>drop_Suc</span><span> 
</span><span>                          </span><span>drop_eq_Nil</span><span> </span><span>hd_conv_nth</span><span> </span><span>hd_drop_conv_nth</span><span> </span><span>leD</span><span> </span><span>length_drop</span><span> </span><span>length_tl</span><span> </span><span>nth_append</span><span> </span><span>zero_less_Suc</span><span class="delimiter">)</span><span> 
</span><span>                    
</span><span>                    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?els&#39;</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?elst!k@[(?elst!(Suc k))!0]&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c0</span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;m&#8712;es. ?els&#39;&#8712;commit_es &#915; (Guar m,Post m)&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>m</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>e2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m&#8712;es &#8743; ?els&#39;&#8712;commit_es &#915; (Guar m,Post m)&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length ?els&#39; &#10230; (&#8707;t. &#915; &#8866; ?els&#39;!i -es-t&#8594; ?els&#39;!(Suc i)) 
                                  &#10230; (gets_es (?els&#39;!i), gets_es (?els&#39;!Suc i)) &#8712; Guar m&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>commit_es_def</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d1</span><span> </span><span>e00</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl ! i = ?els&#39; ! j&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>d0</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>e1</span><span> </span><span>e00</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl ! Suc i = ?els&#39; ! Suc j&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Suc_lessI</span><span> </span><span>nth_append</span><span class="delimiter">)</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b1</span><span> </span><span>e5</span><span> </span><span>e4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;t. &#915; &#8866; ?els&#39;!j -es-t&#8594; ?els&#39;!Suc j&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc j &lt; length ?els&#39;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>e00</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>e3</span><span> </span><span>e4</span><span> </span><span>e6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (?els&#39;!j), gets_es (?els&#39;!Suc j)) &#8712; Guar m&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>e4</span><span> </span><span>e5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (esl ! i), gets_es (esl ! Suc i)) &#8712; Guar m&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p3</span><span> </span><span>e2</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>    
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>EventSys_sound</span><span> </span><span class="delimiter">:</span><span> 
</span><span>    </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;&#8704;ef&#8712;es. &#915; &#8872; ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre ef, Rely ef, Guar ef, Post ef];
     &#8704;ef&#8712;es. pre &#8838; Pre ef;  &#8704;ef&#8712;es. rely &#8838; Rely ef;
     &#8704;ef&#8712;es. Guar ef &#8838; guar; &#8704;ef&#8712;es. Post ef &#8838; post;
     &#8704;ef1 ef2. ef1&#8712;es &#8743; ef2&#8712;es &#10230; Post ef1 &#8838; Pre ef2;
     stable_e pre rely; &#8704;s. (s, s)&#8712;guar &#10215;
      &#10233; &#915; &#8872; EvtSys es sat<span class="hidden">&#8681;</span><sub>s</sub> [pre, rely, guar, post]&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;es. &#915; &#8872; ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre ef, Rely ef, Guar ef, Post ef]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;es. pre &#8838; Pre ef&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;es. rely &#8838; Rely ef&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;es. Guar ef &#8838; guar&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;es. Post ef &#8838; post&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef1 ef2. ef1&#8712;es &#8743; ef2&#8712;es &#10230; Post ef1 &#8838; Pre ef2&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;stable_e pre rely&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s. (s, s)&#8712;guar&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s x. (cpts_of_es &#915; (EvtSys es) s x) &#8745; assume_es &#915; (pre, rely) &#8838; commit_es &#915; (guar, post)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>s</span><span> </span><span>x</span><span>
</span><span>        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;esl. esl&#8712;(cpts_of_es &#915; (EvtSys es) s x) &#8745; assume_es  &#915; (pre, rely) &#10230; esl&#8712; commit_es &#915; (guar, post)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>          </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>esl</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;(cpts_of_es &#915; (EvtSys es) s x) &#8745; assume_es &#915; (pre, rely)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;(cpts_of_es &#915; (EvtSys es) s x)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1_1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl!0 = (EvtSys es, s, x)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>cpts_of_es_def</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1_2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl &#8712; cpts_es &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>cpts_of_es_def</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;assume_es &#915; (pre, rely)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length esl &#10230; (&#8707;t. &#915; &#8866; esl!i -es-t&#8594; esl!(Suc i)) &#10230; 
                          (gets_es (esl!i), gets_es (esl!Suc i)) &#8712; guar&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>              </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length esl&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;t. &#915; &#8866; esl!i -es-t&#8594; esl!(Suc i)&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>t</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>b2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; esl!i -es-t&#8594; esl!(Suc i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a1_2</span><span> </span><span>b0</span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (esl!i), gets_es (esl!Suc i)) &#8712; guar&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &#8804; length esl &#10230; getspc_es (esl ! i) = EvtSys es&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &#8804; length esl &#10230; getspc_es (esl ! i) = EvtSys es&quot;</span></span></span><span>
</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl ! i) = EvtSys es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl ! (Suc i)) = EvtSys es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#8707;t. &#915; &#8866; esl!i -es-t&#8594; esl!(Suc i))&quot;</span></span></span><span> 
</span><span>                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtsys_not_eq_in_tran2</span><span> </span><span>getspc_es_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>surjective_pairing</span><span class="delimiter">)</span><span> 
</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172; (&#8704;i. Suc i &#8804; length esl &#10230; getspc_es (esl ! i) = EvtSys es)&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>m</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc m &#8804; length esl &#8743; getspc_es (esl ! m) &#8800; EvtSys es&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a1_1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl!0) = EvtSys es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>getspc_es_def</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;i. i &#8804; m &#8743; getspc_es (esl ! i) &#8800; EvtSys es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a1_2</span><span> </span><span>a1_1</span><span> </span><span>c1</span><span> </span><span>c2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;i. (i &lt; m &#8743; getspc_es (esl ! i) = EvtSys es 
                              &#8743; getspc_es (esl ! Suc i) &#8800; EvtSys es) 
                              &#8743; (&#8704;j. j &lt; i &#10230; getspc_es (esl ! j) = EvtSys es)&quot;</span></span></span><span> 
</span><span>                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtsys_fst_ent</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>n</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(n &lt; m &#8743; getspc_es (esl ! n) = EvtSys es 
                              &#8743; getspc_es (esl ! Suc n) &#8800; EvtSys es) 
                              &#8743; (&#8704;j. j &lt; n &#10230; getspc_es (esl ! j) = EvtSys es)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i &#8805; n&quot;</span></span></span><span> 
</span><span>                      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>                        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i &lt; n&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl ! i) = EvtSys es&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">moreover</span></span><span> </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c3</span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (esl ! Suc i) = EvtSys es&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_lessI</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#8707;t. &#915; &#8866; esl!i -es-t&#8594; esl!Suc i)&quot;</span></span></span><span> 
</span><span>                          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>evtsys_not_eq_in_tran</span><span> </span><span>getspc_es_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>surjective_pairing</span><span class="delimiter">)</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>False</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>leI</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?esl</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop n esl&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c1</span><span> </span><span>c3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length ?esl &#8805; 2&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>One_nat_def</span><span> </span><span>Suc_eq_plus1_left</span><span> </span><span>Suc_le_eq</span><span> </span><span>length_drop</span><span> 
</span><span>                          </span><span>less_diff_conv</span><span> </span><span>less_trans_Suc</span><span> </span><span>numeral_2_eq_2</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c1</span><span> </span><span>c3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;getspc_es (?esl!0) = EvtSys es &#8743; getspc_es (?esl!1) &#8800; EvtSys es&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>                    
</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a1_2</span><span> </span><span>c1</span><span> </span><span>c3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl &#8712; cpts_es &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_es_dropi</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>b0</span><span> </span><span>c4</span><span> </span><span>drop_0</span><span> </span><span>dual_order.strict_trans</span><span> 
</span><span>                            </span><span>le_0_eq</span><span> </span><span>le_SucE</span><span> </span><span>le_imp_less_Suc</span><span> </span><span>zero_induct</span><span class="delimiter">)</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c5</span><span> </span><span>c6</span><span> </span><span>c7</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;s x ev s1 x1 xs. ?esl = (EvtSys es, s, x) # (EvtSeq ev (EvtSys es), s1,x1) # xs&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>fst_esys_snd_eseq_exist</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>s</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>e</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>s1</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>x1</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>xs</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>c8</span><span class="delimiter">:</span><span>
</span><span>                        </span><span class="string"><span class="delete"><span class="delete">&quot;?esl = (EvtSys es, s, x) # (EvtSeq e (EvtSys es), s1,x1) # xs&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    
</span><span>                    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?elst</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;tl (parse_es_cpts_i2 ?esl es [[]])&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c8</span><span> </span><span>c7</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;concat ?elst = ?esl&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>parse_es_cpts_i2_concat3</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>metis</span><span>           
</span><span>                    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl&#8712;assume_es &#915; (pre,rely)&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;n = 0&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;n = 0&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl = esl&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a2</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;n &#8800; 0&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?eslh</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;take (n + 1) esl&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length ?esl &#10230; &#915; &#8866; ?esl!i -ese&#8594; ?esl!(Suc i) 
                          &#10230; (gets_es (?esl!i), gets_es (?esl!Suc i)) &#8712; rely&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_es_def</span><span class="delimiter">)</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (?esl!0) &#8712; pre&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span> 
</span><span>                            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a2</span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (?eslh!0) &#8712; pre&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_es_def</span><span class="delimiter">)</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length ?eslh &#10230; &#915; &#8866; ?eslh!i -ese&#8594; ?eslh!(Suc i) 
                              &#10230; (gets_es (?eslh!i), gets_es (?eslh!Suc i)) &#8712; rely&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_es_def</span><span class="delimiter">)</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?eslh &#8712; assume_es &#915; (pre, rely)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_es_def</span><span class="delimiter">)</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>c3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length ?eslh. getspc_es (?eslh!i) = EvtSys es&quot;</span></span></span><span>
</span><span>                              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_eq_plus1</span><span> </span><span>length_take</span><span> </span><span>less_antisym</span><span> </span><span>min_less_iff_conj</span><span> </span><span>nth_take</span><span class="delimiter">)</span><span> 
</span><span>                            </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&lt;length ?eslh. gets_es (?eslh!i) &#8712; pre&quot;</span></span></span><span> 
</span><span>                              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>p6</span><span> </span><span>pre_trans</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (?eslh ! n) &#8712; pre&quot;</span></span></span><span>
</span><span>                              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>b0</span><span> </span><span>c4</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>c8</span><span> </span><span>nth_via_drop</span><span class="delimiter">)</span><span> 
</span><span>                          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_es_def</span><span class="delimiter">)</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                    
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>p3</span><span> </span><span>p4</span><span> </span><span>p5</span><span> </span><span>p6</span><span> </span><span>p7</span><span> </span><span>c7</span><span> </span><span>c8</span><span> </span><span>c10</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c11</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length ?esl &#10230; (&#8707;t. &#915; &#8866; ?esl!i -es-t&#8594; ?esl!(Suc i)) &#10230; 
                          (gets_es (?esl!i), gets_es (?esl!Suc i)) &#8712; guar&quot;</span></span></span><span> 
</span><span>                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>EventSys_sound_0</span><span> 
</span><span>                          </span><span class="delimiter">[</span><span>of</span><span> </span><span>es</span><span> </span><span>&#915;</span><span> </span><span>Pre</span><span> </span><span>Rely</span><span> </span><span>Guar</span><span> </span><span>Post</span><span> </span><span>pre</span><span> </span><span>rely</span><span> </span><span>guar</span><span> </span><span>post</span><span> </span><span class="var">?esl</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>e</span><span> </span><span>s1</span><span> </span><span>x1</span><span> </span><span>xs</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span>c4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c12</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl ! i = ?esl ! (i - n)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span>c4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c13</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl ! Suc i = ?esl ! Suc (i - n)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span>c4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc (i - n) &lt; length ?esl&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b1</span><span> </span><span>c12</span><span> </span><span>c13</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;t. &#915; &#8866; ?esl ! (i - n) -es-t&#8594; ?esl ! Suc (i - n)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">ultimately</span></span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (?esl ! (i - n)), gets_es (?esl ! Suc (i - n))) &#8712; guar&quot;</span></span></span><span> 
</span><span>                      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>c11</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                    
</span><span>                    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>c12</span><span> </span><span>c13</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                    
</span><span>              </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;commit_es &#915; (guar, post)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>commit_es_def</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>        
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8872; EvtSys es sat<span class="hidden">&#8681;</span><sub>s</sub> [pre, rely, guar, post]&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>es_validity_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>esys_seq_sound</span><span class="delimiter">:</span><span> 
</span><span>      </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;pre &#8838; pre&#39;; rely &#8838; rely&#39;; guar&#39; &#8838; guar; post&#39; &#8838; post;
       &#915; &#8872; esys sat<span class="hidden">&#8681;</span><sub>s</sub> [pre&#39;, rely&#39;, guar&#39;, post&#39;]&#10215; 
    &#10233; &#915; &#8872; esys sat<span class="hidden">&#8681;</span><sub>s</sub> [pre, rely, guar, post]&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;pre &#8838; pre&#39;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rely &#8838; rely&#39;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;guar&#39; &#8838; guar&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;post&#39; &#8838; post&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8872; esys sat<span class="hidden">&#8681;</span><sub>s</sub> [pre&#39;, rely&#39;, guar&#39;, post&#39;]&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s x. (cpts_of_es &#915; esys s x) &#8745; assume_es &#915; (pre&#39;, rely&#39;) &#8838; commit_es &#915; (guar&#39;, post&#39;)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>es_validity_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s x. (cpts_of_es &#915; esys s x) &#8745; assume_es &#915; (pre, rely) &#8838; commit_es &#915; (guar, post)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>c</span><span> </span><span>s</span><span> </span><span>x</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;(cpts_of_es &#915; esys s x) &#8745; assume_es &#915; (pre, rely)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;(cpts_of_es &#915; esys s x) &#8743; c&#8712;assume_es &#915; (pre, rely)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;(cpts_of_es &#915; esys s x) &#8743; c&#8712;assume_es &#915; (pre&#39;, rely&#39;)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assume_es_imp</span><span class="delimiter">[</span><span>of</span><span> </span><span>pre</span><span> </span><span>pre&#39;</span><span> </span><span>rely</span><span> </span><span>rely&#39;</span><span> </span><span>c</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;commit_es &#915; (guar&#39;, post&#39;)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p2</span><span> </span><span>p3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;commit_es &#915; (guar, post)&quot;</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>commit_es_imp</span><span class="delimiter">[</span><span>of</span><span> </span><span>guar&#39;</span><span> </span><span>guar</span><span> </span><span>post&#39;</span><span> </span><span>post</span><span> </span><span>c</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>es_validity_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>EventSys_sound&#39;</span><span class="delimiter">:</span><span> 
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;esf. &#915; &#8866; E<span class="hidden">&#8681;</span><sub>e</sub> ef sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre<span class="hidden">&#8681;</span><sub>e</sub> ef, Rely<span class="hidden">&#8681;</span><sub>e</sub> ef, Guar<span class="hidden">&#8681;</span><sub>e</sub> ef, Post<span class="hidden">&#8681;</span><sub>e</sub> ef]&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;esf. pre &#8838; Pre<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;esf. rely &#8838;  Rely<span class="hidden">&#8681;</span><sub>e</sub> ef&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;esf. Guar<span class="hidden">&#8681;</span><sub>e</sub> ef &#8838; guar&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;esf. Post<span class="hidden">&#8681;</span><sub>e</sub> ef &#8838; post&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef1 ef2. ef1&#8712;esf &#8743; ef2&#8712;esf &#10230; Post<span class="hidden">&#8681;</span><sub>e</sub> ef1 &#8838; Pre<span class="hidden">&#8681;</span><sub>e</sub> ef2&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;stable_e pre rely&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s. (s, s) &#8712; guar&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8872; evtsys_spec (rgf_EvtSys esf) sat<span class="hidden">&#8681;</span><sub>s</sub> [pre, rely, guar, post]&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?es</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Domain esf&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?RG</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#955;e. SOME rg. (e,rg)&#8712;esf&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;e&#8712;?es. &#8707;ef&#8712;esf. ?RG e = snd ef&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Domain.cases</span><span> </span><span>snd_conv</span><span> </span><span>someI</span><span class="delimiter">)</span><span> 
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?Pre</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;pre_rgf &#8728; ?RG&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?Rely</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rely_rgf &#8728; ?RG&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?Guar</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;guar_rgf &#8728; ?RG&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?Post</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;post_rgf &#8728; ?RG&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i&#8712;esf. &#915; &#8872; E<span class="hidden">&#8681;</span><sub>e</sub> i sat<span class="hidden">&#8681;</span><sub>e</sub> [Pre<span class="hidden">&#8681;</span><sub>e</sub> i, Rely<span class="hidden">&#8681;</span><sub>e</sub> i, Guar<span class="hidden">&#8681;</span><sub>e</sub> i, Post<span class="hidden">&#8681;</span><sub>e</sub> i]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>rgsound_e</span><span class="delimiter">)</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;?es. &#915; &#8872; ef sat<span class="hidden">&#8681;</span><sub>e</sub> [?Pre ef, ?Rely ef, ?Guar ef, ?Post ef]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>mono_tags</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Domain.cases</span><span> </span><span>E<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Guar<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Post<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> 
</span><span>          </span><span>Pre<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Rely<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>a2</span><span> </span><span>comp_apply</span><span> </span><span>fst_conv</span><span> </span><span>snd_conv</span><span> </span><span>someI_ex</span><span class="delimiter">)</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;?es. pre &#8838; ?Pre ef&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Pre<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>a1</span><span> </span><span>comp_def</span><span> </span><span>p1</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;?es. rely &#8838; ?Rely ef&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Rely<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>a1</span><span> </span><span>comp_apply</span><span> </span><span>p2</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;?es. ?Guar ef &#8838; guar&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Guar<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>a1</span><span> </span><span>comp_apply</span><span> </span><span>p3</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef&#8712;?es. ?Post ef &#8838; post&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Post<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>a1</span><span> </span><span>comp_apply</span><span> </span><span>p4</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;ef1 ef2. ef1 &#8712; ?es &#8743; ef2 &#8712; ?es &#10230; ?Post ef1 &#8838; ?Pre ef2&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>mono_tags</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>Post<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Pre<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>a1</span><span> </span><span>comp_def</span><span> </span><span>p5</span><span class="delimiter">)</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8872; EvtSys (Domain esf) sat<span class="hidden">&#8681;</span><sub>s</sub> [pre, rely, guar, post]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>p6</span><span> </span><span>p7</span><span> </span><span>EventSys_sound</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span class="var">?es</span><span> </span><span>&#915;</span><span> </span><span class="var">?Pre</span><span> </span><span class="var">?Rely</span><span> </span><span class="var">?Guar</span><span> </span><span class="var">?Post</span><span> </span><span>pre</span><span> </span><span>rely</span><span> </span><span>guar</span><span> </span><span>post</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8872; evtsys_spec (rgf_EvtSys esf) sat<span class="hidden">&#8681;</span><sub>s</sub> [pre, rely, guar, post]&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*declare [[show_types]]*)</span></span></span></span></span><span>
</span><span class="keyword1"><span class="command">theorem</span></span><span> </span><span>rgsound_es</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (esf::(&#39;l,&#39;k,&#39;s,&#39;prog) rgformula_ess) sat<span class="hidden">&#8681;</span><sub>s</sub> [pre, rely, guar, post] 
    &#10233; &#915; &#8872; evtsys_spec esf sat<span class="hidden">&#8681;</span><sub>s</sub> [pre, rely, guar, post]&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>erule</span><span> </span><span>rghoare_es.induct</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span class="delimiter">[</span><span>1</span><span class="delimiter">]</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>EventSeq_sound</span><span> </span><span>rgsound_e</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>smt</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>EventSys_sound&#39;</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>esys_seq_sound</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Soundness of Parallel Event Systems&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>conjoin_comm_imp_rely_n</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;&#8704;k. pre &#8838; Pre k; &#8704;k. rely &#8838; Rely k; 
    &#8704;k j. j&#8800;k &#10230; Guar j &#8838; Rely k;
    &#8704;k. cs k &#8712; commit_es &#915; (Guar k, Post k);
    c &#8712; cpts_of_pes &#915; pes s x; c&#8712;assume_pes &#915; (pre, rely); &#915; c &#8733; cs&#10215; &#10233;
    &#8704;n k. n &#8804; length (cs k) &#8743; n &gt; 0 &#10230; take n (cs k) &#8712; assume_es &#915; (Pre k, Rely k)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. pre &#8838; Pre k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. rely &#8838; Rely k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k j. j&#8800;k &#10230;  Guar j &#8838; Rely k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; cpts_of_pes &#915; pes s x&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; assume_pes &#915; (pre, rely)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; c &#8733; cs&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. cs k &#8712; commit_es &#915; (Guar k, Post k)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. length (cs k) = length c&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>conjoin_def</span><span> </span><span>same_length_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p4</span><span> </span><span>p6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. cs k &#8712; cpts_of_es &#915; (pes k) s x&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>conjoin_imp_cptses_k</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. cs k &#8712; cpts_es &#915; &#8743; cs k !0 = (pes k,s,x)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>cpts_of_es_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k j. j &lt; length c &#10230; gets (c!j) = gets_es ((cs k)!j)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>conjoin_def</span><span> </span><span>same_state_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>n</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. n &#8804; length (cs k) &#8743; n &gt; 0 &#10230; take n (cs k) &#8712; assume_es &#915; (Pre k, Rely k)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>n</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>m</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. m &#8804; length (cs k) &#8743; 0 &lt; m &#10230; take m (cs k) &#8712; assume_es &#915; (Pre k, Rely k)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>k</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc m &#8804; length (cs k) &#8743; 0 &lt; Suc m&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p7</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length (cs k) &gt; 0&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>cpts_es_not_empty</span><span> </span><span>cpts_of_es_def</span><span> </span><span>gr0I</span><span> </span><span>length_0_conv</span><span> </span><span>mem_Collect_eq</span><span class="delimiter">)</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length (cs k) = length c&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>conjoin_def</span><span> </span><span>same_length_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span>            </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?esl</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;take (Suc m) (cs k)&quot;</span></span></span><span>
</span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;take (Suc m) (cs k) &#8712; assume_es &#915; (Pre k, Rely k)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m = 0&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m = 0&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (take (Suc m) (cs k)!0) &#8712; Pre k&quot;</span></span></span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p6</span><span> </span><span>c2</span><span> </span><span>c3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets (c!0) = gets_es ((cs k)!0)&quot;</span></span></span><span> 
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>conjoin_def</span><span> </span><span>same_state_def</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets (c!0) &#8712; pre&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_pes_def</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>p1</span><span> </span><span>p8</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length (take (Suc m) (cs k)) = 1&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>One_nat_def</span><span> </span><span>c2</span><span> </span><span>gr0_implies_Suc</span><span> </span><span>length_take</span><span> </span><span>min_0R</span><span> </span><span>min_Suc_Suc</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>                </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length (take (Suc m) (cs k)) 
                      &#10230; &#915; &#8866; (take (Suc m) (cs k)) ! i -ese&#8594; (take (Suc m) (cs k)) ! Suc i 
                      &#10230; (gets_es ((take (Suc m) (cs k)) ! i), gets_es ((take (Suc m) (cs k)) ! Suc i)) &#8712; rely&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;assume_es &#915; (Pre k, Rely k) = {c. gets_es (c ! 0) &#8712; Pre k &#8743;
                      (&#8704;i. Suc i &lt; length c &#10230; &#915; &#8866; c ! i -ese&#8594; c ! Suc i 
                            &#10230; (gets_es (c ! i), gets_es (c ! Suc i)) &#8712; Rely k)}&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_es_def</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_neq_Zero</span><span> </span><span>less_one</span><span> </span><span>mem_Collect_eq</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &#8800; 0&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>dd0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &gt; 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b0</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>dd1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;take m (cs k) &#8712; assume_es &#915; (Pre k, Rely k)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (?esl ! 0) &#8712; Pre k&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p6</span><span> </span><span>c2</span><span> </span><span>c3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets (c!0) = gets_es ((cs k)!0)&quot;</span></span></span><span> 
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>conjoin_def</span><span> </span><span>same_state_def</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets (c!0) &#8712; pre&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_pes_def</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>p1</span><span> </span><span>p8</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length ?esl &#10230; 
                     &#915; &#8866; ?esl!i -ese&#8594; ?esl!(Suc i) &#10230; 
                     (gets_es (?esl!i), gets_es (?esl!Suc i)) &#8712; Rely k&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>                    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>                    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length ?esl&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; ?esl!i -ese&#8594; ?esl!Suc i&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl!i = (cs k)!i &#8743; ?esl!Suc i = (cs k)! Suc i&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p6</span><span> </span><span>c3</span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8707;t k. (&#915; &#8866; c!i -pes-(t&#9839;k)&#8594; c!Suc i) &#8743;
                              (&#8704;k t. (&#915; &#8866; c!i -pes-(t&#9839;k)&#8594; c!Suc i) &#10230; (&#915; &#8866; cs k!i -es-(t&#9839;k)&#8594; cs k! Suc i) &#8743;
                                      (&#8704;k&#39;. k&#39; &#8800; k &#10230; (&#915; &#8866; cs k&#39;!i -ese&#8594; cs k&#39;! Suc i))))
                              &#8744;
                              (&#915; &#8866; (c!i) -pese&#8594; (c!Suc i) &#8743; (&#8704;k. (&#915; &#8866; ((cs k)!i) -ese&#8594; ((cs k)! Suc i))))&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>conjoin_def</span><span> </span><span>compat_tran_def</span><span class="delimiter">)</span><span>
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; ((cs k)!i) -ese&#8594; ((cs k)! Suc i)&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>d2</span><span class="delimiter">)</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (?esl!i), gets_es (?esl!Suc i)) &#8712; Rely k&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>                        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;t k. (&#915; &#8866; c!i -pes-(t&#9839;k)&#8594; c!Suc i) &#8743;
                              (&#8704;k t. (&#915; &#8866; c!i -pes-(t&#9839;k)&#8594; c!Suc i) &#10230; (&#915; &#8866; cs k!i -es-(t&#9839;k)&#8594; cs k! Suc i) &#8743;
                                      (&#8704;k&#39;. k&#39; &#8800; k &#10230; (&#915; &#8866; cs k&#39;!i -ese&#8594; cs k&#39;! Suc i)))&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>ct</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>k&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>e1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915; &#8866; (c!i) -pes-(ct&#9839;k&#39;)&#8594; (c!Suc i)) &#8743;
                                    (&#915; &#8866; ((cs k&#39;)!i) -es-(ct&#9839;k&#39;)&#8594; ((cs k&#39;)! Suc i))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p6</span><span> </span><span>p8</span><span> </span><span>d0</span><span> </span><span>d5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k &#8800; k&#39;&quot;</span></span></span><span> 
</span><span>                          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>conjoin_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>c</span><span> </span><span>cs</span><span class="delimiter">]</span><span> </span><span>same_spec_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>c</span><span> </span><span>cs</span><span class="delimiter">]</span><span>
</span><span>                             </span><span>es_tran_not_etran1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>  
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>e0</span><span> </span><span>e1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; ((cs k)!i) -ese&#8594; ((cs k)! Suc i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (?esl!i) -ese&#8594; (?esl! Suc i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                          </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i &lt; m - 1&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>f0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i &lt; m - 1&quot;</span></span></span><span>
</span><span>                            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;take (Suc m) (cs k) ! i = take m (cs k) ! i&quot;</span></span></span><span>
</span><span>                              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>diff_less_Suc</span><span> </span><span>less_trans_Suc</span><span class="delimiter">)</span><span> 
</span><span>                            
</span><span>                            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>f0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;take (Suc m) (cs k) ! Suc i = take m (cs k) ! Suc i&quot;</span></span></span><span>
</span><span>                              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>d2</span><span> </span><span>gr_implies_not0</span><span> </span><span>nat_le_linear</span><span class="delimiter">)</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>dd1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length (take m (cs k)) &#10230; 
                                &#915; &#8866; (take m (cs k))!i -ese&#8594; (take m (cs k))!(Suc i) &#10230; 
                                (gets_es ((take m (cs k))!i), gets_es ((take m (cs k))!Suc i)) &#8712; Rely k&quot;</span></span></span><span>
</span><span>                              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_es_def</span><span class="delimiter">)</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>dd0</span><span> </span><span>f0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (take m (cs k) ! i), gets_es (take m (cs k) ! Suc i)) &#8712; Rely k&quot;</span></span></span><span>
</span><span>                              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>One_nat_def</span><span> </span><span>Suc_mono</span><span> </span><span>Suc_pred</span><span> </span><span>d0</span><span> </span><span>d1</span><span> </span><span>f1</span><span> </span><span>f2</span><span> </span><span>length_take</span><span> </span><span>min_less_iff_conj</span><span class="delimiter">)</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>f1</span><span> </span><span>f2</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                          </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                            </span><span class="keyword3"><span class="command">assume</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(i &lt; m - 1)&quot;</span></span></span><span>
</span><span>                            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i = m - 1&quot;</span></span></span><span>
</span><span>                              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>c0</span><span> </span><span>dd0</span><span> </span><span>less_antisym</span><span> </span><span>min.absorb2</span><span class="delimiter">)</span><span> 
</span><span>                            </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?esl2</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;take (Suc m) (cs k&#39;)&quot;</span></span></span><span>
</span><span>                            
</span><span>                            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span>c0</span><span> </span><span>dd0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;take m (cs k&#39;) &#8712; assume_es &#915; (Pre k&#39;, Rely k&#39;)&quot;</span></span></span><span>
</span><span>                              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_leD</span><span> </span><span>p8</span><span class="delimiter">)</span><span> 
</span><span>                            </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>e1</span><span> </span><span>f0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#915; &#8866; cs k&#39; ! (m-1) -ese&#8594; cs k&#39; !m)&quot;</span></span></span><span>
</span><span>                              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_pred&#39;</span><span> </span><span>dd0</span><span> </span><span>es_tran_not_etran1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>                            </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;take (Suc m) (cs k&#39;) &#8712; assume_es &#915; (Pre k&#39;, Rely k&#39;)&quot;</span></span></span><span> 
</span><span>                              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assume_es_one_more</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k&#39;&quot;</span></span></span><span> </span><span>&#915;</span><span> </span><span>m</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Pre k&#39;&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Rely k&#39;&quot;</span></span></span><span class="delimiter">]</span><span> </span><span>p8</span><span> </span><span>p9</span><span> </span><span>c0</span><span> </span><span>dd0</span><span>
</span><span>                              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Suc_le_eq</span><span class="delimiter">)</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p7</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k&#39; &#8712; cpts_of_es &#915; (pes k&#39;) s x&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p8</span><span> </span><span>c0</span><span> </span><span>dd0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl2&#8712;cpts_of_es &#915; (pes k&#39;) s x&quot;</span></span></span><span> 
</span><span>                              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_es_take</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k&#39;&quot;</span></span></span><span> </span><span>&#915;</span><span> </span><span>m</span><span class="delimiter">]</span><span> </span><span>cpts_of_es_def</span><span class="delimiter">[</span><span>of</span><span>  </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;pes k&#39;&quot;</span></span></span><span> </span><span>s</span><span> </span><span>x</span><span class="delimiter">]</span><span>
</span><span>                                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Suc_le_lessD</span><span class="delimiter">)</span><span> 
</span><span>                            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span>p8</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl2&#8712;commit_es &#915; (Guar k&#39;, Post k&#39;)&quot;</span></span></span><span> 
</span><span>                              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>commit_es_take_n</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc m&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k&#39;&quot;</span></span></span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Guar k&#39;&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Post k&#39;&quot;</span></span></span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length ?esl2 &#10230; 
                                          (&#8707;t. &#915; &#8866; ?esl2!i -es-t&#8594; ?esl2!(Suc i)) &#10230; 
                                          (gets_es (?esl2!i), gets_es (?esl2!Suc i)) &#8712; Guar k&#39;&quot;</span></span></span><span>
</span><span>                              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>commit_es_def</span><span class="delimiter">)</span><span>
</span><span>                            
</span><span>                            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p8</span><span> </span><span>e1</span><span> </span><span>f0</span><span> </span><span>c0</span><span> </span><span>dd0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (?esl2 ! (m-1)), gets_es (?esl2 ! m))&#8712;Guar k&#39;&quot;</span></span></span><span>
</span><span>                              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>One_nat_def</span><span> </span><span>Suc_pred</span><span> </span><span>diff_less_Suc</span><span> </span><span>length_take</span><span> </span><span>lessI</span><span> </span><span>min.absorb2</span><span> </span><span>nth_take</span><span class="delimiter">)</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p3</span><span> </span><span>p10</span><span> </span><span>c0</span><span> </span><span>f0</span><span> </span><span>e2</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>Suc_diff_1</span><span> </span><span>Suc_leD</span><span> </span><span>c3</span><span> </span><span>dd0</span><span> </span><span>le_less_linear</span><span> </span><span>not_less_eq_eq</span><span> </span><span>nth_take</span><span> </span><span>subsetCE</span><span class="delimiter">)</span><span>
</span><span>                          </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((&#915; &#8866; (c!i) -pese&#8594; (c!Suc i)) &#8743; (&#8704;k. (&#915; &#8866; ((cs k)!i) -ese&#8594; ((cs k)! Suc i))))&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length c &#10230; 
                                          &#915; &#8866; c!i -pese&#8594; c!(Suc i) &#10230; 
                                          (gets (c!i), gets (c!Suc i)) &#8712; rely&quot;</span></span></span><span>
</span><span>                           </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_pes_def</span><span class="delimiter">)</span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p8</span><span> </span><span>c0</span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length c&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets (c!i), gets (c!Suc i)) &#8712; rely&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>e0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets (c!i), gets (c!Suc i)) &#8712; Rely k&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p8</span><span> </span><span>p10</span><span> </span><span>c0</span><span> </span><span>d0</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_lessD</span><span> </span><span>e1</span><span> </span><span>d2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_es_def</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>conjoin_comm_imp_rely</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;&#8704;k. pre &#8838; Pre k; &#8704;k. rely &#8838; Rely k; 
    &#8704;k j. j&#8800;k &#10230; Guar j &#8838; Rely k;
    &#8704;k. cs k &#8712; commit_es &#915; (Guar k, Post k);
    c &#8712; cpts_of_pes &#915; pes s x; c&#8712;assume_pes &#915; (pre, rely); &#915; c &#8733; cs&#10215; &#10233;
    &#8704;k. (cs k) &#8712; assume_es &#915; (Pre k, Rely k)&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. pre &#8838; Pre k&quot;</span></span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. rely &#8838; Rely k&quot;</span></span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k j. j &#8800; k &#10230; Guar j &#8838; Rely k&quot;</span></span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. cs k &#8712; commit_es &#915; (Guar k, Post k)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; cpts_of_pes &#915; pes s x&quot;</span></span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; assume_pes &#915; (pre, rely)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; c &#8733; cs&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c &#8800; []&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a5</span><span> </span><span>cpts_of_pes_def</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a7</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. length (cs k) = length c&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>conjoin_def</span><span> </span><span>same_length_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>    </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>k</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(cs k) &#8712; assume_es &#915; (Pre k, Rely k)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span>a3</span><span> </span><span>a4</span><span> </span><span>a5</span><span> </span><span>a6</span><span> </span><span>a7</span><span> </span><span>p8</span><span> </span><span>f8</span><span> 
</span><span>      </span><span>conjoin_comm_imp_rely_n</span><span class="delimiter">[</span><span>of</span><span> </span><span>pre</span><span> </span><span>Pre</span><span> </span><span>rely</span><span> </span><span>Rely</span><span> </span><span>Guar</span><span> </span><span>cs</span><span> </span><span>&#915;</span><span> </span><span>Post</span><span> </span><span>c</span><span> </span><span>pes</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length (cs k)&quot;</span></span></span><span> </span><span>k</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>  </span><span class="keyword1"><span class="command">}</span></span><span>  
</span><span>  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>    
</span><span class="keyword1"><span class="command">qed</span></span><span> 
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cpts_es_sat_rely</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;&#8704;k. &#915; &#8872; (pes k) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre k, Rely k, Guar k, Post k]; 
        &#8704;k. pre &#8838; Pre k; 
        &#8704;k. rely &#8838; Rely k; 
        &#8704;k j. j&#8800;k &#10230; Guar j &#8838; Rely k;
        c &#8712; cpts_of_pes &#915; pes s x; c&#8712;assume_pes &#915; (pre, rely);
        &#915; c &#8733; cs; &#8704;k. cs k &#8712; cpts_of_es &#915; (pes k) s x&#10215; &#10233;
        &#8704;n k. n &#8804; length (cs k) &#8743; n &gt; 0 &#10230; take n (cs k)&#8712;assume_es &#915; (Pre k, Rely k)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. &#915; &#8872; (pes k) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre k, Rely k, Guar k, Post k]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. pre &#8838; Pre k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. rely &#8838; Rely k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k j. j&#8800;k &#10230;  Guar j &#8838; Rely k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; cpts_of_pes &#915; pes s x&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; assume_pes &#915; (pre, rely)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; c &#8733; cs&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. cs k &#8712; cpts_of_es &#915; (pes k) s x&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. length (cs k) = length c&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>conjoin_def</span><span> </span><span>same_length_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p7</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. cs k &#8712; cpts_es &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_of_es_def</span><span> </span><span>mem_Collect_eq</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p10</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k j. j &lt; length c &#10230; gets (c!j) = gets_es ((cs k)!j)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>conjoin_def</span><span> </span><span>same_state_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>n</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. n &#8804; length (cs k) &#8743; n &gt; 0 &#10230; take n (cs k)&#8712;assume_es &#915; (Pre k, Rely k)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>n</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword3"><span class="command">case</span></span><span> </span><span>0</span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">case</span></span><span> </span><span class="delimiter">(</span><span>Suc</span><span> </span><span>m</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. m &#8804; length (cs k) &#8743; 0 &lt; m &#10230; take m (cs k) &#8712; assume_es &#915; (Pre k, Rely k)&quot;</span></span></span><span>
</span><span>           
</span><span>          </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>k</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>c0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc m &#8804; length (cs k) &#8743; 0 &lt; Suc m&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p7</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length (cs k) &gt; 0&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>cpts_es_not_empty</span><span> </span><span>cpts_of_es_def</span><span> </span><span>gr0I</span><span> </span><span>length_0_conv</span><span> </span><span>mem_Collect_eq</span><span class="delimiter">)</span><span> 
</span><span>            </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>c3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length (cs k) = length c&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>conjoin_def</span><span> </span><span>same_length_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span>            </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?esl</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;take (Suc m) (cs k)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl &#8712; assume_es &#915; (Pre k, Rely k)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m = 0&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m = 0&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (take (Suc m) (cs k)!0) &#8712; Pre k&quot;</span></span></span><span> 
</span><span>                </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p6</span><span> </span><span>c2</span><span> </span><span>c3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets (c!0) = gets_es ((cs k)!0)&quot;</span></span></span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>conjoin_def</span><span> </span><span>same_state_def</span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets (c!0) &#8712; pre&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_pes_def</span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>p1</span><span> </span><span>p8</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length (take (Suc m) (cs k)) = 1&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>One_nat_def</span><span> </span><span>c2</span><span> </span><span>gr0_implies_Suc</span><span> </span><span>length_take</span><span> </span><span>min_0R</span><span> </span><span>min_Suc_Suc</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>              </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length (take (Suc m) (cs k)) 
                    &#10230; &#915; &#8866; (take (Suc m) (cs k)) ! i -ese&#8594; (take (Suc m) (cs k)) ! Suc i 
                    &#10230; (gets_es ((take (Suc m) (cs k)) ! i), gets_es ((take (Suc m) (cs k)) ! Suc i)) &#8712; rely&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>              </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;assume_es &#915; (Pre k, Rely k) = {c. gets_es (c ! 0) &#8712; Pre k &#8743;
                    (&#8704;i. Suc i &lt; length c &#10230; &#915; &#8866; c ! i -ese&#8594; c ! Suc i 
                          &#10230; (gets_es (c ! i), gets_es (c ! Suc i)) &#8712; Rely k)}&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_es_def</span><span class="delimiter">)</span><span>
</span><span>              </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_neq_Zero</span><span> </span><span>less_one</span><span> </span><span>mem_Collect_eq</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>            </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>              </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &#8800; 0&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>dd0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &gt; 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>              </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b0</span><span> </span><span>c0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>dd1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;take m (cs k) &#8712; assume_es &#915; (Pre k, Rely k)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>              
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (?esl ! 0) &#8712; Pre k&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p6</span><span> </span><span>c2</span><span> </span><span>c3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets (c!0) = gets_es ((cs k)!0)&quot;</span></span></span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>conjoin_def</span><span> </span><span>same_state_def</span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets (c!0) &#8712; pre&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_pes_def</span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>p1</span><span> </span><span>p8</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length ?esl &#10230; 
                   &#915; &#8866; ?esl!i -ese&#8594; ?esl!(Suc i) &#10230; 
                   (gets_es (?esl!i), gets_es (?esl!Suc i)) &#8712; Rely k&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>                </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>                  </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>                  </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>d0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length ?esl&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>d1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; ?esl!i -ese&#8594; ?esl!Suc i&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl!i = (cs k)!i &#8743; ?esl!Suc i = (cs k)! Suc i&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p6</span><span> </span><span>c3</span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8707;t k. (&#915; &#8866; c!i -pes-(t&#9839;k)&#8594; c!Suc i) &#8743;
                            (&#8704;k t. (&#915; &#8866; c!i -pes-(t&#9839;k)&#8594; c!Suc i) &#10230; (&#915; &#8866; cs k!i -es-(t&#9839;k)&#8594; cs k! Suc i) &#8743;
                                    (&#8704;k&#39;. k&#39; &#8800; k &#10230; (&#915; &#8866; cs k&#39;!i -ese&#8594; cs k&#39;! Suc i))))
                            &#8744;
                            ((&#915; &#8866; (c!i) -pese&#8594; (c!Suc i)) &#8743; (&#8704;k. (&#915; &#8866; ((cs k)!i) -ese&#8594; ((cs k)! Suc i))))&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>conjoin_def</span><span> </span><span>compat_tran_def</span><span class="delimiter">)</span><span>
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>d5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; ((cs k)!i) -ese&#8594; ((cs k)! Suc i)&quot;</span></span></span><span>
</span><span>                        </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>d2</span><span class="delimiter">)</span><span> 
</span><span>                  </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>d4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (?esl!i), gets_es (?esl!Suc i)) &#8712; Rely k&quot;</span></span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>                      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;t k. (&#915; &#8866; c!i -pes-(t&#9839;k)&#8594; c!Suc i) &#8743;
                            (&#8704;k t. (&#915; &#8866; c!i -pes-(t&#9839;k)&#8594; c!Suc i) &#10230; (&#915; &#8866; cs k!i -es-(t&#9839;k)&#8594; cs k! Suc i) &#8743;
                                    (&#8704;k&#39;. k&#39; &#8800; k &#10230; (&#915; &#8866; cs k&#39;!i -ese&#8594; cs k&#39;! Suc i)))&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>ct</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>k&#39;</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>e1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915; &#8866; (c!i) -pes-(ct&#9839;k&#39;)&#8594; (c!Suc i)) &#8743;
                                  (&#915; &#8866; ((cs k&#39;)!i) -es-(ct&#9839;k&#39;)&#8594; ((cs k&#39;)! Suc i))&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p6</span><span> </span><span>p8</span><span> </span><span>d0</span><span> </span><span>d5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;k &#8800; k&#39;&quot;</span></span></span><span> 
</span><span>                        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>conjoin_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>c</span><span> </span><span>cs</span><span class="delimiter">]</span><span> </span><span>same_spec_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>c</span><span> </span><span>cs</span><span class="delimiter">]</span><span>
</span><span>                           </span><span>es_tran_not_etran1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>e0</span><span> </span><span>e1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; ((cs k)!i) -ese&#8594; ((cs k)! Suc i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; (?esl!i) -ese&#8594; (?esl! Suc i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i &lt; m - 1&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>f0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i &lt; m - 1&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;take (Suc m) (cs k) ! i = take m (cs k) ! i&quot;</span></span></span><span>
</span><span>                            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>diff_less_Suc</span><span> </span><span>less_trans_Suc</span><span class="delimiter">)</span><span> 
</span><span>                          
</span><span>                          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>f0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;take (Suc m) (cs k) ! Suc i = take m (cs k) ! Suc i&quot;</span></span></span><span>
</span><span>                            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>d2</span><span> </span><span>gr_implies_not0</span><span> </span><span>nat_le_linear</span><span class="delimiter">)</span><span>
</span><span>                          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>dd1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length (take m (cs k)) &#10230; 
                              &#915; &#8866; (take m (cs k))!i -ese&#8594; (take m (cs k))!(Suc i) &#10230; 
                              (gets_es ((take m (cs k))!i), gets_es ((take m (cs k))!Suc i)) &#8712; Rely k&quot;</span></span></span><span>
</span><span>                            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_es_def</span><span class="delimiter">)</span><span>
</span><span>                          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>dd0</span><span> </span><span>f0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (take m (cs k) ! i), gets_es (take m (cs k) ! Suc i)) &#8712; Rely k&quot;</span></span></span><span>
</span><span>                            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>One_nat_def</span><span> </span><span>Suc_mono</span><span> </span><span>Suc_pred</span><span> </span><span>d0</span><span> </span><span>d1</span><span> </span><span>f1</span><span> </span><span>f2</span><span> </span><span>length_take</span><span> </span><span>min_less_iff_conj</span><span class="delimiter">)</span><span>
</span><span>                          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>f1</span><span> </span><span>f2</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                          </span><span class="keyword3"><span class="command">assume</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(i &lt; m - 1)&quot;</span></span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i = m - 1&quot;</span></span></span><span>
</span><span>                            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>c0</span><span> </span><span>dd0</span><span> </span><span>less_antisym</span><span> </span><span>min.absorb2</span><span class="delimiter">)</span><span> 
</span><span>                          </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?esl2</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;take (Suc m) (cs k&#39;)&quot;</span></span></span><span>
</span><span>                          
</span><span>                          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span>c0</span><span> </span><span>dd0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;take m (cs k&#39;) &#8712; assume_es &#915; (Pre k&#39;, Rely k&#39;)&quot;</span></span></span><span>
</span><span>                            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_leD</span><span> </span><span>p8</span><span class="delimiter">)</span><span> 
</span><span>                          </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>e1</span><span> </span><span>f0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#915; &#8866; cs k&#39; ! (m-1) -ese&#8594; cs k&#39; !m)&quot;</span></span></span><span>
</span><span>                            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_pred&#39;</span><span> </span><span>dd0</span><span> </span><span>es_tran_not_etran1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>                          </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;take (Suc m) (cs k&#39;) &#8712; assume_es &#915; (Pre k&#39;, Rely k&#39;)&quot;</span></span></span><span> 
</span><span>                            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assume_es_one_more</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k&#39;&quot;</span></span></span><span> </span><span>&#915;</span><span> </span><span>m</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Pre k&#39;&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Rely k&#39;&quot;</span></span></span><span class="delimiter">]</span><span> </span><span>p8</span><span> </span><span>p9</span><span> </span><span>c0</span><span> </span><span>dd0</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Suc_le_eq</span><span class="delimiter">)</span><span>
</span><span>                          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p7</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k&#39; &#8712; cpts_of_es &#915; (pes k&#39;) s x&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p8</span><span> </span><span>c0</span><span> </span><span>dd0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl2&#8712;cpts_of_es &#915; (pes k&#39;) s x&quot;</span></span></span><span> 
</span><span>                            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_es_take</span><span class="delimiter">[</span><span>of</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k&#39;&quot;</span></span></span><span> </span><span>&#915;</span><span> </span><span>m</span><span class="delimiter">]</span><span> </span><span>cpts_of_es_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;pes k&#39;&quot;</span></span></span><span> </span><span>s</span><span> </span><span>x</span><span class="delimiter">]</span><span>
</span><span>                              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Suc_le_lessD</span><span class="delimiter">)</span><span> 
</span><span>                          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>f3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8872; pes k&#39; sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre k&#39;, Rely k&#39;, Guar k&#39;, Post k&#39;] &quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>f1</span><span> </span><span>f2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl2&#8712;commit_es &#915; (Guar k&#39;, Post k&#39;)&quot;</span></span></span><span> 
</span><span>                            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>es_validity_def</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;pes k&#39;&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Pre k&#39;&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Rely k&#39;&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Guar k&#39;&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Post k&#39;&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>                              </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length ?esl2 &#10230; 
                                        (&#8707;t. &#915; &#8866; ?esl2!i -es-t&#8594; ?esl2!(Suc i)) &#10230; 
                                        (gets_es (?esl2!i), gets_es (?esl2!Suc i)) &#8712; Guar k&#39;&quot;</span></span></span><span>
</span><span>                            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>commit_es_def</span><span class="delimiter">)</span><span>
</span><span>                          
</span><span>                          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p8</span><span> </span><span>e1</span><span> </span><span>f0</span><span> </span><span>c0</span><span> </span><span>dd0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (?esl2 ! (m-1)), gets_es (?esl2 ! m))&#8712;Guar k&#39;&quot;</span></span></span><span>
</span><span>                            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>One_nat_def</span><span> </span><span>Suc_pred</span><span> </span><span>diff_less_Suc</span><span> </span><span>length_take</span><span> </span><span>lessI</span><span> </span><span>min.absorb2</span><span> </span><span>nth_take</span><span class="delimiter">)</span><span>
</span><span>                          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p3</span><span> </span><span>p10</span><span> </span><span>c0</span><span> </span><span>f0</span><span> </span><span>e2</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>smt</span><span> </span><span>Suc_diff_1</span><span> </span><span>Suc_leD</span><span> </span><span>c3</span><span> </span><span>dd0</span><span> </span><span>le_less_linear</span><span> </span><span>not_less_eq_eq</span><span> </span><span>nth_take</span><span> </span><span>subsetCE</span><span class="delimiter">)</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                    </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>e0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;((&#915; &#8866; (c!i) -pese&#8594; (c!Suc i)) &#8743; (&#8704;k. (&#915; &#8866; ((cs k)!i) -ese&#8594; ((cs k)! Suc i))))&quot;</span></span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length c &#10230; 
                                        &#915; &#8866; c!i -pese&#8594; c!(Suc i) &#10230; 
                                        (gets (c!i), gets (c!Suc i)) &#8712; rely&quot;</span></span></span><span>
</span><span>                         </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_pes_def</span><span class="delimiter">)</span><span> 
</span><span>                      </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>                      </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p8</span><span> </span><span>c0</span><span> </span><span>d0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>e1</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length c&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets (c!i), gets (c!Suc i)) &#8712; rely&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>e0</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets (c!i), gets (c!Suc i)) &#8712; Rely k&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>                      </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p8</span><span> </span><span>p10</span><span> </span><span>c0</span><span> </span><span>d0</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>                        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_lessD</span><span> </span><span>e1</span><span> </span><span>d2</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>              </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_es_def</span><span class="delimiter">)</span><span>
</span><span>            </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>                
</span><span>          </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?case</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>es_tran_sat_guar_aux</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;&#8704;k. &#915; &#8872; (pes k) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre k, Rely k, Guar k, Post k]; 
        &#8704;k. pre &#8838; Pre k; 
        &#8704;k. rely &#8838; Rely k; 
        &#8704;k j. j&#8800;k &#10230; Guar j &#8838; Rely k;
        c &#8712; cpts_of_pes &#915; pes s x; c&#8712;assume_pes &#915; (pre, rely);
        &#915; c &#8733; cs; &#8704;k. cs k &#8712; cpts_of_es &#915; (pes k) s x &#10215; 
        &#10233;&#8704;k i m. m &#8804; length c &#10230; Suc i &lt; length (take m (cs k)) &#10230; (&#8707;t.(&#915; &#8866; (take m (cs k))!i-es-t&#8594;((take m (cs k))!Suc i))) 
                &#10230; (gets_es ((take m (cs k))!i),gets_es ((take m (cs k))!Suc i)) &#8712; Guar k&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. &#915; &#8872; (pes k) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre k, Rely k, Guar k, Post k]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. pre &#8838; Pre k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. rely &#8838; Rely k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k j. j&#8800;k &#10230;  Guar j &#8838; Rely k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; cpts_of_pes &#915; pes s x&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; assume_pes &#915; (pre, rely)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; c &#8733; cs&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. cs k &#8712; cpts_of_es &#915; (pes k) s x&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. length (cs k) = length c&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>conjoin_def</span><span> </span><span>same_length_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>k</span><span> </span><span>i</span><span> </span><span>m</span><span>
</span><span>      </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &#8804; length c&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length (take m (cs k))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;t.(&#915; &#8866; (take m (cs k))!i-es-t&#8594;((take m (cs k))!Suc i))&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es ((take m (cs k))!i),gets_es ((take m (cs k))!Suc i)) &#8712; Guar k&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m = 0&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m = 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>          </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &#8800; 0&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &gt; 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>          </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?esl</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;take m (cs k)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p7</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k &#8712; cpts_of_es &#915; (pes k) s x&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k!0=(pes k,s,x) &#8743; cs k &#8712; cpts_es &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>cpts_of_es_def</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl!0=(pes k,s,x) &#8743; ?esl &#8712; cpts_es &#915;&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span>Suc_pred</span><span> </span><span>a0</span><span> </span><span>cpts_es_take</span><span> </span><span>leD</span><span> </span><span>not_less_eq</span><span> </span><span>nth_take</span><span> </span><span>p8</span><span class="delimiter">)</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl &#8712; cpts_of_es &#915; (pes k) s x&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>cpts_of_es_def</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>p3</span><span> </span><span>p4</span><span> </span><span>p5</span><span> </span><span>p6</span><span> </span><span>p7</span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;n. n &#8804; length (cs k) &#8743; n &gt; 0 &#10230; take n (cs k)&#8712;assume_es &#915; (Pre k, Rely k)&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_es_sat_rely</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>pes</span><span> </span><span>Pre</span><span> </span><span>Rely</span><span> </span><span>Guar</span><span> </span><span>Post</span><span> </span><span>pre</span><span> </span><span>rely</span><span> </span><span>c</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>cs</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p8</span><span> </span><span>a0</span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>r2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl&#8712;assume_es &#915; (Pre k, Rely k)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>          
</span><span>          </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(cpts_of_es &#915; (pes k) s x) &#8745; assume_es &#915; (Pre k, Rely k) &#8838; commit_es &#915; (Guar k, Post k)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>es_validity_def</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>r1</span><span> </span><span>r2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;?esl &#8712; commit_es &#915; (Guar k, Post k)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>IntI</span><span> </span><span>subsetCE</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>          </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length ?esl &#10230; 
               (&#8707;t. &#915; &#8866; ?esl!i -es-t&#8594; ?esl!(Suc i)) &#10230; (gets_es (?esl!i), gets_es (?esl!Suc i)) &#8712; Guar k&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>commit_es_def</span><span class="delimiter">)</span><span>
</span><span>          </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a1</span><span> </span><span>a2</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>es_tran_sat_guar</span><span class="delimiter">:</span><span> 
</span><span>      </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;&#8704;k. &#915; &#8872; (pes k) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre k, Rely k, Guar k, Post k]; 
        &#8704;k. pre &#8838; Pre k; 
        &#8704;k. rely &#8838; Rely k; 
        &#8704;k j. j&#8800;k &#10230;  Guar j &#8838; Rely k;
        c &#8712; cpts_of_pes &#915; pes s x; c&#8712;assume_pes &#915; (pre, rely);
        &#915; c &#8733; cs; &#8704;k. cs k &#8712; cpts_of_es &#915; (pes k) s x &#10215; 
        &#10233;&#8704;k i. Suc i &lt; length (cs k) &#10230; (&#8707;t.(&#915; &#8866; (cs k)!i-es-t&#8594;(cs k)!Suc i)) 
                &#10230; (gets_es ((cs k)!i),gets_es ((cs k)!Suc i)) &#8712; Guar k&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. &#915; &#8872; (pes k) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre k, Rely k, Guar k, Post k]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. pre &#8838; Pre k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. rely &#8838; Rely k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k j. j&#8800;k &#10230;  Guar j &#8838; Rely k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; cpts_of_pes &#915; pes s x&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; assume_pes &#915; (pre, rely)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; c &#8733; cs&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. cs k &#8712; cpts_of_es &#915; (pes k) s x&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k i m. m &#8804; length c &#10230; Suc i &lt; length (take m (cs k)) &#10230; (&#8707;t.(&#915; &#8866; (take m (cs k))!i-es-t&#8594;((take m (cs k))!Suc i))) 
                &#10230; (gets_es ((take m (cs k))!i),gets_es ((take m (cs k))!Suc i)) &#8712; Guar k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>es_tran_sat_guar_aux</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>pes</span><span> </span><span>Pre</span><span> </span><span>Rely</span><span> </span><span>Guar</span><span> </span><span>Post</span><span> </span><span>pre</span><span> </span><span>rely</span><span> </span><span>c</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>cs</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. length c = length (cs k)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>conjoin_def</span><span> </span><span>same_length_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>conjoin_es_sat_assume</span><span class="delimiter">:</span><span> 
</span><span>      </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;&#8704;k. &#915; &#8872; (pes k) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre k, Rely k, Guar k, Post k]; 
        &#8704;k. pre &#8838; Pre k; 
        &#8704;k. rely &#8838; Rely k; 
        &#8704;k j. j&#8800;k &#10230;  Guar j &#8838; Rely k;
        c &#8712; cpts_of_pes &#915; pes s x; c&#8712;assume_pes &#915; (pre, rely);
        &#915; c &#8733; cs; &#8704;k. cs k &#8712; cpts_of_es &#915; (pes k) s x &#10215; 
        &#10233; &#8704;k. cs k &#8712; assume_es &#915; (Pre k, Rely k)&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. &#915; &#8872; (pes k) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre k, Rely k, Guar k, Post k]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. pre &#8838; Pre k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. rely &#8838; Rely k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k j. j&#8800;k &#10230;  Guar j &#8838; Rely k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; cpts_of_pes &#915; pes s x&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; assume_pes &#915; (pre, rely)&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; c &#8733; cs&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. cs k &#8712; cpts_of_es &#915; (pes k) s x&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p6</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p11</span><span class="delimiter">[</span><span>rule_format</span><span class="delimiter">]</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. length (cs k) = length c&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>conjoin_def</span><span> </span><span>same_length_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p7</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p12</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. cs k &#8712; cpts_es &#915;&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_of_es_def</span><span> </span><span>mem_Collect_eq</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p11</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c &#8800; Nil&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>cpts_es_not_empty</span><span> </span><span>length_0_conv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p13</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length c &gt; 0&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>    </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>k</span><span>
</span><span>      </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cs k &#8712; assume_es &#915; (Pre k, Rely k)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>p3</span><span> </span><span>p4</span><span> </span><span>p5</span><span> </span><span>p6</span><span> </span><span>p7</span><span> </span><span>p13</span><span> </span><span>p11</span><span> 
</span><span>          </span><span>cpts_es_sat_rely</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>pes</span><span> </span><span>Pre</span><span> </span><span>Rely</span><span> </span><span>Guar</span><span> </span><span>Post</span><span> </span><span>pre</span><span> </span><span>rely</span><span> </span><span>c</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>cs</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length (cs k)&quot;</span></span></span><span> </span><span>k</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>force</span><span>
</span><span>    </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>pes_tran_sat_guar</span><span class="delimiter">:</span><span> 
</span><span>      </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;&#8704;k. &#915; &#8872; (pes k) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre k, Rely k, Guar k, Post k]; 
        &#8704;k. pre &#8838; Pre k; 
        &#8704;k. rely &#8838; Rely k; 
        &#8704;k j. j&#8800;k &#10230;  Guar j &#8838; Rely k;
        &#8704;k. Guar k &#8838; guar;
        c &#8712; cpts_of_pes &#915; pes s x; c&#8712;assume_pes &#915; (pre, rely)&#10215; 
        &#10233;&#8704;i. Suc i &lt; length c &#10230; (&#8707;t. &#915; &#8866; c!i -pes-t&#8594; c!(Suc i))
                &#10230; (gets (c!i),gets (c!Suc i)) &#8712; guar&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. &#915; &#8872; (pes k) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre k, Rely k, Guar k, Post k]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. pre &#8838; Pre k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. rely &#8838; Rely k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k j. j&#8800;k &#10230;  Guar j &#8838; Rely k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. Guar k &#8838; guar&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; cpts_of_pes &#915; pes s x&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;assume_pes &#915; (pre, rely)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length c&quot;</span></span></span><span>
</span><span>          </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;t. &#915; &#8866; c!i -pes-t&#8594; c!(Suc i)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;cs. (&#8704;k. (cs k) &#8712; cpts_of_es &#915; (pes k) s x) &#8743; &#915; c &#8733; cs&quot;</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>meson</span><span> </span><span>cpt_imp_exist_conjoin_cs</span><span class="delimiter">)</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>cs</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8704;k. (cs k) &#8712; cpts_of_es &#915; (pes k) s x) &#8743; &#915; c &#8733; cs&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;compat_tran &#915; c cs&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>conjoin_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8707;t k. (&#915; &#8866; c!i -pes-(t&#9839;k)&#8594; c!Suc i) &#8743;
                          (&#8704;k t. (&#915; &#8866; c!i -pes-(t&#9839;k)&#8594; c!Suc i) &#10230; (&#915; &#8866; cs k!i -es-(t&#9839;k)&#8594; cs k! Suc i) &#8743;
                                  (&#8704;k&#39;. k&#39; &#8800; k &#10230; (&#915; &#8866; cs k&#39;!i -ese&#8594; cs k&#39;! Suc i))))
                          &#8744;
                          ((&#915; &#8866; (c!i) -pese&#8594; (c!Suc i)) &#8743; (&#8704;k. (&#915; &#8866; ((cs k)!i) -ese&#8594; ((cs k)! Suc i))))&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>compat_tran_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#915; &#8866; (c!i) -pese&#8594; (c!Suc i))&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>pes_tran_not_etran1</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>blast</span><span> 
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8707;t k. (&#915; &#8866; c!i -pes-(t&#9839;k)&#8594; c!Suc i) &#8743;
                          (&#8704;k t. (&#915; &#8866; c!i -pes-(t&#9839;k)&#8594; c!Suc i) &#10230; (&#915; &#8866; cs k!i -es-(t&#9839;k)&#8594; cs k! Suc i) &#8743;
                                  (&#8704;k&#39;. k&#39; &#8800; k &#10230; (&#915; &#8866; cs k&#39;!i -ese&#8594; cs k&#39;! Suc i)))&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">obtain</span></span><span> </span><span>t</span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>k</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>a4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#915; &#8866; c!i -pes-(t&#9839;k)&#8594; c!Suc i) &#8743;
                          (&#8704;k t. (&#915; &#8866; c!i -pes-(t&#9839;k)&#8594; c!Suc i) &#10230; (&#915; &#8866; cs k!i -es-(t&#9839;k)&#8594; cs k! Suc i) &#8743;
                                  (&#8704;k&#39;. k&#39; &#8800; k &#10230; (&#915; &#8866; cs k&#39;!i -ese&#8594; cs k&#39;! Suc i)))&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>p3</span><span> </span><span>p4</span><span> </span><span>p5</span><span> </span><span>p6</span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span>
</span><span>          </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k i. Suc i &lt; length (cs k) &#10230; (&#8707;t.(&#915; &#8866; (cs k)!i-es-t&#8594;(cs k)!Suc i)) 
                &#10230; (gets_es ((cs k)!i),gets_es ((cs k)!Suc i)) &#8712; Guar k&quot;</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>es_tran_sat_guar</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>pes</span><span> </span><span>Pre</span><span> </span><span>Rely</span><span> </span><span>Guar</span><span> </span><span>Post</span><span> </span><span>pre</span><span> </span><span>rely</span><span> </span><span>c</span><span> </span><span>s</span><span> </span><span>x</span><span> </span><span>cs</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i &lt; length (cs k) &#10230; (&#8707;t.(&#915; &#8866; (cs k)!i-es-t&#8594;(cs k)!Suc i)) 
                &#10230; (gets_es ((cs k)!i),gets_es ((cs k)!Suc i)) &#8712; Guar k&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a6</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;length c = length (cs k)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>conjoin_def</span><span> </span><span>same_length_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a0</span><span> </span><span>a4</span><span> </span><span>a5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a7</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es ((cs k)!i),gets_es ((cs k)!Suc i)) &#8712; Guar k&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a8</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es ((cs k)!i) = gets (c!i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>conjoin_def</span><span> </span><span>same_state_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>a0</span><span> </span><span>a2</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a9</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es ((cs k)!Suc i) = gets (c!Suc i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>conjoin_def</span><span> </span><span>same_state_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a7</span><span> </span><span>a8</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets (c!i),gets (c!Suc i)) &#8712; Guar k&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets (c!i),gets (c!Suc i)) &#8712; guar&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword3"><span class="command">thus</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>parallel_sound</span><span class="delimiter">:</span><span> 
</span><span>      </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;&#8704;k. &#915; &#8872; (pes k) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre k, Rely k, Guar k, Post k]; 
        &#8704;k. pre &#8838; Pre k; 
        &#8704;k. rely &#8838; Rely k; 
        &#8704;k j. j&#8800;k &#10230;  Guar j &#8838; Rely k;
        &#8704;k. Guar k &#8838; guar;
        &#8704;k. Post k &#8838; post&#10215; 
    &#10233; &#915; &#8872; pes SAT [pre, rely, guar, post]&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. &#915; &#8872; (pes k) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre k, Rely k, Guar k, Post k]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. pre &#8838; Pre k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. rely &#8838; Rely k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k j. j&#8800;k &#10230;  Guar j &#8838; Rely k&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. Guar k &#8838; guar&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. Post k &#8838; post&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s x. (cpts_of_pes &#915; pes s x) &#8745; assume_pes &#915; (pre, rely) &#8838; commit_pes &#915; (guar, post)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>c</span><span> </span><span>s</span><span> </span><span>x</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;(cpts_of_pes &#915; pes s x) &#8745; assume_pes &#915; (pre, rely)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;(cpts_of_pes &#915; pes s x) &#8743; c&#8712;assume_pes &#915; (pre, rely)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>p3</span><span> </span><span>p4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length c &#10230; (&#8707;t. &#915; &#8866; c!i -pes-t&#8594; c!(Suc i))
            &#10230; (gets (c!i),gets (c!Suc i)) &#8712; guar&quot;</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>pes_tran_sat_guar</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>pes</span><span> </span><span>Pre</span><span> </span><span>Rely</span><span> </span><span>Guar</span><span> </span><span>Post</span><span> </span><span>pre</span><span> </span><span>rely</span><span> </span><span>guar</span><span> </span><span>c</span><span> </span><span>s</span><span> </span><span>x</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;commit_pes &#915; (guar, post)&quot;</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>commit_pes_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>pes_validity_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>parallel_seq_sound</span><span class="delimiter">:</span><span> 
</span><span>      </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;pre &#8838; pre&#39;; rely &#8838; rely&#39;; guar&#39; &#8838; guar; post&#39; &#8838; post;
        &#915; &#8872; pes SAT [pre&#39;, rely&#39;, guar&#39;, post&#39;]&#10215; 
    &#10233; &#915; &#8872; pes SAT [pre, rely, guar, post]&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;pre &#8838; pre&#39;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rely &#8838; rely&#39;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;guar&#39; &#8838; guar&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;post&#39; &#8838; post&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8872; pes SAT [pre&#39;, rely&#39;, guar&#39;, post&#39;]&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p4</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>p5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s x. (cpts_of_pes &#915; pes s x) &#8745; assume_pes &#915; (pre&#39;, rely&#39;) &#8838; commit_pes &#915; (guar&#39;, post&#39;)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>pes_validity_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s x. (cpts_of_pes &#915; pes s x) &#8745; assume_pes &#915; (pre, rely) &#8838; commit_pes &#915; (guar, post)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>c</span><span> </span><span>s</span><span> </span><span>x</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;(cpts_of_pes &#915; pes s x) &#8745; assume_pes &#915; (pre, rely)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;(cpts_of_pes &#915; pes s x) &#8743; c&#8712;assume_pes &#915; (pre, rely)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p0</span><span> </span><span>p1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;(cpts_of_pes &#915; pes s x) &#8743; c&#8712;assume_pes &#915; (pre&#39;, rely&#39;)&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>assume_pes_imp</span><span class="delimiter">[</span><span>of</span><span> </span><span>pre</span><span> </span><span>pre&#39;</span><span> </span><span>rely</span><span> </span><span>rely&#39;</span><span> </span><span>c</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p5</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;commit_pes &#915; (guar&#39;, post&#39;)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p2</span><span> </span><span>p3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;commit_pes &#915; (guar, post)&quot;</span></span></span><span> 
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>commit_pes_imp</span><span class="delimiter">[</span><span>of</span><span> </span><span>guar&#39;</span><span> </span><span>guar</span><span> </span><span>post&#39;</span><span> </span><span>post</span><span> </span><span>c</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>pes_validity_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>parallel_sound&#39;</span><span class="delimiter">:</span><span> 
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. &#915; &#8866; fst ((pes::&#39;k &#8658; (&#39;l,&#39;k,&#39;s,&#39;prog) rgformula_es) k) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k), Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k), Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k), Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k)]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. pre &#8838; Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. rely &#8838; Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k j. j &#8800; k &#10230; Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes j) &#8838; Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k) &#8838; guar&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p5</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k) &#8838; post&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">shows</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8872; paresys_spec pes SAT [pre, rely, guar, post]&quot;</span></span></span><span> 
</span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;k. &#915; &#8872; evtsys_spec (fst (pes k)) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k), Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k), Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k), Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k)]&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>k</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; &#915; &#8866; fst (pes k) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k), Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k), Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k), Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k)]&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>        </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; &#915; &#8872; evtsys_spec (fst (pes k)) sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k), Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k), Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k), Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k)]&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>rgsound_es</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;fst (pes k)&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k)&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k)&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k)&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (pes k)&quot;</span></span></span><span class="delimiter">]</span><span>
</span><span>            </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>p3</span><span> </span><span>p4</span><span> </span><span>p5</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8872; paresys_spec pes SAT [pre, rely, guar, post]&quot;</span></span></span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>parallel_sound</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;paresys_spec pes&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>&#8728;pes&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>&#8728;pes&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>&#8728;pes&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>&#8728;pes&quot;</span></span></span><span>
</span><span>            </span><span>pre</span><span> </span><span>rely</span><span> </span><span>guar</span><span> </span><span>post</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>paresys_spec_def</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">theorem</span></span><span> </span><span>rgsound_pes</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; rgf_par SAT [pre, rely, guar, post] &#10233; &#915; &#8872; paresys_spec rgf_par SAT [pre, rely, guar, post]&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>erule</span><span> </span><span>rghoare_pes.induct</span><span class="delimiter">)</span><span>
</span><span>  
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>parallel_sound&#39;</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>blast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>parallel_seq_sound</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>blast</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span><span>
</span></pre>

</div>
</body>
</html>
