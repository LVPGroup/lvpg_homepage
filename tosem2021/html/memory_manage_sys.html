<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Theory memory_manage_sys (Isabelle2018: August 2018)</title>
<link media="all" rel="stylesheet" type="text/css" href="isabelle.css"/>
</head>

<body>
<div class="head"><h1>Theory memory_manage_sys</h1>

<span class="command">theory</span> <span class="name">memory_manage_sys</span><br/>
<span class="keyword">imports</span> <a href="func_cor_other.html"><span class="name">func_cor_other</span></a> <a href="func_cor_mempoolfree.html"><span class="name">func_cor_mempoolfree</span></a> <a href="func_cor_mempoolalloc.html"><span class="name">func_cor_mempoolalloc</span></a><br/>

</div>
<div class="source">
<pre class="source"><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*
Created by Yongwang Zhao (zhaoyw@buaa.edu.cn)
School of Computer Science &amp; Engineering, Beihang University, China
*)</span></span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">theory</span></span><span> </span><span>memory_manage_sys</span><span>
</span><span class="keyword2"><span class="keyword">imports</span></span><span> </span><span>rg_cond</span><span> </span><span>func_cor_other</span><span> </span><span>func_cor_mempoolfree</span><span>  </span><span>func_cor_mempoolalloc</span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">section</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249; formal specification of Zephyr memory management &#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>Mem_pool_alloc_RGF</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Thread &#8658; mempool_ref &#8658; nat &#8658; int &#8658; (EventLabel, Core, State, State com option) rgformula_e&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Mem_pool_alloc_RGF t p sz timeout 
  &#8801; (Mem_pool_alloc t p sz timeout, Mem_pool_alloc_RGCond t p sz timeout)&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>Mem_pool_free_RGF</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Thread &#8658; Mem_block &#8658; (EventLabel, Core, State, State com option) rgformula_e&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Mem_pool_free_RGF t b &#8801; (Mem_pool_free t b, Mem_pool_free_RGCond t b)&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>Schedule_RGF</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Thread &#8658; (EventLabel, Core, State, State com option) rgformula_e&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Schedule_RGF t &#8801; (Schedule t, Schedule_RGCond t)&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>Tick_RGF</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(EventLabel, Core, State, State com option) rgformula_e&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Tick_RGF &#8801; (Tick, Tick_RGCond)&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>Thread_RGF</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Thread &#8658; (EventLabel, Core, State, State com option) rgformula_es&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Thread_RGF t &#8801;  (rgf_EvtSys ((&#8899;(p, sz, timeout).{Mem_pool_alloc_RGF t p sz timeout}) &#8746;
                         (&#8899;b. {Mem_pool_free_RGF t b})),
         RG[(Mem_pool_free_pre t &#8745; Mem_pool_alloc_pre t),
            (Mem_pool_free_rely t &#8745; Mem_pool_alloc_rely t),
            (Mem_pool_free_guar t &#8746; Mem_pool_alloc_guar t),
            (Mem_pool_free_post t &#8746; (&#8899;(p, sz, timeout).Mem_pool_alloc_post t p sz timeout))])&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>Scheduler_RGF</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(EventLabel, Core, State, State com option) rgformula_es&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Scheduler_RGF &#8801;  (rgf_EvtSys (&#8899;t. {Schedule_RGF t}),
         RG[{s. inv s}, Schedule_rely, Schedule_guar, {s. inv s}])&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>Timer_RGF</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(EventLabel, Core, State, State com option) rgformula_es&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Timer_RGF &#8801;  (rgf_EvtSys {Tick_RGF},
         RG[&#10627;True&#10628;, Tick_rely, Tick_guar, &#10627;True&#10628;])&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>Memory_manage_system_Spec</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(EventLabel, Core, State, State com option) rgformula_par&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Memory_manage_system_Spec k &#8801; 
    case k of (&#119983; t) &#8658; Thread_RGF t
            | &#119982; &#8658; Scheduler_RGF
            | Timer &#8658; Timer_RGF&quot;</span></span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">section</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249; functional correctness of the whole specification&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;sys_rely &#8801; {}&quot;</span></span></span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*definition &quot;sys_rely &#8801; {(s,t). inv s &#10230; inv t}&quot;*)</span></span></span></span></span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*definition &quot;sys_rely &#8801; (&#8898;t. lvars_nochange_rel t) &#8745; gvars_conf_stable &#8745; {(s,t). inv s &#10230; inv t}&quot;*)</span></span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;sys_guar &#8801; Tick_guar &#8746; Schedule_guar &#8746; (&#8899;t. (Mem_pool_free_guar t &#8746; Mem_pool_alloc_guar t))&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>scheduler_esys_sat</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; fst (Memory_manage_system_Spec &#119982;) 
  sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (Memory_manage_system_Spec &#119982;), 
        Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (Memory_manage_system_Spec &#119982;), 
        Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (Memory_manage_system_Spec &#119982;), 
        Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (Memory_manage_system_Spec &#119982;)]&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Memory_manage_system_Spec_def</span><span> </span><span>Scheduler_RGF_def</span><span> </span><span>Schedule_RGF_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>EvtSys_h</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span class="delimiter">[</span><span>1</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>E<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Pre<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Rely<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Guar<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Post<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Schedule_satRG</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Schedule_RGCond_def</span><span> </span><span>Evt_sat_RG_def</span><span> </span><span>Pre<span class="hidden">&#8681;</span><sub>f</sub>_def</span><span> </span><span>Rely<span class="hidden">&#8681;</span><sub>f</sub>_def</span><span> </span><span>Guar<span class="hidden">&#8681;</span><sub>f</sub>_def</span><span> </span><span>Post<span class="hidden">&#8681;</span><sub>f</sub>_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>fast</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>Pre<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Schedule_RGCond_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>Rely<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Schedule_RGCond_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>Guar<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Schedule_RGCond_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>Post<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Schedule_RGCond_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Post<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Pre<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Schedule_RGCond_def</span><span> </span><span>getrgformula_def</span><span class="delimiter">)</span><span> 
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>getrgformula_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>stable_inv_sched_rely</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>stable_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>getrgformula_def</span><span> </span><span>Schedule_guar_def</span><span class="delimiter">)</span><span> 
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>thread_esys_sat</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; fst (Memory_manage_system_Spec (&#119983; x)) 
  sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (Memory_manage_system_Spec (&#119983; x)), 
        Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (Memory_manage_system_Spec (&#119983; x)), 
        Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (Memory_manage_system_Spec (&#119983; x)), 
        Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (Memory_manage_system_Spec (&#119983; x))]&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Memory_manage_system_Spec_def</span><span> </span><span>Thread_RGF_def</span><span> </span><span>Mem_pool_alloc_RGF_def</span><span> </span><span>Mem_pool_free_RGF_def</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>EvtSys_h</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span class="delimiter">[</span><span>1</span><span class="delimiter">]</span><span> 
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>E<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Pre<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Rely<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Guar<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Post<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>getrgformula_def</span><span> </span><span>Mem_pool_alloc_RGCond_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Mempool_alloc_satRG</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Evt_sat_RG_def</span><span> </span><span>Mem_pool_alloc_RGCond_def</span><span> 
</span><span>                                      </span><span>getrgformula_def</span><span> </span><span>Pre<span class="hidden">&#8681;</span><sub>f</sub>_def</span><span> </span><span>Rely<span class="hidden">&#8681;</span><sub>f</sub>_def</span><span> </span><span>Guar<span class="hidden">&#8681;</span><sub>f</sub>_def</span><span> </span><span>Post<span class="hidden">&#8681;</span><sub>f</sub>_def</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>fast</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>E<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Pre<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Rely<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Guar<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Post<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>getrgformula_def</span><span> </span><span>Mem_pool_free_RGCond_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Mempool_free_satRG</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Evt_sat_RG_def</span><span> </span><span>Mem_pool_free_RGCond_def</span><span> 
</span><span>                                      </span><span>getrgformula_def</span><span> </span><span>Pre<span class="hidden">&#8681;</span><sub>f</sub>_def</span><span> </span><span>Rely<span class="hidden">&#8681;</span><sub>f</sub>_def</span><span> </span><span>Guar<span class="hidden">&#8681;</span><sub>f</sub>_def</span><span> </span><span>Post<span class="hidden">&#8681;</span><sub>f</sub>_def</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>fast</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span class="delimiter">[</span><span>1</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>Pre<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>getrgformula_def</span><span> </span><span>Mem_pool_alloc_RGCond_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>Pre<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>getrgformula_def</span><span> </span><span>Mem_pool_free_RGCond_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span class="delimiter">[</span><span>1</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>Rely<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>getrgformula_def</span><span> </span><span>Mem_pool_alloc_RGCond_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>Rely<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>getrgformula_def</span><span> </span><span>Mem_pool_free_RGCond_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span class="delimiter">[</span><span>1</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>Guar<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>getrgformula_def</span><span> </span><span>Mem_pool_alloc_RGCond_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>Guar<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>getrgformula_def</span><span> </span><span>Mem_pool_free_RGCond_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span class="delimiter">[</span><span>1</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>Post<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>getrgformula_def</span><span> </span><span>Mem_pool_alloc_RGCond_def</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span class="delimiter">[</span><span>1</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>Post<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>getrgformula_def</span><span> </span><span>Mem_pool_free_RGCond_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span class="delimiter">[</span><span>1</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Post<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Pre<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Mem_pool_alloc_RGCond_def</span><span> </span><span>getrgformula_def</span><span> </span><span>Mem_pool_alloc_post_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Post<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Pre<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Mem_pool_alloc_RGCond_def</span><span> </span><span>Mem_pool_free_RGCond_def</span><span> 
</span><span>          </span><span>getrgformula_def</span><span> </span><span>Mem_pool_alloc_post_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Post<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Pre<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Mem_pool_alloc_RGCond_def</span><span> </span><span>Mem_pool_free_RGCond_def</span><span> 
</span><span>          </span><span>getrgformula_def</span><span> </span><span>Mem_pool_free_post_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Post<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Pre<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Mem_pool_free_RGCond_def</span><span> </span><span>getrgformula_def</span><span> </span><span>Mem_pool_free_post_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>getrgformula_def</span><span> </span><span>Mem_pool_free_rely_def</span><span> </span><span>Mem_pool_alloc_rely_def</span><span class="delimiter">)</span><span> 
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span><span> </span><span>1</span><span> </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* proved in mem_alloc *)</span></span></span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>getrgformula_def</span><span> </span><span>Mem_pool_free_guar_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>mem_pool_free_pre_stb</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Mem_pool_free_rely_def</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>timer_esys_sat</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; fst (Memory_manage_system_Spec Timer) 
  sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (Memory_manage_system_Spec Timer), 
        Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (Memory_manage_system_Spec Timer), 
        Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (Memory_manage_system_Spec Timer), 
        Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (Memory_manage_system_Spec Timer)]&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Memory_manage_system_Spec_def</span><span> </span><span>Timer_RGF_def</span><span> </span><span>Tick_RGF_def</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>EvtSys_h</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span class="delimiter">[</span><span>1</span><span class="delimiter">]</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>E<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Pre<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Rely<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Guar<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Post<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Tick_satRG</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Tick_RGCond_def</span><span> </span><span>Evt_sat_RG_def</span><span> </span><span>Pre<span class="hidden">&#8681;</span><sub>f</sub>_def</span><span> </span><span>Rely<span class="hidden">&#8681;</span><sub>f</sub>_def</span><span> </span><span>Guar<span class="hidden">&#8681;</span><sub>f</sub>_def</span><span> </span><span>Post<span class="hidden">&#8681;</span><sub>f</sub>_def</span><span class="delimiter">)</span><span> 
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>fast</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>Pre<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Tick_RGCond_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>Rely<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Tick_RGCond_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>Guar<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Tick_RGCond_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>Post<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Tick_RGCond_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Post<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Pre<span class="hidden">&#8681;</span><sub>e</sub>_def</span><span> </span><span>Tick_RGCond_def</span><span> </span><span>getrgformula_def</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>getrgformula_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>stable_inv_sched_rely</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>stable_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>getrgformula_def</span><span> </span><span>Tick_guar_def</span><span class="delimiter">)</span><span> 
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>esys_sat</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; fst (Memory_manage_system_Spec k) 
  sat<span class="hidden">&#8681;</span><sub>s</sub> [Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (Memory_manage_system_Spec k), 
        Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (Memory_manage_system_Spec k), 
        Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (Memory_manage_system_Spec k), 
        Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (Memory_manage_system_Spec k)]&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>k</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>scheduler_esys_sat</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>fast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>thread_esys_sat</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>fast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>timer_esys_sat</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>fast</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>s0_esys_pre</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;{s0} &#8838; Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (Memory_manage_system_Spec k)&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>k</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Memory_manage_system_Spec_def</span><span> </span><span>Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>Scheduler_RGF_def</span><span> </span><span>getrgformula_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s0_inv</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>fast</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Memory_manage_system_Spec_def</span><span> </span><span>Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>Thread_RGF_def</span><span> </span><span>getrgformula_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s0_inv</span><span> </span><span>s0a4</span><span> </span><span>s0a10</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span class="delimiter">[</span><span>1</span><span class="delimiter">]</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Memory_manage_system_Spec_def</span><span> </span><span>Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>Timer_RGF_def</span><span> </span><span>getrgformula_def</span><span class="delimiter">)</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>alloc_free_eq_guar</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Mem_pool_free_guar x = Mem_pool_alloc_guar x&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Mem_pool_free_guar_def</span><span> </span><span>Mem_pool_alloc_guar_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>alloc_free_eq_rely</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Mem_pool_free_rely x = Mem_pool_alloc_rely x&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Mem_pool_free_rely_def</span><span> </span><span>Mem_pool_alloc_rely_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>esys_guar_in_other</span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;jj &#8800; k &#10230; Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (Memory_manage_system_Spec jj) &#8838; Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (Memory_manage_system_Spec k)&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>jj</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>k</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>Memory_manage_system_Spec_def</span><span> </span><span>Scheduler_RGF_def</span><span> </span><span>Thread_RGF_def</span><span> </span><span>getrgformula_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>schedguar_in_allocrely</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Mem_pool_free_rely_def</span><span> </span><span>Mem_pool_alloc_rely_def</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span class="delimiter">[</span><span>1</span><span class="delimiter">]</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>Memory_manage_system_Spec_def</span><span> </span><span>Scheduler_RGF_def</span><span> </span><span>Timer_RGF_def</span><span> </span><span>getrgformula_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>schedguar_in_tickrely</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span class="delimiter">[</span><span>1</span><span class="delimiter">]</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>k</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>Memory_manage_system_Spec_def</span><span> </span><span>Scheduler_RGF_def</span><span> </span><span>Thread_RGF_def</span><span> </span><span>getrgformula_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span class="delimiter">[</span><span>1</span><span class="delimiter">]</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>allocguar_in_schedrely</span><span> </span><span>alloc_free_eq_guar</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>fast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>allocguar_in_schedrely</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>fast</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>Memory_manage_system_Spec_def</span><span> </span><span>Thread_RGF_def</span><span> </span><span>getrgformula_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span class="delimiter">[</span><span>1</span><span class="delimiter">]</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>allocguar_in_allocrely</span><span> </span><span>alloc_free_eq_guar</span><span> </span><span>alloc_free_eq_rely</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>fast</span><span class="delimiter">+</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>Memory_manage_system_Spec_def</span><span> </span><span>Timer_RGF_def</span><span> </span><span>Thread_RGF_def</span><span> </span><span>getrgformula_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span class="delimiter">[</span><span>1</span><span class="delimiter">]</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>allocguar_in_tickrely</span><span> </span><span>alloc_free_eq_guar</span><span> </span><span>alloc_free_eq_rely</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>fast</span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>k</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>Memory_manage_system_Spec_def</span><span> </span><span>Scheduler_RGF_def</span><span> </span><span>Timer_RGF_def</span><span> </span><span>getrgformula_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>tickguar_in_schedrely</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>fast</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>Memory_manage_system_Spec_def</span><span> </span><span>Thread_RGF_def</span><span> </span><span>Timer_RGF_def</span><span> </span><span>getrgformula_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span class="delimiter">[</span><span>1</span><span class="delimiter">]</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>tickguar_in_allocrely</span><span> </span><span>alloc_free_eq_guar</span><span> </span><span>alloc_free_eq_rely</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>fast</span><span class="delimiter">+</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>esys_guar_in_sys</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (Memory_manage_system_Spec k) &#8838; sys_guar&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>induct</span><span> </span><span>k</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>Memory_manage_system_Spec_def</span><span> </span><span>Scheduler_RGF_def</span><span> </span><span>getrgformula_def</span><span> </span><span>sys_guar_def</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span class="delimiter">[</span><span>1</span><span class="delimiter">]</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>Memory_manage_system_Spec_def</span><span> </span><span>Thread_RGF_def</span><span> </span><span>getrgformula_def</span><span> </span><span>sys_guar_def</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span class="delimiter">[</span><span>1</span><span class="delimiter">]</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>_def</span><span> </span><span>Memory_manage_system_Spec_def</span><span> </span><span>Timer_RGF_def</span><span> </span><span>getrgformula_def</span><span> </span><span>sys_guar_def</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span class="delimiter">[</span><span>1</span><span class="delimiter">]</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>mem_sys_sat</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; Memory_manage_system_Spec SAT [{s0}, sys_rely, sys_guar, UNIV]&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>ParallelESys</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>Memory_manage_system_Spec</span><span class="string"><span class="delete"><span class="delete">&quot;{s0}&quot;</span></span></span><span> </span><span>sys_rely</span><span> </span><span>sys_guar</span><span> </span><span>UNIV</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>clarify</span><span> </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>esys_sat</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>fast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s0_esys_pre</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>fast</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>sys_rely_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>esys_guar_in_other</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>fast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>esys_guar_in_sys</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>fast</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">section</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249; safety proof of memory management &#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">thm</span></span><span> </span><span>invariant_theorem</span><span>
</span><span>
</span><span class="keyword1"><span class="command">theorem</span></span><span> </span><span>mem_safe</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;invariant_presv_pares &#915; inv (paresys_spec Memory_manage_system_Spec) {s0} sys_rely&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>invariant_theorem</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span>Memory_manage_system_Spec</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;{s0}&quot;</span></span></span><span> </span><span>sys_rely</span><span> </span><span>sys_guar</span><span> </span><span>UNIV</span><span class="delimiter">]</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>mem_sys_sat</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>fastforce</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>sys_rely_def</span><span> </span><span>stable_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>sys_guar_def</span><span> </span><span>stable_def</span><span class="delimiter">)</span><span> 
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>free_guar_stb_inv</span><span> </span><span>alloc_guar_stb_inv</span><span> </span><span>sched_guar_stb_inv</span><span> </span><span>tick_guar_stb_inv</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>alloc_free_eq_guar</span><span> </span><span>allocguar_in_schedrely</span><span> </span><span>stable_inv_sched_rely</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>blast</span><span>
</span><span>      </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>s0_inv</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span></pre>

</div>
</body>
</html>
