<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Theory VCPU (Isabelle2019: June 2019)</title>
<link media="all" rel="stylesheet" type="text/css" href="isabelle.css"/>
</head>

<body>
<div class="head"><h1>Theory VCPU</h1>

<span class="command">theory</span> <span class="name">VCPU</span><br/>
<span class="keyword">imports</span> <a href="hvc.html"><span class="name">hvc</span></a> <a href="Schedule_Mgmt.html"><span class="name">Schedule_Mgmt</span></a><br/>

</div>
<div class="source">
<pre class="source"><span class="keyword1"><span class="command">theory</span></span><span> </span><span>VCPU</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">imports</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;../Design/VCPU_Mgmt&quot;</span></span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;../Req/hvc&quot;</span></span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;../Design/Schedule_Mgmt&quot;</span></span></span><span> 
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>cpuInfo_corrs</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;  GLB_STATE &#8658; HV &#8658; bool &quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; cpuInfo_corrs  g h &#8801;
    let
      cpus1 = (cpu_info (cpu_state0 g));
      cpus2 = (cpu h)
    in
      cpus1 = cpus2
&quot;</span></span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>vmID_corrs</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; cpu_id &#8658; GLB_STATE &#8658; HV &#8658; bool &quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;vmID_corrs idx g h &#8801;
      get_vmid_cid_des idx g = get_vmid_cid_req idx h &quot;</span></span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>vmState_corrs</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; GLB_STATE &#8658; HV &#8658; bool &quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; vmState_corrs g h &#8801;
    let
      vmsD = VM_State0.work_state (vm_state0 g);
      vmsR = vm_wk_st h
    in
      vmsD = vmsR &quot;</span></span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>vcpuState_corrs</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; GLB_STATE &#8658; HV &#8658; bool &quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; vcpuState_corrs g h &#8801;
    let
      vcpusD = VCPU_State.work_state (vcpu_state g);
      vcpusR = vcpu_wk_st h
    in
      vcpusD = vcpusR &quot;</span></span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>cpuState_corrs</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; GLB_STATE &#8658; HV &#8658; bool &quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; cpuState_corrs g h &#8801;
    let
      cpusD = CPU_State0.work_state (cpu_state0 g);
      cpusR = cpu_wk_st h
    in                 
      cpusD = cpusR  &quot;</span></span></span><span>
</span><span>
</span><span>
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*
definition vcpuActive_corrs :: &quot; cpu_id &#8658; GLB_STATE &#8658; HV &#8658; bool &quot;
  where &quot; vcpuActive_corrs idx g h &#8801;
    let
      vidD = cpu.active_vcpu ((cpu_info (cpu_state0 g))!idx);
      vidR = active_vcpu ((cpu h)!idx)        
    in                             
      vidD = vidR  &quot;
*)</span></span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>runningNum_corrs</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; cpu_id &#8658; GLB_STATE &#8658; HV &#8658; bool &quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; runningNum_corrs idx g h &#8801;
    let
      num1 = running_num ((cpu_info (cpu_state0 g))!idx);
      num2 = running_num ((cpu h)!idx)
    in
      num1 = num2
&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>cpuBasicInfo_corrs</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; cpu_id &#8658; GLB_STATE &#8658; HV &#8658; bool &quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; cpuBasicInfo_corrs idx g h &#8801;
    let
      cpu1 = (cpu_info (cpu_state0 g))!idx;
      cpu2 = (cpu h)!idx
    in
      cpu1 = cpu2
&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>vcpuLimit_corrs</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;   GLB_STATE &#8658; HV &#8658; bool &quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; vcpuLimit_corrs  g h &#8801;
    let
      limit1 = length (vcpu_info (vcpu_state g));
      limit2 = length (vcpu h)
    in
      limit1 = limit2
&quot;</span></span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>vcpuPool_corrs</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; cpu_id &#8658; GLB_STATE &#8658; HV &#8658; bool &quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; vcpuPool_corrs idx g h &#8801;
    let
      pool1 = CPU.vcpus ((cpu_info (cpu_state0 g))!idx);
      pool2 = CPU.vcpus ((cpu h)!idx)
    in
      pool1 = pool2
&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>activeVCPU_corrs</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; cpu_id &#8658; GLB_STATE &#8658; HV &#8658; bool &quot;</span></span></span><span>
</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; activeVCPU_corrs idx g h &#8801;
    let
      vid1 = running_num ((cpu_info (cpu_state0 g))!idx);
      vid2 = running_num ((cpu h)!idx)
    in
      vid1 = vid2
&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>activeNew_corrs</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; cpu_id &#8658; vcpu_id &#8658; GLB_STATE &#8658; HV &#8658; bool &quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; activeNew_corrs cidx vcidx g h &#8801;
    let
      vidN1= get_activeNew_des vcidx cidx g;
      vidN2= ((CPU_MAPS.cpu_map_active (cpu_maps h))!cidx) vcidx       
    in
      vidN1 = vidN2 &quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>vcpuForVM_corrs</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; cpu_id &#8658; vm_id &#8658; GLB_STATE &#8658; HV &#8658; bool &quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; vcpuForVM_corrs cidx vmidx g h &#8801;
    let
      vl1 =CPU.vcpus ((cpu_info (cpu_state0 g))!cidx);
      vido1 = get_targetVCPU_des vl1 vmidx g;
      map2 = (cpu_map_idByVM (cpu_maps h)) ! cidx;
      vido2 = map2 vmidx
    in  
      vido1 = vido2
  &quot;</span></span></span><span> 
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>vcpuIsContain_corrs</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;cpu_id &#8658; vcpu_id &#8658; GLB_STATE &#8658; HV &#8658; bool&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; vcpuIsContain_corrs cidx vcidx g h &#8801;
    let
      ret1 = is_vcpu_inPool cidx vcidx g;
      map2 = (cpu_is_haveVCPU (cpu_maps h)) ! cidx;
      ret2 = map2 vcidx
    in  
      ret1 = ret2
  &quot;</span></span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>vcpuID_result_corrs</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; vcpu_id option &#8658; bool &#8658; bool &quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; vcpuID_result_corrs ido b &#8801;
    case  (ido, b) of
        (Some i, True) &#8658; True |
        (None, False) &#8658; True |
        _ &#8658; False
  &quot;</span></span></span><span>  
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>vcpu_run</span><span> </span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10627;&#955;s. cpuInfo_corrs s hv &#8743; vmState_corrs s hv &#8743; cpuState_corrs s hv
          &#8743; vmID_corrs idx s hv &#10628;
    vcpu_run_des idx
   &#10627;&#955;r s. vmState_corrs s (vcpu_run_req hv idx) &#8743;
     cpuState_corrs s (vcpu_run_req hv idx) &#10628;&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpuInfo_corrs_def</span><span> </span><span>vmState_corrs_def</span><span> </span><span>cpuState_corrs_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Let_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>vcpu_run_des_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>wpsimp</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>vcpu_run_req_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>get_vmid_cid_des_def</span><span> </span><span>get_vmid_cid_req_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Let_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>get_vmid_cid_req_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>vmID_corrs_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>get_vmid_cid_des_def</span><span> </span><span>Let_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>get_vmid_cid_req_def</span><span> </span><span>Let_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*GLB_HV_corrs(=),des_req_result_corrs, &lt;valid_in valid_out&gt; *)</span></span></span></span></span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>vcpu_pool_switch</span><span> </span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10627;&#955;s. vcpuState_corrs s hv &#8743; cpuInfo_corrs s hv &#8743; activeNew_corrs cid vcid s hv   &#10628;
    vcpu_pool_switch_des cid vcid
    &#10627;&#955;r s. vcpuState_corrs s (vcpu_pool_switch_req hv cid vcid) &#8743; 
       cpuInfo_corrs s (vcpu_pool_switch_req hv cid vcid) &#10628;&quot;</span></span></span><span> 
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>vcpuState_corrs_def</span><span> </span><span>cpuInfo_corrs_def</span><span> </span><span>activeNew_corrs_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>Let_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>vcpu_pool_switch_des_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>wpsimp</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>vcpu_pool_switch_req_def</span><span> </span><span>Let_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>set_active_vcpu_req_def</span><span> </span><span>Let_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>runningNum_corrs_def</span><span> </span><span>Let_def</span><span>
</span><span>          </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>vcpu_pool_pop_through_vmid</span><span> </span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10627;&#955;s. cpuState_corrs s hv &#8743; vmState_corrs s hv &#8743; vcpuPool_corrs cid s hv
        &#8743; vcpuForVM_corrs cid vmid s hv  &#10628;
      vcpu_pool_pop_through_vmid_des cid vmid 
    &#10627;&#955;r s. cpuState_corrs s (fst (vcpu_pool_pop_through_vmid_req hv cid vmid))
           &#8743; vmState_corrs s (fst (vcpu_pool_pop_through_vmid_req hv cid vmid))
           &#8743; vcpuID_result_corrs r (snd (vcpu_pool_pop_through_vmid_req hv cid vmid))&#10628;
  &quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpuState_corrs_def</span><span> </span><span>Let_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>vmState_corrs_def</span><span> </span><span>Let_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>vcpuPool_corrs_def</span><span> </span><span>Let_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>vcpuForVM_corrs_def</span><span> </span><span>Let_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>vcpu_pool_pop_through_vmid_des_def</span><span> </span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>wpsimp</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>vcpuID_result_corrs_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span>
</span><span>       </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>vcpu_pool_pop_through_vmid_req_def</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>vcpu_pool_pop_through_vmid_req_def</span><span> </span><span>Let_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span>
</span><span>  </span><span class="keyword1"><span class="command">try</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>mathSub</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; p1 = (q1 ::nat) &#10233; p1 - 1 = q1 - 1&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>vcpu_pool_suspend</span><span> </span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot; cid &lt; length (cpu hv)  &#10233;  &#10627;&#955;s. vcpuPool_corrs cid s hv &#8743; vcpuState_corrs s hv &#8743; runningNum_corrs cid s hv
      &#8743; vcpuIsContain_corrs cid vcid s hv 
      &#8743; length (cpu hv) = length (cpu_info (cpu_state0 s)) &#10628;
    vcpu_pool_suspend_des cid vcid
   &#10627;&#955;r s. vcpuState_corrs s (fst(vcpu_pool_suspend_req hv cid vcid))  &#8743; 
          runningNum_corrs cid s (fst(vcpu_pool_suspend_req hv cid vcid)) &#8743;
          r = snd(vcpu_pool_suspend_req hv cid vcid) &#10628;&quot;</span></span></span><span>  
</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>vcpuPool_corrs_def</span><span> </span><span>Let_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>vcpuState_corrs_def</span><span> </span><span>Let_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>runningNum_corrs_def</span><span> </span><span>Let_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>vcpuIsContain_corrs_def</span><span> </span><span>Let_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>vcpu_pool_suspend_des_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>wpsimp</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>vcpu_pool_suspend_req_def</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>                    </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>vcpu_pool_suspend_req_def</span><span> </span><span>Let_def</span><span>
</span><span>              </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span> 
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>  
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>vcpu_pool_wakeup</span><span> </span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot; cid &lt; length (cpu hv)  &#10233;  &#10627;&#955;s. vcpuPool_corrs cid s hv &#8743; vcpuState_corrs s hv &#8743; runningNum_corrs cid s hv
      &#8743; vcpuIsContain_corrs cid vcid s hv 
      &#8743; length (cpu hv) = length (cpu_info (cpu_state0 s)) &#10628;
    vcpu_pool_wakeup_des cid vcid
   &#10627;&#955;r s. vcpuState_corrs s (fst(vcpu_pool_wakeup_req hv cid vcid))  &#8743; 
          runningNum_corrs cid s (fst(vcpu_pool_wakeup_req hv cid vcid)) &#8743;
          r = snd(vcpu_pool_wakeup_req hv cid vcid) &#10628;&quot;</span></span></span><span>  
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>vcpuPool_corrs_def</span><span> </span><span>Let_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>vcpuState_corrs_def</span><span> </span><span>Let_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>runningNum_corrs_def</span><span> </span><span>Let_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>vcpuIsContain_corrs_def</span><span> </span><span>Let_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>vcpu_pool_wakeup_des_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>wpsimp</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>vcpu_pool_wakeup_req_def</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>Let_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>vcpu_pool_wakeup_req_def</span><span> </span><span>Let_def</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>vcpu_pool_remove</span><span> </span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot; cid &lt; length (cpu hv)  &#10233;  &#10627;&#955;s. vcpuPool_corrs cid s hv &#8743; vcpuState_corrs s hv &#8743; cpuBasicInfo_corrs cid s hv
      &#8743; vcpuIsContain_corrs cid vcid s hv 
      &#8743; length (cpu hv) = length (cpu_info (cpu_state0 s)) 
      &#8743; vcpuLimit_corrs s hv&#10628;
    vcpu_pool_remove_des cid vcid
   &#10627;&#955;r s. vcpuState_corrs s (fst(vcpu_pool_remove_req hv cid vcid))  &#8743; 
          cpuBasicInfo_corrs cid s (fst(vcpu_pool_remove_req hv cid vcid)) &#8743;
          r = snd(vcpu_pool_remove_req hv cid vcid) &#10628;&quot;</span></span></span><span>  
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>vcpuPool_corrs_def</span><span> </span><span>Let_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>vcpuState_corrs_def</span><span> </span><span>Let_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpuBasicInfo_corrs_def</span><span> </span><span>Let_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>vcpuIsContain_corrs_def</span><span> </span><span>Let_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>vcpu_pool_remove_des_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>wpsimp</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>vcpu_pool_remove_req_def</span><span> </span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>Let_def</span><span>
</span><span>                </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>vcpu_pool_remove_req_def</span><span> </span><span>Let_def</span><span>
</span><span>               </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span>
</span><span>   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>vcpuLimit_corrs_def</span><span> </span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>vcpu_shutdown</span><span> </span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot; cid &lt; length (cpu hv) &#8743; idx = length (vcpu hv) &#10233; &#10627;&#955;s. vcpuPool_corrs cid s hv &#8743; vcpuState_corrs s hv
      &#8743; length (cpu hv) = length (cpu_info (cpu_state0 s)) 
      &#8743; vcpuLimit_corrs s hv
      &#8743; cpuBasicInfo_corrs cid s hv
      &#8743; cpuState_corrs s hv
      &#8743; activeNew_corrs cid idx s hv  &#8743;  vcpuIsContain_corrs cid vcid s hv  &#10628;
    vcpu_shutdown_des cid vcid
    &#10627;&#955;r s.  vcpuState_corrs s (vcpu_shutdown_req hv cid vcid)
            &#8743; cpuState_corrs s (vcpu_shutdown_req hv cid vcid)
            &#8743; cpuBasicInfo_corrs cid s (vcpu_shutdown_req hv cid vcid) &#10628;
  &quot;</span></span></span><span>                                           
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>vcpuPool_corrs_def</span><span> </span><span>Let_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>vcpuState_corrs_def</span><span> </span><span>Let_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpuBasicInfo_corrs_def</span><span> </span><span>Let_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>activeNew_corrs_def</span><span> </span><span>Let_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>vcpuIsContain_corrs_def</span><span> </span><span>Let_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>vcpu_shutdown_des_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpu_idle_des_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>wpsimp</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>vcpu_shutdown_req_def</span><span> </span><span>cpu_idle_req_def</span><span>
</span><span>                   </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Let_def</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpuState_corrs_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>Let_def</span><span class="delimiter">)</span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>vcpuLimit_corrs_def</span><span>
</span><span>             </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>Let_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command">try</span></span><span>
</span><span>            </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>simp</span><span class="delimiter">+</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>  
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>cpu_schedule</span><span> </span><span class="delimiter">:</span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot; cid &lt; length (cpu hv) &#8743; idx = length (vcpu hv) &#10233; &#10627;&#955;s. vcpuPool_corrs cid s hv &#8743; vcpuState_corrs s hv
      &#8743; length (cpu hv) = length (cpu_info (cpu_state0 s)) 
      &#8743; vcpuLimit_corrs s hv
      &#8743; cpuBasicInfo_corrs cid s hv
      &#8743; activeNew_corrs cid idx s hv &#10628;
      cpu_schedule_des cid 
   &#10627;&#955;r s. cpuBasicInfo_corrs cid s (cpu_schedule_req hv cid)
           &#8743; vcpuState_corrs s (cpu_schedule_req hv cid)  &#10628;
 &quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>vcpuPool_corrs_def</span><span> </span><span>Let_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>vcpuState_corrs_def</span><span> </span><span>Let_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpuBasicInfo_corrs_def</span><span> </span><span>Let_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>activeNew_corrs_def</span><span> </span><span>Let_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>vcpuIsContain_corrs_def</span><span> </span><span>Let_def</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>cpu_schedule_des_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>wpsimp</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command">unfolding</span></span><span> </span><span>cpu_schedule_req_def</span><span> </span><span>vcpuLimit_corrs_def</span><span> </span><span>Let_def</span><span>
</span><span>     </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span>
</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>aux1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; cid &lt; length A  &#10233; running_num (A[cid := C] ! cid) = running_num C &quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>subgoal_tac</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; (A[cid := C] ! cid) =  C&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span> 
</span><span>
</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;   cid &lt; length A &#8743; cid &lt; length B &#10233; running_num (A ! cid) = running_num (B ! cid) &#10233;
      running_num
          (A[cid := (A! cid)&#10631;running_num := running_num (B ! cid) - Suc 0&#10632;] ! cid) =
         running_num (B[cid := (B! cid)&#10631;running_num := running_num (B ! cid) - Suc 0&#10632;] ! cid)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span> 
</span><span>  
</span><span>
</span><span>
</span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span></pre>

</div>
</body>
</html>
