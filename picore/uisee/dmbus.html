<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Theory dmbus (Isabelle2019: June 2019)</title>
<link media="all" rel="stylesheet" type="text/css" href="isabelle.css"/>
</head>

<body>
<div class="head"><h1>Theory dmbus</h1>

<span class="command">theory</span> <span class="name">dmbus</span><br/>
<span class="keyword">imports</span> <a href="PiCore_RG_Invariant.html"><span class="name">PiCore_RG_Invariant</span></a><br/>

</div>
<div class="source">
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;messaging system &#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">theory</span></span><span> </span><span>dmbus</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">imports</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;../picore/PiCore_RG_Invariant&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;model&#8250;</span></span></span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(******************************************************
         a message bus framework

    --------      -------      ------
    | s1   |      |  s2 |      | s3 |
    |______|      |_____|      |____|
        &#8741;            &#8741;            &#8741;
        &#8741;            &#8741;            &#8741;
&lt;=======b1=====b2=====b3====b4====b5===========&gt; message bus
               &#8741;            &#8741;
               &#8741;            &#8741;
           --------      -------      
           | s4   |      |  s5 |     
           |______|      |_____|     

buffer: 1-writer-n-readers

******************************************************)</span></span></span></span></span><span>
</span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*
(* definition of a message-based system *)
record (&#39;buf,&#39;sys,&#39;l,&#39;k,&#39;s,&#39;prog) mbus_sys = 
  buf_writer :: &quot;&#39;buf &#8658; &#39;sys&quot;                       (* configured writer of each buf *)
  buf_readers :: &quot;&#39;buf &#8658; &#39;sys set&quot;                  (* configured readers of each buf *)
  sys_cond :: &quot;&#39;sys &#8658; (&#39;l,&#39;k,&#39;s,&#39;prog) rgformula_es&quot;   (* RG spec of each system *)
  inv :: &quot;&#39;s &#8658; bool&quot;                         (* the invariant that the system should preserve *)
  record Config  = writer :: &quot;&#39;buf set&quot; readers :: &quot;&#39;buf set&quot;

*)</span></span></span></span></span><span>
</span><span class="keyword1"><span class="command">record</span></span><span> </span><span class="delimiter">(</span><span class="tfree">&#39;a</span><span class="delimiter">,</span><span class="tfree">&#39;b</span><span class="delimiter">)</span><span> </span><span>Config</span><span>  </span><span class="delimiter">=</span><span> </span><span>writer</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;a set&quot;</span></span></span><span> 
</span><span>                         </span><span>readers</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;b set&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>dmsg_bus</span><span> </span><span class="delimiter">=</span><span> </span><span>event_hoare</span><span> </span><span>ptran</span><span> </span><span>petran</span><span> </span><span>fin_com</span><span> </span><span>cpts_p</span><span> </span><span>cpts_of_p</span><span> </span><span>prog_validity</span><span> </span><span>assume_p</span><span> 
</span><span>   </span><span>commit_p</span><span> </span><span>rghoare_p</span><span>
</span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>ptran</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; ((&#39;prog &#215; &#39;s) &#215; &#39;prog &#215; &#39;s) set&quot;</span></span></span><span> 
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>petran</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; (&#39;s,&#39;prog) pconf &#8658; (&#39;s,&#39;prog) pconf &#8658; bool&quot;</span></span></span><span> 
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>fin_com</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;prog&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>cpts_p</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; (&#39;s,&#39;prog) pconfs set&quot;</span></span></span><span> 
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>cpts_of_p</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; &#39;prog &#8658; &#39;s &#8658; ((&#39;s,&#39;prog) pconfs) set&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>prog_validity</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; &#39;prog &#8658; &#39;s set &#8658; (&#39;s &#215; &#39;s) set &#8658; (&#39;s &#215; &#39;s) set &#8658; &#39;s set &#8658; bool&quot;</span></span></span><span> 
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>assume_p</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; (&#39;s set &#215; (&#39;s &#215; &#39;s) set) &#8658; ((&#39;s,&#39;prog) pconfs) set&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>commit_p</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; ((&#39;s &#215; &#39;s) set &#215; &#39;s set) &#8658; ((&#39;s,&#39;prog) pconfs) set&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>rghoare_p</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; [&#39;prog, &#39;s set, (&#39;s &#215; &#39;s) set, (&#39;s &#215; &#39;s) set, &#39;s set] &#8658; bool&quot;</span></span></span><span>
</span><span class="delimiter">+</span><span>
</span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>conf</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;sys &#8658;(&#39;buf,&#39;buf) Config&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>buf_writer</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;s &#8658;&#39;buf &#8658; &#39;sys option&quot;</span></span></span><span>          </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* configured writer of each buf *)</span></span></span></span></span><span>
</span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>buf_readers</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;s &#8658;&#39;buf &#8658; &#39;sys set&quot;</span></span></span><span>     </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* configured readers of each buf *)</span></span></span></span></span><span>
</span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>buf_msg</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;s &#8658; (&#39;buf &#8658; &#39;mtype)&quot;</span></span></span><span>       </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* state of bufs: the msg in each buf. &#39;m is type*)</span></span></span></span></span><span>
</span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>local_vars</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;s &#8658; &#39;sys &#8658; &#39;v&quot;</span></span></span><span> </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* local vars of each system. &#39;v is the type of local vars *)</span></span></span></span></span><span>
</span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>bufs</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;s &#8658;&#39;buf set&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>singlewrite</span><span> </span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;sys1 sys2 b. sys1 &#8800; sys2 &#8743;b &#8712; writer (conf sys1) &#10230;b &#8713; writer (conf sys2)&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>writerstb</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s sys .{b.  buf_writer s b = Some(sys)} &#8838; writer (conf sys)&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>readerstb</span><span> </span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s sys .{b. sys &#8712; buf_readers s b} &#8838; readers (conf sys)&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;get_conf_wrt_bufs  sys = writer(conf sys)&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;get_conf_rd_bufs sys = readers(conf sys)&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;get_conf_rd_set b = {sys. b&#8712;readers(conf sys)}&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;get_wrt_bufs s sys &#8801; {b.  buf_writer s b = Some(sys)}&quot;</span></span></span><span> 
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;get_rd_bufs  s sys &#8801; {b. sys &#8712; buf_readers s b}&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>isCreate</span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;s &#8658;&#39;buf &#8658; bool&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;isCreate s b  &#8801; (if b &#8713; bufs s then True else False)&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;create_buf s b sys sysSet mtype &#8801; 
  SOME t. &#8704;b&#39; .(b&#39;=b &#8743; b &#8713; (bufs s) &#10230; buf_writer t = (buf_writer s)(b :=  Some(sys)) &#8743; 
 buf_readers t = (buf_readers s)(b :=  sysSet) &#8743; buf_msg t b = mtype &#8743; bufs t =  insert b (bufs s))  
&#8743; (b&#39; &#8800; b &#10230; buf_writer t = buf_writer s &#8743;buf_readers s = buf_readers t   
&#8743;buf_msg s b&#39; = buf_msg t b &#8743; bufs t = bufs s)&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;remove_buf s b sys   &#8801; 
  SOME t. &#8704;b&#39; .b&#39; = b &#8743; b&#39;&#8712;(get_wrt_bufs s sys) &#8743; b &#8712; (bufs s)&#10230; 
        buf_writer t = (buf_writer s)(b :=  None) &#8743;                                                                   
        buf_readers t = (buf_readers s)(b :=  {}) &#8743;  bufs t =  (bufs s) - {b} &#8743;
        (b&#39; &#8800; b&#8743; b&#39;&#8713;(get_wrt_bufs s sys) &#10230; buf_writer t = buf_writer s &#8743; 
        buf_readers t = buf_readers s  &#8743; buf_msg s b&#39; = buf_msg t b &#8743; bufs t = bufs s)  &quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>bufs_stb</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;buf set &#8658; (&#39;s &#215; &#39;s) set&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bufs_stb bs &#8801; {(s,t). &#8704;b&#39; . b&#39; &#8712; bs &#8743; b&#39; &#8712; bufs s &#10230; buf_msg s b&#39; = buf_msg t b&#39;}&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>bufs_stb_cpl</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot; &#39;buf set &#8658; (&#39;s &#215; &#39;s) set&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;bufs_stb_cpl bs &#8801; {(s,t). &#8704;b&#39; .b&#39;&#8713; bs &#8743; b&#39; &#8712; bufs s - bs &#10230; buf_msg s b&#39; = buf_msg t b&#39;}&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>assm_bufs_stb_sys</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;s &#8658;&#39;sys &#8658; (&#39;s &#215; &#39;s) set&quot;</span></span></span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;assm_bufs_stb_sys s sys &#8801; bufs_stb  (get_wrt_bufs  s sys )&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>guar_bufs_stb_sys</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;s &#8658;&#39;sys &#8658; (&#39;s &#215; &#39;s) set&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;guar_bufs_stb_sys  s sys &#8801; bufs_stb_cpl  (get_wrt_bufs  s sys)&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>assm_lvars_stb_sys</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;sys &#8658; (&#39;s &#215; &#39;s) set&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;assm_lvars_stb_sys sys &#8801; {(s,t). local_vars s sys = local_vars t sys}&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>guar_lvars_stb_sys</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;sys &#8658; (&#39;s &#215; &#39;s) set&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;guar_lvars_stb_sys sys &#8801; {(s,t). &#8704;sys&#39;&#8800;sys. local_vars s sys&#39; = local_vars t sys&#39;}&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>guar_in_rely_bufs</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;sys1 &#8800; sys2 &#10233; guar_bufs_stb_sys  s sys1 &#8838; assm_bufs_stb_sys  s sys2&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assm_bufs_stb_sys_def</span><span> </span><span>guar_bufs_stb_sys_def</span><span> </span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>bufs_stb_def</span><span> </span><span>bufs_stb_cpl_def</span><span> </span><span>get_wrt_bufs_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>fastforce</span><span>
</span><span>  
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>guar_in_rely_lvars</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;sys1 &#8800; sys2 &#10233; guar_lvars_stb_sys sys1 &#8838; assm_lvars_stb_sys sys2&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assm_lvars_stb_sys_def</span><span> </span><span>guar_lvars_stb_sys_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>dsingleread</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;sys1 sys2 b. sys1 &#8800; sys2 &#8743;b &#8712; (get_wrt_bufs s sys1)&#10230;b &#8713;(get_wrt_bufs s sys2)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>get_wrt_bufs_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span> </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* end of locale msg_bus *)</span></span></span></span></span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;rely-guar reasoning&#8250;</span></span></span><span>
</span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>dmsg_bus_rg</span><span> </span><span class="delimiter">=</span><span> </span><span>dmsg_bus</span><span> </span><span>ptran</span><span> </span><span>petran</span><span> </span><span>fin_com</span><span> </span><span>cpts_p</span><span> </span><span>cpts_of_p</span><span> </span><span>prog_validity</span><span> 
</span><span>  </span><span>assume_p</span><span> </span><span>commit_p</span><span> </span><span>rghoare_p</span><span> </span><span>conf</span><span> </span><span>buf_writer</span><span> </span><span>buf_readers</span><span>  </span><span>buf_msg</span><span> </span><span>local_vars</span><span>  </span><span>bufs</span><span>  
</span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>ptran</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; ((&#39;prog &#215; &#39;s) &#215; &#39;prog &#215; &#39;s) set&quot;</span></span></span><span> 
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>petran</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; (&#39;s,&#39;prog) pconf &#8658; (&#39;s,&#39;prog) pconf &#8658; bool&quot;</span></span></span><span> 
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>fin_com</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;prog&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>cpts_p</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; (&#39;s,&#39;prog) pconfs set&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>cpts_of_p</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; &#39;prog &#8658; &#39;s &#8658; ((&#39;s,&#39;prog) pconfs) set&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>prog_validity</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; &#39;prog &#8658; &#39;s set &#8658; (&#39;s &#215; &#39;s) set &#8658; (&#39;s &#215; &#39;s) set &#8658; &#39;s set &#8658; bool&quot;</span></span></span><span> 
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>assume_p</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; (&#39;s set &#215; (&#39;s &#215; &#39;s) set) &#8658; ((&#39;s,&#39;prog) pconfs) set&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>commit_p</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; ((&#39;s &#215; &#39;s) set &#215; &#39;s set) &#8658; ((&#39;s,&#39;prog) pconfs) set&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>rghoare_p</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; [&#39;prog, &#39;s set, (&#39;s &#215; &#39;s) set, (&#39;s &#215; &#39;s) set, &#39;s set] &#8658; bool&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>conf</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;sys &#8658;(&#39;buf,&#39;buf) Config&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>buf_writer</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;s &#8658;&#39;buf &#8658; &#39;sys option&quot;</span></span></span><span>          </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* configured writer of each buf *)</span></span></span></span></span><span>
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>buf_readers</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;s &#8658;&#39;buf &#8658; &#39;sys set&quot;</span></span></span><span>     </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* configured readers of each buf *)</span></span></span></span></span><span>
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>buf_msg</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;s &#8658; (&#39;buf &#8658; &#39;m)&quot;</span></span></span><span> </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* state of bufs: the msg in each buf. &#39;m is  type*)</span></span></span></span></span><span>
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>local_vars</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;s &#8658; &#39;sys &#8658; &#39;v&quot;</span></span></span><span>   </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* local vars of each system. &#39;v is the type of local vars *)</span></span></span></span></span><span>
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>bufs</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;s &#8658;&#39;buf set&quot;</span></span></span><span>
</span><span class="delimiter">+</span><span>
</span><span class="keyword2"><span class="keyword">fixes</span></span><span>  </span><span>inv</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;s &#8658; bool&quot;</span></span></span><span>                   </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* the invariant that the system should preserve *)</span></span></span></span></span><span>
</span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>whole_sys_spec</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;s &#8658;&#39;sys &#8658; (&#39;l,&#39;sys,&#39;s,&#39;prog) rgformula_es&quot;</span></span></span><span>   </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* RG spec of each system *)</span></span></span></span></span><span>
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>init</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;s set&quot;</span></span></span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>gcond</span><span> </span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;sys s. Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (whole_sys_spec s sys) &#8838; 
                         (guar_bufs_stb_sys s sys &#8745; guar_lvars_stb_sys  sys)&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>rcond</span><span> </span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;sys s. (assm_bufs_stb_sys  s sys &#8745; assm_lvars_stb_sys sys)
                       &#8838; Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (whole_sys_spec s sys)&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>syssat</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;sys. &#915; &#8866; fst (whole_sys_spec s sys) sat<span class="hidden">&#8681;</span><sub>s</sub> 
                            [Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>  (whole_sys_spec s sys), 
                             Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (whole_sys_spec s sys), 
                             Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (whole_sys_spec s sys), 
                             Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (whole_sys_spec s sys)]&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>inv_stb_rely</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;sys. stable (Collect inv) (Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (whole_sys_spec s sys))&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>inv_stb_guar</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;sys. stable (Collect inv) (Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (whole_sys_spec s sys))&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>init</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;sys. init &#8838; Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>  (whole_sys_spec s sys)&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>init_inv</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;init &#8838; (Collect inv)&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;P &#8801; (&#8898;sys s. Pre<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub>  (whole_sys_spec s sys))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;R &#8801; (&#8898;sys s. Rely<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (whole_sys_spec s sys))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;G &#8801; (&#8899;sys s. Guar<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (whole_sys_spec s sys))&quot;</span></span></span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Q &#8801; (&#8899;sys s. Post<span class="hidden">&#8681;</span><sub>e</sub><span class="hidden">&#8681;</span><sub>s</sub> (whole_sys_spec s sys))&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>inv_stb_R</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;stable (Collect inv) R&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>R_def</span><span class="delimiter">)</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>inv_stb_rely</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>stable_def</span><span class="delimiter">)</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>inv_stb_G</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;stable (Collect inv) G&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>G_def</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command">using</span></span><span>  </span><span>inv_stb_guar</span><span> 
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>stable_def</span><span class="delimiter">)</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>wholesys_sat_RG</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;s .&#915; &#8866; (whole_sys_spec s) SAT [P, R, G, Q]&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>allI</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>ParallelESys</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>syssat</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>fast</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>P_def</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span class="delimiter">[</span><span>1</span><span class="delimiter">]</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>R_def</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span class="delimiter">[</span><span>1</span><span class="delimiter">]</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>gcond</span><span> </span><span>rcond</span><span> </span><span>guar_in_rely_bufs</span><span> </span><span>guar_in_rely_lvars</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>fast</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>G_def</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span class="delimiter">[</span><span>1</span><span class="delimiter">]</span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>Q_def</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>auto</span><span class="delimiter">[</span><span>1</span><span class="delimiter">]</span><span>
</span><span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>inv</span><span class="delimiter">:</span><span class="string"><span class="delete"><span class="delete">&quot;invariant_presv_pares &#915; inv (paresys_spec (whole_sys_spec s) ) init R&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="delimiter">(</span><span>rule</span><span> </span><span>invariant_theorem</span><span class="delimiter">[</span><span class="keyword2"><span class="keyword">where</span></span><span> </span><span>G</span><span class="delimiter">=</span><span class="string"><span class="delete"><span class="delete">&quot;G&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>pst</span><span> </span><span class="delimiter">=</span><span> </span><span>Q</span><span class="delimiter">]</span><span class="delimiter">)</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>inv_stb_R</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>fast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>inv_stb_G</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>fast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>init_inv</span><span> </span><span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span> </span><span>fast</span><span>
</span><span>  </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>wholesys_sat_RG</span><span class="delimiter">[</span><span>of</span><span> </span><span>&#915;</span><span> </span><span class="delimiter">]</span><span>  </span><span>init</span><span> </span><span>P_def</span><span>  </span><span>R_def</span><span> </span><span>G_def</span><span> </span><span>Q_def</span><span>
</span><span>        </span><span>ParallelESys_conseq</span><span> </span><span class="delimiter">[</span><span>of</span><span> </span><span>init</span><span> </span><span>P</span><span> </span><span>R</span><span> </span><span>R</span><span> </span><span>G</span><span> </span><span>G</span><span> </span><span>Q</span><span> </span><span>Q</span><span> </span><span>&#915;</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(whole_sys_spec s)&quot;</span></span></span><span class="delimiter">]</span><span> 
</span><span>  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span> </span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* end of locale msg_bus *)</span></span></span></span></span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span></pre>

</div>
</body>
</html>
