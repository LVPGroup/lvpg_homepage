<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Theory PiCore_Validity (Isabelle2018: August 2018)</title>
<link media="all" rel="stylesheet" type="text/css" href="isabelle.css"/>
</head>

<body>
<div class="head"><h1>Theory PiCore_Validity</h1>

<span class="command">theory</span> <span class="name">PiCore_Validity</span><br/>
<span class="keyword">imports</span> <a href="PiCore_Computation.html"><span class="name">PiCore_Computation</span></a><br/>

</div>
<div class="source">
<pre class="source"><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*
Created by Yongwang Zhao (zhaoyw@buaa.edu.cn)
School of Computer Science &amp; Engineering, Beihang University, China
*)</span></span></span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">section</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Rely-guarnatee Validity of Picore Computations&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">theory</span></span><span> </span><span>PiCore_Validity</span><span>
</span><span class="keyword2"><span class="keyword">imports</span></span><span> </span><span>PiCore_Computation</span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Definitions Correctness Formulas&#8250;</span></span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">locale</span></span><span> </span><span>event_validity</span><span> </span><span class="delimiter">=</span><span> </span><span>event_comp</span><span> </span><span>ptran</span><span> </span><span>petran</span><span> </span><span>fin_com</span><span> </span><span>cpts_p</span><span> </span><span>cpts_of_p</span><span> 
</span><span class="keyword2"><span class="keyword">for</span></span><span> </span><span>ptran</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; ((&#39;prog &#215; &#39;s) &#215; &#39;prog &#215; &#39;s) set&quot;</span></span></span><span> 
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>petran</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; (&#39;s,&#39;prog) pconf &#8658; (&#39;s,&#39;prog) pconf &#8658; bool&quot;</span></span></span><span>   </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">&quot;_ &#8866; _ -pe&#8594; _&quot;</span></span></span><span> </span><span class="delimiter">[</span><span>81</span><span class="delimiter">,</span><span>81</span><span class="delimiter">,</span><span>81</span><span class="delimiter">]</span><span> </span><span>80</span><span class="delimiter">)</span><span>
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>fin_com</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;prog&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>cpts_p</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; (&#39;s,&#39;prog) pconfs set&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">and</span></span><span> </span><span>cpts_of_p</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; &#39;prog &#8658; &#39;s &#8658; ((&#39;s,&#39;prog) pconfs) set&quot;</span></span></span><span>
</span><span class="delimiter">+</span><span>
</span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>prog_validity</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; &#39;prog &#8658; &#39;s set &#8658; (&#39;s &#215; &#39;s) set &#8658; (&#39;s &#215; &#39;s) set &#8658; &#39;s set &#8658; bool&quot;</span></span></span><span> 
</span><span>                 </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">&quot;_ &#8872; _ sat<span class="hidden">&#8681;</span><sub>p</sub> [_, _, _, _]&quot;</span></span></span><span> </span><span class="delimiter">[</span><span>60</span><span class="delimiter">,</span><span>60</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">]</span><span> </span><span>45</span><span class="delimiter">)</span><span>
</span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>assume_p</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; (&#39;s set &#215; (&#39;s &#215; &#39;s) set) &#8658; ((&#39;s,&#39;prog) pconfs) set&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">fixes</span></span><span> </span><span>commit_p</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; ((&#39;s &#215; &#39;s) set &#215; &#39;s set) &#8658; ((&#39;s,&#39;prog) pconfs) set&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>prog_validity_def</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8872; P sat<span class="hidden">&#8681;</span><sub>p</sub> [pre, rely, guar, post] &#10233; 
   &#8704;s. cpts_of_p &#915; P s &#8745; assume_p &#915; (pre, rely) &#8838; commit_p &#915; (guar, post)&quot;</span></span></span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(*assumes assume_p_def: &quot;assume_p &#915; &#8801; &#955;(pre, rely). {c. gets_p (c!0) &#8712; pre &#8743; (&#8704;i. Suc i&lt;length c &#10230; 
               &#915; &#8866; c!i -pe&#8594; c!(Suc i) &#10230; (gets_p (c!i), gets_p (c!Suc i)) &#8712; rely)}&quot;*)</span></span></span></span></span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>assume_p_def</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_p (c!0) &#8712; pre &#8743; (&#8704;i. Suc i&lt;length c &#10230; 
               &#915; &#8866; c!i -pe&#8594; c!(Suc i) &#10230; (gets_p (c!i), gets_p (c!Suc i)) &#8712; rely) 
                &#10233; c &#8712; assume_p &#915; (pre, rely)&quot;</span></span></span><span>
</span><span class="comment"><span class="delete"><span class="delete"><span class="delete"><span class="delete">(* assumes commit_p_def: &quot;commit_p &#915; &#8801; &#955;(guar, post). {c. (&#8704;i. Suc i&lt;length c &#10230; 
               &#915; &#8866; c!i -c&#8594; c!(Suc i) &#10230; (gets_p (c!i), gets_p (c!Suc i)) &#8712; guar) &#8743; 
               (getspc_p (last c) = None &#10230; gets_p (last c) &#8712; post)}&quot; *)</span></span></span></span></span><span>
</span><span class="keyword2"><span class="keyword">assumes</span></span><span> </span><span>commit_p_def</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c &#8712; commit_p &#915; (guar, post) &#10233; (&#8704;i. Suc i&lt;length c &#10230; 
               &#915; &#8866; c!i -c&#8594; c!(Suc i) &#10230; (gets_p (c!i), gets_p (c!Suc i)) &#8712; guar) &#8743; 
               (getspc_p (last c) = fin_com &#10230; gets_p (last c) &#8712; post)&quot;</span></span></span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>assume_e</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; (&#39;s set &#215; (&#39;s &#215; &#39;s) set) &#8658; ((&#39;l,&#39;k,&#39;s,&#39;prog) econfs) set&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;assume_e &#915; &#8801; &#955;(pre, rely). {c. gets_e (c!0) &#8712; pre &#8743; (&#8704;i. Suc i&lt;length c &#10230; 
               &#915; &#8866; c!i -ee&#8594; c!(Suc i) &#10230; (gets_e (c!i), gets_e (c!Suc i)) &#8712; rely)}&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>commit_e</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; ((&#39;s &#215; &#39;s) set &#215; &#39;s set) &#8658; ((&#39;l,&#39;k,&#39;s,&#39;prog) econfs) set&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;commit_e &#915; &#8801; &#955;(guar, post). {c. (&#8704;i. Suc i&lt;length c &#10230; 
               (&#8707;t. &#915; &#8866; c!i -et-t&#8594; c!(Suc i)) &#10230; (gets_e (c!i), gets_e (c!Suc i)) &#8712; guar) &#8743; 
               (getspc_e (last c) = AnonyEvent fin_com &#10230; gets_e (last c) &#8712; post)}&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>evt_validity</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; (&#39;l,&#39;k,&#39;s,&#39;prog) event &#8658; &#39;s set &#8658; (&#39;s &#215; &#39;s) set &#8658; (&#39;s &#215; &#39;s) set &#8658; &#39;s set &#8658; bool&quot;</span></span></span><span> 
</span><span>                 </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">&quot;_ &#8872; _ sat<span class="hidden">&#8681;</span><sub>e</sub> [_, _, _, _]&quot;</span></span></span><span> </span><span class="delimiter">[</span><span>60</span><span class="delimiter">,</span><span>60</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">]</span><span> </span><span>45</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8872; Evt sat<span class="hidden">&#8681;</span><sub>e</sub> [pre, rely, guar, post] &#8801; 
   &#8704;s x. (cpts_of_ev &#915; Evt s x) &#8745; assume_e &#915; (pre, rely) &#8838; commit_e &#915; (guar, post)&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>assume_es</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; (&#39;s set &#215; (&#39;s &#215; &#39;s) set) &#8658; ((&#39;l,&#39;k,&#39;s,&#39;prog) esconfs) set&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;assume_es &#915; &#8801; &#955;(pre, rely). {c. gets_es (c!0) &#8712; pre &#8743; (&#8704;i. Suc i&lt;length c &#10230; 
               &#915; &#8866; c!i -ese&#8594; c!(Suc i) &#10230; (gets_es (c!i), gets_es (c!Suc i)) &#8712; rely)}&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>commit_es</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; ((&#39;s &#215; &#39;s) set &#215; &#39;s set) &#8658; ((&#39;l,&#39;k,&#39;s,&#39;prog) esconfs) set&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;commit_es &#915; &#8801; &#955;(guar, post). {c. (&#8704;i. Suc i&lt;length c &#10230; 
               (&#8707;t. &#915; &#8866; c!i -es-t&#8594; c!(Suc i)) &#10230; (gets_es (c!i), gets_es (c!Suc i)) &#8712; guar) }&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>es_validity</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; (&#39;l,&#39;k,&#39;s,&#39;prog) esys &#8658; &#39;s set &#8658; (&#39;s &#215; &#39;s) set &#8658; (&#39;s &#215; &#39;s) set &#8658; &#39;s set &#8658; bool&quot;</span></span></span><span> 
</span><span>                 </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">&quot;_ &#8872; _ sat<span class="hidden">&#8681;</span><sub>s</sub> [_, _, _, _]&quot;</span></span></span><span> </span><span class="delimiter">[</span><span>60</span><span class="delimiter">,</span><span>60</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">]</span><span> </span><span>45</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8872; es sat<span class="hidden">&#8681;</span><sub>s</sub> [pre, rely, guar, post] &#8801; 
   &#8704;s x. (cpts_of_es &#915; es s x) &#8745; assume_es &#915; (pre, rely) &#8838; commit_es &#915; (guar, post)&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>assume_pes</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; (&#39;s set &#215; (&#39;s &#215; &#39;s) set) &#8658; ((&#39;l,&#39;k,&#39;s,&#39;prog) pesconfs) set&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;assume_pes &#915; &#8801; &#955;(pre, rely). {c. gets (c!0) &#8712; pre &#8743; (&#8704;i. Suc i&lt;length c &#10230; 
               &#915; &#8866; c!i -pese&#8594; c!(Suc i) &#10230; (gets (c!i), gets (c!Suc i)) &#8712; rely)}&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>commit_pes</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; ((&#39;s &#215; &#39;s) set &#215; &#39;s set) &#8658; ((&#39;l,&#39;k,&#39;s,&#39;prog) pesconfs) set&quot;</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;commit_pes &#915; &#8801; &#955;(guar, post). {c. (&#8704;i. Suc i&lt;length c &#10230; 
               (&#8707;t. &#915; &#8866; c!i -pes-t&#8594; c!(Suc i)) &#10230; (gets (c!i), gets (c!Suc i)) &#8712; guar)}&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span>pes_validity</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#39;Env &#8658; (&#39;l,&#39;k,&#39;s,&#39;prog) paresys &#8658; &#39;s set &#8658; (&#39;s &#215; &#39;s) set &#8658; (&#39;s &#215; &#39;s) set &#8658; &#39;s set &#8658; bool&quot;</span></span></span><span> 
</span><span>                 </span><span class="delimiter">(</span><span class="string"><span class="delete"><span class="delete">&quot;_ &#8872; _ SAT [_, _, _, _]&quot;</span></span></span><span> </span><span class="delimiter">[</span><span>60</span><span class="delimiter">,</span><span>60</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">,</span><span>0</span><span class="delimiter">]</span><span> </span><span>45</span><span class="delimiter">)</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8872; pes SAT [pre, rely, guar, post] &#8801; 
   &#8704;s x. (cpts_of_pes &#915; pes s x) &#8745; assume_pes &#915; (pre, rely) &#8838; commit_pes &#915; (guar, post)&quot;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">subsection</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">&#8249;Lemmas of Correctness Formulas&#8250;</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>assume_es_one_more</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;esl&#8712;cpts_es &#915;; m &gt; 0; m &lt; length esl; take m esl&#8712;assume_es &#915; (pre, rely); &#172;(&#915; &#8866; esl!(m-1) -ese&#8594;esl!m)&#10215;
        &#10233; take (Suc m) esl &#8712; assume_es &#915; (pre, rely)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;cpts_es &#915;&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &gt; 0&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &lt; length esl&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;take m esl&#8712;assume_es &#915; (pre, rely)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p4</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(&#915; &#8866; esl!(m-1) -ese&#8594;esl!m)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?esl1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;take (Suc m) esl&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?esl</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;take m esl&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (?esl1!0) &#8712; pre &#8743; (&#8704;i. Suc i&lt;length ?esl1 &#10230; 
               &#915; &#8866; ?esl1!i -ese&#8594; ?esl1!(Suc i) &#10230; (gets_es (?esl1!i), gets_es (?esl1!Suc i)) &#8712; rely)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>p3</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (?esl1!0) &#8712; pre&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_es_def</span><span class="delimiter">)</span><span>
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length ?esl1 &#10230; 
               &#915; &#8866; ?esl1!i -ese&#8594; ?esl1!(Suc i) &#10230; (gets_es (?esl1!i), gets_es (?esl1!Suc i)) &#8712; rely&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>          </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>            </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>            </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length ?esl1&quot;</span></span></span><span>
</span><span>              </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; ?esl1!i -ese&#8594; ?esl1!(Suc i)&quot;</span></span></span><span>
</span><span>            </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (?esl1!i), gets_es (?esl1!Suc i)) &#8712; rely&quot;</span></span></span><span>
</span><span>              </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>cases</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i &lt; m - 1&quot;</span></span></span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i &lt; m - 1&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (?esl1!i) = gets_es (?esl!i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>b0</span><span> </span><span>p1</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (?esl1!Suc i) = gets_es (?esl!Suc i)&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>                </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length ?esl &#10230; 
                                  &#915; &#8866; ?esl!i -ese&#8594; ?esl!(Suc i) &#10230; 
                                  (gets_es (?esl!i), gets_es (?esl!Suc i)) &#8712; rely&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_es_def</span><span class="delimiter">)</span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (?esl!i), gets_es (?esl!Suc i)) &#8712; rely&quot;</span></span></span><span>
</span><span>                  </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>metis</span><span> </span><span class="delimiter">(</span><span>no_types</span><span class="delimiter">,</span><span> </span><span>lifting</span><span class="delimiter">)</span><span> </span><span>One_nat_def</span><span> </span><span>Suc_mono</span><span> </span><span>Suc_pred</span><span> </span><span>a1</span><span> 
</span><span>                    </span><span>length_take</span><span> </span><span>less_SucI</span><span> </span><span>less_imp_le_nat</span><span> </span><span>min.absorb2</span><span> </span><span>nth_take</span><span> </span><span>p1</span><span> </span><span>p2</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>b1</span><span> </span><span>b2</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>              </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>                </span><span class="keyword3"><span class="command">assume</span></span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#172;(i &lt; m - 1)&quot;</span></span></span><span>
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>b0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;i = m - 1&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>less_antisym</span><span> </span><span>p1</span><span class="delimiter">)</span><span> 
</span><span>                </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span>p4</span><span> </span><span>a1</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>              </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">}</span></span><span> </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_es_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>assume_es_take_n</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;m &gt; 0; m &#8804; length esl; esl&#8712;assume_es &#915; (pre, rely)&#10215;
        &#10233; take m esl &#8712; assume_es &#915; (pre, rely)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &gt; 0&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &#8804; length esl&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;assume_es &#915; (pre, rely)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?esl1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;take m esl&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (esl!0)&#8712;pre&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_es_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>p3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (?esl1!0) &#8712; pre&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length ?esl1 &#10230; 
           &#915; &#8866; ?esl1!i -ese&#8594; ?esl1!(Suc i) &#10230; (gets_es (?esl1!i), gets_es (?esl1!Suc i)) &#8712; rely&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length ?esl1&quot;</span></span></span><span>
</span><span>          </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; ?esl1!i -ese&#8594; ?esl1!(Suc i)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (esl!i), gets_es (esl!Suc i)) &#8712; rely&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_es_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (?esl1!i), gets_es (?esl1!Suc i)) &#8712; rely&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_lessD</span><span> </span><span>length_take</span><span> </span><span>min.absorb2</span><span> </span><span>nth_take</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_es_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>assume_es_drop_n</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;m &lt; length esl; esl&#8712;assume_es &#915; (pre, rely); gets_es (esl!m) &#8712; pre1&#10215;
        &#10233; drop m esl &#8712; assume_es &#915; (pre1, rely)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &lt; length esl&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;assume_es &#915; (pre, rely)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (esl!m) &#8712; pre1&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?esl1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop m esl&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>p3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (?esl1!0) &#8712; pre1&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>hd_conv_nth</span><span> </span><span>hd_drop_conv_nth</span><span> </span><span>not_less</span><span class="delimiter">)</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length ?esl1 &#10230; 
           &#915; &#8866; ?esl1!i -ese&#8594; ?esl1!(Suc i) &#10230; (gets_es (?esl1!i), gets_es (?esl1!Suc i)) &#8712; rely&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length ?esl1&quot;</span></span></span><span>
</span><span>          </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; ?esl1!i -ese&#8594; ?esl1!(Suc i)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span>p3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (esl!(m+i)), gets_es (esl!Suc (m+i))) &#8712; rely&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>assume_es_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (?esl1!i), gets_es (?esl1!Suc i)) &#8712; rely&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_lessD</span><span> </span><span>length_take</span><span> </span><span>min.absorb2</span><span> </span><span>nth_take</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_es_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>commit_es_take_n</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;m &gt; 0; m &#8804; length esl; esl&#8712;commit_es &#915; (guar, post)&#10215;
        &#10233; take m esl &#8712; commit_es &#915; (guar, post)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &gt; 0&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &#8804; length esl&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;commit_es &#915; (guar, post)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?esl1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;take m esl&quot;</span></span></span><span> 
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length ?esl1 &#10230; 
           (&#8707;t. &#915; &#8866; ?esl1!i -es-t&#8594; ?esl1!(Suc i)) &#10230; (gets_es (?esl1!i), gets_es (?esl1!Suc i)) &#8712; guar&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length ?esl1&quot;</span></span></span><span>
</span><span>          </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8707;t. &#915; &#8866; ?esl1!i -es-t&#8594; ?esl1!(Suc i))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (esl!i), gets_es (esl!Suc i)) &#8712; guar&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>commit_es_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (?esl1!i), gets_es (?esl1!Suc i)) &#8712; guar&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_lessD</span><span> </span><span>length_take</span><span> </span><span>min.absorb2</span><span> </span><span>nth_take</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>commit_es_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>commit_es_drop_n</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;m &lt; length esl; esl&#8712;commit_es &#915; (guar, post)&#10215;
        &#10233; drop m esl &#8712; commit_es &#915; (guar, post)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &lt; length esl&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;commit_es &#915; (guar, post)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?esl1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop m esl&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length ?esl1 &#10230; 
           (&#8707;t. &#915; &#8866; ?esl1!i -es-t&#8594; ?esl1!(Suc i)) &#10230; (gets_es (?esl1!i), gets_es (?esl1!Suc i)) &#8712; guar&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length ?esl1&quot;</span></span></span><span>
</span><span>          </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(&#8707;t. &#915; &#8866; ?esl1!i -es-t&#8594; ?esl1!(Suc i))&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (esl!(m+i)), gets_es (esl!Suc (m+i))) &#8712; guar&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>commit_es_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets_es (?esl1!i), gets_es (?esl1!Suc i)) &#8712; guar&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_lessD</span><span> </span><span>length_take</span><span> </span><span>min.absorb2</span><span> </span><span>nth_take</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>commit_es_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>assume_es_imp</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;pre1&#8838;pre; rely1&#8838;rely; c&#8712;assume_es &#915; (pre1,rely1)&#10215; &#10233; c&#8712;assume_es &#915; (pre,rely)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;pre1&#8838;pre&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rely1&#8838;rely&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;assume_es &#915; (pre1,rely1)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (c!0) &#8712; pre1 &#8743; (&#8704;i. Suc i&lt;length c &#10230; 
               &#915; &#8866; c!i -ese&#8594; c!(Suc i) &#10230; (gets_es (c!i), gets_es (c!Suc i)) &#8712; rely1)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_es_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_es_def</span><span class="delimiter">,</span><span>rule</span><span> </span><span>conjI</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span>a0</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets_es (c ! 0) &#8712; pre&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span>a0</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length c &#10230; &#915; &#8866; c ! i -ese&#8594; c ! Suc i 
                            &#10230; (gets_es (c ! i), gets_es (c ! Suc i)) &#8712; rely&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>commit_es_imp</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;guar1&#8838;guar; post1&#8838;post; c&#8712;commit_es &#915; (guar1,post1)&#10215; &#10233; c&#8712;commit_es &#915; (guar,post)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;guar1&#8838;guar&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;post1&#8838;post&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;commit_es &#915; (guar1,post1)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length c &#10230; 
               (&#8707;t. &#915; &#8866; c!i -es-t&#8594; c!(Suc i)) &#10230; (gets_es (c!i), gets_es (c!Suc i)) &#8712; guar1&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>commit_es_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>commit_es_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span>a0</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length c &#10230; (&#8707;t. &#915; &#8866; c ! i -es-t&#8594; c ! Suc i) 
                            &#10230; (gets_es (c ! i), gets_es (c ! Suc i)) &#8712; guar&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>assume_pes_imp</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;pre1&#8838;pre; rely1&#8838;rely; c&#8712;assume_pes &#915; (pre1,rely1)&#10215; &#10233; c&#8712;assume_pes &#915; (pre,rely)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;pre1&#8838;pre&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;rely1&#8838;rely&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;assume_pes &#915; (pre1,rely1)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets (c!0) &#8712; pre1 &#8743; (&#8704;i. Suc i&lt;length c &#10230; 
               &#915; &#8866; c!i -pese&#8594; c!(Suc i) &#10230; (gets (c!i), gets (c!Suc i)) &#8712; rely1)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_pes_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_pes_def</span><span class="delimiter">,</span><span>rule</span><span> </span><span>conjI</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span>a0</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets (c ! 0) &#8712; pre&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">next</span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span>a0</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length c &#10230; &#915; &#8866; c ! i -pese&#8594; c ! Suc i 
                            &#10230; (gets (c ! i), gets (c ! Suc i)) &#8712; rely&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>commit_pes_imp</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;guar1&#8838;guar; post1&#8838;post; c&#8712;commit_pes &#915; (guar1,post1)&#10215; &#10233; c&#8712;commit_pes &#915; (guar,post)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;guar1&#8838;guar&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;post1&#8838;post&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;c&#8712;commit_pes &#915; (guar1,post1)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length c &#10230; 
               (&#8707;t. &#915; &#8866; c!i -pes-t&#8594; c!(Suc i)) &#10230; (gets (c!i), gets (c!Suc i)) &#8712; guar1&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>commit_pes_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>commit_pes_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p0</span><span> </span><span>a0</span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i &lt; length c &#10230; (&#8707;t. &#915; &#8866; c ! i -pes-t&#8594; c ! Suc i) 
                            &#10230; (gets (c ! i), gets (c ! Suc i)) &#8712; guar&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>assume_pes_take_n</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;m &gt; 0; m &#8804; length esl; esl&#8712;assume_pes &#915; (pre, rely)&#10215;
        &#10233; take m esl &#8712; assume_pes &#915; (pre, rely)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &gt; 0&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &#8804; length esl&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;assume_pes &#915; (pre, rely)&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?esl1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;take m esl&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets (esl!0)&#8712;pre&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_pes_def</span><span class="delimiter">)</span><span>
</span><span>    </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>p3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets (?esl1!0) &#8712; pre&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>simp</span><span>
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length ?esl1 &#10230; 
           &#915; &#8866; ?esl1!i -pese&#8594; ?esl1!(Suc i) &#10230; (gets (?esl1!i), gets (?esl1!Suc i)) &#8712; rely&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length ?esl1&quot;</span></span></span><span>
</span><span>          </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; ?esl1!i -pese&#8594; ?esl1!(Suc i)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets (esl!i), gets (esl!Suc i)) &#8712; rely&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_pes_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets (?esl1!i), gets (?esl1!Suc i)) &#8712; rely&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_lessD</span><span> </span><span>length_take</span><span> </span><span>min.absorb2</span><span> </span><span>nth_take</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_pes_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">lemma</span></span><span> </span><span>assume_pes_drop_n</span><span class="delimiter">:</span><span> 
</span><span>  </span><span class="string"><span class="delete"><span class="delete">&quot;&#10214;m &lt; length esl; esl&#8712;assume_pes &#915; (pre, rely); gets (esl!m) &#8712; pre1&#10215;
        &#10233; drop m esl &#8712; assume_pes &#915; (pre1, rely)&quot;</span></span></span><span>
</span><span>  </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>    </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>p1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;m &lt; length esl&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p3</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;esl&#8712;assume_pes &#915; (pre, rely)&quot;</span></span></span><span>
</span><span>      </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>p2</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets (esl!m) &#8712; pre1&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">let</span></span><span> </span><span class="var">?esl1</span><span> </span><span class="delimiter">=</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;drop m esl&quot;</span></span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">from</span></span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>p3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;gets (?esl1!0) &#8712; pre1&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>hd_conv_nth</span><span> </span><span>hd_drop_conv_nth</span><span> </span><span>not_less</span><span class="delimiter">)</span><span> 
</span><span>    </span><span class="keyword1"><span class="command">moreover</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#8704;i. Suc i&lt;length ?esl1 &#10230; 
           &#915; &#8866; ?esl1!i -pese&#8594; ?esl1!(Suc i) &#10230; (gets (?esl1!i), gets (?esl1!Suc i)) &#8712; rely&quot;</span></span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">proof</span></span><span> </span><span>-</span><span>
</span><span>      </span><span class="keyword1"><span class="command">{</span></span><span>
</span><span>        </span><span class="keyword3"><span class="command">fix</span></span><span> </span><span>i</span><span>
</span><span>        </span><span class="keyword3"><span class="command">assume</span></span><span> </span><span>a0</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;Suc i&lt;length ?esl1&quot;</span></span></span><span>
</span><span>          </span><span class="keyword2"><span class="keyword">and</span></span><span>  </span><span>a1</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;&#915; &#8866; ?esl1!i -pese&#8594; ?esl1!(Suc i)&quot;</span></span></span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span>p3</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets (esl!(m+i)), gets (esl!Suc (m+i))) &#8712; rely&quot;</span></span></span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span> </span><span>assume_pes_def</span><span class="delimiter">)</span><span>
</span><span>        </span><span class="keyword1"><span class="command">with</span></span><span> </span><span>p1</span><span> </span><span>p2</span><span> </span><span>a0</span><span> </span><span class="keyword1"><span class="command">have</span></span><span> </span><span class="string"><span class="delete"><span class="delete">&quot;(gets (?esl1!i), gets (?esl1!Suc i)) &#8712; rely&quot;</span></span></span><span>
</span><span>          </span><span class="keyword1"><span class="command">using</span></span><span> </span><span>Suc_lessD</span><span> </span><span>length_take</span><span> </span><span>min.absorb2</span><span> </span><span>nth_take</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span>
</span><span>      </span><span class="keyword1"><span class="command">}</span></span><span>
</span><span>      </span><span class="keyword1"><span class="command">then</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span>auto</span><span> </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>    </span><span class="keyword1"><span class="command">ultimately</span></span><span> </span><span class="keyword3"><span class="command">show</span></span><span> </span><span class="var">?thesis</span><span> </span><span class="keyword1"><span class="command">by</span></span><span> </span><span class="delimiter">(</span><span>simp</span><span> </span><span>add</span><span class="delimiter">:</span><span>assume_pes_def</span><span class="delimiter">)</span><span>
</span><span>  </span><span class="keyword1"><span class="command">qed</span></span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span> </span></pre>

</div>
</body>
</html>
